const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./single-box-C7l-ot-n.js","./single-box-g7pxxkyq.css","./expression-builder-qIbRmfCD.js","./expression-builder-CStVRu5x.css"])))=>i.map(i=>d[i]);
var lh=Object.defineProperty;var ah=(t,e,n)=>e in t?lh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var L=(t,e,n)=>ah(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function Vl(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return n=>n in e}const Me={},Jn=[],Gt=()=>{},uh=()=>!1,ur=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),Wl=t=>t.startsWith("onUpdate:"),nt=Object.assign,ql=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},ch=Object.prototype.hasOwnProperty,Ee=(t,e)=>ch.call(t,e),ge=Array.isArray,Zn=t=>wo(t)==="[object Map]",yo=t=>wo(t)==="[object Set]",za=t=>wo(t)==="[object Date]",dh=t=>wo(t)==="[object RegExp]",ke=t=>typeof t=="function",Ke=t=>typeof t=="string",Et=t=>typeof t=="symbol",Ue=t=>t!==null&&typeof t=="object",Od=t=>(Ue(t)||ke(t))&&ke(t.then)&&ke(t.catch),Td=Object.prototype.toString,wo=t=>Td.call(t),fh=t=>wo(t).slice(8,-1),Id=t=>wo(t)==="[object Object]",zl=t=>Ke(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Wo=Vl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cr=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},ph=/-(\w)/g,nn=cr(t=>t.replace(ph,(e,n)=>n?n.toUpperCase():"")),hh=/\B([A-Z])/g,on=cr(t=>t.replace(hh,"-$1").toLowerCase()),jd=cr(t=>t.charAt(0).toUpperCase()+t.slice(1)),$r=cr(t=>t?`on${jd(t)}`:""),vt=(t,e)=>!Object.is(t,e),Qn=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},$d=(t,e,n,o=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:o,value:n})},As=t=>{const e=parseFloat(t);return isNaN(e)?t:e},gh=t=>{const e=Ke(t)?Number(t):NaN;return isNaN(e)?t:e};let Ga;const dr=()=>Ga||(Ga=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function Qe(t){if(ge(t)){const e={};for(let n=0;n<t.length;n++){const o=t[n],s=Ke(o)?yh(o):Qe(o);if(s)for(const r in s)e[r]=s[r]}return e}else if(Ke(t)||Ue(t))return t}const vh=/;(?![^(]*\))/g,mh=/:([^]+)/,bh=/\/\*[^]*?\*\//g;function yh(t){const e={};return t.replace(bh,"").split(vh).forEach(n=>{if(n){const o=n.split(mh);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function Le(t){let e="";if(Ke(t))e=t;else if(ge(t))for(let n=0;n<t.length;n++){const o=Le(t[n]);o&&(e+=o+" ")}else if(Ue(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const wh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",kh=Vl(wh);function Ad(t){return!!t||t===""}function Ch(t,e){if(t.length!==e.length)return!1;let n=!0;for(let o=0;n&&o<t.length;o++)n=ls(t[o],e[o]);return n}function ls(t,e){if(t===e)return!0;let n=za(t),o=za(e);if(n||o)return n&&o?t.getTime()===e.getTime():!1;if(n=Et(t),o=Et(e),n||o)return t===e;if(n=ge(t),o=ge(e),n||o)return n&&o?Ch(t,e):!1;if(n=Ue(t),o=Ue(e),n||o){if(!n||!o)return!1;const s=Object.keys(t).length,r=Object.keys(e).length;if(s!==r)return!1;for(const i in t){const l=t.hasOwnProperty(i),a=e.hasOwnProperty(i);if(l&&!a||!l&&a||!ls(t[i],e[i]))return!1}}return String(t)===String(e)}function Gl(t,e){return t.findIndex(n=>ls(n,e))}const Rd=t=>!!(t&&t.__v_isRef===!0),Pe=t=>Ke(t)?t:t==null?"":ge(t)||Ue(t)&&(t.toString===Td||!ke(t.toString))?Rd(t)?Pe(t.value):JSON.stringify(t,Md,2):String(t),Md=(t,e)=>Rd(e)?Md(t,e.value):Zn(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[o,s],r)=>(n[Ar(o,r)+" =>"]=s,n),{})}:yo(e)?{[`Set(${e.size})`]:[...e.values()].map(n=>Ar(n))}:Et(e)?Ar(e):Ue(e)&&!ge(e)&&!Id(e)?String(e):e,Ar=(t,e="")=>{var n;return Et(t)?`Symbol(${(n=t.description)!=null?n:e})`:t};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let kt;class Bd{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=kt,!e&&kt&&(this.index=(kt.scopes||(kt.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].pause();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].resume();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].resume()}}run(e){if(this._active){const n=kt;try{return kt=this,e()}finally{kt=n}}}on(){kt=this}off(){kt=this.parent}stop(e){if(this._active){this._active=!1;let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(this.effects.length=0,n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function xh(t){return new Bd(t)}function Sh(){return kt}let We;const Rr=new WeakSet;class Ed{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,kt&&kt.active&&kt.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rr.has(this)&&(Rr.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||Ld(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Xa(this),Nd(this);const e=We,n=Mt;We=this,Mt=!0;try{return this.fn()}finally{Fd(this),We=e,Mt=n,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)Kl(e);this.deps=this.depsTail=void 0,Xa(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rr.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){dl(this)&&this.run()}get dirty(){return dl(this)}}let Dd=0,qo,zo;function Ld(t,e=!1){if(t.flags|=8,e){t.next=zo,zo=t;return}t.next=qo,qo=t}function Xl(){Dd++}function Yl(){if(--Dd>0)return;if(zo){let e=zo;for(zo=void 0;e;){const n=e.next;e.next=void 0,e.flags&=-9,e=n}}let t;for(;qo;){let e=qo;for(qo=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){t||(t=o)}e=n}}if(t)throw t}function Nd(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function Fd(t){let e,n=t.depsTail,o=n;for(;o;){const s=o.prevDep;o.version===-1?(o===n&&(n=s),Kl(o),_h(o)):e=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=s}t.deps=e,t.depsTail=n}function dl(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(Hd(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function Hd(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===Qo))return;t.globalVersion=Qo;const e=t.dep;if(t.flags|=2,e.version>0&&!t.isSSR&&t.deps&&!dl(t)){t.flags&=-3;return}const n=We,o=Mt;We=t,Mt=!0;try{Nd(t);const s=t.fn(t._value);(e.version===0||vt(s,t._value))&&(t._value=s,e.version++)}catch(s){throw e.version++,s}finally{We=n,Mt=o,Fd(t),t.flags&=-3}}function Kl(t,e=!1){const{dep:n,prevSub:o,nextSub:s}=t;if(o&&(o.nextSub=s,t.prevSub=void 0),s&&(s.prevSub=o,t.nextSub=void 0),n.subs===t&&(n.subs=o,!o&&n.computed)){n.computed.flags&=-5;for(let r=n.computed.deps;r;r=r.nextDep)Kl(r,!0)}!e&&!--n.sc&&n.map&&n.map.delete(n.key)}function _h(t){const{prevDep:e,nextDep:n}=t;e&&(e.nextDep=n,t.prevDep=void 0),n&&(n.prevDep=e,t.nextDep=void 0)}let Mt=!0;const Ud=[];function wn(){Ud.push(Mt),Mt=!1}function kn(){const t=Ud.pop();Mt=t===void 0?!0:t}function Xa(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const n=We;We=void 0;try{e()}finally{We=n}}}let Qo=0;class Ph{constructor(e,n){this.sub=e,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class fr{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!We||!Mt||We===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==We)n=this.activeLink=new Ph(We,this),We.deps?(n.prevDep=We.depsTail,We.depsTail.nextDep=n,We.depsTail=n):We.deps=We.depsTail=n,Vd(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const o=n.nextDep;o.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=o),n.prevDep=We.depsTail,n.nextDep=void 0,We.depsTail.nextDep=n,We.depsTail=n,We.deps===n&&(We.deps=o)}return n}trigger(e){this.version++,Qo++,this.notify(e)}notify(e){Xl();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{Yl()}}}function Vd(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let o=e.deps;o;o=o.nextDep)Vd(o)}const n=t.dep.subs;n!==t&&(t.prevSub=n,n&&(n.nextSub=t)),t.dep.subs=t}}const fl=new WeakMap,jn=Symbol(""),pl=Symbol(""),es=Symbol("");function ut(t,e,n){if(Mt&&We){let o=fl.get(t);o||fl.set(t,o=new Map);let s=o.get(n);s||(o.set(n,s=new fr),s.map=o,s.key=n),s.track()}}function Zt(t,e,n,o,s,r){const i=fl.get(t);if(!i){Qo++;return}const l=a=>{a&&a.trigger()};if(Xl(),e==="clear")i.forEach(l);else{const a=ge(t),u=a&&zl(n);if(a&&n==="length"){const c=Number(o);i.forEach((d,g)=>{(g==="length"||g===es||!Et(g)&&g>=c)&&l(d)})}else switch((n!==void 0||i.has(void 0))&&l(i.get(n)),u&&l(i.get(es)),e){case"add":a?u&&l(i.get("length")):(l(i.get(jn)),Zn(t)&&l(i.get(pl)));break;case"delete":a||(l(i.get(jn)),Zn(t)&&l(i.get(pl)));break;case"set":Zn(t)&&l(i.get(jn));break}}Yl()}function Nn(t){const e=Re(t);return e===t?e:(ut(e,"iterate",es),It(t)?e:e.map(ct))}function pr(t){return ut(t=Re(t),"iterate",es),t}const Oh={__proto__:null,[Symbol.iterator](){return Mr(this,Symbol.iterator,ct)},concat(...t){return Nn(this).concat(...t.map(e=>ge(e)?Nn(e):e))},entries(){return Mr(this,"entries",t=>(t[1]=ct(t[1]),t))},every(t,e){return Yt(this,"every",t,e,void 0,arguments)},filter(t,e){return Yt(this,"filter",t,e,n=>n.map(ct),arguments)},find(t,e){return Yt(this,"find",t,e,ct,arguments)},findIndex(t,e){return Yt(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return Yt(this,"findLast",t,e,ct,arguments)},findLastIndex(t,e){return Yt(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return Yt(this,"forEach",t,e,void 0,arguments)},includes(...t){return Br(this,"includes",t)},indexOf(...t){return Br(this,"indexOf",t)},join(t){return Nn(this).join(t)},lastIndexOf(...t){return Br(this,"lastIndexOf",t)},map(t,e){return Yt(this,"map",t,e,void 0,arguments)},pop(){return To(this,"pop")},push(...t){return To(this,"push",t)},reduce(t,...e){return Ya(this,"reduce",t,e)},reduceRight(t,...e){return Ya(this,"reduceRight",t,e)},shift(){return To(this,"shift")},some(t,e){return Yt(this,"some",t,e,void 0,arguments)},splice(...t){return To(this,"splice",t)},toReversed(){return Nn(this).toReversed()},toSorted(t){return Nn(this).toSorted(t)},toSpliced(...t){return Nn(this).toSpliced(...t)},unshift(...t){return To(this,"unshift",t)},values(){return Mr(this,"values",ct)}};function Mr(t,e,n){const o=pr(t),s=o[e]();return o!==t&&!It(t)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.value&&(r.value=n(r.value)),r}),s}const Th=Array.prototype;function Yt(t,e,n,o,s,r){const i=pr(t),l=i!==t&&!It(t),a=i[e];if(a!==Th[e]){const d=a.apply(t,r);return l?ct(d):d}let u=n;i!==t&&(l?u=function(d,g){return n.call(this,ct(d),g,t)}:n.length>2&&(u=function(d,g){return n.call(this,d,g,t)}));const c=a.call(i,u,o);return l&&s?s(c):c}function Ya(t,e,n,o){const s=pr(t);let r=n;return s!==t&&(It(t)?n.length>3&&(r=function(i,l,a){return n.call(this,i,l,a,t)}):r=function(i,l,a){return n.call(this,i,ct(l),a,t)}),s[e](r,...o)}function Br(t,e,n){const o=Re(t);ut(o,"iterate",es);const s=o[e](...n);return(s===-1||s===!1)&&Ql(n[0])?(n[0]=Re(n[0]),o[e](...n)):s}function To(t,e,n=[]){wn(),Xl();const o=Re(t)[e].apply(t,n);return Yl(),kn(),o}const Ih=Vl("__proto__,__v_isRef,__isVue"),Wd=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Et));function jh(t){Et(t)||(t=String(t));const e=Re(this);return ut(e,"has",t),e.hasOwnProperty(t)}class qd{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,o){if(n==="__v_skip")return e.__v_skip;const s=this._isReadonly,r=this._isShallow;if(n==="__v_isReactive")return!s;if(n==="__v_isReadonly")return s;if(n==="__v_isShallow")return r;if(n==="__v_raw")return o===(s?r?Fh:Yd:r?Xd:Gd).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const i=ge(e);if(!s){let a;if(i&&(a=Oh[n]))return a;if(n==="hasOwnProperty")return jh}const l=Reflect.get(e,n,ye(e)?e:o);return(Et(n)?Wd.has(n):Ih(n))||(s||ut(e,"get",n),r)?l:ye(l)?i&&zl(n)?l:l.value:Ue(l)?s?Kd(l):mn(l):l}}class zd extends qd{constructor(e=!1){super(!1,e)}set(e,n,o,s){let r=e[n];if(!this._isShallow){const a=An(r);if(!It(o)&&!An(o)&&(r=Re(r),o=Re(o)),!ge(e)&&ye(r)&&!ye(o))return a?!1:(r.value=o,!0)}const i=ge(e)&&zl(n)?Number(n)<e.length:Ee(e,n),l=Reflect.set(e,n,o,ye(e)?e:s);return e===Re(s)&&(i?vt(o,r)&&Zt(e,"set",n,o):Zt(e,"add",n,o)),l}deleteProperty(e,n){const o=Ee(e,n);e[n];const s=Reflect.deleteProperty(e,n);return s&&o&&Zt(e,"delete",n,void 0),s}has(e,n){const o=Reflect.has(e,n);return(!Et(n)||!Wd.has(n))&&ut(e,"has",n),o}ownKeys(e){return ut(e,"iterate",ge(e)?"length":jn),Reflect.ownKeys(e)}}class $h extends qd{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const Ah=new zd,Rh=new $h,Mh=new zd(!0);const hl=t=>t,gs=t=>Reflect.getPrototypeOf(t);function Bh(t,e,n){return function(...o){const s=this.__v_raw,r=Re(s),i=Zn(r),l=t==="entries"||t===Symbol.iterator&&i,a=t==="keys"&&i,u=s[t](...o),c=n?hl:e?gl:ct;return!e&&ut(r,"iterate",a?pl:jn),{next(){const{value:d,done:g}=u.next();return g?{value:d,done:g}:{value:l?[c(d[0]),c(d[1])]:c(d),done:g}},[Symbol.iterator](){return this}}}}function vs(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function Eh(t,e){const n={get(s){const r=this.__v_raw,i=Re(r),l=Re(s);t||(vt(s,l)&&ut(i,"get",s),ut(i,"get",l));const{has:a}=gs(i),u=e?hl:t?gl:ct;if(a.call(i,s))return u(r.get(s));if(a.call(i,l))return u(r.get(l));r!==i&&r.get(s)},get size(){const s=this.__v_raw;return!t&&ut(Re(s),"iterate",jn),Reflect.get(s,"size",s)},has(s){const r=this.__v_raw,i=Re(r),l=Re(s);return t||(vt(s,l)&&ut(i,"has",s),ut(i,"has",l)),s===l?r.has(s):r.has(s)||r.has(l)},forEach(s,r){const i=this,l=i.__v_raw,a=Re(l),u=e?hl:t?gl:ct;return!t&&ut(a,"iterate",jn),l.forEach((c,d)=>s.call(r,u(c),u(d),i))}};return nt(n,t?{add:vs("add"),set:vs("set"),delete:vs("delete"),clear:vs("clear")}:{add(s){!e&&!It(s)&&!An(s)&&(s=Re(s));const r=Re(this);return gs(r).has.call(r,s)||(r.add(s),Zt(r,"add",s,s)),this},set(s,r){!e&&!It(r)&&!An(r)&&(r=Re(r));const i=Re(this),{has:l,get:a}=gs(i);let u=l.call(i,s);u||(s=Re(s),u=l.call(i,s));const c=a.call(i,s);return i.set(s,r),u?vt(r,c)&&Zt(i,"set",s,r):Zt(i,"add",s,r),this},delete(s){const r=Re(this),{has:i,get:l}=gs(r);let a=i.call(r,s);a||(s=Re(s),a=i.call(r,s)),l&&l.call(r,s);const u=r.delete(s);return a&&Zt(r,"delete",s,void 0),u},clear(){const s=Re(this),r=s.size!==0,i=s.clear();return r&&Zt(s,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=Bh(s,t,e)}),n}function Jl(t,e){const n=Eh(t,e);return(o,s,r)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?o:Reflect.get(Ee(n,s)&&s in o?n:o,s,r)}const Dh={get:Jl(!1,!1)},Lh={get:Jl(!1,!0)},Nh={get:Jl(!0,!1)};const Gd=new WeakMap,Xd=new WeakMap,Yd=new WeakMap,Fh=new WeakMap;function Hh(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Uh(t){return t.__v_skip||!Object.isExtensible(t)?0:Hh(fh(t))}function mn(t){return An(t)?t:Zl(t,!1,Ah,Dh,Gd)}function Vh(t){return Zl(t,!1,Mh,Lh,Xd)}function Kd(t){return Zl(t,!0,Rh,Nh,Yd)}function Zl(t,e,n,o,s){if(!Ue(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=s.get(t);if(r)return r;const i=Uh(t);if(i===0)return t;const l=new Proxy(t,i===2?o:n);return s.set(t,l),l}function eo(t){return An(t)?eo(t.__v_raw):!!(t&&t.__v_isReactive)}function An(t){return!!(t&&t.__v_isReadonly)}function It(t){return!!(t&&t.__v_isShallow)}function Ql(t){return t?!!t.__v_raw:!1}function Re(t){const e=t&&t.__v_raw;return e?Re(e):t}function Wh(t){return!Ee(t,"__v_skip")&&Object.isExtensible(t)&&$d(t,"__v_skip",!0),t}const ct=t=>Ue(t)?mn(t):t,gl=t=>Ue(t)?Kd(t):t;function ye(t){return t?t.__v_isRef===!0:!1}function W(t){return qh(t,!1)}function qh(t,e){return ye(t)?t:new zh(t,e)}class zh{constructor(e,n){this.dep=new fr,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:Re(e),this._value=n?e:ct(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,o=this.__v_isShallow||It(e)||An(e);e=o?e:Re(e),vt(e,n)&&(this._rawValue=e,this._value=o?e:ct(e),this.dep.trigger())}}function ie(t){return ye(t)?t.value:t}const Gh={get:(t,e,n)=>e==="__v_raw"?t:ie(Reflect.get(t,e,n)),set:(t,e,n,o)=>{const s=t[e];return ye(s)&&!ye(n)?(s.value=n,!0):Reflect.set(t,e,n,o)}};function Jd(t){return eo(t)?t:new Proxy(t,Gh)}class Xh{constructor(e){this.__v_isRef=!0,this._value=void 0;const n=this.dep=new fr,{get:o,set:s}=e(n.track.bind(n),n.trigger.bind(n));this._get=o,this._set=s}get value(){return this._value=this._get()}set value(e){this._set(e)}}function Yh(t){return new Xh(t)}class Kh{constructor(e,n,o){this.fn=e,this.setter=n,this._value=void 0,this.dep=new fr(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=Qo-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&We!==this)return Ld(this,!0),!0}get value(){const e=this.dep.track();return Hd(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Jh(t,e,n=!1){let o,s;return ke(t)?o=t:(o=t.get,s=t.set),new Kh(o,s,n)}const ms={},Rs=new WeakMap;let On;function Zh(t,e=!1,n=On){if(n){let o=Rs.get(n);o||Rs.set(n,o=[]),o.push(t)}}function Qh(t,e,n=Me){const{immediate:o,deep:s,once:r,scheduler:i,augmentJob:l,call:a}=n,u=f=>s?f:It(f)||s===!1||s===0?Qt(f,1):Qt(f);let c,d,g,b,y=!1,w=!1;if(ye(t)?(d=()=>t.value,y=It(t)):eo(t)?(d=()=>u(t),y=!0):ge(t)?(w=!0,y=t.some(f=>eo(f)||It(f)),d=()=>t.map(f=>{if(ye(f))return f.value;if(eo(f))return u(f);if(ke(f))return a?a(f,2):f()})):ke(t)?e?d=a?()=>a(t,2):t:d=()=>{if(g){wn();try{g()}finally{kn()}}const f=On;On=c;try{return a?a(t,3,[b]):t(b)}finally{On=f}}:d=Gt,e&&s){const f=d,x=s===!0?1/0:s;d=()=>Qt(f(),x)}const _=Sh(),k=()=>{c.stop(),_&&_.active&&ql(_.effects,c)};if(r&&e){const f=e;e=(...x)=>{f(...x),k()}}let h=w?new Array(t.length).fill(ms):ms;const v=f=>{if(!(!(c.flags&1)||!c.dirty&&!f))if(e){const x=c.run();if(s||y||(w?x.some((P,j)=>vt(P,h[j])):vt(x,h))){g&&g();const P=On;On=c;try{const j=[x,h===ms?void 0:w&&h[0]===ms?[]:h,b];a?a(e,3,j):e(...j),h=x}finally{On=P}}}else c.run()};return l&&l(v),c=new Ed(d),c.scheduler=i?()=>i(v,!1):v,b=f=>Zh(f,!1,c),g=c.onStop=()=>{const f=Rs.get(c);if(f){if(a)a(f,4);else for(const x of f)x();Rs.delete(c)}},e?o?v(!0):h=c.run():i?i(v.bind(null,!0),!0):c.run(),k.pause=c.pause.bind(c),k.resume=c.resume.bind(c),k.stop=k,k}function Qt(t,e=1/0,n){if(e<=0||!Ue(t)||t.__v_skip||(n=n||new Set,n.has(t)))return t;if(n.add(t),e--,ye(t))Qt(t.value,e,n);else if(ge(t))for(let o=0;o<t.length;o++)Qt(t[o],e,n);else if(yo(t)||Zn(t))t.forEach(o=>{Qt(o,e,n)});else if(Id(t)){for(const o in t)Qt(t[o],e,n);for(const o of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,o)&&Qt(t[o],e,n)}return t}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function as(t,e,n,o){try{return o?t(...o):t()}catch(s){us(s,e,n)}}function Dt(t,e,n,o){if(ke(t)){const s=as(t,e,n,o);return s&&Od(s)&&s.catch(r=>{us(r,e,n)}),s}if(ge(t)){const s=[];for(let r=0;r<t.length;r++)s.push(Dt(t[r],e,n,o));return s}}function us(t,e,n,o=!0){const s=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||Me;if(e){let l=e.parent;const a=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${n}`;for(;l;){const c=l.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](t,a,u)===!1)return}l=l.parent}if(r){wn(),as(r,null,10,[t,a,u]),kn();return}}eg(t,n,s,o,i)}function eg(t,e,n,o=!0,s=!1){if(s)throw t;console.error(t)}const pt=[];let Vt=-1;const to=[];let cn=null,qn=0;const Zd=Promise.resolve();let Ms=null;function hn(t){const e=Ms||Zd;return t?e.then(this?t.bind(this):t):e}function tg(t){let e=Vt+1,n=pt.length;for(;e<n;){const o=e+n>>>1,s=pt[o],r=ts(s);r<t||r===t&&s.flags&2?e=o+1:n=o}return e}function ea(t){if(!(t.flags&1)){const e=ts(t),n=pt[pt.length-1];!n||!(t.flags&2)&&e>=ts(n)?pt.push(t):pt.splice(tg(e),0,t),t.flags|=1,Qd()}}function Qd(){Ms||(Ms=Zd.then(tf))}function ng(t){ge(t)?to.push(...t):cn&&t.id===-1?cn.splice(qn+1,0,t):t.flags&1||(to.push(t),t.flags|=1),Qd()}function Ka(t,e,n=Vt+1){for(;n<pt.length;n++){const o=pt[n];if(o&&o.flags&2){if(t&&o.id!==t.uid)continue;pt.splice(n,1),n--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function ef(t){if(to.length){const e=[...new Set(to)].sort((n,o)=>ts(n)-ts(o));if(to.length=0,cn){cn.push(...e);return}for(cn=e,qn=0;qn<cn.length;qn++){const n=cn[qn];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}cn=null,qn=0}}const ts=t=>t.id==null?t.flags&2?-1:1/0:t.id;function tf(t){try{for(Vt=0;Vt<pt.length;Vt++){const e=pt[Vt];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),as(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Vt<pt.length;Vt++){const e=pt[Vt];e&&(e.flags&=-2)}Vt=-1,pt.length=0,ef(),Ms=null,(pt.length||to.length)&&tf()}}let lt=null,nf=null;function Bs(t){const e=lt;return lt=t,nf=t&&t.type.__scopeId||null,e}function Q(t,e=lt,n){if(!e||t._n)return t;const o=(...s)=>{o._d&&au(-1);const r=Bs(e);let i;try{i=t(...s)}finally{Bs(r),o._d&&au(1)}return i};return o._n=!0,o._c=!0,o._d=!0,o}function _e(t,e){if(lt===null)return t;const n=mr(lt),o=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[r,i,l,a=Me]=e[s];r&&(ke(r)&&(r={mounted:r,updated:r}),r.deep&&Qt(i),o.push({dir:r,instance:n,value:i,oldValue:void 0,arg:l,modifiers:a}))}return t}function Cn(t,e,n,o){const s=t.dirs,r=e&&e.dirs;for(let i=0;i<s.length;i++){const l=s[i];r&&(l.oldValue=r[i].value);let a=l.dir[o];a&&(wn(),Dt(a,n,8,[t.el,l,t,e]),kn())}}const of=Symbol("_vte"),og=t=>t.__isTeleport,Go=t=>t&&(t.disabled||t.disabled===""),Ja=t=>t&&(t.defer||t.defer===""),Za=t=>typeof SVGElement<"u"&&t instanceof SVGElement,Qa=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,vl=(t,e)=>{const n=t&&t.to;return Ke(n)?e?e(n):null:n},sf={name:"Teleport",__isTeleport:!0,process(t,e,n,o,s,r,i,l,a,u){const{mc:c,pc:d,pbc:g,o:{insert:b,querySelector:y,createText:w,createComment:_}}=u,k=Go(e.props);let{shapeFlag:h,children:v,dynamicChildren:f}=e;if(t==null){const x=e.el=w(""),P=e.anchor=w("");b(x,n,o),b(P,n,o);const j=(T,R)=>{h&16&&(s&&s.isCE&&(s.ce._teleportTarget=T),c(v,T,R,s,r,i,l,a))},m=()=>{const T=e.target=vl(e.props,y),R=lf(T,e,w,b);T&&(i!=="svg"&&Za(T)?i="svg":i!=="mathml"&&Qa(T)&&(i="mathml"),k||(j(T,R),Ps(e,!1)))};k&&(j(n,P),Ps(e,!0)),Ja(e.props)?ot(()=>{m(),e.el.__isMounted=!0},r):m()}else{if(Ja(e.props)&&!t.el.__isMounted){ot(()=>{sf.process(t,e,n,o,s,r,i,l,a,u),delete t.el.__isMounted},r);return}e.el=t.el,e.targetStart=t.targetStart;const x=e.anchor=t.anchor,P=e.target=t.target,j=e.targetAnchor=t.targetAnchor,m=Go(t.props),T=m?n:P,R=m?x:j;if(i==="svg"||Za(P)?i="svg":(i==="mathml"||Qa(P))&&(i="mathml"),f?(g(t.dynamicChildren,f,T,s,r,i,l),ia(t,e,!0)):a||d(t,e,T,R,s,r,i,l,!1),k)m?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):bs(e,n,x,u,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const B=e.target=vl(e.props,y);B&&bs(e,B,null,u,0)}else m&&bs(e,P,j,u,1);Ps(e,k)}},remove(t,e,n,{um:o,o:{remove:s}},r){const{shapeFlag:i,children:l,anchor:a,targetStart:u,targetAnchor:c,target:d,props:g}=t;if(d&&(s(u),s(c)),r&&s(a),i&16){const b=r||!Go(g);for(let y=0;y<l.length;y++){const w=l[y];o(w,e,n,b,!!w.dynamicChildren)}}},move:bs,hydrate:sg};function bs(t,e,n,{o:{insert:o},m:s},r=2){r===0&&o(t.targetAnchor,e,n);const{el:i,anchor:l,shapeFlag:a,children:u,props:c}=t,d=r===2;if(d&&o(i,e,n),(!d||Go(c))&&a&16)for(let g=0;g<u.length;g++)s(u[g],e,n,2);d&&o(l,e,n)}function sg(t,e,n,o,s,r,{o:{nextSibling:i,parentNode:l,querySelector:a,insert:u,createText:c}},d){const g=e.target=vl(e.props,a);if(g){const b=Go(e.props),y=g._lpa||g.firstChild;if(e.shapeFlag&16)if(b)e.anchor=d(i(t),e,l(t),n,o,s,r),e.targetStart=y,e.targetAnchor=y&&i(y);else{e.anchor=i(t);let w=y;for(;w;){if(w&&w.nodeType===8){if(w.data==="teleport start anchor")e.targetStart=w;else if(w.data==="teleport anchor"){e.targetAnchor=w,g._lpa=e.targetAnchor&&i(e.targetAnchor);break}}w=i(w)}e.targetAnchor||lf(g,e,c,u),d(y&&i(y),e,g,n,o,s,r)}Ps(e,b)}return e.anchor&&i(e.anchor)}const rf=sf;function Ps(t,e){const n=t.ctx;if(n&&n.ut){let o,s;for(e?(o=t.el,s=t.anchor):(o=t.targetStart,s=t.targetAnchor);o&&o!==s;)o.nodeType===1&&o.setAttribute("data-v-owner",n.uid),o=o.nextSibling;n.ut()}}function lf(t,e,n,o){const s=e.targetStart=n(""),r=e.targetAnchor=n("");return s[of]=r,t&&(o(s,t),o(r,t)),r}const Fn=Symbol("_leaveCb"),ys=Symbol("_enterCb");function rg(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return ht(()=>{t.isMounted=!0}),sa(()=>{t.isUnmounting=!0}),t}const _t=[Function,Array],ig={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_t,onEnter:_t,onAfterEnter:_t,onEnterCancelled:_t,onBeforeLeave:_t,onLeave:_t,onAfterLeave:_t,onLeaveCancelled:_t,onBeforeAppear:_t,onAppear:_t,onAfterAppear:_t,onAppearCancelled:_t};function lg(t,e){const{leavingVNodes:n}=t;let o=n.get(e.type);return o||(o=Object.create(null),n.set(e.type,o)),o}function ml(t,e,n,o,s){const{appear:r,mode:i,persisted:l=!1,onBeforeEnter:a,onEnter:u,onAfterEnter:c,onEnterCancelled:d,onBeforeLeave:g,onLeave:b,onAfterLeave:y,onLeaveCancelled:w,onBeforeAppear:_,onAppear:k,onAfterAppear:h,onAppearCancelled:v}=e,f=String(t.key),x=lg(n,t),P=(T,R)=>{T&&Dt(T,o,9,R)},j=(T,R)=>{const B=R[1];P(T,R),ge(T)?T.every(D=>D.length<=1)&&B():T.length<=1&&B()},m={mode:i,persisted:l,beforeEnter(T){let R=a;if(!n.isMounted)if(r)R=_||a;else return;T[Fn]&&T[Fn](!0);const B=x[f];B&&Tn(t,B)&&B.el[Fn]&&B.el[Fn](),P(R,[T])},enter(T){let R=u,B=c,D=d;if(!n.isMounted)if(r)R=k||u,B=h||c,D=v||d;else return;let N=!1;const ee=T[ys]=xe=>{N||(N=!0,xe?P(D,[T]):P(B,[T]),m.delayedLeave&&m.delayedLeave(),T[ys]=void 0)};R?j(R,[T,ee]):ee()},leave(T,R){const B=String(t.key);if(T[ys]&&T[ys](!0),n.isUnmounting)return R();P(g,[T]);let D=!1;const N=T[Fn]=ee=>{D||(D=!0,R(),ee?P(w,[T]):P(y,[T]),T[Fn]=void 0,x[B]===t&&delete x[B])};x[B]=t,b?j(b,[T,N]):N()},clone(T){return ml(T,e,n,o)}};return m}function so(t,e){t.shapeFlag&6&&t.component?(t.transition=e,so(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function af(t,e=!1,n){let o=[],s=0;for(let r=0;r<t.length;r++){let i=t[r];const l=n==null?i.key:String(n)+String(i.key!=null?i.key:r);i.type===ae?(i.patchFlag&128&&s++,o=o.concat(af(i.children,e,l))):(e||i.type!==Xt)&&o.push(l!=null?bn(i,{key:l}):i)}if(s>1)for(let r=0;r<o.length;r++)o[r].patchFlag=-2;return o}/*! #__NO_SIDE_EFFECTS__ */function Se(t,e){return ke(t)?nt({name:t.name},e,{setup:t}):t}function ta(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function Es(t,e,n,o,s=!1){if(ge(t)){t.forEach((y,w)=>Es(y,e&&(ge(e)?e[w]:e),n,o,s));return}if($n(o)&&!s){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&Es(t,e,n,o.component.subTree);return}const r=o.shapeFlag&4?mr(o.component):o.el,i=s?null:r,{i:l,r:a}=t,u=e&&e.r,c=l.refs===Me?l.refs={}:l.refs,d=l.setupState,g=Re(d),b=d===Me?()=>!1:y=>Ee(g,y);if(u!=null&&u!==a&&(Ke(u)?(c[u]=null,b(u)&&(d[u]=null)):ye(u)&&(u.value=null)),ke(a))as(a,l,12,[i,c]);else{const y=Ke(a),w=ye(a);if(y||w){const _=()=>{if(t.f){const k=y?b(a)?d[a]:c[a]:a.value;s?ge(k)&&ql(k,r):ge(k)?k.includes(r)||k.push(r):y?(c[a]=[r],b(a)&&(d[a]=c[a])):(a.value=[r],t.k&&(c[t.k]=a.value))}else y?(c[a]=i,b(a)&&(d[a]=i)):w&&(a.value=i,t.k&&(c[t.k]=i))};i?(_.id=-1,ot(_,n)):_()}}}const eu=t=>t.nodeType===8;dr().requestIdleCallback;dr().cancelIdleCallback;function ag(t,e){if(eu(t)&&t.data==="["){let n=1,o=t.nextSibling;for(;o;){if(o.nodeType===1){if(e(o)===!1)break}else if(eu(o))if(o.data==="]"){if(--n===0)break}else o.data==="["&&n++;o=o.nextSibling}}else e(t)}const $n=t=>!!t.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function tu(t){ke(t)&&(t={loader:t});const{loader:e,loadingComponent:n,errorComponent:o,delay:s=200,hydrate:r,timeout:i,suspensible:l=!0,onError:a}=t;let u=null,c,d=0;const g=()=>(d++,u=null,b()),b=()=>{let y;return u||(y=u=e().catch(w=>{if(w=w instanceof Error?w:new Error(String(w)),a)return new Promise((_,k)=>{a(w,()=>_(g()),()=>k(w),d+1)});throw w}).then(w=>y!==u&&u?u:(w&&(w.__esModule||w[Symbol.toStringTag]==="Module")&&(w=w.default),c=w,w)))};return Se({name:"AsyncComponentWrapper",__asyncLoader:b,__asyncHydrate(y,w,_){const k=r?()=>{const h=r(_,v=>ag(y,v));h&&(w.bum||(w.bum=[])).push(h)}:_;c?k():b().then(()=>!w.isUnmounted&&k())},get __asyncResolved(){return c},setup(){const y=it;if(ta(y),c)return()=>Er(c,y);const w=v=>{u=null,us(v,y,13,!o)};if(l&&y.suspense||io)return b().then(v=>()=>Er(v,y)).catch(v=>(w(v),()=>o?H(o,{error:v}):null));const _=W(!1),k=W(),h=W(!!s);return s&&setTimeout(()=>{h.value=!1},s),i!=null&&setTimeout(()=>{if(!_.value&&!k.value){const v=new Error(`Async component timed out after ${i}ms.`);w(v),k.value=v}},i),b().then(()=>{_.value=!0,y.parent&&na(y.parent.vnode)&&y.parent.update()}).catch(v=>{w(v),k.value=v}),()=>{if(_.value&&c)return Er(c,y);if(k.value&&o)return H(o,{error:k.value});if(n&&!h.value)return H(n)}}})}function Er(t,e){const{ref:n,props:o,children:s,ce:r}=e.vnode,i=H(t,o,s);return i.ref=n,i.ce=r,delete e.vnode.ce,i}const na=t=>t.type.__isKeepAlive,ug={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(t,{slots:e}){const n=ua(),o=n.ctx;if(!o.renderer)return()=>{const h=e.default&&e.default();return h&&h.length===1?h[0]:h};const s=new Map,r=new Set;let i=null;const l=n.suspense,{renderer:{p:a,m:u,um:c,o:{createElement:d}}}=o,g=d("div");o.activate=(h,v,f,x,P)=>{const j=h.component;u(h,v,f,0,l),a(j.vnode,h,v,f,j,l,x,h.slotScopeIds,P),ot(()=>{j.isDeactivated=!1,j.a&&Qn(j.a);const m=h.props&&h.props.onVnodeMounted;m&&Pt(m,j.parent,h)},l)},o.deactivate=h=>{const v=h.component;Ns(v.m),Ns(v.a),u(h,g,null,1,l),ot(()=>{v.da&&Qn(v.da);const f=h.props&&h.props.onVnodeUnmounted;f&&Pt(f,v.parent,h),v.isDeactivated=!0},l)};function b(h){Dr(h),c(h,n,l,!0)}function y(h){s.forEach((v,f)=>{const x=du(v.type);x&&!h(x)&&w(f)})}function w(h){const v=s.get(h);v&&(!i||!Tn(v,i))?b(v):i&&Dr(i),s.delete(h),r.delete(h)}ze(()=>[t.include,t.exclude],([h,v])=>{h&&y(f=>Lo(h,f)),v&&y(f=>!Lo(v,f))},{flush:"post",deep:!0});let _=null;const k=()=>{_!=null&&(Fs(n.subTree.type)?ot(()=>{s.set(_,ws(n.subTree))},n.subTree.suspense):s.set(_,ws(n.subTree)))};return ht(k),oa(k),sa(()=>{s.forEach(h=>{const{subTree:v,suspense:f}=n,x=ws(v);if(h.type===x.type&&h.key===x.key){Dr(x);const P=x.component.da;P&&ot(P,f);return}b(h)})}),()=>{if(_=null,!e.default)return i=null;const h=e.default(),v=h[0];if(h.length>1)return i=null,h;if(!ro(v)||!(v.shapeFlag&4)&&!(v.shapeFlag&128))return i=null,v;let f=ws(v);if(f.type===Xt)return i=null,f;const x=f.type,P=du($n(f)?f.type.__asyncResolved||{}:x),{include:j,exclude:m,max:T}=t;if(j&&(!P||!Lo(j,P))||m&&P&&Lo(m,P))return f.shapeFlag&=-257,i=f,v;const R=f.key==null?x:f.key,B=s.get(R);return f.el&&(f=bn(f),v.shapeFlag&128&&(v.ssContent=f)),_=R,B?(f.el=B.el,f.component=B.component,f.transition&&so(f,f.transition),f.shapeFlag|=512,r.delete(R),r.add(R)):(r.add(R),T&&r.size>parseInt(T,10)&&w(r.values().next().value)),f.shapeFlag|=256,i=f,Fs(v.type)?v:f}}},cg=ug;function Lo(t,e){return ge(t)?t.some(n=>Lo(n,e)):Ke(t)?t.split(",").includes(e):dh(t)?(t.lastIndex=0,t.test(e)):!1}function uf(t,e){df(t,"a",e)}function cf(t,e){df(t,"da",e)}function df(t,e,n=it){const o=t.__wdc||(t.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(hr(e,o,n),n){let s=n.parent;for(;s&&s.parent;)na(s.parent.vnode)&&dg(o,e,n,s),s=s.parent}}function dg(t,e,n,o){const s=hr(e,t,o,!0);Rt(()=>{ql(o[e],s)},n)}function Dr(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function ws(t){return t.shapeFlag&128?t.ssContent:t}function hr(t,e,n=it,o=!1){if(n){const s=n[t]||(n[t]=[]),r=e.__weh||(e.__weh=(...i)=>{wn();const l=ds(n),a=Dt(e,n,t,i);return l(),kn(),a});return o?s.unshift(r):s.push(r),r}}const sn=t=>(e,n=it)=>{(!io||t==="sp")&&hr(t,(...o)=>e(...o),n)},fg=sn("bm"),ht=sn("m"),pg=sn("bu"),oa=sn("u"),sa=sn("bum"),Rt=sn("um"),hg=sn("sp"),gg=sn("rtg"),vg=sn("rtc");function mg(t,e=it){hr("ec",t,e)}const bg=Symbol.for("v-ndc");function qe(t,e,n,o){let s;const r=n,i=ge(t);if(i||Ke(t)){const l=i&&eo(t);let a=!1;l&&(a=!It(t),t=pr(t)),s=new Array(t.length);for(let u=0,c=t.length;u<c;u++)s[u]=e(a?ct(t[u]):t[u],u,void 0,r)}else if(typeof t=="number"){s=new Array(t);for(let l=0;l<t;l++)s[l]=e(l+1,l,void 0,r)}else if(Ue(t))if(t[Symbol.iterator])s=Array.from(t,(l,a)=>e(l,a,void 0,r));else{const l=Object.keys(t);s=new Array(l.length);for(let a=0,u=l.length;a<u;a++){const c=l[a];s[a]=e(t[c],c,a,r)}}else s=[];return s}function qt(t,e,n={},o,s){if(lt.ce||lt.parent&&$n(lt.parent)&&lt.parent.ce)return e!=="default"&&(n.name=e),$(),de(ae,null,[H("slot",n,o)],64);let r=t[e];r&&r._c&&(r._d=!1),$();const i=r&&ff(r(n)),l=n.key||i&&i.key,a=de(ae,{key:(l&&!Et(l)?l:`_${e}`)+""},i||[],i&&t._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function ff(t){return t.some(e=>ro(e)?!(e.type===Xt||e.type===ae&&!ff(e.children)):!0)?t:null}const bl=t=>t?$f(t)?mr(t):bl(t.parent):null,Xo=nt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>bl(t.parent),$root:t=>bl(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>hf(t),$forceUpdate:t=>t.f||(t.f=()=>{ea(t.update)}),$nextTick:t=>t.n||(t.n=hn.bind(t.proxy)),$watch:t=>Hg.bind(t)}),Lr=(t,e)=>t!==Me&&!t.__isScriptSetup&&Ee(t,e),yg={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:n,setupState:o,data:s,props:r,accessCache:i,type:l,appContext:a}=t;let u;if(e[0]!=="$"){const b=i[e];if(b!==void 0)switch(b){case 1:return o[e];case 2:return s[e];case 4:return n[e];case 3:return r[e]}else{if(Lr(o,e))return i[e]=1,o[e];if(s!==Me&&Ee(s,e))return i[e]=2,s[e];if((u=t.propsOptions[0])&&Ee(u,e))return i[e]=3,r[e];if(n!==Me&&Ee(n,e))return i[e]=4,n[e];yl&&(i[e]=0)}}const c=Xo[e];let d,g;if(c)return e==="$attrs"&&ut(t.attrs,"get",""),c(t);if((d=l.__cssModules)&&(d=d[e]))return d;if(n!==Me&&Ee(n,e))return i[e]=4,n[e];if(g=a.config.globalProperties,Ee(g,e))return g[e]},set({_:t},e,n){const{data:o,setupState:s,ctx:r}=t;return Lr(s,e)?(s[e]=n,!0):o!==Me&&Ee(o,e)?(o[e]=n,!0):Ee(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(r[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:o,appContext:s,propsOptions:r}},i){let l;return!!n[i]||t!==Me&&Ee(t,i)||Lr(e,i)||(l=r[0])&&Ee(l,i)||Ee(o,i)||Ee(Xo,i)||Ee(s.config.globalProperties,i)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Ee(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function Ds(t){return ge(t)?t.reduce((e,n)=>(e[n]=null,e),{}):t}function Rn(t,e){return!t||!e?t||e:ge(t)&&ge(e)?t.concat(e):nt({},Ds(t),Ds(e))}let yl=!0;function wg(t){const e=hf(t),n=t.proxy,o=t.ctx;yl=!1,e.beforeCreate&&nu(e.beforeCreate,t,"bc");const{data:s,computed:r,methods:i,watch:l,provide:a,inject:u,created:c,beforeMount:d,mounted:g,beforeUpdate:b,updated:y,activated:w,deactivated:_,beforeDestroy:k,beforeUnmount:h,destroyed:v,unmounted:f,render:x,renderTracked:P,renderTriggered:j,errorCaptured:m,serverPrefetch:T,expose:R,inheritAttrs:B,components:D,directives:N,filters:ee}=e;if(u&&kg(u,o,null),i)for(const I in i){const C=i[I];ke(C)&&(o[I]=C.bind(n))}if(s){const I=s.call(n,n);Ue(I)&&(t.data=mn(I))}if(yl=!0,r)for(const I in r){const C=r[I],A=ke(C)?C.bind(n,n):ke(C.get)?C.get.bind(n,n):Gt,oe=!ke(C)&&ke(C.set)?C.set.bind(n):Gt,pe=M({get:A,set:oe});Object.defineProperty(o,I,{enumerable:!0,configurable:!0,get:()=>pe.value,set:Oe=>pe.value=Oe})}if(l)for(const I in l)pf(l[I],o,n,I);if(a){const I=ke(a)?a.call(n):a;Reflect.ownKeys(I).forEach(C=>{Og(C,I[C])})}c&&nu(c,t,"c");function z(I,C){ge(C)?C.forEach(A=>I(A.bind(n))):C&&I(C.bind(n))}if(z(fg,d),z(ht,g),z(pg,b),z(oa,y),z(uf,w),z(cf,_),z(mg,m),z(vg,P),z(gg,j),z(sa,h),z(Rt,f),z(hg,T),ge(R))if(R.length){const I=t.exposed||(t.exposed={});R.forEach(C=>{Object.defineProperty(I,C,{get:()=>n[C],set:A=>n[C]=A})})}else t.exposed||(t.exposed={});x&&t.render===Gt&&(t.render=x),B!=null&&(t.inheritAttrs=B),D&&(t.components=D),N&&(t.directives=N),T&&ta(t)}function kg(t,e,n=Gt){ge(t)&&(t=wl(t));for(const o in t){const s=t[o];let r;Ue(s)?"default"in s?r=Yo(s.from||o,s.default,!0):r=Yo(s.from||o):r=Yo(s),ye(r)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>r.value,set:i=>r.value=i}):e[o]=r}}function nu(t,e,n){Dt(ge(t)?t.map(o=>o.bind(e.proxy)):t.bind(e.proxy),e,n)}function pf(t,e,n,o){let s=o.includes(".")?Pf(n,o):()=>n[o];if(Ke(t)){const r=e[t];ke(r)&&ze(s,r)}else if(ke(t))ze(s,t.bind(n));else if(Ue(t))if(ge(t))t.forEach(r=>pf(r,e,n,o));else{const r=ke(t.handler)?t.handler.bind(n):e[t.handler];ke(r)&&ze(s,r,t)}}function hf(t){const e=t.type,{mixins:n,extends:o}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:i}}=t.appContext,l=r.get(e);let a;return l?a=l:!s.length&&!n&&!o?a=e:(a={},s.length&&s.forEach(u=>Ls(a,u,i,!0)),Ls(a,e,i)),Ue(e)&&r.set(e,a),a}function Ls(t,e,n,o=!1){const{mixins:s,extends:r}=e;r&&Ls(t,r,n,!0),s&&s.forEach(i=>Ls(t,i,n,!0));for(const i in e)if(!(o&&i==="expose")){const l=Cg[i]||n&&n[i];t[i]=l?l(t[i],e[i]):e[i]}return t}const Cg={data:ou,props:su,emits:su,methods:No,computed:No,beforeCreate:dt,created:dt,beforeMount:dt,mounted:dt,beforeUpdate:dt,updated:dt,beforeDestroy:dt,beforeUnmount:dt,destroyed:dt,unmounted:dt,activated:dt,deactivated:dt,errorCaptured:dt,serverPrefetch:dt,components:No,directives:No,watch:Sg,provide:ou,inject:xg};function ou(t,e){return e?t?function(){return nt(ke(t)?t.call(this,this):t,ke(e)?e.call(this,this):e)}:e:t}function xg(t,e){return No(wl(t),wl(e))}function wl(t){if(ge(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function dt(t,e){return t?[...new Set([].concat(t,e))]:e}function No(t,e){return t?nt(Object.create(null),t,e):e}function su(t,e){return t?ge(t)&&ge(e)?[...new Set([...t,...e])]:nt(Object.create(null),Ds(t),Ds(e??{})):e}function Sg(t,e){if(!t)return e;if(!e)return t;const n=nt(Object.create(null),t);for(const o in e)n[o]=dt(t[o],e[o]);return n}function gf(){return{app:null,config:{isNativeTag:uh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let _g=0;function Pg(t,e){return function(o,s=null){ke(o)||(o=nt({},o)),s!=null&&!Ue(s)&&(s=null);const r=gf(),i=new WeakSet,l=[];let a=!1;const u=r.app={_uid:_g++,_component:o,_props:s,_container:null,_context:r,_instance:null,version:lv,get config(){return r.config},set config(c){},use(c,...d){return i.has(c)||(c&&ke(c.install)?(i.add(c),c.install(u,...d)):ke(c)&&(i.add(c),c(u,...d))),u},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),u},component(c,d){return d?(r.components[c]=d,u):r.components[c]},directive(c,d){return d?(r.directives[c]=d,u):r.directives[c]},mount(c,d,g){if(!a){const b=u._ceVNode||H(o,s);return b.appContext=r,g===!0?g="svg":g===!1&&(g=void 0),t(b,c,g),a=!0,u._container=c,c.__vue_app__=u,mr(b.component)}},onUnmount(c){l.push(c)},unmount(){a&&(Dt(l,u._instance,16),t(null,u._container),delete u._container.__vue_app__)},provide(c,d){return r.provides[c]=d,u},runWithContext(c){const d=no;no=u;try{return c()}finally{no=d}}};return u}}let no=null;function Og(t,e){if(it){let n=it.provides;const o=it.parent&&it.parent.provides;o===n&&(n=it.provides=Object.create(o)),n[t]=e}}function Yo(t,e,n=!1){const o=it||lt;if(o||no){const s=no?no._context.provides:o?o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(s&&t in s)return s[t];if(arguments.length>1)return n&&ke(e)?e.call(o&&o.proxy):e}}const vf={},mf=()=>Object.create(vf),bf=t=>Object.getPrototypeOf(t)===vf;function Tg(t,e,n,o=!1){const s={},r=mf();t.propsDefaults=Object.create(null),yf(t,e,s,r);for(const i in t.propsOptions[0])i in s||(s[i]=void 0);n?t.props=o?s:Vh(s):t.type.props?t.props=s:t.props=r,t.attrs=r}function Ig(t,e,n,o){const{props:s,attrs:r,vnode:{patchFlag:i}}=t,l=Re(s),[a]=t.propsOptions;let u=!1;if((o||i>0)&&!(i&16)){if(i&8){const c=t.vnode.dynamicProps;for(let d=0;d<c.length;d++){let g=c[d];if(gr(t.emitsOptions,g))continue;const b=e[g];if(a)if(Ee(r,g))b!==r[g]&&(r[g]=b,u=!0);else{const y=nn(g);s[y]=kl(a,l,y,b,t,!1)}else b!==r[g]&&(r[g]=b,u=!0)}}}else{yf(t,e,s,r)&&(u=!0);let c;for(const d in l)(!e||!Ee(e,d)&&((c=on(d))===d||!Ee(e,c)))&&(a?n&&(n[d]!==void 0||n[c]!==void 0)&&(s[d]=kl(a,l,d,void 0,t,!0)):delete s[d]);if(r!==l)for(const d in r)(!e||!Ee(e,d))&&(delete r[d],u=!0)}u&&Zt(t.attrs,"set","")}function yf(t,e,n,o){const[s,r]=t.propsOptions;let i=!1,l;if(e)for(let a in e){if(Wo(a))continue;const u=e[a];let c;s&&Ee(s,c=nn(a))?!r||!r.includes(c)?n[c]=u:(l||(l={}))[c]=u:gr(t.emitsOptions,a)||(!(a in o)||u!==o[a])&&(o[a]=u,i=!0)}if(r){const a=Re(n),u=l||Me;for(let c=0;c<r.length;c++){const d=r[c];n[d]=kl(s,a,d,u[d],t,!Ee(u,d))}}return i}function kl(t,e,n,o,s,r){const i=t[n];if(i!=null){const l=Ee(i,"default");if(l&&o===void 0){const a=i.default;if(i.type!==Function&&!i.skipFactory&&ke(a)){const{propsDefaults:u}=s;if(n in u)o=u[n];else{const c=ds(s);o=u[n]=a.call(null,e),c()}}else o=a;s.ce&&s.ce._setProp(n,o)}i[0]&&(r&&!l?o=!1:i[1]&&(o===""||o===on(n))&&(o=!0))}return o}const jg=new WeakMap;function wf(t,e,n=!1){const o=n?jg:e.propsCache,s=o.get(t);if(s)return s;const r=t.props,i={},l=[];let a=!1;if(!ke(t)){const c=d=>{a=!0;const[g,b]=wf(d,e,!0);nt(i,g),b&&l.push(...b)};!n&&e.mixins.length&&e.mixins.forEach(c),t.extends&&c(t.extends),t.mixins&&t.mixins.forEach(c)}if(!r&&!a)return Ue(t)&&o.set(t,Jn),Jn;if(ge(r))for(let c=0;c<r.length;c++){const d=nn(r[c]);ru(d)&&(i[d]=Me)}else if(r)for(const c in r){const d=nn(c);if(ru(d)){const g=r[c],b=i[d]=ge(g)||ke(g)?{type:g}:nt({},g),y=b.type;let w=!1,_=!0;if(ge(y))for(let k=0;k<y.length;++k){const h=y[k],v=ke(h)&&h.name;if(v==="Boolean"){w=!0;break}else v==="String"&&(_=!1)}else w=ke(y)&&y.name==="Boolean";b[0]=w,b[1]=_,(w||Ee(b,"default"))&&l.push(d)}}const u=[i,l];return Ue(t)&&o.set(t,u),u}function ru(t){return t[0]!=="$"&&!Wo(t)}const kf=t=>t[0]==="_"||t==="$stable",ra=t=>ge(t)?t.map(Wt):[Wt(t)],$g=(t,e,n)=>{if(e._n)return e;const o=Q((...s)=>ra(e(...s)),n);return o._c=!1,o},Cf=(t,e,n)=>{const o=t._ctx;for(const s in t){if(kf(s))continue;const r=t[s];if(ke(r))e[s]=$g(s,r,o);else if(r!=null){const i=ra(r);e[s]=()=>i}}},xf=(t,e)=>{const n=ra(e);t.slots.default=()=>n},Sf=(t,e,n)=>{for(const o in e)(n||o!=="_")&&(t[o]=e[o])},Ag=(t,e,n)=>{const o=t.slots=mf();if(t.vnode.shapeFlag&32){const s=e._;s?(Sf(o,e,n),n&&$d(o,"_",s,!0)):Cf(e,o)}else e&&xf(t,e)},Rg=(t,e,n)=>{const{vnode:o,slots:s}=t;let r=!0,i=Me;if(o.shapeFlag&32){const l=e._;l?n&&l===1?r=!1:Sf(s,e,n):(r=!e.$stable,Cf(e,s)),i=e}else e&&(xf(t,e),i={default:1});if(r)for(const l in s)!kf(l)&&i[l]==null&&delete s[l]},ot=Gg;function Mg(t){return Bg(t)}function Bg(t,e){const n=dr();n.__VUE__=!0;const{insert:o,remove:s,patchProp:r,createElement:i,createText:l,createComment:a,setText:u,setElementText:c,parentNode:d,nextSibling:g,setScopeId:b=Gt,insertStaticContent:y}=t,w=(S,O,E,q=null,V=null,G=null,se=void 0,Z=null,ne=!!O.dynamicChildren)=>{if(S===O)return;S&&!Tn(S,O)&&(q=Ce(S),Oe(S,V,G,!0),S=null),O.patchFlag===-2&&(ne=!1,O.dynamicChildren=null);const{type:X,ref:me,shapeFlag:le}=O;switch(X){case vr:_(S,O,E,q);break;case Xt:k(S,O,E,q);break;case Os:S==null&&h(O,E,q,se);break;case ae:D(S,O,E,q,V,G,se,Z,ne);break;default:le&1?x(S,O,E,q,V,G,se,Z,ne):le&6?N(S,O,E,q,V,G,se,Z,ne):(le&64||le&128)&&X.process(S,O,E,q,V,G,se,Z,ne,U)}me!=null&&V&&Es(me,S&&S.ref,G,O||S,!O)},_=(S,O,E,q)=>{if(S==null)o(O.el=l(O.children),E,q);else{const V=O.el=S.el;O.children!==S.children&&u(V,O.children)}},k=(S,O,E,q)=>{S==null?o(O.el=a(O.children||""),E,q):O.el=S.el},h=(S,O,E,q)=>{[S.el,S.anchor]=y(S.children,O,E,q,S.el,S.anchor)},v=({el:S,anchor:O},E,q)=>{let V;for(;S&&S!==O;)V=g(S),o(S,E,q),S=V;o(O,E,q)},f=({el:S,anchor:O})=>{let E;for(;S&&S!==O;)E=g(S),s(S),S=E;s(O)},x=(S,O,E,q,V,G,se,Z,ne)=>{O.type==="svg"?se="svg":O.type==="math"&&(se="mathml"),S==null?P(O,E,q,V,G,se,Z,ne):T(S,O,V,G,se,Z,ne)},P=(S,O,E,q,V,G,se,Z)=>{let ne,X;const{props:me,shapeFlag:le,transition:ve,dirs:we}=S;if(ne=S.el=i(S.type,G,me&&me.is,me),le&8?c(ne,S.children):le&16&&m(S.children,ne,null,q,V,Nr(S,G),se,Z),we&&Cn(S,null,q,"created"),j(ne,S,S.scopeId,se,q),me){for(const Ve in me)Ve!=="value"&&!Wo(Ve)&&r(ne,Ve,null,me[Ve],G,q);"value"in me&&r(ne,"value",null,me.value,G),(X=me.onVnodeBeforeMount)&&Pt(X,q,S)}we&&Cn(S,null,q,"beforeMount");const Te=Eg(V,ve);Te&&ve.beforeEnter(ne),o(ne,O,E),((X=me&&me.onVnodeMounted)||Te||we)&&ot(()=>{X&&Pt(X,q,S),Te&&ve.enter(ne),we&&Cn(S,null,q,"mounted")},V)},j=(S,O,E,q,V)=>{if(E&&b(S,E),q)for(let G=0;G<q.length;G++)b(S,q[G]);if(V){let G=V.subTree;if(O===G||Fs(G.type)&&(G.ssContent===O||G.ssFallback===O)){const se=V.vnode;j(S,se,se.scopeId,se.slotScopeIds,V.parent)}}},m=(S,O,E,q,V,G,se,Z,ne=0)=>{for(let X=ne;X<S.length;X++){const me=S[X]=Z?dn(S[X]):Wt(S[X]);w(null,me,O,E,q,V,G,se,Z)}},T=(S,O,E,q,V,G,se)=>{const Z=O.el=S.el;let{patchFlag:ne,dynamicChildren:X,dirs:me}=O;ne|=S.patchFlag&16;const le=S.props||Me,ve=O.props||Me;let we;if(E&&xn(E,!1),(we=ve.onVnodeBeforeUpdate)&&Pt(we,E,O,S),me&&Cn(O,S,E,"beforeUpdate"),E&&xn(E,!0),(le.innerHTML&&ve.innerHTML==null||le.textContent&&ve.textContent==null)&&c(Z,""),X?R(S.dynamicChildren,X,Z,E,q,Nr(O,V),G):se||C(S,O,Z,null,E,q,Nr(O,V),G,!1),ne>0){if(ne&16)B(Z,le,ve,E,V);else if(ne&2&&le.class!==ve.class&&r(Z,"class",null,ve.class,V),ne&4&&r(Z,"style",le.style,ve.style,V),ne&8){const Te=O.dynamicProps;for(let Ve=0;Ve<Te.length;Ve++){const Fe=Te[Ve],bt=le[Fe],gt=ve[Fe];(gt!==bt||Fe==="value")&&r(Z,Fe,bt,gt,V,E)}}ne&1&&S.children!==O.children&&c(Z,O.children)}else!se&&X==null&&B(Z,le,ve,E,V);((we=ve.onVnodeUpdated)||me)&&ot(()=>{we&&Pt(we,E,O,S),me&&Cn(O,S,E,"updated")},q)},R=(S,O,E,q,V,G,se)=>{for(let Z=0;Z<O.length;Z++){const ne=S[Z],X=O[Z],me=ne.el&&(ne.type===ae||!Tn(ne,X)||ne.shapeFlag&70)?d(ne.el):E;w(ne,X,me,null,q,V,G,se,!0)}},B=(S,O,E,q,V)=>{if(O!==E){if(O!==Me)for(const G in O)!Wo(G)&&!(G in E)&&r(S,G,O[G],null,V,q);for(const G in E){if(Wo(G))continue;const se=E[G],Z=O[G];se!==Z&&G!=="value"&&r(S,G,Z,se,V,q)}"value"in E&&r(S,"value",O.value,E.value,V)}},D=(S,O,E,q,V,G,se,Z,ne)=>{const X=O.el=S?S.el:l(""),me=O.anchor=S?S.anchor:l("");let{patchFlag:le,dynamicChildren:ve,slotScopeIds:we}=O;we&&(Z=Z?Z.concat(we):we),S==null?(o(X,E,q),o(me,E,q),m(O.children||[],E,me,V,G,se,Z,ne)):le>0&&le&64&&ve&&S.dynamicChildren?(R(S.dynamicChildren,ve,E,V,G,se,Z),(O.key!=null||V&&O===V.subTree)&&ia(S,O,!0)):C(S,O,E,me,V,G,se,Z,ne)},N=(S,O,E,q,V,G,se,Z,ne)=>{O.slotScopeIds=Z,S==null?O.shapeFlag&512?V.ctx.activate(O,E,q,se,ne):ee(O,E,q,V,G,se,ne):xe(S,O,ne)},ee=(S,O,E,q,V,G,se)=>{const Z=S.component=tv(S,q,V);if(na(S)&&(Z.ctx.renderer=U),nv(Z,!1,se),Z.asyncDep){if(V&&V.registerDep(Z,z,se),!S.el){const ne=Z.subTree=H(Xt);k(null,ne,O,E)}}else z(Z,S,O,E,V,G,se)},xe=(S,O,E)=>{const q=O.component=S.component;if(qg(S,O,E))if(q.asyncDep&&!q.asyncResolved){I(q,O,E);return}else q.next=O,q.update();else O.el=S.el,q.vnode=O},z=(S,O,E,q,V,G,se)=>{const Z=()=>{if(S.isMounted){let{next:le,bu:ve,u:we,parent:Te,vnode:Ve}=S;{const Ft=_f(S);if(Ft){le&&(le.el=Ve.el,I(S,le,se)),Ft.asyncDep.then(()=>{S.isUnmounted||Z()});return}}let Fe=le,bt;xn(S,!1),le?(le.el=Ve.el,I(S,le,se)):le=Ve,ve&&Qn(ve),(bt=le.props&&le.props.onVnodeBeforeUpdate)&&Pt(bt,Te,le,Ve),xn(S,!0);const gt=iu(S),Nt=S.subTree;S.subTree=gt,w(Nt,gt,d(Nt.el),Ce(Nt),S,V,G),le.el=gt.el,Fe===null&&zg(S,gt.el),we&&ot(we,V),(bt=le.props&&le.props.onVnodeUpdated)&&ot(()=>Pt(bt,Te,le,Ve),V)}else{let le;const{el:ve,props:we}=O,{bm:Te,m:Ve,parent:Fe,root:bt,type:gt}=S,Nt=$n(O);xn(S,!1),Te&&Qn(Te),!Nt&&(le=we&&we.onVnodeBeforeMount)&&Pt(le,Fe,O),xn(S,!0);{bt.ce&&bt.ce._injectChildStyle(gt);const Ft=S.subTree=iu(S);w(null,Ft,E,q,S,V,G),O.el=Ft.el}if(Ve&&ot(Ve,V),!Nt&&(le=we&&we.onVnodeMounted)){const Ft=O;ot(()=>Pt(le,Fe,Ft),V)}(O.shapeFlag&256||Fe&&$n(Fe.vnode)&&Fe.vnode.shapeFlag&256)&&S.a&&ot(S.a,V),S.isMounted=!0,O=E=q=null}};S.scope.on();const ne=S.effect=new Ed(Z);S.scope.off();const X=S.update=ne.run.bind(ne),me=S.job=ne.runIfDirty.bind(ne);me.i=S,me.id=S.uid,ne.scheduler=()=>ea(me),xn(S,!0),X()},I=(S,O,E)=>{O.component=S;const q=S.vnode.props;S.vnode=O,S.next=null,Ig(S,O.props,q,E),Rg(S,O.children,E),wn(),Ka(S),kn()},C=(S,O,E,q,V,G,se,Z,ne=!1)=>{const X=S&&S.children,me=S?S.shapeFlag:0,le=O.children,{patchFlag:ve,shapeFlag:we}=O;if(ve>0){if(ve&128){oe(X,le,E,q,V,G,se,Z,ne);return}else if(ve&256){A(X,le,E,q,V,G,se,Z,ne);return}}we&8?(me&16&&be(X,V,G),le!==X&&c(E,le)):me&16?we&16?oe(X,le,E,q,V,G,se,Z,ne):be(X,V,G,!0):(me&8&&c(E,""),we&16&&m(le,E,q,V,G,se,Z,ne))},A=(S,O,E,q,V,G,se,Z,ne)=>{S=S||Jn,O=O||Jn;const X=S.length,me=O.length,le=Math.min(X,me);let ve;for(ve=0;ve<le;ve++){const we=O[ve]=ne?dn(O[ve]):Wt(O[ve]);w(S[ve],we,E,null,V,G,se,Z,ne)}X>me?be(S,V,G,!0,!1,le):m(O,E,q,V,G,se,Z,ne,le)},oe=(S,O,E,q,V,G,se,Z,ne)=>{let X=0;const me=O.length;let le=S.length-1,ve=me-1;for(;X<=le&&X<=ve;){const we=S[X],Te=O[X]=ne?dn(O[X]):Wt(O[X]);if(Tn(we,Te))w(we,Te,E,null,V,G,se,Z,ne);else break;X++}for(;X<=le&&X<=ve;){const we=S[le],Te=O[ve]=ne?dn(O[ve]):Wt(O[ve]);if(Tn(we,Te))w(we,Te,E,null,V,G,se,Z,ne);else break;le--,ve--}if(X>le){if(X<=ve){const we=ve+1,Te=we<me?O[we].el:q;for(;X<=ve;)w(null,O[X]=ne?dn(O[X]):Wt(O[X]),E,Te,V,G,se,Z,ne),X++}}else if(X>ve)for(;X<=le;)Oe(S[X],V,G,!0),X++;else{const we=X,Te=X,Ve=new Map;for(X=Te;X<=ve;X++){const yt=O[X]=ne?dn(O[X]):Wt(O[X]);yt.key!=null&&Ve.set(yt.key,X)}let Fe,bt=0;const gt=ve-Te+1;let Nt=!1,Ft=0;const Oo=new Array(gt);for(X=0;X<gt;X++)Oo[X]=0;for(X=we;X<=le;X++){const yt=S[X];if(bt>=gt){Oe(yt,V,G,!0);continue}let Ht;if(yt.key!=null)Ht=Ve.get(yt.key);else for(Fe=Te;Fe<=ve;Fe++)if(Oo[Fe-Te]===0&&Tn(yt,O[Fe])){Ht=Fe;break}Ht===void 0?Oe(yt,V,G,!0):(Oo[Ht-Te]=X+1,Ht>=Ft?Ft=Ht:Nt=!0,w(yt,O[Ht],E,null,V,G,se,Z,ne),bt++)}const Wa=Nt?Dg(Oo):Jn;for(Fe=Wa.length-1,X=gt-1;X>=0;X--){const yt=Te+X,Ht=O[yt],qa=yt+1<me?O[yt+1].el:q;Oo[X]===0?w(null,Ht,E,qa,V,G,se,Z,ne):Nt&&(Fe<0||X!==Wa[Fe]?pe(Ht,E,qa,2):Fe--)}}},pe=(S,O,E,q,V=null)=>{const{el:G,type:se,transition:Z,children:ne,shapeFlag:X}=S;if(X&6){pe(S.component.subTree,O,E,q);return}if(X&128){S.suspense.move(O,E,q);return}if(X&64){se.move(S,O,E,U);return}if(se===ae){o(G,O,E);for(let le=0;le<ne.length;le++)pe(ne[le],O,E,q);o(S.anchor,O,E);return}if(se===Os){v(S,O,E);return}if(q!==2&&X&1&&Z)if(q===0)Z.beforeEnter(G),o(G,O,E),ot(()=>Z.enter(G),V);else{const{leave:le,delayLeave:ve,afterLeave:we}=Z,Te=()=>o(G,O,E),Ve=()=>{le(G,()=>{Te(),we&&we()})};ve?ve(G,Te,Ve):Ve()}else o(G,O,E)},Oe=(S,O,E,q=!1,V=!1)=>{const{type:G,props:se,ref:Z,children:ne,dynamicChildren:X,shapeFlag:me,patchFlag:le,dirs:ve,cacheIndex:we}=S;if(le===-2&&(V=!1),Z!=null&&Es(Z,null,E,S,!0),we!=null&&(O.renderCache[we]=void 0),me&256){O.ctx.deactivate(S);return}const Te=me&1&&ve,Ve=!$n(S);let Fe;if(Ve&&(Fe=se&&se.onVnodeBeforeUnmount)&&Pt(Fe,O,S),me&6)K(S.component,E,q);else{if(me&128){S.suspense.unmount(E,q);return}Te&&Cn(S,null,O,"beforeUnmount"),me&64?S.type.remove(S,O,E,U,q):X&&!X.hasOnce&&(G!==ae||le>0&&le&64)?be(X,O,E,!1,!0):(G===ae&&le&384||!V&&me&16)&&be(ne,O,E),q&&Ie(S)}(Ve&&(Fe=se&&se.onVnodeUnmounted)||Te)&&ot(()=>{Fe&&Pt(Fe,O,S),Te&&Cn(S,null,O,"unmounted")},E)},Ie=S=>{const{type:O,el:E,anchor:q,transition:V}=S;if(O===ae){tt(E,q);return}if(O===Os){f(S);return}const G=()=>{s(E),V&&!V.persisted&&V.afterLeave&&V.afterLeave()};if(S.shapeFlag&1&&V&&!V.persisted){const{leave:se,delayLeave:Z}=V,ne=()=>se(E,G);Z?Z(S.el,G,ne):ne()}else G()},tt=(S,O)=>{let E;for(;S!==O;)E=g(S),s(S),S=E;s(O)},K=(S,O,E)=>{const{bum:q,scope:V,job:G,subTree:se,um:Z,m:ne,a:X}=S;Ns(ne),Ns(X),q&&Qn(q),V.stop(),G&&(G.flags|=8,Oe(se,S,O,E)),Z&&ot(Z,O),ot(()=>{S.isUnmounted=!0},O),O&&O.pendingBranch&&!O.isUnmounted&&S.asyncDep&&!S.asyncResolved&&S.suspenseId===O.pendingId&&(O.deps--,O.deps===0&&O.resolve())},be=(S,O,E,q=!1,V=!1,G=0)=>{for(let se=G;se<S.length;se++)Oe(S[se],O,E,q,V)},Ce=S=>{if(S.shapeFlag&6)return Ce(S.component.subTree);if(S.shapeFlag&128)return S.suspense.next();const O=g(S.anchor||S.el),E=O&&O[of];return E?g(E):O};let Ae=!1;const J=(S,O,E)=>{S==null?O._vnode&&Oe(O._vnode,null,null,!0):w(O._vnode||null,S,O,null,null,null,E),O._vnode=S,Ae||(Ae=!0,Ka(),ef(),Ae=!1)},U={p:w,um:Oe,m:pe,r:Ie,mt:ee,mc:m,pc:C,pbc:R,n:Ce,o:t};return{render:J,hydrate:void 0,createApp:Pg(J)}}function Nr({type:t,props:e},n){return n==="svg"&&t==="foreignObject"||n==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function xn({effect:t,job:e},n){n?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function Eg(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function ia(t,e,n=!1){const o=t.children,s=e.children;if(ge(o)&&ge(s))for(let r=0;r<o.length;r++){const i=o[r];let l=s[r];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=s[r]=dn(s[r]),l.el=i.el),!n&&l.patchFlag!==-2&&ia(i,l)),l.type===vr&&(l.el=i.el)}}function Dg(t){const e=t.slice(),n=[0];let o,s,r,i,l;const a=t.length;for(o=0;o<a;o++){const u=t[o];if(u!==0){if(s=n[n.length-1],t[s]<u){e[o]=s,n.push(o);continue}for(r=0,i=n.length-1;r<i;)l=r+i>>1,t[n[l]]<u?r=l+1:i=l;u<t[n[r]]&&(r>0&&(e[o]=n[r-1]),n[r]=o)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=e[i];return n}function _f(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:_f(e)}function Ns(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const Lg=Symbol.for("v-scx"),Ng=()=>Yo(Lg);function Fg(t,e){return la(t,null,{flush:"sync"})}function ze(t,e,n){return la(t,e,n)}function la(t,e,n=Me){const{immediate:o,deep:s,flush:r,once:i}=n,l=nt({},n),a=e&&o||!e&&r!=="post";let u;if(io){if(r==="sync"){const b=Ng();u=b.__watcherHandles||(b.__watcherHandles=[])}else if(!a){const b=()=>{};return b.stop=Gt,b.resume=Gt,b.pause=Gt,b}}const c=it;l.call=(b,y,w)=>Dt(b,c,y,w);let d=!1;r==="post"?l.scheduler=b=>{ot(b,c&&c.suspense)}:r!=="sync"&&(d=!0,l.scheduler=(b,y)=>{y?b():ea(b)}),l.augmentJob=b=>{e&&(b.flags|=4),d&&(b.flags|=2,c&&(b.id=c.uid,b.i=c))};const g=Qh(t,e,l);return io&&(u?u.push(g):a&&g()),g}function Hg(t,e,n){const o=this.proxy,s=Ke(t)?t.includes(".")?Pf(o,t):()=>o[t]:t.bind(o,o);let r;ke(e)?r=e:(r=e.handler,n=e);const i=ds(this),l=la(s,r.bind(o),n);return i(),l}function Pf(t,e){const n=e.split(".");return()=>{let o=t;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}function cs(t,e,n=Me){const o=ua(),s=nn(e),r=on(e),i=Of(t,s),l=Yh((a,u)=>{let c,d=Me,g;return Fg(()=>{const b=t[s];vt(c,b)&&(c=b,u())}),{get(){return a(),n.get?n.get(c):c},set(b){const y=n.set?n.set(b):b;if(!vt(y,c)&&!(d!==Me&&vt(b,d)))return;const w=o.vnode.props;w&&(e in w||s in w||r in w)&&(`onUpdate:${e}`in w||`onUpdate:${s}`in w||`onUpdate:${r}`in w)||(c=b,u()),o.emit(`update:${e}`,y),vt(b,y)&&vt(b,d)&&!vt(y,g)&&u(),d=b,g=y}}});return l[Symbol.iterator]=()=>{let a=0;return{next(){return a<2?{value:a++?i||Me:l,done:!1}:{done:!0}}}},l}const Of=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${nn(e)}Modifiers`]||t[`${on(e)}Modifiers`];function Ug(t,e,...n){if(t.isUnmounted)return;const o=t.vnode.props||Me;let s=n;const r=e.startsWith("update:"),i=r&&Of(o,e.slice(7));i&&(i.trim&&(s=n.map(c=>Ke(c)?c.trim():c)),i.number&&(s=n.map(As)));let l,a=o[l=$r(e)]||o[l=$r(nn(e))];!a&&r&&(a=o[l=$r(on(e))]),a&&Dt(a,t,6,s);const u=o[l+"Once"];if(u){if(!t.emitted)t.emitted={};else if(t.emitted[l])return;t.emitted[l]=!0,Dt(u,t,6,s)}}function Tf(t,e,n=!1){const o=e.emitsCache,s=o.get(t);if(s!==void 0)return s;const r=t.emits;let i={},l=!1;if(!ke(t)){const a=u=>{const c=Tf(u,e,!0);c&&(l=!0,nt(i,c))};!n&&e.mixins.length&&e.mixins.forEach(a),t.extends&&a(t.extends),t.mixins&&t.mixins.forEach(a)}return!r&&!l?(Ue(t)&&o.set(t,null),null):(ge(r)?r.forEach(a=>i[a]=null):nt(i,r),Ue(t)&&o.set(t,i),i)}function gr(t,e){return!t||!ur(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ee(t,e[0].toLowerCase()+e.slice(1))||Ee(t,on(e))||Ee(t,e))}function iu(t){const{type:e,vnode:n,proxy:o,withProxy:s,propsOptions:[r],slots:i,attrs:l,emit:a,render:u,renderCache:c,props:d,data:g,setupState:b,ctx:y,inheritAttrs:w}=t,_=Bs(t);let k,h;try{if(n.shapeFlag&4){const f=s||o,x=f;k=Wt(u.call(x,f,c,d,b,g,y)),h=l}else{const f=e;k=Wt(f.length>1?f(d,{attrs:l,slots:i,emit:a}):f(d,null)),h=e.props?l:Vg(l)}}catch(f){Ko.length=0,us(f,t,1),k=H(Xt)}let v=k;if(h&&w!==!1){const f=Object.keys(h),{shapeFlag:x}=v;f.length&&x&7&&(r&&f.some(Wl)&&(h=Wg(h,r)),v=bn(v,h,!1,!0))}return n.dirs&&(v=bn(v,null,!1,!0),v.dirs=v.dirs?v.dirs.concat(n.dirs):n.dirs),n.transition&&so(v,n.transition),k=v,Bs(_),k}const Vg=t=>{let e;for(const n in t)(n==="class"||n==="style"||ur(n))&&((e||(e={}))[n]=t[n]);return e},Wg=(t,e)=>{const n={};for(const o in t)(!Wl(o)||!(o.slice(9)in e))&&(n[o]=t[o]);return n};function qg(t,e,n){const{props:o,children:s,component:r}=t,{props:i,children:l,patchFlag:a}=e,u=r.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&a>=0){if(a&1024)return!0;if(a&16)return o?lu(o,i,u):!!i;if(a&8){const c=e.dynamicProps;for(let d=0;d<c.length;d++){const g=c[d];if(i[g]!==o[g]&&!gr(u,g))return!0}}}else return(s||l)&&(!l||!l.$stable)?!0:o===i?!1:o?i?lu(o,i,u):!0:!!i;return!1}function lu(t,e,n){const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!0;for(let s=0;s<o.length;s++){const r=o[s];if(e[r]!==t[r]&&!gr(n,r))return!0}return!1}function zg({vnode:t,parent:e},n){for(;e;){const o=e.subTree;if(o.suspense&&o.suspense.activeBranch===t&&(o.el=t.el),o===t)(t=e.vnode).el=n,e=e.parent;else break}}const Fs=t=>t.__isSuspense;function Gg(t,e){e&&e.pendingBranch?ge(t)?e.effects.push(...t):e.effects.push(t):ng(t)}const ae=Symbol.for("v-fgt"),vr=Symbol.for("v-txt"),Xt=Symbol.for("v-cmt"),Os=Symbol.for("v-stc"),Ko=[];let Ct=null;function $(t=!1){Ko.push(Ct=t?null:[])}function Xg(){Ko.pop(),Ct=Ko[Ko.length-1]||null}let ns=1;function au(t,e=!1){ns+=t,t<0&&Ct&&e&&(Ct.hasOnce=!0)}function If(t){return t.dynamicChildren=ns>0?Ct||Jn:null,Xg(),ns>0&&Ct&&Ct.push(t),t}function F(t,e,n,o,s,r){return If(p(t,e,n,o,s,r,!0))}function de(t,e,n,o,s){return If(H(t,e,n,o,s,!0))}function ro(t){return t?t.__v_isVNode===!0:!1}function Tn(t,e){return t.type===e.type&&t.key===e.key}const jf=({key:t})=>t??null,Ts=({ref:t,ref_key:e,ref_for:n})=>(typeof t=="number"&&(t=""+t),t!=null?Ke(t)||ye(t)||ke(t)?{i:lt,r:t,k:e,f:!!n}:t:null);function p(t,e=null,n=null,o=0,s=null,r=t===ae?0:1,i=!1,l=!1){const a={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&jf(e),ref:e&&Ts(e),scopeId:nf,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:lt};return l?(aa(a,n),r&128&&t.normalize(a)):n&&(a.shapeFlag|=Ke(n)?8:16),ns>0&&!i&&Ct&&(a.patchFlag>0||r&6)&&a.patchFlag!==32&&Ct.push(a),a}const H=Yg;function Yg(t,e=null,n=null,o=0,s=null,r=!1){if((!t||t===bg)&&(t=Xt),ro(t)){const l=bn(t,e,!0);return n&&aa(l,n),ns>0&&!r&&Ct&&(l.shapeFlag&6?Ct[Ct.indexOf(t)]=l:Ct.push(l)),l.patchFlag=-2,l}if(iv(t)&&(t=t.__vccOpts),e){e=Kg(e);let{class:l,style:a}=e;l&&!Ke(l)&&(e.class=Le(l)),Ue(a)&&(Ql(a)&&!ge(a)&&(a=nt({},a)),e.style=Qe(a))}const i=Ke(t)?1:Fs(t)?128:og(t)?64:Ue(t)?4:ke(t)?2:0;return p(t,e,n,o,s,i,r,!0)}function Kg(t){return t?Ql(t)||bf(t)?nt({},t):t:null}function bn(t,e,n=!1,o=!1){const{props:s,ref:r,patchFlag:i,children:l,transition:a}=t,u=e?Zg(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:t.type,props:u,key:u&&jf(u),ref:e&&e.ref?n&&r?ge(r)?r.concat(Ts(e)):[r,Ts(e)]:Ts(e):r,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ae?i===-1?16:i|16:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:a,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&bn(t.ssContent),ssFallback:t.ssFallback&&bn(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return a&&o&&so(c,a.clone(c)),c}function Y(t=" ",e=0){return H(vr,null,t,e)}function Jg(t,e){const n=H(Os,null,t);return n.staticCount=e,n}function fe(t="",e=!1){return e?($(),de(Xt,null,t)):H(Xt,null,t)}function Wt(t){return t==null||typeof t=="boolean"?H(Xt):ge(t)?H(ae,null,t.slice()):ro(t)?dn(t):H(vr,null,String(t))}function dn(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:bn(t)}function aa(t,e){let n=0;const{shapeFlag:o}=t;if(e==null)e=null;else if(ge(e))n=16;else if(typeof e=="object")if(o&65){const s=e.default;s&&(s._c&&(s._d=!1),aa(t,s()),s._c&&(s._d=!0));return}else{n=32;const s=e._;!s&&!bf(e)?e._ctx=lt:s===3&&lt&&(lt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else ke(e)?(e={default:e,_ctx:lt},n=32):(e=String(e),o&64?(n=16,e=[Y(e)]):n=8);t.children=e,t.shapeFlag|=n}function Zg(...t){const e={};for(let n=0;n<t.length;n++){const o=t[n];for(const s in o)if(s==="class")e.class!==o.class&&(e.class=Le([e.class,o.class]));else if(s==="style")e.style=Qe([e.style,o.style]);else if(ur(s)){const r=e[s],i=o[s];i&&r!==i&&!(ge(r)&&r.includes(i))&&(e[s]=r?[].concat(r,i):i)}else s!==""&&(e[s]=o[s])}return e}function Pt(t,e,n,o=null){Dt(t,e,7,[n,o])}const Qg=gf();let ev=0;function tv(t,e,n){const o=t.type,s=(e?e.appContext:t.appContext)||Qg,r={uid:ev++,vnode:t,type:o,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Bd(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:wf(o,s),emitsOptions:Tf(o,s),emit:null,emitted:null,propsDefaults:Me,inheritAttrs:o.inheritAttrs,ctx:Me,data:Me,props:Me,attrs:Me,slots:Me,refs:Me,setupState:Me,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=Ug.bind(null,r),t.ce&&t.ce(r),r}let it=null;const ua=()=>it||lt;let Hs,Cl;{const t=dr(),e=(n,o)=>{let s;return(s=t[n])||(s=t[n]=[]),s.push(o),r=>{s.length>1?s.forEach(i=>i(r)):s[0](r)}};Hs=e("__VUE_INSTANCE_SETTERS__",n=>it=n),Cl=e("__VUE_SSR_SETTERS__",n=>io=n)}const ds=t=>{const e=it;return Hs(t),t.scope.on(),()=>{t.scope.off(),Hs(e)}},uu=()=>{it&&it.scope.off(),Hs(null)};function $f(t){return t.vnode.shapeFlag&4}let io=!1;function nv(t,e=!1,n=!1){e&&Cl(e);const{props:o,children:s}=t.vnode,r=$f(t);Tg(t,o,r,e),Ag(t,s,n);const i=r?ov(t,e):void 0;return e&&Cl(!1),i}function ov(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,yg);const{setup:o}=n;if(o){wn();const s=t.setupContext=o.length>1?rv(t):null,r=ds(t),i=as(o,t,0,[t.props,s]),l=Od(i);if(kn(),r(),(l||t.sp)&&!$n(t)&&ta(t),l){if(i.then(uu,uu),e)return i.then(a=>{cu(t,a)}).catch(a=>{us(a,t,0)});t.asyncDep=i}else cu(t,i)}else Af(t)}function cu(t,e,n){ke(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Ue(e)&&(t.setupState=Jd(e)),Af(t)}function Af(t,e,n){const o=t.type;t.render||(t.render=o.render||Gt);{const s=ds(t);wn();try{wg(t)}finally{kn(),s()}}}const sv={get(t,e){return ut(t,"get",""),t[e]}};function rv(t){const e=n=>{t.exposed=n||{}};return{attrs:new Proxy(t.attrs,sv),slots:t.slots,emit:t.emit,expose:e}}function mr(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(Jd(Wh(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in Xo)return Xo[n](t)},has(e,n){return n in e||n in Xo}})):t.proxy}function du(t,e=!0){return ke(t)?t.displayName||t.name:t.name||e&&t.__name}function iv(t){return ke(t)&&"__vccOpts"in t}const M=(t,e)=>Jh(t,e,io);function fu(t,e,n){const o=arguments.length;return o===2?Ue(e)&&!ge(e)?ro(e)?H(t,null,[e]):H(t,e):H(t,null,e):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&ro(n)&&(n=[n]),H(t,e,n))}const lv="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let xl;const pu=typeof window<"u"&&window.trustedTypes;if(pu)try{xl=pu.createPolicy("vue",{createHTML:t=>t})}catch{}const Rf=xl?t=>xl.createHTML(t):t=>t,av="http://www.w3.org/2000/svg",uv="http://www.w3.org/1998/Math/MathML",Jt=typeof document<"u"?document:null,hu=Jt&&Jt.createElement("template"),cv={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,o)=>{const s=e==="svg"?Jt.createElementNS(av,t):e==="mathml"?Jt.createElementNS(uv,t):n?Jt.createElement(t,{is:n}):Jt.createElement(t);return t==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:t=>Jt.createTextNode(t),createComment:t=>Jt.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Jt.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,o,s,r){const i=n?n.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),n),!(s===r||!(s=s.nextSibling)););else{hu.innerHTML=Rf(o==="svg"?`<svg>${t}</svg>`:o==="mathml"?`<math>${t}</math>`:t);const l=hu.content;if(o==="svg"||o==="mathml"){const a=l.firstChild;for(;a.firstChild;)l.appendChild(a.firstChild);l.removeChild(a)}e.insertBefore(l,n)}return[i?i.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},rn="transition",Io="animation",lo=Symbol("_vtc"),Mf={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},dv=nt({},ig,Mf),Sn=(t,e=[])=>{ge(t)?t.forEach(n=>n(...e)):t&&t(...e)},gu=t=>t?ge(t)?t.some(e=>e.length>1):t.length>1:!1;function fv(t){const e={};for(const D in t)D in Mf||(e[D]=t[D]);if(t.css===!1)return e;const{name:n="v",type:o,duration:s,enterFromClass:r=`${n}-enter-from`,enterActiveClass:i=`${n}-enter-active`,enterToClass:l=`${n}-enter-to`,appearFromClass:a=r,appearActiveClass:u=i,appearToClass:c=l,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:g=`${n}-leave-active`,leaveToClass:b=`${n}-leave-to`}=t,y=pv(s),w=y&&y[0],_=y&&y[1],{onBeforeEnter:k,onEnter:h,onEnterCancelled:v,onLeave:f,onLeaveCancelled:x,onBeforeAppear:P=k,onAppear:j=h,onAppearCancelled:m=v}=e,T=(D,N,ee,xe)=>{D._enterCancelled=xe,un(D,N?c:l),un(D,N?u:i),ee&&ee()},R=(D,N)=>{D._isLeaving=!1,un(D,d),un(D,b),un(D,g),N&&N()},B=D=>(N,ee)=>{const xe=D?j:h,z=()=>T(N,D,ee);Sn(xe,[N,z]),vu(()=>{un(N,D?a:r),Ut(N,D?c:l),gu(xe)||mu(N,o,w,z)})};return nt(e,{onBeforeEnter(D){Sn(k,[D]),Ut(D,r),Ut(D,i)},onBeforeAppear(D){Sn(P,[D]),Ut(D,a),Ut(D,u)},onEnter:B(!1),onAppear:B(!0),onLeave(D,N){D._isLeaving=!0;const ee=()=>R(D,N);Ut(D,d),D._enterCancelled?(Ut(D,g),Sl()):(Sl(),Ut(D,g)),vu(()=>{D._isLeaving&&(un(D,d),Ut(D,b),gu(f)||mu(D,o,_,ee))}),Sn(f,[D,ee])},onEnterCancelled(D){T(D,!1,void 0,!0),Sn(v,[D])},onAppearCancelled(D){T(D,!0,void 0,!0),Sn(m,[D])},onLeaveCancelled(D){R(D),Sn(x,[D])}})}function pv(t){if(t==null)return null;if(Ue(t))return[Fr(t.enter),Fr(t.leave)];{const e=Fr(t);return[e,e]}}function Fr(t){return gh(t)}function Ut(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.add(n)),(t[lo]||(t[lo]=new Set)).add(e)}function un(t,e){e.split(/\s+/).forEach(o=>o&&t.classList.remove(o));const n=t[lo];n&&(n.delete(e),n.size||(t[lo]=void 0))}function vu(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let hv=0;function mu(t,e,n,o){const s=t._endId=++hv,r=()=>{s===t._endId&&o()};if(n!=null)return setTimeout(r,n);const{type:i,timeout:l,propCount:a}=Bf(t,e);if(!i)return o();const u=i+"end";let c=0;const d=()=>{t.removeEventListener(u,g),r()},g=b=>{b.target===t&&++c>=a&&d()};setTimeout(()=>{c<a&&d()},l+1),t.addEventListener(u,g)}function Bf(t,e){const n=window.getComputedStyle(t),o=y=>(n[y]||"").split(", "),s=o(`${rn}Delay`),r=o(`${rn}Duration`),i=bu(s,r),l=o(`${Io}Delay`),a=o(`${Io}Duration`),u=bu(l,a);let c=null,d=0,g=0;e===rn?i>0&&(c=rn,d=i,g=r.length):e===Io?u>0&&(c=Io,d=u,g=a.length):(d=Math.max(i,u),c=d>0?i>u?rn:Io:null,g=c?c===rn?r.length:a.length:0);const b=c===rn&&/\b(transform|all)(,|$)/.test(o(`${rn}Property`).toString());return{type:c,timeout:d,propCount:g,hasTransform:b}}function bu(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((n,o)=>yu(n)+yu(t[o])))}function yu(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function Sl(){return document.body.offsetHeight}function gv(t,e,n){const o=t[lo];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}const wu=Symbol("_vod"),vv=Symbol("_vsh"),mv=Symbol(""),bv=/(^|;)\s*display\s*:/;function yv(t,e,n){const o=t.style,s=Ke(n);let r=!1;if(n&&!s){if(e)if(Ke(e))for(const i of e.split(";")){const l=i.slice(0,i.indexOf(":")).trim();n[l]==null&&Is(o,l,"")}else for(const i in e)n[i]==null&&Is(o,i,"");for(const i in n)i==="display"&&(r=!0),Is(o,i,n[i])}else if(s){if(e!==n){const i=o[mv];i&&(n+=";"+i),o.cssText=n,r=bv.test(n)}}else e&&t.removeAttribute("style");wu in t&&(t[wu]=r?o.display:"",t[vv]&&(o.display="none"))}const ku=/\s*!important$/;function Is(t,e,n){if(ge(n))n.forEach(o=>Is(t,e,o));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const o=wv(t,e);ku.test(n)?t.setProperty(on(o),n.replace(ku,""),"important"):t[o]=n}}const Cu=["Webkit","Moz","ms"],Hr={};function wv(t,e){const n=Hr[e];if(n)return n;let o=nn(e);if(o!=="filter"&&o in t)return Hr[e]=o;o=jd(o);for(let s=0;s<Cu.length;s++){const r=Cu[s]+o;if(r in t)return Hr[e]=r}return e}const xu="http://www.w3.org/1999/xlink";function Su(t,e,n,o,s,r=kh(e)){o&&e.startsWith("xlink:")?n==null?t.removeAttributeNS(xu,e.slice(6,e.length)):t.setAttributeNS(xu,e,n):n==null||r&&!Ad(n)?t.removeAttribute(e):t.setAttribute(e,r?"":Et(n)?String(n):n)}function _u(t,e,n,o,s){if(e==="innerHTML"||e==="textContent"){n!=null&&(t[e]=e==="innerHTML"?Rf(n):n);return}const r=t.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const l=r==="OPTION"?t.getAttribute("value")||"":t.value,a=n==null?t.type==="checkbox"?"on":"":String(n);(l!==a||!("_value"in t))&&(t.value=a),n==null&&t.removeAttribute(e),t._value=n;return}let i=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=Ad(n):n==null&&l==="string"?(n="",i=!0):l==="number"&&(n=0,i=!0)}try{t[e]=n}catch{}i&&t.removeAttribute(s||e)}function pn(t,e,n,o){t.addEventListener(e,n,o)}function kv(t,e,n,o){t.removeEventListener(e,n,o)}const Pu=Symbol("_vei");function Cv(t,e,n,o,s=null){const r=t[Pu]||(t[Pu]={}),i=r[e];if(o&&i)i.value=o;else{const[l,a]=xv(e);if(o){const u=r[e]=Pv(o,s);pn(t,l,u,a)}else i&&(kv(t,l,i,a),r[e]=void 0)}}const Ou=/(?:Once|Passive|Capture)$/;function xv(t){let e;if(Ou.test(t)){e={};let o;for(;o=t.match(Ou);)t=t.slice(0,t.length-o[0].length),e[o[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):on(t.slice(2)),e]}let Ur=0;const Sv=Promise.resolve(),_v=()=>Ur||(Sv.then(()=>Ur=0),Ur=Date.now());function Pv(t,e){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;Dt(Ov(o,n.value),e,5,[o])};return n.value=t,n.attached=_v(),n}function Ov(t,e){if(ge(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(o=>s=>!s._stopped&&o&&o(s))}else return e}const Tu=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,Tv=(t,e,n,o,s,r)=>{const i=s==="svg";e==="class"?gv(t,o,i):e==="style"?yv(t,n,o):ur(e)?Wl(e)||Cv(t,e,n,o,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):Iv(t,e,o,i))?(_u(t,e,o),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Su(t,e,o,i,r,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!Ke(o))?_u(t,nn(e),o,r,e):(e==="true-value"?t._trueValue=o:e==="false-value"&&(t._falseValue=o),Su(t,e,o,i))};function Iv(t,e,n,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in t&&Tu(e)&&ke(n));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=t.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Tu(e)&&Ke(n)?!1:e in t}const Ef=new WeakMap,Df=new WeakMap,Us=Symbol("_moveCb"),Iu=Symbol("_enterCb"),jv=t=>(delete t.props.mode,t),$v=jv({name:"TransitionGroup",props:nt({},dv,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=ua(),o=rg();let s,r;return oa(()=>{if(!s.length)return;const i=t.moveClass||`${t.name||"v"}-move`;if(!Bv(s[0].el,n.vnode.el,i))return;s.forEach(Av),s.forEach(Rv);const l=s.filter(Mv);Sl(),l.forEach(a=>{const u=a.el,c=u.style;Ut(u,i),c.transform=c.webkitTransform=c.transitionDuration="";const d=u[Us]=g=>{g&&g.target!==u||(!g||/transform$/.test(g.propertyName))&&(u.removeEventListener("transitionend",d),u[Us]=null,un(u,i))};u.addEventListener("transitionend",d)})}),()=>{const i=Re(t),l=fv(i);let a=i.tag||ae;if(s=[],r)for(let u=0;u<r.length;u++){const c=r[u];c.el&&c.el instanceof Element&&(s.push(c),so(c,ml(c,l,o,n)),Ef.set(c,c.el.getBoundingClientRect()))}r=e.default?af(e.default()):[];for(let u=0;u<r.length;u++){const c=r[u];c.key!=null&&so(c,ml(c,l,o,n))}return H(a,null,r)}}}),ZS=$v;function Av(t){const e=t.el;e[Us]&&e[Us](),e[Iu]&&e[Iu]()}function Rv(t){Df.set(t,t.el.getBoundingClientRect())}function Mv(t){const e=Ef.get(t),n=Df.get(t),o=e.left-n.left,s=e.top-n.top;if(o||s){const r=t.el.style;return r.transform=r.webkitTransform=`translate(${o}px,${s}px)`,r.transitionDuration="0s",t}}function Bv(t,e,n){const o=t.cloneNode(),s=t[lo];s&&s.forEach(l=>{l.split(/\s+/).forEach(a=>a&&o.classList.remove(a))}),n.split(/\s+/).forEach(l=>l&&o.classList.add(l)),o.style.display="none";const r=e.nodeType===1?e:e.parentNode;r.appendChild(o);const{hasTransform:i}=Bf(o);return r.removeChild(o),i}const ao=t=>{const e=t.props["onUpdate:modelValue"]||!1;return ge(e)?n=>Qn(e,n):e};function Ev(t){t.target.composing=!0}function ju(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const tn=Symbol("_assign"),Ye={created(t,{modifiers:{lazy:e,trim:n,number:o}},s){t[tn]=ao(s);const r=o||s.props&&s.props.type==="number";pn(t,e?"change":"input",i=>{if(i.target.composing)return;let l=t.value;n&&(l=l.trim()),r&&(l=As(l)),t[tn](l)}),n&&pn(t,"change",()=>{t.value=t.value.trim()}),e||(pn(t,"compositionstart",Ev),pn(t,"compositionend",ju),pn(t,"change",ju))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,oldValue:n,modifiers:{lazy:o,trim:s,number:r}},i){if(t[tn]=ao(i),t.composing)return;const l=(r||t.type==="number")&&!/^0\d/.test(t.value)?As(t.value):t.value,a=e??"";l!==a&&(document.activeElement===t&&t.type!=="range"&&(o&&e===n||s&&t.value.trim()===a)||(t.value=a))}},Dv={deep:!0,created(t,e,n){t[tn]=ao(n),pn(t,"change",()=>{const o=t._modelValue,s=os(t),r=t.checked,i=t[tn];if(ge(o)){const l=Gl(o,s),a=l!==-1;if(r&&!a)i(o.concat(s));else if(!r&&a){const u=[...o];u.splice(l,1),i(u)}}else if(yo(o)){const l=new Set(o);r?l.add(s):l.delete(s),i(l)}else i(Lf(t,r))})},mounted:$u,beforeUpdate(t,e,n){t[tn]=ao(n),$u(t,e,n)}};function $u(t,{value:e,oldValue:n},o){t._modelValue=e;let s;if(ge(e))s=Gl(e,o.props.value)>-1;else if(yo(e))s=e.has(o.props.value);else{if(e===n)return;s=ls(e,Lf(t,!0))}t.checked!==s&&(t.checked=s)}const xt={deep:!0,created(t,{value:e,modifiers:{number:n}},o){const s=yo(e);pn(t,"change",()=>{const r=Array.prototype.filter.call(t.options,i=>i.selected).map(i=>n?As(os(i)):os(i));t[tn](t.multiple?s?new Set(r):r:r[0]),t._assigning=!0,hn(()=>{t._assigning=!1})}),t[tn]=ao(o)},mounted(t,{value:e}){Au(t,e)},beforeUpdate(t,e,n){t[tn]=ao(n)},updated(t,{value:e}){t._assigning||Au(t,e)}};function Au(t,e){const n=t.multiple,o=ge(e);if(!(n&&!o&&!yo(e))){for(let s=0,r=t.options.length;s<r;s++){const i=t.options[s],l=os(i);if(n)if(o){const a=typeof l;a==="string"||a==="number"?i.selected=e.some(u=>String(u)===String(l)):i.selected=Gl(e,l)>-1}else i.selected=e.has(l);else if(ls(os(i),e)){t.selectedIndex!==s&&(t.selectedIndex=s);return}}!n&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function os(t){return"_value"in t?t._value:t.value}function Lf(t,e){const n=e?"_trueValue":"_falseValue";return n in t?t[n]:e}const Lv=["ctrl","shift","alt","meta"],Nv={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>Lv.some(n=>t[`${n}Key`]&&!e.includes(n))},ce=(t,e)=>{const n=t._withMods||(t._withMods={}),o=e.join(".");return n[o]||(n[o]=(s,...r)=>{for(let i=0;i<e.length;i++){const l=Nv[e[i]];if(l&&l(s,e))return}return t(s,...r)})},Fv={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},st=(t,e)=>{const n=t._withKeys||(t._withKeys={}),o=e.join(".");return n[o]||(n[o]=s=>{if(!("key"in s))return;const r=on(s.key);if(e.some(i=>i===r||Fv[i]===r))return t(s)})},Hv=nt({patchProp:Tv},cv);let Ru;function Uv(){return Ru||(Ru=Mg(Hv))}const Vv=(...t)=>{const e=Uv().createApp(...t),{mount:n}=e;return e.mount=o=>{const s=qv(o);if(!s)return;const r=e._component;!ke(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=n(s,!1,Wv(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},e};function Wv(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function qv(t){return Ke(t)?document.querySelector(t):t}const zv="modulepreload",Gv=function(t,e){return new URL(t,e).href},Mu={},Bu=function(e,n,o){let s=Promise.resolve();if(n&&n.length>0){let i=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const l=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=i(n.map(c=>{if(c=Gv(c,o),c in Mu)return;Mu[c]=!0;const d=c.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!o)for(let w=l.length-1;w>=0;w--){const _=l[w];if(_.href===c&&(!d||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${g}`))return;const y=document.createElement("link");if(y.rel=d?"stylesheet":zv,d||(y.as="script"),y.crossOrigin="",y.href=c,u&&y.setAttribute("nonce",u),document.head.appendChild(y),d)return new Promise((w,_)=>{y.addEventListener("load",w),y.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};function Xv(t){return{all:t=t||new Map,on:function(e,n){var o=t.get(e);o?o.push(n):t.set(e,[n])},off:function(e,n){var o=t.get(e);o&&(n?o.splice(o.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var o=t.get(e);o&&o.slice().map(function(s){s(n)}),(o=t.get("*"))&&o.slice().map(function(s){s(e,n)})}}}const Vr=Xv(),$e={fire(t){Vr.emit(t.kind,t)},subscribe(t,e){Vr.on(t.kind,e)},unsubscribe(t,e){Vr.off(t.kind,e)}};class Vs{constructor(e){L(this,"kind","AssetFailureEvent");this.path=e}}L(Vs,"kind","AssetFailureEvent");class uo{constructor(e){L(this,"kind","FailureEvent");this.message=e}}L(uo,"kind","FailureEvent");class Nf{constructor(e){L(this,"kind","CustomAssetFailureEvent");this.error=e}}L(Nf,"kind","CustomAssetFailureEvent");class br{constructor(){L(this,"kind","InvalidateRenderEvent")}}L(br,"kind","InvalidateRenderEvent");const rr=class rr{constructor(){L(this,"kind",rr.kind)}};L(rr,"kind","RenderUpdatedEvent");let Ws=rr;const ir=class ir{constructor(){L(this,"kind",ir.kind)}};L(ir,"kind","StateLoadingEvent");let qs=ir;class Ot{constructor(e){L(this,"kind","ShowMessageEvent");this.message=e}}L(Ot,"kind","ShowMessageEvent");class ca{constructor(e,n){L(this,"kind","ResolvableErrorEvent");this.message=e,this.actions=n}}L(ca,"kind","ResolvableErrorEvent");class zs{constructor(e){L(this,"kind","ColorPickedEvent");this.color=e}}L(zs,"kind","ColorPickedEvent");class Ff{constructor(e,n){L(this,"kind","VueErrorEvent");this.error=e,this.info=n}}L(Ff,"kind","VueErrorEvent");const Yv="./",da="/dddg-assets/v2/assets/",ft=`${Yv}packs/`,fa=!0,pa={"dddg.buildin.backgrounds.nsfw":`${ft}buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${ft}buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${ft}buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${ft}buildin.base.yuri.nsfw.json`},Kv=new Set(Object.keys(pa)),Jv=Object.values(pa);function Zv(){return Hf().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Hf(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const Qv=typeof Proxy=="function",em="devtools-plugin:setup",tm="plugin:settings:set";let Hn,_l;function nm(){var t;return Hn!==void 0||(typeof window<"u"&&window.performance?(Hn=!0,_l=window.performance):typeof globalThis<"u"&&(!((t=globalThis.perf_hooks)===null||t===void 0)&&t.performance)?(Hn=!0,_l=globalThis.perf_hooks.performance):Hn=!1),Hn}function om(){return nm()?_l.now():Date.now()}class sm{constructor(e,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=n;const o={};if(e.settings)for(const i in e.settings){const l=e.settings[i];o[i]=l.defaultValue}const s=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},o);try{const i=localStorage.getItem(s),l=JSON.parse(i);Object.assign(r,l)}catch{}this.fallbacks={getSettings(){return r},setSettings(i){try{localStorage.setItem(s,JSON.stringify(i))}catch{}r=i},now(){return om()}},n&&n.on(tm,(i,l)=>{i===this.plugin.id&&this.fallbacks.setSettings(l)}),this.proxiedOn=new Proxy({},{get:(i,l)=>this.target?this.target.on[l]:(...a)=>{this.onQueue.push({method:l,args:a})}}),this.proxiedTarget=new Proxy({},{get:(i,l)=>this.target?this.target[l]:l==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(l)?(...a)=>(this.targetQueue.push({method:l,args:a,resolve:()=>{}}),this.fallbacks[l](...a)):(...a)=>new Promise(u=>{this.targetQueue.push({method:l,args:a,resolve:u})})})}async setRealTarget(e){this.target=e;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(await this.target[n.method](...n.args))}}function rm(t,e){const n=t,o=Hf(),s=Zv(),r=Qv&&n.enableEarlyProxy;if(s&&(o.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))s.emit(em,t,e);else{const i=r?new sm(n,s):null;(o.__VUE_DEVTOOLS_PLUGINS__=o.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:e,proxy:i}),i&&e(i.proxiedTarget)}}/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var Uf="store";function im(t){return t===void 0&&(t=null),Yo(t!==null?t:Uf)}function ko(t,e){Object.keys(t).forEach(function(n){return e(t[n],n)})}function lm(t){return t!==null&&typeof t=="object"}function am(t){return t&&typeof t.then=="function"}function um(t,e){return function(){return t(e)}}function Vf(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var o=e.indexOf(t);o>-1&&e.splice(o,1)}}function Wf(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;yr(t,n,[],t._modules.root,!0),ha(t,n,e)}function ha(t,e,n){var o=t._state,s=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var r=t._wrappedGetters,i={},l={},a=xh(!0);a.run(function(){ko(r,function(u,c){i[c]=um(u,t),l[c]=M(function(){return i[c]()}),Object.defineProperty(t.getters,c,{get:function(){return l[c].value},enumerable:!0})})}),t._state=mn({data:e}),t._scope=a,t.strict&&hm(t),o&&n&&t._withCommit(function(){o.data=null}),s&&s.stop()}function yr(t,e,n,o,s){var r=!n.length,i=t._modules.getNamespace(n);if(o.namespaced&&(t._modulesNamespaceMap[i],t._modulesNamespaceMap[i]=o),!r&&!s){var l=ga(e,n.slice(0,-1)),a=n[n.length-1];t._withCommit(function(){l[a]=o.state})}var u=o.context=cm(t,i,n);o.forEachMutation(function(c,d){var g=i+d;dm(t,g,c,u)}),o.forEachAction(function(c,d){var g=c.root?d:i+d,b=c.handler||c;fm(t,g,b,u)}),o.forEachGetter(function(c,d){var g=i+d;pm(t,g,c,u)}),o.forEachChild(function(c,d){yr(t,e,n.concat(d),c,s)})}function cm(t,e,n){var o=e==="",s={dispatch:o?t.dispatch:function(r,i,l){var a=Gs(r,i,l),u=a.payload,c=a.options,d=a.type;return(!c||!c.root)&&(d=e+d),t.dispatch(d,u)},commit:o?t.commit:function(r,i,l){var a=Gs(r,i,l),u=a.payload,c=a.options,d=a.type;(!c||!c.root)&&(d=e+d),t.commit(d,u,c)}};return Object.defineProperties(s,{getters:{get:o?function(){return t.getters}:function(){return qf(t,e)}},state:{get:function(){return ga(t.state,n)}}}),s}function qf(t,e){if(!t._makeLocalGettersCache[e]){var n={},o=e.length;Object.keys(t.getters).forEach(function(s){if(s.slice(0,o)===e){var r=s.slice(o);Object.defineProperty(n,r,{get:function(){return t.getters[s]},enumerable:!0})}}),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}function dm(t,e,n,o){var s=t._mutations[e]||(t._mutations[e]=[]);s.push(function(i){n.call(t,o.state,i)})}function fm(t,e,n,o){var s=t._actions[e]||(t._actions[e]=[]);s.push(function(i){var l=n.call(t,{dispatch:o.dispatch,commit:o.commit,getters:o.getters,state:o.state,rootGetters:t.getters,rootState:t.state},i);return am(l)||(l=Promise.resolve(l)),t._devtoolHook?l.catch(function(a){throw t._devtoolHook.emit("vuex:error",a),a}):l})}function pm(t,e,n,o){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(r){return n(o.state,o.getters,r.state,r.getters)})}function hm(t){ze(function(){return t._state.data},function(){},{deep:!0,flush:"sync"})}function ga(t,e){return e.reduce(function(n,o){return n[o]},t)}function Gs(t,e,n){return lm(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}var gm="vuex bindings",Eu="vuex:mutations",Wr="vuex:actions",Un="vuex",vm=0;function mm(t,e){rm({id:"org.vuejs.vuex",app:t,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[gm]},function(n){n.addTimelineLayer({id:Eu,label:"Vuex Mutations",color:Du}),n.addTimelineLayer({id:Wr,label:"Vuex Actions",color:Du}),n.addInspector({id:Un,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree(function(o){if(o.app===t&&o.inspectorId===Un)if(o.filter){var s=[];Yf(s,e._modules.root,o.filter,""),o.rootNodes=s}else o.rootNodes=[Xf(e._modules.root,"")]}),n.on.getInspectorState(function(o){if(o.app===t&&o.inspectorId===Un){var s=o.nodeId;qf(e,s),o.state=wm(Cm(e._modules,s),s==="root"?e.getters:e._makeLocalGettersCache,s)}}),n.on.editInspectorState(function(o){if(o.app===t&&o.inspectorId===Un){var s=o.nodeId,r=o.path;s!=="root"&&(r=s.split("/").filter(Boolean).concat(r)),e._withCommit(function(){o.set(e._state.data,r,o.state.value)})}}),e.subscribe(function(o,s){var r={};o.payload&&(r.payload=o.payload),r.state=s,n.notifyComponentUpdate(),n.sendInspectorTree(Un),n.sendInspectorState(Un),n.addTimelineEvent({layerId:Eu,event:{time:Date.now(),title:o.type,data:r}})}),e.subscribeAction({before:function(o,s){var r={};o.payload&&(r.payload=o.payload),o._id=vm++,o._time=Date.now(),r.state=s,n.addTimelineEvent({layerId:Wr,event:{time:o._time,title:o.type,groupId:o._id,subtitle:"start",data:r}})},after:function(o,s){var r={},i=Date.now()-o._time;r.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},o.payload&&(r.payload=o.payload),r.state=s,n.addTimelineEvent({layerId:Wr,event:{time:Date.now(),title:o.type,groupId:o._id,subtitle:"end",data:r}})}})})}var Du=8702998,bm=6710886,ym=16777215,zf={label:"namespaced",textColor:ym,backgroundColor:bm};function Gf(t){return t&&t!=="root"?t.split("/").slice(-2,-1)[0]:"Root"}function Xf(t,e){return{id:e||"root",label:Gf(e),tags:t.namespaced?[zf]:[],children:Object.keys(t._children).map(function(n){return Xf(t._children[n],e+n+"/")})}}function Yf(t,e,n,o){o.includes(n)&&t.push({id:o||"root",label:o.endsWith("/")?o.slice(0,o.length-1):o||"Root",tags:e.namespaced?[zf]:[]}),Object.keys(e._children).forEach(function(s){Yf(t,e._children[s],n,o+s+"/")})}function wm(t,e,n){e=n==="root"?e:e[n];var o=Object.keys(e),s={state:Object.keys(t.state).map(function(i){return{key:i,editable:!0,value:t.state[i]}})};if(o.length){var r=km(e);s.getters=Object.keys(r).map(function(i){return{key:i.endsWith("/")?Gf(i):i,editable:!1,value:Pl(function(){return r[i]})}})}return s}function km(t){var e={};return Object.keys(t).forEach(function(n){var o=n.split("/");if(o.length>1){var s=e,r=o.pop();o.forEach(function(i){s[i]||(s[i]={_custom:{value:{},display:i,tooltip:"Module",abstract:!0}}),s=s[i]._custom.value}),s[r]=Pl(function(){return t[n]})}else e[n]=Pl(function(){return t[n]})}),e}function Cm(t,e){var n=e.split("/").filter(function(o){return o});return n.reduce(function(o,s,r){var i=o[s];if(!i)throw new Error('Missing module "'+s+'" for path "'+e+'".');return r===n.length-1?i:i._children},e==="root"?t:t.root._children)}function Pl(t){try{return t()}catch(e){return e}}var Lt=function(e,n){this.runtime=n,this._children=Object.create(null),this._rawModule=e;var o=e.state;this.state=(typeof o=="function"?o():o)||{}},Kf={namespaced:{configurable:!0}};Kf.namespaced.get=function(){return!!this._rawModule.namespaced};Lt.prototype.addChild=function(e,n){this._children[e]=n};Lt.prototype.removeChild=function(e){delete this._children[e]};Lt.prototype.getChild=function(e){return this._children[e]};Lt.prototype.hasChild=function(e){return e in this._children};Lt.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)};Lt.prototype.forEachChild=function(e){ko(this._children,e)};Lt.prototype.forEachGetter=function(e){this._rawModule.getters&&ko(this._rawModule.getters,e)};Lt.prototype.forEachAction=function(e){this._rawModule.actions&&ko(this._rawModule.actions,e)};Lt.prototype.forEachMutation=function(e){this._rawModule.mutations&&ko(this._rawModule.mutations,e)};Object.defineProperties(Lt.prototype,Kf);var Ln=function(e){this.register([],e,!1)};Ln.prototype.get=function(e){return e.reduce(function(n,o){return n.getChild(o)},this.root)};Ln.prototype.getNamespace=function(e){var n=this.root;return e.reduce(function(o,s){return n=n.getChild(s),o+(n.namespaced?s+"/":"")},"")};Ln.prototype.update=function(e){Jf([],this.root,e)};Ln.prototype.register=function(e,n,o){var s=this;o===void 0&&(o=!0);var r=new Lt(n,o);if(e.length===0)this.root=r;else{var i=this.get(e.slice(0,-1));i.addChild(e[e.length-1],r)}n.modules&&ko(n.modules,function(l,a){s.register(e.concat(a),l,o)})};Ln.prototype.unregister=function(e){var n=this.get(e.slice(0,-1)),o=e[e.length-1],s=n.getChild(o);s&&s.runtime&&n.removeChild(o)};Ln.prototype.isRegistered=function(e){var n=this.get(e.slice(0,-1)),o=e[e.length-1];return n?n.hasChild(o):!1};function Jf(t,e,n){if(e.update(n),n.modules)for(var o in n.modules){if(!e.getChild(o))return;Jf(t.concat(o),e.getChild(o),n.modules[o])}}function xm(t){return new mt(t)}var mt=function(e){var n=this;e===void 0&&(e={});var o=e.plugins;o===void 0&&(o=[]);var s=e.strict;s===void 0&&(s=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Ln(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var i=this,l=this,a=l.dispatch,u=l.commit;this.dispatch=function(g,b){return a.call(i,g,b)},this.commit=function(g,b,y){return u.call(i,g,b,y)},this.strict=s;var c=this._modules.root.state;yr(this,c,[],this._modules.root),ha(this,c),o.forEach(function(d){return d(n)})},va={state:{configurable:!0}};mt.prototype.install=function(e,n){e.provide(n||Uf,this),e.config.globalProperties.$store=this;var o=this._devtools!==void 0?this._devtools:!1;o&&mm(e,this)};va.state.get=function(){return this._state.data};va.state.set=function(t){};mt.prototype.commit=function(e,n,o){var s=this,r=Gs(e,n,o),i=r.type,l=r.payload,a={type:i,payload:l},u=this._mutations[i];u&&(this._withCommit(function(){u.forEach(function(d){d(l)})}),this._subscribers.slice().forEach(function(c){return c(a,s.state)}))};mt.prototype.dispatch=function(e,n){var o=this,s=Gs(e,n),r=s.type,i=s.payload,l={type:r,payload:i},a=this._actions[r];if(a){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(l,o.state)})}catch{}var u=a.length>1?Promise.all(a.map(function(c){return c(i)})):a[0](i);return new Promise(function(c,d){u.then(function(g){try{o._actionSubscribers.filter(function(b){return b.after}).forEach(function(b){return b.after(l,o.state)})}catch{}c(g)},function(g){try{o._actionSubscribers.filter(function(b){return b.error}).forEach(function(b){return b.error(l,o.state,g)})}catch{}d(g)})})}};mt.prototype.subscribe=function(e,n){return Vf(e,this._subscribers,n)};mt.prototype.subscribeAction=function(e,n){var o=typeof e=="function"?{before:e}:e;return Vf(o,this._actionSubscribers,n)};mt.prototype.watch=function(e,n,o){var s=this;return ze(function(){return e(s.state,s.getters)},n,Object.assign({},o))};mt.prototype.replaceState=function(e){var n=this;this._withCommit(function(){n._state.data=e})};mt.prototype.registerModule=function(e,n,o){o===void 0&&(o={}),typeof e=="string"&&(e=[e]),this._modules.register(e,n),yr(this,this.state,e,this._modules.get(e),o.preserveState),ha(this,this.state)};mt.prototype.unregisterModule=function(e){var n=this;typeof e=="string"&&(e=[e]),this._modules.unregister(e),this._withCommit(function(){var o=ga(n.state,e.slice(0,-1));delete o[e[e.length-1]]}),Wf(this)};mt.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),this._modules.isRegistered(e)};mt.prototype.hotUpdate=function(e){this._modules.update(e),Wf(this,!0)};mt.prototype._withCommit=function(e){var n=this._committing;this._committing=!0,e(),this._committing=n};Object.defineProperties(mt.prototype,va);const te=Zf();function Zf(){const t=[];let e=!1;return function(o){return new Promise(s=>{const r=async()=>{try{o.length>0?await o(Zf()):await o()}catch(i){console.log("Error during transaction!: ",i)}finally{e=!1}t.length>0&&t.shift()(),s()};e?t.push(r):r()})}}const Xs=navigator.userAgent,Sm=!!Xs.match(/iPad/i)||!!Xs.match(/iPhone/i),_m=!!Xs.match(/WebKit/i),Lu=Sm&&_m&&!Xs.match(/CriOS/i);class Qf{constructor(){L(this,"state",mn({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder",hasTemplate:!1}));L(this,"supports");L(this,"_gameMode",null);L(this,"$store",null);L(this,"isSavingEnabled",W(!1));L(this,"localRepositoryUrl","");L(this,"loading");L(this,"creatingDB");L(this,"loadingContentPacksAllowed");L(this,"loadContentPacks");L(this,"updateProgress",null);const e=Ze.canSave(),n=this.isSavingEnabled;window.addEventListener("beforeunload",o=>{o.preventDefault(),o.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise(o=>{this.loadContentPacks=()=>o()}),this.supports=mn({optionalSaving:e,get autoLoading(){return e&&n.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!Lu,allowWebP:!0,limitedCanvasSpace:Lu}),e?this.loading=(async()=>{this.savingEnabled=await Ze.doesDbExists()})():this.loading=Promise.resolve(),this.loading.then(async()=>{if(await this.loadingContentPacksAllowed,this.creatingDB&&await this.creatingDB,this.savingEnabled){const o=await Ze.loadAutoload()??[];this.state.autoAdd=o;const s=await yn.getInstance(),r=await Promise.all(o.map(async i=>{const[l,a]=i.split(";",2);a!=null&&!s.hasPack(l)&&await s.loadTempPack(a);const u=s.getPack(l);return u.dddg2Path??u.dddg1Path}));await te(async()=>{await this.$store.dispatch("content/loadContentPacks",r)})}})}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(e){e?(localStorage.setItem("saving","true"),this.creatingDB=Ze.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=Ze.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}storeSaveFile(e,n){const o=document.createElement("a"),s=URL.createObjectURL(e);return o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),Promise.resolve()}async loadGameMode(){const n=new URLSearchParams(location.search).get("mode");if(n==="ddlc"||n==="ddlc_plus"){this._gameMode=n;return}await this.loading,await this.creatingDB;let o="";this.isSavingEnabled.value&&(o=await Ze.loadGameMode());let s="ddlc";(o==="ddlc"||o==="ddlc_plus")&&(s=o),this._gameMode=s}async setGameMode(e){this.isSavingEnabled.value&&await Ze.saveGameMode(e);const n=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${n}?mode=${e}`}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(){throw new Error("Method not implemented.")}connectToStore(e){this.$store=e}async saveToFile(e,n,o="image/png",s=1){const r=document.createElement("a");r.setAttribute("download",n);const i=await this.createObjectURL(e,o,s);return r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),i}localRepoInstall(){return Promise.reject(new Error("This environment does not support a local repository"))}localRepoUninstall(){throw new Error("This environment does not support a local repository")}async autoLoadAdd(e){await this.loading,await this.creatingDB,await Ze.saveAutoload([...this.state.autoAdd,e]),this.state.autoAdd.push(e)}async autoLoadRemove(e){await this.loading,await this.creatingDB;const n=this.normalizePackId(e);await Ze.saveAutoload(this.state.autoAdd.filter(s=>this.normalizePackId(s)!=n));const o=this.state.autoAdd.indexOf(e);this.state.autoAdd.splice(o,1)}normalizePackId(e){const n=e.split(";");return n.length===1?n[0]:n[n.length-1]}async loadSettings(){await this.loading,await this.creatingDB;const e={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?{...e,...await Ze.loadSettings()}:e}async saveSettings(e){await this.loading,await this.creatingDB,this.isSavingEnabled.value&&await Ze.saveSettings(e)}async loadDefaultTemplate(){var n;if(await this.loading,await this.creatingDB,!this.isSavingEnabled.value)return!1;const e=await Ze.loadTemplate();return e==null?!1:(this.state.hasTemplate=!0,await((n=this.$store)==null?void 0:n.dispatch("loadSave",e)),!0)}async saveDefaultTemplate(){var n;if(await this.loading,await this.creatingDB,!this.isSavingEnabled.value)return;const e=await((n=this.$store)==null?void 0:n.dispatch("getSave",!0));Ze.saveTemplate(e),this.state.hasTemplate=!0}async clearDefaultTemplate(){await this.loading,await this.creatingDB,this.isSavingEnabled.value&&(await Ze.saveTemplate(null),this.state.hasTemplate=!1)}async isInitialized(){await this.loading,await this.creatingDB}prompt(e,n){return new Promise(o=>{o(prompt(e,n))})}onPanelChange(){}createObjectURL(e,n,o){return new Promise((s,r)=>{if(!(window.URL!=null&&window.URL.createObjectURL!=null))return s(e.toDataURL(n,o));if(e.toBlob!=null)e.toBlob(l=>{if(!l){r();return}s(URL.createObjectURL(l))},n,o);else{const l=e.toDataURL(n,o),a=this.dataURItoBlob(l,n);s(URL.createObjectURL(a))}})}dataURItoBlob(e,n){const o=atob(e.split(",")[1]),s=o.length,r=new Uint8Array(s);for(let i=0;i<s;i++)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})}}const Ze={indexedDB:(()=>{try{return window.indexedDB??window.mozIndexedDB??window.webkitIndexedDB??window.msIndexedDB??null}catch{return null}})(),transaction:(()=>{try{return window.IDBTransaction??window.mozIDBTransaction??window.webkitIDBTransaction??window.msIDBTransaction??null}catch{return null}})(),db:null,canSave(){return!!(Ze.indexedDB&&window.localStorage!=null)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return Ze.db?Ze.db:Ze.db=new Promise((t,e)=>{const n=Ze.indexedDB.open("dddg",3);n.onerror=o=>{e(o)},n.onupgradeneeded=o=>{const s=n.result,r=o.oldVersion??o.version;r<1&&s.createObjectStore("settings"),r===1&&(s.deleteObjectStore("settings"),s.createObjectStore("settings"))},n.onsuccess=()=>{t(n.result)}})},clearDB(){return new Promise((t,e)=>{if(!Ze.db){t();return}const n=Ze.indexedDB.deleteDatabase("dddg");Ze.db=null,n.onerror=o=>{e(o)},n.onsuccess=()=>{t()}})},loadAutoload(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("autoload")))},saveAutoload(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put([...t],"autoload"))})},loadGameMode(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("gameMode")))},saveGameMode(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put(t,"gameMode"))})},saveTemplate(t){return this.objectStorePromise("readwrite",async e=>{t==null?await this.reqPromise(e.delete("template")):await this.reqPromise(e.put(t,"template"))})},loadTemplate(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("template")))},saveSettings(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put({...t},"settings"))})},loadSettings(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("settings")))},async objectStorePromise(t,e){const n=await this.db;if(!n)throw new Error("No database");const s=n.transaction(["settings"],t).objectStore("settings");return await e(s)},reqPromise(t){return new Promise((e,n)=>{t.onerror=o=>{n(o)},t.onsuccess=()=>{e(t.result)}})}};class Pm extends Qf{saveToFile(e,n,o="image/png",s=1){let r=e.toDataURL(o,s);const i=this.dataURItoBlob(r,o);return window.URL!=null&&window.URL.createObjectURL!=null&&(r=URL.createObjectURL(i)),window.navigator.msSaveBlob(i,n),Promise.resolve(r)}}const ep="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!--%20Source:%20https://fonts.google.com/icons?selected=Material%2520Icons%2520Round%253Awarning%253A%20--%3e%3csvg%20fill='%23FFFFFF'%20version='1.1'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cfilter%20id='a'%20x='-.07126'%20y='-.079384'%20width='1.1425'%20height='1.1597'%20color-interpolation-filters='sRGB'%3e%3cfeGaussianBlur%20stdDeviation='0.36070242'/%3e%3c/filter%3e%3c/defs%3e%3cpath%20d='M4.47%2021h15.06c1.54%200%202.5-1.67%201.73-3L13.73%204.99c-.77-1.33-2.69-1.33-3.46%200L2.74%2018c-.77%201.33.19%203%201.73%203zM12%2014c-.55%200-1-.45-1-1v-2c0-.55.45-1%201-1s1%20.45%201%201v2c0%20.55-.45%201-1%201zm1%204h-2v-2h2v2z'%20fill='%23fff'%20filter='url(%23a)'%20stroke='%23fff'/%3e%3cpath%20d='M4.47%2021h15.06c1.54%200%202.5-1.67%201.73-3L13.73%204.99c-.77-1.33-2.69-1.33-3.46%200L2.74%2018c-.77%201.33.19%203%201.73%203zM12%2014c-.55%200-1-.45-1-1v-2c0-.55.45-1%201-1s1%20.45%201%201v2c0%20.55-.45%201-1%201zm1%204h-2v-2h2v2z'%20fill='%23000'/%3e%3c/svg%3e";class Mn{constructor(e){L(this,"width");L(this,"height");this.html=e,this.width=e.width,this.height=e.height}paintOnto(e,n={}){const{w:o,h:s}={w:this.width,h:this.height,...n},{x:r,y:i}={x:-o/2,y:-s/2,...n};e.drawImage(this.html,r,i,o,s)}}let Ol=null;setTimeout(()=>fo(ep).then(t=>{t instanceof Mn&&(Ol=t)}),0);class ss{constructor(){L(this,"width",300);L(this,"height",300)}paintOnto(e,n={}){Ol&&Ol.paintOnto(e,n)}}let qr;function co(){if(qr)return qr;if(!he.supports.allowWebP)return Promise.resolve(!1);const t="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",e="data:image/webp;base64,UklGRogAAABXRUJQVlA4THwAAAAv/8SzAA/wGbPPmH3GbP7jAQSSNu9f+rzDwYj+G23bpt3Gx3xD8353j73f5b87+e9OALmT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9OAriT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9O/rsTwe7kvzsL";return qr=(async()=>{const n=await Promise.all([Tl(t,1,2),Tl(e,720,1280)]);return n[0]&&n[1]})()}function Tl(t,e,n){return new Promise(o=>{const s=document.createElement("img");s.addEventListener("load",()=>{o(s.width===n&&s.height===e)}),s.addEventListener("error",()=>{o(!1)}),s.src=t})}let zr;function Om(){return zr||(zr=(async()=>await Tl("data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",1,2))())}class Tm{constructor(){L(this,"cache",new Map)}get(e){const n=this.cache.get(e);if(n)return n;const o=Ks(e);return this.cache.set(e,o),o}remove(e){this.cache.delete(e)}}class Im{constructor(){L(this,"cache",new Map)}get(e){var s;const n=(s=this.cache.get(e))==null?void 0:s.deref();if(n)return n;const o=$m(e);return this.cache.set(e,new WeakRef(o)),o}remove(e){this.cache.delete(e)}}let Gr=null;function Ys(){return Gr||(window.assetCache=Gr=he.supports.assetCaching||typeof WeakRef>"u"?new Tm:new Im)}const Bn={};function ma(t,e=!0){return fo(he.supports.lq&&!e?t.lq:t.hq)}function gn(t,e=!0){const n=he.supports.lq&&fa&&!e?t.lq:t.hq;return Bn[n]?Bn[n]:n}function fo(t){return Bn[t]&&(t=Bn[t]),Ys().get(t)}async function rs(t,e=!0){const n=`${da}${t}${he.supports.lq&&fa&&!e?".lq":""}${await co()?".webp":".png"}`.replace(/\/+/,"/");return await Ys().get(n)}async function jm(t,e=!0){return`${da}${t}${he.supports.lq&&fa&&!e?".lq":""}${await co()?".webp":".png"}`.replace(/\/+/,"/")}function tp(t,e){Bn[t]=e}async function $m(t){const e=!!Bn[t];return e&&(t=Bn[t]),await(async()=>{try{return await Ks(t)}catch{if(t.endsWith(".webp")&&!e)try{return await Ks(t.replace(/\.webp$/,".png"))}catch{return $e.fire(new Vs(t)),Ys().remove(t),new ss}else return $e.fire(new Vs(t)),Ys().remove(t),new ss}})()}function Ks(t,e=!1){return new Promise(n=>{const o=new Image;o.addEventListener("load",()=>{n(new Mn(o)),(e||!he.supports.assetCaching)&&document.body.removeChild(o)}),o.addEventListener("error",()=>{n(new ss),(e||!he.supports.assetCaching)&&document.body.removeChild(o)}),o.crossOrigin="Anonymous",o.src=t,o.style.display="none",document.body.appendChild(o)})}class Am{constructor(){L(this,"state",mn({looseTextParsing:!0,autoAdd:[],downloadLocation:"",hasTemplate:!1}));L(this,"localRepositoryUrl","/repo/");L(this,"_gameMode",null);L(this,"electron",window);L(this,"$store",null);L(this,"bgInvalidation",null);L(this,"pendingContentPacks",[]);L(this,"pendingContentPacksReplace",[]);L(this,"loadingContentPacksAllowed");L(this,"loadContentPacks");L(this,"updateProgress",W("wait"));L(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0,allowWebP:!0,limitedCanvasSpace:!1});L(this,"savingEnabled",!0);this.loadingContentPacksAllowed=new Promise(n=>{this.loadContentPacks=()=>n()}),this.electron.ipcRenderer.on("add-persistent-content-pack",async n=>{if(await this.loadingContentPacksAllowed,!this.$store){this.pendingContentPacks.push(n);return}await te(async()=>{await this.$store.dispatch("content/loadContentPacks",n)})}),this.electron.ipcRenderer.on("add-persistent-background",async n=>{const o="persistentBg-"+n,s=n.split("/");tp(o,n),Nu.backgrounds.push({id:o,variants:[[o]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()}),this.electron.ipcRenderer.on("push-message",n=>{$e.fire(new Ot(n))}),this.electron.ipcRenderer.on("config.downloadFolderUpdate",n=>{this.state.downloadLocation=n}),this.electron.ipcRenderer.onConversation("load-packs",async n=>{const o=await yn.getInstance(),s=await Promise.all(n.map(async r=>{const[i,l]=r.split(";",2);l!=null&&!o.hasPack(i)&&await o.loadTempPack(l);const a=o.getPack(i);return a.dddg2Path||a.dddg1Path}));if(!this.$store){s.forEach(r=>this.pendingContentPacks.push(r));return}await te(async()=>{await this.$store.dispatch("content/loadContentPacks",s)})}),this.electron.ipcRenderer.onConversation("auto-load.changed",n=>{this.state.autoAdd=n}),this.electron.ipcRenderer.onConversation("reload-repo",async()=>{await(await yn.getInstance()).reloadLocalRepo()}),this.electron.ipcRenderer.onConversation("replace-pack",async n=>{const o={processed:!1,contentPack:n};this.$store?await te(async()=>{await this.$store.dispatch("content/replaceContentPack",o)}):this.pendingContentPacksReplace.push(o)}),this.electron.ipcRenderer.onConversation("resolvable-error",(n,o)=>new Promise(s=>{$e.fire(new ca(n,o.map(r=>({exec:()=>s(r),name:r}))))}));let e=!1;this.electron.ipcRenderer.on("update.progress",n=>{this.updateProgress.value=n,n==="done"?(e=!1,$e.fire(new Ot("An update is downloaded and will be installed once DDDG closes."))):e||(e=!0,$e.fire(new Ot("An update was found and will download in the background.")))}),this.electron.ipcRenderer.on("update.checkStopped",()=>{this.updateProgress.value="none"}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}loadDefaultTemplate(){throw new Error("Method not implemented.")}saveDefaultTemplate(){throw new Error("Method not implemented.")}clearDefaultTemplate(){throw new Error("Method not implemented.")}storeSaveFile(e,n){const o=document.createElement("a"),s=URL.createObjectURL(e);return o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),Promise.resolve()}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(e){this.electron.ipcRenderer.send("open-folder",e)}onPanelChange(){}async saveSettings(e){await this.electron.ipcRenderer.sendConvo("config.set","nsfw",e.nsfw),await this.electron.ipcRenderer.sendConvo("config.set","darkMode",e.darkMode??void 0),await this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",e.defaultCharacterTalkingZoom)}async loadGameMode(){this._gameMode=await this.electron.ipcRenderer.sendConvo("config.get","gameMode")||"ddlc"}async setGameMode(e){await this.electron.ipcRenderer.sendConvo("config.set","gameMode",e),this.electron.ipcRenderer.send("reload")}async loadSettings(){return{lq:!1,nsfw:await this.electron.ipcRenderer.sendConvo("config.get","nsfw")??!1,darkMode:await this.electron.ipcRenderer.sendConvo("config.get","darkMode")??void 0,defaultCharacterTalkingZoom:await this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom")??void 0}}async localRepoInstall(e,n,o){await this.electron.ipcRenderer.sendConvo("repo.install",e,n,o)}async localRepoUninstall(e){await this.electron.ipcRenderer.sendConvo("repo.uninstall",e)}async autoLoadAdd(e){await this.electron.ipcRenderer.sendConvo("auto-load.add",e)}async autoLoadRemove(e){await this.electron.ipcRenderer.sendConvo("auto-load.remove",e)}saveToFile(e,n,o="image/png",s=1){return new Promise((r,i)=>{e.toBlob(async l=>{if(!l){i();return}const a=await l.arrayBuffer();await this.electron.ipcRenderer.sendConvo("save-file",n,new Uint8Array(a)),r(URL.createObjectURL(l))},o,s)})}async prompt(e,n){return await this.electron.ipcRenderer.sendConvo("show-prompt",e,n)}connectToStore(e){this.$store=e,this.invalidateInstalledBGs(),te(async()=>{if(this.pendingContentPacks.length>0&&await this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks),this.pendingContentPacksReplace.length>0)for(const n of this.pendingContentPacksReplace)await this.$store.dispatch("content/replaceContentPack",n)})}invalidateInstalledBGs(){this.$store&&this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation!=null&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),this.$store&&te(async()=>{await this.$store.dispatch("content/replaceContentPack",{contentPack:Nu})})}}const Nu={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};function Rm(){return window.isElectron?new Am:"msSaveOrOpenBlob"in window.navigator?new Pm:new Qf}const he=Rm(),Mm="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",at=class at{constructor(e,n,o){L(this,"onlineRepo");L(this,"localRepo");L(this,"tempRepo",mn({authors:{},packs:[]}));L(this,"combinedList");L(this,"authors");this.$store=o,window.repo=this,e||(e={authors:{},packs:[]},$e.fire(new Ot("Couldn't load remote repository."))),n||(n={authors:{},packs:[]},he.supports.localRepo&&$e.fire(new Ot("Couldn't load local repository."))),this.onlineRepo=W(e),this.localRepo=W(n),this.combinedList=M(()=>{const s=this.onlineRepo.value,r=(s==null?void 0:s.packs)??[],i=new Map(r.map(k=>[k.id,k])),l=this.localRepo.value,a=(l==null?void 0:l.packs)??[],u=new Map(a.map(k=>[k.id,k])),d=this.tempRepo.packs,g=new Map(d.map(k=>[k.id,k])),b=new Set(he.state.autoAdd),y=this.$store.state.content.contentPacks.map(k=>k.packId).filter(k=>k!=null),w=new Set(y),_=new Set;return[...y,...a.map(k=>k.id),...r.map(k=>k.id),...d.map(k=>k.id)].filter(k=>k.startsWith("dddg.buildin.")||k.startsWith("dddg.uploads.")||k.startsWith("dddg.desktop.")||k==="concept_femc.shido_draws.edave64"||_.has(k)?!1:(_.add(k),!0)).map(k=>({...i.get(k)??{characters:[],kind:[],authors:[]},...u.get(k),...g.get(k),autoloading:b.has(k),installed:u.has(k),online:i.has(k)||g.has(k),loaded:w.has(k)}))}),this.authors=M(()=>{const s=this.onlineRepo.value,r=(s==null?void 0:s.authors)??{},i=this.localRepo.value,l=(i==null?void 0:i.authors)??{};return{...r,...l}}),Object.freeze(this)}static getInstance(){return at.instance||(at.instance=this.createInstance()),at.instance}static async createInstance(){const e=at.loadRepo(Mm),n=he.supports.localRepo?await at.loadRepo(he.localRepositoryUrl):null,[o,s,r]=await Promise.all([e,n,at.$store]);return new at(o,s,r)}static async loadRepo(e){try{const[n,o]=await Promise.all([at.fetchJSON(e+"repo.json"),at.fetchJSON(e+"people.json")]);return{packs:n,authors:o}}catch{return null}}static async fetchJSON(e){const n=await fetch(e);if(!n.ok)throw new Error("Could not load json");return await n.json()}async reloadLocalRepo(){this.localRepo.value=he.supports.localRepo?await at.loadRepo(he.localRepositoryUrl):null}getPacks(){return this.combinedList.value}hasPack(e,n=!1){var o;return n?!!((o=this.onlineRepo.value)!=null&&o.packs.find(s=>s.id===e)):!!this.getPacks().find(s=>s.id===e)}getPack(e){return this.getPacks().find(n=>n.id===e)??null}getAuthor(e){return this.authors.value[e]||null}getAuthors(){return this.authors.value}async loadTempPack(e){const n=fetch(e);let o;try{o=await n}catch{throw new Error(`Failed to load '${e}'`)}if(!o.ok)throw o.status===404?new Error(`The pack '${e}' does not exist anymore.`):new Error(`Failed to load '${e}': ${o.statusText||o.status}`);let s;try{s=await o.json()}catch(i){throw new Error(`The contents of '${e}' is not a valid JSON: ${i.message}`)}if(!s.pack&&(!s.packs||s.packs.length===0))throw new Error(`The json file '${e}' does not contain any packages`);if(s.authors)for(const i in s.authors)this.tempRepo.authors[i]&&(this.tempRepo.authors[i]=s.authors[i]);let r=null;if(s.pack&&(this.addTempPack(s.pack,e),r=s.pack.id),s.packs)for(const i of s.packs)this.addTempPack(i,e),r===null&&(r=i.id);return r}addTempPack(e,n){if(e.repoUrl=n,e.dddg1Path&&(e.dddg1Path=new URL(e.dddg1Path,n).toString()),e.dddg2Path&&(e.dddg2Path=new URL(e.dddg2Path,n).toString()),e.preview)for(let o=0;o<e.preview.length;++o)e.preview[o]=new URL(e.preview[o],n).toString();this.tempRepo.packs.find(o=>o.id===e.id)||this.tempRepo.packs.push(e)}};L(at,"instance"),L(at,"setStore"),L(at,"$store",new Promise(e=>{at.setStore=e}));let yn=at;function js(t,e){return{backgrounds:Bm(t.backgrounds,e.backgrounds),characters:Dm(t.characters,e.characters),dependencies:Il(t.dependencies,e.dependencies),fonts:zt(t.fonts,e.fonts,n=>n.id,(n,o)=>({...n,files:Il(n.files,o.files)})),poemStyles:zt(t.poemStyles,e.poemStyles,n=>n.label,()=>{throw new Error}),poemBackgrounds:[...t.poemBackgrounds,...e.poemBackgrounds],sprites:zt(t.sprites,e.sprites,n=>n.id,(n,o)=>({id:n.id,label:n.label,variants:[...n.variants,...o.variants],defaultScale:n.defaultScale,hd:n.hd,sdVersion:n.sdVersion??o.sdVersion})),colors:zt(t.colors,e.colors,n=>n.color,n=>n)}}function Bm(t,e){return zt(t,e,n=>n.id,Em)}function Em(t,e){return{id:t.id,label:t.label,variants:[...t.variants,...e.variants],scaling:t.scaling,sdVersion:t.sdVersion??e.sdVersion}}function Dm(t,e){return zt(t,e,n=>n.id,Lm)}function Lm(t,e){return{chibi:t.chibi,id:t.id,label:t.label,heads:Hm(t.heads,e.heads),defaultScale:t.defaultScale,hd:t.hd,size:t.size,sdVersion:t.sdVersion,styleGroups:zt(t.styleGroups,e.styleGroups,n=>n.id,(n,o)=>({id:n.id,styleComponents:zt(n.styleComponents,o.styleComponents,s=>s.id,(s,r)=>({id:s.id,label:s.label,variants:Nm(s.variants,r.variants)})),styles:zt(n.styles,o.styles,s=>JSON.stringify(s.components),(s,r)=>({components:s.components,poses:zt(s.poses,r.poses,i=>i.id,Fm)}))}))}}function Nm(t,e){const n={...t};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(Object.prototype.hasOwnProperty.call(n,o)||(n[o]=e[o]));return n}function Fm(t,e){const n={...t.positions};for(const o in e.positions)n[o]?n[o]=[...n[o],...e.positions[o]]:n[o]=e.positions[o];return{id:t.id,compatibleHeads:Il(t.compatibleHeads,e.compatibleHeads),previewOffset:t.previewOffset,previewSize:t.previewSize,scale:t.scale,size:t.size,renderCommands:t.renderCommands,positions:n}}function Hm(t,e){const n={...t};for(const o in e){if(!Object.prototype.hasOwnProperty.call(e,o))continue;const s=e[o];if(n[o]){const r=n[o];n[o]={previewOffset:r.previewOffset,previewSize:r.previewSize,variants:[...r.variants,...s.variants]}}else n[o]=s}return n}function Il(t,e){const n=[...t];for(const o of e)n.includes(o)||n.push(o);return n}function zt(t,e,n,o){const s=[...t],r=new Map(t.map((i,l)=>[n(i),l]));for(const i of e){const l=n(i);if(r.has(l)){const a=r.get(l),u=s[a];s.splice(a,1,o(u,i))}else r.set(l,s.length),s.push(i)}return s}var jo={},Fu;function Um(){if(Fu)return jo;Fu=1,Object.defineProperty(jo,"__esModule",{value:!0}),jo.normalizeCharacter=void 0;function t(a,u){var c=l("",a.folder||"/",u),d=void 0;return a.chibi&&(d=l(c,a.chibi,u)),d===void 0&&a.internalId&&(d=(u["/"]||"")+"chibis/"+a.internalId),{id:a.id,packId:a.packId,packCredits:a.packCredits,name:a.name,nsfw:!!a.nsfw,chibi:d,eyes:e(a.eyes,c,u),hairs:e(a.hairs,c,u),styles:r(a.styles),heads:n(a.heads,c,u),poses:o(a.poses,c,u)}}jo.normalizeCharacter=t;function e(a,u,c){if(!a)return{};var d={};for(var g in a)a.hasOwnProperty(g)&&(d[g]=l(u,a[g],c));return d}function n(a,u,c){var d={};if(!a)return d;for(var g in a)if(a.hasOwnProperty(g)){var b=a[g],y=void 0;if(b instanceof Array)y={all:s(b,u,c),nsfw:!1,offset:[290,70],size:[380,380]};else{var w=l(u,b.folder,c);y={all:s(b.all,w,c),nsfw:!!b.nsfw,offset:b.offset||[290,70],size:b.size||[380,380]}}d[g]=y}return d}function o(a,u,c){return a?a.map(function(d){var g=l(u,d.folder,c),b={compatibleHeads:d.compatibleHeads||[],headAnchor:d.headAnchor||[0,0],headInForeground:!!d.headInForeground,name:d.name,nsfw:!!d.nsfw,style:d.style,offset:[0,0],size:[960,960]};if("static"in d)b.static=l(g,d.static,c);else if("variant"in d)b.variant=s(d.variant,g,c);else if("left"in d)b.left=s(d.left,g,c),b.right=s(d.right,g,c);else throw new Error("Invalid pose");return b}):[]}function s(a,u,c){return a.map(function(d){return typeof d=="string"?{img:l(u,d,c),nsfw:!1}:{img:l(u,d.img,c),nsfw:d.nsfw||!1}})}function r(a){return a?a.map(function(u){return{name:u.name,label:u.label,nsfw:u.nsfw||!1}}):[]}function i(a){return a.startsWith("blob:")||a.startsWith("http://")||a.startsWith("https://")||a.startsWith("://")}function l(a,u,c){if(!u)return a;for(var d in c)if(u.startsWith(d))return c[d]+u.slice(d.length);return i(u)?u:a+u}return jo}var Vm=Um(),wt={},Ge={},rt={},Hu;function np(){if(Hu)return rt;Hu=1;var t=rt&&rt.__assign||function(){return t=Object.assign||function(f){for(var x,P=1,j=arguments.length;P<j;P++){x=arguments[P];for(var m in x)Object.prototype.hasOwnProperty.call(x,m)&&(f[m]=x[m])}return f},t.apply(this,arguments)},e=rt&&rt.__values||function(f){var x=typeof Symbol=="function"&&Symbol.iterator,P=x&&f[x],j=0;if(P)return P.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&j>=f.length&&(f=void 0),{value:f&&f[j++],done:!f}}};throw new TypeError(x?"Object is not iterable.":"Symbol.iterator is not defined.")},n=rt&&rt.__read||function(f,x){var P=typeof Symbol=="function"&&f[Symbol.iterator];if(!P)return f;var j=P.call(f),m,T=[],R;try{for(;(x===void 0||x-- >0)&&!(m=j.next()).done;)T.push(m.value)}catch(B){R={error:B}}finally{try{m&&!m.done&&(P=j.return)&&P.call(j)}finally{if(R)throw R.error}}return T},o=rt&&rt.__spread||function(){for(var f=[],x=0;x<arguments.length;x++)f=f.concat(n(arguments[x]));return f};Object.defineProperty(rt,"__esModule",{value:!0}),rt.mapObject=rt.assetWalker=rt.normalizePath=void 0;var s=10;function r(f,x,P,j){for(var m,T,R="",B=0,D=new Map(Array.from(x.entries()).map(function(z){return[new RegExp("{"+z[0]+"}","g"),z[1]]}));R!==f;){if(R=f,++B>s)throw new Error("Maximum replacement recursion exceeded!");try{for(var N=(m=void 0,e(D.entries())),ee=N.next();!ee.done;ee=N.next()){var xe=ee.value;f=f.replace(xe[0],xe[1])}}catch(z){m={error:z}}finally{try{ee&&!ee.done&&(T=N.return)&&T.call(N)}finally{if(m)throw m.error}}f=f.replace(/{format(:.*?:.*?)+}/gi,function(z){z=z.slice(8,-1);for(var I=z.split(":"),C=0;C<I.length;C+=2)if(P.has(I[C]))return I[C+1];return""}),f=f.replace(/{lq:(.*?):(.*?)}/gi,function(z){return z.slice(4,-1).split(":")[j?0:1]})}return f}rt.normalizePath=r;function i(f,x){return{packId:f.packId,packCredits:f.packCredits,dependencies:f.dependencies,characters:f.characters.map(function(P){return l(P,x)}),backgrounds:f.backgrounds.map(function(P){return w(P,x)}),fonts:f.fonts.map(function(P){return _(P,x)}),poemStyles:o(f.poemStyles),poemBackgrounds:f.poemBackgrounds.map(function(P){return k(P,x)}),sprites:f.sprites.map(function(P){return h(P,x)}),colors:f.colors}}rt.assetWalker=i;function l(f,x){return{id:f.id,label:f.label,chibi:f.chibi?x(f.chibi,"image"):void 0,heads:b(f.heads,x),styleGroups:f.styleGroups.map(function(P){return a(P,x)}),defaultScale:f.defaultScale,hd:f.hd,size:f.size,sdVersion:f.sdVersion}}function a(f,x){return{id:f.id,styleComponents:f.styleComponents.map(function(P){return c(P,x)}),styles:f.styles.map(function(P){return u(P,x)})}}function u(f,x){return{components:f.components,poses:f.poses.map(function(P){return g(P,x)})}}function c(f,x){return t(t({},f),{variants:d(f.variants,x)})}function d(f,x){var P={};for(var j in f)f.hasOwnProperty(j)&&(P[j]=x(f[j],"image"));return P}function g(f,x){var P,j,m={};try{for(var T=e(Object.keys(f.positions)),R=T.next();!R.done;R=T.next()){var B=R.value,D=f.positions[B];m[B]=D.map(function(N){return N.map(function(ee){return x(ee,"image")})})}}catch(N){P={error:N}}finally{try{R&&!R.done&&(j=T.return)&&j.call(T)}finally{if(P)throw P.error}}return{compatibleHeads:f.compatibleHeads,id:f.id,previewOffset:f.previewOffset,previewSize:f.previewSize,renderCommands:f.renderCommands.map(function(N){return N.type==="image"?{type:"image",offset:N.offset,images:N.images.map(function(ee){return x(ee,"image")})}:N}),size:f.size,scale:f.scale,positions:m}}function b(f,x){var P={};for(var j in f)f.hasOwnProperty(j)&&(P[j]=y(f[j],x));return P}function y(f,x){return{previewOffset:f.previewOffset,previewSize:f.previewSize,variants:f.variants.map(function(P){return P.map(function(j){return x(j,"image")})})}}function w(f,x){return{id:f.id,label:f.label,variants:f.variants.map(function(P){return P.map(function(j){return x(j,"image")})}),scaling:f.scaling,sdVersion:f.sdVersion}}function _(f,x){return{id:f.id,label:f.label,files:f.files.map(function(P){return x(P,"font")})}}function k(f,x){return{id:f.id,fontColor:f.fontColor,label:f.label,images:f.images.map(function(P){return x(P,"image")}),sdVersion:f.sdVersion}}function h(f,x){return{id:f.id,label:f.label,variants:f.variants.map(function(P){return P.map(function(j){return x(j,"image")})}),defaultScale:f.defaultScale,hd:f.hd,sdVersion:f.sdVersion}}function v(f,x){var P={};for(var j in f)f.hasOwnProperty(j)&&(P[j]=x(f[j],j));return P}return rt.mapObject=v,rt}var Uu;function op(){if(Uu)return Ge;Uu=1;var t=Ge&&Ge.__assign||function(){return t=Object.assign||function(m){for(var T,R=1,B=arguments.length;R<B;R++){T=arguments[R];for(var D in T)Object.prototype.hasOwnProperty.call(T,D)&&(m[D]=T[D])}return m},t.apply(this,arguments)};Object.defineProperty(Ge,"__esModule",{value:!0}),Ge.expandId=Ge.normalizeStyleComponent=Ge.normalizeColor=Ge.normalizeBackground=Ge.normalizeFont=Ge.normalizePoemBackground=Ge.normalizePoemStyles=Ge.normalizeSprite=Ge.mapNormalize=Ge.normalizeContentPack=void 0;var e=np();function n(m,T){var R={paths:T,packId:m.packId},B=P("",m.folder||"/",R);return{packId:m.packId,packCredits:m.packCredits,dependencies:m.dependencies||[],characters:o(d,m.characters,B,R),backgrounds:o(a,m.backgrounds,B,R),fonts:o(l,m.fonts,B,R),poemStyles:o(r,m.poemStyles,B,R),poemBackgrounds:o(i,m.poemBackgrounds,B,R),sprites:o(s,m.sprites,B,R),colors:o(u,m.colors,B,R)}}Ge.normalizeContentPack=n;function o(m,T,R,B){return T?T.map(function(D){return m(D,R,B)}):[]}Ge.mapNormalize=o;function s(m,T,R){var B,D=P(T,m.folder,R);return{id:j(R.packId,m.id),label:m.label||m.variants[0][0],variants:m.variants.map(function(N){return c(N,D,R)}),defaultScale:m.defaultScale||[1,1],sdVersion:m.sdVersion,hd:(B=m.hd)!==null&&B!==void 0?B:null}}Ge.normalizeSprite=s;function r(m){return{label:m.label,defaultFont:m.defaultFont||"Aller",fontSize:m.fontSize!==void 0?m.fontSize:30,letterSpacing:m.letterSpacing!==void 0?m.letterSpacing:1,lineSpacing:m.lineSpacing!==void 0?m.lineSpacing:1.2}}Ge.normalizePoemStyles=r;function i(m,T,R){var B=P(T,m.folder,R);return{id:m.id,label:m.label,images:c(m.images,B,R),fontColor:m.fontColor||"black",sdVersion:m.sdVersion}}Ge.normalizePoemBackground=i;function l(m,T,R){var B=P(T,m.folder,R);return{id:j(R.packId,m.id?m.id:m.label?m.label:m.files[0]),label:m.label?m.label:m.id?m.id:m.files[0],files:c(m.files,B,R)}}Ge.normalizeFont=l;function a(m,T,R){var B,D=P(T,m.folder,R);return{id:j(R.packId,m.id),label:m.label?m.label:m.variants[0][0],variants:m.variants.map(function(N){return c(N,D,R)}),scaling:["none","strech","cover"].includes((B=m.scaling)===null||B===void 0?void 0:B.toLowerCase())?m.scaling.toLowerCase():"cover",sdVersion:m.sdVersion}}Ge.normalizeBackground=a;function u(m){return{label:m.label||m.color,color:m.color}}Ge.normalizeColor=u;function c(m,T,R){return m.map(function(B){return P(T,B,R)})}function d(m,T,R){var B,D,N,ee=P(T,m.folder,R);return{id:j(R.packId,m.id),label:m.label,chibi:m.chibi?P(ee,m.chibi,R):void 0,heads:_(m.heads,ee,R),defaultScale:(B=m.defaultScale)!==null&&B!==void 0?B:[.8,.8],size:(D=m.size)!==null&&D!==void 0?D:[960,960],hd:(N=m.hd)!==null&&N!==void 0?N:!1,sdVersion:m.sdVersion,styleGroups:o(g,m.styleGroups,ee,R)}}function g(m,T,R){var B=P(T,m.folder,R);return{id:j(R.packId,m.id),styleComponents:o(y,m.styleComponents,B,R),styles:m.styles.map(function(D){return b(D,B,R)})}}function b(m,T,R){var B=P(T,m.folder,R),D={};if(m.components)for(var N in m.components)m.components.hasOwnProperty(N)&&(D[j(R.packId,N)]=m.components[N]);return{components:D,poses:m.poses.map(function(ee){return k(ee,B,R)})}}function y(m,T,R){return{id:j(R.packId,m.id),label:m.label,variants:w(m.variants,T,R)}}Ge.normalizeStyleComponent=y;function w(m,T,R){if(!m)return{};var B={};for(var D in m)m.hasOwnProperty(D)&&(B[D]=P(T,m[D],R));return B}function _(m,T,R){var B={};if(!m)return B;for(var D in m)if(m.hasOwnProperty(D)){var N=m[D],ee=void 0;if(N instanceof Array)ee={variants:v(N,T,R),previewOffset:[290,70],previewSize:[380,380]};else{var xe=P(T,N.folder,R);ee={variants:v(N.variants,xe,R),previewOffset:N.previewOffset||[290,70],previewSize:N.previewSize||[380,380]}}B[j(R.packId,D)]=ee}return B}function k(m,T,R){var B,D,N=P(T,m.folder,R);return{compatibleHeads:((B=m.compatibleHeads)===null||B===void 0?void 0:B.map(function(ee){return j(R.packId,ee)}))||[],id:j(R.packId,m.id),previewOffset:m.previewOffset||[0,0],previewSize:m.previewSize||[960,960],size:m.size||[960,960],scale:m.scale||.8,positions:e.mapObject(m.positions||{},function(ee){return v(ee,N,R)}),renderCommands:((D=m.renderCommands)===null||D===void 0?void 0:D.map(function(ee){return h(ee,T,R)}))||[{type:"head",offset:[0,0]},{type:"pose-part",part:"Left",offset:[0,0]},{type:"pose-part",part:"Right",offset:[0,0]},{type:"pose-part",part:"Variant",offset:[0,0]}]}}function h(m,T,R){if(m.type==="image"){var B=P(T,m.folder,R);return{type:"image",composite:m.composite,offset:m.offset||[0,0],images:f(m.images,B,R)}}else return t(t({},m),{offset:m.offset||[0,0]})}function v(m,T,R){return m.map(function(B){return f(B,T,R)})}function f(m,T,R){return m.map(function(B){return P(T,B,R)})}function x(m){return m.startsWith("blob:")||m.startsWith("http://")||m.startsWith("https://")||m.startsWith("://")}function P(m,T,R){if(!T)return m;for(var B in R.paths)if(T.startsWith(B))return R.paths[B]+T.slice(B.length);return x(T)?T:m+T}function j(m,T){return T.indexOf(":")!==-1?T:m+":"+T}return Ge.expandId=j,Ge}var Vu;function Wm(){if(Vu)return wt;Vu=1;var t=wt&&wt.__values||function(h){var v=typeof Symbol=="function"&&Symbol.iterator,f=v&&h[v],x=0;if(f)return f.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&x>=h.length&&(h=void 0),{value:h&&h[x++],done:!h}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},e=wt&&wt.__read||function(h,v){var f=typeof Symbol=="function"&&h[Symbol.iterator];if(!f)return h;var x=f.call(h),P,j=[],m;try{for(;(v===void 0||v-- >0)&&!(P=x.next()).done;)j.push(P.value)}catch(T){m={error:T}}finally{try{P&&!P.done&&(f=x.return)&&f.call(x)}finally{if(m)throw m.error}}return j},n=wt&&wt.__spread||function(){for(var h=[],v=0;v<arguments.length;v++)h=h.concat(e(arguments[v]));return h};Object.defineProperty(wt,"__esModule",{value:!0}),wt.expandOrTranslateId=wt.convert=void 0;var o=op();function s(h,v,f){if(!h.packId)throw new Error("");return{packId:h.packId,packCredits:h.packCredits?[h.packCredits]:[],dependencies:i(h.id),backgrounds:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],characters:[l(h,v,f)],colors:[]}}wt.convert=s;var r={"ddlc.monika":_("dddg.buildin.base.monika","ddlc.monika",{heads:["straight","sideways"],poses:["normal","leaned","old","glitch"],styleGroups:["uniform","old","glitch"]}),"ddlc.natsuki":_("dddg.buildin.base.natsuki","ddlc.natsuki",{heads:["straight","straight_nsfw","sideways","turnedAway"],poses:["normal","crossed_arms","vomit","glitch"],styleGroups:["uniform","casual","old"],extraPoseAssoc:[["normal_causal","normal"],["crossed_arms_casual","crossed_arms"]],extraHeadAssoc:[["straight_nsfw","straight"]]}),"ddlc.sayori":_("dddg.buildin.sayori","ddlc.sayori",{heads:["straight","sideways"],poses:["normal","sideways","old","glitch","dead"],styleGroups:["uniform","casual","old","glitch","hanging"],extraPoseAssoc:[["normal_casual","normal"]]}),"ddlc.yuri":_("dddg.buildin.yuri","ddlc.yuri",{heads:["straight","sideways"],poses:["normal","sideways","stabbing","glitching","dragon"],styleGroups:["uniform","casual","glitch"],extraPoseAssoc:[["normal_causal","normal"],["hairplay_casual","hairplay"]]}),"ddlc.fan.mc1":_("dddg.buildin.mc_classic","ddlc.fan.mc1",{heads:["straight"],poses:["normal"],styleGroups:[],extraStyleGroupAssoc:[["uniform-yellow","uniform"]]}),"ddlc.fan.mc2":_("dddg.buildin.mc","ddlc.fan.mc2",{heads:["straight","straight_red"],poses:["normal","crossed_arms","casual","glitching","dragon"],styleGroups:["uniform","casual"],extraPoseAssoc:[["crossed_arms_casual","crossed_arms"],["crossed_arms_red","crossed_arms"],["normal_red","normal"],["casual_red","casual"],["casual_crossed_arms_red","crossed_arms"]],defaultStyleComponents:[{id:"eyes",label:"Eyes",variants:{yellow:"/parts/mc/yellow-eyes{ext}",red:"/parts/mc/red-eyes{ext}"}}]}),"ddlc.fan.mc_chad":_("dddg.buildin.mc_chad","ddlc.fan.mc_chad",{heads:["straight","straight_closed","straight_red"],poses:["normal","youknowihadto"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal_casual","normal"],["youknowihadto_casual","youknowihadto"],["normal_red","normal"],["youknowihadto_red","youknowihadto"],["normal_casual_red","normal"],["youknowihadto_casual_red","youknowihadto"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/chad/yellow-eyes{ext}",red:"/parts/chad/red-eyes{ext}"}}]}),"ddlc.fan.femc":_("dddg.buildin.femc","ddlc.fan.femc",{heads:["straight","straight_lh","straight_closed","straight_hetero","straight_hetero_lh"],poses:["normal","crossed_arms"],styleGroups:["uniform","casual","uniform_strict"],extraPoseAssoc:[["casual_normal","normal"],["casual_crossed_arms","crossed_arms"],["uniform_normal","normal"],["uniform_crossed_arms","crossed_arms"],["normal_long_hair","normal"],["crossed_arms_long_hair","crossed_arms"],["casual_normal_long_hair","normal"],["casual_crossed_arms_long_hair","crossed_arms"],["uniform_normal_long_hair","normal"],["uniform_crossed_arms_long_hair","crossed_arms"],["normal_hetero","normal"],["crossed_arms_hetero","crossed_arms"],["casual_normal_hetero","normal"],["casual_crossed_arms_hetero","crossed_arms"],["uniform_normal_hetero","normal"],["uniform_crossed_arms_hetero","crossed_arms"],["normal_long_hair_hetero","normal"],["crossed_arms_long_hair_hetero","crossed_arms"],["casual_normal_long_hair_hetero","normal"],["casual_crossed_arms_long_hair_hetero","crossed_arms"],["uniform_normal_long_hair_hetero","normal"],["uniform_crossed_arms_long_hair_hetero","crossed_arms"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/femc/yellow-eyes{ext}",hetero:"/parts/femc/hetero-eyes{ext}"}},{label:"Hairs",id:"hairs",variants:{sh:"/parts/femc/short-hair{ext}",lh:"/parts/femc/long-hair{ext}"}}]}),"ddlc.fan.amy1":_("dddg.buildin.amy1","ddlc.fan.amy1",{heads:["straight"],poses:["normal","crossed_arms"],styleGroups:["uniform"]}),"ddlc.fan.amy2":_("dddg.buildin.amy2","ddlc.fan.amy2",{heads:["straight","straight_closed","straight_red"],poses:["normal","folded_hands_up","folded_hands_down","hands_on_glasses"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal-casual","normal"],["folded_hands_up-casual","folded_hands_up"],["folded_hands_down-casual","folded_hands_down"],["hands_on_glasses-casual","hands_on_glasses"]]})};function i(h){return[]}function l(h,v,f){var x={characterId:h.id,packId:h.packId,paths:v};return{id:k("character",h.id,x),chibi:h.chibi,label:h.name,heads:b(h.heads,x,f),styleGroups:a(h,x,f),defaultScale:[.8,.8],size:[960,960],hd:!1}}function a(h,v,f){var x,P,j=r[v.characterId],m=[],T=new Map,R=y(h,v),B=R.length===0?j&&j.defaultStyleComponents?u(j.defaultStyleComponents,v):[]:R,D=h.poses.map(function(C){return C.style}).filter(function(C,A,oe){return oe.indexOf(C)===A}),N=new Map(h.styles.map(function(C){return[C.name,C]})),ee=function(C){var A,oe,pe,Oe,Ie=N.get(C);if(Ie&&Ie.nsfw&&!f)return"continue";var tt=C,K={};try{for(var be=(A=void 0,t(B)),Ce=be.next();!Ce.done;Ce=be.next()){var Ae=Ce.value;try{for(var J=(pe=void 0,t(Object.keys(Ae.variants))),U=J.next();!U.done;U=J.next()){var re=U.value,S=new RegExp("-"+re+"\\b");if(tt.match(S)){K[Ae.id]=re,tt=tt.replace(S,"");break}}}catch(E){pe={error:E}}finally{try{U&&!U.done&&(Oe=J.return)&&Oe.call(J)}finally{if(pe)throw pe.error}}}}catch(E){A={error:E}}finally{try{Ce&&!Ce.done&&(oe=be.return)&&oe.call(be)}finally{if(A)throw A.error}}tt=k("styleGroups",tt,v);var O=T.get(tt);O||(O={id:tt,styleComponents:B,styles:[]},T.set(tt,O),m.push(tt)),O.styles.push({components:K,poses:d(h.poses.filter(function(E){return E.style===C}),v,f)})};try{for(var xe=t(D),z=xe.next();!z.done;z=xe.next()){var I=z.value;ee(I)}}catch(C){x={error:C}}finally{try{z&&!z.done&&(P=xe.return)&&P.call(xe)}finally{if(x)throw x.error}}return m.map(function(C){return T.get(C)})}function u(h,v){return o.mapNormalize(o.normalizeStyleComponent,h,"",{packId:v.packId,paths:v.paths})}function c(h,v){return h?[{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"},{type:"head",offset:v}]:[{type:"head",offset:v},{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"}]}function d(h,v,f){return h.map(function(x){return{compatibleHeads:x.compatibleHeads.map(function(P){return k("heads",P.toString(),v)}),id:k("poses",x.name,v),renderCommands:c(x.headInForeground,x.headAnchor),previewOffset:x.offset,previewSize:x.size,size:[960,960],scale:.8,positions:{Static:"static"in x?[[x.static]]:[],Left:"left"in x?g(x.left,f):[],Right:"right"in x?g(x.right,f):[],Variant:"variant"in x?g(x.variant,f):[]}}})}function g(h,v){return h.filter(function(f){return!f.nsfw||v}).map(function(f){return[f.img]})}function b(h,v,f){var x,P,j={};try{for(var m=t(Object.keys(h)),T=m.next();!T.done;T=m.next()){var R=T.value,B=h[R];B.nsfw&&!f||(j[k("heads",R,v)]={previewOffset:B.offset,previewSize:B.size,variants:B.all.filter(function(D){return!D.nsfw||f}).map(function(D){return[D.img]})})}}catch(D){x={error:D}}finally{try{T&&!T.done&&(P=m.return)&&P.call(m)}finally{if(x)throw x.error}}return j}function y(h,v){var f=[],x=[];return Object.keys(h.eyes).length>0&&(Object.keys(h.eyes).forEach(function(P){return x.push(P)}),f.push({label:"Eyes",id:k("eyes","eyes",v),variants:h.eyes})),Object.keys(h.hairs).length>0&&(Object.keys(h.hairs).forEach(function(P){return x.push(P)}),f.push({label:"Hairs",id:k("hairs","hairs",v),variants:h.hairs})),f}function w(h,v){return new Map(v.map(function(f){return[f,h+":"+f]}))}function _(h,v,f){return f.extraHeadAssoc?f.extraHeadAssoc=f.extraHeadAssoc.map(function(x){return[x[0],h+":"+x[1]]}):f.extraHeadAssoc=[],f.extraPoseAssoc?f.extraPoseAssoc=f.extraPoseAssoc.map(function(x){return[x[0],h+":"+x[1]]}):f.extraPoseAssoc=[],f.extraStyleGroupAssoc?f.extraStyleGroupAssoc=f.extraStyleGroupAssoc.map(function(x){return[x[0],h+":"+x[1]]}):f.extraStyleGroupAssoc=[],{character:h+":"+v,eyes:h+":eyes",hairs:h+":hair",defaultStyleComponents:f.defaultStyleComponents||[],heads:new Map(n(w(h,f.heads),f.extraHeadAssoc)),poses:new Map(n(w(h,f.poses),f.extraPoseAssoc)),styleGroups:new Map(n(w(h,f.styleGroups),f.extraStyleGroupAssoc))}}function k(h,v,f){var x=r[f.characterId];if(x){if(h==="character"||h==="hairs"||h==="eyes")return x[h];var P=x[h].get(v);if(P)return P}return o.expandId(f.packId,v)}return wt.expandOrTranslateId=k,wt}var qm=Wm(),zm=op(),Xr=np();function Gm(t){return t.split("/").slice(0,-1).join("/")+"/"}const Wu=new Set(["png","gif","bmp","svg"]);function sp(){return{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}}}const Xm={namespaced:!0,state:sp(),mutations:{setContentPacks(t,e){t.contentPacks=e},setCurrentContent(t,e){t.current=e}},actions:{removeContentPacks({commit:t,state:e,dispatch:n},o){const s=JSON.parse(JSON.stringify(e.current)),r=e.contentPacks.filter(i=>!o.has(i.packId));t("setContentPacks",r),t("setCurrentContent",r.reduce((i,l)=>js(i,l))),n("panels/fixContentPackRemoval",s,{root:!0})},async replaceContentPack({commit:t,state:e},n){const o=n.processed?n.contentPack:await Js(n.contentPack);let s=e.contentPacks;const r=s.findIndex(i=>i.packId===n.contentPack.packId);r===-1?s.push(o):s.splice(r,1,o),s=s,t("setContentPacks",s),t("setCurrentContent",s.reduce((i,l)=>js(i,l)))},async loadContentPacks({commit:t,state:e},n){typeof n=="string"&&(n=[n]);const o=await Promise.all(n.map(async l=>await jl(l))),s=await Promise.all(o.map(l=>Js(l))),r=new Set(e.contentPacks.map(l=>l.packId));let i=e.current;for(const l of s){for(const a of l.dependencies)if(!r.has(a))throw new Error(`Missing dependency '${a}'. Refusing to install ${l.packId}`);i=js(i,l)}return t("setContentPacks",[...e.contentPacks,...s]),t("setCurrentContent",i),o.map(l=>l.packId)}},getters:{getCharacters({current:t}){const e=new Map;for(const n of t.characters)e.set(n.id,n);return e},getBackgrounds({current:t}){const e=new Map;for(const n of t.backgrounds)e.set(n.id,n);return e}}};async function jl(t){const e=await fetch(t);if(!e.ok)throw new Error(`Could not load content pack. Server responded with: ${e.statusText}`);let n;try{n=await e.json()}catch{throw new Error("Content pack is not valid json!")}try{const o={"./":Gm(t),"/":da};return n.version==="2.0"?zm.normalizeContentPack(n,o):qm.convert(Vm.normalizeCharacter(n,o),o,!1)}catch{throw new Error("Content pack is not in a valid format!")}}async function Js(t){const e=new Set(await co()?["webp",...Wu]:Wu),n=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return Xr.assetWalker(t,o=>{const s=Xr.normalizePath(o,n,e,!1),r=Xr.normalizePath(o,n,e,!0);return{hq:s,lq:r,sourcePack:t.packId??"buildIn"}})}const At=class At{constructor(e,n,o,s){this.r=e,this.g=n,this.b=o,this.a=s,Object.freeze(this)}static validCss(e){return this.validCssRgb(e)||this.validHex(e)}static fromCss(e){if(this.validCssRgb(e))return this.fromCssRgb(e);if(this.validHex(e))return this.fromHex(e);throw new Error("Invalid RGB color format")}static validCssRgb(e){return this.rgbEx.test(e)||this.rgbaEx.test(e)}static fromCssRgb(e){if(!this.validCssRgb(e))throw new Error("Invalid RGB color format");const n=e.slice(0,-1),o=n.indexOf("("),r=n.slice(o+1).split(",").map(i=>parseFloat(i.trim()));return new At(r[0],r[1],r[2],r.length===4?r[3]:1)}static validHex(e){return this.hexShortEx.test(e)||this.hexLongEx.test(e)}static fromHex(e){if(!this.validHex(e))throw new Error("Invalid Hex color format");const n=e.slice(1);if(n.length===3)return new At(parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),1);if(n.length===4)return new At(parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)/255);if(n.length===6)return new At(parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16),1);if(n.length===8)return new At(parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16),parseInt(n[6]+n[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:e,g:n,b:o}=this;const{a:s}=this;e/=255,n/=255,o/=255;const r=Math.max(e,n,o),i=Math.min(e,n,o);let l,a;const u=(r+i)/2;if(r===i)l=a=0;else{const c=r-i;switch(a=u>.5?c/(2-r-i):c/(r+i),r){case e:l=(n-o)/c+(n<o?6:0);break;case n:l=(o-e)/c+2;break;case o:l=(e-n)/c+4;break}l/=6}return new He(l,a,u,s)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};L(At,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i),L(At,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i),L(At,"hexShortEx",/^#[0-9A-F]{3,4}$/i),L(At,"hexLongEx",/^#[0-9A-F]{6,8}$/i);let De=At;class He{constructor(e,n,o,s){this.h=e,this.s=n,this.l=o,this.a=s,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(e){let{h:n,s:o,l:s,a:r}=this;return n+=e.h,n>=1?n-=1:n<0&&(n+=1),o+e.s>1?o-=e.s:(o+=e.s,o<0&&(o=0)),s+e.l>1||s+e.l<0?s-=e.l:s+=e.l,r+e.a>1||r+e.a<0?r-=e.a:r+=e.a,new He(n,o,s,r)}toRgb(){const{h:e,s:n,l:o,a:s}=this;let r,i,l;if(n===0)r=i=l=o;else{const a=o<.5?o*(1+n):o+n-o*n,u=2*o-a;r=He.hue2rgb(u,a,e+1/3),i=He.hue2rgb(u,a,e),l=He.hue2rgb(u,a,e-1/3)}return new De(Math.round(r*255),Math.round(i*255),Math.round(l*255),s)}toHSL(){return this}static hue2rgb(e,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+(n-e)*6*o:o<1/2?n:o<2/3?e+(n-e)*(2/3-o)*6:e}}const wr=1280,ba=720,Ym=128,Km=32,Jm="rgba(60,60,60,0.8)",Zm=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],rp=1,Qm=1/1.5,eb=-74,tb=358,nb=[200,240,400,493,640,786,880,1040,1080],ob=Object.freeze(Object.defineProperty({__proto__:null,BaseCharacterYPos:tb,CloseUpYOffset:eb,WheelBackground:Jm,characterPositions:nb,hdCharacterScaleFactor:Qm,positions:Zm,screenHeight:ba,screenWidth:wr,sdCharacterScaleFactor:rp,wheelInnerRadius:Ym,wheelWidth:Km},Symbol.toStringTag,{value:"Module"})),sb=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),rb="#ffe6f4",ib="#ffbde1",lb=420,ab=22,ub=640,ip=270,cb=7,lp=3,db=Math.ceil(lp/2),fb=(ba-ip)/2,pb={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},hb=Object.freeze(Object.defineProperty({__proto__:null,ChoiceButtonBorderColor:ib,ChoiceButtonColor:rb,ChoiceButtonWidth:lb,ChoiceOuterPadding:db,ChoicePadding:cb,ChoiceSpacing:ab,ChoiceTextStyle:pb,ChoiceX:ub,ChoiceY:fb,ChoiceYOffset:ip,Outline:lp,nameboxTextOutlineDelta:sb},Symbol.toStringTag,{value:"Module"})),ap="#ffa8d2",gb="#552222",vb="#ffeef6",ya="#bb5599",up=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),cp=new He(.002028397565922768,0,.13725490196078438,0),dp=.82,fp=new He(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),pp=12,hp=12,mb=.6,bb=new He(.08045977011494243,-.5714285714285714,-.5960784313725489,0),yb=new He(0,-.14285714285714296,.3,0),wb=new He(.004269293924466178,-.01869158878504662,-.039215686274509665,0),kb=9.5,Cb=47,gp=new He(.0023347701149424305,0,.10784313725490202,0),zn=3,vp=Object.freeze(Object.defineProperty({__proto__:null,controlColorDelta:bb,controlDisableColorDelta:yb,controlsDefaultColor:gb,dotColorDelta:wb,dotPatternSize:Cb,dotRadius:kb,nameColorThreshold:mb,nameboxBackgroundDelta:cp,nameboxDefaultColor:vb,nameboxGradientEndDelta:fp,nameboxGradientMiddleStopPosition:dp,nameboxRounding:pp,nameboxStrokeDefaultColor:ya,nameboxTextOutlineDelta:up,textboxDefaultColor:ap,textboxOutlineColorDelta:gp,textboxOutlineWidth:zn,textboxRounding:hp},Symbol.toStringTag,{value:"Module"})),Co=816,wa=900,kr=146,xb=0,Sb=29,_b=8,fs=38,Cr=44,Pb=6,Ob=93,Tb=404,Ib=9,jb=9,En=39,ps=168,hs=34,xr=29,ka=12,Ca=-126,xa=-72,Sa=-38,_a=30.75,Pa=26,mp=426,$l=58,Oa={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Sr={...Oa,fontName:"riffic",fontSize:24,strokeColor:ya,strokeWidth:6,color:"white",letterSpacing:1},Ta={align:"left",font:"13px aller",fill:{style:"#522"}},bp={...Ta,fill:{style:"#a66"}},$b={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},Ia={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},xo=wr/2-Co/2,Ab=wr/2-wa/2,Rb=xo+fs,yp=xo+hs,Mb=yp+ps/2,Bb=xo+Ca,Eb=xo+xa,Db=xo+Sa,Lb="normal",Nb=Object.freeze(Object.defineProperty({__proto__:null,ArrowXRightOffset:_a,ArrowYBottomOffset:Pa,BaseTextStyle:Oa,ControlsTextDisabledStyle:bp,ControlsTextStyle:Ta,ControlsXHistory:Bb,ControlsXHistoryOffset:Ca,ControlsXSkip:Eb,ControlsXSkipOffset:xa,ControlsXStuff:Db,ControlsXStuffOffset:Sa,ControlsYBottomOffset:ka,DefaultTextboxStyle:Lb,GlowRX:mp,GlowRY:$l,HdSideMargin:Tb,HdSpacing:Ob,NameboxHeight:En,NameboxTextStyle:Sr,NameboxTextX:Mb,NameboxTextYOffset:xr,NameboxWidth:ps,NameboxX:yp,NameboxXOffset:hs,TextBoxBottomSpacing:Pb,TextBoxCorruptedKerning:_b,TextBoxCorruptedStyle:$b,TextBoxCorruptedWidth:wa,TextBoxCorruptedX:Ab,TextBoxHeight:kr,TextBoxKerning:xb,TextBoxLineHeight:Sb,TextBoxStyle:Ia,TextBoxTextCorruptedXOffset:Ib,TextBoxTextCorruptedYOffset:jb,TextBoxTextX:Rb,TextBoxTextXOffset:fs,TextBoxTextYOffset:Cr,TextBoxWidth:Co,TextBoxX:xo},Symbol.toStringTag,{value:"Module"})),Fb="#ffe6f4",Hb="#ffbde1",Ub="rgba(255,255,255,0.6)",Vb=40,Wb=30,qb={...Oa,fontName:"riffic",fontSize:24,strokeColor:ya,strokeWidth:8,letterSpacing:1,color:"white"},zb={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Gb=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackdropColor:Ub,NotificationBackgroundColor:Fb,NotificationBorderColor:Hb,NotificationOkTextStyle:qb,NotificationPadding:Vb,NotificationSpacing:Wb,NotificationTextStyle:zb},Symbol.toStringTag,{value:"Module"})),wp=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Xb=0,Yb=0,Kb=wr/2,Jb=ba/2,Zb=33,Qb=100,ey=30,ty=800,ny=720,oy=rp,sy="#333333bf",ry=480,iy=180,ly=3,ay=7,ln={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},kp=[{...ln,name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0},{...ln,name:"Natsuki",fontName:"ammy_handwriting",fontSize:28},{...ln,name:"Monika",fontName:"journal",fontSize:34},{...ln,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32},{...ln,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8},{...ln,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40},{...ln,name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53},{...ln,name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1}],uy=Object.freeze(Object.defineProperty({__proto__:null,backgroundScale:oy,consoleBackgroundColor:sy,consoleHeight:iy,consoleWidth:ry,defaultConsoleBackground:ly,defaultConsoleStyle:ay,defaultPoemBackground:Xb,defaultPoemHeight:ny,defaultPoemStyle:Yb,defaultPoemWidth:ty,defaultX:Kb,defaultY:Jb,poemBackgrounds:wp,poemBottomPadding:Qb,poemPadding:ey,poemTextStyles:kp,poemTopPadding:Zb},Symbol.toStringTag,{value:"Module"})),cy={Base:ob,Choices:hb,Notification:Gb,Poem:uy,TextBox:Nb,TextBoxCustom:vp},_r=1920,ja=1080,dy=128,fy=32,py="rgba(60,60,60,0.8)",hy=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Cp=1.5,gy=1,vy=-111,my=537,by=[300,360,600,740,960,1180,1320,1560,1620],yy=Object.freeze(Object.defineProperty({__proto__:null,BaseCharacterYPos:my,CloseUpYOffset:vy,WheelBackground:py,characterPositions:by,hdCharacterScaleFactor:gy,positions:hy,screenHeight:ja,screenWidth:_r,sdCharacterScaleFactor:Cp,wheelInnerRadius:dy,wheelWidth:fy},Symbol.toStringTag,{value:"Module"})),wy=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),ky="#ffe6f4",Cy="#ffbde1",xy=630,Sy=33,_y=960,xp=405,Py=10.5,Sp=4.5,Oy=Math.ceil(Sp/2),Ty=(ja-xp)/2,Iy={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},jy=Object.freeze(Object.defineProperty({__proto__:null,ChoiceButtonBorderColor:Cy,ChoiceButtonColor:ky,ChoiceButtonWidth:xy,ChoiceOuterPadding:Oy,ChoicePadding:Py,ChoiceSpacing:Sy,ChoiceTextStyle:Iy,ChoiceX:_y,ChoiceY:Ty,ChoiceYOffset:xp,Outline:Sp,nameboxTextOutlineDelta:wy},Symbol.toStringTag,{value:"Module"})),_p="#ffa8d2",$y="#552222",Ay="#ffeef6",$a="#bb5599",Pp=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Op=new He(.002028397565922768,0,.13725490196078438,0),Tp=.82,Ip=new He(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),jp=15,$p=19,Ry=.6,My=new He(.08045977011494243,-.5714285714285714,-.5960784313725489,0),By=new He(0,-.14285714285714296,.3,0),Ey=new He(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Dy=9.5*1.5,Ly=47*1.5,Ap=new He(.0023347701149424305,0,.10784313725490202,0),Gn=5,Rp=Object.freeze(Object.defineProperty({__proto__:null,controlColorDelta:My,controlDisableColorDelta:By,controlsDefaultColor:$y,dotColorDelta:Ey,dotPatternSize:Ly,dotRadius:Dy,nameColorThreshold:Ry,nameboxBackgroundDelta:Op,nameboxDefaultColor:Ay,nameboxGradientEndDelta:Ip,nameboxGradientMiddleStopPosition:Tp,nameboxRounding:jp,nameboxStrokeDefaultColor:$a,nameboxTextOutlineDelta:Pp,textboxDefaultColor:_p,textboxOutlineColorDelta:Ap,textboxOutlineWidth:Gn,textboxRounding:$p},Symbol.toStringTag,{value:"Module"})),Aa=1220,Mp=900,Bp=219,Ny=0,Fy=29,Hy=8,Ra=57,Ep=68,Uy=54,Vy=9,Wy=9,Ma=59,Ba=252,Ea=49,Dp=43,Lp=12*1.5,Np=-126*1.5,Fp=-72*1.5,Hp=-38*1.5,Up=30.75*1.5,Vp=26*1.5,Wp=426*1.5,Al=58*1.5,Da={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},qp={...Da,fontName:"riffic",fontSize:36,strokeColor:$a,strokeWidth:9,color:"white",letterSpacing:2},Zs={align:"left",font:"24px aller",fill:{style:"#522"}},zp={...Zs,fill:{style:"#a66"}},Gp={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},qy={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},So=_r/2-Aa/2,zy=_r/2-Mp/2,Gy=So+Ra,Xp=So+Ea,Xy=Xp+Ba/2,Yy=So+Np,Ky=So+Fp,Jy=So+Hp,Zy="custom_plus",Qy=Object.freeze(Object.defineProperty({__proto__:null,ArrowXRightOffset:Up,ArrowYBottomOffset:Vp,BaseTextStyle:Da,ControlsTextDisabledStyle:zp,ControlsTextStyle:Zs,ControlsXHistory:Yy,ControlsXHistoryOffset:Np,ControlsXSkip:Ky,ControlsXSkipOffset:Fp,ControlsXStuff:Jy,ControlsXStuffOffset:Hp,ControlsYBottomOffset:Lp,DefaultTextboxStyle:Zy,GlowRX:Wp,GlowRY:Al,NameboxHeight:Ma,NameboxTextStyle:qp,NameboxTextX:Xy,NameboxTextYOffset:Dp,NameboxWidth:Ba,NameboxX:Xp,NameboxXOffset:Ea,TextBoxBottomSpacing:Uy,TextBoxCorruptedKerning:Hy,TextBoxCorruptedStyle:qy,TextBoxCorruptedWidth:Mp,TextBoxCorruptedX:zy,TextBoxHeight:Bp,TextBoxKerning:Ny,TextBoxLineHeight:Fy,TextBoxStyle:Gp,TextBoxTextCorruptedXOffset:Vy,TextBoxTextCorruptedYOffset:Wy,TextBoxTextX:Gy,TextBoxTextXOffset:Ra,TextBoxTextYOffset:Ep,TextBoxWidth:Aa,TextBoxX:So},Symbol.toStringTag,{value:"Module"})),e0="#ffe6f4",t0="#ffbde1",n0="rgba(255,255,255,0.6)",o0=60,s0=45,r0={...Da,fontName:"riffic",fontSize:36,strokeColor:$a,strokeWidth:12,letterSpacing:1,color:"white"},i0={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},l0=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackdropColor:n0,NotificationBackgroundColor:e0,NotificationBorderColor:t0,NotificationOkTextStyle:r0,NotificationPadding:o0,NotificationSpacing:s0,NotificationTextStyle:i0},Symbol.toStringTag,{value:"Module"})),a0=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],u0=0,c0=0,d0=_r/2,f0=ja/2,p0=26,h0=150,g0=61,v0=1200,m0=1080,b0=Cp,y0="#333333bf",w0=720,k0=270,C0=3,x0=7,an={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:18},S0=[{...an,name:"Sayori",fontName:"hashtag",fontSize:45,lineSpacing:.95,letterSpacing:1},{...an,name:"Natsuki",fontName:"ammy_handwriting",fontSize:41,letterSpacing:-.5},{...an,name:"Monika",fontName:"journal",fontSize:36,lineSpacing:1.4,letterSpacing:.5},{...an,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.55,fontSize:48},{...an,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:27,letterSpacing:-12},{...an,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:60},{...an,name:"MC",fontName:"halogen",fontSize:45,lineSpacing:1.53},{...an,name:"Console",fontName:"f25_bank_printer",fontSize:27,color:"white",lineSpacing:1.1}],_0=Object.freeze(Object.defineProperty({__proto__:null,backgroundScale:b0,consoleBackgroundColor:y0,consoleHeight:k0,consoleWidth:w0,defaultConsoleBackground:C0,defaultConsoleStyle:x0,defaultPoemBackground:u0,defaultPoemHeight:m0,defaultPoemStyle:c0,defaultPoemWidth:v0,defaultX:d0,defaultY:f0,poemBackgrounds:a0,poemBottomPadding:h0,poemPadding:g0,poemTextStyles:S0,poemTopPadding:p0},Symbol.toStringTag,{value:"Module"})),P0={Base:yy,Choices:jy,Notification:l0,Poem:_0,TextBox:Qy,TextBoxCustom:Rp};function ue(){return he.gameMode==="ddlc_plus"?P0:cy}function Qs(t,e,n){return t>e?t:e>n?n:e}function Rl(t,e){return(t%e+e)%e}function O0(t,e){return t===null&&e===null?!0:t===null||e===null?!1:t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.e===e.e&&t.f===e.f}function er(t){const{a:e,b:n,c:o,d:s,e:r,f:i}=t,l=e*s-n*o,a={x:r,y:i,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||n!=0){const u=Math.sqrt(e*e+n*n);a.rotation=(n>0?Math.acos(e/u):-Math.acos(e/u))/Math.PI*180,a.scaleX=u,a.scaleY=l/u,a.skewX=Math.atan((e*o+n*s)/(u*u))/Math.PI*180,a.skewY=0}else if(o!=0||s!=0){const u=Math.sqrt(o*o+s*s);a.rotation=(Math.PI/2-(s>0?Math.acos(-o/u):-Math.acos(o/u)))/Math.PI*180,a.scaleX=l/u,a.scaleY=u,a.skewX=0,a.skewY=Math.atan((e*o+n*s)/(u*u))/Math.PI*180}return a}function T0(t){var n,o,s;const e=Object.values(t.panels.panels);if(!e.find(r=>Object.values(r.objects).find(i=>"scaleX"in i)))for(const r of e)for(const i of Object.values(r.objects)){i.scaleX=i.zoom??1,i.scaleY=i.zoom??1,i.skewX=0,i.skewY=0,i.linkedTo=null;const l=ue();if(i.type==="character"){const a=i,u=t.content.current.characters.find(d=>d.id===a.characterType),c=((s=(o=(n=u==null?void 0:u.styleGroups[a.styleGroupId])==null?void 0:n.styles[a.styleId])==null?void 0:o.poses[a.poseId])==null?void 0:s.size)??[960,960];Yp(a,i.zoom??1,c)}if(i.type==="textBox"){const a=i;a.height+=l.TextBox.NameboxHeight,a.y+=a.height/2}i.type==="sprite"&&(i.requireFixing25=!0,t.requireFixing25=!0),delete i.zoom}}function Yp(t,e,n){let o=new DOMMatrixReadOnly().translate(t.x,t.y+t.height/2);o=o.translate(0,-t.height/2).scale(t.width/n[0],t.height/n[1]).translate(0,n[1]/2),o=o.rotate(t.flip?-t.rotation:t.rotation),o=o.translate(0,n[1]/2).scale(e).translate(0,-n[1]/2);const s=t.rotation;Object.assign(t,er(o)),t.rotation=t.flip?360-s:s,t.skewX=0,t.skewY=0,t.width=n[0],t.height=n[1]}const I0={fixSprites2_5(t,e){for(const n of Object.values(t.panels.panels))for(const o of Object.values(n.objects)){if(o.type!=="sprite"||!o.requireFixing25||o.scaleX!==o.scaleY)continue;const s=o;s.assets.length===1&&s.assets[0].hq===e.url&&(Yp(s,o.scaleX,e.size),delete o.requireFixing25)}}};async function j0(t,e,n){if("requireFixing25"in t){const o=await fo(n);e("fixSprites2_5",{url:n,size:[o.width,o.height]},{root:!0})}}function $0(t){return!t.requireFixing25}function Fo(t,e,n){let o=e+n;const s=t.length;return o<0&&(o+=s),o>=s&&(o-=s),o}var en=(t=>(t[t.None=0]="None",t[t.Selected=1]="Selected",t[t.Focused=2]="Focused",t[t.Indirectly=4]="Indirectly",t))(en||{});const A0={0:void 0,1:"#f00",2:"#00f",3:"#f0f",4:"#f66",6:"#f6f"};function po(t){t.width=0,t.height=0,La.delete(t.disposalId||0)}function Dn(){const t=document.createElement("canvas");return M0(t),t}const La=new Map;let R0=0;function M0(t){t.disposalId=R0++,!(typeof WeakRef>"u")&&La.set(t.disposalId,new WeakRef(t))}window.addEventListener("unload",()=>{La.forEach(t=>{const e=t.deref();e&&po(e)})});class Xn{}class ho{constructor(e,n,o,s){L(this,"aborted",!1);this.canvas=e,this.fsCtx=n,this.hq=o,this.preview=s}static make(e,n,o){return new ho(e,e.getContext("2d"),n,o)}static makeWithContext(e,n,o,s){return new ho(e,n,o,s)}drawText(e){if(this.aborted)throw new Xn;this.fsCtx.save();const{font:n,align:o,x:s=0,y:r=0,text:i=""}={font:"20px aller",align:"left",...e};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width,this.fsCtx.strokeText(i,s,r)),e.fill&&(this.fsCtx.fillStyle=e.fill.style,this.fsCtx.fillText(i,s,r)),this.fsCtx.restore()}measureText(e){if(this.aborted)throw new Xn;this.fsCtx.save();const{font:n,align:o,text:s=""}={font:"20px aller",align:"left",...e};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width),e.fill&&(this.fsCtx.fillStyle=e.fill.style);const r=this.fsCtx.measureText(s);return this.fsCtx.restore(),r}drawImage(e){if(this.aborted)throw new Xn;const{image:n,flip:o,x:s,y:r,w:i,h:l,filters:a,composite:u}={flip:!1,w:e.image.width,h:e.image.height,composite:"source-over",...e};if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=u,a)if("filter"in this.fsCtx){const c=[];for(const d of a)d.type==="drop-shadow"?c.push(`drop-shadow(${d.offsetX}px ${d.offsetY}px ${d.blurRadius}px ${d.color})`):d.type==="hue-rotate"?c.push(`hue-rotate(${d.value}deg)`):d.type==="blur"?c.push(`blur(${d.value}px)`):c.push(`${d.type}(${d.value*100}%)`);this.fsCtx.filter=c.join(" ")}else{let c=1;for(const d of a)d.type==="opacity"&&(c*=d.value);this.fsCtx.globalAlpha=c}if(e.shadow){const c=e.shadow;c.color!=null&&(this.fsCtx.shadowColor=c.color),c.blur!=null&&(this.fsCtx.shadowBlur=c.blur),c.offsetX!=null&&(this.fsCtx.shadowOffsetX=c.offsetX),c.offsetY!=null&&(this.fsCtx.shadowOffsetY=c.offsetY)}if(e.rotation!=null&&e.rotation!==0){const c=e.rotationAnchor?e.rotationAnchor.x:0,d=e.rotationAnchor?e.rotationAnchor.y:0;e.rotationAnchor&&this.fsCtx.translate(c,d),this.fsCtx.rotate(e.rotation),e.rotationAnchor&&this.fsCtx.translate(-c,-d)}this.fsCtx.translate(s+i/2,r+l/2),this.fsCtx.scale(o?-1:1,1),n.paintOnto(this.fsCtx,{x:-i/2,y:-l/2,w:i,h:l}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:e,y:n,w:o,h:s,outline:r,fill:i,composition:l,rotation:a,rotationAnchor:u}){if(this.aborted)throw new Xn;if(this.fsCtx.save(),a!=null&&a!==0){const c=u?u.x:0,d=u?u.y:0;u&&this.fsCtx.translate(c,d),this.fsCtx.rotate(a),u&&this.fsCtx.translate(-c,-d)}this.fsCtx.beginPath(),this.fsCtx.rect(e,n,o,s),l&&(this.fsCtx.globalCompositeOperation=l),i&&(this.fsCtx.fillStyle=i.style,this.fsCtx.fill()),r&&(this.fsCtx.strokeStyle=r.style,this.fsCtx.lineWidth=r.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:e,fill:n,path:o}){if(this.aborted)throw new Xn;this.fsCtx.save(),this.fsCtx.beginPath(),o(this.fsCtx),n&&(this.fsCtx.fillStyle=n.style,this.fsCtx.fill()),e&&(this.fsCtx.strokeStyle=e.style,this.fsCtx.lineWidth=e.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(e,n="repeat"){return e instanceof Kp&&(e=e.previewCanvas),this.fsCtx.createPattern(e,n)}async customTransform(e,n){this.fsCtx.save(),await e(this.fsCtx),await n(this),this.fsCtx.restore()}linearGradient(e,n,o,s){return this.fsCtx.createLinearGradient(e,n,o,s)}applyFilters(e){if(e.length===0)return;this.fsCtx.save();let n=1;for(const o of e)o.type==="opacity"&&(n*=o.value);if("filter"in this.fsCtx){const o=[];for(const s of e)s.type!=="opacity"&&(s.type==="drop-shadow"?o.push(`drop-shadow(${s.offsetX}px ${s.offsetY}px ${s.blurRadius}px ${s.color})`):s.type==="hue-rotate"?o.push(`hue-rotate(${s.value}deg)`):s.type==="blur"?o.push(`blur(${s.value}px)`):o.push(`${s.type}(${s.value*100}%)`));this.fsCtx.filter=o.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),n!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${n})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}class Kp{constructor(e,n){L(this,"previewCanvas");L(this,"runningContext",null);L(this,"_disposed",!1);const o=ue();this.previewCanvas=Dn(),this.previewCanvas.width=e??o.Base.screenWidth,this.previewCanvas.height=n??o.Base.screenHeight}get disposed(){return this._disposed}async render(e,n=!0,o=!0){this.runningContext&&this.runningContext.abort();const s=this.previewCanvas.getContext("2d");s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const r=this.runningContext=ho.makeWithContext(this.previewCanvas,s,n,o);try{await e(this.runningContext)}catch(i){if(i instanceof Xn)return!1;throw i}finally{r===this.runningContext&&(this.runningContext=null)}return!0}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(e,n){n.w!=null&&n.h!=null?e.drawImage(this.previewCanvas,n.x,n.y,n.w,n.h):e.drawImage(this.previewCanvas,n.x,n.y)}async download(e,n){const o=await this.drawToCanvas(e);return await he.saveToFile(o,n)}async renderToBlob(e){const n=await this.drawToCanvas(e);return await new Promise((o,s)=>{n.toBlob(r=>{r?o(r):s()})})}async drawToCanvas(e){const n=Dn();n.width=this.previewCanvas.width,n.height=this.previewCanvas.height;const o=n.getContext("2d");return o.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),await e(ho.makeWithContext(n,o,!0,!1)),n}dispose(){this.runningContext&&this.runningContext.abort(),po(this.previewCanvas),this._disposed=!0}getDataAt(e,n){return this.previewCanvas.getContext("2d").getImageData(e,n,1,1).data}}function _o(){return{flip:!1,rotation:0,version:0,opacity:100,x:ue().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,scaleX:1,scaleY:1,ratio:1,preserveRatio:!0,skewX:0,skewY:0,linkedTo:null}}const B0={setPose(t,e){const n=t.panels[e.panelId].objects[e.id];n.poseId=e.poseId,++n.version},setCharStyleGroup(t,{id:e,panelId:n,styleGroupId:o}){const s=t.panels[n].objects[e];s.styleGroupId=o,++s.version},setCharStyle(t,{id:e,panelId:n,styleId:o}){const s=t.panels[n].objects[e];s.styleId=o,++s.version},setClose(t,e){const n=t.panels[e.panelId].objects[e.id];n.close=e.close,++n.version},setPosePosition(t,e){const n=t.panels[e.panelId].objects[e.id];n.posePositions={...n.posePositions,...e.posePositions},++n.version},setFreeMove(t,e){const n=t.panels[e.panelId].objects[e.id];if(n.freeMove=e.freeMove,!n.freeMove){const o=ue();n.x=o.Base.characterPositions[nr(n.x)],n.y=o.Base.BaseCharacterYPos}}};function Pr(t,e){return t.getters["content/getCharacters"].get(e.characterType)}function _n(t,e){return t["content/getCharacters"].get(e)}function go(t,e){return t.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId]}function E0(t,e){const n=go(t,e),o=Object.keys(n.positions).filter(s=>n.positions[s].length>1);return n.compatibleHeads.length>0&&o.unshift("head"),o}function tr(t,e,n=e.posePositions.headType||0){const o=go(t,e).compatibleHeads;return o.length===0?null:t.heads[o[n]]}function nr(t){return ue().Base.characterPositions.map((o,s)=>({pos:Math.abs(t-o),idx:s})).sort((o,s)=>o.pos-s.pos)[0].idx}const D0={createCharacters({rootState:t,rootGetters:e,commit:n,state:o},s){const r=o.panels[s.panelId].lastObjId+1,i=ue(),l=_n(e,s.characterType),a=l.hd?i.Base.hdCharacterScaleFactor:i.Base.sdCharacterScaleFactor;return n("create",{object:{..._o(),id:r,panelId:t.panels.currentPanel,onTop:!1,type:"character",y:i.Base.BaseCharacterYPos,width:l.size[0],height:l.size[1],scaleX:l.defaultScale[0]*a,scaleY:l.defaultScale[1]*a,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:l.label??l.id,enlargeWhenTalking:t.ui.defaultCharacterTalkingZoom,linkedTo:null}}),r},seekPart({state:t,commit:e,dispatch:n,rootGetters:o},{delta:s,id:r,panelId:i,part:l}){if(l==="head"){n("seekHead",{id:r,panelId:i,delta:s});return}const a=t.panels[i].objects[r],u=go(_n(o,a.characterType),a);u.positions[l]&&e("setPosePosition",{id:r,panelId:i,posePositions:{[l]:Fo(u.positions[l],a.posePositions[l]||0,s)}})},seekPose({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=_n(n,i.characterType),a=l.styleGroups[i.styleGroupId].styles[i.styleId].poses;Vn(e,i,l,u=>{u.poseId=Fo(a,u.poseId,r)})},seekStyle({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=_n(n,i.characterType),a=l.styleGroups.flatMap((c,d)=>c.styles.map((g,b)=>({styleGroupIdx:d,styleIdx:b,styleGroupJson:JSON.stringify(g.components)}))).sort((c,d)=>c.styleGroupJson.localeCompare(d.styleGroupJson)),u=a.findIndex(c=>c.styleGroupIdx===i.styleGroupId&&c.styleIdx===i.styleId);Vn(e,i,l,c=>{const d=Fo(a,u,r),g=a[d];c.styleGroupId=g.styleGroupIdx,c.styleId=g.styleIdx})},seekHead({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=_n(n,i.characterType),a=go(l,i);let u=tr(l,i);if(!u)return;let c=(i.posePositions.head||0)+r,d=i.posePositions.headType||0;(c<0||c>=u.variants.length)&&(d=Fo(a.compatibleHeads.map(g=>l.heads[g]),d,r),u=tr(l,i,d),c=r===1?0:u.variants.length-1),e("setPosePosition",{id:o,panelId:s,posePositions:{head:c,headType:d}})},setPart({state:t,commit:e,rootGetters:n},{panelId:o,id:s,part:r,val:i}){const l=t.panels[o].objects[s],a=_n(n,l.characterType);r==="pose"?Vn(e,l,a,u=>{u.poseId=i}):r==="style"?Vn(e,l,a,u=>{u.styleId=i}):Vn(e,l,a,u=>{u.posePositions[r]=i})},setCharStyle({state:t,commit:e,rootGetters:n},{panelId:o,id:s,styleGroupId:r,styleId:i}){const l=t.panels[o].objects[s],a=_n(n,l.characterType);Vn(e,l,a,u=>{u.styleGroupId=r,u.styleId=i})},setCharacterPosition({state:t,commit:e},{panelId:n,id:o,x:s,y:r}){const i=t.panels[n].objects[o];if(!i.freeMove){const l=ue();s=l.Base.characterPositions[nr(s)],r=l.Base.BaseCharacterYPos}i.x===s&&i.y===r||e("setPosition",{panelId:n,id:o,x:s,y:r})},shiftCharacterSlot({state:t,commit:e},{panelId:n,id:o,delta:s}){const r=t.panels[n].objects[o],i=ue();let a=nr(r.x)+s;a<0&&(a=0),a>=i.Base.characterPositions.length&&(a=i.Base.characterPositions.length-1),e("setPosition",{panelId:n,id:o,x:i.Base.characterPositions[a],y:r.y})}};async function L0(t,e,n,o){const s=t.state.panels[e].objects[n],r=o.characters.find(f=>f.id===s.characterType);if(!r){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:n,panelId:e});return}const i=Jp(s),l=r.styleGroups[s.styleGroupId],a=l.styles[i.styleId],u=a.poses[i.poseId],c=t.rootState.content.current.characters.find(f=>f.id===r.id);if(!c){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:n,panelId:e});return}const d=c.styleGroups.findIndex(f=>f.id===l.id);i.styleGroupId=d===-1?0:d;const g=c.styleGroups[i.styleGroupId],b=JSON.stringify(a.components),y=g.styles.findIndex(f=>JSON.stringify(f.components)===b);i.styleId=y===-1?0:y;const w=g.styles[i.styleId],_=w.poses.findIndex(f=>f.id===u.id);i.poseId=_===-1?0:_;const k=w.poses[i.poseId];for(const f in k.positions){if(!Object.prototype.hasOwnProperty.call(k.positions,f))continue;const x=k.positions[f];if(u.positions[f]){const P=i.posePositions[f];P>=0&&P<x.length}}const h=u.compatibleHeads[s.posePositions.headType],v=k.compatibleHeads.indexOf(h);if(v===-1)i.posePositions.headType=0,i.posePositions.head=0;else{v!==s.posePositions.headType&&(i.posePositions.headType=v);const f=JSON.stringify(r.heads[h].variants[s.posePositions.head]),x=c.heads[h].variants.findIndex(P=>JSON.stringify(P)===f);x===-1?i.posePositions.head=0:i.posePositions.head=x}Zp(t.commit,s,i)}function Jp(t){return{styleGroupId:t.styleGroupId,styleId:t.styleId,poseId:t.poseId,posePositions:{...t.posePositions}}}function Zp(t,e,n){n.styleGroupId!==e.styleGroupId&&t("setCharStyleGroup",{id:e.id,panelId:e.panelId,styleGroupId:n.styleGroupId}),n.styleId!==e.styleId&&(console.log(`Setting style of ${e.id} to ${n.styleId}`),t("setCharStyle",{id:e.id,panelId:e.panelId,styleId:n.styleId})),n.poseId!==e.poseId&&t("setPose",{id:e.id,panelId:e.panelId,poseId:n.poseId}),JSON.stringify(n.posePositions)!==JSON.stringify(e.posePositions)&&t("setPosePosition",{id:e.id,panelId:e.panelId,posePositions:n.posePositions})}function Vn(t,e,n,o){const s=Jp(e);o(s),n.styleGroups[s.styleGroupId]||(s.styleGroupId=0);const r=n.styleGroups[s.styleGroupId];r.styles[s.styleId]||(s.styleId=0);const i=r.styles[s.styleId];i.poses[s.poseId]||(s.poseId=0);const l=i.poses[s.poseId];for(const d in l.positions)l.positions[d]&&(l.positions[d][s.posePositions[d]]||(s.posePositions[d]=0));const u=n.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId].compatibleHeads[e.posePositions.headType||0],c=l.compatibleHeads.indexOf(u);c>=0?s.posePositions.headType=c:(s.posePositions.headType=0,s.posePositions.head=0),Zp(t,e,s)}var Pn={},Yr={},qu;function N0(){return qu||(qu=1,Object.defineProperty(Yr,"__esModule",{value:!0})),Yr}var Kr={},zu;function F0(){return zu||(zu=1,Object.defineProperty(Kr,"__esModule",{value:!0})),Kr}var Jr={},Gu;function H0(){return Gu||(Gu=1,Object.defineProperty(Jr,"__esModule",{value:!0})),Jr}var Zr={},Xu;function U0(){return Xu||(Xu=1,Object.defineProperty(Zr,"__esModule",{value:!0})),Zr}var Qr={},Yu;function V0(){return Yu||(Yu=1,Object.defineProperty(Qr,"__esModule",{value:!0})),Qr}var ei={},Ku;function W0(){return Ku||(Ku=1,Object.defineProperty(ei,"__esModule",{value:!0})),ei}var ti={},Ju;function q0(){return Ju||(Ju=1,Object.defineProperty(ti,"__esModule",{value:!0})),ti}var ni={},Zu;function z0(){return Zu||(Zu=1,Object.defineProperty(ni,"__esModule",{value:!0})),ni}var oi={},Qu;function G0(){return Qu||(Qu=1,Object.defineProperty(oi,"__esModule",{value:!0})),oi}var si={},ec;function X0(){return ec||(ec=1,Object.defineProperty(si,"__esModule",{value:!0})),si}var ri={},tc;function Y0(){return tc||(tc=1,Object.defineProperty(ri,"__esModule",{value:!0})),ri}var ii={},nc;function K0(){return nc||(nc=1,Object.defineProperty(ii,"__esModule",{value:!0})),ii}var li={},oc;function J0(){return oc||(oc=1,Object.defineProperty(li,"__esModule",{value:!0})),li}var ai={},sc;function Z0(){return sc||(sc=1,Object.defineProperty(ai,"__esModule",{value:!0})),ai}var ui={},rc;function Q0(){return rc||(rc=1,Object.defineProperty(ui,"__esModule",{value:!0})),ui}var ci={},ic;function ew(){return ic||(ic=1,Object.defineProperty(ci,"__esModule",{value:!0})),ci}var di={},lc;function tw(){return lc||(lc=1,Object.defineProperty(di,"__esModule",{value:!0})),di}var fi={},ac;function nw(){return ac||(ac=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi}var pi={},uc;function ow(){return uc||(uc=1,Object.defineProperty(pi,"__esModule",{value:!0})),pi}var hi={},cc;function sw(){return cc||(cc=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var gi={},dc;function rw(){return dc||(dc=1,Object.defineProperty(gi,"__esModule",{value:!0})),gi}var vi={},fc;function iw(){return fc||(fc=1,Object.defineProperty(vi,"__esModule",{value:!0})),vi}var mi={},pc;function lw(){return pc||(pc=1,Object.defineProperty(mi,"__esModule",{value:!0})),mi}var bi={},hc;function aw(){return hc||(hc=1,Object.defineProperty(bi,"__esModule",{value:!0})),bi}var yi={},gc;function uw(){return gc||(gc=1,Object.defineProperty(yi,"__esModule",{value:!0})),yi}var wi={},vc;function cw(){return vc||(vc=1,Object.defineProperty(wi,"__esModule",{value:!0})),wi}var ki={},mc;function dw(){return mc||(mc=1,Object.defineProperty(ki,"__esModule",{value:!0})),ki}var Ci={},bc;function fw(){return bc||(bc=1,Object.defineProperty(Ci,"__esModule",{value:!0})),Ci}var xi={},yc;function pw(){return yc||(yc=1,Object.defineProperty(xi,"__esModule",{value:!0})),xi}var Si={},wc;function hw(){return wc||(wc=1,Object.defineProperty(Si,"__esModule",{value:!0})),Si}var _i={},kc;function gw(){return kc||(kc=1,Object.defineProperty(_i,"__esModule",{value:!0})),_i}var Pi={},Cc;function vw(){return Cc||(Cc=1,Object.defineProperty(Pi,"__esModule",{value:!0})),Pi}var Oi={},xc;function mw(){return xc||(xc=1,Object.defineProperty(Oi,"__esModule",{value:!0})),Oi}var Ti={},Sc;function bw(){return Sc||(Sc=1,Object.defineProperty(Ti,"__esModule",{value:!0})),Ti}var Ii={},_c;function yw(){return _c||(_c=1,Object.defineProperty(Ii,"__esModule",{value:!0})),Ii}var ji={},Pc;function ww(){return Pc||(Pc=1,Object.defineProperty(ji,"__esModule",{value:!0})),ji}var $i={},Oc;function kw(){return Oc||(Oc=1,Object.defineProperty($i,"__esModule",{value:!0})),$i}var Ai={},Tc;function Cw(){return Tc||(Tc=1,Object.defineProperty(Ai,"__esModule",{value:!0})),Ai}var Ri={},Ic;function xw(){return Ic||(Ic=1,Object.defineProperty(Ri,"__esModule",{value:!0})),Ri}var Mi={},jc;function Sw(){return jc||(jc=1,Object.defineProperty(Mi,"__esModule",{value:!0})),Mi}var Bi={},$c;function _w(){return $c||($c=1,Object.defineProperty(Bi,"__esModule",{value:!0})),Bi}var Ei={},Ac;function Pw(){return Ac||(Ac=1,Object.defineProperty(Ei,"__esModule",{value:!0})),Ei}var Di={},Rc;function Ow(){return Rc||(Rc=1,Object.defineProperty(Di,"__esModule",{value:!0})),Di}var Li={},Mc;function Tw(){return Mc||(Mc=1,Object.defineProperty(Li,"__esModule",{value:!0})),Li}var Ni={},Bc;function Iw(){return Bc||(Bc=1,Object.defineProperty(Ni,"__esModule",{value:!0})),Ni}var Fi={},Ec;function jw(){return Ec||(Ec=1,Object.defineProperty(Fi,"__esModule",{value:!0})),Fi}var Hi={},Dc;function $w(){return Dc||(Dc=1,Object.defineProperty(Hi,"__esModule",{value:!0})),Hi}var Ui={},Lc;function Aw(){return Lc||(Lc=1,Object.defineProperty(Ui,"__esModule",{value:!0})),Ui}var Vi={},Nc;function Rw(){return Nc||(Nc=1,Object.defineProperty(Vi,"__esModule",{value:!0})),Vi}var Wi={},Fc;function Mw(){return Fc||(Fc=1,Object.defineProperty(Wi,"__esModule",{value:!0})),Wi}var qi={},Hc;function Bw(){return Hc||(Hc=1,Object.defineProperty(qi,"__esModule",{value:!0})),qi}var zi={},Uc;function Ew(){return Uc||(Uc=1,Object.defineProperty(zi,"__esModule",{value:!0})),zi}var Gi={},Vc;function Dw(){return Vc||(Vc=1,Object.defineProperty(Gi,"__esModule",{value:!0})),Gi}var Xi={},Wc;function Lw(){return Wc||(Wc=1,Object.defineProperty(Xi,"__esModule",{value:!0})),Xi}var Yi={},qc;function Nw(){return qc||(qc=1,Object.defineProperty(Yi,"__esModule",{value:!0})),Yi}var Ki={},zc;function Fw(){return zc||(zc=1,Object.defineProperty(Ki,"__esModule",{value:!0})),Ki}var Ji={},Gc;function Hw(){return Gc||(Gc=1,Object.defineProperty(Ji,"__esModule",{value:!0})),Ji}var Zi={},Xc;function Uw(){return Xc||(Xc=1,Object.defineProperty(Zi,"__esModule",{value:!0})),Zi}var Qi={},Yc;function Vw(){return Yc||(Yc=1,Object.defineProperty(Qi,"__esModule",{value:!0})),Qi}var el={},Kc;function Ww(){return Kc||(Kc=1,Object.defineProperty(el,"__esModule",{value:!0})),el}var tl={},Jc;function qw(){return Jc||(Jc=1,Object.defineProperty(tl,"__esModule",{value:!0})),tl}var nl={},Zc;function zw(){return Zc||(Zc=1,Object.defineProperty(nl,"__esModule",{value:!0})),nl}var ol={},Qc;function Gw(){return Qc||(Qc=1,Object.defineProperty(ol,"__esModule",{value:!0})),ol}var sl={},ed;function Xw(){return ed||(ed=1,Object.defineProperty(sl,"__esModule",{value:!0})),sl}var rl={},td;function Yw(){return td||(td=1,Object.defineProperty(rl,"__esModule",{value:!0})),rl}var $o={},nd;function Kw(){if(nd)return $o;nd=1,Object.defineProperty($o,"__esModule",{value:!0}),$o.UnreachableCaseError=void 0;class t extends Error{constructor(n){super(`Unreachable case: ${n}`)}}return $o.UnreachableCaseError=t,$o}var Ao={},od;function Jw(){if(od)return Ao;od=1,Object.defineProperty(Ao,"__esModule",{value:!0}),Ao.assert=void 0;function t(e,n="no additional info provided"){if(!e)throw new Error("Assertion Error: "+n)}return Ao.assert=t,Ao}var Ro={},sd;function Zw(){if(sd)return Ro;sd=1,Object.defineProperty(Ro,"__esModule",{value:!0}),Ro.createFactoryWithConstraint=void 0;const t=()=>e=>e;return Ro.createFactoryWithConstraint=t,Ro}var Mo={},rd;function Qw(){if(rd)return Mo;rd=1,Object.defineProperty(Mo,"__esModule",{value:!0}),Mo.isExact=void 0;const t=()=>e=>e;return Mo.isExact=t,Mo}var Bo={},id;function e1(){if(id)return Bo;id=1,Object.defineProperty(Bo,"__esModule",{value:!0}),Bo.noop=void 0;function t(...e){}return Bo.noop=t,Bo}var il={},ld;function t1(){return ld||(ld=1,Object.defineProperty(il,"__esModule",{value:!0})),il}var ad;function n1(){return ad||(ad=1,function(t){var e=Pn&&Pn.__createBinding||(Object.create?function(o,s,r,i){i===void 0&&(i=r);var l=Object.getOwnPropertyDescriptor(s,r);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,i,l)}:function(o,s,r,i){i===void 0&&(i=r),o[i]=s[r]}),n=Pn&&Pn.__exportStar||function(o,s){for(var r in o)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&e(s,o,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(N0(),t),n(F0(),t),n(H0(),t),n(U0(),t),n(V0(),t),n(W0(),t),n(q0(),t),n(z0(),t),n(G0(),t),n(X0(),t),n(Y0(),t),n(K0(),t),n(J0(),t),n(Z0(),t),n(Q0(),t),n(ew(),t),n(tw(),t),n(nw(),t),n(ow(),t),n(sw(),t),n(rw(),t),n(iw(),t),n(lw(),t),n(aw(),t),n(uw(),t),n(cw(),t),n(dw(),t),n(fw(),t),n(pw(),t),n(hw(),t),n(gw(),t),n(vw(),t),n(mw(),t),n(bw(),t),n(yw(),t),n(ww(),t),n(kw(),t),n(Cw(),t),n(xw(),t),n(Sw(),t),n(_w(),t),n(Pw(),t),n(Ow(),t),n(Tw(),t),n(Iw(),t),n(jw(),t),n($w(),t),n(Aw(),t),n(Rw(),t),n(Mw(),t),n(Bw(),t),n(Ew(),t),n(Dw(),t),n(Lw(),t),n(Nw(),t),n(Fw(),t),n(Hw(),t),n(Uw(),t),n(Vw(),t),n(Ww(),t),n(qw(),t),n(zw(),t),n(Gw(),t),n(Xw(),t),n(Yw(),t),n(Kw(),t),n(Jw(),t),n(Zw(),t),n(Qw(),t),n(e1(),t),n(t1(),t)}(Pn)),Pn}var Bt=n1();const ud=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function Ml(t,e,n){const s=[...e().filters];let r;switch(t.type){case"hue-rotate":r={type:t.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":r={type:t.type,value:1};break;case"drop-shadow":r={type:t.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new Bt.UnreachableCaseError(t.type)}s.splice(t.idx,0,r),n({panelId:t.panelId,id:t.id,filters:s})}function Bl(t,e,n){const s=[...e().filters];s.splice(t.idx,1),n({id:t.id,panelId:t.panelId,filters:s})}function El(t,e,n){const s=[...e().filters],r=s[t.idx];s.splice(t.idx,1),s.splice(t.idx+t.moveBy,0,r),n({id:t.id,panelId:t.panelId,filters:s})}function Dl(t,e,n){const s=[...e().filters],r={...s[t.idx]};s[t.idx]=r,r.type==="drop-shadow"?(t.blurRadius!==void 0&&(r.blurRadius=t.blurRadius),t.color!==void 0&&(r.color=t.color),t.offsetX!==void 0&&(r.offsetX=t.offsetX),t.offsetY!==void 0&&(r.offsetY=t.offsetY)):r.value=t.value,n({id:t.id,panelId:t.panelId,filters:s})}class o1{constructor(e,n,o,s,r,i){this.id=e,this.assets=n,this.flip=o,this.scale=s,this.compositeMode=r,this.filters=i}async render(e){const{screenWidth:n,screenHeight:o}=ue().Base,s=await Promise.all(this.assets.map(r=>ma(r,e.hq)));for(const r of s){let i=0,l=0,a=r.width,u=r.height;const c=this.scale;switch(c){case $s.None:i=n/2-a/2,l=o/2-u/2;break;case $s.Stretch:a=n,u=o;break;case $s.Cover:{const d=a/u,g=n/o;d>g?(u=o,a=u*d):(a=n,u=a/d),i=n/2-a/2,l=o/2-u/2;break}default:throw new Bt.UnreachableCaseError(c)}e.drawImage({image:r,x:i,y:l,w:a,h:u,flip:this.flip,composite:this.compositeMode,filters:this.filters})}}}const cd={id:"buildin.static-color",name:"Static color",color:"#000000",render(t){const{screenWidth:e,screenHeight:n}=ue().Base;return t.drawRect({x:0,y:0,w:e,h:n,fill:{style:this.color}}),Promise.resolve()}};function Qp(t,e,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),t.moveTo(e+r,n),t.arcTo(e+o,n,e+o,n+s,r),t.arcTo(e+o,n+s,e,n+s,r),t.arcTo(e,n+s,e,n,r),t.arcTo(e,n,e+o,n,r),t.closePath()}function eh(t,e,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),t.moveTo(e+r,n),t.arcTo(e+o,n,e+o,n+s,r),t.lineTo(e+o,n+s),t.lineTo(e,n+s),t.arcTo(e,n,e+o,n,r),t.closePath()}function vn(t,e){t.save();try{e()}finally{t.restore()}}function Jo(t,e){e.align&&(t.textAlign=e.align),e.font!=null&&(t.font=e.font),e.fill&&(t.fillStyle=e.fill.style),e.outline&&(t.strokeStyle=e.outline.style,t.lineWidth=e.outline.width)}function s1(t,e){if("filter"in t){let n="";for(const o of e)o.type==="drop-shadow"?n+=` drop-shadow(${o.offsetX}px ${o.offsetY}px ${o.blurRadius}px ${o.color})`:o.type==="hue-rotate"?n+=` hue-rotate(${o.value}deg)`:o.type==="blur"?n+=` blur(${o.value}px)`:n+=` ${o.type}(${o.value*100}%)`;t.filter=(t.filter==="none"?"":t.filter)+n.trimStart()}else{let n=1;for(const o of e)o.type==="opacity"&&(n*=o.value);t.globalAlpha*=n}}class th{constructor(e){L(this,"lastVersion",null);L(this,"localCanvasInvalid",!0);L(this,"lastHit",null);L(this,"lastLocalTransform",null);L(this,"refTextbox",null);L(this,"preparedTransform");L(this,"hitDetectionFallback",!1);L(this,"localCanvas",null);this.obj=e}get id(){return this.obj.id}get canSkipLocal(){return!1}get transformIsLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get x(){return this.obj.x}get y(){return this.obj.y}getTransfrom(){let e=new DOMMatrix;const n=this.obj;e=e.translate(this.x,this.y);const o=this.height/2*n.scaleX;return"close"in n&&n.close&&(e=e.translate(0,ue().Base.CloseUpYOffset),e=e.translate(0,-o),e=e.scale(2,2),e=e.translate(0,o)),this.isTalking&&n.enlargeWhenTalking&&(e=e.translate(0,+o),e=e.scale(1.05,1.05),e=e.translate(0,-o)),(n.flip||n.rotation!==0||n.scaleX!==1||n.scaleY!==1||n.skewX!==0||n.skewY!==0)&&(n.rotation!==0&&(e=e.rotate(0,0,n.rotation)),n.skewX!==0&&(e=e.skewX(n.skewX)),n.skewY!==0&&(e=e.skewY(n.skewY)),n.flip&&(e=e.flipX()),(n.scaleX!==1||n.scaleY!==1)&&(e=e.scale(n.scaleX,n.scaleY))),e}getLocalSize(){if(this.transformIsLocal){const e=ue();return new DOMPointReadOnly(e.Base.screenWidth,e.Base.screenHeight)}else return new DOMPointReadOnly(this.width,this.height)}get isTalking(){return this.refTextbox!==null}get linkedTo(){return this.obj.linkedTo}prepareData(e,n){this.refTextbox=null;const o=[...e.order,...e.onTopOrder];for(const s of o){const r=e.objects[s];if(r.type==="textBox"&&r.talkingObjId===this.obj.id){this.refTextbox=r;return}}}prepareTransform(e){return this.preparedTransform=e.multiply(this.getTransfrom()),this.preparedTransform}prepareRender(e){if(this.lastVersion!==this.obj.version&&(this.localCanvasInvalid=!0,this.lastVersion=this.obj.version),this.transformIsLocal){const n=this.preparedTransform;O0(n,this.lastLocalTransform)||(this.localCanvasInvalid=!0,this.lastLocalTransform=n)}else this.lastLocalTransform=null}render(e,n,o,s,r){o||(n=en.None),(!this.canSkipLocal||n!==en.None)&&(r=!1);const i=this.getLocalSize(),l=this.preparedTransform.translate(-this.width/2,-this.height/2);if(this.localCanvas&&(this.localCanvas.width!==i.x||this.localCanvas.height!==i.y)&&(this.localCanvasInvalid=!0),this.localCanvasInvalid&&!r){this.localCanvas||(this.localCanvas=Dn()),this.localCanvas.width=i.x,this.localCanvas.height=i.y;const u=this.localCanvas.getContext("2d");if(!u)throw new Error("No canvas context received. Possibly out of memory?");this.transformIsLocal&&u.setTransform(l),this.renderLocal(u,s),this.localCanvasInvalid=!1,u.resetTransform()}const a=A0[n];vn(e,()=>{a!=null&&(e.shadowColor=a,e.shadowBlur=20),(!this.transformIsLocal||r)&&e.setTransform(l),e.globalCompositeOperation=this.obj.composite??"source-over",s1(e,this.obj.filters),r?this.renderLocal(e,s):this.localCanvas&&this.localCanvas.height!==0&&this.localCanvas.width!==0&&e.drawImage(this.localCanvas,0,0)})}dispose(){}hitTest(e){const n=e.matrixTransform(this.preparedTransform.translate(-this.width/2,-this.height/2).inverse()),o=this.getLocalSize();if(n.x<0||n.y<0||n.x>o.x||n.y>o.y)return console.log("Hitbox text",n),!1;if(this.hitDetectionFallback||!this.localCanvas||this.localCanvasInvalid)return!0;try{const s=this.transformIsLocal?e:n;return this.lastHit=s,this.localCanvas.getContext("2d",{willReadFrequently:!0}).getImageData(s.x|0,s.y|0,1,1).data[3]!==0}catch(s){throw this.hitDetectionFallback=!0,s}}}class nh extends th{constructor(){super(...arguments);L(this,"refTextbox",null);L(this,"lastUploadCount",0);L(this,"lastHq",!1);L(this,"missingAsset",!1);L(this,"_canSkipLocal",!1);L(this,"assetList",[])}get canSkipLocal(){return this._canSkipLocal}get transformIsLocal(){return!1}prepareData(n,o){if(super.prepareData(n,o),this.missingAsset){const s=Object.keys(o.state.uploadUrls).length;s!==this.lastUploadCount&&(this.lastHq=null),this.lastUploadCount=s}}prepareRender(n){super.prepareRender(n);let o=!1;if(this.isAssetListOutdated()&&(this.assetList=this.getAssetList(),o||(o=!!this.assetList.find(s=>!("loadedAssets"in s)||s.hasMissing))),!n!==this.lastHq)for(let s=0;s<this.assetList.length;++s){const r=this.assetList[s];"loadedAssets"in r&&!r.assets.every(i=>i.hq===i.lq)&&(this.assetList[s]={assets:r.assets,offset:r.offset,composite:r.composite},o=!0)}if(this.lastHq=!n,!!o)return this.localCanvasInvalid=!0,this._canSkipLocal=this.assetList.length<=1,this.loadAssets(!n)}getAssetsSize(){let n=0,o=0;for(const s of this.assetList)if("loadedAssets"in s)for(const r of s.loadedAssets)n=Math.max(n,s.offset[0]+r.width),o=Math.max(o,s.offset[1]+r.height);return new DOMPointReadOnly(n,o)}loadAssets(n){const o=[];this.missingAsset=!1;for(const s of this.assetList)"loadedAssets"in s&&!s.hasMissing||o.push((async r=>{const i=await Promise.all(r.assets.map(a=>ma(a,n))),l=r;l.loadedAssets=i,l.hasMissing=i.some(a=>a instanceof ss),this.missingAsset||(this.missingAsset=l.hasMissing)})(s));if(o.length!==0)return Promise.all(o)}isAssetListOutdated(){return this.assetList.length===0}renderLocal(n){console.log("rerendering local");for(const o of this.assetList)if("loadedAssets"in o)for(const s of o.loadedAssets)this.canSkipLocal||(n.globalCompositeOperation=o.composite??"source-over"),s instanceof ss?s.paintOnto(n,{x:o.offset[0],y:o.offset[1],h:this.height,w:this.width}):s.paintOnto(n,{x:o.offset[0],y:o.offset[1]})}}class r1 extends nh{constructor(e,n){super(e),this.data=n}prepareData(e,n){super.prepareData(e,n),this.data=Pr(n,this.obj)}prepareRender(e){return super.prepareRender(e)}isAssetListOutdated(){return!0}getAssetList(){const e=go(this.data,this.obj),n=tr(this.data,this.obj),o=[],s=this.assetList??[];for(const r of e.renderCommands){let i=null;switch(r.type){case"head":{if(!n)continue;const l=n.variants[this.obj.posePositions.head||0];if(l==null)continue;i=l;break}case"image":i=r.images;break;case"pose-part":{const l=e.positions[r.part];if(!l||l.length===0)break;const a=l[this.obj.posePositions[r.part]||0];if(!a)break;i=a;break}}if(i){const l=s.find(a=>a.assets===i);l?o.push({...l,offset:r.offset,composite:r.composite}):o.push({assets:i,offset:r.offset,composite:r.composite})}}return o}}const dd=5;class i1{constructor(e){L(this,"pos",0);this.str=e}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-dd),this.pos+dd)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function fd(t,e=!0){const n=[],o=new i1(t);let s=Or;for(;s!==Tr;){const r=o.pos;try{s=s(n,o)}catch(i){if(e&&s!==Ll)o.pos=r,s=(l,a)=>Ll(l,a,!0);else throw i}}return n}function Or(t,e){return e.current()===void 0?Tr:e.current()==="{"?l1:e.current()===`
`?a1:Ll}function Tr(){return Tr}function Ll(t,e,n=!1){const{pos:o}=e;let s="",r=n,i;for(;;){if(e.current()===void 0){i=Tr;break}else if(r)s+=e.current(),r=!1;else if(e.current()==="\\")r=!0;else if(e.current()==="{"||e.current()===`
`){i=Or;break}else s+=e.current();e.next()}return t.push({type:"text",pos:o,content:s}),i}function ll(t,e){throw new Error(`Error when parsing text at position ${t.pos}: (around: "${t.around}") ${e}`)}function l1(t,e){const{pos:n}=e;if(e.current()!=="{")throw new Error("Parser error: Command does not start with {");const o=e.next()==="/";o&&e.next();let s="",r="",i=!1;for(;e.current()===void 0&&ll(e,"Unexpected end of text inside a command"),e.current()!=="}";)i?r+=e.current():e.current().match(/[a-z]/i)?s+=e.current():e.current()==="="?(o&&ll(e,"Closing commands may not contain arguments"),i=!0):ll(e,`Unexpected character '${e.current()}' in command name.`),e.next();return e.next(),o?t.push({type:"commandClose",commandName:s,pos:n}):t.push({type:"command",pos:n,argument:r,commandName:s}),Or}function a1(t,e){return t.push({type:"newline",pos:e.pos}),e.next(),Or}const pd=new Map([Wn("i",t=>({...t,isItalic:!0})),Wn("b",t=>({...t,isBold:!0})),Wn("u",t=>({...t,isUnderlined:!0})),Wn("s",t=>({...t,isStrikethrough:!0})),Wn("plain",t=>({...t,isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),Wn("edited",t=>({...t,fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),ks("k",(t,e,n)=>({...t,letterSpacing:e?t.letterSpacing+n:n})),ks("size",(t,e,n)=>({...t,fontSize:e?t.fontSize+n:n})),ks("alpha",(t,e,n)=>({...t,alpha:e?t.alpha+n:n})),ks("stroke",(t,e,n)=>({...t,strokeWidth:e?t.strokeWidth+n:n})),["font",(t,e)=>({...t,fontName:e})],["color",(t,e)=>({...t,color:e})],["outlinecolor",(t,e)=>({...t,strokeColor:e})]]);function Wn(t,e){return[t,(n,o)=>{if(o!=="")throw new Error(`Operator '${t}' does not take any arguments.`);return e(n)}]}function ks(t,e){return[t,(n,o)=>{if(o=="")throw new Error(`Operator '${t}' needs an argument.`);const s=o[0]==="+"||o[0]==="-",r=Number(o);if(isNaN(r))throw new Error(`Operator '${t}' needs a numeric argument.`);return e(n,s,r)}]}class jt{constructor(e,n){L(this,"renderParts");L(this,"tokens");L(this,"loose");L(this,"lastLayoutHeight",null);L(this,"lastLayoutWidth",null);this.str=e,this.baseStyle=n,this.loose=he.state.looseTextParsing;try{this.tokens=fd(e,this.loose)}catch(o){if(o instanceof Error)this.tokens=[{type:"text",pos:0,content:o.message}];else throw o}this.rebuildParts()}rebuildParts(){this.renderParts=jt.getRenderParts(this.tokens,this.baseStyle,this.loose)}loadFonts(){if(!("fonts"in document))return;const e=new Set;let n=null;for(const s of this.renderParts)"style"in s&&s.style!==n&&(n=s.style,n.fontName&&e.add(n.fontName));const o=[];for(const s of e){const r=document,i=`8px '${s.replaceAll("'","\\'")}'`;r.fonts.check(i)||o.push(r.fonts.load(i))}if(o.length!==0)return Promise.all(o).then(()=>{const s=fd(this.str);this.renderParts=jt.getRenderParts(s,this.baseStyle,this.loose)})}render(e){e.save();let n=null;for(const o of this.renderParts)o.type==="character"&&(o.style!==n&&(n=o.style,Nl(n,e)),n.strokeWidth>0&&n.strokeColor>""&&e.strokeText(o.character,o.x,o.y));for(const o of this.renderParts)o.type==="character"&&(o.style!==n&&(n=o.style,Nl(n,e)),e.fillText(o.character,o.x,o.y));e.restore()}quote(){let e;(r=>{r[r.None=0]="None",r[r.ExplictQuote=1]="ExplictQuote",r[r.ImplictQuote=2]="ImplictQuote",r[r.Star=3]="Star"})(e||(e={}));let n=-1,o=0;for(let r=0;r<this.renderParts.length;++r){const i=this.renderParts[r];if(i.type==="character")switch(o){case 0:if(i.character.match(/\s/))continue;i.character==='"'?(o=1,n=r):i.character==="*"?(o=3,n=r):(this.renderParts.splice(r,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Eo(i.style,'"')}),r++,n=r,o=2);break;case 1:n=r,i.character==='"'&&(o=0);break;case 2:if(i.character.match(/\s/))continue;i.character==="*"&&(this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Eo(i.style,'"')}),o=3,r++),n=r;break;case 3:i.character==="*"&&(o=0),n=r;break;default:throw new Bt.UnreachableCaseError(o)}}const s=this.renderParts[n];s&&o===3&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:"*",height:s.height,width:Eo(s.style,'"')}),s&&(o===1||o===2)&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:'"',height:s.height,width:Eo(s.style,'"')})}applyLayout(e,n,o,s,r){const i=this.renderParts,l=[];let a=null,u=0,c=0;const d=()=>{a={type:"group",renderParts:[],height:0,width:0},u=s,c=-1,l.push(a)};d();for(const f of i)if(f.type==="newline"||f.type==="alignment")if(l.push(f),f.type==="alignment"&&r){const x=u;d(),u=x}else d();else{if(u<f.width&&r){const x={type:"newline",height:f.height,width:f.height,x:0,y:0};if(f.character===" "){l.push(x),d();continue}else if(c!==-1){const P=a.renderParts.splice(c).slice(1),j=P.reduce((T,R)=>T+R.width,0),m=P.reduce((T,R)=>T>R.height?T:R.height,0);a.width-=j,a.height===m&&(a.height=a.renderParts.reduce((T,R)=>T>R.height?T:R.height,0)),l.push(x),d(),a.renderParts=P,a.width=j,a.height=m,u-=j}}else f.character===" "&&(c=a.renderParts.length);a.renderParts.push(f),a.height=Math.max(a.height,f.height),a.width+=f.width,u-=f.width}const g=[];let b=0;for(const f of l)b=Math.max(b,f.height),f.type==="newline"&&(g.push(b),b=0);g.push(b);let y=0,w=e,_=o,k=0,h=s;for(const f of l){if(f.type==="newline"){_+=g[++y]||0,k=0,h=s;continue}if(f.type==="alignment"){w=f.alignment;continue}switch(w){case"left":v(f,k,_),k+=f.width;break;case"center":v(f,k+(h-k)/2-f.width/2,_);break;case"right":v(f,h-f.width,_),h-=f.width;break}}this.lastLayoutHeight=_,this.lastLayoutWidth=s;function v(f,x,P){let j=x;for(const m of f.renderParts)m.y=P,m.x=n+j,j+=m.width}}getHeight(e){let n=0,o=0;const s=e===0?this.renderParts:jt.applyLineWrapping(this.renderParts.slice(0),e);for(const r of s)n=Math.max(n,r.height),r.type==="newline"&&(o+=n,n=0);return o+=n,o}getWidth(){let e=0,n=0;for(const o of this.renderParts)e+=o.width,o.type==="newline"&&(n=Math.max(n,e),e=0);return n=Math.max(n,e),n}static getRenderParts(e,n,o){const s=[],r=[],i=[];let l=vd(n),a=n,u=null;function c(d){for(const g of d)s.push({type:"character",character:g,height:l,width:Eo(a,g),style:a,x:0,y:0})}for(const d of e){const g=d.type;switch(g){case"command":if(d.commandName==="align"){const b=d.argument.toLowerCase();if(b!=="left"&&b!=="center"&&b!=="right")if(o){c("{align="+d.argument+"}");continue}else throw new Error(`There is no text command called '${d.commandName}' at position ${d.pos}.`);s.push({type:"alignment",alignment:b,height:l,width:0,x:0,y:0})}else if(pd.has(d.commandName)){r.push(a),i.push(u);try{a=pd.get(d.commandName)(a,d.argument),l=vd(a),u=d}catch(b){if(o){r.pop(),i.pop(),c("{"+d.commandName+(d.argument?"="+d.argument:"")+"}"),console.error("Parsing error",b);continue}else throw b}}else if(o)c("{"+d.commandName+"}");else throw new Error(`There is no text command called '${d.commandName}' at position ${d.pos}.`);break;case"commandClose":if(!u)if(o){c("{/"+d.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${d.pos}. Closed '${d.commandName}', but no commands are currently open.`);if(d.commandName!==u.commandName)if(o){c("{/"+d.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${d.pos}. Closed '${d.commandName}', expected to close '${u}' first. (Opened at position ${u.pos})`);u=i.pop(),a=r.pop();break;case"newline":s.push({height:l,width:0,x:0,y:0,type:"newline"});break;case"text":c(d.content);break;default:throw new Bt.UnreachableCaseError(g)}}return s}static applyLineWrapping(e,n){let o=-1,s=0,r=0;const i=[];for(const l of e)if(l.type==="newline")o=-1,s=0,r=0,i.push(l);else if(l.type==="alignment")console.error("Alignment in context where it's not supported.");else if(l.type==="character")l.character===" "?s>n?(o=-1,s=0,r=0,i.push({type:"newline",height:l.height,width:0,x:0,y:0})):(s+=l.width,r=s,o=i.length,i.push(l)):(s+=l.width,s>n&&o!==-1&&(s-=r,i.splice(o,1,{type:"newline",height:l.height,width:0,x:0,y:0}),o=-1,r=0),i.push(l));else throw new Bt.UnreachableCaseError(l);return i}}const Na=Dn();Na.width=0;Na.height=0;const hd=Na.getContext("2d");let gd=null;function Eo(t,e){t!==gd&&(Nl(t,hd),gd=t);let n=t.letterSpacing;return(typeof n!="number"||isNaN(n)||!isFinite(n))&&(n=0),hd.measureText(e).width+n}const al=new Map;function vd(t){const e=t.fontSize+" "+t.fontName;if(al.has(e))return al.get(e)*t.lineSpacing;const n=document.createElement("span");n.innerHTML="Hg",n.style.fontFamily=t.fontName,n.style.fontSize=`${t.fontSize}px`,n.style.lineHeight="1";const o=document.createElement("div");o.style.opacity="0",o.style.fontFamily=t.fontName,o.style.fontSize=`${t.fontSize}px`,o.style.lineHeight="1",o.style.position="absolute",o.style.top="0",o.style.left="0",o.appendChild(n),document.body.appendChild(o);try{const s=o.offsetHeight;return al.set(e,s),s*t.lineSpacing}finally{o.remove()}}function Nl(t,e){e.textAlign="left",e.font=(t.isItalic?"italic ":"")+(t.isBold?"bold ":"")+t.fontSize+"px "+t.fontName,e.lineJoin="round",t.strokeWidth>0&&t.strokeColor>""?(e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeWidth):(e.strokeStyle="",e.lineWidth=0),e.globalAlpha=t.alpha||0,e.fillStyle=t.color}class Ir extends th{get canSkipLocal(){return this.obj.composite==="source-over"&&this.obj.filters.length===0}get transformIsLocal(){const e=this.preparedTransform;return this.obj.overflow?!0:he.supports.limitedCanvasSpace?!1:!(e.a===1&&e.b===0&&e.c===0&&e.d===1)}}class u1 extends Ir{constructor(){super(...arguments);L(this,"_height",0);L(this,"choiceRenderers",[])}get height(){const n=ue().Choices;return this._height+n.ChoiceOuterPadding*2}get width(){const n=ue().Choices;return this.obj.width+n.ChoiceOuterPadding*2}renderLocal(n){const o=ue().Choices,s=this.obj.width,r=o.ChoiceOuterPadding;let i=o.ChoiceOuterPadding;for(const l of this.choiceRenderers){const a=l.getHeight(this.obj.autoWrap?s:0);n.strokeStyle=o.ChoiceButtonBorderColor,n.lineWidth=o.Outline,n.fillStyle=o.ChoiceButtonColor,n.fillRect(r,i,s,a+o.ChoicePadding*2),n.strokeRect(r,i,s,a+o.ChoicePadding*2),l.applyLayout("center",r+o.ChoicePadding,i+o.ChoiceSpacing*1.25,s-o.ChoicePadding*2,this.obj.autoWrap),l.render(n),i+=a+o.ChoicePadding*2+o.ChoiceSpacing}}prepareRender(n){const o=ue();this.choiceRenderers=this.obj.choices.map(i=>new jt(i.text||" ",o.Choices.ChoiceTextStyle));const s=()=>(this._height=this.choiceRenderers.reduce((i,l)=>i+l.getHeight(this.obj.autoWrap?this.obj.width:0)+o.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1),super.prepareRender(n)),r=this.choiceRenderers.map(i=>i.loadFonts()).filter(i=>i!==void 0);if(r.length===0)s();else return Promise.all(r).then(s)}}class c1 extends Ir{constructor(){super(...arguments);L(this,"_height",0);L(this,"_width",0);L(this,"_textRenderer",null);L(this,"_buttonRenderer",null)}get height(){const n=ue().Choices;return this._height+n.ChoiceOuterPadding*2}get width(){const n=ue().Choices;return this._width+n.ChoiceOuterPadding*2}prepareRender(n){const o=super.prepareRender(n),s=ue().Notification,r=this._textRenderer=new jt(this.obj.text,s.NotificationTextStyle),i=this._buttonRenderer=new jt("OK",s.NotificationOkTextStyle),l=r.loadFonts(),a=i.loadFonts(),u=()=>{const c=this.obj.autoWrap?this.obj.width-s.NotificationPadding*2:0,d=this.obj.autoWrap?c:r.getWidth(),g=r.getHeight(c),b=this.obj.autoWrap?c:i.getWidth(),y=i.getHeight(c);this._width=Math.max(d,b)+s.NotificationPadding*2,this._height=g+s.NotificationPadding*2+s.NotificationSpacing+y};if(o||l||a)return Promise.all([o,l,a]).then(u);u()}render(n,o,s,r,i){return this.obj.backdrop&&vn(n,()=>{const l=ue();n.resetTransform(),n.fillStyle=l.Notification.NotificationBackdropColor,n.fillRect(0,0,l.Base.screenWidth,l.Base.screenHeight)}),super.render(n,o,s,r,i)}renderLocal(n){const o=ue(),s=this._textRenderer,r=this._buttonRenderer,i=this._width,l=this._height,a=o.Choices.ChoiceOuterPadding;n.fillStyle=o.Choices.ChoiceButtonColor,n.strokeStyle=o.Choices.ChoiceButtonBorderColor,n.lineWidth=o.Choices.Outline,n.fillRect(a,a,i,l),n.strokeRect(a,a,i,l),s.applyLayout("center",a+o.Notification.NotificationPadding,a+o.Notification.NotificationPadding*1.5,i-o.Notification.NotificationPadding*2,!1),s.render(n),r.applyLayout("center",a,a+l-o.Notification.NotificationPadding,i+a,!1),r.render(n)}}const d1=-2,f1=26,p1=10,h1=10;class g1 extends Ir{constructor(){super(...arguments);L(this,"_paperHeight",null);L(this,"_paperWidth",null);L(this,"_paper",null);L(this,"_lastPaperUrl",null)}get height(){return this._paperHeight??this.obj.height}get width(){return this._paperWidth??this.obj.width}prepareRender(n){const o=super.prepareRender(n),s=ue().Poem,r=s.poemBackgrounds[this.obj.background],i=s.poemTextStyles[this.obj.font],a=new jt(this.obj.text,i).loadFonts();let u;if(r.file.startsWith("internal:")?(this._lastPaperUrl=null,this._paper=null,this._paperHeight=null,this._paperWidth=null):this._lastPaperUrl!==r.file&&(u=(async()=>{this._paper=await fo(`assets/poemBackgrounds/${r.file}`),this._lastPaperUrl=r.file,this._paperHeight=this._paper.height*s.backgroundScale,this._paperWidth=this._paper.width*s.backgroundScale})()),o||a||u)return Promise.all([o,a,u])}renderLocal(n){const o=ue().Poem,s=o.poemBackgrounds[this.obj.background],r=this.width,i=this.height;let l=o.poemPadding,a=o.poemTopPadding,u=l*2;if(s.file==="internal:console")n.fillStyle=this.obj.consoleColor||o.consoleBackgroundColor,n.fillRect(0,0,r,i),l=d1,a=f1,u=p1;else if(this._paper&&(this._paper.paintOnto(n,{x:0,y:0,w:r,h:i}),!this.obj.overflow)){const g=new Path2D;g.rect(0,0,r,i),n.clip(g)}const c=o.poemTextStyles[this.obj.font],d=new jt(this.obj.text,c);d.applyLayout("left",h1+l,l+a,this.width-u,this.obj.autoWrap),d.render(n)}}class v1 extends nh{getAssetList(){return[{assets:this.obj.assets,offset:[0,0]}]}}class Fa{constructor(e){L(this,"nextArrow",null);this.base=e}static get defaultWidth(){return Co}static get defaultHeight(){return kr+En}static get defaultX(){return ue().Base.screenWidth/2}static get defaultY(){return ue().Base.screenHeight-this.defaultHeight/2-ue().TextBox.TextBoxBottomSpacing}get allowSkippingLocal(){return!0}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return Ta}getControlsDisabledStyle(){return bp}get textboxStyle(){return Ia}renderControls(e,n){const s=this.width/2,r=this.getControlsStyle();Jo(e,r),e.fillText("History",s+Ca,n),Jo(e,this.base.obj.skip?r:this.getControlsDisabledStyle()),e.fillText("Skip",s+xa,n),Jo(e,r),e.fillText("Auto   Save   Load   Settings",s+Sa,n)}prepare(){if(!(this.nextArrow instanceof Mn))return(async()=>{this.nextArrow=await rs("next")})()}}class Yn extends Fa{constructor(){super(...arguments);L(this,"backgroundImage","textbox");L(this,"xOffset",0);L(this,"nameBoxAsset",null);L(this,"backdropAsset",null)}static get resizable(){return!1}get height(){return kr+En}get width(){return Co}get nameboxWidth(){return ps}get nameboxHeight(){return En}get nameboxOffsetX(){return hs}get nameboxOffsetY(){return xr}get nameboxStyle(){return Sr}get textOffsetX(){return fs}get textOffsetY(){return Cr}renderNamebox(n,o,s){var r;(r=this.nameBoxAsset)==null||r.paintOnto(n,{x:o,y:s})}renderBackdrop(n,o,s){var r;o+=this.xOffset,(r=this.backdropAsset)==null||r.paintOnto(n,{x:o,y:s})}render(n){var l;const o=this.width,s=this.height;this.renderBackdrop(n,0,0+this.nameboxHeight),this.obj.talkingObjId!==null&&this.renderNamebox(n,0+this.nameboxOffsetX,0);const r=s,i=r-ka;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&((l=this.nextArrow)==null||l.paintOnto(n,{x:o-_a,y:r-Pa}))}prepare(){const n=super.prepare();if(!(!n&&this.backdropAsset&&this.nameBoxAsset))return Promise.all([n,this.backdropAsset instanceof Mn?void 0:(async()=>{this.backdropAsset=await rs(this.backgroundImage)})(),this.nameBoxAsset instanceof Mn?void 0:(async()=>{this.nameBoxAsset=await rs("namebox")})()])}}L(Yn,"id","normal"),L(Yn,"label","Normal"),L(Yn,"priority",0),L(Yn,"gameMode","ddlc");class Ho extends Yn{constructor(){super(...arguments);L(this,"backgroundImage","textbox_monika");L(this,"xOffset",(Co-wa)/2)}}L(Ho,"id","corrupt"),L(Ho,"label","Corrupted"),L(Ho,"priority",1),L(Ho,"gameMode","ddlc");class Kn extends Fa{constructor(){super(...arguments);L(this,"_dotPattern",null);L(this,"_lastColor",null);L(this,"backgroundImage","textbox");L(this,"xOffset",0)}static get resizable(){return!0}get allowSkippingLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth??ps}get nameboxHeight(){return En}get nameboxOffsetX(){return hs}get nameboxOffsetY(){return xr}get nameboxStyle(){return{...Sr,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return fs}get textOffsetY(){return Cr}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const n=this.refObject;return n!=null&&n.textboxColor!=null?n.textboxColor:ap}get nameboxOutlineColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(up).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(cp).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(n,o,s){vn(n,()=>{const r=this.nameboxWidth,i=this.nameboxHeight;n.beginPath(),eh(n,o,s,r,i,pp),n.clip();const l=n.createLinearGradient(o,s,o,s+i),a=De.fromCss(this.nameboxBackgroundColor),u=new De(a.r,a.g,a.b,.95),c=u.toHSL().shift(fp).toRgb();l.addColorStop(0,u.toCss()),l.addColorStop(dp,u.toCss()),l.addColorStop(1,c.toCss()),n.fillStyle=l,n.fillRect(o,s,this.obj.width,i)})}renderBackdrop(n,o){const s=De.fromCss(this.customColor),r=s.toHSL(),i=this.obj.height-o,l=this.obj.width,a=()=>Qp(n,zn/2,o+zn/2,l-zn,i-zn,hp);vn(n,()=>{n.beginPath(),a(),n.clip();const c=n.createLinearGradient(0,o,0,i);c.addColorStop(0,s.toCss()),c.addColorStop(1,`rgba(${s.r},${s.g},${s.b},0.6667)`),n.fillStyle=c,n.strokeStyle="#ffdfee",n.lineWidth=6,n.fillRect(0,o,l,i),vn(n,()=>{n.translate(0,o),n.fillStyle=this.getDotPattern(),n.globalCompositeOperation="source-atop",n.fillRect(0,0,l,i)});const d=n.createLinearGradient(0,o+i-$l,0,o+i);d.addColorStop(0,"rgba(255,255,255,0.3137)"),d.addColorStop(.5,"rgba(255,255,255,0.0627)"),d.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=d,n.beginPath(),n.ellipse(l/2,o+i,mp,$l,0,0,2*Math.PI),n.closePath(),n.fill()});const u=r.shift(gp).toRgb().toCss();n.strokeStyle=u,n.lineWidth=zn,n.beginPath(),a(),n.stroke()}render(n){const o=this.obj.height,s=this.obj.width;this.obj.talkingObjId!==null&&this.renderNamebox(n,this.nameboxOffsetX,0),this.renderBackdrop(n,this.nameboxHeight);const r=o,i=r-ka;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&this.nextArrow&&this.nextArrow.paintOnto(n,{x:s-_a,y:r-Pa})}getDotPattern(n=vp){if(this._dotPattern&&this._lastColor===this.customColor)return this._dotPattern;this._lastColor=this.customColor;const{dotPatternSize:o,dotColorDelta:s,dotRadius:r}=n,i=De.fromCss(this.customColor).toHSL(),l=Dn();l.height=o,l.width=o;const a=l.getContext("2d");if(!a)throw new Error("Failed to create canvas for textbox dot-pattern. Out of memory?");a.fillStyle=i.shift(s).toRgb().toCss();function u(d,g){a.beginPath(),a.ellipse(d,g,r,r,0,0,2*Math.PI),a.closePath(),a.fill()}u(0,0),u(o,0),u(0,o),u(o,o),u(o/2,o/2);const c=a.createPattern(l,"repeat");if(!c)throw new Error("Failed to create textbox dot-pattern. Out of memory?");return this._dotPattern=c,c}}L(Kn,"id","custom"),L(Kn,"label","Custom"),L(Kn,"priority",0),L(Kn,"gameMode","ddlc");const lr=class lr{constructor(e){L(this,"nextArrow",null);this.base=e}static get resizable(){return!1}static get defaultWidth(){return Aa}static get defaultHeight(){return Bp+Ma}static get defaultX(){return ue().Base.screenWidth/2}static get defaultY(){return ue().Base.screenHeight-this.defaultHeight/2-ue().TextBox.TextBoxBottomSpacing}get allowSkippingLocal(){return!0}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return Zs}getControlsDisabledStyle(){return zp}renderControls(e,n){const o=this.width,s=o/2,i=s-s,l=this.getControlsStyle(),a=["History","Skip","Auto","Save","Load","Settings"],u=[];let c=0;for(const b of a){const y=lr.controlWidth(e,b);u.push(y),c+=y}const d=Math.min((o-c)/(a.length+2),78);let g=i+(o-c-d*(a.length-1))/2;for(let b=0;b<a.length;++b){const y=a[b],w=u[b],_=y==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():l;Jo(e,_),e.fillText(y,g,n),g+=w+d}}static controlWidth(e,n){if(this.widthCache[n])return this.widthCache[n];Jo(e,Zs);const o=e.measureText(n).width;return this.widthCache[n]=o,o}prepare(){if(!(this.nextArrow instanceof Mn))return(async()=>{this.nextArrow=await rs("next_plus")})()}};L(lr,"widthCache",{});let Fl=lr;class Uo extends Fl{constructor(){super(...arguments);L(this,"_lastColor",null);L(this,"_dotPattern",null);L(this,"backgroundImage","textbox");L(this,"xOffset",0)}static get resizable(){return!0}get allowSkippingLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:Ba}get nameboxHeight(){return Ma}get nameboxOffsetX(){return Ea}get nameboxOffsetY(){return Dp}get nameboxStyle(){return{...qp,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return Ra}get textOffsetY(){return Ep}get textboxStyle(){return Gp}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const n=this.refObject;return n!=null&&n.textboxColor!=null?n.textboxColor:_p}get nameboxOutlineColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(Pp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(Op).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(n,o,s){vn(n,()=>{const r=this.nameboxWidth,i=this.nameboxHeight;n.beginPath(),eh(n,o,s,r,i,jp),n.clip();const l=n.createLinearGradient(o,s,o,s+i),a=De.fromCss(this.nameboxBackgroundColor),u=new De(a.r,a.g,a.b,.95),c=u.toHSL().shift(Ip).toRgb();l.addColorStop(0,u.toCss()),l.addColorStop(Tp,u.toCss()),l.addColorStop(1,c.toCss()),n.fillStyle=l,n.fillRect(o,s,this.obj.width,i)})}renderBackdrop(n,o){const s=this.obj.height-o,r=this.obj.width,i=De.fromCss(this.customColor).toHSL(),l=()=>Qp(n,Gn/2,o+Gn/2,r-Gn,s-Gn,$p);vn(n,()=>{n.beginPath(),l(),n.clip();const u=n.createLinearGradient(0,o,0,o+s),c=De.fromHex(this.customColor);u.addColorStop(0,c.toCss()),u.addColorStop(1,`rgba(${c.r},${c.g},${c.b},0.6667)`),n.fillStyle=u,n.strokeStyle="#ffdfee",n.lineWidth=6,n.fillRect(0,o,r,s),n.strokeRect(0,o,r,s),n.fillStyle=this.getDotPattern(),n.globalCompositeOperation="source-atop",n.fillRect(0,o,r,s);const d=n.createLinearGradient(0,o+s-Al,0,o+s);d.addColorStop(0,"rgba(255,255,255,0.3137)"),d.addColorStop(.5,"rgba(255,255,255,0.0627)"),d.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=d,n.beginPath(),n.ellipse(r/2,o+s,Wp,Al,0,0,2*Math.PI),n.closePath(),n.fill()});const a=i.shift(Ap).toRgb().toCss();n.strokeStyle=a,n.lineWidth=Gn,n.beginPath(),l(),n.stroke()}render(n){const o=this.obj.height,s=this.obj.width;this.obj.talkingObjId!==null&&this.renderNamebox(n,this.nameboxOffsetX,0),this.renderBackdrop(n,this.nameboxHeight);const r=o,i=r-Lp;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&this.nextArrow&&this.nextArrow.paintOnto(n,{x:s-Up,y:r-Vp})}getDotPattern(){return Kn.prototype.getDotPattern.call(this,Rp)}}L(Uo,"id","custom_plus"),L(Uo,"label","Custom (Plus)"),L(Uo,"priority",0),L(Uo,"gameMode","ddlc_plus");class Vo extends Fa{static get resizable(){return!0}get height(){return kr+En}get width(){return Co}get nameboxWidth(){return ps}get nameboxHeight(){return En}get nameboxOffsetX(){return hs}get nameboxOffsetY(){return xr}get nameboxStyle(){return Sr}get textOffsetX(){return fs}get textOffsetY(){return Cr}get textboxStyle(){return Ia}async render(){}}L(Vo,"id","none"),L(Vo,"label","None"),L(Vo,"priority",0),L(Vo,"gameMode","ddlc");const m1=[Yn,Ho,Kn,Vo,Uo],Zo=(()=>{const t={};for(const e of m1)t[e.id]=e;return t})();class b1 extends Ir{constructor(){super(...arguments);L(this,"nbTextRenderer",null);L(this,"textRenderer",null);L(this,"_lastRefVars",null);L(this,"refObject",null);L(this,"_lastRenderer",null)}getRefVars(){const n=this.refObject;return n?JSON.stringify([n.label,n.textboxColor,n.nameboxWidth]):null}getName(){var n;return this.obj.talkingObjId==="$other$"?this.obj.talkingOther:((n=this.refObject)==null?void 0:n.label)??"Missing name"}get canSkipLocal(){var n;return super.canSkipLocal&&(((n=this._lastRenderer)==null?void 0:n.allowSkippingLocal)??!0)}prepareData(n,o){super.prepareData(n,o),typeof this.obj.talkingObjId=="number"&&(this.refObject=n.objects[this.obj.talkingObjId]??null)}prepareRender(n){const o=super.prepareRender(n),s=this.textboxRenderer.prepare(),r=this.getRefVars();r!==this._lastRefVars&&(this.localCanvasInvalid=!0,this._lastRefVars=r),this.nbTextRenderer=new jt(this.getName(),this.textboxRenderer.nameboxStyle),this.textRenderer=new jt(this.obj.text,this.textboxRenderer.textboxStyle);const i=this.nbTextRenderer.loadFonts(),l=this.textRenderer.loadFonts();if(!(!o&&!s&&!i&&!l))return Promise.all([o,s,i,l])}renderLocal(n){const o=this.textboxRenderer,s=o.width;if(!this.obj.overflow){const r=new Path2D;r.rect(0,0,o.width,this.height),n.clip(r)}o.render(n),this.obj.talkingObjId!==null&&this.renderName(n),this.renderText(n,0,0,s)}renderName(n){const o=this.textboxRenderer,s=o.nameboxWidth,r=o.nameboxOffsetX,i=o.nameboxOffsetX/2;console.log("rendering name",n.getTransform()),this.nbTextRenderer.applyLayout("center",r+i,o.nameboxOffsetY,s-i*2,!1),this.nbTextRenderer.render(n)}renderText(n,o,s,r){const i=this.textboxRenderer,l=this.textRenderer;this.obj.autoQuoting&&this.obj.talkingObjId!==null&&l.quote(),l.applyLayout("left",o+i.textOffsetX,s+i.nameboxHeight+i.textOffsetY,r-i.textOffsetX*2,this.obj.autoWrap),l.render(n)}get forcedStyle(){const n=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&n&&(n.textboxColor!=null||n.nameboxWidth!=null)?"custom":this.obj.style}get textboxRenderer(){const n=this.forcedStyle,o=Zo[n];if(this._lastRenderer&&this._lastRenderer.constructor===o)return this._lastRenderer;const s=new o(this);return this._lastRenderer=s,s}}const ar=class ar{constructor(e,n,o,s){L(this,"renderObjectCache",new Map);L(this,"renderer");L(this,"_disposed",!1);this.store=e,this._panelId=n,this.canvasWidth=o,this.canvasHeight=s,this.renderer=new Kp(o,s)}get panelId(){return this._panelId}setPanelId(e){if(this._disposed)throw new Error("Disposed scene-renderer called");this._panelId!==e&&(this._panelId=e,this.renderObjectCache.forEach(n=>{n.dispose()}),this.renderObjectCache.clear())}render(e,n,o){if(this._disposed)throw new Error("Disposed scene-renderer called");return this.panel?this.renderer.render(this.renderCallback.bind(this,o),e,n):Promise.resolve(!1)}download(){if(this._disposed)throw new Error("Disposed scene-renderer called");const e=new Date,n=`panel-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this,!0),n)}paintOnto(e,n){this.renderer.paintOnto(e,n)}objectsAt(e,n){const o=new DOMPointReadOnly(e,n);return this.getRenderObjects().filter(s=>s.hitTest(o)).map(s=>s.id)}getLastRenderObject(e){return this.renderObjectCache.get(e)??null}async renderCallback(e,n){var g,b;if(this._disposed)throw new Error("Disposed scene-renderer called");n.fsCtx.imageSmoothingEnabled=!0,n.fsCtx.imageSmoothingQuality=n.hq?"high":"low",await((g=this.getBackgroundRenderer())==null?void 0:g.render(n));const o=this.getRenderObjects(),s=new Map,r=new Map;for(const y of o){y.prepareData(this.panel,this.store);const w=y.linkedTo;let _=new DOMMatrixReadOnly;if(w!=null){const k=r.get(w);if(k)_=k;else{const h=s.get(w);h?h.push(y):s.set(w,[y]);continue}}d(y,_)}s.size>0&&console.warn("Not all renderables processed. Infinite loop?");const i=o.map(y=>y.prepareRender(!n.hq)).filter(y=>y!==void 0);i.length>0&&await Promise.all(i);const l=this.store.state.ui.selection,a=new Set;l!==null&&c(l,a);const u=(b=document.querySelector(ar.FocusProp))==null?void 0:b.getAttribute("data-obj-id");for(const y of o){const w=l===y.id,_=u===""+y.id;y.render(n.fsCtx,(w?en.Selected:a.has(y.id)?en.Indirectly:en.None)+(_?en.Focused:en.None),n.preview,n.hq,e)}n.applyFilters([...this.panel.filters]),n.preview&&n.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:await rs("backgrounds/transparent")});function c(y,w){w.add(y);for(const _ of o.filter(k=>k.linkedTo===y))c(_.id,w)}function d(y,w){const _=y.prepareTransform(w);r.set(y.id,_);const k=s.get(y.id);if(k){for(const h of k)d(h,_);s.delete(y.id)}}}getRenderObjects(){const e=this.store.state.panels.panels[this.panelId],n=[...e.order,...e.onTopOrder],o=e.objects,s=Array.from(this.renderObjectCache.keys()).filter(r=>!n.includes(r));for(const r of s)this.renderObjectCache.get(r).dispose(),this.renderObjectCache.delete(r);return n.map(r=>{let i=this.renderObjectCache.get(r);if(!i){const l=o[r],a=l.type;switch(a){case"sprite":i=new v1(l);break;case"character":{const u=l;i=new r1(u,Pr(this.store,u));break}case"textBox":i=new b1(l);break;case"choice":i=new u1(l);break;case"notification":i=new c1(l);break;case"poem":i=new g1(l);break;default:throw new Bt.UnreachableCaseError(a)}this.renderObjectCache.set(r,i)}return i})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const e=this.panel;switch(e.background.current){case"buildin.static-color":return cd.color=e.background.color,cd;default:{const o=this.store.getters["content/getBackgrounds"].get(e.background.current);if(!o)return null;const s=o.variants[e.background.variant];return new o1(e.background.current,s,e.background.flipped,e.background.scaling,e.background.composite,e.background.filters)}}}get disposed(){return this._disposed}dispose(){this._disposed=!0,this.renderer.dispose()}drawDebugZoom(e,n,o,s,r,i=7){const l=e.fsCtx.getImageData(n,o,s,r),a=document.createElement("canvas");a.width=s,a.height=r,a.getContext("2d").putImageData(l,0,0),e.fsCtx.imageSmoothingEnabled=!1,e.fsCtx.drawImage(a,0,0,s*i,r*i)}};L(ar,"FocusProp",typeof CSS<"u"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");let is=ar,Cs=null;function vo(t){if(Cs===null||Cs.disposed){if(t.state.panels.currentPanel===-1)return null;const e=ue().Base;Cs=new is(t,t.state.panels.currentPanel,e.screenWidth,e.screenHeight)}return Cs}const y1={setChoicesProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version},setChoiceProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n.choices[e.choiceIdx][e.key]=e.value,++n.version},setChoices(t,e){const n=t.panels[e.panelId].objects[e.id];n.choices=e.choices,++n.version}},w1={createChoice({commit:t,rootState:e,state:n},o){const s=ue(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{..._o(),y:s.Choices.ChoiceY,width:s.Choices.ChoiceButtonWidth,height:0,panelId:e.panels.currentPanel,id:r,onTop:!0,autoWrap:!0,type:"choice",choiceDistance:s.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:s.Choices.ChoiceButtonColor}}),r},addChoice({state:t,commit:e},n){const o=t.panels[n.panelId].objects[n.id];e("setChoices",{id:n.id,panelId:n.panelId,choices:[...o.choices,{selected:!1,text:n.text}]})},removeChoice({state:t,commit:e},n){const s=[...t.panels[n.panelId].objects[n.id].choices];s.splice(n.choiceIdx,1),s.length===0&&s.push({selected:!1,text:""}),e("setChoices",{id:n.id,panelId:n.panelId,choices:s})}},k1={setNotificationProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},C1={createNotification({commit:t,rootState:e,state:n},o){const s=ue(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{..._o(),y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:e.panels.currentPanel,autoWrap:!1,id:r,onTop:!0,type:"notification",customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0}}),r}},x1={setPoemProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},S1={createPoem({commit:t,rootState:e,state:n},o){const s=ue(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:e.panels.currentPanel,flip:!1,rotation:0,id:r,onTop:!0,opacity:100,type:"poem",version:0,autoWrap:!0,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,scaleX:1,scaleY:1,skewX:0,skewY:0,ratio:1,preserveRatio:!0,consoleColor:s.Poem.consoleBackgroundColor,overflow:!1,linkedTo:null}}),r},createConsole({commit:t,rootState:e,state:n},o){const s=ue(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{..._o(),subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:e.panels.currentPanel,id:r,onTop:!0,type:"poem",background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0,consoleColor:s.Poem.consoleBackgroundColor}}),r}},_1={},P1={async createSprite({commit:t,rootState:e,state:n},o){const s=await ma(o.assets[0],!1);if(!(s instanceof Mn))return;const r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{..._o(),assets:o.assets,height:s.height,width:s.width,id:r,panelId:e.panels.currentPanel,onTop:!1,type:"sprite",y:ue().Base.screenHeight/2,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom}}),r}},md=4,O1={setTalkingObject(t,e){const n=t.panels[e.panelId].objects[e.id];n.talkingObjId=e.talkingObjId,++n.version},setTalkingOther(t,e){const n=t.panels[e.panelId].objects[e.id];n.talkingOther=e.talkingOther,n.talkingObjId="$other$",++n.version},setResetBounds(t,e){const n=t.panels[e.panelId].objects[e.id];n.resetBounds=e.resetBounds,n.x=e.resetBounds.x,n.y=e.resetBounds.y,n.height=e.resetBounds.height,n.width=e.resetBounds.width,n.rotation=e.resetBounds.rotation,n.skewX=e.resetBounds.skewX,n.skewY=e.resetBounds.skewY,n.scaleX=e.resetBounds.scaleX,n.scaleY=e.resetBounds.scaleY,++n.version},setTextBoxProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},T1={createTextBox({commit:t,state:e,rootState:n},o){const s=ue(),r=e.panels[o.panelId].lastObjId+1,i=s.TextBox.DefaultTextboxStyle,l=Zo[i],a=o.resetBounds||{x:l.defaultX,y:l.defaultY,width:l.defaultWidth,height:l.defaultHeight,rotation:0,scaleX:1,scaleY:1,skewX:0,skewY:0};return t("create",{object:{..._o(),...a,panelId:n.panels.currentPanel,id:r,onTop:!0,type:"textBox",continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:i,overrideColor:!1,customColor:s.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:s.TextBoxCustom.controlsDefaultColor,customNameboxColor:s.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:s.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:o.text??"Click here to edit the textbox",resetBounds:a,overflow:!1}}),r},setStyle({state:t,commit:e},n){const o=ue(),s=t.panels[n.panelId].objects[n.id],r=Zo[s.style],i=Zo[n.style],l=10;let a=!1;const u={panelId:n.panelId,id:n.id,x:s.x,y:s.y};let c=!1;const d={panelId:n.panelId,id:n.id,width:s.width,height:s.height};i.resizable?(r.defaultWidth!==i.defaultWidth&&(c=!0,d.width=Math.max(d.width+i.defaultWidth-r.defaultWidth,l)),r.defaultHeight!==i.defaultHeight&&(c=!0,d.height=Math.max(d.height+i.defaultHeight-r.defaultHeight,l))):(c=!0,d.width=i.defaultWidth,d.height=i.defaultHeight),r.defaultX!==i.defaultX&&(a=!0,u.x=Qs(-d.width+l,u.x+i.defaultX-r.defaultX,o.Base.screenWidth-l)),r.defaultY!==i.defaultY&&(a=!0,u.y=Qs(-d.height+l,u.y+i.defaultY-r.defaultY,o.Base.screenHeight-l)),a&&e("setPosition",u),c&&e("setSize",d),e("setTextBoxProperty",oh(n.panelId,n.id,"style",n.style))},resetTextboxBounds({commit:t,state:e},n){const o=e.panels[n.panelId].objects[n.id];t("setPosition",{panelId:n.panelId,id:n.id,x:o.resetBounds.x,y:o.resetBounds.y}),t("setSize",{panelId:n.panelId,id:n.id,height:o.resetBounds.height,width:o.resetBounds.width}),t("setRotation",{panelId:n.panelId,id:n.id,rotation:o.resetBounds.rotation}),t("setObjectScale",{panelId:n.panelId,id:n.id,scaleX:o.resetBounds.scaleX,scaleY:o.resetBounds.scaleY}),t("setObjectSkew",{panelId:n.panelId,id:n.id,skewX:o.resetBounds.skewX,skewY:o.resetBounds.skewY})},async splitTextbox({commit:t,state:e,dispatch:n},o){const s=e.panels[o.panelId].objects[o.id];if(s.type!=="textBox")return;const r=(s.width-md)/2,i=r/2+md/2;let l=new DOMMatrixReadOnly().translate(s.x,s.y);s.rotation!==0&&(l=l.rotate(0,0,s.rotation)),s.skewX!==0&&(l=l.skewX(s.skewX)),s.skewY!==0&&(l=l.skewY(s.skewY)),s.flip&&(l=l.flipX()),l=l.scale(s.scaleX,s.scaleY);const a=l.transformPoint(new DOMPointReadOnly(-i,0)),u=l.transformPoint(new DOMPointReadOnly(i,0));t("setResetBounds",{id:o.id,panelId:o.panelId,resetBounds:{x:a.x,y:a.y,width:r,height:s.height,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY}});const c=s.style==="custom_plus"?"custom_plus":"custom";s.style!==c&&await n("setStyle",{...o,style:c});const d=await n("createTextBox",{panelId:o.panelId,resetBounds:{x:u.x,y:u.y,width:r,height:s.height,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY}});await n("setStyle",{panelId:o.panelId,id:d,style:c}),s.flip&&t("setFlip",{id:d,panelId:o.panelId,flip:s.flip}),t("setLink",{id:d,panelId:o.panelId,link:s.linkedTo,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,x:u.x,y:u.y})}};function oh(t,e,n,o){return{id:e,panelId:t,key:n,value:o}}const I1={create(t,{object:e}){const n=t.panels[e.panelId];e.id>n.lastObjId&&(n.lastObjId=e.id),n.objects[e.id]=e,(e.onTop?n.onTopOrder:n.order).push(e.id)},removeFromList(t,e){const n=t.panels[e.panelId],o=e.onTop?n.onTopOrder:n.order,s=o.indexOf(e.id);o.splice(s,1)},addToList(t,e){const n=t.panels[e.panelId];(e.onTop?n.onTopOrder:n.order).splice(e.position,0,e.id)},setOnTop(t,e){const o=t.panels[e.panelId].objects[e.id];o.onTop=e.onTop},setPosition(t,e){const o=t.panels[e.panelId].objects[e.id];o.x=Kt(e.x),o.y=Kt(e.y)},setLink(t,e){const n=t.panels[e.panelId],o=n.objects[e.id];let s=n.objects[e.link];if(!s&&e.link)throw new Error("Linked object does not exist.");if(s===o)throw new Error("Object cannot link to itself.");for(;s;)if(s=n.objects[s.linkedTo],s===o)throw new Error("Objects cannot be linked recursively.");o.linkedTo=e.link,o.x=Kt(e.x),o.y=Kt(e.y),o.rotation=Kt(e.rotation),o.scaleX=Kt(e.scaleX),o.scaleY=Kt(e.scaleY),o.skewX=Kt(e.skewX),o.skewY=Kt(e.skewY)},setFlip(t,e){const o=t.panels[e.panelId].objects[e.id];o.flip=e.flip},setSize(t,e){const o=t.panels[e.panelId].objects[e.id];o.width=Math.round(e.width*100)/100,o.height=Math.round(e.height*100)/100,++o.version},setRatio(t,e){const o=t.panels[e.panelId].objects[e.id];o.preserveRatio=e.preserveRatio,o.ratio=e.ratio},setRotation(t,e){const o=t.panels[e.panelId].objects[e.id];o.rotation=e.rotation<0?360-Math.abs(e.rotation)%360:e.rotation%360},removeObject(t,e){const n=t.panels[e.panelId];delete n.objects[e.id]},setComposition(t,e){const o=t.panels[e.panelId].objects[e.id];o.composite=e.composite},object_setFilters(t,e){const o=t.panels[e.panelId].objects[e.id];o.filters=e.filters},setLabel(t,e){const o=t.panels[e.panelId].objects[e.id];o.label=e.label,++o.version},setTextboxColor(t,e){const o=t.panels[e.panelId].objects[e.id];o.textboxColor=e.textboxColor,++o.version},setEnlargeWhenTalking(t,e){const o=t.panels[e.panelId].objects[e.id];o.enlargeWhenTalking=e.enlargeWhenTalking,++o.version},setObjectNameboxWidth(t,e){const o=t.panels[e.panelId].objects[e.id];o.nameboxWidth=e.nameboxWidth,++o.version},setObjectScale(t,e){const o=t.panels[e.panelId].objects[e.id];o.scaleX=e.scaleX,o.scaleY=e.scaleY,++o.version},setObjectSkew(t,e){const o=t.panels[e.panelId].objects[e.id];o.skewX=e.skewX<0?180-Math.abs(e.skewX)%180:e.skewX%180,o.skewY=e.skewY<0?180-Math.abs(e.skewY)%180:e.skewY%180,++o.version},setOverflow(t,e){const o=t.panels[e.panelId].objects[e.id];"overflow"in o&&(o.overflow=e.overflow,++o.version)},..._1,...B0,...O1,...y1,...k1,...x1},j1={removeObject({state:t,commit:e,rootState:n},o){const s=t.panels[o.panelId],r=s.objects[o.id];n.ui.selection===o.id&&e("ui/setSelection",null,{root:!0});for(const i of[...s.onTopOrder,...s.order]){if(r.id===i)continue;const l=s.objects[i];if(l.linkedTo===r.id){const a=vo(null),u=a==null?void 0:a.getLastRenderObject(l.id);u?e("setLink",{panelId:o.panelId,id:l.id,link:null,...er(u.preparedTransform)}):e("setLink",{panelId:o.panelId,id:l.id,link:null,rotation:l.rotation,scaleX:l.scaleX,scaleY:l.scaleY,skewX:l.skewX,skewY:l.skewY,x:l.x,y:l.y})}l.type==="textBox"&&l.talkingObjId===r.id&&e("setTalkingOther",{id:l.id,talkingOther:r.label??"",panelId:o.panelId})}e("removeFromList",{id:o.id,panelId:o.panelId,onTop:r.onTop}),e("removeObject",{id:o.id,panelId:o.panelId})},setPosition({state:t,commit:e,dispatch:n},o){t.panels[o.panelId].objects[o.id].type==="character"?n("setCharacterPosition",o):e("setPosition",o)},setOnTop({state:t,commit:e},n){const o=t.panels[n.panelId],s=o.objects[n.id];s.onTop!==n.onTop&&(e("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),e("addToList",{id:n.id,panelId:n.panelId,position:(n.onTop?o.onTopOrder:o.order).length,onTop:n.onTop}),e("setOnTop",{panelId:n.panelId,id:n.id,onTop:n.onTop}))},shiftLayer({state:t,commit:e},n){const o=t.panels[n.panelId],s=o.objects[n.id],r=s.onTop?o.onTopOrder:o.order;let l=r.indexOf(s.id)+n.delta;l<0&&(l=0),l>r.length&&(l=r.length),e("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),e("addToList",{panelId:n.panelId,id:n.id,position:l,onTop:s.onTop})},setPreserveRatio({commit:t,state:e},n){const s=e.panels[n.panelId].objects[n.id],r=n.preserveRatio?s.width/s.height:0;t("setRatio",{panelId:n.panelId,id:n.id,preserveRatio:n.preserveRatio,ratio:r})},copyObjects({commit:t,state:e},{sourcePanelId:n,targetPanelId:o}){const s=e.panels[n],r=e.panels[o],i=[...s.onTopOrder,...s.order],l=new Map;let a=r.lastObjId;for(const u of i){const c=++a;l.set(u,c)}for(const u of i){const c=s.objects[u],d=JSON.parse(JSON.stringify(c));if("talkingObjId"in d){const g=d;g.talkingObjId!==null&&g.talkingObjId!=="$other$"&&l.has(g.talkingObjId)&&(g.talkingObjId=l.get(g.talkingObjId))}t("create",{object:{...d,id:l.get(u),panelId:o}})}},copyObjectToClipboard({commit:t,state:e},{id:n,panelId:o}){const s=e.panels[o],r=s.objects[n],i=Object.values(s.objects),l=[r];a(r);function a(u,c=!0){if(!c&&u===r)throw new Error("Recursively linked object");for(const d of i)d.linkedTo===u.id&&(l.push(d),a(d,!1))}t("ui/setClipboard",JSON.stringify(l),{root:!0})},pasteObjectFromClipboard({commit:t,state:e,rootState:n}){if(n.ui.clipboard==null)return;const o=JSON.parse(n.ui.clipboard),s=e.panels[e.currentPanel],r=new Map;let i=s.lastObjId;for(const l of o){const a=++i;r.set(l.id,a),l.id=a}for(const l of o)l.linkedTo!=null&&(l.linkedTo=r.get(l.linkedTo)??null),t("create",{object:{...l,panelId:e.currentPanel}})},object_addFilter({state:t,commit:e},n){Ml(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_removeFilter({state:t,commit:e},n){Bl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_moveFilter({state:t,commit:e},n){El(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_setFilter({state:t,commit:e},n){Dl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},...P1,...D0,...T1,...w1,...C1,...S1};function $1(t,e){const n=t.state.panels;for(const o in n){const s=n[o];for(const r in s.objects){const i=s.objects[r];i.type==="character"&&L0(t,i.panelId,i.id,e)}}}function Kt(t){return Math.round(t*100)/100}var $s=(t=>(t[t.None=0]="None",t[t.Stretch=1]="Stretch",t[t.Cover=2]="Cover",t))($s||{});const A1="buildin.transparent",xs={panelToUrl:new Map,urlToPanel:new Map,register(t,e){if(this.panelToUrl.has(t)){if(this.panelToUrl.get(t)===e)return;this.unregister(t,this.panelToUrl.get(t))}this.panelToUrl.set(t,e),this.urlToPanel.has(e)?this.urlToPanel.get(e).push(t):this.urlToPanel.set(e,[t])},unregister(t,e){if(this.urlToPanel.has(e)){const n=this.urlToPanel.get(e);n.splice(n.indexOf(t),1),n.length===0&&(this.urlToPanel.delete(e),URL.revokeObjectURL(e))}this.panelToUrl.delete(t)}},R1={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[],currentPanel:null},mutations:{setCurrentPanel(t,{panelId:e}){t.currentPanel=e},setPanelPreview(t,{panelId:e,url:n}){t.panels[e].lastRender=n,xs.register(e,n)},createPanel(t,{panel:e}){t.lastPanelId=e.id,t.panels[e.id]=e},setPanelOrder(t,{panelOrder:e}){t.panelOrder=[...e]},setCurrentBackground(t,{current:e,panelId:n}){const o=t.panels[n];o.background.current=e,o.background.variant=0},setBackgroundColor(t,{color:e,panelId:n}){const o=t.panels[n];o.background.color=e},setBackgroundFlipped(t,{flipped:e,panelId:n}){const o=t.panels[n];o.background.flipped=e},setBackgroundVariant(t,{variant:e,panelId:n}){const o=t.panels[n];o.background.variant=e},setBackgroundScaling(t,{scaling:e,panelId:n}){const o=t.panels[n];o.background.scaling=e},deletePanel(t,{panelId:e}){xs.unregister(e,xs.panelToUrl.get(e)),delete t.panels[e]},setComposition(t,e){const n=t.panels[e.panelId];n.composite=e.composite},setFilters(t,e){const n=t.panels[e.panelId];n.filters=e.filters},backgroundSetComposition(t,e){const n=t.panels[e.panelId];n.background.composite=e.composite},backgroundSetFilters(t,e){const n=t.panels[e.panelId];n.background.filters=e.filters},...I1},actions:{createPanel({state:t,commit:e}){const n=t.lastPanelId+1;return e("createPanel",{panel:{id:n,background:{color:"#000000",current:A1,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),e("setPanelOrder",{panelOrder:[...t.panelOrder,n]}),e("setCurrentPanel",{panelId:n}),n},duplicatePanel({state:t,commit:e},{panelId:n}){const o=t.panels[n],s=t.lastPanelId+1;xs.register(s,o.lastRender);const r=JSON.parse(JSON.stringify(o));let i=-1;const l=new Map,a={};for(const c in r.objects)l.set(+c,++i);for(const c in r.objects){const d=r.objects[c],g=l.get(+c);if(a[g]=d,d.panelId=s,d.id=g,"talkingObjId"in d){const b=d;b.talkingObjId!==null&&b.talkingObjId!=="$other$"&&l.has(b.talkingObjId)&&(b.talkingObjId=l.get(b.talkingObjId))}d.linkedTo!=null&&(d.linkedTo=l.get(d.linkedTo))}e("createPanel",{panel:{...r,id:s,lastObjId:i,objects:a,order:r.order.map(c=>l.get(c)),onTopOrder:r.onTopOrder.map(c=>l.get(c))}});const u=t.panelOrder.indexOf(n);e("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,u+1),s,...t.panelOrder.slice(u+1)]}),e("setCurrentPanel",{panelId:s})},seekBackgroundVariant({state:t,rootGetters:e,commit:n},{delta:o}){const s=t.panels[t.currentPanel],i=e["content/getBackgrounds"].get(s.background.current);i&&n("setBackgroundVariant",{panelId:t.currentPanel,variant:Fo(i.variants,s.background.variant,o)})},delete({state:t,commit:e},{panelId:n}){if(t.panelOrder.length<=1)return;const o=t.panelOrder.indexOf(n);let s;o===t.panelOrder.length-1?s=o-1:s=o+1,e("setCurrentPanel",{panelId:t.panelOrder[s]}),e("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,o),...t.panelOrder.slice(o+1)]}),e("deletePanel",{panelId:n})},fixContentPackRemoval(t,e){const{state:n,rootGetters:o,commit:s,rootState:r}=t;for(const i of Object.values(n.panels)){const l=e.backgrounds.find(d=>d.id===i.background.current);if(!l)return;const a=o["content/getBackgrounds"].get(i.background.current);if(!a){r.content.current.backgrounds.length>0?s("setCurrentBackground",{current:r.content.current.backgrounds[0].id,panelId:i.id}):s("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const u=JSON.stringify(l.variants[i.background.variant]),c=a.variants.findIndex(d=>JSON.stringify(d)===u);c!==i.background.variant&&s("setBackgroundVariant",{variant:c===-1?0:c,panelId:i.id})}$1(t,e)},move({state:t,commit:e},{panelId:n,delta:o}){const s=[...t.panelOrder],r=s.indexOf(n);s.splice(r,1);const i=Math.max(r+o,0);s.splice(i,0,n),e("setPanelOrder",{panelOrder:s})},addFilter({state:t,commit:e},n){Ml(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},removeFilter({state:t,commit:e},n){Bl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},moveFilter({state:t,commit:e},n){El(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},setFilter({state:t,commit:e},n){Dl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},backgroundAddFilter({state:t,commit:e},n){Ml(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundRemoveFilter({state:t,commit:e},n){Bl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundMoveFilter({state:t,commit:e},n){El(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundSetFilter({state:t,commit:e},n){Dl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},...j1}};function sh(){return{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1}}const M1={namespaced:!0,state:sh(),mutations:{setVertical(t,e){t.vertical=e},setNsfw(t,e){t.nsfw=e},setLqRendering(t,e){t.lqRendering=e},setSelection(t,e){t.selection=e},setLastDownload(t,e){t.lastDownload=e},setClipboard(t,e){t.clipboard=e},setDarkTheme(t,e){t.useDarkTheme=e},setDefaultCharacterTalkingZoom(t,e){t.defaultCharacterTalkingZoom=e},setColorPicker(t,e){t.pickColor=e}}},B1={namespaced:!0,state:{},mutations:{add(t,{name:e,url:n}){t[e]=n}},actions:{async add({state:t,commit:e,rootState:n},{name:o,url:s}){if(t[o])throw new Error(`There is already an uploaded file called "${o}"`);const r="uploads:"+o;return e("add",{name:r,url:s}),tp(r,s),await j0(n,e,r),r}}};function Ne(){return im()}const E1=xm({state:{unsafe:!1},mutations:{setUnsafe(t,e){t.unsafe=e},...I0},actions:{async removePacks({dispatch:t,commit:e},{packs:n}){e("setUnsafe",!0),await t("content/removeContentPacks",n),e("setUnsafe",!1)},async getSave({state:t},e){const n=await yn.getInstance();return JSON.stringify({...t,version:2.5},(o,s)=>{if(o!=="ui"&&o!=="lastRender")return o==="uploadUrls"?Object.keys(s):o==="content"&&e?s.contentPacks.filter(r=>{var i,l;return!((i=r.packId)!=null&&i.startsWith("dddg.buildin."))||((l=r.packId)==null?void 0:l.endsWith(".nsfw"))}).map(r=>{var l;let i=(l=r.packId)!=null&&l.startsWith("dddg.uploads.")?r:r.packId;if(r.packId!=null){const a=n.getPack(r.packId);a&&a.repoUrl!=null&&(i+=`;${a.repoUrl}`)}return i}):s},2)},async loadSave({state:t},e){const n=JSON.parse(e),o=n.content;n.ui={...sh(),vertical:t.ui.vertical,lqRendering:t.ui.lqRendering,nsfw:o.find(a=>typeof a=="string"&&a.startsWith("dddg.buildin.")&&a.endsWith(".nsfw"))!==void 0,clipboard:t.ui.clipboard,useDarkTheme:t.ui.useDarkTheme,defaultCharacterTalkingZoom:t.ui.defaultCharacterTalkingZoom},n.uploadUrls={},n.content=sp();const s=await yn.getInstance(),r=new Set,i=await Promise.allSettled(o.map(async a=>{if(typeof a!="string")return a;let u=null,c;if(a.indexOf(";")>=0?[c,u]=a.split(";"):c=a,r.has(c))return null;r.add(c);const d=t.content.contentPacks.find(y=>y.packId===c);if(d)return d;if(a.startsWith("dddg.buildin.")&&a.endsWith(".nsfw")){const y=await jl(pa[a]);return await Js(y)}u!=null&&!s.hasPack(c)&&await s.loadTempPack(u);const g=s.getPack(c);if(!g)return console.warn(`Pack Id ${a} not found!`),null;const b=await jl(g.dddg2Path||g.dddg1Path);return await Js(b)}));for(const a of i)a.status==="rejected"&&($e.fire(new uo(""+a.reason)),console.error(a.reason));n.content.contentPacks=[...t.content.contentPacks.filter(a=>{var u;return(u=a.packId)==null?void 0:u.startsWith("dddg.buildin.")}),...i.filter(a=>a.status==="fulfilled").map(a=>a.value).filter(a=>a!==null)];let l=n.content.current;for(const a of n.content.contentPacks)l=js(l,a);n.content.current=l,(n.version==null||n.version<2.5)&&T0(n),this.replaceState(n),$e.fire(new br)}},modules:{ui:M1,panels:R1,content:Xm,uploadUrls:B1}}),D1={key:0},L1=["onClick"],N1=["onClick"],F1=5e3,ul=2e4,bd=100,H1=Se({__name:"message-console",props:{loading:{type:Boolean}},setup(t){const e=t,n=Ne(),o=W([]),s=W([]),r=W([]),i=W(!1),l=W(0),a=W(0),u=M(()=>n.state.ui.vertical);c(e.loading),$e.subscribe(Vs,b=>{o.value.push(`Failed to load asset '${b.path}'`),setTimeout(()=>{o.value.shift()},F1)}),$e.subscribe(Nf,()=>{o.value.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{o.value.shift()},ul)}),$e.subscribe(uo,b=>{s.value.push(b.message)}),$e.subscribe(ca,b=>{r.value.push(b)}),$e.subscribe(Ot,b=>{o.value.push(b.message),setTimeout(()=>{o.value.shift()},ul)}),$e.subscribe(Ff,b=>{o.value.push(b.error.name),o.value.push(JSON.stringify(b.error.stack)),o.value.push(b.info),setTimeout(()=>{o.value.shift(),o.value.shift(),o.value.shift()},ul)});function c(b){b?(a.value&&(clearTimeout(a.value),a.value=0),!i.value&&!l.value&&(l.value=setTimeout(()=>{i.value=!0,l.value=0},bd))):(l.value&&(clearTimeout(l.value),l.value=0),i.value&&!a.value&&(a.value=setTimeout(()=>{i.value=!1,a.value=0},bd)))}function d(b){s.value.splice(b,1)}async function g(b,y){const w=r.value[b];r.value.splice(b,1),await w.actions.find(k=>k.name===y).exec()}return ze(()=>e.loading,b=>{c(b)}),(b,y)=>($(),F("div",{id:"messageConsole",class:Le({vertical:u.value})},[i.value?($(),F("p",D1,"Loading...")):fe("",!0),($(!0),F(ae,null,qe(o.value,(w,_)=>($(),F("p",{key:w+"_"+_},Pe(w),1))),128)),($(!0),F(ae,null,qe(r.value,(w,_)=>($(),F("p",{class:"error",key:"resolvableError_"+_},[Y(Pe(w.message)+" ",1),($(!0),F(ae,null,qe(w.actions,k=>($(),F("a",{href:"#",key:"resolvableError_"+_+k.name,onClick:h=>g(_,k.name)},"["+Pe(k.name)+"]",9,L1))),128))]))),128)),($(!0),F(ae,null,qe(s.value,(w,_)=>($(),F("p",{class:"error",key:"error_"+_},[Y(Pe(w)+" ",1),p("a",{href:"#",onClick:k=>d(_)},"[Dismiss]",8,N1)]))),128))],2))}}),Be=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n},U1=Be(H1,[["__scopeId","data-v-edb19d29"]]),V1={key:0,id:"submit-options"},W1=["onClick"],q1={key:0,id:"submit-options"},z1=["onClick"],G1=Se({__name:"modal-dialog",props:{noBaseSize:{type:Boolean,default:!1},options:{default:()=>[]}},emits:["leave","option"],setup(t,{emit:e}){const n=t,o=e,s=typeof HTMLDialogElement<"u",r=W(null);function i(){if(s){const u=r.value;u!=null&&!u.open&&u.showModal()}window.addEventListener("click",a)}function l(){if(s){const u=r.value;u!=null&&u.open&&u.close(),o("leave")}window.removeEventListener("click",a)}function a(u){const c=r.value;c!=null&&c.open?u.target===c&&(l(),u.preventDefault(),u.stopPropagation()):window.removeEventListener("click",a)}return ht(i),uf(i),cf(l),Rt(l),(u,c)=>s?($(),F("dialog",{key:0,ref_key:"dialog",ref:r,class:Le(["native",{"base-size":!n.noBaseSize}]),onCancel:l},[qt(u.$slots,"default",{},void 0,!0),u.options.length>0?($(),F("div",V1,[($(!0),F(ae,null,qe(u.options,d=>($(),F("button",{key:d,class:"option",onClick:g=>o("option",d)},Pe(d),9,W1))),128))])):fe("",!0)],34)):($(),F("div",{key:1,class:"dialog-wrapper",onClick:c[1]||(c[1]=d=>o("leave"))},[p("dialog",{ref_key:"dialog",ref:r,open:"",class:Le({"base-size":!n.noBaseSize}),onClick:c[0]||(c[0]=ce(()=>{},["stop"]))},[qt(u.$slots,"default",{},void 0,!0),u.options.length>0?($(),F("div",q1,[($(!0),F(ae,null,qe(n.options,d=>($(),F("button",{key:d,class:"option",onClick:g=>o("option",d)},Pe(d),9,z1))),128))])):fe("",!0)],2)]))}}),oo=Be(G1,[["__scopeId","data-v-07b9fd71"]]),X1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23000'%20stroke='%23000'%3e%3cpath%20d='M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z'/%3e%3c/svg%3e",Y1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23fff'%20stroke='%23fff'%3e%3cpath%20d='M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z'/%3e%3c/svg%3e",K1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23000'%20stroke='%23000'%3e%3cpath%20d='M440-80q-50-5-96-24.5T256-156l56-58q29%2021%2061.5%2034t66.5%2018v82Zm80%200v-82q104-15%20172-93.5T760-438q0-117-81.5-198.5T480-718h-8l64%2064-56%2056-160-160%20160-160%2056%2058-62%2062h6q75%200%20140.5%2028.5t114%2077q48.5%2048.5%2077%20114T840-438q0%20137-91%20238.5T520-80ZM198-214q-32-42-51.5-88T122-398h82q5%2034%2018%2066.5t34%2061.5l-58%2056Zm-76-264q6-51%2025-98t51-86l58%2056q-21%2029-34%2061.5T204-478h-82Z'/%3e%3c/svg%3e",J1="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23fff'%20stroke='%23fff'%3e%3cpath%20d='M440-80q-50-5-96-24.5T256-156l56-58q29%2021%2061.5%2034t66.5%2018v82Zm80%200v-82q104-15%20172-93.5T760-438q0-117-81.5-198.5T480-718h-8l64%2064-56%2056-160-160%20160-160%2056%2058-62%2062h6q75%200%20140.5%2028.5t114%2077q48.5%2048.5%2077%20114T840-438q0%20137-91%20238.5T520-80ZM198-214q-32-42-51.5-88T122-398h82q5%2034%2018%2066.5t34%2061.5l-58%2056Zm-76-264q6-51%2025-98t51-86l58%2056q-21%2029-34%2061.5T204-478h-82Z'/%3e%3c/svg%3e";async function mo(t,e){try{await e()}catch(n){Z1(t,n)}}function Z1(t,e){console.error("Error in promise",t,e),$e.fire(new uo("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+t+'", '+Q1(e)))}function Q1(t){if(t instanceof Error){if(t.stack!=null){const e=t.stack.split(`
`);return e[0].includes(t.name)&&e[0].includes(t.message)?e[0]+`
<br />`+e[1]:t.name+": "+t.message+`
<br />`+e[0]}return t.name+": "+t.message}return t instanceof Object?JSON.stringify(t):""+t}const fn=window.devicePixelRatio??1;function ek(t,e){const n=ok(e);if(t.save(),et)o(e,et.lastPos),et.grabby.paint(t,et),t.translate(et.lastPos.x,et.lastPos.y),t.scale(fn,fn),wd(t,et.grabby,new DOMPointReadOnly);else{const s=ue();t.translate(n.x,n.y),t.scale(fn,fn),e.x>s.Base.screenWidth/2&&t.scale(-1,1),e.y>s.Base.screenHeight/2&&t.scale(1,-1);for(let r=0;r<sr.length;r++){const i=sr[r];i.pos||(i.pos=rk(sk*(r+1))),wd(t,i,i.pos)}}t.restore();function o(s,r){t.save();try{t.beginPath(),t.moveTo(s.x,s.y),t.lineTo(r.x,r.y),t.setLineDash([5*fn,5*fn]),t.strokeStyle="#000",t.stroke(),t.closePath()}finally{t.restore()}}}const or=2*Math.PI,sr=[{icon:K1,iconDark:J1,paint(t,{lastPos:e,center:n,initialDragAngle:o}){const{angle:s}=Ss(Do(n,e)),r=ue().Base,i=Rl(o-s,or);t.beginPath(),t.moveTo(n.x,n.y);let l=o-Math.PI,a=l+s-o;if(i<=Math.PI){const u=a;a=l,l=u}t.arc(n.x,n.y,r.wheelInnerRadius,l,a),t.lineTo(n.x,n.y),t.globalCompositeOperation="difference",t.fillStyle="rgba(255, 255, 255, 1)",t.fill(),t.globalCompositeOperation="source-over"},onStartMove(t,e,n){n.initalObjRotation=e.rotation;const{angle:o}=Ss(Do(n.center,n.lastPos));n.initialDragAngle=o},onMove(t,e,n,{center:o,initalObjRotation:s,initialDragAngle:r}){const{angle:i}=Ss(Do(o,et.lastPos));let l=Rl(s+(i-r)/Math.PI*180,360);n&&(l=Math.round(l/22.5)*22.5),e.rotation!==l&&t.commit("panels/setRotation",{panelId:e.panelId,id:e.id,rotation:l})}},{icon:X1,iconDark:Y1,paint(t,{renderObj:e,originalObjTransform:n}){if(n==null)return;const o=e.preparedTransform;try{e.preparedTransform=n,vn(t,()=>{t.globalAlpha=.5,e.render(t,en.None,!0,!1,!0),t.globalAlpha=1})}finally{e.preparedTransform=o}},onStartMove(t,e,n){n.originalObjTransform=n.renderObj.preparedTransform,n.initialScaleX=e.scaleX,n.initialScaleY=e.scaleY,n.initialDelta=Do(n.center,n.lastPos)},onMove(t,e,n,{initialScaleX:o,initialScaleY:s,initialDelta:r,center:i,lastPos:l}){const a=ue(),u=Do(i,l);let c=u.x/r.x*o,d=u.y/r.y*s;if(n){let g=u;i.x>a.Base.screenWidth/2&&(g=new DOMPointReadOnly(-g.x,g.y)),i.y>a.Base.screenHeight/2&&(g=new DOMPointReadOnly(g.x,-g.y));const{angle:b}=Ss(g),y=Math.round(b/or*11),w=(Math.abs(u.x)/Math.abs(r.x)+Math.abs(u.y)/Math.abs(r.y))/2;y===0||y===11?d=s:y===1?(c=-w*o,d=-w*s):y===2||y===3?c=o:y===4?(c=w*o,d=-w*s):y===5||y===6?d=s:y===7?(c=w*o,d=w*s):y===8||y===9?c=o:y===10&&(c=-w*o,d=w*s)}e.scaleX===c&&e.scaleY===d||t.commit("panels/setObjectScale",{panelId:e.panelId,id:e.id,scaleX:c,scaleY:d})}}];let et=null;function tk(t){const e=ue(),n=sr.find(o=>{const s=o.lastDrawPos;return s?Math.sqrt(Math.pow(t.x-s.x,2)+Math.pow(t.y-s.y,2))<=e.Base.wheelWidth/2*fn:!1});return n?(et={lastPos:t,started:!1,grabby:n,center:null,renderObj:null},!0):!1}function nk(t,e,n){var i;if(!et)return!1;const o=t.state.panels,r=o.panels[o.currentPanel].objects[t.state.ui.selection];if(!et.started){et.started=!0;const l=vo(t),a=l.getLastRenderObject(r.id),u=((i=l==null?void 0:l.getLastRenderObject(r.linkedTo))==null?void 0:i.preparedTransform)??new DOMMatrixReadOnly;et.renderObj=a,et.center=u.transformPoint(new DOMPointReadOnly(r.x,r.y)),et.grabby.onStartMove(t,r,et)}return et.lastPos=e,et.grabby.onMove(t,r,n,et),!0}function yd(){return et?(et=null,!0):!1}const Hl=new Map;for(const t of sr)mo("Loading grabby icon",(async e=>{Hl.set(e.icon,await fo(e.icon)),Hl.set(e.iconDark,await fo(e.iconDark))}).bind(void 0,t));function wd(t,e,n){var i;const o=ue();t.save(),t.translate(n.x,n.y),e.lastDrawPos=t.getTransform().transformPoint(new DOMPointReadOnly),t.scale(-1,1),t.beginPath(),t.ellipse(0,0,o.Base.wheelWidth/2,o.Base.wheelWidth/2,0,0,or),t.closePath();const s=getComputedStyle(document.body);t.fillStyle=s.getPropertyValue("--accent-background"),t.strokeStyle=s.getPropertyValue("--border"),t.lineWidth=2,t.fill(),t.stroke();const r=document.body.classList.contains("dark-theme")?e.iconDark:e.icon;(i=Hl.get(r))==null||i.paintOnto(t),t.restore()}function ok(t){const e=ue(),n=e.Base.wheelWidth+e.Base.wheelInnerRadius*fn;return new DOMPointReadOnly(Qs(n,t.x,e.Base.screenWidth-n),Qs(n,t.y,e.Base.screenHeight-n))}const sk=Math.PI/6;function rk(t){const e=ue().Base;return new DOMPointReadOnly(e.wheelInnerRadius*Math.cos(t),e.wheelInnerRadius*Math.sin(t))}function Do(t,e){return new DOMPointReadOnly(t.x-e.x,t.y-e.y)}function Ss(t){const e=Math.atan2(t.y,t.x);return{angle:Rl(e,or),distance:Math.sqrt(t.x*t.x+t.y*t.y)}}const ik=["height","width"],lk=Se({__name:"preview-render",props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean,default:!1}},setup(t,{expose:e}){const n=t,o=Ne(),s=W(null),r=W(null),i=W(null),l=W(!1),a=W(!1),u=M(()=>o.state.ui.selection??null),c=M(()=>o.state.panels.panels[o.state.panels.currentPanel]),d=M(()=>o.state.ui.lqRendering);function g(){if(n.preLoading)return null;const K=vo(o);return K==null||K.setPanelId(o.state.panels.currentPanel),K}const b=M(()=>(n.preLoading,ue().Base.screenHeight)),y=M(()=>(n.preLoading,ue().Base.screenWidth));function w(){i.value==null&&(i.value=requestAnimationFrame(_))}async function _(){var K;if(i.value!=null&&(cancelAnimationFrame(i.value),i.value=null),!n.preLoading&&!o.state.unsafe){try{await((K=g())==null?void 0:K.render(!d.value,!0,!0))}catch(be){console.log(be)}h(),$e.fire(new Ws)}}function k(){const K=document.createElement("canvas");K.height=b.value,K.width=y.value;try{ho.make(K,!0,!1).drawText({text:"Starting...",x:K.width/2,y:K.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),r.value.drawImage(K,n.canvasWidth,n.canvasHeight)}finally{po(K)}}function h(){const K=g();l.value=!1,K==null||K.paintOnto(r.value,{x:0,y:0,w:y.value,h:b.value});const be=K==null?void 0:K.getLastRenderObject(u.value);be&&ek(r.value,be.preparedTransform.transformPoint(new DOMPoint(0,0))),x.value=!1}function v(K,be,Ce){const Ae=s.value,J=K-Ae.offsetLeft,U=be-Ae.offsetTop;let re=J/Ae.offsetWidth*Ae.width,S=U/Ae.offsetWidth*Ae.width;if(Ce){const O=Ce.transformPoint(new DOMPointReadOnly(re,S));re=O.x,S=O.y}return[re,S]}function f(K){const[be,Ce]=v(K.clientX,K.clientY);if(T(be,Ce))return;if(a.value){a.value=!1;return}const Ae=g().objectsAt(be,Ce),J=u.value,U=Ae.findIndex(S=>S===J);let re;U===0?re=null:U!==-1?re=Ae[U-1]:re=Ae[Ae.length-1]??null,te(()=>{o.state.ui.selection!==re&&o.commit("ui/setSelection",re)})}ze(()=>[n.canvasWidth,n.canvasHeight],()=>h()),$e.subscribe(br,w),$e.subscribe(qs,()=>{const K=g();K&&K.setPanelId(-1)}),o.subscribe(K=>{K.type!=="panels/setPanelPreview"&&K.type!=="panels/currentPanel"&&w()}),ht(()=>{r.value=s.value.getContext("2d"),k(),w()}),Rt(()=>{g().dispose()});const x=W(!1);async function P(K){if(x.value)_(),x.value=!1;else{const be=await Ks(K,!0);r.value.clearRect(0,0,s.value.width,s.value.height),be.paintOnto(r.value,{x:0,y:0}),x.value=!0}}const j=M(()=>o.state.ui.pickColor),m=M(()=>j.value?"crosshair":"default");function T(K,be){if(j.value){const Ce=r.value.getImageData(K,be,1,1).data,Ae=`rgba(${Ce[0].toString()},${Ce[1].toString()},${Ce[2].toString()},${(Ce[3]/255).toString()})`;return te(()=>{o.commit("ui/setColorPicker",!1),$e.fire(new zs(Ae))}),!0}return!1}async function R(){const K=await g().download();await te(()=>{const be=o.state.ui.lastDownload;o.commit("ui/setLastDownload",K),be!=null&&URL.revokeObjectURL(be)})}let B=null,D=null,N=0,ee=0,xe=0,z=0;function I(K){K.preventDefault(),A(K.clientX,K.clientY)}function C(K){A(K.touches[0].clientX,K.touches[0].clientY)}function A(K,be){var U,re;const Ce=u.value;if(Ce===null)return;B=c.value.objects[Ce],D=((re=(U=vo(o).getLastRenderObject(B.linkedTo))==null?void 0:U.preparedTransform)==null?void 0:re.inverse())??new DOMMatrixReadOnly;const[Ae,J]=v(K,be,D);Ce!=null&&tk(new DOMPointReadOnly(...v(K,be)))||(N=Ae-B.x,ee=J-B.y,xe=B.x,z=B.y)}function oe(K){K.stopPropagation(),K.preventDefault(),K.dataTransfer.dropEffect="copy"}function pe(K){if(!B)return;K.preventDefault();const be=K instanceof MouseEvent?K.clientX:K.touches[0].clientX,Ce=K instanceof MouseEvent?K.clientY:K.touches[0].clientY;let[Ae,J]=v(be,Ce,D);if(nk(o,new DOMPointReadOnly(...v(be,Ce)),K.shiftKey)){w();return}Ae-=N,J-=ee;const U=Math.abs(Ae-xe),re=Math.abs(J-z);U+re>1&&(a.value=!0),K.shiftKey&&(U>re?J=z:Ae=xe),te(async()=>{await o.dispatch("panels/setPosition",{panelId:B.panelId,id:B.id,x:Ae,y:J})})}async function Oe(K){if(K.stopPropagation(),K.preventDefault(),!!K.dataTransfer){for(const be of K.dataTransfer.items)if(be.kind==="file"&&be.type.match(/image.*/)){const Ce=be.getAsFile(),Ae=URL.createObjectURL(Ce);try{const J=await o.dispatch("uploadUrls/add",{name:Ce.name,url:Ae});await te(async()=>{await o.dispatch("panels/createSprite",{panelId:o.state.panels.currentPanel,assets:[{hq:J,lq:J,sourcePack:"dddg.uploaded.sprites"}]})})}catch{URL.revokeObjectURL(Ae)}}}}function Ie(K){if(yd()){w(),K.preventDefault(),B=null,a.value=!0;return}B&&("TouchEvent"in window&&K instanceof TouchEvent&&(a.value=!1),B=null)}function tt(K){K.buttons!==1&&(B=null,yd()&&w())}return e({download:R,blendOver:P}),(K,be)=>($(),F("canvas",{id:"scaled_display",ref_key:"sd",ref:s,height:b.value,width:y.value,style:Qe({width:K.canvasWidth+"px",height:K.canvasHeight+"px",cursor:m.value}),draggable:"true",onClick:f,onTouchstart:C,onDragstart:I,onTouchmove:pe,onMousemove:pe,onTouchend:Ie,onMouseup:Ie,onDragover:oe,onDrop:Oe,onMouseenter:tt,onContextmenu:be[0]||(be[0]=ce(()=>{},["prevent"]))}," HTML5 is required to use the Doki Doki Dialog Generator. ",44,ik))}}),ak=["disabled","title","aria-label"],uk={key:0,class:"material-icons","aria-hidden":"true"},ck={class:"content"},dk={key:1,class:"shortcut-popup"},fk=Se({__name:"d-button",props:{icon:{},iconPos:{default:"left"},disabled:{type:Boolean,default:!1},shortcut:{},title:{}},setup(t){const e=t,n=W(null),o=M(()=>e.shortcut!=null&&!e.shortcut.startsWith("!")),s=M(()=>{const i=e.shortcut;return i==null?"":i.startsWith("!")?i.substring(1):i});function r(i){e.disabled||i.key===e.shortcut&&i.ctrlKey&&!i.altKey&&!i.metaKey&&!i.shiftKey&&(n.value.focus({focusVisible:!1}),n.value.click(),i.preventDefault(),i.stopPropagation())}return ht(()=>{e.shortcut!=null&&window.addEventListener("keydown",r)}),Rt(()=>{window.removeEventListener("keydown",r)}),(i,l)=>($(),F("button",{class:Le([i.iconPos]),disabled:i.disabled,title:i.title,"aria-label":i.title,style:Qe(i.icon?"height: auto":""),ref_key:"btn",ref:n},[i.icon?($(),F("div",uk,Pe(i.icon),1)):fe("",!0),p("div",ck,[qt(i.$slots,"default",{},void 0,!0)]),o.value?($(),F("div",dk,Pe(s.value),1)):fe("",!0)],14,ak))}}),je=Be(fk,[["__scopeId","data-v-bbb09c0d"]]),pk={methods:{verticalScrollRedirect:rh}};function rh(t){if(t.type!=="wheel"||!t.currentTarget)return;const e=t.currentTarget,n=getComputedStyle(e),o=t;if(o.deltaY===0)return;if(n.overflowY==="auto"){if(o.deltaY>0){if(e.scrollHeight>e.scrollTop+e.clientHeight){t.stopPropagation();return}}else if(e.scrollTop>0){t.stopPropagation();return}}const s=e.scrollLeft;e.scrollLeft+=o.deltaY,e.scrollLeft!==s&&t.stopPropagation()}function $t(t){const e=Ne(),n=M(()=>e.state.ui.vertical);function o(){const r=t.value;return r==null?null:r.$el?r.$el:r}function s(){t.value!=null&&o().classList.toggle("vertical",n.value)}return ze(()=>n.value,s),ht(()=>{s(),o().addEventListener("wheel",r=>{n.value||rh(r)},{passive:!0})}),{vertical:n,getRoot:o}}const hk=["title","onClick","onKeypress"],gk=["src","alt"],vk=Se({__name:"characters-tab",emits:["show-dialog"],setup(t,{emit:e}){const n=e,o=Ne(),s=M(()=>o.state.content.current.characters);function r(l){return l.chibi?he.supports.lq?l.chibi.lq:l.chibi.hq:""}function i(l){te(async()=>{await o.dispatch("panels/createCharacters",{characterType:l,panelId:o.state.panels.currentPanel})})}return(l,a)=>($(),F(ae,null,[($(!0),F(ae,null,qe(s.value,u=>($(),F("div",{class:"character",tabindex:"0",key:u.id,title:u.label,onClick:ce(c=>i(u.id),["left"]),onKeypress:[st(ce(c=>i(u.id),["prevent","stop"]),["enter"]),st(ce(c=>i(u.id),["prevent","stop"]),["space"])]},[p("img",{src:r(u),alt:u.label},null,8,gk)],40,hk))),128)),H(je,{class:"custom-sprite",icon:"extension",onClick:a[0]||(a[0]=u=>n("show-dialog","type: Characters"))},{default:Q(()=>a[1]||(a[1]=[Y(" Search in content packs ")])),_:1})],64))}}),mk=Be(vk,[["__scopeId","data-v-71aa669d"]]),bk=Se({__name:"drop-target",emits:["drop"],setup(t,{expose:e,emit:n}){const o=n,s=Ne(),r=W(!1),i=M(()=>s.state.ui.vertical);function l(){r.value=!0}function a(){r.value=!1}function u(c){if(a(),c.stopPropagation(),c.preventDefault(),!!c.dataTransfer){for(const d of c.dataTransfer.items)if(d.kind==="file"&&d.type.match(/image.*/)){const g=d.getAsFile();g!=null&&o("drop",g)}}}return e({show:l,hide:a}),(c,d)=>r.value?($(),F("div",{key:0,onDragleave:d[0]||(d[0]=g=>r.value=!1),onDrop:u,class:Le({vertical:i.value})},[qt(c.$slots,"default",{},void 0,!0)],34)):fe("",!0)}}),ih=Be(bk,[["__scopeId","data-v-d71cb0d9"]]),yk=["title","onClick","onKeypress"],wk=["title","onClick","onKeypress"],kk=Se({__name:"sprites-tab",emits:["show-dialog"],setup(t,{expose:e,emit:n}){const o=n,s=Ne(),r=M(()=>s.state.content.current.sprites.map(P=>{let j=null;const m=P.variants[0].map(T=>{const R=gn(T,!1);return R.startsWith("uploads:")?(Object.keys(s.state.uploadUrls),j=R,ep):R});return{...P,missing:j,urls:m}})),i=M(()=>he.supports.openableFolders.has("sprites"));function l(P){return P.variants[0].map(j=>`url('${gn(j,!1)}')`).join(",")}async function a(P){await te(async()=>{await s.dispatch("panels/createSprite",{panelId:s.state.panels.currentPanel,assets:P.variants[0]})})}function u(){he.openFolder("sprites")}const c=W(null);async function d(){const P=c.value,j=P.uploadingSprite;if(!P.files)return;if(P.files.length!==1){console.error("More than one file uploaded!");return}const m=P.files[0];await te(async()=>{const T=URL.createObjectURL(m);await s.dispatch("uploadUrls/add",{name:j,url:T})})}function g(P){const j=c.value;j.uploadingSprite=gn(P.variants[0][0]).substring(8),j.click()}const b={packId:"dddg.uploads.sprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},y=W(null);function w(){const P=y.value;if(P.files)for(const j of P.files)k(j)}async function _(){const P=prompt("Enter the URL of the image");if(P==null)return;const j=P.split("/").slice(-1)[0];await h(j,P)}async function k(P){await te(async j=>{const m=URL.createObjectURL(P),T=await s.dispatch("uploadUrls/add",{name:P.name,url:m});await h(P.name,T,j)})}async function h(P,j,m=te){const T=s.state.content.contentPacks.find(B=>B.packId===b.packId)||b,R={...T,sprites:[...T.sprites,{id:j,label:P,variants:[[{lq:j,hq:j}]],defaultScale:[1,1],hd:null}]};await m(async()=>{await s.dispatch("content/replaceContentPack",{contentPack:R,processed:!0})})}const v=W(null);function f(P){P.dataTransfer&&(P.dataTransfer.effectAllowed="none",Array.from(P.dataTransfer.items).find(j=>j.type.match(/^image.*$/))&&(P.dataTransfer.effectAllowed="link",v.value.show()))}function x(){v.value.hide()}return e({showDropTarget:f,hideDropTarget:x}),(P,j)=>($(),F(ae,null,[H(ih,{ref_key:"spriteDt",ref:v,class:"drop-target",onDrop:k},{default:Q(()=>j[2]||(j[2]=[Y("Drop here to add as a new sprite ")])),_:1},512),($(!0),F(ae,null,qe(r.value,m=>($(),F(ae,null,[m.missing!==null?($(),F("div",{class:"sprite",tabindex:"0",key:`${m.label}_missing`,title:m.label,style:Qe({background:l(m)}),onClick:T=>g(m),onKeypress:[st(ce(T=>g(m),["prevent","stop"]),["enter"]),st(ce(T=>g(m),["prevent","stop"]),["space"])]},Pe(m.label),45,yk)):($(),F("div",{class:"sprite",tabindex:"0",key:m.label,title:m.label,style:Qe({background:l(m)}),onClick:T=>a(m),onKeypress:[st(ce(T=>a(m),["prevent","stop"]),["enter"]),st(ce(T=>a(m),["prevent","stop"]),["space"])]},Pe(m.label),45,wk))],64))),256)),H(je,{class:"custom-sprite v-w100",icon:"publish",onClick:j[0]||(j[0]=m=>y.value.click())},{default:Q(()=>[j[3]||(j[3]=Y(" Upload new sprite ")),p("input",{type:"file",ref_key:"spriteUpload",ref:y,onChange:w,multiple:""},null,544)]),_:1}),H(je,{icon:"insert_link",onClick:_},{default:Q(()=>j[4]||(j[4]=[Y(" New sprite from URL ")])),_:1}),H(je,{icon:"extension",onClick:j[1]||(j[1]=m=>o("show-dialog","type: Sprites"))},{default:Q(()=>j[5]||(j[5]=[Y(" Search in content packs ")])),_:1}),i.value?($(),de(je,{key:0,icon:"folder",onClick:u},{default:Q(()=>j[6]||(j[6]=[Y(" Open sprites folder ")])),_:1})):fe("",!0),p("input",{type:"file",ref_key:"missingSpriteUpload",ref:c,onChange:d},null,544)],64))}}),Ck=Be(kk,[["__scopeId","data-v-bc0f5f70"]]),xk=Se({__name:"ui-tab",setup(t){const e=Ne();async function n(){return await l("createTextBox")}async function o(){return await l("createChoice")}async function s(){return await l("createNotification")}async function r(){return await l("createPoem")}async function i(){return await l("createConsole")}async function l(a){await te(async()=>{await e.dispatch(`panels/${a}`,{panelId:e.state.panels.currentPanel})})}return(a,u)=>($(),F(ae,null,[p("button",{class:"v-w100",onClick:n},"Textbox"),p("button",{class:"v-w100 v-bt0",onClick:r},"Poem"),p("button",{class:"v-w100 v-bt0",onClick:s},"Notification"),p("button",{class:"v-w100 v-bt0",onClick:o},"Choice"),p("button",{class:"v-w100 v-bt0",onClick:i},"Console")],64))}}),Sk=["innerHTML"],_k=["disabled"],Pk=Se({__name:"add-tool",setup(t){const e=Ne(),n={characters:{icon:"emoji_people",text:"Char&shy;acters",shortcut:"1"},sprites:{icon:"change_history",text:"Sprites",shortcut:"2"},ui:{icon:"view_quilt",text:"UI",shortcut:"3"}},o=W(null),s=W("characters"),r=W(null),{vertical:i}=$t(o),l=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),a=M(()=>e.state.ui.clipboard!=null);function u(){te(async()=>{await e.dispatch("panels/pasteObjectFromClipboard",{panelId:l.value.id})})}return(c,d)=>($(),F("div",{class:"panel",ref_key:"root",ref:o,onDragenter:d[2]||(d[2]=(...g)=>{var b,y;return((b=r.value)==null?void 0:b.showDropTarget)&&((y=r.value)==null?void 0:y.showDropTarget(...g))}),onMouseleave:d[3]||(d[3]=(...g)=>{var b,y;return((b=r.value)==null?void 0:b.hideDropTarget)&&((y=r.value)==null?void 0:y.hideDropTarget(...g))})},[d[4]||(d[4]=p("h1",null,"Add",-1)),p("div",{class:Le({"group-selector":!0,vertical:ie(i)})},[($(),F(ae,null,qe(n,(g,b)=>H(je,{key:b,class:Le({active:s.value===b,"v-bl0":b!=="characters","h-bt0":b!=="characters"}),"icon-pos":"top",icon:g.icon,shortcut:g.shortcut,onClick:y=>s.value=b},{default:Q(()=>[p("span",{innerHTML:g.text},null,8,Sk)]),_:2},1032,["class","icon","shortcut","onClick"])),64))],2),p("div",{class:Le({"item-grid":!0,vertical:ie(i)})},[s.value==="characters"?($(),de(mk,{key:0,onShowDialog:d[0]||(d[0]=g=>c.$emit("show-dialog",g))})):s.value==="sprites"?($(),de(Ck,{key:1,ref_key:"sprites",ref:r,onShowDialog:d[1]||(d[1]=g=>c.$emit("show-dialog",g))},null,512)):s.value==="ui"?($(),de(xk,{key:2})):fe("",!0),p("button",{class:"v-w100",onClick:u,disabled:!a.value}," Paste ",8,_k)],2)],544))}}),Ok=Be(Pk,[["__scopeId","data-v-7f7bf21b"]]),Tk=["href"],Je=Se({__name:"external-link",props:{to:{}},setup(t){const e=t,n=W(null),o=M(()=>{let s=e.to;return s=s.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),s=s.replace(/^wiki:\/\/(.*)/,(r,i)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+i.replaceAll(" ","-")),s});return(s,r)=>($(),F("a",{target:"_blank",rel:"noopener noreferrer",ref_key:"root",ref:n,href:o.value},[qt(s.$slots,"default")],8,Tk))}}),Ik=Se({__name:"app-credits",setup(t){const e=W(null);return $t(e),(n,o)=>($(),F("div",{class:"panel",ref_key:"root",ref:e},[o[35]||(o[35]=p("h1",null,"Help and Credits",-1)),H(Je,{class:"btn",to:"wiki://Dokumentation"},{default:Q(()=>o[0]||(o[0]=[Y("Help")])),_:1}),H(Je,{class:"btn",to:"github://"},{default:Q(()=>o[1]||(o[1]=[Y("Fork me on GitHub")])),_:1}),H(Je,{class:"btn",to:"wiki://Privacy Statement"},{default:Q(()=>o[2]||(o[2]=[Y("Privacy Statement")])),_:1}),o[36]||(o[36]=p("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),o[37]||(o[37]=p("p",null,[Y(" Doki Doki Dialog Generator developed by EDave64 "),p("br"),Y("Based on gemdude46's DDLC Shitpost generator ")],-1)),p("p",null,[o[4]||(o[4]=Y(" Unused House Background by ")),H(Je,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:Q(()=>o[3]||(o[3]=[Y(" Fatelogic ")])),_:1})]),p("p",null,[o[6]||(o[6]=Y(" Aller Font by ")),H(Je,{to:"https://www.daltonmaag.com/library/aller"},{default:Q(()=>o[5]||(o[5]=[Y("Dalton Maag Ltd")])),_:1})]),p("p",null,[o[8]||(o[8]=Y(" Riffic Bold Font by ")),H(Je,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:Q(()=>o[7]||(o[7]=[Y("InkyType")])),_:1})]),p("p",null,[o[10]||(o[10]=Y(" Verily Serif Mono Font by ")),H(Je,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:Q(()=>o[9]||(o[9]=[Y("Stephen G. Hartke")])),_:1})]),p("p",null,[o[12]||(o[12]=Y(" F25 Bank Printer Font by ")),H(Je,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:Q(()=>o[11]||(o[11]=[Y("F25 Digital Typeface Design")])),_:1})]),p("p",null,[o[14]||(o[14]=Y(" Journal Font by ")),H(Je,{to:"https://www.dafont.com/journal.font"},{default:Q(()=>o[13]||(o[13]=[Y("Fontourist")])),_:1})]),p("p",null,[o[16]||(o[16]=Y(" Hashtag Font by ")),H(Je,{to:"https://www.dafont.com/hashtag.font"},{default:Q(()=>o[15]||(o[15]=[Y(" TitanVex")])),_:1})]),p("p",null,[o[18]||(o[18]=Y(" JP Hand Slanted Font by ")),H(Je,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:Q(()=>o[17]||(o[17]=[Y("Jonathan Paterson")])),_:1})]),p("p",null,[o[20]||(o[20]=Y(" As I Lay Dying Font by ")),H(Je,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:Q(()=>o[19]||(o[19]=[Y("Moises Esqueda")])),_:1})]),p("p",null,[o[22]||(o[22]=Y(" Damagrafik Script Font by ")),H(Je,{to:"https://www.dafont.com/damagrafik-script.font"},{default:Q(()=>o[21]||(o[21]=[Y("Davide Terenzi")])),_:1})]),p("p",null,[o[24]||(o[24]=Y(" Ammy's Handwriting Font by ")),H(Je,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:Q(()=>o[23]||(o[23]=[Y("Ammy K.")])),_:1})]),p("p",null,[o[26]||(o[26]=Y(" Halogen Font by ")),H(Je,{to:"https://www.dafont.com/halogen.font"},{default:Q(()=>o[25]||(o[25]=[Y("JLH Fonts")])),_:1})]),o[38]||(o[38]=p("p",null,[Y(" MC Sprite by Childish-N "),p("br"),Y("MC Casual Sprite by SlightlySimple "),p("br"),Y("MC Chibi by SlightlySimple ")],-1)),p("p",null,[H(Je,{to:"https://www.reddit.com/r/DDLCMods/comments/1hhmu77/"},{default:Q(()=>o[27]||(o[27]=[Y("Concept MC")])),_:1}),o[29]||(o[29]=Y(" by StormBlazed76, ")),H(Je,{to:"https://www.reddit.com/ofof3o"},{default:Q(()=>o[28]||(o[28]=[Y("chibi")])),_:1}),o[30]||(o[30]=Y(" by Hadrosaur838 "))]),o[39]||(o[39]=p("p",null,[Y(" MC Chad Sprite by Cylent-Nite "),p("br"),Y("MC Chad Poses and expressions by SlightlySimple "),p("br"),Y("MC Chad Poses and chibi by Meddy-sin ")],-1)),o[40]||(o[40]=p("p",null,[Y(" FeMC Sprite by Meddy-sin "),p("br"),Y("FeMC Casual Sprite by SlightlySimple ")],-1)),p("p",null,[H(Je,{to:"https://www.reddit.com/oizaow"},{default:Q(()=>o[31]||(o[31]=[Y("Concept FeMC")])),_:1}),o[33]||(o[33]=Y(" by ShidoDraws, ")),H(Je,{to:"https://www.reddit.com/oosuxu"},{default:Q(()=>o[32]||(o[32]=[Y("additional poses, expressions and chibi")])),_:1}),o[34]||(o[34]=Y(" by SlightlySimple "))]),o[41]||(o[41]=p("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),o[42]||(o[42]=p("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),o[43]||(o[43]=p("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1))],512))}}),jk=Be(Ik,[["__scopeId","data-v-deba67a0"]]);let Ul=0;typeof BigInt<"u"&&(Ul=BigInt(0));function Ha(){const t=Ul;return Ul++,t+""}const $k={class:"toggle_box"},Ak=["id"],Rk=["for"],Mk=["for"],Xe=Se({__name:"d-toggle",props:Rn({label:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=cs(t,"modelValue"),n=Ha(),o=W(null);return(s,r)=>($(),F("div",$k,[_e(p("input",{id:ie(n),type:"checkbox",ref_key:"checkbox",ref:o,"onUpdate:modelValue":r[0]||(r[0]=i=>e.value=i)},null,8,Ak),[[Dv,e.value]]),p("label",{for:ie(n),class:"switch"},null,8,Rk),p("label",{for:ie(n),class:"toggle_label"},Pe(s.label),9,Mk)]))}}),Bk={class:"modal-scroll-area"},Ek={class:"modal-scroll-area"},Dk={key:0},Lk={key:1},Nk={key:2},Fk={key:3,disabled:""},Hk={class:"v-w100"},Uk={key:7,class:"downloadTable"},Vk=Se({__name:"app-settings",setup(t){const e=Ne(),n=W(null),o=he.updateProgress;$t(n);function s(){he.saveSettings({lq:e.state.ui.lqRendering,nsfw:e.state.ui.nsfw,darkMode:e.state.ui.useDarkTheme??void 0,looseTextParsing:he.state.looseTextParsing,defaultCharacterTalkingZoom:e.state.ui.defaultCharacterTalkingZoom})}const r=M(()=>he.supports.optionalSaving),i=W(!1),l=W(!1),a=W(!1),u=M({get(){return he.savingEnabled},set(D){a.value=!0,he.savingEnabled=D,s()}});function c(D){i.value=!1,D==="Allow"&&(u.value=!0)}function d(D){l.value=!1,D==="Deny"&&(u.value=!1)}ze(()=>u.value,()=>a.value=!1);const g=W(!1),b=M(()=>he.gameMode==="ddlc_plus");function y(D){mo("changing modes",async()=>{D==="Enter Classic Mode"?await he.setGameMode("ddlc"):D==="Enter Plus mode"?await he.setGameMode("ddlc_plus"):g.value=!1})}const w=M(()=>he.supports.lq),_=M({get(){return e.state.ui.lqRendering},set(D){te(()=>{e.commit("ui/setLqRendering",D)}),s()}}),k=M({get(){return!!e.state.ui.nsfw},set(D){te(()=>{e.commit("ui/setNsfw",D),s()})}}),h=M({get(){return!!e.state.ui.defaultCharacterTalkingZoom},set(D){te(()=>{e.commit("ui/setDefaultCharacterTalkingZoom",D),s()})}}),v=M({get(){return he.state.looseTextParsing},set(D){he.state.looseTextParsing=D,s()}}),f=M({get(){return e.state.ui.useDarkTheme},set(D){te(()=>{e.commit("ui/setDarkTheme",D),s()})}}),x=M(()=>he.supports.setDownloadFolder),P=M(()=>he.state.downloadLocation);function j(){he.updateDownloadFolder()}function m(){he.openFolder("downloads")}const T=M(()=>he.state.hasTemplate);function R(){he.saveDefaultTemplate()}function B(){he.clearDefaultTemplate()}return(D,N)=>($(),F("div",{class:"panel",ref_key:"root",ref:n},[N[26]||(N[26]=p("h1",null,"Settings",-1)),($(),de(rf,{to:"#modal-messages"},[i.value?($(),de(oo,{key:0,options:["Allow","Deny"],onLeave:N[0]||(N[0]=ee=>c("Deny")),onOption:c,"no-base-size":""},{default:Q(()=>[p("div",Bk,[N[14]||(N[14]=p("p",null," Do you want to allow DDDG to save settings on your device? ",-1)),N[15]||(N[15]=p("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),N[16]||(N[16]=p("p",null,"You can revoke this permission at any time.",-1)),p("p",null,[N[12]||(N[12]=Y(" Our usual ")),H(Je,{to:"wiki://Privacy Statement"},{default:Q(()=>N[11]||(N[11]=[Y("privacy policy")])),_:1}),N[13]||(N[13]=Y(" still applies. "))])])]),_:1})):fe("",!0),l.value?($(),de(oo,{key:1,options:["Deny","Cancle"],onLeave:N[1]||(N[1]=ee=>d("Cancel")),onOption:d,"no-base-size":""},{default:Q(()=>[p("div",Ek,[N[20]||(N[20]=p("p",null," Do you want to deny DDDG from saving settings on your device? ",-1)),N[21]||(N[21]=p("p",null," This will cause all your settings to reset when leaving the page. ",-1)),p("p",null,[N[18]||(N[18]=Y(" Our usual ")),H(Je,{to:"wiki://Privacy Statement"},{default:Q(()=>N[17]||(N[17]=[Y("privacy policy")])),_:1}),N[19]||(N[19]=Y(" still applies. "))])])]),_:1})):fe("",!0),g.value?($(),de(oo,{key:2,options:[b.value?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:N[2]||(N[2]=ee=>g.value=!1),onOption:y,"no-base-size":""},{default:Q(()=>N[22]||(N[22]=[p("div",{class:"modal-scroll-area"},[p("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)])),_:1},8,["options"])):fe("",!0)])),ie(o)==="done"?($(),F("p",Dk," Update is successfully downloaded. It will be installed once the application is closed. ")):fe("",!0),ie(o)==="wait"?($(),F("p",Lk,"Checking for updates...")):fe("",!0),typeof ie(o)=="number"?($(),F("p",Nk," Downloading update ("+Pe(ie(o))+"%) ",1)):fe("",!0),a.value?($(),F("button",Fk,"Applying...")):!u.value&&r.value?($(),F("button",{key:4,onClick:N[3]||(N[3]=ee=>i.value=!0)}," Allow saving options ")):u.value&&r.value?($(),F("button",{key:5,onClick:N[4]||(N[4]=ee=>l.value=!0)}," Deny saving options ")):fe("",!0),p("button",{onClick:N[5]||(N[5]=ee=>g.value=!0),class:Le(r.value?"bt0":"")},[b.value?($(),F(ae,{key:0},[Y(" Enter Classic Mode ")],64)):($(),F(ae,{key:1},[Y(" Enter DDLC Plus Mode ")],64))],2),w.value?($(),de(Xe,{key:6,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:_.value,"onUpdate:modelValue":N[6]||(N[6]=ee=>_.value=ee)},null,8,["modelValue"])):fe("",!0),H(Xe,{label:"NSFW Mode?",modelValue:k.value,"onUpdate:modelValue":N[7]||(N[7]=ee=>k.value=ee)},null,8,["modelValue"]),H(Xe,{label:"Enlarge talking objects? (Default value)",modelValue:h.value,"onUpdate:modelValue":N[8]||(N[8]=ee=>h.value=ee)},null,8,["modelValue"]),H(Xe,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:v.value,"onUpdate:modelValue":N[9]||(N[9]=ee=>v.value=ee)},null,8,["modelValue"]),p("table",Hk,[p("tbody",null,[p("tr",null,[N[24]||(N[24]=p("td",null,[p("label",null,"Theme:")],-1)),p("td",null,[_e(p("select",{"onUpdate:modelValue":N[10]||(N[10]=ee=>f.value=ee),class:"v-w100"},N[23]||(N[23]=[p("option",{value:null},"System",-1),p("option",{value:!1},"Light",-1),p("option",{value:!0},"Dark",-1)]),512),[[xt,f.value]])])])])]),x.value?($(),F("table",Uk,[p("tbody",null,[p("tr",null,[N[25]||(N[25]=p("td",null,[p("label",null,"Download folder:")],-1)),p("td",null,Pe(P.value),1),p("td",null,[p("button",{onClick:j},"Set"),p("button",{onClick:m},"Open")])])])])):fe("",!0),u.value?($(),F(ae,{key:8},[p("button",{onClick:R},"Save as template"),T.value?($(),F("button",{key:0,onClick:B}," Clear template ")):fe("",!0)],64)):fe("",!0)],512))}}),Wk=Be(Vk,[["__scopeId","data-v-ee9b1e93"]]),qk=Se({mixins:[pk],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const t=this.noWraping?"no-wraping":"wraping",e=fu("div",{class:["d-flow",this.finalDirection,t],style:{gap:this.gap}},this.$slots.default());if(this.maxSize!==void 0){const n=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return fu("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:n}},[e])}return e},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}}),Tt=Be(qk,[["__scopeId","data-v-be2935f2"]]),zk=["for"],Gk=["id","x1","x2"],Xk=["offset"],Yk=["fill"],Kk=["d"],Jk=["id","max","value"],_s=255,cl=8,Zk=Se({__name:"color-slider",props:Rn({label:{},gradientStops:{},maxValue:{},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=cs(t,"modelValue"),o=Ne(),s=Ha(),r=M(()=>o.state.ui.vertical),i=W(null),l=M(()=>{const y=n.value/e.maxValue*_s;return`M${y} 0L${y+14} 0L${y+7} 12Z`}),a=M(()=>!e.shiftGradient||n.value===0?0:n.value/e.maxValue);function u(y){n.value=parseFloat(y.target.value)}const c=W(!1);function d(y){c.value=!0,g(y),y instanceof MouseEvent&&(window.addEventListener("mousemove",g),window.addEventListener("mouseup",b)),y.preventDefault()}function g(y){if(!c.value)return;const w=i.value;if(y instanceof MouseEvent&&y.buttons===0){b();return}y.preventDefault();const _=w.getBoundingClientRect(),k=_.width/(cl+_s+cl),v=((y instanceof MouseEvent?y.clientX:y.touches[0].clientX)-_.x)/k,f=Math.max(Math.min(v-cl,_s),0)/_s*e.maxValue;n.value=f,y.preventDefault()}function b(){c.value=!1,window.removeEventListener("mousemove",g),window.removeEventListener("mouseup",b)}return(y,w)=>($(),F("div",{class:Le({slider:!0,vertical:r.value}),onKeydown:w[1]||(w[1]=ce(()=>{},["stop"]))},[y.noInput?fe("",!0):($(),F("label",{key:0,for:ie(s)},Pe(y.label),9,zk)),p("div",null,[($(),F("svg",{ref_key:"svg",ref:i,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:d,onTouchstart:d,onTouchmove:g,onTouchend:b},[p("defs",null,[p("linearGradient",{id:`gradient${ie(s)}`,x1:a.value*100+"%",y1:"0%",x2:(a.value+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[($(!0),F(ae,null,qe(y.gradientStops,(_,k)=>($(),F("stop",{key:k,offset:k/(y.gradientStops.length-1)*100+"%",style:Qe("stop-color:"+_)},null,12,Xk))),128))],8,Gk)]),p("g",null,[p("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${ie(s)})`},null,8,Yk),p("path",{d:l.value,"stroke-width":"2",class:"slider-pointer"},null,8,Kk)])],544))]),y.noInput?fe("",!0):($(),F("input",{key:1,id:ie(s),class:"sliderInput",min:"0",max:y.maxValue,value:n.value,type:"number",onInput:u,onKeydown:w[0]||(w[0]=ce(()=>{},["stop"]))},null,40,Jk))],34))}}),In=Be(Zk,[["__scopeId","data-v-a8742e18"]]),Qk=Se({__name:"slider-group",props:Rn({mode:{default:"hsla"},relative:{type:Boolean,default:!1}},{modelValue:{required:!0,validator:t=>!!t.match(/^#[0-9a-f]{6,8}$/i)},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=cs(t,"modelValue"),o=W(null),s=W(0),r=W(0),i=W(0),l=W(0),a=_({rgba:{label:"Red",stops(){const k=e.relative?r.value:0,h=e.relative?i.value:0;return[new De(0,k,h,1),new De(255,k,h,1)]}},hsla:{label:"Hue",max:360,stops(){const k=e.relative?r.value/100:1,h=e.relative?i.value/100:.5;return w(v=>new He(v,k,h,1))}}}),u=_({rgba:{label:"Green",stops(){const k=e.relative?s.value:0,h=e.relative?i.value:0;return[new De(k,0,h,1),new De(k,255,h,1)]}},hsla:{label:"Saturation",stops(){const k=e.relative?s.value/360:0,h=e.relative?i.value/100:.5;return w(v=>new He(k,v,h,1))}}}),c=_({rgba:{label:"Blue",stops(){const k=e.relative?s.value:0,h=e.relative?r.value:0;return[new De(k,h,0,1),new De(k,h,255,1)]}},hsla:{label:"Luminosity",stops(){const k=e.relative?s.value/360:0,h=e.relative?r.value/100:.5;return w(v=>new He(k,h,v,1))}}}),d=M(()=>{const k=De.fromHex(n.value);return[new De(k.r,k.g,k.b,0).toCss(),new De(k.r,k.g,k.b,1).toCss()]});function g(){n.value!==o.value&&y()}function b(){let k;e.mode==="rgba"?k=new De(s.value,r.value,i.value,l.value/255):k=new He(s.value/360,r.value/100,i.value/100,l.value/255);const h=k.toRgb().toHex();if(o.value!==h){if(h.length!==9)throw new Error(`Invalid color code: ${h}`);o.value=h,n.value=h}}function y(){const k=De.fromHex(n.value);if(o.value=k.toHex(),l.value=k.a*255,e.mode==="hsla"){const h=k.toHSL();s.value=h.h*360,r.value=h.s*100,i.value=h.l*100}else s.value=k.r,r.value=k.g,i.value=k.b}function w(k){const h=[];for(let v=0;v<=8;++v)h.push(k(v/8));return h}ze(()=>n.value,g),ze(()=>e.mode,y,{immediate:!0}),ze(()=>[s.value,r.value,i.value,l.value],b);function _({rgba:k,hsla:h}){const v=M(()=>e.mode==="rgba"?255:h.max??100),f=M(()=>e.mode==="rgba"?k.label:h.label),x=M(()=>(e.mode==="rgba"?k.stops():h.stops()).map(j=>j.toRgb().toCss()));return{maxValue:v,label:f,stops:x}}return(k,h)=>($(),F("div",null,[H(In,{label:ie(a).label.value,modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=v=>s.value=v),"max-value":ie(a).maxValue.value,"gradient-stops":ie(a).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),H(In,{label:ie(u).label.value,modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=v=>r.value=v),"max-value":ie(u).maxValue.value,"gradient-stops":ie(u).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),H(In,{label:ie(c).label.value,modelValue:i.value,"onUpdate:modelValue":h[2]||(h[2]=v=>i.value=v),"max-value":ie(c).maxValue.value,"gradient-stops":ie(c).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),H(In,{label:"Alpha",modelValue:l.value,"onUpdate:modelValue":h[3]||(h[3]=v=>l.value=v),"max-value":255,"gradient-stops":d.value},null,8,["modelValue","gradient-stops"])]))}}),eC=Be(Qk,[["__scopeId","data-v-0d496402"]]),tC={class:"v-w100 h-h100"},nC={class:"hex-selector"},oC=["for"],sC=["id","value"],rC=["title","onClick"],kd="dddg.generated.colors",iC=Se({inheritAttrs:!1,__name:"color-picker",props:Rn({title:{default:""},format:{default:"hex"}},{modelValue:{required:!0},modelModifiers:{}}),emits:Rn(["leave"],["update:modelValue"]),setup(t,{emit:e}){const n=t,o=cs(t,"modelValue"),s=e,r=Ne(),i=Ha(),l=W("hsla"),a=M(()=>r.state.ui.vertical),u=M({get(){return n.format==="rgb"?De.fromCss(o.value).toHex():o.value},set(w){if(n.format==="rgb"){const _=De.fromCss(w);o.value=_.toCss()}else o.value=w}});function c(w){const _=w.target.value;De.validHex(_)&&(_.length===7||_.length===9)&&(u.value=_)}const d=M(()=>r.state.content.current.colors);function g(){if(d.value.find(k=>k.color===u.value))return;const w=r.state.content.contentPacks.find(k=>k.packId===kd)||{packId:kd,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},_={...w,colors:[...w.colors,{label:u.value,color:u.value}]};te(async()=>{await r.dispatch("content/replaceContentPack",{contentPack:_,processed:!0})})}function b(){te(()=>{r.commit("ui/setColorPicker",!0)})}function y(w){u.value=De.fromCss(w.color).toHex()}return ht(()=>{$e.subscribe(zs,y)}),Rt(()=>{$e.unsubscribe(zs,y)}),(w,_)=>($(),F("div",{class:Le([{color:!0,vertical:a.value},"v-w100 h-h100"])},[p("h2",null,Pe(w.title),1),p("button",{onClick:_[0]||(_[0]=k=>s("leave"))},"OK"),p("table",null,[p("tbody",null,[p("tr",null,[p("td",null,[p("button",{onClick:_[1]||(_[1]=k=>l.value="hsla")},"HSLA")]),p("td",null,[p("button",{onClick:_[2]||(_[2]=k=>l.value="rgba")},"RGBA")])])])]),p("div",tC,[H(eC,{mode:l.value,modelValue:u.value,"onUpdate:modelValue":_[3]||(_[3]=k=>u.value=k),relative:!0},null,8,["mode","modelValue"]),p("div",nC,[p("label",{class:"hex-label",for:`hex_${ie(i)}`},"Hex",8,oC),p("input",{id:`hex_${ie(i)}`,value:u.value,onInput:c,onKeydown:_[4]||(_[4]=ce(()=>{},["stop"]))},null,40,sC)]),H(Tt,{direction:"global",class:"color-tools"},{default:Q(()=>[p("button",{onClick:g},"Add as swatch"),H(je,{class:"h-bl0 v-bt0",icon:"colorize",onClick:b},{default:Q(()=>_[5]||(_[5]=[Y("Pick color")])),_:1})]),_:1})]),p("div",{id:"color-swatches",class:Le({vertical:a.value})},[($(!0),F(ae,null,qe(d.value,k=>($(),F("button",{class:"swatch",key:k.color,style:Qe({backgroundColor:k.color}),title:k.label,onClick:h=>{u.value=k.color,s("leave")}},null,12,rC))),128))],2)],2))}}),jr=Be(iC,[["__scopeId","data-v-ef1b962c"]]),lC={class:"fieldset_wrapper"},aC={key:0},uC={class:"fieldset_contents"},cC=Se({__name:"d-fieldset",props:{title:{}},setup(t){const e=t;return(n,o)=>($(),F("div",lC,[p("fieldset",null,[n.title>""?($(),F("legend",aC,Pe(e.title),1)):fe("",!0),p("div",uC,[qt(n.$slots,"default",{},void 0,!0)])])]))}}),St=Be(cC,[["__scopeId","data-v-bca80d0b"]]),dC={class:"column ok-col"},fC={key:0,class:"column"},pC=["value"],hC=["disabled"],gC=["disabled"],vC=["disabled"],mC=["disabled"],bC=["onClick","onKeydown"],yC={key:0,class:"value-input-table"},wC=["value","max","min"],kC={key:0},CC={colspan:"2"},xC=["value","max","min"],SC={key:0},_C={colspan:"2"},PC=Se({__name:"image-options",props:{type:{},id:{},panelId:{},noComposition:{type:Boolean}},emits:["leave"],setup(t,{emit:e}){const n=t,o=e,s=Ne(),r=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),i=(()=>{try{const I=Dn();I.width=0,I.height=0;const A="filter"in I.getContext("2d");if(po(I),A)return Array.from(r.keys()).sort()}catch{}return["opacity"]})(),l=W(""),a=W(0),u=M(()=>{switch(n.type){case"object":return s.state.panels.panels[n.panelId].objects[n.id];case"background":return s.state.panels.panels[n.panelId].background;case"panel":return s.state.panels.panels[n.panelId];default:throw new Bt.UnreachableCaseError(n.type)}}),c=M({get(){return u.value.composite},set(I){te(()=>{switch(n.type){case"object":s.commit("panels/setComposition",{id:n.id,panelId:n.panelId,composite:I});break;case"background":break;case"panel":break;default:throw new Bt.UnreachableCaseError(n.type)}})}}),d=M(()=>u.value.filters),g=M(()=>d.value[a.value]??null),b=M(()=>{const I=g.value;return I==null?!1:ud.has(I.type)}),y=M(()=>{const I=g.value;if(I!=null){if(I.type==="hue-rotate")return 360;if(I.type==="grayscale"||I.type==="sepia"||I.type==="opacity"||I.type==="invert")return 100}}),w=M(()=>{const I=g.value;if(I!=null)switch(I.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}});function _(I){return r.get(I)}function k(I){return ud.has(I.type)?`${r.get(I.type)} ${(I.value*100).toFixed()}%`:I.type==="hue-rotate"?`${r.get(I.type)} ${I.value.toFixed()}`:I.type==="blur"?`${r.get(I.type)} ${I.value.toFixed()}px`:r.get(I.type)}function h(I){switch(n.type){case"object":return"panels/object_"+I;case"background":return"panels/background"+I[0].toUpperCase()+I.slice(1);case"panel":return"panels/"+I}}function v(){te(async()=>{await s.dispatch(h("addFilter"),{id:n.id,panelId:n.panelId,type:l.value,idx:a.value+1})})}function f(I){a.value=I}function x(){te(async()=>{await s.dispatch(h("removeFilter"),{id:n.id,panelId:n.panelId,idx:a.value}),a.value>=u.value.filters.length&&(a.value=u.value.filters.length-1)})}function P(I){te(async()=>{await s.dispatch(h("moveFilter"),{id:n.id,panelId:n.panelId,idx:a.value,moveBy:I}),a.value+=I})}function j(I){let C=Number(I.target.value);b.value&&(C=C/100),m({value:C})}function m(I){te(async()=>{await s.dispatch(h("setFilter"),{id:n.id,panelId:n.panelId,idx:a.value,...I})})}const T=M(()=>R(C=>new He(C,1,.5,1)).map(C=>C.toRgb().toCss()));function R(I){const C=[];for(let A=0;A<=8;++A)C.push(I(A/8));return C}const B=W(!1),D=z("color"),N=z("offsetX"),ee=z("offsetY"),xe=z("blurRadius");function z(I){return M({get(){const C=g.value;if(C==null||!(I in C))throw new Error("Tried reading shadow prop on a non shadow object");return C[I]},set(C){m({[I]:C})}})}return(I,C)=>B.value?($(),de(jr,{key:0,modelValue:ie(D),"onUpdate:modelValue":C[0]||(C[0]=A=>ye(D)?D.value=A:null),format:"rgb",onLeave:C[1]||(C[1]=A=>B.value=!1)},null,8,["modelValue"])):($(),de(Tt,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:Q(()=>[C[35]||(C[35]=p("h2",null,"Image options",-1)),p("div",dC,[p("button",{onClick:C[2]||(C[2]=A=>o("leave"))},"Back")]),I.noComposition?fe("",!0):($(),F("div",fC,[C[26]||(C[26]=p("label",{for:"compositionSelect"},"Compositing Mode:",-1)),H(Je,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:Q(()=>C[24]||(C[24]=[Y("[?] ")])),_:1}),_e(p("select",{id:"compositionSelect","onUpdate:modelValue":C[3]||(C[3]=A=>c.value=A),onKeydown:C[4]||(C[4]=ce(()=>{},["stop"]))},C[25]||(C[25]=[p("option",{value:"source-over"},"Normal",-1),p("option",{value:"source-atop"},"source-atop",-1),p("option",{value:"destination-over"},"destination-over",-1),p("option",{value:"destination-in"},"destination-in",-1),p("option",{value:"destination-in"},"destination-out",-1),p("option",{value:"destination-in"},"destination-atop",-1),p("option",{value:"lighter"},"lighter",-1),p("option",{value:"xor"},"xor",-1),p("option",{value:"multiply"},"multiply",-1),p("option",{value:"screen"},"screen",-1),p("option",{value:"overlay"},"overlay",-1),p("option",{value:"darken"},"darken",-1),p("option",{value:"lighten"},"lighten",-1),p("option",{value:"color-dodge"},"color-dodge",-1),p("option",{value:"color-burn"},"color-burn",-1),p("option",{value:"hard-light"},"hard-light",-1),p("option",{value:"soft-light"},"soft-light",-1),p("option",{value:"difference"},"difference",-1),p("option",{value:"exclusion"},"exclusion",-1),p("option",{value:"hue"},"hue",-1),p("option",{value:"saturation"},"saturation",-1),p("option",{value:"color"},"color",-1),p("option",{value:"luminosity"},"luminosity",-1)]),544),[[xt,c.value]])])),H(St,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:Q(()=>[H(Tt,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:Q(()=>[H(Tt,{direction:"vertical","no-wraping":""},{default:Q(()=>[C[27]||(C[27]=p("label",{for:"addEffect"},"Add new effect",-1)),_e(p("select",{id:"addEffect","onUpdate:modelValue":C[5]||(C[5]=A=>l.value=A),onKeydown:C[6]||(C[6]=ce(()=>{},["stop"]))},[($(!0),F(ae,null,qe(ie(i),A=>($(),F("option",{key:A,value:A},Pe(_(A)),9,pC))),128))],544),[[xt,l.value]]),p("button",{disabled:l.value==="",onClick:v,onKeydown:C[7]||(C[7]=ce(()=>{},["stop"]))}," Add ",40,hC),p("button",{disabled:!g.value,onClick:x,onKeydown:C[8]||(C[8]=ce(()=>{},["stop"]))}," Remove ",40,gC),p("button",{disabled:a.value===0,onClick:C[9]||(C[9]=A=>P(-1)),onKeydown:C[10]||(C[10]=ce(()=>{},["stop"]))}," Move up ",40,vC),p("button",{disabled:a.value===d.value.length-1||d.value.length===0,onClick:C[11]||(C[11]=A=>P(1)),onKeydown:C[12]||(C[12]=ce(()=>{},["stop"]))}," Move down ",40,mC)]),_:1}),H(Tt,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:Q(()=>[($(!0),F(ae,null,qe(d.value,(A,oe)=>($(),F("div",{key:oe,class:Le({choiceBtn:!0,active:oe===a.value}),tabindex:"0",onClick:pe=>f(oe),onKeydown:[st(pe=>f(oe),["enter"]),st(ce(pe=>f(oe),["prevent"]),["space"])]},Pe(k(A)),43,bC))),128))]),_:1}),g.value?($(),F("table",yC,[p("tbody",null,[g.value.type==="drop-shadow"?($(),F(ae,{key:0},[p("tr",null,[C[28]||(C[28]=p("td",null,[p("label",{for:"shadow_color"},"Color:")],-1)),p("td",null,[p("button",{id:"shadow_color",class:"color-button",style:Qe({background:ie(D)}),onClick:C[13]||(C[13]=A=>B.value=!0)},"  ",4)])]),p("tr",null,[C[29]||(C[29]=p("td",null,[p("label",{for:"filter_x"},"X:")],-1)),p("td",null,[_e(p("input",{id:"filter_x",type:"number","onUpdate:modelValue":C[14]||(C[14]=A=>ye(N)?N.value=A:null),onKeydown:C[15]||(C[15]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(N),void 0,{number:!0}]])])]),p("tr",null,[C[30]||(C[30]=p("td",null,[p("label",{for:"filter_y"},"Y:")],-1)),p("td",null,[_e(p("input",{id:"filter_y",type:"number","onUpdate:modelValue":C[16]||(C[16]=A=>ye(ee)?ee.value=A:null),onKeydown:C[17]||(C[17]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(ee),void 0,{number:!0}]])])]),p("tr",null,[C[31]||(C[31]=p("td",null,[p("label",{for:"filter_blur"},"Blur:")],-1)),p("td",null,[_e(p("input",{id:"filter_blur",type:"number","onUpdate:modelValue":C[18]||(C[18]=A=>ye(xe)?xe.value=A:null),onKeydown:C[19]||(C[19]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(xe),void 0,{number:!0}]])])])],64)):b.value?($(),F(ae,{key:1},[p("tr",null,[C[33]||(C[33]=p("td",null,[p("label",{for:"filter_value"},"Value:")],-1)),p("td",null,[p("input",{id:"filter_value",value:(g.value.value*100).toFixed(),type:"number",max:y.value,min:w.value,onInput:j,onKeydown:C[20]||(C[20]=ce(()=>{},["stop"]))},null,40,wC),C[32]||(C[32]=Y("% "))])]),w.value===0&&y.value!==void 0?($(),F("tr",kC,[p("td",CC,[H(In,{gradientStops:["#000000","#ffffff"],label:"",maxValue:y.value,modelValue:g.value.value*100,"no-input":"","onUpdate:modelValue":C[21]||(C[21]=A=>m({value:Math.round(A)/100}))},null,8,["maxValue","modelValue"])])])):fe("",!0)],64)):($(),F(ae,{key:2},[p("tr",null,[C[34]||(C[34]=p("td",null,[p("label",{for:"filter_value"},"Value:")],-1)),p("td",null,[p("input",{id:"filter_value",value:g.value.value,type:"number",max:y.value,min:w.value,onInput:j,onKeydown:C[22]||(C[22]=ce(()=>{},["stop"]))},null,40,xC)])]),w.value===0&&y.value!==void 0?($(),F("tr",SC,[p("td",_C,[H(In,{gradientStops:T.value,label:"",maxValue:y.value,modelValue:g.value.value,"no-input":"","onUpdate:modelValue":C[23]||(C[23]=A=>m({value:Math.round(A)}))},null,8,["gradientStops","maxValue","modelValue"]),H(In,{gradientStops:T.value,label:"",maxValue:y.value,modelValue:g.value.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):fe("",!0)],64))])])):fe("",!0)]),_:1})]),_:1})]),_:1}))}}),Ua=Be(PC,[["__scopeId","data-v-09730914"]]),OC=["title"],TC=["title"],IC=Se({__name:"bg-button",props:{backgroundId:{}},setup(t){const e=t,n=Ne(),o=M(()=>{const g=n.state.panels.currentPanel;return n.state.panels.panels[g].background}),s=W(null),r=M(()=>{Object.keys(n.state.uploadUrls);const g=i.value;if(!g)return null;for(const b of g.variants)for(const y of b){const w=gn(y,!1);if(w.startsWith("uploads:"))return Object.keys(n.state.uploadUrls),w.substring(8)}return null}),i=M(()=>n.getters["content/getBackgrounds"].get(e.backgroundId)||null),l=M(()=>e.backgroundId===o.value.current),a=M(()=>{switch(e.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return i.value.label??""}),u=M(()=>{var y;switch(e.backgroundId){case"buildin.static-color":return{"background-color":o.value.color};case"buildin.transparent":return{}}let g=!1;const b=(y=i.value)==null?void 0:y.variants[0].map(w=>{const _=gn(w,!1);return _.startsWith("uploads:")&&(g=!0),`url('${_}')`}).join(",");return g&&Object.keys(n.state.uploadUrls),{backgroundImage:b??""}});function c(){s.value.click()}async function d(){const g=s.value,b=r.value;if(!g.files)return;if(g.files.length!==1){console.error("More than one file uploaded!");return}const y=g.files[0];await te(async()=>{const w=URL.createObjectURL(y);await n.dispatch("uploadUrls/add",{name:b,url:w})})}return(g,b)=>r.value!==null?($(),F("div",{key:0,class:Le({background:!0,active:l.value}),title:a.value,style:Qe(u.value),tabindex:"0",onClick:b[0]||(b[0]=y=>c()),onKeypress:[b[1]||(b[1]=st(ce(y=>c(),["prevent","stop"]),["enter"])),b[2]||(b[2]=st(ce(y=>c(),["prevent","stop"]),["space"]))]},[Y(Pe(a.value)+" ",1),p("input",{type:"file",style:{display:"none"},ref_key:"missingBackgroundUpload",ref:s,onChange:d},null,544)],46,OC)):($(),F("div",{key:1,class:Le({background:!0,active:l.value}),title:a.value,style:Qe(u.value),tabindex:"0",onClick:b[3]||(b[3]=y=>g.$emit("input",g.backgroundId)),onKeydown:[b[4]||(b[4]=st(y=>g.$emit("input",g.backgroundId),["enter"])),b[5]||(b[5]=st(ce(y=>g.$emit("input",g.backgroundId),["prevent"]),["space"]))]},Pe(a.value),47,TC))}}),jC=Be(IC,[["__scopeId","data-v-8cdf913f"]]),$C={key:1},AC={colspan:"3"},RC={key:0},MC={class:"arrow-col"},BC={class:"arrow-col"},EC={colspan:"3"},DC={colspan:"3"},LC=Se({__name:"bg-settings",emits:["open-image-options","change-color"],setup(t,{emit:e}){const n=e,o=Ne(),s=M(()=>o.state.ui.vertical),r=M(()=>{const w=o.state.panels.currentPanel;return o.state.panels.panels[w].background}),i=M({get(){return r.value.flipped},set(w){te(()=>{o.commit("panels/setBackgroundFlipped",{flipped:w,panelId:o.state.panels.currentPanel})})}}),l=M({get(){return r.value.scaling.toString()},set(w){te(()=>{o.commit("panels/setBackgroundScaling",{scaling:parseInt(w,10),panelId:o.state.panels.currentPanel})})}}),a=M(()=>r.value.current),u=M(()=>o.state.content.current.backgrounds.find(w=>w.id===a.value)||null),c=M(()=>a.value==="buildin.static-color"),d=M({get(){return r.value.color},set(w){te(()=>{o.commit("panels/setBackgroundColor",{color:w,panelId:o.state.panels.currentPanel})})}}),g=M(()=>!!u.value),b=M(()=>u.value?u.value.variants.length>1:!1);function y(w){te(async()=>{await o.dispatch("panels/seekBackgroundVariant",{delta:w,panelId:o.state.panels.currentPanel})})}return(w,_)=>($(),de(St,{class:Le({"bg-settings":!0,vertical:s.value}),title:"Settings:"},{default:Q(()=>[c.value?($(),F(ae,{key:0},[_[7]||(_[7]=p("label",{for:"bg_color"},"Color:",-1)),p("button",{id:"bg_color",class:"color-button",style:Qe({background:d.value}),onClick:_[0]||(_[0]=k=>n("change-color"))},null,4)],64)):fe("",!0),g.value?($(),F("table",$C,[p("tbody",null,[p("tr",null,[p("td",AC,[H(Xe,{modelValue:i.value,"onUpdate:modelValue":_[1]||(_[1]=k=>i.value=k),label:"Flipped?"},null,8,["modelValue"])])]),b.value?($(),F("tr",RC,[p("td",MC,[p("button",{class:"small-button",onClick:_[2]||(_[2]=k=>y(-1))}," < ")]),_[8]||(_[8]=p("td",{style:{"text-align":"center"}},"Variant",-1)),p("td",BC,[p("button",{class:"small-button",onClick:_[3]||(_[3]=k=>y(1))}," > ")])])):fe("",!0),p("tr",null,[p("td",EC,[_e(p("select",{"onUpdate:modelValue":_[4]||(_[4]=k=>l.value=k),onKeydown:_[5]||(_[5]=ce(()=>{},["stop"]))},_[9]||(_[9]=[p("option",{value:"0"},"None",-1),p("option",{value:"1"},"Stretch",-1),p("option",{value:"2"},"Cover",-1)]),544),[[xt,l.value]])])]),p("tr",null,[p("td",DC,[p("button",{id:"image_options_button",class:"v-w100",onClick:_[6]||(_[6]=k=>n("open-image-options"))}," Image options ")])])])])):fe("",!0)]),_:1},8,["class"]))}}),NC=Be(LC,[["__scopeId","data-v-94b94195"]]),FC=Se({__name:"backgrounds-tool",setup(t){const e=Ne(),n={packId:"dddg.uploads.backgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},o=W(null);$t(o);const s=W(!1),r=W(!1),i=M({get(){return e.state.panels.panels[e.state.panels.currentPanel].background.color},set(h){te(()=>{e.commit("panels/setBackgroundColor",{color:h,panelId:e.state.panels.currentPanel})})}}),l=M(()=>[...e.state.content.current.backgrounds.map(h=>h.id),"buildin.static-color","buildin.transparent"]),a=M(()=>he.supports.openableFolders.has("backgrounds"));function u(h){e.commit("panels/setCurrentBackground",{current:h,panelId:e.state.panels.currentPanel})}function c(){he.openFolder("backgrounds")}const d=W(null);function g(){const h=d.value;if(h.files)for(const v of h.files)b(v)}async function b(h){await te(async()=>{const v=URL.createObjectURL(h),f=await e.dispatch("uploadUrls/add",{name:h.name,url:v});await w(h.name,h.name,f)})}function y(){const h=prompt("Enter the URL of the image");if(h==null)return;const v=h.split("/").slice(-1)[0];w(v,v,h)}async function w(h,v,f){const x=e.state.content.contentPacks.find(j=>j.packId===n.packId)||n,P={...x,backgrounds:[...x.backgrounds,{id:h,label:v,variants:[[{hq:f,lq:f,sourcePack:n.packId}]],scaling:"none"}]};await te(async()=>{await e.dispatch("content/replaceContentPack",{contentPack:P,processed:!0}),u(h)})}const _=W(null);function k(h){h.dataTransfer&&(h.dataTransfer.effectAllowed="none",Array.from(h.dataTransfer.items).find(v=>v.type.match(/^image.*$/))&&(h.dataTransfer.effectAllowed="link",_.value.show()))}return(h,v)=>($(),F("div",{class:"panel",ref_key:"root",ref:o,onDragenter:k,onMouseleave:v[7]||(v[7]=f=>_.value.hide())},[H(ih,{ref_key:"dt",ref:_,class:"drop-target",onDrop:b},{default:Q(()=>v[8]||(v[8]=[Y("Drop here to add as a new background ")])),_:1},512),v[13]||(v[13]=p("h1",null,"Background",-1)),s.value?($(),de(jr,{key:0,modelValue:i.value,"onUpdate:modelValue":v[0]||(v[0]=f=>i.value=f),onLeave:v[1]||(v[1]=f=>s.value=!1)},null,8,["modelValue"])):r.value?($(),de(Ua,{key:1,type:"background",title:"","panel-id":ie(e).state.panels.currentPanel,"no-composition":"",onLeave:v[2]||(v[2]=f=>r.value=!1)},null,8,["panel-id"])):($(),F(ae,{key:2},[H(NC,{onChangeColor:v[3]||(v[3]=f=>s.value=!0),onOpenImageOptions:v[4]||(v[4]=f=>r.value=!0)}),H(je,{icon:"upload",class:"upload-background",onClick:v[5]||(v[5]=f=>d.value.click())},{default:Q(()=>[v[9]||(v[9]=Y(" Upload ")),p("input",{type:"file",ref_key:"upload",ref:d,onChange:g,multiple:""},null,544)]),_:1}),H(je,{icon:"link",class:"upload-background",onClick:y},{default:Q(()=>v[10]||(v[10]=[Y(" Add by URL ")])),_:1}),H(je,{icon:"extension",class:"upload-background",onClick:v[6]||(v[6]=f=>h.$emit("show-dialog","type: Backgrounds"))},{default:Q(()=>v[11]||(v[11]=[Y(" Search in content packs ")])),_:1}),a.value?($(),de(je,{key:0,icon:"folder",class:"upload-background",onClick:c},{default:Q(()=>v[12]||(v[12]=[Y(" Open backgrounds folder ")])),_:1})):fe("",!0),($(!0),F(ae,null,qe(l.value,f=>($(),de(jC,{key:f,backgroundId:f,onInput:x=>u(f)},null,8,["backgroundId","onInput"]))),128))],64))],544))}}),HC=Be(FC,[["__scopeId","data-v-ff204dfa"]]);function Va(t,e,n,o,s){return M({get(){return e.value[s]},set(r){te(()=>{t.commit(n,{panelId:e.value.panelId,id:e.value.id,key:s,value:r})})}})}function bo(t,e,n,o,s){return M({get(){return e.value[s]},set(r){te(()=>{t[o?"dispatch":"commit"](n,{panelId:e.value.panelId,id:e.value.id,[s]:r})})}})}const UC=["onKeydown"],Cd=960,VC=Se({__name:"part-button",props:{part:{},size:{default:150}},emits:["click","quick-click"],setup(t,{emit:e}){const n=t,o=e,s=W([]),r=M(()=>n.size/n.part.size[0]),i=M(()=>n.size/n.part.size[1]),l=M(()=>`${Math.floor(Cd*r.value)}px ${Math.floor(Cd*i.value)}px`),a=M(()=>{let g="";const b=l.value,y=n.part.offset??[0,0],w=n.part.images.length-1;for(let _=0;_<=w;++_){const k=n.part.images[w-_],h=s.value[w-_];if(!h)continue;_>0&&(g+=", ");const v=k.offset??[0,0],f=`${Math.floor((y[0]-v[0])*-r.value)}px ${Math.floor((y[1]-v[1])*-i.value)}px`;g+=`url('${h.replace("'","\\'")}') ${f} / ${b}`}return g}),u=M(()=>({height:n.size+"px",width:n.size+"px",background:a.value}));function c(g){g.preventDefault(),o("quick-click")}async function d(){s.value=await Promise.all(n.part.images.map(g=>typeof g.asset=="string"?jm(g.asset,!1):gn(g.asset,!1)))}return mo("Initialization of parts button",d),(g,b)=>{var y;return $(),F("div",{class:Le({part:!0,active:(y=g.part)==null?void 0:y.active}),style:Qe(u.value),tabindex:"0",onClick:b[0]||(b[0]=w=>o("click")),onContextmenu:c,onKeydown:[b[1]||(b[1]=st(ce(w=>o("click"),["prevent"]),["enter"])),st(ce(c,["prevent"]),["space"])]},null,46,UC)}}}),xd=Be(VC,[["__scopeId","data-v-a09133e4"]]),WC=Se({__name:"part-selection",props:{character:{},part:{}},emits:["leave","show-dialog","show-expression-dialog"],setup(t,{emit:e}){const n=t,o=e,s=Ne(),r=W(null),i=W([]),l=M(()=>{switch(n.part){case"head":return"Expressions";case"style":return"Styles";default:return"Poses"}}),a=M(()=>Pr(s,n.character)),u=M(()=>{if(n.part!=="style")return[];const h=a.value.styleGroups[n.character.styleGroupId];return h.styleComponents.map(v=>{const f={};for(const x in v.variants){if(!v.variants.hasOwnProperty(x))continue;const P=v.variants[x];f[x]={size:h.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:P}],active:!1}}return{label:v.label,name:v.id,buttons:f}})}),c=M(()=>{const h={};let v,f,x;const P=a.value,j=go(P,n.character);switch(n.part){case"head":{const T=n.character.posePositions.headType||0,R=n.character.posePositions.head||0;for(let B=0;B<j.compatibleHeads.length;++B){const D=j.compatibleHeads[B],N=P.heads[D];for(let ee=0;ee<N.variants.length;++ee){const xe=N.variants[ee];h[`${B}_${ee}`]={size:N.previewSize,offset:N.previewOffset,images:xe.map(z=>({asset:z,offset:[0,0]})),active:R===ee&&T===B}}}return h}case"pose":const m=P.styleGroups[n.character.styleGroupId].styles[n.character.styleId];for(let T=0;T<m.poses.length;++T){const R=m.poses[T],B=g(R);h[T]=B,B.active=T===n.character.poseId}return h;case"style":for(let T=0;T<P.styleGroups.length;++T){const R=P.styleGroups[T],B=g(R.styles[0].poses[0]);h[R.id]=B,B.active=T===n.character.styleGroupId}return h;default:v=j.positions[n.part],x=j.previewSize,f=j.previewOffset;break}for(let m=0;m<v.length;++m){const T=v[m];h[m]={images:T.map(R=>({offset:[0,0],asset:R})),size:x,offset:f,active:m===(n.character.posePositions[n.part]||0)}}return h});function d(){const h=a.value.styleGroups[n.character.styleGroupId].styles[n.character.styleId];i.value=Object.keys(h.components).map(v=>[v,h.components[v]])}function g(h){const v=a.value;let f=[];for(const x of h.renderCommands)switch(x.type){case"pose-part":const P=h.positions[x.part];if(P==null||P.length===0)break;f=f.concat(P[0].map(j=>({asset:j,offset:x.offset})));break;case"head":{const j=v.heads[h.compatibleHeads[0]];if(h.compatibleHeads.length===0)break;const m=j.variants[0];f=f.concat(m.map(T=>({asset:T,offset:x.offset})));break}case"image":f=f.concat(x.images.map(j=>({asset:j,offset:x.offset})));break}return{images:f,size:h.previewSize,offset:h.previewOffset,active:!1}}function b(h){h==null&&(h=n.character.styleGroupId);const f=a.value.styleGroups[h];let x=f.styles;for(const P of i.value){const j=x.filter(m=>m.components[P[0]]===P[1]);j.length>0&&(x=j)}te(async()=>{await s.dispatch("panels/setCharStyle",{id:n.character.id,panelId:n.character.panelId,styleGroupId:h,styleId:f.styles.indexOf(x[0])})})}function y(h){if(n.part==="style")b(a.value.styleGroups.findIndex(v=>v.id===h));else if(n.part==="head"){const[v,f]=(""+h).split("_",2).map(x=>parseInt(x,10));s.commit("panels/setPosePosition",{id:n.character.id,panelId:n.character.panelId,posePositions:{headType:v,head:f}})}else k(n.part,parseInt(""+h,10))}function w(h,v){const f=i.value.findIndex(x=>x[0]===h);i.value.splice(f,1),i.value.unshift([h,""+v]),b()}function _(h){(h.key==="Backspace"||h.key==="Escape")&&(o("leave"),h.preventDefault(),h.stopPropagation())}function k(h,v){te(async()=>{await s.dispatch("panels/setPart",{id:n.character.id,panelId:n.character.panelId,part:h,val:v})})}return mo("Initializing parts data",async()=>{r.value=await co()}),ze(()=>n.character,d,{immediate:!0}),(h,v)=>($(),de(Tt,{"no-wraping":"",onKeydown:_},{default:Q(()=>[p("button",{onClick:v[0]||(v[0]=f=>o("leave")),class:"h-h100"},"Back"),H(Tt,{direction:"vertical",class:"parts-fnc-btns"},{default:Q(()=>[H(je,{icon:"extension",class:"h-bl0 v-w100 v-bt0",onClick:v[1]||(v[1]=f=>o("show-dialog",`type: ${l.value} character: ${a.value.label}`))},{default:Q(()=>v[3]||(v[3]=[Y(" Search in content packs ")])),_:1}),h.part==="head"?($(),de(je,{key:0,icon:"extension",class:"h-bl0 h-bt0 v-w100 v-bt0",onClick:v[2]||(v[2]=f=>o("show-expression-dialog",{character:h.character.characterType}))},{default:Q(()=>v[4]||(v[4]=[Y(" Create new expressions ")])),_:1})):fe("",!0)]),_:1}),($(!0),F(ae,null,qe(c.value,(f,x)=>($(),de(xd,{key:x,value:x,part:f,onClick:P=>{y(x),o("leave")},onQuickClick:P=>y(x)},null,8,["value","part","onClick","onQuickClick"]))),128)),($(!0),F(ae,null,qe(u.value,f=>($(),de(St,{key:f.name,title:f.label,class:"h-h100"},{default:Q(()=>[H(Tt,{noWraping:""},{default:Q(()=>[($(!0),F(ae,null,qe(f.buttons,(x,P)=>($(),de(xd,{size:130,key:P,value:P,part:x,onClick:j=>w(f.name,P)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}))}}),qC=Be(WC,[["__scopeId","data-v-74360b18"]]),zC=Se({__name:"delete-btn",props:{obj:{}},setup(t){const e=t,n=Ne();function o(){te(async()=>{await n.dispatch("panels/removeObject",{panelId:e.obj.panelId,id:e.obj.id})})}return(s,r)=>($(),F("button",{onClick:o},"Delete"))}}),GC=Se({__name:"layer-btns",props:{object:{}},setup(t){const e=t,n=Ne(),o=bo(n,M(()=>e.object),"panels/setOnTop",!0,"onTop");function s(r){te(async()=>{await n.dispatch("panels/shiftLayer",{id:e.object.id,panelId:e.object.panelId,delta:r})})}return(r,i)=>($(),de(St,{id:"layerfs",title:"Layer:"},{default:Q(()=>[H(Tt,{class:"layer_flow",direction:"horizontal"},{default:Q(()=>[H(je,{icon:"vertical_align_bottom","icon-pos":"top",onClick:i[0]||(i[0]=l=>s(-1/0)),title:"Move to back"}),H(je,{icon:"arrow_downward","icon-pos":"top",onClick:i[1]||(i[1]=l=>s(-1)),title:"Move backwards"}),H(je,{icon:"arrow_upward","icon-pos":"top",onClick:i[2]||(i[2]=l=>s(1)),title:"Move forwards"}),H(je,{icon:"vertical_align_top","icon-pos":"top",onClick:i[3]||(i[3]=l=>s(1/0)),title:"Move to front"})]),_:1}),H(Xe,{modelValue:ie(o),"onUpdate:modelValue":i[4]||(i[4]=l=>ye(o)?o.value=l:null),label:"In front?"},null,8,["modelValue"])]),_:1}))}}),XC=Be(GC,[["__scopeId","data-v-3566ce89"]]),YC={class:"v-w100"},KC={colspan:"2"},JC={key:0},ZC={colspan:"2"},QC={class:"v-w100 button-tbl"},ex={class:"arrow-col"},tx=["disabled"],nx=["value"],ox={class:"arrow-col"},sx=["disabled"],rx={class:"v-w50"},ix={class:"v-w50"},lx={class:"v-w50"},ax={class:"v-w50"},ux=Se({__name:"position-and-size",props:{obj:{}},setup(t){const e=t,n=Ne(),o=M({get(){const w=ue().TextBox;return e.obj.height-(i.value?w.NameboxHeight:0)},set(w){const _=ue().TextBox;te(()=>{n.commit("panels/setSize",{id:e.obj.id,panelId:e.obj.panelId,height:w+(i.value?_.NameboxHeight:0),width:e.obj.width})})}}),s=M({get(){return e.obj.width},set(w){te(()=>{n.commit("panels/setSize",{id:e.obj.id,panelId:e.obj.panelId,height:e.obj.height,width:w})})}}),r=M(()=>{const w=e.obj;if(w.type==="textBox")return Zo[w.style].resizable;const _=ue().Poem;return w.type==="poem"?_.poemBackgrounds[w.background].file.startsWith("internal:"):!1}),i=M(()=>e.obj.type==="textBox"&&location.search.includes("alex")),l=M(()=>"freeMove"in e.obj),a=M(()=>ue().Base.positions),u=M(()=>d.value===0),c=M(()=>d.value===ue().Base.positions.length-1),d=M({get(){return nr(e.obj.x)},set(w){te(async()=>{await n.dispatch("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:ue().Base.characterPositions[w],y:e.obj.y})})}}),g=M({get(){return!!e.obj.freeMove},set(w){te(()=>{n.commit("panels/setFreeMove",{id:e.obj.id,panelId:e.obj.panelId,freeMove:w})})}}),b=M({get(){return e.obj.x},set(w){te(()=>{n.commit("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:w,y:y.value})})}}),y=M({get(){return e.obj.y},set(w){te(()=>{n.commit("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:b.value,y:w})})}});return(w,_)=>($(),de(St,{title:"Position"+(r.value?"/Size":"")},{default:Q(()=>[p("table",YC,[p("tbody",null,[p("tr",null,[p("td",KC,[l.value?($(),de(Xe,{key:0,modelValue:g.value,"onUpdate:modelValue":_[0]||(_[0]=k=>g.value=k),label:"Move freely?"},null,8,["modelValue"])):fe("",!0)])]),l.value&&!g.value?($(),F("tr",JC,[p("td",ZC,[p("table",QC,[p("tbody",null,[p("tr",null,[p("td",ex,[p("button",{onClick:_[1]||(_[1]=k=>--d.value),disabled:u.value}," < ",8,tx)]),p("td",null,[_e(p("select",{id:"current_talking",class:"v-w100",style:{"text-align":"center"},"onUpdate:modelValue":_[2]||(_[2]=k=>d.value=k)},[($(!0),F(ae,null,qe(a.value,(k,h)=>($(),F("option",{key:h,value:h},Pe(k),9,nx))),128))],512),[[xt,d.value,void 0,{number:!0}]])]),p("td",ox,[p("button",{onClick:_[3]||(_[3]=k=>++d.value),disabled:c.value}," > ",8,sx)])])])])])])):($(),F(ae,{key:1},[p("tr",null,[_[12]||(_[12]=p("td",{class:"v-w50"},[p("label",{for:"sprite_x"},"X:")],-1)),p("td",rx,[_e(p("input",{id:"sprite_x",class:"w100",type:"number","onUpdate:modelValue":_[4]||(_[4]=k=>b.value=k),onKeydown:_[5]||(_[5]=ce(()=>{},["stop"]))},null,544),[[Ye,b.value,void 0,{number:!0}]])])]),p("tr",null,[_[13]||(_[13]=p("td",{class:"v-w50"},[p("label",{for:"sprite_y"},"Y:")],-1)),p("td",ix,[_e(p("input",{class:"w100",id:"sprite_y",type:"number","onUpdate:modelValue":_[6]||(_[6]=k=>y.value=k),onKeydown:_[7]||(_[7]=ce(()=>{},["stop"]))},null,544),[[Ye,y.value,void 0,{number:!0}]])])])],64)),r.value?($(),F(ae,{key:2},[p("tr",null,[_[14]||(_[14]=p("td",{class:"v-w50"},[p("label",{for:"sprite_w"},"Width:")],-1)),p("td",lx,[_e(p("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":_[8]||(_[8]=k=>s.value=k),onKeydown:_[9]||(_[9]=ce(()=>{},["stop"]))},null,544),[[Ye,s.value,void 0,{number:!0}]])])]),p("tr",null,[_[15]||(_[15]=p("td",{class:"v-w50"},[p("label",{for:"sprite_h"},"Height:")],-1)),p("td",ax,[_e(p("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":_[10]||(_[10]=k=>o.value=k),onKeydown:_[11]||(_[11]=ce(()=>{},["stop"]))},null,544),[[Ye,o.value,void 0,{number:!0}]])])])],64)):fe("",!0)])])]),_:1},8,["title"]))}}),cx=Be(ux,[["__scopeId","data-v-9caf201c"]]),dx={class:"column ok-col"},fx={class:"column"},px=["value"],hx={key:0,class:"column error-col"},gx={class:"column"},vx={class:"column"},mx={class:"column"},bx={class:"column"},yx=Se({inheritAttrs:!1,__name:"text-formatting",props:Rn({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:Rn(["leave"],["update:modelValue"]),setup(t,{emit:e}){const n=cs(t,"modelValue"),o=e,s=Ne(),r=W(null),i=W(""),l=W(""),a=W("#000000"),u=W(""),c=W(0),d=W(0),g=W(""),b=M(()=>s.state.ui.vertical);ze(()=>b.value,()=>{const v=r.value;v!=null&&(v.style.height="",v.style.width="")}),ze(()=>l.value,()=>{l.value!==""&&(h("font",l.value),l.value="")}),ze(()=>u.value,()=>{if(u.value==="")return;const v=r.value,f=v==null?void 0:v.selectionStart,x=v==null?void 0:v.selectionEnd;v&&(v.selectionEnd=v.selectionStart);const P=`{align=${u.value}}`;k(P),v&&(v.selectionStart=f+P.length,v.selectionEnd=x+P.length),u.value=""});function y(){const v=ue(),f=r.value.value;try{new jt(f,v.TextBox.NameboxTextStyle),g.value=""}catch(x){g.value=x.message}n.value=f}function w(v){const f=r.value;i.value=v,c.value=f.selectionStart,d.value=f.selectionEnd}function _(){const v=a.value,f=i.value,x=()=>{const P=r.value;if(P==null){hn(x);return}P.selectionStart=c.value,P.selectionEnd=d.value,h(f==="text"?"color":"outlinecolor",v)};hn(x),a.value="#000000",i.value=""}function k(v){const f=r.value,x=f.value,P=f.selectionStart,j=f.selectionEnd;f.value=x.slice(0,P)+v+x.slice(j),f.selectionStart=f.selectionEnd=P+v.length,f.focus(),y()}function h(v,f){const x=r.value,P=x.value,j=x.selectionStart,m=x.selectionEnd,T=P.slice(j,m),R=P.slice(0,j),B=P.slice(m);let D=v;f!=null&&(D+="="+f),x.value=`${R}{${D}}${T}{/${v}}${B}`,x.selectionStart=j+D.length+2,x.selectionEnd=x.selectionStart+T.length,x.focus(),y()}return(v,f)=>i.value?($(),de(jr,{key:0,modelValue:a.value,"onUpdate:modelValue":f[0]||(f[0]=x=>a.value=x),onLeave:_},null,8,["modelValue"])):($(),F("div",{key:1,class:Le({"text-subpanel":!0,vertical:b.value})},[p("h2",null,Pe(v.title),1),p("div",dx,[p("button",{onClick:f[1]||(f[1]=x=>o("leave"))},"OK")]),p("div",fx,[p("textarea",{class:"v-w100",ref_key:"textArea",ref:r,value:n.value,onInput:y,onKeydown:f[2]||(f[2]=ce(()=>{},["stop"])),onKeypress:f[3]||(f[3]=ce(()=>{},["stop"]))},null,40,px)]),g.value?($(),F("div",hx,Pe(g.value),1)):fe("",!0),p("div",gx,[p("button",{onClick:f[4]||(f[4]=x=>k("\\\\")),class:"style-button"}," Insert \\ "),p("button",{onClick:f[5]||(f[5]=x=>k("\\{")),class:"style-button"}," Insert { "),p("button",{onClick:f[6]||(f[6]=x=>k("\\}")),class:"style-button"}," Insert } ")]),f[20]||(f[20]=p("p",{class:"hint-col"},"Apply style to selected text:",-1)),p("div",vx,[p("button",{onClick:f[7]||(f[7]=x=>h("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),p("button",{onClick:f[8]||(f[8]=x=>h("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),p("button",{onClick:f[9]||(f[9]=x=>h("plain")),class:"style-button"}," Plain "),p("button",{onClick:f[10]||(f[10]=x=>h("edited")),class:"style-button edited-style"}," Edited "),p("button",{onClick:f[11]||(f[11]=x=>h("k",2)),class:"style-button",style:{"letter-spacing":"5px","padding-right":"0"}}," Kerning ")]),p("div",mx,[p("button",{onClick:f[12]||(f[12]=x=>h("alpha",.5)),class:"style-button"}," Alpha ")]),p("div",bx,[p("button",{onClick:f[13]||(f[13]=x=>h("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),_e(p("select",{"onUpdate:modelValue":f[14]||(f[14]=x=>l.value=x),class:"style-button"},f[18]||(f[18]=[Jg('<option value data-v-5fff5afd>Font</option><option value="aller" style="font-family:aller;" data-v-5fff5afd> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-5fff5afd> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-5fff5afd> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-5fff5afd> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-5fff5afd> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-5fff5afd> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-5fff5afd> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-5fff5afd> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-5fff5afd> Halogen (MC) </option>',10)]),512),[[xt,l.value]]),_e(p("select",{"onUpdate:modelValue":f[15]||(f[15]=x=>u.value=x),class:"style-button"},f[19]||(f[19]=[p("option",{value:""},"Alignment",-1),p("option",{value:"left",style:{"text-align":"left"}},"Left",-1),p("option",{value:"right",style:{"text-align":"right"}},"Right",-1),p("option",{value:"center",style:{"text-align":"center"}}," Center ",-1)]),512),[[xt,u.value]]),p("button",{onClick:f[16]||(f[16]=x=>w("text")),class:"style-button"}," Text color "),p("button",{onClick:f[17]||(f[17]=x=>w("outline")),class:"style-button"}," Outline color ")])],2))}}),wx=Be(yx,[["__scopeId","data-v-5fff5afd"]]),kx={class:"modal-text"},Cx=["value"],xx={class:"input-table v-w100"},Sx={for:"zoom",class:"v-w100"},_x={key:0},Px={key:0,colspan:"2"},Ox={key:0},Tx=["placeholder"],Ix=Se({__name:"object-tool",props:{object:{},title:{},textHandler:{},colorHandler:{},showAltPanel:{type:Boolean,default:!1}},setup(t){const e=t,n=Ne(),o=W(null),s=(z,I)=>bo(n,M(()=>e.object),I,!1,z);$t(o);const r=M({get(){return e.object.linkedTo??""},set(z){const I=e.object,C=z===""?null:z,A=vo(n),oe=A==null?void 0:A.getLastRenderObject(I.id),pe=C===null?A==null?void 0:A.getLastRenderObject(I.linkedTo):A==null?void 0:A.getLastRenderObject(C);try{if(!oe||!pe)n.commit("panels/setLink",{panelId:y.value.id,id:I.id,link:C,x:I.x,y:I.y,scaleX:I.scaleX,scaleY:I.scaleY,skewX:I.skewX,skewY:I.skewY,rotation:I.rotation});else if(C==null)n.commit("panels/setLink",{panelId:y.value.id,id:I.id,link:C,...er(oe.preparedTransform)});else{const Ie=pe.preparedTransform.inverse().multiply(oe.preparedTransform);console.log(oe.preparedTransform),console.log(pe.preparedTransform.multiply(Ie)),console.log(Ie),n.commit("panels/setLink",{panelId:y.value.id,id:I.id,link:C,...er(Ie)})}}catch(Oe){Oe instanceof Error?$e.fire(new uo(Oe.message)):$e.fire(new uo(""+Oe))}}}),i=W(!1),l=W(""),a=W(!1),u=W(null),c=s("flip","panels/setFlip"),d=s("rotation","panels/setRotation"),g=s("enlargeWhenTalking","panels/setEnlargeWhenTalking"),b=M(()=>$0(e.object)),y=M(()=>n.state.panels.panels[e.object.panelId]),w=M(()=>{const z=y.value,I=[];for(const C of[...z.order,...z.onTopOrder]){const A=z.objects[C];A.label===null||A===e.object||I.push([C,A.label])}return I}),_=location.search.includes("alex"),k=M({get(){return e.object.preserveRatio},set(z){te(async()=>{await n.dispatch("panels/setPreserveRatio",{id:e.object.id,panelId:e.object.panelId,preserveRatio:z})})}}),h=M({get(){const z=e.object.nameboxWidth;return z===null?"":z},set(z){const I=typeof z=="string"&&z.trim()===""?null:parseInt(z+"");te(()=>{n.commit("panels/setObjectNameboxWidth",{id:e.object.id,panelId:e.object.panelId,nameboxWidth:I})})}}),v=M({get(){return e.object.scaleX*100},set(z){te(()=>{n.commit("panels/setObjectScale",{id:e.object.id,panelId:e.object.panelId,scaleX:z/100,scaleY:e.object.preserveRatio?z/100*e.object.ratio:e.object.scaleY})})}}),f=M({get(){return e.object.scaleY*100},set(z){te(()=>{n.commit("panels/setObjectScale",{id:e.object.id,panelId:e.object.panelId,scaleX:e.object.preserveRatio?z/100/e.object.ratio:e.object.scaleX,scaleY:z/100})})}}),x=M({get(){return e.object.skewX},set(z){te(()=>{n.commit("panels/setObjectSkew",{id:e.object.id,panelId:e.object.panelId,skewX:z,skewY:e.object.skewY})})}}),P=M({get(){return e.object.skewY},set(z){te(()=>{n.commit("panels/setObjectSkew",{id:e.object.id,panelId:e.object.panelId,skewX:e.object.skewX,skewY:z})})}}),j=M(()=>ue().TextBox.NameboxWidth),m=M(()=>u.value||e.colorHandler||null),T=M(()=>e.object.label!==null),R=M(()=>e.object.label??e.title??"Object"),B=M({get(){return e.object.textboxColor!==null},set(z){te(()=>{n.commit("panels/setTextboxColor",{panelId:e.object.panelId,id:e.object.id,textboxColor:z?ue().TextBoxCustom.textboxDefaultColor:null})})}});function D(){te(async()=>{await n.dispatch("panels/copyObjectToClipboard",{panelId:e.object.panelId,id:e.object.id})})}function N(){l.value=e.object.label??"",a.value=!0}function ee(z){a.value=!1,z==="Apply"&&te(()=>{n.commit("panels/setLabel",{panelId:e.object.panelId,id:e.object.id,label:l.value})})}function xe(){u.value={title:"Textbox color",get:()=>e.object.textboxColor,set:z=>{te(()=>{n.commit("panels/setTextboxColor",{panelId:e.object.panelId,id:e.object.id,textboxColor:z})})},leave:()=>{u.value=null}}}return(z,I)=>($(),F("div",{class:"panel",ref_key:"root",ref:o},[p("h1",{style:Qe({fontStyle:T.value?"italic":"normal"}),onClick:N},[Y(Pe(R.value)+" ",1),I[26]||(I[26]=p("span",{class:"icon material-icons"},"edit",-1))],4),($(),de(rf,{to:"#modal-messages"},[a.value?($(),de(oo,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:ee,onLeave:I[2]||(I[2]=C=>ee("Cancel"))},{default:Q(()=>[I[27]||(I[27]=p("p",{class:"modal-text"},"Enter the new name",-1)),p("p",kx,[_e(p("input",{"onUpdate:modelValue":I[0]||(I[0]=C=>l.value=C),style:{width:"100%"},onKeydown:I[1]||(I[1]=st(ce(C=>ee("Apply"),["prevent","stop"]),["enter"]))},null,544),[[Ye,l.value]])])]),_:1})):fe("",!0)])),z.textHandler?($(),de(wx,{key:0,title:z.textHandler.title,modelValue:z.textHandler.get(),"onUpdate:modelValue":I[3]||(I[3]=C=>z.textHandler.set(C)),onLeave:I[4]||(I[4]=C=>z.textHandler.leave())},null,8,["title","modelValue"])):m.value?($(),de(jr,{key:1,title:m.value.title,modelValue:m.value.get(),"onUpdate:modelValue":I[5]||(I[5]=C=>m.value.set(C)),onLeave:I[6]||(I[6]=C=>m.value.leave())},null,8,["title","modelValue"])):i.value?($(),de(Ua,{key:2,type:"object","panel-id":z.object.panelId,id:z.object.id,onLeave:I[7]||(I[7]=C=>i.value=!1)},null,8,["panel-id","id"])):z.showAltPanel?qt(z.$slots,"alt-panel",{key:3},void 0,!0):($(),F(ae,{key:4},[qt(z.$slots,"default",{},void 0,!0),H(cx,{obj:z.object},null,8,["obj"]),H(XC,{object:z.object},null,8,["object"]),H(St,{title:"Transform",class:"transforms"},{default:Q(()=>[H(Xe,{modelValue:ie(c),"onUpdate:modelValue":I[8]||(I[8]=C=>ye(c)?c.value=C:null),label:"Flip?"},null,8,["modelValue"]),I[33]||(I[33]=p("label",{for:"linked_to",class:"v-w100"},"Linked with:",-1)),_e(p("select",{id:"linked_to",class:"v-w100","onUpdate:modelValue":I[9]||(I[9]=C=>r.value=C),onKeydown:I[10]||(I[10]=ce(()=>{},["stop"]))},[I[28]||(I[28]=p("option",{value:""},"None",-1)),($(!0),F(ae,null,qe(w.value,([C,A])=>($(),F("option",{key:C,value:C},Pe(A),9,Cx))),128))],544),[[xt,r.value]]),p("table",xx,[p("tbody",null,[p("tr",null,[I[29]||(I[29]=p("td",null,[p("label",{for:"rotation",class:"v-w100"},"Rotation:")],-1)),p("td",null,[_e(p("input",{id:"rotation",class:"smol v-w100",type:"number","onUpdate:modelValue":I[11]||(I[11]=C=>ye(d)?d.value=C:null),onKeydown:I[12]||(I[12]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(d)]])])]),b.value?($(),F(ae,{key:0},[p("tr",null,[p("td",null,[p("label",Sx,Pe(ie(_)?"Zoom":"Scale X"),1)]),p("td",null,[_e(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1",min:"0","onUpdate:modelValue":I[13]||(I[13]=C=>v.value=C),onKeydown:I[14]||(I[14]=ce(()=>{},["stop"]))},null,544),[[Ye,v.value]])])]),ie(_)?fe("",!0):($(),F("tr",_x,[I[30]||(I[30]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Scale Y: ")],-1)),p("td",null,[_e(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1",min:"0","onUpdate:modelValue":I[15]||(I[15]=C=>f.value=C),onKeydown:I[16]||(I[16]=ce(()=>{},["stop"]))},null,544),[[Ye,f.value]])])]))],64)):fe("",!0),p("tr",null,[I[31]||(I[31]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Skew X: ")],-1)),p("td",null,[_e(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1","onUpdate:modelValue":I[17]||(I[17]=C=>x.value=C),onKeydown:I[18]||(I[18]=ce(()=>{},["stop"]))},null,544),[[Ye,x.value]])])]),p("tr",null,[I[32]||(I[32]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Skew Y: ")],-1)),p("td",null,[_e(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1","onUpdate:modelValue":I[19]||(I[19]=C=>P.value=C),onKeydown:I[20]||(I[20]=ce(()=>{},["stop"]))},null,544),[[Ye,P.value]])])]),p("tr",null,[ie(_)?fe("",!0):($(),F("td",Px,[H(Xe,{modelValue:k.value,"onUpdate:modelValue":I[21]||(I[21]=C=>k.value=C),label:"Lock scale ratio?"},null,8,["modelValue"])]))])])]),qt(z.$slots,"transform",{},void 0,!0)]),_:3}),qt(z.$slots,"options",{},void 0,!0),T.value?($(),de(St,{key:0,title:"Textbox settings"},{default:Q(()=>[z.object.type==="character"||z.object.type==="sprite"?($(),de(Xe,{key:0,label:"Enlarge when talking",modelValue:ie(g),"onUpdate:modelValue":I[22]||(I[22]=C=>ye(g)?g.value=C:null)},null,8,["modelValue"])):fe("",!0),H(Xe,{label:"Own textbox color",modelValue:B.value,"onUpdate:modelValue":I[23]||(I[23]=C=>B.value=C)},null,8,["modelValue"]),p("table",null,[p("tbody",null,[B.value?($(),F("tr",Ox,[I[34]||(I[34]=p("td",null,[p("label",{for:"textbox_color"},"Color:")],-1)),p("td",null,[p("button",{id:"textbox_color",class:"color-button",style:Qe({background:z.object.textboxColor??""}),onClick:xe},null,4)])])):fe("",!0),p("tr",null,[I[35]||(I[35]=p("td",null,[p("label",{for:"namebox_width"},"Namebox width:")],-1)),p("td",null,[_e(p("input",{id:"namebox_width",type:"number",placeholder:j.value+"","onUpdate:modelValue":I[24]||(I[24]=C=>h.value=C)},null,8,Tx),[[Ye,h.value,void 0,{lazy:!0}]])])])])])]),_:1})):fe("",!0),p("button",{onClick:I[25]||(I[25]=C=>i.value=!0)},"Image options"),p("button",{class:"v-bt0",onClick:D},"Copy"),H(zC,{class:"v-bt0",obj:z.object},null,8,["obj"])],64))],512))}}),Po=Be(Ix,[["__scopeId","data-v-671964e8"]]),jx={class:"warning"},$x={style:{"word-wrap":"break-word"}},Ax={class:"button-tbl"},Rx={key:0},Mx={class:"arrow-col"},Bx={class:"arrow-col"},Ex={key:1},Dx={class:"arrow-col"},Lx={class:"arrow-col"},Nx={class:"arrow-col"},Fx=["onClick"],Hx=["onClick"],Ux={class:"arrow-col"},Vx=["onClick"],Wx=Se({__name:"character-tool",emits:["show-dialog","show-expression-dialog"],setup(t,{emit:e}){const n=e,o=Ne(),s=W(null),r=W(null);$t(s);const i=W(null),l=M(()=>o.state.panels.panels[o.state.panels.currentPanel]),a=M(()=>o.state.ui.selection),u=M(()=>{const j=l.value.objects[a.value];if(j.type==="character")return j}),c=bo(o,u,"panels/setClose",!1,"close"),d=M(()=>{const j=u.value,m=tr(g.value,j);if(!m)return null;for(const T of m.variants){const R=gn(T[0],!1);if(R.startsWith("uploads:"))return R.substring(8)}return null}),g=M(()=>Pr(o,u.value)),b=M(()=>g.value.label??""),y=M(()=>E0(g.value,u.value)),w=M(()=>g.value.styleGroups[u.value.styleGroupId].styles.length>1||g.value.styleGroups.length>1),_=M(()=>g.value.styleGroups[u.value.styleGroupId].styles[u.value.styleId].poses.length>1);function k(){r.value.click()}async function h(){const j=r.value;if(!j.files)return;if(j.files.length!==1){console.error("More than one file uploaded!");return}const m=j.files[0];await te(async()=>{const T=URL.createObjectURL(m);await o.dispatch("uploadUrls/add",{name:d.value,url:T})})}function v(j){te(async()=>{await o.dispatch("panels/seekPose",{id:u.value.id,panelId:u.value.panelId,delta:j})})}function f(j){te(async()=>{await o.dispatch("panels/seekStyle",{id:u.value.id,panelId:u.value.panelId,delta:j})})}function x(j,m){te(async()=>{await o.dispatch("panels/seekPart",{id:u.value.id,panelId:u.value.panelId,delta:m,part:j})})}function P(j){return j.charAt(0).toUpperCase()+j.substring(1)}return ze(()=>a.value,()=>{i.value=null}),(j,m)=>($(),de(Po,{ref_key:"root",ref:s,object:u.value,title:b.value,showAltPanel:!!i.value},{"alt-panel":Q(()=>[i.value?($(),de(qC,{key:0,character:u.value,part:i.value,onLeave:m[0]||(m[0]=T=>i.value=null),onShowDialog:m[1]||(m[1]=T=>n("show-dialog",T)),onShowExpressionDialog:m[2]||(m[2]=T=>n("show-expression-dialog",T))},null,8,["character","part"])):fe("",!0)]),default:Q(()=>[d.value?($(),F(ae,{key:0},[p("p",jx,[m[11]||(m[11]=Y(" MISSING Head sprite! Click below to re-upload ")),p("span",$x,'"'+Pe(d.value)+'"',1),m[12]||(m[12]=Y(". "))]),p("button",{onClick:m[3]||(m[3]=T=>k())},"Re-Upload"),p("input",{type:"file",ref_key:"missingHeadUpload",ref:r,onChange:h},null,544)],64)):fe("",!0),_.value||y.value.length>0||w.value?($(),de(St,{key:1,class:"pose-list",title:"Pose:"},{default:Q(()=>[p("table",Ax,[p("tbody",null,[w.value?($(),F("tr",Rx,[p("td",Mx,[p("button",{onClick:m[4]||(m[4]=T=>f(-1))},"<")]),p("td",null,[p("button",{class:"middle-button",onClick:m[5]||(m[5]=T=>i.value="style")}," Style ")]),p("td",Bx,[p("button",{onClick:m[6]||(m[6]=T=>f(1))},">")])])):fe("",!0),_.value?($(),F("tr",Ex,[p("td",Dx,[p("button",{onClick:m[7]||(m[7]=T=>v(-1))},"<")]),p("td",null,[p("button",{class:"middle-button",onClick:m[8]||(m[8]=T=>i.value="pose")}," Pose ")]),p("td",Lx,[p("button",{onClick:m[9]||(m[9]=T=>v(1))},">")])])):fe("",!0),($(!0),F(ae,null,qe(y.value,T=>($(),F("tr",{key:T},[p("td",Nx,[p("button",{onClick:R=>x(T,-1)}," < ",8,Fx)]),p("td",null,[p("button",{class:"middle-button",onClick:R=>i.value=T},Pe(P(T)),9,Hx)]),p("td",Ux,[p("button",{onClick:R=>x(T,1)},">",8,Vx)])]))),128))])])]),_:1})):fe("",!0)]),transform:Q(()=>[H(Xe,{modelValue:ie(c),"onUpdate:modelValue":m[10]||(m[10]=T=>ye(c)?c.value=T:null),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"]))}}),qx=Be(Wx,[["__scopeId","data-v-cdd55094"]]),zx=["onClick"],Gx=Se({__name:"choice-tool",setup(t){const e=Ne(),n=W(null);$t(n);const o=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),s=M(()=>{const _=o.value.objects[e.state.ui.selection];if(_.type==="choice")return _}),r=(_,k)=>bo(e,s,k,!1,_),i=W(0),l=W(!1),a=r("autoWrap","panels/setAutoWrapping"),u=w("text"),c=M(()=>s.value.choices),d=M(()=>{if(l.value)return{title:"Text",get:()=>u.value,set:_=>{u.value=_},leave:()=>{l.value=!1}}});function g(_){i.value=_}function b(){te(async()=>{await e.dispatch("panels/addChoice",{id:s.value.id,panelId:s.value.panelId,text:""})})}function y(){te(async()=>{i.value===s.value.choices.length-1&&i.value>0&&g(i.value-1),await e.dispatch("panels/removeChoice",{id:s.value.id,panelId:s.value.panelId,choiceIdx:i.value})})}function w(_){return M({get(){return s.value.choices[i.value][_]},set(k){te(()=>{e.commit("panels/setChoiceProperty",{id:s.value.id,panelId:s.value.panelId,choiceIdx:i.value,key:_,value:k})})}})}return(_,k)=>($(),de(Po,{ref_key:"root",ref:n,object:s.value,title:"Choice",textHandler:d.value},{default:Q(()=>[H(St,{class:"buttons",title:"Buttons:"},{default:Q(()=>[H(Tt,{maxSize:"100%",direction:"vertical",noWraping:""},{default:Q(()=>[($(!0),F(ae,null,qe(c.value,(h,v)=>($(),F("div",{class:Le({choiceBtn:!0,active:v===i.value}),key:v,onClick:f=>g(v)},Pe(h.text.trim()===""?"[Empty]":h.text),11,zx))),128))]),_:1})]),_:1}),H(St,{class:"current_button",title:"Current button:"},{default:Q(()=>[p("table",null,[p("tbody",null,[k[4]||(k[4]=p("tr",null,[p("td",{colspan:"2"},[p("label",{for:"choice-button-input"},"Text")])],-1)),p("tr",null,[p("td",null,[_e(p("input",{id:"choice-button-input","onUpdate:modelValue":k[0]||(k[0]=h=>ye(u)?u.value=h:null),onKeydown:k[1]||(k[1]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(u)]])]),p("td",null,[p("button",{onClick:k[2]||(k[2]=h=>l.value=!0)},"...")])])])])]),_:1}),p("button",{onClick:b},"Add"),p("button",{onClick:y},"Remove"),H(Xe,{label:"Auto line wrap?",modelValue:ie(a),"onUpdate:modelValue":k[3]||(k[3]=h=>ye(a)?a.value=h:null)},null,8,["modelValue"])]),_:1},8,["object","textHandler"]))}}),Xx=Be(Gx,[["__scopeId","data-v-10473f7b"]]),Yx={id:"notification_text_wrapper"},Kx=Se({__name:"notification-tool",setup(t){const e=Ne(),n=W(null);$t(n);const o=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),s=M(()=>{const c=o.value.objects[e.state.ui.selection];if(c.type==="notification")return c}),r=c=>Va(e,s,"panels/setNotificationProperty",!1,c),i=r("text"),l=r("backdrop"),a=W(!1),u=M(()=>{if(a.value)return{title:"Text",get:()=>i.value,set:c=>{i.value=c},leave:()=>{a.value=!1}}});return(c,d)=>($(),de(Po,{ref_key:"root",ref:n,object:s.value,title:"Notification",textHandler:u.value},{default:Q(()=>[p("div",Yx,[d[4]||(d[4]=p("label",{for:"notification_text"},"Text:",-1)),_e(p("textarea",{"onUpdate:modelValue":d[0]||(d[0]=g=>ye(i)?i.value=g:null),id:"notification_text",onKeydown:d[1]||(d[1]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(i)]]),p("button",{onClick:d[2]||(d[2]=g=>a.value=!0)},"Formatting")])]),options:Q(()=>[H(Xe,{modelValue:ie(l),"onUpdate:modelValue":d[3]||(d[3]=g=>ye(l)?l.value=g:null),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"]))}}),Jx=Be(Kx,[["__scopeId","data-v-a9a341cc"]]),Zx=["onClick","onKeydown"],Qx={class:"panel_text"},eS={class:"panel_nr"},tS={class:"column"},nS={class:"v-w100"},oS={colspan:"2"},sS={key:0,value:"image/webp"},rS={key:1,value:"image/heif"},iS={key:0},lS={for:"export_ppi"},aS={key:0},uS={for:"export_pages"},cS={key:0},dS={colspan:"2"},fS={class:"column"},pS=100,hS=90,Sd=70,_d=1/4,gS=.5,vS=Se({__name:"panels-tool",setup(t){const e=Ne(),n=W(null),{vertical:o,getRoot:s}=$t(n),r=W(he.supports.limitedCanvasSpace?10:0),i=W(""),l=W("image/png"),a=W(hS),u=W(!1),c=W(!1),d=W(null),g=ue().Base,b=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),y=M(()=>l.value!=="image/png"),w=M(()=>x.value.length>1);function _(J){return J===""}const k=W(!1),h=W(!1);Promise.allSettled([co(),Om()]).then(([J,U])=>{J.status==="fulfilled"&&(k.value=J.value),U.status==="fulfilled"&&(h.value=U.value)});const v=M(()=>e.state.panels.panelOrder.indexOf(b.value.id)>0),f=M(()=>{const J=e.state.panels.panelOrder;return J.indexOf(b.value.id)<J.length-1}),x=M(()=>e.state.panels.panelOrder.map(U=>{const re=e.state.panels.panels[U],S=e.state.panels.panels[U],O=[...S.order,...S.onTopOrder].map(E=>e.state.panels.panels[U].objects[E]).map(P);return{id:U,image:re.lastRender,text:O.reduce((E,q)=>E.length>q.length?E:q,"")}}));function P(J){switch(J.type){case"textBox":return J.text;case"notification":return J.text;case"poem":return J.text;case"choice":return J.choices.map(U=>`[${U.text}]`).join(`
`)}return""}function j(){const J=s().querySelector(".panel_button.active");J!=null&&m(J)}function m(J){const U=J.parentElement.parentElement;e.state.ui.vertical?(U.scrollTop=J.offsetTop-U.clientHeight/2,U.scrollLeft=0):(U.scrollLeft=J.offsetLeft-U.clientWidth/2,U.scrollTop=0)}ht(()=>{j()});function T(){const J=new Date;return`cd-${[J.getFullYear(),`${J.getMonth()+1}`.padStart(2,"0"),`${J.getDate()}`.padStart(2,"0"),`${J.getHours()}`.padStart(2,"0"),`${J.getMinutes()}`.padStart(2,"0"),`${J.getSeconds()}`.padStart(2,"0")].join("-")}`}async function R(){await mo("export image",async()=>{const J=N(),U=l.value.split("/")[1],re=l.value,S=a.value,O=u.value,E=T();await B(J,!0,O,async(q,V)=>{await he.saveToFile(V,`${E}_${q}.${U}`,re,S/pS)})})}async function B(J,U,re,S){const O=ue().Base,E=[];for(let q=0;q<J.length;++q){const V=J[q],G=document.createElement("canvas");G.width=re?O.screenWidth*V.length:O.screenWidth,G.height=re?O.screenHeight:O.screenHeight*V.length;try{const se=G.getContext("2d");for(let Z=0;Z<V.length;++Z){const ne=V[Z],X=new is(e,ne,O.screenWidth,O.screenHeight);try{await X.render(U,!1,!0),X.paintOnto(se,{x:re?O.screenWidth*Z:0,y:re?0:O.screenHeight*Z,w:O.screenWidth,h:O.screenHeight})}finally{X.dispose()}}E.push(await S(q,G))}finally{po(G)}}return E}function D(){const J=e.state.panels.panelOrder.length-1,U=0,re=i.value.split(","),S=[];let O=!1;for(const E of re){const q=E.trim(),V=q.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!V){q!==""&&$e.fire(new Ot(`Could not read '${E}' in the page list.`));continue}if(O=!0,V[2])S.push(parseInt(V[2],10)-1);else{const G=Math.max(parseInt(V[3],10)-1,U),se=Math.min(parseInt(V[4],10)-1,J);if(G==null||se==null||G>se)continue;for(let Z=G;Z<=se;++Z)S.push(Z)}}return O?S.sort((E,q)=>E-q).filter((E,q,V)=>V[q-1]!==E).map(E=>e.state.panels.panelOrder[E]):e.state.panels.panelOrder}function N(){const J=D();if(isNaN(r.value)&&(r.value=0),r.value===0)return[J];const U=[];for(let re=0;re<J.length/r.value;++re){const S=re*r.value,O=S+r.value;U.push(J.slice(S,O))}return U}async function ee(){await te(async()=>{await e.dispatch("panels/duplicatePanel",{panelId:e.state.panels.currentPanel})}),await hn(),j()}function xe(J){te(()=>{e.commit("panels/setCurrentPanel",{panelId:J})}),hn(()=>{j()})}function z(){te(async()=>{await e.dispatch("panels/delete",{panelId:e.state.panels.currentPanel})}),hn(()=>{j()})}function I(){te(async()=>{await e.dispatch("panels/move",{panelId:b.value.id,delta:-1})})}function C(){te(async()=>{await e.dispatch("panels/move",{panelId:b.value.id,delta:1})})}const A=Dn();A.width=g.screenWidth*_d,A.height=g.screenHeight*_d;const oe=A.getContext("2d"),pe=W(!1),Oe=M(()=>e.state.panels.panelOrder.filter(U=>e.state.panels.panels[U].lastRender==null));async function Ie(){const J=vo(e);J&&await tt(J)}async function tt(J){await mo("render thumbnail",async()=>{const U=J.panelId;J.paintOnto(oe,{x:0,y:0,w:oe.canvas.width,h:oe.canvas.height}),oe.canvas.toBlob(re=>{if(!re)return;const S=URL.createObjectURL(re);te(()=>{e.commit("panels/setPanelPreview",{panelId:U,url:S})})},await co()?"image/webp":"image/jpeg",gS)})}async function K(){const J=ue().Base;if(!pe.value||he.supports.limitedCanvasSpace)return;const U=Oe.value;if(U.length===0)return;const re=U[0],S=new is(e,re,J.screenWidth,J.screenHeight);await S.render(!1,!1,!0),await tt(S),setTimeout(()=>{K()},500)}ht(()=>{pe.value=!0,requestAnimationFrame(()=>Ie().catch(()=>{}))}),Rt(()=>{pe.value=!1,po(oe.canvas)}),$e.subscribe(Ws,()=>requestAnimationFrame(Ie));async function be(){const J=await e.dispatch("getSave",!0),U=new Blob([J],{type:"text/plain"}),re=new Date,S=`save-${[re.getFullYear(),`${re.getMonth()+1}`.padStart(2,"0"),`${re.getDate()}`.padStart(2,"0"),`${re.getHours()}`.padStart(2,"0"),`${re.getMinutes()}`.padStart(2,"0"),`${re.getSeconds()}`.padStart(2,"0")].join("-")}`;he.storeSaveFile(U,`${S}.dddg`)}async function Ce(){await te(async()=>{const J=d.value;if(!J.files)return;$e.fire(new qs);const U=await Ae(J.files[0]);await e.dispatch("loadSave",U),he.supports.limitedCanvasSpace&&$e.fire(new Ot("To prevent running out of memory, thumbnails will not be automatically restored in the background."))}),await Ie(),setTimeout(()=>{K()},1e3)}function Ae(J){return new Promise((U,re)=>{const S=new FileReader;S.onload=function(){U(S.result)},S.onerror=function(O){re(O)},S.readAsText(J)})}return ze(()=>a.value,(J,U)=>{if(J===100){$e.fire(new Ot("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(U>Sd&&J<=Sd){$e.fire(new Ot("Note: A quality level below 70% might be very noticeable and impair legibility of text."));return}}),ze(()=>r.value,(J,U)=>{if(he.supports.limitedCanvasSpace&&(U<=10&&J>10||J===0&&x.value.length>10)){$e.fire(new Ot("Note: Safari has strict limitations on available memory. More images per panel can easily cause crashes."));return}}),(J,U)=>($(),F("div",{class:"panel",ref_key:"root",ref:n},[U[27]||(U[27]=p("h1",null,"Panels",-1)),c.value?($(),de(Ua,{key:0,type:"panel",title:"","panel-id":b.value.id,"no-composition":"",onLeave:U[0]||(U[0]=re=>{c.value=!1,Ie()})},null,8,["panel-id"])):($(),F(ae,{key:1},[H(St,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:Q(()=>[H(Tt,{"no-wraping":"",maxSize:"350px"},{default:Q(()=>[($(!0),F(ae,null,qe(x.value,(re,S)=>($(),F("div",{key:re.id,class:Le({panel_button:!0,active:re.id===b.value.id}),style:Qe(`background-image: url('${re.image}')`),tabindex:"0",onClick:O=>xe(re.id),onKeydown:[st(O=>xe(re.id),["enter"]),st(ce(O=>xe(re.id),["prevent"]),["space"])]},[p("div",Qx,[p("p",null,Pe(re.text),1)]),p("div",eS,Pe(S+1),1)],46,Zx))),128))]),_:1})]),_:1}),p("div",tS,[H(je,{icon:"add_to_queue",onClick:ee},{default:Q(()=>U[11]||(U[11]=[Y(" Add new")])),_:1}),H(je,{icon:"remove_from_queue",class:"bt0",onClick:z,disabled:!w.value},{default:Q(()=>U[12]||(U[12]=[Y(" Delete panel ")])),_:1},8,["disabled"]),H(je,{icon:"arrow_upward",class:"bt0",onClick:I,disabled:!v.value},{default:Q(()=>U[13]||(U[13]=[Y(" Move ahead ")])),_:1},8,["disabled"]),H(je,{icon:"arrow_downward",class:"bt0",onClick:C,disabled:!f.value},{default:Q(()=>U[14]||(U[14]=[Y(" Move behind ")])),_:1},8,["disabled"]),H(je,{class:"bt0",icon:"color_lens",onClick:U[1]||(U[1]=re=>c.value=!0)},{default:Q(()=>U[15]||(U[15]=[Y(" Image options ")])),_:1})]),H(St,{title:"Export",class:"h-h100 export_settings"},{default:Q(()=>[p("table",nS,[p("tbody",null,[p("tr",null,[p("td",oS,[H(je,{icon:"photo_camera",class:"w100",onClick:R},{default:Q(()=>U[16]||(U[16]=[Y(" Download ")])),_:1})])]),p("tr",null,[U[19]||(U[19]=p("td",null,[p("label",{for:"export_format"},"Format")],-1)),p("td",null,[_e(p("select",{id:"export_format","onUpdate:modelValue":U[2]||(U[2]=re=>l.value=re)},[U[17]||(U[17]=p("option",{value:"image/png"}," PNG (lossless) ",-1)),k.value?($(),F("option",sS," WebP (lossy) ")):fe("",!0),h.value?($(),F("option",rS," HEIF (lossy) ")):fe("",!0),U[18]||(U[18]=p("option",{value:"image/jpeg"}," JPEG (lossy) ",-1))],512),[[xt,l.value]])])]),y.value?($(),F("tr",iS,[U[20]||(U[20]=p("td",null,[p("label",{for:"export_quality"},"Quality:")],-1)),p("td",null,[_e(p("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":U[3]||(U[3]=re=>a.value=re),onKeydown:U[4]||(U[4]=ce(()=>{},["stop"]))},null,544),[[Ye,a.value,void 0,{number:!0}]])])])):fe("",!0),p("tr",null,[p("td",null,[p("label",lS,[U[22]||(U[22]=Y(" Panels per image: ")),!y.value||ie(o)?($(),F("small",aS,U[21]||(U[21]=[p("br",null,null,-1),Y("(0 for one single image)")]))):fe("",!0)])]),p("td",null,[_e(p("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":U[5]||(U[5]=re=>r.value=re),onKeydown:U[6]||(U[6]=ce(()=>{},["stop"])),onBlur:U[7]||(U[7]=re=>{_(r.value)&&(r.value=0)})},null,544),[[Ye,r.value,void 0,{number:!0}]])])]),p("tr",null,[p("td",null,[p("label",uS,[U[24]||(U[24]=Y(" Panels to export: ")),!y.value||ie(o)?($(),F("small",cS,U[23]||(U[23]=[p("br",null,null,-1),Y("(Leave empty for all)")]))):fe("",!0)])]),p("td",null,[_e(p("input",{id:"export_pages","onUpdate:modelValue":U[8]||(U[8]=re=>i.value=re),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[Ye,i.value]])])]),p("tr",null,[p("td",dS,[H(Xe,{modelValue:u.value,"onUpdate:modelValue":U[9]||(U[9]=re=>u.value=re),label:"Horizontal arrangement?",title:"Order panels side by side instead of top to bottom"},null,8,["modelValue"])])])])])]),_:1}),p("div",fS,[H(je,{icon:"save",onClick:be},{default:Q(()=>U[25]||(U[25]=[Y("Save")])),_:1}),H(je,{class:"bt0",icon:"folder_open",onClick:U[10]||(U[10]=re=>d.value.click())},{default:Q(()=>[U[26]||(U[26]=Y(" Load ")),p("input",{type:"file",ref_key:"loadUpload",ref:d,onChange:Ce},null,544)]),_:1})])],64))],512))}}),mS=Be(vS,[["__scopeId","data-v-20099a57"]]),bS={id:"poem_text",class:"v-w100"},yS=["value"],wS=["value"],kS={key:1},CS={class:"v-w100"},xS=Se({__name:"poem-tool",setup(t){const e=Ne(),n=W(null),o=W(null),{vertical:s}=$t(n),r=W(!1),i=W("");ze(()=>s.value,()=>{o.value.style.height="",o.value.style.width=""});const l=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),a=M(()=>{const k=l.value.objects[e.state.ui.selection];if(k.type==="poem")return k}),u=k=>Va(e,a,"panels/setPoemProperty",!1,k),c=M(()=>{if(r.value)return{title:"Text",get:()=>g.value,set:k=>{g.value=k},leave:()=>{r.value=!1}}}),d=M(()=>{if(i.value)return{title:"Color",get:()=>{switch(i.value){case"":return"#000000";case"base":return a.value.consoleColor;default:throw new Bt.UnreachableCaseError(i.value)}},set:k=>{te(()=>{const h=l.value.id,v=a.value.id;k!==void 0&&e.commit("panels/setPoemProperty",{key:"consoleColor",panelId:h,id:v,value:k})})},leave:()=>{i.value=""}}}),g=u("text"),b=u("autoWrap"),y=u("font"),w=u("overflow"),_=u("background");return(k,h)=>($(),de(Po,{ref_key:"root",ref:n,object:a.value,title:a.value.subType==="poem"?"Poem":"Console",textHandler:c.value,colorHandler:d.value},{default:Q(()=>[p("div",bS,[h[10]||(h[10]=p("label",{for:"poem_text"},"Text:",-1)),_e(p("textarea",{class:"v-w100",ref_key:"textarea",ref:o,"onUpdate:modelValue":h[0]||(h[0]=v=>ye(g)?g.value=v:null),onKeydown:h[1]||(h[1]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(g)]]),p("button",{class:"w100 bt0",onClick:h[2]||(h[2]=v=>r.value=!0)}," Formatting ")]),H(Xe,{label:"Auto line wrap?",modelValue:ie(b),"onUpdate:modelValue":h[3]||(h[3]=v=>ye(b)?b.value=v:null)},null,8,["modelValue"]),H(Xe,{label:"Allow overflow?",modelValue:ie(w),"onUpdate:modelValue":h[4]||(h[4]=v=>ye(w)?w.value=v:null),title:"When text is too long, it is shown outside the container. Uses more memory"},null,8,["modelValue"]),a.value.subType==="poem"?($(),F(ae,{key:0},[_e(p("select",{"onUpdate:modelValue":h[5]||(h[5]=v=>ye(_)?_.value=v:null),onKeydown:h[6]||(h[6]=ce(()=>{},["stop"]))},[($(!0),F(ae,null,qe(ie(wp),(v,f)=>($(),F("option",{value:f,key:f},Pe(v.name),9,yS))),128))],544),[[xt,ie(_)]]),_e(p("select",{"onUpdate:modelValue":h[7]||(h[7]=v=>ye(y)?y.value=v:null),onKeydown:h[8]||(h[8]=ce(()=>{},["stop"]))},[($(!0),F(ae,null,qe(ie(kp),(v,f)=>($(),F("option",{value:f,key:f},Pe(v.name),9,wS))),128))],544),[[xt,ie(y)]])],64)):($(),F("table",kS,[p("tbody",null,[p("tr",null,[h[11]||(h[11]=p("td",{style:{width:"0"}},"Color:",-1)),p("td",CS,[p("button",{id:"console_color",class:"w100",style:Qe([{background:a.value.consoleColor},{"min-width":"64px"}]),onClick:h[9]||(h[9]=v=>i.value="base")},null,4)])])])]))]),_:1},8,["object","title","textHandler","colorHandler"]))}}),SS=Be(xS,[["__scopeId","data-v-07016f6d"]]),_S={class:"warning"},PS={style:{"word-wrap":"break-word"}},OS=Se({__name:"sprite-tool",setup(t){const e=Ne(),n=W(null),o=W(null);$t(n);const s=M(()=>{for(const u of i.value.assets){const c=gn(u,!1);if(console.log(c),c.startsWith("uploads:"))return c.substring(8)}return null}),r=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),i=M(()=>{const u=r.value.objects[e.state.ui.selection];if(u.type==="sprite")return u});function l(){o.value.click()}async function a(){const u=o.value;if(!u.files)return;if(u.files.length!==1){console.error("More than one file uploaded!");return}const c=u.files[0];await te(async()=>{const d=URL.createObjectURL(c);await e.dispatch("uploadUrls/add",{name:s.value,url:d})})}return(u,c)=>($(),de(Po,{ref_key:"root",ref:n,object:i.value,title:"Custom Sprite"},{default:Q(()=>[s.value?($(),F(ae,{key:0},[p("p",_S,[c[1]||(c[1]=Y(" MISSING SPRITE! Click below to re-upload ")),p("span",PS,'"'+Pe(s.value)+'"',1),c[2]||(c[2]=Y(". "))]),p("button",{onClick:c[0]||(c[0]=d=>l())},"Re-Upload"),p("input",{type:"file",ref_key:"missingSpriteUpload",ref:o,onChange:a},null,544)],64)):fe("",!0)]),_:1},8,["object"]))}}),TS=Be(OS,[["__scopeId","data-v-9f53e337"]]),IS={class:"upper-combos"},jS={colspan:"2"},$S=["value"],AS=["disabled"],RS={id:"dialog_text_wrapper",class:"v-w100"},MS={key:0},BS=["placeholder"],ES={colspan:"2"},DS={key:0},LS={key:1},NS={colspan:"2"},FS=Se({__name:"textbox-tool",setup(t){const e=Ne(),n=W(null),o=W(null),{vertical:s}=$t(n),r=W(""),i=W("");ze(()=>s.value,()=>{const I=o.value;I!=null&&(I.style.height="",I.style.width="")});const l=M(()=>e.state.panels.panels[e.state.panels.currentPanel]),a=M(()=>{const I=l.value.objects[e.state.ui.selection];if(I.type==="textBox")return I}),u=I=>Va(e,a,"panels/setTextBoxProperty",!1,I),c=M(()=>{if(r.value)return{title:w.value,get(){return r.value==="name"?a.value.talkingOther:r.value==="body"?f.value:""},set(I){r.value==="name"?b.value=I:r.value==="body"&&(f.value=I)},leave(){r.value=""}}}),d=M(()=>{if(i.value)return{title:_.value,get:()=>{switch(i.value){case"":return"#000000";case"base":return a.value.customColor;case"controls":return a.value.customControlsColor;case"namebox":return a.value.customNameboxColor;case"nameboxStroke":return a.value.customNameboxStroke;default:throw new Bt.UnreachableCaseError(i.value)}},set:I=>{te(()=>{const C=l.value.id,A=a.value.id,oe={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[i.value];I!==void 0&&e.commit("panels/setTextBoxProperty",oh(C,A,oe,I))})},leave:()=>{i.value=""}}}),g=M({get(){return a.value.talkingObjId??"$null$"},set(I){te(()=>{e.commit("panels/setTalkingObject",{id:a.value.id,panelId:a.value.panelId,talkingObjId:I==="$null$"?null:I})})}}),b=bo(e,a,"panels/setTalkingOther",!1,"talkingOther"),y=M(()=>{const I=l.value,C=[];for(const A of[...I.order,...I.onTopOrder]){const oe=I.objects[A];oe.label!==null&&C.push([A,oe.label])}return C}),w=M(()=>r.value==="name"?"Name":r.value==="body"?"Dialog":""),_=M(()=>{switch(i.value){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new Bt.UnreachableCaseError(i.value)}}),k=u("autoQuoting"),h=u("autoWrap"),v=u("overflow"),f=u("text"),x=M(()=>P.value.startsWith("custom")),P=bo(e,a,"panels/setStyle",!0,"style"),j=u("controls"),m=u("skip"),T=u("continue"),R=u("overrideColor"),B=u("deriveCustomColors"),D=u("customNameboxWidth"),N=M(()=>ue().TextBox.NameboxWidth);function ee(){te(async()=>{await e.dispatch("panels/splitTextbox",{id:a.value.id,panelId:a.value.panelId})})}function xe(){te(async()=>{await e.dispatch("panels/resetTextboxBounds",{id:a.value.id,panelId:a.value.panelId})})}function z(){te(()=>{e.commit("ui/setSelection",g.value)})}return(I,C)=>($(),de(Po,{ref_key:"root",ref:n,object:a.value,title:"Textbox",textHandler:c.value,colorHandler:d.value},{default:Q(()=>[p("table",IS,[p("tbody",null,[p("tr",null,[C[25]||(C[25]=p("td",null,[p("label",{for:"text_style"},"Style:")],-1)),p("td",jS,[_e(p("select",{id:"text_style","onUpdate:modelValue":C[0]||(C[0]=A=>ye(P)?P.value=A:null),onKeydown:C[1]||(C[1]=ce(()=>{},["stop"]))},C[24]||(C[24]=[p("option",{value:"normal"},"Normal",-1),p("option",{value:"corrupt"},"Corrupt",-1),p("option",{value:"custom"},"Custom",-1),p("option",{value:"custom_plus"}," Custom (Plus) ",-1),p("option",{value:"none"},"None",-1)]),544),[[xt,ie(P)]])])]),p("tr",null,[C[28]||(C[28]=p("td",null,[p("label",{for:"current_talking"},"Person talking:")],-1)),p("td",null,[_e(p("select",{id:"current_talking","onUpdate:modelValue":C[2]||(C[2]=A=>g.value=A),onKeydown:C[3]||(C[3]=ce(()=>{},["stop"]))},[C[26]||(C[26]=p("option",{value:"$null$"},"No-one",-1)),($(!0),F(ae,null,qe(y.value,([A,oe])=>($(),F("option",{key:A,value:A},Pe(oe),9,$S))),128)),C[27]||(C[27]=p("option",{value:"$other$"},"Other",-1))],544),[[xt,g.value]])]),p("td",null,[p("button",{title:"Jump to talking character",onClick:z,disabled:g.value==="$null$"||g.value==="$other$"}," > ",8,AS)])]),p("tr",null,[C[29]||(C[29]=p("td",null,[p("label",{for:"custom_name"},"Other name:")],-1)),p("td",null,[_e(p("input",{id:"custom_name","onUpdate:modelValue":C[4]||(C[4]=A=>ye(b)?b.value=A:null),onKeydown:C[5]||(C[5]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(b)]])]),p("td",null,[p("button",{onClick:C[6]||(C[6]=A=>r.value="name")},"...")])])])]),H(Xe,{label:"Auto quoting?",modelValue:ie(k),"onUpdate:modelValue":C[7]||(C[7]=A=>ye(k)?k.value=A:null),title:"Try to automatically fix missing/unclosed quotation marks when a character is speaking"},null,8,["modelValue"]),H(Xe,{label:"Auto line wrap?",modelValue:ie(h),"onUpdate:modelValue":C[8]||(C[8]=A=>ye(h)?h.value=A:null),title:"Automatically insert line breaks when a line of text is larger than the textbox"},null,8,["modelValue"]),H(Xe,{label:"Allow overflow?",modelValue:ie(v),"onUpdate:modelValue":C[9]||(C[9]=A=>ye(v)?v.value=A:null),title:"When text is too long, it is shown outside the textbox. Uses more memory"},null,8,["modelValue"]),p("div",RS,[C[30]||(C[30]=p("label",{for:"dialog_text"},"Dialog:",-1)),_e(p("textarea",{class:"v-w100",ref_key:"textarea",ref:o,"onUpdate:modelValue":C[10]||(C[10]=A=>ye(f)?f.value=A:null),id:"dialog_text",onKeydown:C[11]||(C[11]=ce(()=>{},["stop"]))},null,544),[[Ye,ie(f)]]),p("button",{class:"w100 bt0",onClick:C[12]||(C[12]=A=>r.value="body")}," Formatting ")])]),options:Q(()=>[H(St,{title:"Customization:",class:Le(x.value?"customization-set":"")},{default:Q(()=>[H(Tt,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:Q(()=>[H(Xe,{label:"Controls visible?",modelValue:ie(j),"onUpdate:modelValue":C[13]||(C[13]=A=>ye(j)?j.value=A:null)},null,8,["modelValue"]),H(Xe,{label:"Able to skip?",modelValue:ie(m),"onUpdate:modelValue":C[14]||(C[14]=A=>ye(m)?m.value=A:null)},null,8,["modelValue"]),H(Xe,{label:"Continue arrow?",modelValue:ie(T),"onUpdate:modelValue":C[15]||(C[15]=A=>ye(T)?T.value=A:null)},null,8,["modelValue"]),x.value?($(),F("table",MS,[p("tbody",null,[p("tr",null,[C[31]||(C[31]=p("td",null,[p("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),p("td",null,[_e(p("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:N.value+"","onUpdate:modelValue":C[16]||(C[16]=A=>ye(D)?D.value=A:null),onKeydown:C[17]||(C[17]=ce(()=>{},["stop"]))},null,40,BS),[[Ye,ie(D),void 0,{number:!0}]])])]),p("tr",null,[p("td",ES,[H(Xe,{modelValue:ie(R),"onUpdate:modelValue":C[18]||(C[18]=A=>ye(R)?R.value=A:null),label:"Override color"},null,8,["modelValue"])])]),ie(R)?($(),F("tr",DS,[C[32]||(C[32]=p("td",null,[p("label",{for:"textbox_color"},"Color:")],-1)),p("td",null,[p("button",{id:"textbox_color",class:"color-button",style:Qe({background:a.value.customColor}),onClick:C[19]||(C[19]=A=>i.value="base")},null,4)])])):fe("",!0),ie(R)?($(),F("tr",LS,[p("td",NS,[H(Xe,{id:"derive_custom_colors",modelValue:ie(B),"onUpdate:modelValue":C[20]||(C[20]=A=>ye(B)?B.value=A:null),label:"Derive other colors"},null,8,["modelValue"])])])):fe("",!0),ie(R)&&!ie(B)?($(),F(ae,{key:2},[p("tr",null,[C[33]||(C[33]=p("td",null,[p("label",{for:"custom_controls_color"},"Controls color:")],-1)),p("td",null,[p("button",{id:"custom_controls_color",class:"color-button",style:Qe({background:a.value.customControlsColor}),onClick:C[21]||(C[21]=A=>i.value="controls")},null,4)])]),p("tr",null,[C[34]||(C[34]=p("td",null,[p("label",{for:"custom_namebox_color"},"Namebox color:")],-1)),p("td",null,[p("button",{id:"custom_namebox_color",class:"color-button",style:Qe({background:a.value.customNameboxColor}),onClick:C[22]||(C[22]=A=>i.value="namebox")},null,4)])]),p("tr",null,[C[35]||(C[35]=p("td",null,[p("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1)),p("td",null,[p("button",{id:"custom_namebox_stroke",class:"color-button",style:Qe({background:a.value.customNameboxStroke}),onClick:C[23]||(C[23]=A=>i.value="nameboxStroke")},null,4)])])],64)):fe("",!0)])])):fe("",!0)]),_:1})]),_:1},8,["class"]),p("button",{onClick:xe},"Reset position"),p("button",{class:"bt0",onClick:ee},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"]))}}),HS=Be(FS,[["__scopeId","data-v-e9215d46"]]),US={id:"toolbar"},VS={id:"toolbar-end"},WS=Se({__name:"tool-box",emits:["show-dialog","show-prev-render","download","show-expression-dialog"],setup(t,{emit:e}){const n=e,o=Ne(),s=W(null),r=W("add"),i=M(()=>o.state.panels.panels[o.state.panels.currentPanel]),l=M(()=>o.state.ui.vertical),a=M(()=>o.state.ui.selection),u=M(()=>{if(r.value==="selection")if(a.value===null)r.value="add";else return i.value.objects[a.value].type;return r.value}),c=M(()=>o.state.ui.lastDownload!==null);function d(b){b===r.value&&(b="add"),r.value=b,a.value!==null&&o.commit("ui/setSelection",null)}function g(){s.value instanceof HTMLElement&&(s.value.scrollTop=0,s.value.scrollLeft=0)}return ze(()=>a.value,b=>{if(b!=null){r.value="selection";return}r.value==="selection"&&(r.value="add")}),he.onPanelChange(b=>{r.value=b}),(b,y)=>($(),F("div",{id:"panels",class:Le({vertical:l.value}),onScroll:g,ref_key:"panels",ref:s},[p("div",US,[H(je,{icon:"add_box","icon-pos":"top",class:Le({active:u.value==="add"}),title:"Add new objects to the scene",shortcut:"a",onClick:y[0]||(y[0]=w=>d("add"))},null,8,["class"]),H(je,{icon:"panorama","icon-pos":"top",class:Le({active:u.value==="backgrounds"}),title:"Change the current background",shortcut:"s",onClick:y[1]||(y[1]=w=>d("backgrounds"))},null,8,["class"]),H(je,{icon:"view_module","icon-pos":"top",class:Le({active:u.value==="panels"}),title:"Panels",shortcut:"d",onClick:y[2]||(y[2]=w=>d("panels"))},null,8,["class"]),H(je,{icon:"settings_applications","icon-pos":"top",class:Le({active:u.value==="settings"}),title:"Settings",shortcut:"f",onClick:y[3]||(y[3]=w=>d("settings"))},null,8,["class"])]),u.value==="settings"?($(),de(Wk,{key:0})):u.value==="backgrounds"?($(),de(HC,{key:1,onShowDialog:y[4]||(y[4]=w=>n("show-dialog",w))})):u.value==="help_credits"?($(),de(jk,{key:2})):u.value==="character"?($(),de(qx,{key:3,onShowDialog:y[5]||(y[5]=w=>n("show-dialog",w)),onShowExpressionDialog:y[6]||(y[6]=w=>n("show-expression-dialog",w))})):u.value==="sprite"?($(),de(TS,{key:4})):u.value==="textBox"?($(),de(HS,{key:5})):u.value==="choice"?($(),de(Xx,{key:6})):u.value==="panels"?($(),de(mS,{key:7})):u.value==="notification"?($(),de(Jx,{key:8})):u.value==="poem"?($(),de(SS,{key:9})):($(),de(Ok,{key:10,onShowDialog:y[7]||(y[7]=w=>n("show-dialog",w))})),p("div",VS,[H(je,{icon:"help","icon-pos":"top",class:Le({active:u.value==="help_credits"}),title:"Help & Credits",shortcut:"h",onClick:y[8]||(y[8]=w=>d("help_credits"))},null,8,["class"]),H(je,{icon:"extension","icon-pos":"top",title:"Content Packs",shortcut:"p",onClick:y[9]||(y[9]=w=>n("show-dialog"))}),H(je,{icon:"flip_to_back","icon-pos":"top",title:"Show last downloaded panel",shortcut:"l",onClick:y[10]||(y[10]=w=>n("show-prev-render")),disabled:!c.value},null,8,["disabled"]),H(je,{icon:"photo_camera","icon-pos":"top",title:"Take a screenshot of the current scene",shortcut:"i",onClick:y[11]||(y[11]=w=>n("download"))})])],34))}}),qS={id:"app"},zS={class:"hidden-selectors"},GS=["data-obj-id","onKeydown"],XS=20,Pd=16/9,YS=50,KS=Se({__name:"app",setup(t){const e=Ne(),n=tu(()=>Bu(()=>import("./single-box-C7l-ot-n.js"),__vite__mapDeps([0,1]),import.meta.url)),o=tu(()=>Bu(()=>import("./expression-builder-qIbRmfCD.js"),__vite__mapDeps([2,3]),import.meta.url)),s=W(!0),r=W(null),i=M(()=>{const A=e.state.panels,oe=A.panels[A.currentPanel];return oe==null?[]:[...oe.order,...oe.onTopOrder]});function l(){const A=e.state.ui.lastDownload;A!=null&&r.value.blendOver(A)}function a(A){A.preventDefault()}ht(()=>{document.body.addEventListener("drop",a,!0),document.body.addEventListener("dragover",a,!0)}),Rt(()=>{document.body.removeEventListener("drop",a,!0),document.body.removeEventListener("dragover",a,!0)});const u=W(0),c=W(0),d=W(192);function g(A,oe){let pe=A/Pd,Oe=oe*Pd;return pe>oe?pe=oe:Oe=A,[Oe,pe]}function b(A,oe){const pe=g(A,oe-d.value),Oe=g(A-d.value,oe);return pe[0]*pe[1]>Oe[0]*Oe[1]?[pe[0],pe[1],!1]:[Oe[0],Oe[1],!0]}function y(){const[A,oe,pe]=b(document.documentElement.clientWidth,document.documentElement.clientHeight);u.value=A,c.value=oe,e.state.ui.vertical!==pe&&e.commit("ui/setVertical",pe)}y(),ht(()=>{window.addEventListener("resize",y)}),Rt(()=>{window.removeEventListener("resize",y)});const w=W(!1),_=M(()=>e.state.ui.useDarkTheme),k=M(()=>_.value??w.value);if(ze(()=>k.value,A=>{document.body.classList.toggle("dark-theme",A)},{immediate:!0}),window.matchMedia!=null){const A=window.matchMedia("(prefers-color-scheme: dark)");w.value=A.matches;const oe=pe=>w.value=pe.matches;A.addEventListener?A.addEventListener("change",oe):A.addListener(oe)}const h=W(!1),v=W(""),f=W(void 0);function x(A){h.value=!0,v.value=A.character,f.value=A.headGroup}const P=W(null),j=W(!1);function m(A){if(j.value=!0,A==null)return;const oe=()=>{P.value?P.value.setSearch(A):setTimeout(oe,YS)};hn(oe)}const T=M(()=>e.state.ui.nsfw);ze(()=>T.value,async A=>{A?await e.dispatch("content/loadContentPacks",Jv):await e.dispatch("removePacks",{packs:Kv})});let R=null;function B(){R==null&&(R=requestAnimationFrame(()=>{R=null,$e.fire(new br)}))}function D(A){if(A.target instanceof HTMLInputElement||A.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}te(async()=>{const oe=A.ctrlKey&&!A.altKey&&!A.metaKey&&!A.shiftKey,pe=!A.ctrlKey&&!A.altKey&&!A.metaKey&&!A.shiftKey;if(oe&&A.key==="v"){await e.dispatch("panels/pasteObjectFromClipboard",{}),A.preventDefault();return}if(pe&&A.key==="Escape"){if(e.state.ui.selection===null)return;e.commit("ui/setSelection",null);return}const Ie=e.state.panels.panels[e.state.panels.currentPanel].objects[e.state.ui.selection];if(Ie!=null){if(oe){if(A.key==="c"||A.key==="x"){await e.dispatch("panels/copyObjectToClipboard",{id:Ie.id,panelId:Ie.panelId}),A.key==="x"&&await e.dispatch("panels/removeObject",{id:Ie.id,panelId:Ie.panelId}),A.preventDefault();return}}else if(pe){if(A.key==="Delete"){await e.dispatch("panels/removeObject",{id:Ie.id,panelId:Ie.panelId});return}if(A.key==="/"||A.key==="*"){let Ce=A.key==="/"?-10:10;A.shiftKey&&(Ce/=Math.abs(Ce)),e.commit("panels/setRotation",{id:Ie.id,panelId:Ie.panelId,rotation:Ie.rotation+Ce}),A.stopPropagation(),A.preventDefault();return}if(Ie.type==="character"){const Ce=Ie;if(!Ce.freeMove){if(A.key==="ArrowLeft"){await e.dispatch("panels/shiftCharacterSlot",{id:Ce.id,panelId:Ce.panelId,delta:-1});return}if(A.key==="ArrowRight"){await e.dispatch("panels/shiftCharacterSlot",{id:Ce.id,panelId:Ce.panelId,delta:1});return}}}let{x:tt,y:K}=Ie;const be=A.shiftKey?1:XS;switch(A.key){case"ArrowLeft":tt-=be;break;case"ArrowRight":tt+=be;break;case"ArrowUp":K-=be;break;case"ArrowDown":K+=be;break;default:return}await e.dispatch("panels/setPosition",{id:Ie.id,panelId:Ie.panelId,x:tt,y:K})}}})}ht(()=>{window.addEventListener("keydown",D)}),Rt(()=>{window.removeEventListener("keydown",D)});let N=null,ee=!1;function xe(A){A.ctrlKey?!ee&&N===null&&(N=setTimeout(z)):I()}function z(){document.body.classList.add("ctrl-key"),ee=!0}function I(){N!==null&&(clearTimeout(N),N=null),document.body.classList.remove("ctrl-key"),ee=!1}ht(()=>{for(const A of["keydown","keyup","mousemove"])window.addEventListener(A,xe,!0);window.addEventListener("blur",I)}),Rt(()=>{for(const A of["keydown","keyup","mousemove"])window.removeEventListener(A,xe,!0);window.removeEventListener("blur",I)});function C(A){te(()=>{e.state.ui.selection!==A&&e.commit("ui/setSelection",A)})}return ze(()=>e.state.ui.selection,A=>{var oe,pe;((oe=document.activeElement)==null?void 0:oe.getAttribute("data-obj-id"))!==""+A&&((pe=document.querySelector(`*[data-obj-id='${A}']`))==null||pe.focus({focusVisible:!1,preventScroll:!0}))},{immediate:!0}),yn.setStore(e),window.store=e,window.env=he,ht(async()=>{await he.loadGameMode(),he.connectToStore(e),s.value=!1;const A=await he.loadSettings();await te(async()=>{if(he.state.looseTextParsing=A.looseTextParsing||!0,e.commit("ui/setLqRendering",A.lq??!1),e.commit("ui/setDarkTheme",A.darkMode??null),e.commit("ui/setDefaultCharacterTalkingZoom",A.defaultCharacterTalkingZoom??!0),await e.dispatch("content/loadContentPacks",[`${ft}buildin.base.backgrounds.json`,`${ft}buildin.base.monika.json`,`${ft}buildin.base.sayori.json`,`${ft}buildin.base.natsuki.json`,`${ft}buildin.base.yuri.json`,`${ft}buildin.extra.mc.json`,`${ft}buildin.extra.concept_mc_v2.json`,`${ft}buildin.extra.mc_chad.json`,`${ft}buildin.extra.femc.json`,`${ft}buildin.extra.concept_femc.json`,`${ft}buildin.extra.amy.json`]),!await he.loadDefaultTemplate()){await he.loadContentPacks();const oe=await e.dispatch("panels/createPanel");Object.keys(e.state.panels.panels[oe].objects).length===0&&await e.dispatch("panels/createTextBox",{panelId:oe,text:`Hi! Click here to edit this textbox! ${e.state.ui.vertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more! Use the camera icon to download the image.`}),e.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:e.state.panels.currentPanel}),e.commit("ui/setNsfw",A.nsfw??!1)}})}),(A,oe)=>($(),F(ae,null,[p("div",qS,[p("div",zS,[($(!0),F(ae,null,qe(i.value,pe=>($(),F("div",{key:pe,tabindex:"0","data-obj-id":pe,onFocus:oe[0]||(oe[0]=Oe=>B()),onBlur:oe[1]||(oe[1]=Oe=>B()),onKeydown:[st(ce(Oe=>C(pe),["prevent"]),["enter"]),st(ce(Oe=>C(pe),["prevent"]),["space"])]},null,40,GS))),128))]),H(lk,{ref_key:"renderer",ref:r,canvasWidth:u.value,canvasHeight:c.value,preLoading:s.value},null,8,["canvasWidth","canvasHeight","preLoading"]),H(U1),H(WS,{onShowPrevRender:l,onDownload:oe[2]||(oe[2]=pe=>r.value.download()),onShowDialog:m,onShowExpressionDialog:x}),($(),de(cg,null,[j.value?($(),de(oo,{key:0,ref:"dialog",onLeave:oe[4]||(oe[4]=pe=>j.value=!1)},{default:Q(()=>[H(ie(n),{ref_key:"packDialog",ref:P,onLeave:oe[3]||(oe[3]=pe=>j.value=!1)},null,512)]),_:1},512)):fe("",!0)],1024)),h.value?($(),de(oo,{key:0,ref:"dialog",onLeave:oe[6]||(oe[6]=pe=>h.value=!1)},{default:Q(()=>[H(ie(o),{character:v.value,initHeadGroup:f.value,onLeave:oe[5]||(oe[5]=pe=>h.value=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):fe("",!0)]),oe[7]||(oe[7]=p("div",{id:"modal-messages"},null,-1))],64))}});Vv(KS).use(E1).mount("#main_wrapper");export{ht as A,Rt as B,_e as C,Ye as D,Jg as E,ae as F,uf as G,mo as H,$e as I,mn as J,qt as K,gn as L,fo as M,Kp as N,ih as O,rh as P,xt as Q,yn as R,St as S,ZS as T,r1 as U,Ff as V,$s as W,nh as X,en as Y,te as Z,Je as _,F as a,p as b,M as c,Se as d,he as e,fe as f,Y as g,ie as h,H as i,Q as j,de as k,Xe as l,qe as m,Qe as n,$ as o,Z1 as p,Be as q,W as r,ze as s,Pe as t,Ne as u,Le as v,ce as w,hn as x,Rn as y,cs as z};
