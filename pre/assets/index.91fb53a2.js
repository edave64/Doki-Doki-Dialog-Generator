var en=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function wl(e,t){const n=Object.create(null),o=e.split(",");for(let s=0;s<o.length;s++)n[o[s]]=!0;return t?s=>!!n[s.toLowerCase()]:s=>!!n[s]}function Re(e){if(z(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],s=xe(o)?ch(o):Re(o);if(s)for(const r in s)t[r]=s[r]}return t}else{if(xe(e))return e;if(be(e))return e}}const lh=/;(?![^(]*\))/g,ah=/:([^]+)/,dh=new RegExp("\\/\\*.*?\\*\\/","gs");function ch(e){const t={};return e.replace(dh,"").split(lh).forEach(n=>{if(n){const o=n.split(ah);o.length>1&&(t[o[0].trim()]=o[1].trim())}}),t}function pe(e){let t="";if(xe(e))t=e;else if(z(e))for(let n=0;n<e.length;n++){const o=pe(e[n]);o&&(t+=o+" ")}else if(be(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const uh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",ph=wl(uh);function bu(e){return!!e||e===""}function fh(e,t){if(e.length!==t.length)return!1;let n=!0;for(let o=0;n&&o<e.length;o++)n=ps(e[o],t[o]);return n}function ps(e,t){if(e===t)return!0;let n=Ba(e),o=Ba(t);if(n||o)return n&&o?e.getTime()===t.getTime():!1;if(n=es(e),o=es(t),n||o)return e===t;if(n=z(e),o=z(t),n||o)return n&&o?fh(e,t):!1;if(n=be(e),o=be(t),n||o){if(!n||!o)return!1;const s=Object.keys(e).length,r=Object.keys(t).length;if(s!==r)return!1;for(const i in e){const a=e.hasOwnProperty(i),l=t.hasOwnProperty(i);if(a&&!l||!a&&l||!ps(e[i],t[i]))return!1}}return String(e)===String(t)}function $l(e,t){return e.findIndex(n=>ps(n,t))}const fe=e=>xe(e)?e:e==null?"":z(e)||be(e)&&(e.toString===_u||!Z(e.toString))?JSON.stringify(e,vu,2):String(e),vu=(e,t)=>t&&t.__v_isRef?vu(e,t.value):oo(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[o,s])=>(n[`${o} =>`]=s,n),{})}:Co(t)?{[`Set(${t.size})`]:[...t.values()]}:be(t)&&!z(t)&&!wu(t)?String(t):t,we={},no=[],yt=()=>{},hh=()=>!1,gh=/^on[^a-z]/,yr=e=>gh.test(e),Cl=e=>e.startsWith("onUpdate:"),He=Object.assign,Pl=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},mh=Object.prototype.hasOwnProperty,re=(e,t)=>mh.call(e,t),z=Array.isArray,oo=e=>Po(e)==="[object Map]",Co=e=>Po(e)==="[object Set]",Ba=e=>Po(e)==="[object Date]",bh=e=>Po(e)==="[object RegExp]",Z=e=>typeof e=="function",xe=e=>typeof e=="string",es=e=>typeof e=="symbol",be=e=>e!==null&&typeof e=="object",yu=e=>be(e)&&Z(e.then)&&Z(e.catch),_u=Object.prototype.toString,Po=e=>_u.call(e),vh=e=>Po(e).slice(8,-1),wu=e=>Po(e)==="[object Object]",Sl=e=>xe(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Us=wl(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),_r=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},yh=/-(\w)/g,Dt=_r(e=>e.replace(yh,(t,n)=>n?n.toUpperCase():"")),_h=/\B([A-Z])/g,Nn=_r(e=>e.replace(_h,"-$1").toLowerCase()),wr=_r(e=>e.charAt(0).toUpperCase()+e.slice(1)),Zr=_r(e=>e?`on${wr(e)}`:""),ts=(e,t)=>!Object.is(e,t),so=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},Js=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},Zs=e=>{const t=parseFloat(e);return isNaN(t)?e:t},wh=e=>{const t=xe(e)?Number(e):NaN;return isNaN(t)?e:t};let Aa;const $h=()=>Aa||(Aa=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let mt;class $u{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=mt,!t&&mt&&(this.index=(mt.scopes||(mt.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const n=mt;try{return mt=this,t()}finally{mt=n}}}on(){mt=this}off(){mt=this.parent}stop(t){if(this._active){let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.scopes)for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function Ch(e){return new $u(e)}function Ph(e,t=mt){t&&t.active&&t.effects.push(e)}function Sh(){return mt}const kl=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Cu=e=>(e.w&yn)>0,Pu=e=>(e.n&yn)>0,kh=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=yn},Oh=e=>{const{deps:t}=e;if(t.length){let n=0;for(let o=0;o<t.length;o++){const s=t[o];Cu(s)&&!Pu(s)?s.delete(e):t[n++]=s,s.w&=~yn,s.n&=~yn}t.length=n}},Ei=new WeakMap;let Wo=0,yn=1;const Bi=30;let bt;const Dn=Symbol(""),Ai=Symbol("");class Ol{constructor(t,n=null,o){this.fn=t,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,Ph(this,o)}run(){if(!this.active)return this.fn();let t=bt,n=gn;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=bt,bt=this,gn=!0,yn=1<<++Wo,Wo<=Bi?kh(this):Da(this),this.fn()}finally{Wo<=Bi&&Oh(this),yn=1<<--Wo,bt=this.parent,gn=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){bt===this?this.deferStop=!0:this.active&&(Da(this),this.onStop&&this.onStop(),this.active=!1)}}function Da(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let gn=!0;const Su=[];function So(){Su.push(gn),gn=!1}function ko(){const e=Su.pop();gn=e===void 0?!0:e}function Je(e,t,n){if(gn&&bt){let o=Ei.get(e);o||Ei.set(e,o=new Map);let s=o.get(n);s||o.set(n,s=kl()),ku(s)}}function ku(e,t){let n=!1;Wo<=Bi?Pu(e)||(e.n|=yn,n=!Cu(e)):n=!e.has(bt),n&&(e.add(bt),bt.deps.push(e))}function Xt(e,t,n,o,s,r){const i=Ei.get(e);if(!i)return;let a=[];if(t==="clear")a=[...i.values()];else if(n==="length"&&z(e)){const l=Number(o);i.forEach((d,c)=>{(c==="length"||c>=l)&&a.push(d)})}else switch(n!==void 0&&a.push(i.get(n)),t){case"add":z(e)?Sl(n)&&a.push(i.get("length")):(a.push(i.get(Dn)),oo(e)&&a.push(i.get(Ai)));break;case"delete":z(e)||(a.push(i.get(Dn)),oo(e)&&a.push(i.get(Ai)));break;case"set":oo(e)&&a.push(i.get(Dn));break}if(a.length===1)a[0]&&Di(a[0]);else{const l=[];for(const d of a)d&&l.push(...d);Di(kl(l))}}function Di(e,t){const n=z(e)?e:[...e];for(const o of n)o.computed&&Ra(o);for(const o of n)o.computed||Ra(o)}function Ra(e,t){(e!==bt||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const xh=wl("__proto__,__v_isRef,__isVue"),Ou=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(es)),jh=xl(),Ih=xl(!1,!0),Th=xl(!0),Ha=Eh();function Eh(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const o=ie(this);for(let r=0,i=this.length;r<i;r++)Je(o,"get",r+"");const s=o[t](...n);return s===-1||s===!1?o[t](...n.map(ie)):s}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){So();const o=ie(this)[t].apply(this,n);return ko(),o}}),e}function Bh(e){const t=ie(this);return Je(t,"has",e),t.hasOwnProperty(e)}function xl(e=!1,t=!1){return function(o,s,r){if(s==="__v_isReactive")return!e;if(s==="__v_isReadonly")return e;if(s==="__v_isShallow")return t;if(s==="__v_raw"&&r===(e?t?Kh:Eu:t?Tu:Iu).get(o))return o;const i=z(o);if(!e){if(i&&re(Ha,s))return Reflect.get(Ha,s,r);if(s==="hasOwnProperty")return Bh}const a=Reflect.get(o,s,r);return(es(s)?Ou.has(s):xh(s))||(e||Je(o,"get",s),t)?a:We(a)?i&&Sl(s)?a:a.value:be(a)?e?Bu(a):Kt(a):a}}const Ah=xu(),Dh=xu(!0);function xu(e=!1){return function(n,o,s,r){let i=n[o];if(uo(i)&&We(i)&&!We(s))return!1;if(!e&&(!Qs(s)&&!uo(s)&&(i=ie(i),s=ie(s)),!z(n)&&We(i)&&!We(s)))return i.value=s,!0;const a=z(n)&&Sl(o)?Number(o)<n.length:re(n,o),l=Reflect.set(n,o,s,r);return n===ie(r)&&(a?ts(s,i)&&Xt(n,"set",o,s):Xt(n,"add",o,s)),l}}function Rh(e,t){const n=re(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&n&&Xt(e,"delete",t,void 0),o}function Hh(e,t){const n=Reflect.has(e,t);return(!es(t)||!Ou.has(t))&&Je(e,"has",t),n}function Mh(e){return Je(e,"iterate",z(e)?"length":Dn),Reflect.ownKeys(e)}const ju={get:jh,set:Ah,deleteProperty:Rh,has:Hh,ownKeys:Mh},Fh={get:Th,set(e,t){return!0},deleteProperty(e,t){return!0}},Nh=He({},ju,{get:Ih,set:Dh}),jl=e=>e,$r=e=>Reflect.getPrototypeOf(e);function xs(e,t,n=!1,o=!1){e=e.__v_raw;const s=ie(e),r=ie(t);n||(t!==r&&Je(s,"get",t),Je(s,"get",r));const{has:i}=$r(s),a=o?jl:n?El:ns;if(i.call(s,t))return a(e.get(t));if(i.call(s,r))return a(e.get(r));e!==s&&e.get(t)}function js(e,t=!1){const n=this.__v_raw,o=ie(n),s=ie(e);return t||(e!==s&&Je(o,"has",e),Je(o,"has",s)),e===s?n.has(e):n.has(e)||n.has(s)}function Is(e,t=!1){return e=e.__v_raw,!t&&Je(ie(e),"iterate",Dn),Reflect.get(e,"size",e)}function Ma(e){e=ie(e);const t=ie(this);return $r(t).has.call(t,e)||(t.add(e),Xt(t,"add",e,e)),this}function Fa(e,t){t=ie(t);const n=ie(this),{has:o,get:s}=$r(n);let r=o.call(n,e);r||(e=ie(e),r=o.call(n,e));const i=s.call(n,e);return n.set(e,t),r?ts(t,i)&&Xt(n,"set",e,t):Xt(n,"add",e,t),this}function Na(e){const t=ie(this),{has:n,get:o}=$r(t);let s=n.call(t,e);s||(e=ie(e),s=n.call(t,e)),o&&o.call(t,e);const r=t.delete(e);return s&&Xt(t,"delete",e,void 0),r}function La(){const e=ie(this),t=e.size!==0,n=e.clear();return t&&Xt(e,"clear",void 0,void 0),n}function Ts(e,t){return function(o,s){const r=this,i=r.__v_raw,a=ie(i),l=t?jl:e?El:ns;return!e&&Je(a,"iterate",Dn),i.forEach((d,c)=>o.call(s,l(d),l(c),r))}}function Es(e,t,n){return function(...o){const s=this.__v_raw,r=ie(s),i=oo(r),a=e==="entries"||e===Symbol.iterator&&i,l=e==="keys"&&i,d=s[e](...o),c=n?jl:t?El:ns;return!t&&Je(r,"iterate",l?Ai:Dn),{next(){const{value:p,done:f}=d.next();return f?{value:p,done:f}:{value:a?[c(p[0]),c(p[1])]:c(p),done:f}},[Symbol.iterator](){return this}}}}function tn(e){return function(...t){return e==="delete"?!1:this}}function Lh(){const e={get(r){return xs(this,r)},get size(){return Is(this)},has:js,add:Ma,set:Fa,delete:Na,clear:La,forEach:Ts(!1,!1)},t={get(r){return xs(this,r,!1,!0)},get size(){return Is(this)},has:js,add:Ma,set:Fa,delete:Na,clear:La,forEach:Ts(!1,!0)},n={get(r){return xs(this,r,!0)},get size(){return Is(this,!0)},has(r){return js.call(this,r,!0)},add:tn("add"),set:tn("set"),delete:tn("delete"),clear:tn("clear"),forEach:Ts(!0,!1)},o={get(r){return xs(this,r,!0,!0)},get size(){return Is(this,!0)},has(r){return js.call(this,r,!0)},add:tn("add"),set:tn("set"),delete:tn("delete"),clear:tn("clear"),forEach:Ts(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=Es(r,!1,!1),n[r]=Es(r,!0,!1),t[r]=Es(r,!1,!0),o[r]=Es(r,!0,!0)}),[e,n,t,o]}const[Uh,Vh,Wh,zh]=Lh();function Il(e,t){const n=t?e?zh:Wh:e?Vh:Uh;return(o,s,r)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?o:Reflect.get(re(n,s)&&s in o?n:o,s,r)}const Gh={get:Il(!1,!1)},qh={get:Il(!1,!0)},Xh={get:Il(!0,!1)},Iu=new WeakMap,Tu=new WeakMap,Eu=new WeakMap,Kh=new WeakMap;function Yh(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Jh(e){return e.__v_skip||!Object.isExtensible(e)?0:Yh(vh(e))}function Kt(e){return uo(e)?e:Tl(e,!1,ju,Gh,Iu)}function Zh(e){return Tl(e,!1,Nh,qh,Tu)}function Bu(e){return Tl(e,!0,Fh,Xh,Eu)}function Tl(e,t,n,o,s){if(!be(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=s.get(e);if(r)return r;const i=Jh(e);if(i===0)return e;const a=new Proxy(e,i===2?o:n);return s.set(e,a),a}function ro(e){return uo(e)?ro(e.__v_raw):!!(e&&e.__v_isReactive)}function uo(e){return!!(e&&e.__v_isReadonly)}function Qs(e){return!!(e&&e.__v_isShallow)}function Au(e){return ro(e)||uo(e)}function ie(e){const t=e&&e.__v_raw;return t?ie(t):e}function Cr(e){return Js(e,"__v_skip",!0),e}const ns=e=>be(e)?Kt(e):e,El=e=>be(e)?Bu(e):e;function Du(e){gn&&bt&&(e=ie(e),ku(e.dep||(e.dep=kl())))}function Ru(e,t){e=ie(e);const n=e.dep;n&&Di(n)}function We(e){return!!(e&&e.__v_isRef===!0)}function io(e){return Qh(e,!1)}function Qh(e,t){return We(e)?e:new eg(e,t)}class eg{constructor(t,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?t:ie(t),this._value=n?t:ns(t)}get value(){return Du(this),this._value}set value(t){const n=this.__v_isShallow||Qs(t)||uo(t);t=n?t:ie(t),ts(t,this._rawValue)&&(this._rawValue=t,this._value=n?t:ns(t),Ru(this))}}function tg(e){return We(e)?e.value:e}const ng={get:(e,t,n)=>tg(Reflect.get(e,t,n)),set:(e,t,n,o)=>{const s=e[t];return We(s)&&!We(n)?(s.value=n,!0):Reflect.set(e,t,n,o)}};function Hu(e){return ro(e)?e:new Proxy(e,ng)}var Mu;class og{constructor(t,n,o,s){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[Mu]=!1,this._dirty=!0,this.effect=new Ol(t,()=>{this._dirty||(this._dirty=!0,Ru(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=o}get value(){const t=ie(this);return Du(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}Mu="__v_isReadonly";function sg(e,t,n=!1){let o,s;const r=Z(e);return r?(o=e,s=yt):(o=e.get,s=e.set),new og(o,s,r||!s,n)}function mn(e,t,n,o){let s;try{s=o?e(...o):e()}catch(r){fs(r,t,n)}return s}function ct(e,t,n,o){if(Z(e)){const r=mn(e,t,n,o);return r&&yu(r)&&r.catch(i=>{fs(i,t,n)}),r}const s=[];for(let r=0;r<e.length;r++)s.push(ct(e[r],t,n,o));return s}function fs(e,t,n,o=!0){const s=t?t.vnode:null;if(t){let r=t.parent;const i=t.proxy,a=n;for(;r;){const d=r.ec;if(d){for(let c=0;c<d.length;c++)if(d[c](e,i,a)===!1)return}r=r.parent}const l=t.appContext.config.errorHandler;if(l){mn(l,null,10,[e,i,a]);return}}rg(e,n,s,o)}function rg(e,t,n,o=!0){console.error(e)}let os=!1,Ri=!1;const Ve=[];let Tt=0;const lo=[];let Gt=null,En=0;const Fu=Promise.resolve();let Bl=null;function ig(e){const t=Bl||Fu;return e?t.then(this?e.bind(this):e):t}function lg(e){let t=Tt+1,n=Ve.length;for(;t<n;){const o=t+n>>>1;ss(Ve[o])<e?t=o+1:n=o}return t}function Pr(e){(!Ve.length||!Ve.includes(e,os&&e.allowRecurse?Tt+1:Tt))&&(e.id==null?Ve.push(e):Ve.splice(lg(e.id),0,e),Nu())}function Nu(){!os&&!Ri&&(Ri=!0,Bl=Fu.then(Uu))}function ag(e){const t=Ve.indexOf(e);t>Tt&&Ve.splice(t,1)}function dg(e){z(e)?lo.push(...e):(!Gt||!Gt.includes(e,e.allowRecurse?En+1:En))&&lo.push(e),Nu()}function Ua(e,t=os?Tt+1:0){for(;t<Ve.length;t++){const n=Ve[t];n&&n.pre&&(Ve.splice(t,1),t--,n())}}function Lu(e){if(lo.length){const t=[...new Set(lo)];if(lo.length=0,Gt){Gt.push(...t);return}for(Gt=t,Gt.sort((n,o)=>ss(n)-ss(o)),En=0;En<Gt.length;En++)Gt[En]();Gt=null,En=0}}const ss=e=>e.id==null?1/0:e.id,cg=(e,t)=>{const n=ss(e)-ss(t);if(n===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return n};function Uu(e){Ri=!1,os=!0,Ve.sort(cg);const t=yt;try{for(Tt=0;Tt<Ve.length;Tt++){const n=Ve[Tt];n&&n.active!==!1&&mn(n,null,14)}}finally{Tt=0,Ve.length=0,Lu(),os=!1,Bl=null,(Ve.length||lo.length)&&Uu()}}function ug(e,t,...n){if(e.isUnmounted)return;const o=e.vnode.props||we;let s=n;const r=t.startsWith("update:"),i=r&&t.slice(7);if(i&&i in o){const c=`${i==="modelValue"?"model":i}Modifiers`,{number:p,trim:f}=o[c]||we;f&&(s=n.map(b=>xe(b)?b.trim():b)),p&&(s=n.map(Zs))}let a,l=o[a=Zr(t)]||o[a=Zr(Dt(t))];!l&&r&&(l=o[a=Zr(Nn(t))]),l&&ct(l,e,6,s);const d=o[a+"Once"];if(d){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,ct(d,e,6,s)}}function Vu(e,t,n=!1){const o=t.emitsCache,s=o.get(e);if(s!==void 0)return s;const r=e.emits;let i={},a=!1;if(!Z(e)){const l=d=>{const c=Vu(d,t,!0);c&&(a=!0,He(i,c))};!n&&t.mixins.length&&t.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!r&&!a?(be(e)&&o.set(e,null),null):(z(r)?r.forEach(l=>i[l]=null):He(i,r),be(e)&&o.set(e,i),i)}function Sr(e,t){return!e||!yr(t)?!1:(t=t.slice(2).replace(/Once$/,""),re(e,t[0].toLowerCase()+t.slice(1))||re(e,Nn(t))||re(e,t))}let Ne=null,kr=null;function er(e){const t=Ne;return Ne=e,kr=e&&e.type.__scopeId||null,t}function ze(e){kr=e}function Ge(){kr=null}function B(e,t=Ne,n){if(!t||e._n)return e;const o=(...s)=>{o._d&&ed(-1);const r=er(t);let i;try{i=e(...s)}finally{er(r),o._d&&ed(1)}return i};return o._n=!0,o._c=!0,o._d=!0,o}function Qr(e){const{type:t,vnode:n,proxy:o,withProxy:s,props:r,propsOptions:[i],slots:a,attrs:l,emit:d,render:c,renderCache:p,data:f,setupState:b,ctx:v,inheritAttrs:w}=e;let H,D;const $=er(e);try{if(n.shapeFlag&4){const j=s||o;H=It(c.call(j,j,p,r,b,f,v)),D=l}else{const j=t;H=It(j.length>1?j(r,{attrs:l,slots:a,emit:d}):j(r,null)),D=t.props?l:pg(l)}}catch(j){Yo.length=0,fs(j,e,1),H=C(ut)}let x=H;if(D&&w!==!1){const j=Object.keys(D),{shapeFlag:K}=x;j.length&&K&7&&(i&&j.some(Cl)&&(D=fg(D,i)),x=Yt(x,D))}return n.dirs&&(x=Yt(x),x.dirs=x.dirs?x.dirs.concat(n.dirs):n.dirs),n.transition&&(x.transition=n.transition),H=x,er($),H}const pg=e=>{let t;for(const n in e)(n==="class"||n==="style"||yr(n))&&((t||(t={}))[n]=e[n]);return t},fg=(e,t)=>{const n={};for(const o in e)(!Cl(o)||!(o.slice(9)in t))&&(n[o]=e[o]);return n};function hg(e,t,n){const{props:o,children:s,component:r}=e,{props:i,children:a,patchFlag:l}=t,d=r.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return o?Va(o,i,d):!!i;if(l&8){const c=t.dynamicProps;for(let p=0;p<c.length;p++){const f=c[p];if(i[f]!==o[f]&&!Sr(d,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:o===i?!1:o?i?Va(o,i,d):!0:!!i;return!1}function Va(e,t,n){const o=Object.keys(t);if(o.length!==Object.keys(e).length)return!0;for(let s=0;s<o.length;s++){const r=o[s];if(t[r]!==e[r]&&!Sr(n,r))return!0}return!1}function gg({vnode:e,parent:t},n){for(;t&&t.subTree===e;)(e=t.vnode).el=n,t=t.parent}const Wu=e=>e.__isSuspense;function mg(e,t){t&&t.pendingBranch?z(e)?t.effects.push(...e):t.effects.push(e):dg(e)}function bg(e,t){if(Oe){let n=Oe.provides;const o=Oe.parent&&Oe.parent.provides;o===n&&(n=Oe.provides=Object.create(o)),n[e]=t}}function Vs(e,t,n=!1){const o=Oe||Ne;if(o){const s=o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides;if(s&&e in s)return s[e];if(arguments.length>1)return n&&Z(t)?t.call(o.proxy):t}}const Bs={};function Rn(e,t,n){return zu(e,t,n)}function zu(e,t,{immediate:n,deep:o,flush:s,onTrack:r,onTrigger:i}=we){const a=Sh()===(Oe==null?void 0:Oe.scope)?Oe:null;let l,d=!1,c=!1;if(We(e)?(l=()=>e.value,d=Qs(e)):ro(e)?(l=()=>e,o=!0):z(e)?(c=!0,d=e.some(x=>ro(x)||Qs(x)),l=()=>e.map(x=>{if(We(x))return x.value;if(ro(x))return An(x);if(Z(x))return mn(x,a,2)})):Z(e)?t?l=()=>mn(e,a,2):l=()=>{if(!(a&&a.isUnmounted))return p&&p(),ct(e,a,3,[f])}:l=yt,t&&o){const x=l;l=()=>An(x())}let p,f=x=>{p=D.onStop=()=>{mn(x,a,4)}},b;if(ho)if(f=yt,t?n&&ct(t,a,3,[l(),c?[]:void 0,f]):l(),s==="sync"){const x=fm();b=x.__watcherHandles||(x.__watcherHandles=[])}else return yt;let v=c?new Array(e.length).fill(Bs):Bs;const w=()=>{if(!!D.active)if(t){const x=D.run();(o||d||(c?x.some((j,K)=>ts(j,v[K])):ts(x,v)))&&(p&&p(),ct(t,a,3,[x,v===Bs?void 0:c&&v[0]===Bs?[]:v,f]),v=x)}else D.run()};w.allowRecurse=!!t;let H;s==="sync"?H=w:s==="post"?H=()=>Me(w,a&&a.suspense):(w.pre=!0,a&&(w.id=a.uid),H=()=>Pr(w));const D=new Ol(l,H);t?n?w():v=D.run():s==="post"?Me(D.run.bind(D),a&&a.suspense):D.run();const $=()=>{D.stop(),a&&a.scope&&Pl(a.scope.effects,D)};return b&&b.push($),$}function vg(e,t,n){const o=this.proxy,s=xe(e)?e.includes(".")?Gu(o,e):()=>o[e]:e.bind(o,o);let r;Z(t)?r=t:(r=t.handler,n=t);const i=Oe;fo(this);const a=zu(s,r.bind(o),n);return i?fo(i):Hn(),a}function Gu(e,t){const n=t.split(".");return()=>{let o=e;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}function An(e,t){if(!be(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),We(e))An(e.value,t);else if(z(e))for(let n=0;n<e.length;n++)An(e[n],t);else if(Co(e)||oo(e))e.forEach(n=>{An(n,t)});else if(wu(e))for(const n in e)An(e[n],t);return e}function qu(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Dl(()=>{e.isMounted=!0}),Hl(()=>{e.isUnmounting=!0}),e}const rt=[Function,Array],yg={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:rt,onEnter:rt,onAfterEnter:rt,onEnterCancelled:rt,onBeforeLeave:rt,onLeave:rt,onAfterLeave:rt,onLeaveCancelled:rt,onBeforeAppear:rt,onAppear:rt,onAfterAppear:rt,onAppearCancelled:rt},setup(e,{slots:t}){const n=Ul(),o=qu();let s;return()=>{const r=t.default&&Al(t.default(),!0);if(!r||!r.length)return;let i=r[0];if(r.length>1){for(const w of r)if(w.type!==ut){i=w;break}}const a=ie(e),{mode:l}=a;if(o.isLeaving)return ei(i);const d=Wa(i);if(!d)return ei(i);const c=rs(d,a,o,n);po(d,c);const p=n.subTree,f=p&&Wa(p);let b=!1;const{getTransitionKey:v}=d.type;if(v){const w=v();s===void 0?s=w:w!==s&&(s=w,b=!0)}if(f&&f.type!==ut&&(!pn(d,f)||b)){const w=rs(f,a,o,n);if(po(f,w),l==="out-in")return o.isLeaving=!0,w.afterLeave=()=>{o.isLeaving=!1,n.update.active!==!1&&n.update()},ei(i);l==="in-out"&&d.type!==ut&&(w.delayLeave=(H,D,$)=>{const x=Xu(o,f);x[String(f.key)]=f,H._leaveCb=()=>{D(),H._leaveCb=void 0,delete c.delayedLeave},c.delayedLeave=$})}return i}}},_g=yg;function Xu(e,t){const{leavingVNodes:n}=e;let o=n.get(t.type);return o||(o=Object.create(null),n.set(t.type,o)),o}function rs(e,t,n,o){const{appear:s,mode:r,persisted:i=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:d,onEnterCancelled:c,onBeforeLeave:p,onLeave:f,onAfterLeave:b,onLeaveCancelled:v,onBeforeAppear:w,onAppear:H,onAfterAppear:D,onAppearCancelled:$}=t,x=String(e.key),j=Xu(n,e),K=(N,oe)=>{N&&ct(N,o,9,oe)},Q=(N,oe)=>{const te=oe[1];K(N,oe),z(N)?N.every(he=>he.length<=1)&&te():N.length<=1&&te()},le={mode:r,persisted:i,beforeEnter(N){let oe=a;if(!n.isMounted)if(s)oe=w||a;else return;N._leaveCb&&N._leaveCb(!0);const te=j[x];te&&pn(e,te)&&te.el._leaveCb&&te.el._leaveCb(),K(oe,[N])},enter(N){let oe=l,te=d,he=c;if(!n.isMounted)if(s)oe=H||l,te=D||d,he=$||c;else return;let M=!1;const ve=N._enterCb=Ue=>{M||(M=!0,Ue?K(he,[N]):K(te,[N]),le.delayedLeave&&le.delayedLeave(),N._enterCb=void 0)};oe?Q(oe,[N,ve]):ve()},leave(N,oe){const te=String(e.key);if(N._enterCb&&N._enterCb(!0),n.isUnmounting)return oe();K(p,[N]);let he=!1;const M=N._leaveCb=ve=>{he||(he=!0,oe(),ve?K(v,[N]):K(b,[N]),N._leaveCb=void 0,j[te]===e&&delete j[te])};j[te]=e,f?Q(f,[N,M]):M()},clone(N){return rs(N,t,n,o)}};return le}function ei(e){if(hs(e))return e=Yt(e),e.children=null,e}function Wa(e){return hs(e)?e.children?e.children[0]:void 0:e}function po(e,t){e.shapeFlag&6&&e.component?po(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Al(e,t=!1,n){let o=[],s=0;for(let r=0;r<e.length;r++){let i=e[r];const a=n==null?i.key:String(n)+String(i.key!=null?i.key:r);i.type===U?(i.patchFlag&128&&s++,o=o.concat(Al(i.children,t,a))):(t||i.type!==ut)&&o.push(a!=null?Yt(i,{key:a}):i)}if(s>1)for(let r=0;r<o.length;r++)o[r].patchFlag=-2;return o}function ee(e){return Z(e)?{setup:e,name:e.name}:e}const ao=e=>!!e.type.__asyncLoader;function za(e){Z(e)&&(e={loader:e});const{loader:t,loadingComponent:n,errorComponent:o,delay:s=200,timeout:r,suspensible:i=!0,onError:a}=e;let l=null,d,c=0;const p=()=>(c++,l=null,f()),f=()=>{let b;return l||(b=l=t().catch(v=>{if(v=v instanceof Error?v:new Error(String(v)),a)return new Promise((w,H)=>{a(v,()=>w(p()),()=>H(v),c+1)});throw v}).then(v=>b!==l&&l?l:(v&&(v.__esModule||v[Symbol.toStringTag]==="Module")&&(v=v.default),d=v,v)))};return ee({name:"AsyncComponentWrapper",__asyncLoader:f,get __asyncResolved(){return d},setup(){const b=Oe;if(d)return()=>ti(d,b);const v=$=>{l=null,fs($,b,13,!o)};if(i&&b.suspense||ho)return f().then($=>()=>ti($,b)).catch($=>(v($),()=>o?C(o,{error:$}):null));const w=io(!1),H=io(),D=io(!!s);return s&&setTimeout(()=>{D.value=!1},s),r!=null&&setTimeout(()=>{if(!w.value&&!H.value){const $=new Error(`Async component timed out after ${r}ms.`);v($),H.value=$}},r),f().then(()=>{w.value=!0,b.parent&&hs(b.parent.vnode)&&Pr(b.parent.update)}).catch($=>{v($),H.value=$}),()=>{if(w.value&&d)return ti(d,b);if(H.value&&o)return C(o,{error:H.value});if(n&&!D.value)return C(n)}}})}function ti(e,t){const{ref:n,props:o,children:s,ce:r}=t.vnode,i=C(e,o,s);return i.ref=n,i.ce=r,delete t.vnode.ce,i}const hs=e=>e.type.__isKeepAlive,wg={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){const n=Ul(),o=n.ctx;if(!o.renderer)return()=>{const $=t.default&&t.default();return $&&$.length===1?$[0]:$};const s=new Map,r=new Set;let i=null;const a=n.suspense,{renderer:{p:l,m:d,um:c,o:{createElement:p}}}=o,f=p("div");o.activate=($,x,j,K,Q)=>{const le=$.component;d($,x,j,0,a),l(le.vnode,$,x,j,le,a,K,$.slotScopeIds,Q),Me(()=>{le.isDeactivated=!1,le.a&&so(le.a);const N=$.props&&$.props.onVnodeMounted;N&&it(N,le.parent,$)},a)},o.deactivate=$=>{const x=$.component;d($,f,null,1,a),Me(()=>{x.da&&so(x.da);const j=$.props&&$.props.onVnodeUnmounted;j&&it(j,x.parent,$),x.isDeactivated=!0},a)};function b($){ni($),c($,n,a,!0)}function v($){s.forEach((x,j)=>{const K=Vi(x.type);K&&(!$||!$(K))&&w(j)})}function w($){const x=s.get($);!i||!pn(x,i)?b(x):i&&ni(i),s.delete($),r.delete($)}Rn(()=>[e.include,e.exclude],([$,x])=>{$&&v(j=>zo($,j)),x&&v(j=>!zo(x,j))},{flush:"post",deep:!0});let H=null;const D=()=>{H!=null&&s.set(H,oi(n.subTree))};return Dl(D),Rl(D),Hl(()=>{s.forEach($=>{const{subTree:x,suspense:j}=n,K=oi(x);if($.type===K.type&&$.key===K.key){ni(K);const Q=K.component.da;Q&&Me(Q,j);return}b($)})}),()=>{if(H=null,!t.default)return null;const $=t.default(),x=$[0];if($.length>1)return i=null,$;if(!ls(x)||!(x.shapeFlag&4)&&!(x.shapeFlag&128))return i=null,x;let j=oi(x);const K=j.type,Q=Vi(ao(j)?j.type.__asyncResolved||{}:K),{include:le,exclude:N,max:oe}=e;if(le&&(!Q||!zo(le,Q))||N&&Q&&zo(N,Q))return i=j,x;const te=j.key==null?K:j.key,he=s.get(te);return j.el&&(j=Yt(j),x.shapeFlag&128&&(x.ssContent=j)),H=te,he?(j.el=he.el,j.component=he.component,j.transition&&po(j,j.transition),j.shapeFlag|=512,r.delete(te),r.add(te)):(r.add(te),oe&&r.size>parseInt(oe,10)&&w(r.values().next().value)),j.shapeFlag|=256,i=j,Wu(x.type)?x:j}}},$g=wg;function zo(e,t){return z(e)?e.some(n=>zo(n,t)):xe(e)?e.split(",").includes(t):bh(e)?e.test(t):!1}function Cg(e,t){Ku(e,"a",t)}function Pg(e,t){Ku(e,"da",t)}function Ku(e,t,n=Oe){const o=e.__wdc||(e.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(Or(t,o,n),n){let s=n.parent;for(;s&&s.parent;)hs(s.parent.vnode)&&Sg(o,t,n,s),s=s.parent}}function Sg(e,t,n,o){const s=Or(t,e,o,!0);Yu(()=>{Pl(o[t],s)},n)}function ni(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function oi(e){return e.shapeFlag&128?e.ssContent:e}function Or(e,t,n=Oe,o=!1){if(n){const s=n[e]||(n[e]=[]),r=t.__weh||(t.__weh=(...i)=>{if(n.isUnmounted)return;So(),fo(n);const a=ct(t,n,e,i);return Hn(),ko(),a});return o?s.unshift(r):s.push(r),r}}const Zt=e=>(t,n=Oe)=>(!ho||e==="sp")&&Or(e,(...o)=>t(...o),n),kg=Zt("bm"),Dl=Zt("m"),Og=Zt("bu"),Rl=Zt("u"),Hl=Zt("bum"),Yu=Zt("um"),xg=Zt("sp"),jg=Zt("rtg"),Ig=Zt("rtc");function Tg(e,t=Oe){Or("ec",e,t)}function de(e,t){const n=Ne;if(n===null)return e;const o=Ir(n)||n.proxy,s=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[i,a,l,d=we]=t[r];i&&(Z(i)&&(i={mounted:i,updated:i}),i.deep&&An(a),s.push({dir:i,instance:o,value:a,oldValue:void 0,arg:l,modifiers:d}))}return e}function Sn(e,t,n,o){const s=e.dirs,r=t&&t.dirs;for(let i=0;i<s.length;i++){const a=s[i];r&&(a.oldValue=r[i].value);let l=a.dir[o];l&&(So(),ct(l,n,8,[e.el,a,e,t]),ko())}}const Ju="components";function E(e,t){return Bg(Ju,e,!0,t)||e}const Eg=Symbol();function Bg(e,t,n=!0,o=!1){const s=Ne||Oe;if(s){const r=s.type;if(e===Ju){const a=Vi(r,!1);if(a&&(a===t||a===Dt(t)||a===wr(Dt(t))))return r}const i=Ga(s[e]||r[e],t)||Ga(s.appContext[e],t);return!i&&o?r:i}}function Ga(e,t){return e&&(e[t]||e[Dt(t)]||e[wr(Dt(t))])}function $e(e,t,n,o){let s;const r=n&&n[o];if(z(e)||xe(e)){s=new Array(e.length);for(let i=0,a=e.length;i<a;i++)s[i]=t(e[i],i,void 0,r&&r[i])}else if(typeof e=="number"){s=new Array(e);for(let i=0;i<e;i++)s[i]=t(i+1,i,void 0,r&&r[i])}else if(be(e))if(e[Symbol.iterator])s=Array.from(e,(i,a)=>t(i,a,void 0,r&&r[a]));else{const i=Object.keys(e);s=new Array(i.length);for(let a=0,l=i.length;a<l;a++){const d=i[a];s[a]=t(e[d],d,a,r&&r[a])}}else s=[];return n&&(n[o]=s),s}function qt(e,t,n={},o,s){if(Ne.isCE||Ne.parent&&ao(Ne.parent)&&Ne.parent.isCE)return t!=="default"&&(n.name=t),C("slot",n,o&&o());let r=e[t];r&&r._c&&(r._d=!1),g();const i=r&&Zu(r(n)),a=L(U,{key:n.key||i&&i.key||`_${t}`},i||(o?o():[]),i&&e._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function Zu(e){return e.some(t=>ls(t)?!(t.type===ut||t.type===U&&!Zu(t.children)):!0)?e:null}const Hi=e=>e?cp(e)?Ir(e)||e.proxy:Hi(e.parent):null,Xo=He(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Hi(e.parent),$root:e=>Hi(e.root),$emit:e=>e.emit,$options:e=>Ml(e),$forceUpdate:e=>e.f||(e.f=()=>Pr(e.update)),$nextTick:e=>e.n||(e.n=ig.bind(e.proxy)),$watch:e=>vg.bind(e)}),si=(e,t)=>e!==we&&!e.__isScriptSetup&&re(e,t),Ag={get({_:e},t){const{ctx:n,setupState:o,data:s,props:r,accessCache:i,type:a,appContext:l}=e;let d;if(t[0]!=="$"){const b=i[t];if(b!==void 0)switch(b){case 1:return o[t];case 2:return s[t];case 4:return n[t];case 3:return r[t]}else{if(si(o,t))return i[t]=1,o[t];if(s!==we&&re(s,t))return i[t]=2,s[t];if((d=e.propsOptions[0])&&re(d,t))return i[t]=3,r[t];if(n!==we&&re(n,t))return i[t]=4,n[t];Mi&&(i[t]=0)}}const c=Xo[t];let p,f;if(c)return t==="$attrs"&&Je(e,"get",t),c(e);if((p=a.__cssModules)&&(p=p[t]))return p;if(n!==we&&re(n,t))return i[t]=4,n[t];if(f=l.config.globalProperties,re(f,t))return f[t]},set({_:e},t,n){const{data:o,setupState:s,ctx:r}=e;return si(s,t)?(s[t]=n,!0):o!==we&&re(o,t)?(o[t]=n,!0):re(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:o,appContext:s,propsOptions:r}},i){let a;return!!n[i]||e!==we&&re(e,i)||si(t,i)||(a=r[0])&&re(a,i)||re(o,i)||re(Xo,i)||re(s.config.globalProperties,i)},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:re(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};let Mi=!0;function Dg(e){const t=Ml(e),n=e.proxy,o=e.ctx;Mi=!1,t.beforeCreate&&qa(t.beforeCreate,e,"bc");const{data:s,computed:r,methods:i,watch:a,provide:l,inject:d,created:c,beforeMount:p,mounted:f,beforeUpdate:b,updated:v,activated:w,deactivated:H,beforeDestroy:D,beforeUnmount:$,destroyed:x,unmounted:j,render:K,renderTracked:Q,renderTriggered:le,errorCaptured:N,serverPrefetch:oe,expose:te,inheritAttrs:he,components:M,directives:ve,filters:Ue}=t;if(d&&Rg(d,o,null,e.appContext.config.unwrapInjectedRef),i)for(const Se in i){const ye=i[Se];Z(ye)&&(o[Se]=ye.bind(n))}if(s){const Se=s.call(n,n);be(Se)&&(e.data=Kt(Se))}if(Mi=!0,r)for(const Se in r){const ye=r[Se],Cn=Z(ye)?ye.bind(n,n):Z(ye.get)?ye.get.bind(n,n):yt,ks=!Z(ye)&&Z(ye.set)?ye.set.bind(n):yt,Pn=nr({get:Cn,set:ks});Object.defineProperty(o,Se,{enumerable:!0,configurable:!0,get:()=>Pn.value,set:Pt=>Pn.value=Pt})}if(a)for(const Se in a)Qu(a[Se],o,n,Se);if(l){const Se=Z(l)?l.call(n):l;Reflect.ownKeys(Se).forEach(ye=>{bg(ye,Se[ye])})}c&&qa(c,e,"c");function Ce(Se,ye){z(ye)?ye.forEach(Cn=>Se(Cn.bind(n))):ye&&Se(ye.bind(n))}if(Ce(kg,p),Ce(Dl,f),Ce(Og,b),Ce(Rl,v),Ce(Cg,w),Ce(Pg,H),Ce(Tg,N),Ce(Ig,Q),Ce(jg,le),Ce(Hl,$),Ce(Yu,j),Ce(xg,oe),z(te))if(te.length){const Se=e.exposed||(e.exposed={});te.forEach(ye=>{Object.defineProperty(Se,ye,{get:()=>n[ye],set:Cn=>n[ye]=Cn})})}else e.exposed||(e.exposed={});K&&e.render===yt&&(e.render=K),he!=null&&(e.inheritAttrs=he),M&&(e.components=M),ve&&(e.directives=ve)}function Rg(e,t,n=yt,o=!1){z(e)&&(e=Fi(e));for(const s in e){const r=e[s];let i;be(r)?"default"in r?i=Vs(r.from||s,r.default,!0):i=Vs(r.from||s):i=Vs(r),We(i)&&o?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):t[s]=i}}function qa(e,t,n){ct(z(e)?e.map(o=>o.bind(t.proxy)):e.bind(t.proxy),t,n)}function Qu(e,t,n,o){const s=o.includes(".")?Gu(n,o):()=>n[o];if(xe(e)){const r=t[e];Z(r)&&Rn(s,r)}else if(Z(e))Rn(s,e.bind(n));else if(be(e))if(z(e))e.forEach(r=>Qu(r,t,n,o));else{const r=Z(e.handler)?e.handler.bind(n):t[e.handler];Z(r)&&Rn(s,r,e)}}function Ml(e){const t=e.type,{mixins:n,extends:o}=t,{mixins:s,optionsCache:r,config:{optionMergeStrategies:i}}=e.appContext,a=r.get(t);let l;return a?l=a:!s.length&&!n&&!o?l=t:(l={},s.length&&s.forEach(d=>tr(l,d,i,!0)),tr(l,t,i)),be(t)&&r.set(t,l),l}function tr(e,t,n,o=!1){const{mixins:s,extends:r}=t;r&&tr(e,r,n,!0),s&&s.forEach(i=>tr(e,i,n,!0));for(const i in t)if(!(o&&i==="expose")){const a=Hg[i]||n&&n[i];e[i]=a?a(e[i],t[i]):t[i]}return e}const Hg={data:Xa,props:Tn,emits:Tn,methods:Tn,computed:Tn,beforeCreate:Xe,created:Xe,beforeMount:Xe,mounted:Xe,beforeUpdate:Xe,updated:Xe,beforeDestroy:Xe,beforeUnmount:Xe,destroyed:Xe,unmounted:Xe,activated:Xe,deactivated:Xe,errorCaptured:Xe,serverPrefetch:Xe,components:Tn,directives:Tn,watch:Fg,provide:Xa,inject:Mg};function Xa(e,t){return t?e?function(){return He(Z(e)?e.call(this,this):e,Z(t)?t.call(this,this):t)}:t:e}function Mg(e,t){return Tn(Fi(e),Fi(t))}function Fi(e){if(z(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function Xe(e,t){return e?[...new Set([].concat(e,t))]:t}function Tn(e,t){return e?He(He(Object.create(null),e),t):t}function Fg(e,t){if(!e)return t;if(!t)return e;const n=He(Object.create(null),e);for(const o in t)n[o]=Xe(e[o],t[o]);return n}function Ng(e,t,n,o=!1){const s={},r={};Js(r,jr,1),e.propsDefaults=Object.create(null),ep(e,t,s,r);for(const i in e.propsOptions[0])i in s||(s[i]=void 0);n?e.props=o?s:Zh(s):e.type.props?e.props=s:e.props=r,e.attrs=r}function Lg(e,t,n,o){const{props:s,attrs:r,vnode:{patchFlag:i}}=e,a=ie(s),[l]=e.propsOptions;let d=!1;if((o||i>0)&&!(i&16)){if(i&8){const c=e.vnode.dynamicProps;for(let p=0;p<c.length;p++){let f=c[p];if(Sr(e.emitsOptions,f))continue;const b=t[f];if(l)if(re(r,f))b!==r[f]&&(r[f]=b,d=!0);else{const v=Dt(f);s[v]=Ni(l,a,v,b,e,!1)}else b!==r[f]&&(r[f]=b,d=!0)}}}else{ep(e,t,s,r)&&(d=!0);let c;for(const p in a)(!t||!re(t,p)&&((c=Nn(p))===p||!re(t,c)))&&(l?n&&(n[p]!==void 0||n[c]!==void 0)&&(s[p]=Ni(l,a,p,void 0,e,!0)):delete s[p]);if(r!==a)for(const p in r)(!t||!re(t,p)&&!0)&&(delete r[p],d=!0)}d&&Xt(e,"set","$attrs")}function ep(e,t,n,o){const[s,r]=e.propsOptions;let i=!1,a;if(t)for(let l in t){if(Us(l))continue;const d=t[l];let c;s&&re(s,c=Dt(l))?!r||!r.includes(c)?n[c]=d:(a||(a={}))[c]=d:Sr(e.emitsOptions,l)||(!(l in o)||d!==o[l])&&(o[l]=d,i=!0)}if(r){const l=ie(n),d=a||we;for(let c=0;c<r.length;c++){const p=r[c];n[p]=Ni(s,l,p,d[p],e,!re(d,p))}}return i}function Ni(e,t,n,o,s,r){const i=e[n];if(i!=null){const a=re(i,"default");if(a&&o===void 0){const l=i.default;if(i.type!==Function&&Z(l)){const{propsDefaults:d}=s;n in d?o=d[n]:(fo(s),o=d[n]=l.call(null,t),Hn())}else o=l}i[0]&&(r&&!a?o=!1:i[1]&&(o===""||o===Nn(n))&&(o=!0))}return o}function tp(e,t,n=!1){const o=t.propsCache,s=o.get(e);if(s)return s;const r=e.props,i={},a=[];let l=!1;if(!Z(e)){const c=p=>{l=!0;const[f,b]=tp(p,t,!0);He(i,f),b&&a.push(...b)};!n&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!r&&!l)return be(e)&&o.set(e,no),no;if(z(r))for(let c=0;c<r.length;c++){const p=Dt(r[c]);Ka(p)&&(i[p]=we)}else if(r)for(const c in r){const p=Dt(c);if(Ka(p)){const f=r[c],b=i[p]=z(f)||Z(f)?{type:f}:Object.assign({},f);if(b){const v=Za(Boolean,b.type),w=Za(String,b.type);b[0]=v>-1,b[1]=w<0||v<w,(v>-1||re(b,"default"))&&a.push(p)}}}const d=[i,a];return be(e)&&o.set(e,d),d}function Ka(e){return e[0]!=="$"}function Ya(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function Ja(e,t){return Ya(e)===Ya(t)}function Za(e,t){return z(t)?t.findIndex(n=>Ja(n,e)):Z(t)&&Ja(t,e)?0:-1}const np=e=>e[0]==="_"||e==="$stable",Fl=e=>z(e)?e.map(It):[It(e)],Ug=(e,t,n)=>{if(t._n)return t;const o=B((...s)=>Fl(t(...s)),n);return o._c=!1,o},op=(e,t,n)=>{const o=e._ctx;for(const s in e){if(np(s))continue;const r=e[s];if(Z(r))t[s]=Ug(s,r,o);else if(r!=null){const i=Fl(r);t[s]=()=>i}}},sp=(e,t)=>{const n=Fl(t);e.slots.default=()=>n},Vg=(e,t)=>{if(e.vnode.shapeFlag&32){const n=t._;n?(e.slots=ie(t),Js(t,"_",n)):op(t,e.slots={})}else e.slots={},t&&sp(e,t);Js(e.slots,jr,1)},Wg=(e,t,n)=>{const{vnode:o,slots:s}=e;let r=!0,i=we;if(o.shapeFlag&32){const a=t._;a?n&&a===1?r=!1:(He(s,t),!n&&a===1&&delete s._):(r=!t.$stable,op(t,s)),i=t}else t&&(sp(e,t),i={default:1});if(r)for(const a in s)!np(a)&&!(a in i)&&delete s[a]};function rp(){return{app:null,config:{isNativeTag:hh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let zg=0;function Gg(e,t){return function(o,s=null){Z(o)||(o=Object.assign({},o)),s!=null&&!be(s)&&(s=null);const r=rp(),i=new Set;let a=!1;const l=r.app={_uid:zg++,_component:o,_props:s,_container:null,_context:r,_instance:null,version:hm,get config(){return r.config},set config(d){},use(d,...c){return i.has(d)||(d&&Z(d.install)?(i.add(d),d.install(l,...c)):Z(d)&&(i.add(d),d(l,...c))),l},mixin(d){return r.mixins.includes(d)||r.mixins.push(d),l},component(d,c){return c?(r.components[d]=c,l):r.components[d]},directive(d,c){return c?(r.directives[d]=c,l):r.directives[d]},mount(d,c,p){if(!a){const f=C(o,s);return f.appContext=r,c&&t?t(f,d):e(f,d,p),a=!0,l._container=d,d.__vue_app__=l,Ir(f.component)||f.component.proxy}},unmount(){a&&(e(null,l._container),delete l._container.__vue_app__)},provide(d,c){return r.provides[d]=c,l}};return l}}function Li(e,t,n,o,s=!1){if(z(e)){e.forEach((f,b)=>Li(f,t&&(z(t)?t[b]:t),n,o,s));return}if(ao(o)&&!s)return;const r=o.shapeFlag&4?Ir(o.component)||o.component.proxy:o.el,i=s?null:r,{i:a,r:l}=e,d=t&&t.r,c=a.refs===we?a.refs={}:a.refs,p=a.setupState;if(d!=null&&d!==l&&(xe(d)?(c[d]=null,re(p,d)&&(p[d]=null)):We(d)&&(d.value=null)),Z(l))mn(l,a,12,[i,c]);else{const f=xe(l),b=We(l);if(f||b){const v=()=>{if(e.f){const w=f?re(p,l)?p[l]:c[l]:l.value;s?z(w)&&Pl(w,r):z(w)?w.includes(r)||w.push(r):f?(c[l]=[r],re(p,l)&&(p[l]=c[l])):(l.value=[r],e.k&&(c[e.k]=l.value))}else f?(c[l]=i,re(p,l)&&(p[l]=i)):b&&(l.value=i,e.k&&(c[e.k]=i))};i?(v.id=-1,Me(v,n)):v()}}}const Me=mg;function qg(e){return Xg(e)}function Xg(e,t){const n=$h();n.__VUE__=!0;const{insert:o,remove:s,patchProp:r,createElement:i,createText:a,createComment:l,setText:d,setElementText:c,parentNode:p,nextSibling:f,setScopeId:b=yt,insertStaticContent:v}=e,w=(h,m,_,S=null,P=null,T=null,R=!1,I=null,A=!!m.dynamicChildren)=>{if(h===m)return;h&&!pn(h,m)&&(S=Os(h),Pt(h,P,T,!0),h=null),m.patchFlag===-2&&(A=!1,m.dynamicChildren=null);const{type:k,ref:V,shapeFlag:F}=m;switch(k){case xr:H(h,m,_,S);break;case ut:D(h,m,_,S);break;case Ws:h==null&&$(m,_,S,R);break;case U:M(h,m,_,S,P,T,R,I,A);break;default:F&1?K(h,m,_,S,P,T,R,I,A):F&6?ve(h,m,_,S,P,T,R,I,A):(F&64||F&128)&&k.process(h,m,_,S,P,T,R,I,A,Wn)}V!=null&&P&&Li(V,h&&h.ref,T,m||h,!m)},H=(h,m,_,S)=>{if(h==null)o(m.el=a(m.children),_,S);else{const P=m.el=h.el;m.children!==h.children&&d(P,m.children)}},D=(h,m,_,S)=>{h==null?o(m.el=l(m.children||""),_,S):m.el=h.el},$=(h,m,_,S)=>{[h.el,h.anchor]=v(h.children,m,_,S,h.el,h.anchor)},x=({el:h,anchor:m},_,S)=>{let P;for(;h&&h!==m;)P=f(h),o(h,_,S),h=P;o(m,_,S)},j=({el:h,anchor:m})=>{let _;for(;h&&h!==m;)_=f(h),s(h),h=_;s(m)},K=(h,m,_,S,P,T,R,I,A)=>{R=R||m.type==="svg",h==null?Q(m,_,S,P,T,R,I,A):oe(h,m,P,T,R,I,A)},Q=(h,m,_,S,P,T,R,I)=>{let A,k;const{type:V,props:F,shapeFlag:W,transition:J,dirs:se}=h;if(A=h.el=i(h.type,T,F&&F.is,F),W&8?c(A,h.children):W&16&&N(h.children,A,null,S,P,T&&V!=="foreignObject",R,I),se&&Sn(h,null,S,"created"),le(A,h,h.scopeId,R,S),F){for(const ge in F)ge!=="value"&&!Us(ge)&&r(A,ge,null,F[ge],T,h.children,S,P,Mt);"value"in F&&r(A,"value",null,F.value),(k=F.onVnodeBeforeMount)&&it(k,S,h)}se&&Sn(h,null,S,"beforeMount");const _e=(!P||P&&!P.pendingBranch)&&J&&!J.persisted;_e&&J.beforeEnter(A),o(A,m,_),((k=F&&F.onVnodeMounted)||_e||se)&&Me(()=>{k&&it(k,S,h),_e&&J.enter(A),se&&Sn(h,null,S,"mounted")},P)},le=(h,m,_,S,P)=>{if(_&&b(h,_),S)for(let T=0;T<S.length;T++)b(h,S[T]);if(P){let T=P.subTree;if(m===T){const R=P.vnode;le(h,R,R.scopeId,R.slotScopeIds,P.parent)}}},N=(h,m,_,S,P,T,R,I,A=0)=>{for(let k=A;k<h.length;k++){const V=h[k]=I?un(h[k]):It(h[k]);w(null,V,m,_,S,P,T,R,I)}},oe=(h,m,_,S,P,T,R)=>{const I=m.el=h.el;let{patchFlag:A,dynamicChildren:k,dirs:V}=m;A|=h.patchFlag&16;const F=h.props||we,W=m.props||we;let J;_&&kn(_,!1),(J=W.onVnodeBeforeUpdate)&&it(J,_,m,h),V&&Sn(m,h,_,"beforeUpdate"),_&&kn(_,!0);const se=P&&m.type!=="foreignObject";if(k?te(h.dynamicChildren,k,I,_,S,se,T):R||ye(h,m,I,null,_,S,se,T,!1),A>0){if(A&16)he(I,m,F,W,_,S,P);else if(A&2&&F.class!==W.class&&r(I,"class",null,W.class,P),A&4&&r(I,"style",F.style,W.style,P),A&8){const _e=m.dynamicProps;for(let ge=0;ge<_e.length;ge++){const je=_e[ge],ft=F[je],zn=W[je];(zn!==ft||je==="value")&&r(I,je,ft,zn,P,h.children,_,S,Mt)}}A&1&&h.children!==m.children&&c(I,m.children)}else!R&&k==null&&he(I,m,F,W,_,S,P);((J=W.onVnodeUpdated)||V)&&Me(()=>{J&&it(J,_,m,h),V&&Sn(m,h,_,"updated")},S)},te=(h,m,_,S,P,T,R)=>{for(let I=0;I<m.length;I++){const A=h[I],k=m[I],V=A.el&&(A.type===U||!pn(A,k)||A.shapeFlag&70)?p(A.el):_;w(A,k,V,null,S,P,T,R,!0)}},he=(h,m,_,S,P,T,R)=>{if(_!==S){if(_!==we)for(const I in _)!Us(I)&&!(I in S)&&r(h,I,_[I],null,R,m.children,P,T,Mt);for(const I in S){if(Us(I))continue;const A=S[I],k=_[I];A!==k&&I!=="value"&&r(h,I,k,A,R,m.children,P,T,Mt)}"value"in S&&r(h,"value",_.value,S.value)}},M=(h,m,_,S,P,T,R,I,A)=>{const k=m.el=h?h.el:a(""),V=m.anchor=h?h.anchor:a("");let{patchFlag:F,dynamicChildren:W,slotScopeIds:J}=m;J&&(I=I?I.concat(J):J),h==null?(o(k,_,S),o(V,_,S),N(m.children,_,V,P,T,R,I,A)):F>0&&F&64&&W&&h.dynamicChildren?(te(h.dynamicChildren,W,_,P,T,R,I),(m.key!=null||P&&m===P.subTree)&&Nl(h,m,!0)):ye(h,m,_,V,P,T,R,I,A)},ve=(h,m,_,S,P,T,R,I,A)=>{m.slotScopeIds=I,h==null?m.shapeFlag&512?P.ctx.activate(m,_,S,R,A):Ue(m,_,S,P,T,R,A):Ct(h,m,A)},Ue=(h,m,_,S,P,T,R)=>{const I=h.component=im(h,S,P);if(hs(h)&&(I.ctx.renderer=Wn),lm(I),I.asyncDep){if(P&&P.registerDep(I,Ce),!h.el){const A=I.subTree=C(ut);D(null,A,m,_)}return}Ce(I,h,m,_,P,T,R)},Ct=(h,m,_)=>{const S=m.component=h.component;if(hg(h,m,_))if(S.asyncDep&&!S.asyncResolved){Se(S,m,_);return}else S.next=m,ag(S.update),S.update();else m.el=h.el,S.vnode=m},Ce=(h,m,_,S,P,T,R)=>{const I=()=>{if(h.isMounted){let{next:V,bu:F,u:W,parent:J,vnode:se}=h,_e=V,ge;kn(h,!1),V?(V.el=se.el,Se(h,V,R)):V=se,F&&so(F),(ge=V.props&&V.props.onVnodeBeforeUpdate)&&it(ge,J,V,se),kn(h,!0);const je=Qr(h),ft=h.subTree;h.subTree=je,w(ft,je,p(ft.el),Os(ft),h,P,T),V.el=je.el,_e===null&&gg(h,je.el),W&&Me(W,P),(ge=V.props&&V.props.onVnodeUpdated)&&Me(()=>it(ge,J,V,se),P)}else{let V;const{el:F,props:W}=m,{bm:J,m:se,parent:_e}=h,ge=ao(m);if(kn(h,!1),J&&so(J),!ge&&(V=W&&W.onVnodeBeforeMount)&&it(V,_e,m),kn(h,!0),F&&Jr){const je=()=>{h.subTree=Qr(h),Jr(F,h.subTree,h,P,null)};ge?m.type.__asyncLoader().then(()=>!h.isUnmounted&&je()):je()}else{const je=h.subTree=Qr(h);w(null,je,_,S,h,P,T),m.el=je.el}if(se&&Me(se,P),!ge&&(V=W&&W.onVnodeMounted)){const je=m;Me(()=>it(V,_e,je),P)}(m.shapeFlag&256||_e&&ao(_e.vnode)&&_e.vnode.shapeFlag&256)&&h.a&&Me(h.a,P),h.isMounted=!0,m=_=S=null}},A=h.effect=new Ol(I,()=>Pr(k),h.scope),k=h.update=()=>A.run();k.id=h.uid,kn(h,!0),k()},Se=(h,m,_)=>{m.component=h;const S=h.vnode.props;h.vnode=m,h.next=null,Lg(h,m.props,S,_),Wg(h,m.children,_),So(),Ua(),ko()},ye=(h,m,_,S,P,T,R,I,A=!1)=>{const k=h&&h.children,V=h?h.shapeFlag:0,F=m.children,{patchFlag:W,shapeFlag:J}=m;if(W>0){if(W&128){ks(k,F,_,S,P,T,R,I,A);return}else if(W&256){Cn(k,F,_,S,P,T,R,I,A);return}}J&8?(V&16&&Mt(k,P,T),F!==k&&c(_,F)):V&16?J&16?ks(k,F,_,S,P,T,R,I,A):Mt(k,P,T,!0):(V&8&&c(_,""),J&16&&N(F,_,S,P,T,R,I,A))},Cn=(h,m,_,S,P,T,R,I,A)=>{h=h||no,m=m||no;const k=h.length,V=m.length,F=Math.min(k,V);let W;for(W=0;W<F;W++){const J=m[W]=A?un(m[W]):It(m[W]);w(h[W],J,_,null,P,T,R,I,A)}k>V?Mt(h,P,T,!0,!1,F):N(m,_,S,P,T,R,I,A,F)},ks=(h,m,_,S,P,T,R,I,A)=>{let k=0;const V=m.length;let F=h.length-1,W=V-1;for(;k<=F&&k<=W;){const J=h[k],se=m[k]=A?un(m[k]):It(m[k]);if(pn(J,se))w(J,se,_,null,P,T,R,I,A);else break;k++}for(;k<=F&&k<=W;){const J=h[F],se=m[W]=A?un(m[W]):It(m[W]);if(pn(J,se))w(J,se,_,null,P,T,R,I,A);else break;F--,W--}if(k>F){if(k<=W){const J=W+1,se=J<V?m[J].el:S;for(;k<=W;)w(null,m[k]=A?un(m[k]):It(m[k]),_,se,P,T,R,I,A),k++}}else if(k>W)for(;k<=F;)Pt(h[k],P,T,!0),k++;else{const J=k,se=k,_e=new Map;for(k=se;k<=W;k++){const Qe=m[k]=A?un(m[k]):It(m[k]);Qe.key!=null&&_e.set(Qe.key,k)}let ge,je=0;const ft=W-se+1;let zn=!1,Ia=0;const Ro=new Array(ft);for(k=0;k<ft;k++)Ro[k]=0;for(k=J;k<=F;k++){const Qe=h[k];if(je>=ft){Pt(Qe,P,T,!0);continue}let St;if(Qe.key!=null)St=_e.get(Qe.key);else for(ge=se;ge<=W;ge++)if(Ro[ge-se]===0&&pn(Qe,m[ge])){St=ge;break}St===void 0?Pt(Qe,P,T,!0):(Ro[St-se]=k+1,St>=Ia?Ia=St:zn=!0,w(Qe,m[St],_,null,P,T,R,I,A),je++)}const Ta=zn?Kg(Ro):no;for(ge=Ta.length-1,k=ft-1;k>=0;k--){const Qe=se+k,St=m[Qe],Ea=Qe+1<V?m[Qe+1].el:S;Ro[k]===0?w(null,St,_,Ea,P,T,R,I,A):zn&&(ge<0||k!==Ta[ge]?Pn(St,_,Ea,2):ge--)}}},Pn=(h,m,_,S,P=null)=>{const{el:T,type:R,transition:I,children:A,shapeFlag:k}=h;if(k&6){Pn(h.component.subTree,m,_,S);return}if(k&128){h.suspense.move(m,_,S);return}if(k&64){R.move(h,m,_,Wn);return}if(R===U){o(T,m,_);for(let F=0;F<A.length;F++)Pn(A[F],m,_,S);o(h.anchor,m,_);return}if(R===Ws){x(h,m,_);return}if(S!==2&&k&1&&I)if(S===0)I.beforeEnter(T),o(T,m,_),Me(()=>I.enter(T),P);else{const{leave:F,delayLeave:W,afterLeave:J}=I,se=()=>o(T,m,_),_e=()=>{F(T,()=>{se(),J&&J()})};W?W(T,se,_e):_e()}else o(T,m,_)},Pt=(h,m,_,S=!1,P=!1)=>{const{type:T,props:R,ref:I,children:A,dynamicChildren:k,shapeFlag:V,patchFlag:F,dirs:W}=h;if(I!=null&&Li(I,null,_,h,!0),V&256){m.ctx.deactivate(h);return}const J=V&1&&W,se=!ao(h);let _e;if(se&&(_e=R&&R.onVnodeBeforeUnmount)&&it(_e,m,h),V&6)ih(h.component,_,S);else{if(V&128){h.suspense.unmount(_,S);return}J&&Sn(h,null,m,"beforeUnmount"),V&64?h.type.remove(h,m,_,P,Wn,S):k&&(T!==U||F>0&&F&64)?Mt(k,m,_,!1,!0):(T===U&&F&384||!P&&V&16)&&Mt(A,m,_),S&&xa(h)}(se&&(_e=R&&R.onVnodeUnmounted)||J)&&Me(()=>{_e&&it(_e,m,h),J&&Sn(h,null,m,"unmounted")},_)},xa=h=>{const{type:m,el:_,anchor:S,transition:P}=h;if(m===U){rh(_,S);return}if(m===Ws){j(h);return}const T=()=>{s(_),P&&!P.persisted&&P.afterLeave&&P.afterLeave()};if(h.shapeFlag&1&&P&&!P.persisted){const{leave:R,delayLeave:I}=P,A=()=>R(_,T);I?I(h.el,T,A):A()}else T()},rh=(h,m)=>{let _;for(;h!==m;)_=f(h),s(h),h=_;s(m)},ih=(h,m,_)=>{const{bum:S,scope:P,update:T,subTree:R,um:I}=h;S&&so(S),P.stop(),T&&(T.active=!1,Pt(R,h,m,_)),I&&Me(I,m),Me(()=>{h.isUnmounted=!0},m),m&&m.pendingBranch&&!m.isUnmounted&&h.asyncDep&&!h.asyncResolved&&h.suspenseId===m.pendingId&&(m.deps--,m.deps===0&&m.resolve())},Mt=(h,m,_,S=!1,P=!1,T=0)=>{for(let R=T;R<h.length;R++)Pt(h[R],m,_,S,P)},Os=h=>h.shapeFlag&6?Os(h.component.subTree):h.shapeFlag&128?h.suspense.next():f(h.anchor||h.el),ja=(h,m,_)=>{h==null?m._vnode&&Pt(m._vnode,null,null,!0):w(m._vnode||null,h,m,null,null,null,_),Ua(),Lu(),m._vnode=h},Wn={p:w,um:Pt,m:Pn,r:xa,mt:Ue,mc:N,pc:ye,pbc:te,n:Os,o:e};let Yr,Jr;return t&&([Yr,Jr]=t(Wn)),{render:ja,hydrate:Yr,createApp:Gg(ja,Yr)}}function kn({effect:e,update:t},n){e.allowRecurse=t.allowRecurse=n}function Nl(e,t,n=!1){const o=e.children,s=t.children;if(z(o)&&z(s))for(let r=0;r<o.length;r++){const i=o[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=un(s[r]),a.el=i.el),n||Nl(i,a)),a.type===xr&&(a.el=i.el)}}function Kg(e){const t=e.slice(),n=[0];let o,s,r,i,a;const l=e.length;for(o=0;o<l;o++){const d=e[o];if(d!==0){if(s=n[n.length-1],e[s]<d){t[o]=s,n.push(o);continue}for(r=0,i=n.length-1;r<i;)a=r+i>>1,e[n[a]]<d?r=a+1:i=a;d<e[n[r]]&&(r>0&&(t[o]=n[r-1]),n[r]=o)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=t[i];return n}const Yg=e=>e.__isTeleport,Ko=e=>e&&(e.disabled||e.disabled===""),Qa=e=>typeof SVGElement!="undefined"&&e instanceof SVGElement,Ui=(e,t)=>{const n=e&&e.to;return xe(n)?t?t(n):null:n},Jg={__isTeleport:!0,process(e,t,n,o,s,r,i,a,l,d){const{mc:c,pc:p,pbc:f,o:{insert:b,querySelector:v,createText:w,createComment:H}}=d,D=Ko(t.props);let{shapeFlag:$,children:x,dynamicChildren:j}=t;if(e==null){const K=t.el=w(""),Q=t.anchor=w("");b(K,n,o),b(Q,n,o);const le=t.target=Ui(t.props,v),N=t.targetAnchor=w("");le&&(b(N,le),i=i||Qa(le));const oe=(te,he)=>{$&16&&c(x,te,he,s,r,i,a,l)};D?oe(n,Q):le&&oe(le,N)}else{t.el=e.el;const K=t.anchor=e.anchor,Q=t.target=e.target,le=t.targetAnchor=e.targetAnchor,N=Ko(e.props),oe=N?n:Q,te=N?K:le;if(i=i||Qa(Q),j?(f(e.dynamicChildren,j,oe,s,r,i,a),Nl(e,t,!0)):l||p(e,t,oe,te,s,r,i,a,!1),D)N||As(t,n,K,d,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const he=t.target=Ui(t.props,v);he&&As(t,he,null,d,0)}else N&&As(t,Q,le,d,1)}lp(t)},remove(e,t,n,o,{um:s,o:{remove:r}},i){const{shapeFlag:a,children:l,anchor:d,targetAnchor:c,target:p,props:f}=e;if(p&&r(c),(i||!Ko(f))&&(r(d),a&16))for(let b=0;b<l.length;b++){const v=l[b];s(v,t,n,!0,!!v.dynamicChildren)}},move:As,hydrate:Zg};function As(e,t,n,{o:{insert:o},m:s},r=2){r===0&&o(e.targetAnchor,t,n);const{el:i,anchor:a,shapeFlag:l,children:d,props:c}=e,p=r===2;if(p&&o(i,t,n),(!p||Ko(c))&&l&16)for(let f=0;f<d.length;f++)s(d[f],t,n,2);p&&o(a,t,n)}function Zg(e,t,n,o,s,r,{o:{nextSibling:i,parentNode:a,querySelector:l}},d){const c=t.target=Ui(t.props,l);if(c){const p=c._lpa||c.firstChild;if(t.shapeFlag&16)if(Ko(t.props))t.anchor=d(i(e),t,a(e),n,o,s,r),t.targetAnchor=p;else{t.anchor=i(e);let f=p;for(;f;)if(f=i(f),f&&f.nodeType===8&&f.data==="teleport anchor"){t.targetAnchor=f,c._lpa=t.targetAnchor&&i(t.targetAnchor);break}d(p,t,c,n,o,s,r)}lp(t)}return t.anchor&&i(t.anchor)}const ip=Jg;function lp(e){const t=e.ctx;if(t&&t.ut){let n=e.children[0].el;for(;n!==e.targetAnchor;)n.nodeType===1&&n.setAttribute("data-v-owner",t.uid),n=n.nextSibling;t.ut()}}const U=Symbol(void 0),xr=Symbol(void 0),ut=Symbol(void 0),Ws=Symbol(void 0),Yo=[];let vt=null;function g(e=!1){Yo.push(vt=e?null:[])}function Qg(){Yo.pop(),vt=Yo[Yo.length-1]||null}let is=1;function ed(e){is+=e}function ap(e){return e.dynamicChildren=is>0?vt||no:null,Qg(),is>0&&vt&&vt.push(e),e}function y(e,t,n,o,s,r){return ap(u(e,t,n,o,s,r,!0))}function L(e,t,n,o,s){return ap(C(e,t,n,o,s,!0))}function ls(e){return e?e.__v_isVNode===!0:!1}function pn(e,t){return e.type===t.type&&e.key===t.key}const jr="__vInternal",dp=({key:e})=>e!=null?e:null,zs=({ref:e,ref_key:t,ref_for:n})=>e!=null?xe(e)||We(e)||Z(e)?{i:Ne,r:e,k:t,f:!!n}:e:null;function u(e,t=null,n=null,o=0,s=null,r=e===U?0:1,i=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&dp(t),ref:t&&zs(t),scopeId:kr,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Ne};return a?(Ll(l,n),r&128&&e.normalize(l)):n&&(l.shapeFlag|=xe(n)?8:16),is>0&&!i&&vt&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&vt.push(l),l}const C=em;function em(e,t=null,n=null,o=0,s=null,r=!1){if((!e||e===Eg)&&(e=ut),ls(e)){const a=Yt(e,t,!0);return n&&Ll(a,n),is>0&&!r&&vt&&(a.shapeFlag&6?vt[vt.indexOf(e)]=a:vt.push(a)),a.patchFlag|=-2,a}if(um(e)&&(e=e.__vccOpts),t){t=tm(t);let{class:a,style:l}=t;a&&!xe(a)&&(t.class=pe(a)),be(l)&&(Au(l)&&!z(l)&&(l=He({},l)),t.style=Re(l))}const i=xe(e)?1:Wu(e)?128:Yg(e)?64:be(e)?4:Z(e)?2:0;return u(e,t,n,o,s,i,r,!0)}function tm(e){return e?Au(e)||jr in e?He({},e):e:null}function Yt(e,t,n=!1){const{props:o,ref:s,patchFlag:r,children:i}=e,a=t?om(o||{},t):o;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&dp(a),ref:t&&t.ref?n&&s?z(s)?s.concat(zs(t)):[s,zs(t)]:zs(t):s,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:i,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==U?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Yt(e.ssContent),ssFallback:e.ssFallback&&Yt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function O(e=" ",t=0){return C(xr,null,e,t)}function nm(e,t){const n=C(Ws,null,e);return n.staticCount=t,n}function X(e="",t=!1){return t?(g(),L(ut,null,e)):C(ut,null,e)}function It(e){return e==null||typeof e=="boolean"?C(ut):z(e)?C(U,null,e.slice()):typeof e=="object"?un(e):C(xr,null,String(e))}function un(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Yt(e)}function Ll(e,t){let n=0;const{shapeFlag:o}=e;if(t==null)t=null;else if(z(t))n=16;else if(typeof t=="object")if(o&65){const s=t.default;s&&(s._c&&(s._d=!1),Ll(e,s()),s._c&&(s._d=!0));return}else{n=32;const s=t._;!s&&!(jr in t)?t._ctx=Ne:s===3&&Ne&&(Ne.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Z(t)?(t={default:t,_ctx:Ne},n=32):(t=String(t),o&64?(n=16,t=[O(t)]):n=8);e.children=t,e.shapeFlag|=n}function om(...e){const t={};for(let n=0;n<e.length;n++){const o=e[n];for(const s in o)if(s==="class")t.class!==o.class&&(t.class=pe([t.class,o.class]));else if(s==="style")t.style=Re([t.style,o.style]);else if(yr(s)){const r=t[s],i=o[s];i&&r!==i&&!(z(r)&&r.includes(i))&&(t[s]=r?[].concat(r,i):i)}else s!==""&&(t[s]=o[s])}return t}function it(e,t,n,o=null){ct(e,t,7,[n,o])}const sm=rp();let rm=0;function im(e,t,n){const o=e.type,s=(t?t.appContext:e.appContext)||sm,r={uid:rm++,vnode:e,type:o,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new $u(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:tp(o,s),emitsOptions:Vu(o,s),emit:null,emitted:null,propsDefaults:we,inheritAttrs:o.inheritAttrs,ctx:we,data:we,props:we,attrs:we,slots:we,refs:we,setupState:we,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=ug.bind(null,r),e.ce&&e.ce(r),r}let Oe=null;const Ul=()=>Oe||Ne,fo=e=>{Oe=e,e.scope.on()},Hn=()=>{Oe&&Oe.scope.off(),Oe=null};function cp(e){return e.vnode.shapeFlag&4}let ho=!1;function lm(e,t=!1){ho=t;const{props:n,children:o}=e.vnode,s=cp(e);Ng(e,n,s,t),Vg(e,o);const r=s?am(e,t):void 0;return ho=!1,r}function am(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=Cr(new Proxy(e.ctx,Ag));const{setup:o}=n;if(o){const s=e.setupContext=o.length>1?cm(e):null;fo(e),So();const r=mn(o,e,0,[e.props,s]);if(ko(),Hn(),yu(r)){if(r.then(Hn,Hn),t)return r.then(i=>{td(e,i,t)}).catch(i=>{fs(i,e,0)});e.asyncDep=r}else td(e,r,t)}else up(e,t)}function td(e,t,n){Z(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:be(t)&&(e.setupState=Hu(t)),up(e,n)}let nd;function up(e,t,n){const o=e.type;if(!e.render){if(!t&&nd&&!o.render){const s=o.template||Ml(e).template;if(s){const{isCustomElement:r,compilerOptions:i}=e.appContext.config,{delimiters:a,compilerOptions:l}=o,d=He(He({isCustomElement:r,delimiters:a},i),l);o.render=nd(s,d)}}e.render=o.render||yt}fo(e),So(),Dg(e),ko(),Hn()}function dm(e){return new Proxy(e.attrs,{get(t,n){return Je(e,"get","$attrs"),t[n]}})}function cm(e){const t=o=>{e.exposed=o||{}};let n;return{get attrs(){return n||(n=dm(e))},slots:e.slots,emit:e.emit,expose:t}}function Ir(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Hu(Cr(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in Xo)return Xo[n](e)},has(t,n){return n in t||n in Xo}}))}function Vi(e,t=!0){return Z(e)?e.displayName||e.name:e.name||t&&e.__name}function um(e){return Z(e)&&"__vccOpts"in e}const nr=(e,t)=>sg(e,t,ho);function od(e,t,n){const o=arguments.length;return o===2?be(t)&&!z(t)?ls(t)?C(e,null,[t]):C(e,t):C(e,null,t):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&ls(n)&&(n=[n]),C(e,t,n))}const pm=Symbol(""),fm=()=>Vs(pm),hm="3.2.47",gm="http://www.w3.org/2000/svg",Bn=typeof document!="undefined"?document:null,sd=Bn&&Bn.createElement("template"),mm={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,o)=>{const s=t?Bn.createElementNS(gm,e):Bn.createElement(e,n?{is:n}:void 0);return e==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:e=>Bn.createTextNode(e),createComment:e=>Bn.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Bn.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,o,s,r){const i=n?n.previousSibling:t.lastChild;if(s&&(s===r||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),!(s===r||!(s=s.nextSibling)););else{sd.innerHTML=o?`<svg>${e}</svg>`:e;const a=sd.content;if(o){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,n)}return[i?i.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}};function bm(e,t,n){const o=e._vtc;o&&(t=(t?[t,...o]:[...o]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}function vm(e,t,n){const o=e.style,s=xe(n);if(n&&!s){if(t&&!xe(t))for(const r in t)n[r]==null&&Wi(o,r,"");for(const r in n)Wi(o,r,n[r])}else{const r=o.display;s?t!==n&&(o.cssText=n):t&&e.removeAttribute("style"),"_vod"in e&&(o.display=r)}}const rd=/\s*!important$/;function Wi(e,t,n){if(z(n))n.forEach(o=>Wi(e,t,o));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const o=ym(e,t);rd.test(n)?e.setProperty(Nn(o),n.replace(rd,""),"important"):e[o]=n}}const id=["Webkit","Moz","ms"],ri={};function ym(e,t){const n=ri[t];if(n)return n;let o=Dt(t);if(o!=="filter"&&o in e)return ri[t]=o;o=wr(o);for(let s=0;s<id.length;s++){const r=id[s]+o;if(r in e)return ri[t]=r}return t}const ld="http://www.w3.org/1999/xlink";function _m(e,t,n,o,s){if(o&&t.startsWith("xlink:"))n==null?e.removeAttributeNS(ld,t.slice(6,t.length)):e.setAttributeNS(ld,t,n);else{const r=ph(t);n==null||r&&!bu(n)?e.removeAttribute(t):e.setAttribute(t,r?"":n)}}function wm(e,t,n,o,s,r,i){if(t==="innerHTML"||t==="textContent"){o&&i(o,s,r),e[t]=n==null?"":n;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=n;const l=n==null?"":n;(e.value!==l||e.tagName==="OPTION")&&(e.value=l),n==null&&e.removeAttribute(t);return}let a=!1;if(n===""||n==null){const l=typeof e[t];l==="boolean"?n=bu(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{e[t]=n}catch(l){}a&&e.removeAttribute(t)}function fn(e,t,n,o){e.addEventListener(t,n,o)}function $m(e,t,n,o){e.removeEventListener(t,n,o)}function Cm(e,t,n,o,s=null){const r=e._vei||(e._vei={}),i=r[t];if(o&&i)i.value=o;else{const[a,l]=Pm(t);if(o){const d=r[t]=Om(o,s);fn(e,a,d,l)}else i&&($m(e,a,i,l),r[t]=void 0)}}const ad=/(?:Once|Passive|Capture)$/;function Pm(e){let t;if(ad.test(e)){t={};let o;for(;o=e.match(ad);)e=e.slice(0,e.length-o[0].length),t[o[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Nn(e.slice(2)),t]}let ii=0;const Sm=Promise.resolve(),km=()=>ii||(Sm.then(()=>ii=0),ii=Date.now());function Om(e,t){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;ct(xm(o,n.value),t,5,[o])};return n.value=e,n.attached=km(),n}function xm(e,t){if(z(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(o=>s=>!s._stopped&&o&&o(s))}else return t}const dd=/^on[a-z]/,jm=(e,t,n,o,s=!1,r,i,a,l)=>{t==="class"?bm(e,o,s):t==="style"?vm(e,n,o):yr(t)?Cl(t)||Cm(e,t,n,o,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Im(e,t,o,s))?wm(e,t,o,r,i,a,l):(t==="true-value"?e._trueValue=o:t==="false-value"&&(e._falseValue=o),_m(e,t,o,s))};function Im(e,t,n,o){return o?!!(t==="innerHTML"||t==="textContent"||t in e&&dd.test(t)&&Z(n)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||dd.test(t)&&xe(n)?!1:t in e}const nn="transition",Ho="animation",pp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Tm=He({},_g.props,pp),On=(e,t=[])=>{z(e)?e.forEach(n=>n(...t)):e&&e(...t)},cd=e=>e?z(e)?e.some(t=>t.length>1):e.length>1:!1;function Em(e){const t={};for(const M in e)M in pp||(t[M]=e[M]);if(e.css===!1)return t;const{name:n="v",type:o,duration:s,enterFromClass:r=`${n}-enter-from`,enterActiveClass:i=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:l=r,appearActiveClass:d=i,appearToClass:c=a,leaveFromClass:p=`${n}-leave-from`,leaveActiveClass:f=`${n}-leave-active`,leaveToClass:b=`${n}-leave-to`}=e,v=Bm(s),w=v&&v[0],H=v&&v[1],{onBeforeEnter:D,onEnter:$,onEnterCancelled:x,onLeave:j,onLeaveCancelled:K,onBeforeAppear:Q=D,onAppear:le=$,onAppearCancelled:N=x}=t,oe=(M,ve,Ue)=>{cn(M,ve?c:a),cn(M,ve?d:i),Ue&&Ue()},te=(M,ve)=>{M._isLeaving=!1,cn(M,p),cn(M,b),cn(M,f),ve&&ve()},he=M=>(ve,Ue)=>{const Ct=M?le:$,Ce=()=>oe(ve,M,Ue);On(Ct,[ve,Ce]),ud(()=>{cn(ve,M?l:r),Lt(ve,M?c:a),cd(Ct)||pd(ve,o,w,Ce)})};return He(t,{onBeforeEnter(M){On(D,[M]),Lt(M,r),Lt(M,i)},onBeforeAppear(M){On(Q,[M]),Lt(M,l),Lt(M,d)},onEnter:he(!1),onAppear:he(!0),onLeave(M,ve){M._isLeaving=!0;const Ue=()=>te(M,ve);Lt(M,p),hp(),Lt(M,f),ud(()=>{!M._isLeaving||(cn(M,p),Lt(M,b),cd(j)||pd(M,o,H,Ue))}),On(j,[M,Ue])},onEnterCancelled(M){oe(M,!1),On(x,[M])},onAppearCancelled(M){oe(M,!0),On(N,[M])},onLeaveCancelled(M){te(M),On(K,[M])}})}function Bm(e){if(e==null)return null;if(be(e))return[li(e.enter),li(e.leave)];{const t=li(e);return[t,t]}}function li(e){return wh(e)}function Lt(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e._vtc||(e._vtc=new Set)).add(t)}function cn(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.remove(o));const{_vtc:n}=e;n&&(n.delete(t),n.size||(e._vtc=void 0))}function ud(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Am=0;function pd(e,t,n,o){const s=e._endId=++Am,r=()=>{s===e._endId&&o()};if(n)return setTimeout(r,n);const{type:i,timeout:a,propCount:l}=fp(e,t);if(!i)return o();const d=i+"end";let c=0;const p=()=>{e.removeEventListener(d,f),r()},f=b=>{b.target===e&&++c>=l&&p()};setTimeout(()=>{c<l&&p()},a+1),e.addEventListener(d,f)}function fp(e,t){const n=window.getComputedStyle(e),o=v=>(n[v]||"").split(", "),s=o(`${nn}Delay`),r=o(`${nn}Duration`),i=fd(s,r),a=o(`${Ho}Delay`),l=o(`${Ho}Duration`),d=fd(a,l);let c=null,p=0,f=0;t===nn?i>0&&(c=nn,p=i,f=r.length):t===Ho?d>0&&(c=Ho,p=d,f=l.length):(p=Math.max(i,d),c=p>0?i>d?nn:Ho:null,f=c?c===nn?r.length:l.length:0);const b=c===nn&&/\b(transform|all)(,|$)/.test(o(`${nn}Property`).toString());return{type:c,timeout:p,propCount:f,hasTransform:b}}function fd(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,o)=>hd(n)+hd(e[o])))}function hd(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function hp(){return document.body.offsetHeight}const gp=new WeakMap,mp=new WeakMap,bp={name:"TransitionGroup",props:He({},Tm,{tag:String,moveClass:String}),setup(e,{slots:t}){const n=Ul(),o=qu();let s,r;return Rl(()=>{if(!s.length)return;const i=e.moveClass||`${e.name||"v"}-move`;if(!Fm(s[0].el,n.vnode.el,i))return;s.forEach(Rm),s.forEach(Hm);const a=s.filter(Mm);hp(),a.forEach(l=>{const d=l.el,c=d.style;Lt(d,i),c.transform=c.webkitTransform=c.transitionDuration="";const p=d._moveCb=f=>{f&&f.target!==d||(!f||/transform$/.test(f.propertyName))&&(d.removeEventListener("transitionend",p),d._moveCb=null,cn(d,i))};d.addEventListener("transitionend",p)})}),()=>{const i=ie(e),a=Em(i);let l=i.tag||U;s=r,r=t.default?Al(t.default()):[];for(let d=0;d<r.length;d++){const c=r[d];c.key!=null&&po(c,rs(c,a,o,n))}if(s)for(let d=0;d<s.length;d++){const c=s[d];po(c,rs(c,a,o,n)),gp.set(c,c.el.getBoundingClientRect())}return C(l,null,r)}}},Dm=e=>delete e.mode;bp.props;const LT=bp;function Rm(e){const t=e.el;t._moveCb&&t._moveCb(),t._enterCb&&t._enterCb()}function Hm(e){mp.set(e,e.el.getBoundingClientRect())}function Mm(e){const t=gp.get(e),n=mp.get(e),o=t.left-n.left,s=t.top-n.top;if(o||s){const r=e.el.style;return r.transform=r.webkitTransform=`translate(${o}px,${s}px)`,r.transitionDuration="0s",e}}function Fm(e,t,n){const o=e.cloneNode();e._vtc&&e._vtc.forEach(i=>{i.split(/\s+/).forEach(a=>a&&o.classList.remove(a))}),n.split(/\s+/).forEach(i=>i&&o.classList.add(i)),o.style.display="none";const s=t.nodeType===1?t:t.parentNode;s.appendChild(o);const{hasTransform:r}=fp(o);return s.removeChild(o),r}const go=e=>{const t=e.props["onUpdate:modelValue"]||!1;return z(t)?n=>so(t,n):t};function Nm(e){e.target.composing=!0}function gd(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Te={created(e,{modifiers:{lazy:t,trim:n,number:o}},s){e._assign=go(s);const r=o||s.props&&s.props.type==="number";fn(e,t?"change":"input",i=>{if(i.target.composing)return;let a=e.value;n&&(a=a.trim()),r&&(a=Zs(a)),e._assign(a)}),n&&fn(e,"change",()=>{e.value=e.value.trim()}),t||(fn(e,"compositionstart",Nm),fn(e,"compositionend",gd),fn(e,"change",gd))},mounted(e,{value:t}){e.value=t==null?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:n,trim:o,number:s}},r){if(e._assign=go(r),e.composing||document.activeElement===e&&e.type!=="range"&&(n||o&&e.value.trim()===t||(s||e.type==="number")&&Zs(e.value)===t))return;const i=t==null?"":t;e.value!==i&&(e.value=i)}},Lm={deep:!0,created(e,t,n){e._assign=go(n),fn(e,"change",()=>{const o=e._modelValue,s=as(e),r=e.checked,i=e._assign;if(z(o)){const a=$l(o,s),l=a!==-1;if(r&&!l)i(o.concat(s));else if(!r&&l){const d=[...o];d.splice(a,1),i(d)}}else if(Co(o)){const a=new Set(o);r?a.add(s):a.delete(s),i(a)}else i(vp(e,r))})},mounted:md,beforeUpdate(e,t,n){e._assign=go(n),md(e,t,n)}};function md(e,{value:t,oldValue:n},o){e._modelValue=t,z(t)?e.checked=$l(t,o.props.value)>-1:Co(t)?e.checked=t.has(o.props.value):t!==n&&(e.checked=ps(t,vp(e,!0)))}const _t={deep:!0,created(e,{value:t,modifiers:{number:n}},o){const s=Co(t);fn(e,"change",()=>{const r=Array.prototype.filter.call(e.options,i=>i.selected).map(i=>n?Zs(as(i)):as(i));e._assign(e.multiple?s?new Set(r):r:r[0])}),e._assign=go(o)},mounted(e,{value:t}){bd(e,t)},beforeUpdate(e,t,n){e._assign=go(n)},updated(e,{value:t}){bd(e,t)}};function bd(e,t){const n=e.multiple;if(!(n&&!z(t)&&!Co(t))){for(let o=0,s=e.options.length;o<s;o++){const r=e.options[o],i=as(r);if(n)z(t)?r.selected=$l(t,i)>-1:r.selected=t.has(i);else if(ps(as(r),t)){e.selectedIndex!==o&&(e.selectedIndex=o);return}}!n&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function as(e){return"_value"in e?e._value:e.value}function vp(e,t){const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t}const Um=["ctrl","shift","alt","meta"],Vm={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Um.some(n=>e[`${n}Key`]&&!t.includes(n))},G=(e,t)=>(n,...o)=>{for(let s=0;s<t.length;s++){const r=Vm[t[s]];if(r&&r(n,t))return}return e(n,...o)},Wm={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Le=(e,t)=>n=>{if(!("key"in n))return;const o=Nn(n.key);if(t.some(s=>s===o||Wm[s]===o))return e(n)},zm=He({patchProp:jm},mm);let vd;function Gm(){return vd||(vd=qg(zm))}const qm=(...e)=>{const t=Gm().createApp(...e),{mount:n}=t;return t.mount=o=>{const s=Xm(o);if(!s)return;const r=t._component;!Z(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const i=n(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},t};function Xm(e){return xe(e)?document.querySelector(e):e}const Km="modulepreload",Ym=function(e,t){return new URL(e,t).href},yd={},_d=function(t,n,o){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=Ym(r,o),r in yd)return;yd[r]=!0;const i=r.endsWith(".css"),a=i?'[rel="stylesheet"]':"";if(!!o)for(let c=s.length-1;c>=0;c--){const p=s[c];if(p.href===r&&(!i||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":Km,i||(d.as="script",d.crossOrigin=""),d.href=r,document.head.appendChild(d),i)return new Promise((c,p)=>{d.addEventListener("load",c),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())};function Jm(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}var Zm=Object.defineProperty,Qm=(e,t,n)=>t in e?Zm(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Be=(e,t,n)=>(Qm(e,typeof t!="symbol"?t+"":t,n),n);const ai=Jm(),ue={fire(e){ai.emit(e.kind,e)},subscribe(e,t){ai.on(e.kind,t)},unsubscribe(e,t){ai.off(e.kind,t)}};class or{constructor(t){this.path=t,Be(this,"kind","AssetFailureEvent")}}Be(or,"kind","AssetFailureEvent");class Vl{constructor(t){this.message=t,Be(this,"kind","FailureEvent")}}Be(Vl,"kind","FailureEvent");class yp{constructor(t){this.error=t,Be(this,"kind","CustomAssetFailureEvent")}}Be(yp,"kind","CustomAssetFailureEvent");class Tr{constructor(){Be(this,"kind","InvalidateRenderEvent")}}Be(Tr,"kind","InvalidateRenderEvent");const _p=class{constructor(){Be(this,"kind",_p.kind)}};let Wl=_p;Be(Wl,"kind","RenderUpdatedEvent");const wp=class{constructor(){Be(this,"kind",wp.kind)}};let zl=wp;Be(zl,"kind","StateLoadingEvent");class ot{constructor(t){this.message=t,Be(this,"kind","ShowMessageEvent")}}Be(ot,"kind","ShowMessageEvent");class Gl{constructor(t,n){this.message=t,this.actions=n,Be(this,"kind","ResolvableErrorEvent")}}Be(Gl,"kind","ResolvableErrorEvent");class sr{constructor(t){this.color=t,Be(this,"kind","ColorPickedEvent")}}Be(sr,"kind","ColorPickedEvent");class $p{constructor(t,n){this.error=t,this.info=n,Be(this,"kind","VueErrorEvent")}}Be($p,"kind","VueErrorEvent");const Cp=""+new URL("missing_image.81acc086.svg",import.meta.url).href;var eb=Object.defineProperty,wd=Object.getOwnPropertySymbols,tb=Object.prototype.hasOwnProperty,nb=Object.prototype.propertyIsEnumerable,zi=(e,t,n)=>t in e?eb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,$d=(e,t)=>{for(var n in t||(t={}))tb.call(t,n)&&zi(e,n,t[n]);if(wd)for(var n of wd(t))nb.call(t,n)&&zi(e,n,t[n]);return e},Cd=(e,t,n)=>(zi(e,typeof t!="symbol"?t+"":t,n),n);class ql{constructor(t){this.html=t,Cd(this,"width"),Cd(this,"height"),this.width=t.width,this.height=t.height}paintOnto(t,n={}){const{w:o,h:s}=$d({w:this.width,h:this.height},n),{x:r,y:i}=$d({x:-o/2,y:-s/2},n);t.drawImage(this.html,r,i,o,s)}}var ob=Object.defineProperty,sb=(e,t,n)=>t in e?ob(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pd=(e,t,n)=>(sb(e,typeof t!="symbol"?t+"":t,n),n);let Gi=null;setTimeout(()=>Xl(Cp).then(e=>{e instanceof ql&&(Gi=e)}),0);class rr{constructor(){Pd(this,"width",300),Pd(this,"height",300)}paintOnto(t,n={}){Gi&&Gi.paintOnto(t,n)}}var rb=Object.defineProperty,ib=Object.defineProperties,lb=Object.getOwnPropertyDescriptors,Sd=Object.getOwnPropertySymbols,ab=Object.prototype.hasOwnProperty,db=Object.prototype.propertyIsEnumerable,qi=(e,t,n)=>t in e?rb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mo=(e,t)=>{for(var n in t||(t={}))ab.call(t,n)&&qi(e,n,t[n]);if(Sd)for(var n of Sd(t))db.call(t,n)&&qi(e,n,t[n]);return e},cb=(e,t)=>ib(e,lb(t)),hn=(e,t,n)=>(qi(e,typeof t!="symbol"?t+"":t,n),n),Fo=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const ub="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",lt=class{constructor(e,t,n){this.$store=n,hn(this,"onlineRepo"),hn(this,"localRepo"),hn(this,"tempRepo",Kt({authors:{},packs:[]})),hn(this,"combinedList"),hn(this,"authors"),window.repo=this,e||(e={authors:{},packs:[]},ue.fire(new ot("Couldn't load remote repository."))),t||(t={authors:{},packs:[]},q.supports.localRepo&&ue.fire(new ot("Couldn't load local repository."))),this.onlineRepo=io(e),this.localRepo=io(t),this.combinedList=nr(()=>{var o,s;const r=this.onlineRepo.value,i=(o=r==null?void 0:r.packs)!=null?o:[],a=new Map(i.map($=>[$.id,$])),l=this.localRepo.value,d=(s=l==null?void 0:l.packs)!=null?s:[],c=new Map(d.map($=>[$.id,$])),f=this.tempRepo.packs,b=new Map(f.map($=>[$.id,$])),v=new Set(q.state.autoAdd),w=this.$store.state.content.contentPacks.map($=>$.packId).filter($=>$!=null),H=new Set(w),D=new Set;return[...w,...d.map($=>$.id),...i.map($=>$.id),...f.map($=>$.id)].filter($=>$.startsWith("dddg.buildin.")||$.startsWith("dddg.uploads.")||$.startsWith("dddg.desktop.")||$==="concept_femc.shido_draws.edave64"||$==="mc.storm_blaze.edave64"||D.has($)?!1:(D.add($),!0)).map($=>{var x,j,K;return cb(Mo(Mo(Mo({},(x=a.get($))!=null?x:{characters:[],kind:[],authors:[]}),(j=c.get($))!=null?j:{}),(K=b.get($))!=null?K:{}),{autoloading:v.has($),installed:c.has($),online:a.has($)||b.has($),loaded:H.has($)})})}),this.authors=nr(()=>{var o,s;const r=this.onlineRepo.value,i=(o=r==null?void 0:r.authors)!=null?o:{},a=this.localRepo.value,l=(s=a==null?void 0:a.authors)!=null?s:{};return Mo(Mo({},i),l)}),Object.freeze(this)}static getInstance(){return lt.instance||(lt.instance=this.createInstance()),lt.instance}static createInstance(){return Fo(this,null,function*(){const e=lt.loadRepo(ub),t=q.supports.localRepo?yield lt.loadRepo(q.localRepositoryUrl):null,[n,o,s]=yield Promise.all([e,t,lt.$store]);return new lt(n,o,s)})}static loadRepo(e){return Fo(this,null,function*(){try{const[t,n]=yield Promise.all([lt.fetchJSON(e+"repo.json"),lt.fetchJSON(e+"people.json")]);return{packs:t,authors:n}}catch(t){return null}})}static fetchJSON(e){return Fo(this,null,function*(){const t=yield fetch(e);if(!t.ok)throw new Error("Could not load json");return yield t.json()})}reloadLocalRepo(){return Fo(this,null,function*(){this.localRepo.value=q.supports.localRepo?yield lt.loadRepo(q.localRepositoryUrl):null})}getPacks(){return this.combinedList.value}hasPack(e,t=!1){var n;return t?!!((n=this.onlineRepo.value)!=null&&n.packs.find(o=>o.id===e)):!!this.getPacks().find(o=>o.id===e)}getPack(e){var t;return(t=this.getPacks().find(n=>n.id===e))!=null?t:null}getAuthor(e){return this.authors.value[e]||null}getAuthors(){return this.authors.value}loadTempPack(e){return Fo(this,null,function*(){const t=fetch(e);let n;try{n=yield t}catch(r){throw new Error(`Failed to load '${e}'`)}let o;try{o=yield n.json()}catch(r){throw new Error(`The contents of '${e}' is not a valid JSON: ${r.message}`)}if(!o.pack)throw new Error(`The json file '${e}' does not contain any packages`);if(o.authors)for(const r in o.authors)this.tempRepo.authors[r]&&(this.tempRepo.authors[r]=o.authors[r]);const s=o.pack;return s.repoUrl=e,this.tempRepo.packs.find(r=>r.id===s.id)||this.tempRepo.packs.push(s),s.id})}};let Jt=lt;hn(Jt,"instance");hn(Jt,"setStore");hn(Jt,"$store",new Promise((e,t)=>{lt.setStore=e}));var pb=Object.defineProperty,kd=Object.getOwnPropertySymbols,fb=Object.prototype.hasOwnProperty,hb=Object.prototype.propertyIsEnumerable,Xi=(e,t,n)=>t in e?pb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ki=(e,t)=>{for(var n in t||(t={}))fb.call(t,n)&&Xi(e,n,t[n]);if(kd)for(var n of kd(t))hb.call(t,n)&&Xi(e,n,t[n]);return e},ht=(e,t,n)=>(Xi(e,typeof t!="symbol"?t+"":t,n),n),Ae=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const ir=navigator.userAgent,gb=!!ir.match(/iPad/i)||!!ir.match(/iPhone/i),mb=!!ir.match(/WebKit/i),Od=gb&&mb&&!ir.match(/CriOS/i);class Pp{constructor(){ht(this,"state",Kt({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder"})),ht(this,"supports"),ht(this,"_gameMode",null),ht(this,"vuexHistory",null),ht(this,"$store",null),ht(this,"isSavingEnabled",io(!1)),ht(this,"localRepositoryUrl",""),ht(this,"loading"),ht(this,"creatingDB"),ht(this,"loadingContentPacksAllowed"),ht(this,"loadContentPacks");const t=this,n=De.canSave();window.addEventListener("beforeunload",function(o){o.preventDefault(),o.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise((o,s)=>{this.loadContentPacks=()=>o()}),this.supports=Kt({optionalSaving:n,get autoLoading(){return n&&t.isSavingEnabled.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!Od,allowWebP:!0,limitedCanvasSpace:Od}),n?this.loading=(()=>Ae(this,null,function*(){this.savingEnabled=yield De.doesDbExists()}))():this.loading=Promise.resolve(),this.loading.then(()=>Ae(this,null,function*(){var o;if(yield this.loadingContentPacksAllowed,this.creatingDB&&(yield this.creatingDB),this.savingEnabled){const s=(o=yield De.loadAutoload())!=null?o:[];this.state.autoAdd=s;const r=yield Jt.getInstance(),i=yield Promise.all(s.map(a=>Ae(this,null,function*(){var l;const[d,c]=a.split(";",2);c!=null&&!r.hasPack(d)&&(yield r.loadTempPack(c));const p=r.getPack(d);return(l=p.dddg2Path)!=null?l:p.dddg1Path})));yield this.vuexHistory.transaction(()=>Ae(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",i)}))}}))}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(t){t?(localStorage.setItem("saving","true"),this.creatingDB=De.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=De.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}loadGameMode(){return Ae(this,null,function*(){const n=new URLSearchParams(location.search).get("mode");if(n==="ddlc"||n==="ddlc_plus"){this._gameMode=n;return}yield this.loading,yield this.creatingDB;let o="";this.isSavingEnabled.value&&(o=yield De.loadGameMode());let s="ddlc";(o==="ddlc"||o==="ddlc_plus")&&(s=o),this._gameMode=s})}setGameMode(t){return Ae(this,null,function*(){this.isSavingEnabled.value&&(yield De.saveGameMode(t));const n=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${n}?mode=${t}`})}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(t){throw new Error("Method not implemented.")}connectToStore(t,n){this.vuexHistory=t,this.$store=n}saveToFile(t,n,o="image/png",s=1){return Ae(this,null,function*(){const r=document.createElement("a");r.setAttribute("download",n);const i=yield this.createObjectURL(t,o,s);return r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),i})}localRepoInstall(t,n,o){throw new Error("This environment does not support a local repository")}localRepoUninstall(t){throw new Error("This environment does not support a local repository")}autoLoadAdd(t){return Ae(this,null,function*(){yield this.loading,yield this.creatingDB,yield De.saveAutoload([...this.state.autoAdd,t]),this.state.autoAdd.push(t)})}autoLoadRemove(t){return Ae(this,null,function*(){yield this.loading,yield this.creatingDB;const n=this.normalizePackId(t);yield De.saveAutoload(this.state.autoAdd.filter(s=>this.normalizePackId(s)!=n));const o=this.state.autoAdd.indexOf(t);this.state.autoAdd.splice(o,1)})}normalizePackId(t){const n=t.split(";");return n.length===1?n[0]:n[n.length-1]}loadSettings(){return Ae(this,null,function*(){yield this.loading,yield this.creatingDB;const t={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?Ki(Ki({},t),yield De.loadSettings()):t})}saveSettings(t){return Ae(this,null,function*(){yield this.loading,yield this.creatingDB,this.isSavingEnabled.value&&(yield De.saveSettings(t))})}isInitialized(){return Ae(this,null,function*(){yield this.loading,yield this.creatingDB})}prompt(t,n){return new Promise((o,s)=>{o(prompt(t,n))})}onPanelChange(t){}createObjectURL(t,n,o){return new Promise((s,r)=>{if(!(window.URL!=null&&window.URL.createObjectURL!=null))return s(t.toDataURL(n,o));if(t.toBlob!=null)t.toBlob(a=>{if(!a){r();return}s(URL.createObjectURL(a))},n,o);else{const a=t.toDataURL(n,o),l=this.dataURItoBlob(a,n);s(URL.createObjectURL(l))}})}dataURItoBlob(t,n){const o=atob(t.split(",")[1]),s=o.length,r=new Uint8Array(s);for(let i=0;i<s;i++)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})}}const De={indexedDB:(()=>{var e,t,n;try{return(n=(t=(e=window.indexedDB)!=null?e:window.mozIndexedDB)!=null?t:window.webkitIndexedDB)!=null?n:window.msIndexedDB}catch(o){return null}})(),transaction:(()=>{try{return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction}catch(e){return null}})(),db:null,canSave(){return!!(De.indexedDB&&window.localStorage!=null)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return De.db?De.db:De.db=new Promise((e,t)=>{const n=De.indexedDB.open("dddg",3);n.onerror=o=>{t(o)},n.onupgradeneeded=o=>{var s;const r=o.target.result,i=(s=o.oldVersion)!=null?s:o.version;i<1&&r.createObjectStore("settings"),i===1&&(r.deleteObjectStore("settings"),r.createObjectStore("settings"))},n.onsuccess=o=>{e(n.result)}})},clearDB(){return new Promise((e,t)=>{if(!De.db){e();return}const n=De.indexedDB.deleteDatabase("dddg");De.db=null,n.onerror=o=>{t(o)},n.onsuccess=o=>{e()}})},loadAutoload(){return this.objectStorePromise("readonly",e=>Ae(this,null,function*(){return yield this.reqPromise(e.get("autoload"))}))},saveAutoload(e){return this.objectStorePromise("readwrite",t=>Ae(this,null,function*(){yield this.reqPromise(t.put([...e],"autoload"))}))},loadGameMode(){return this.objectStorePromise("readonly",e=>Ae(this,null,function*(){return yield this.reqPromise(e.get("gameMode"))}))},saveGameMode(e){return this.objectStorePromise("readwrite",t=>Ae(this,null,function*(){yield this.reqPromise(t.put(e,"gameMode"))}))},saveSettings(e){return this.objectStorePromise("readwrite",t=>Ae(this,null,function*(){yield this.reqPromise(t.put(Ki({},e),"settings"))}))},loadSettings(){return this.objectStorePromise("readonly",e=>Ae(this,null,function*(){return yield this.reqPromise(e.get("settings"))}))},objectStorePromise(e,t){return this.db?new Promise((n,o)=>Ae(this,null,function*(){const r=(yield this.db).transaction(["settings"],e).objectStore("settings");try{n(yield t(r))}catch(i){o(i)}})):Promise.reject(new Error("No database"))},reqPromise(e){return new Promise((t,n)=>{e.onerror=o=>{n(o)},e.onsuccess=o=>{t(e.result)}})}};var bb=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class vb extends Pp{saveToFile(t,n,o="image/png",s=1){return bb(this,null,function*(){let r=t.toDataURL(o,s);const i=this.dataURItoBlob(r,o);return window.URL!=null&&window.URL.createObjectURL!=null&&(r=URL.createObjectURL(i)),window.navigator.msSaveBlob(i,n),r})}}var yb=Object.defineProperty,_b=(e,t,n)=>t in e?yb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,et=(e,t,n)=>(_b(e,typeof t!="symbol"?t+"":t,n),n),Pe=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const xd={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};class wb{constructor(){et(this,"state",Kt({looseTextParsing:!0,autoAdd:[],downloadLocation:""})),et(this,"localRepositoryUrl","/repo/"),et(this,"_gameMode",null),et(this,"electron",window),et(this,"vuexHistory",null),et(this,"$store",null),et(this,"bgInvalidation",null),et(this,"pendingContentPacks",[]),et(this,"pendingContentPacksReplace",[]),et(this,"loadingContentPacksAllowed"),et(this,"loadContentPacks"),et(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0,allowWebP:!0,limitedCanvasSpace:!1}),et(this,"savingEnabled",!0),this.loadingContentPacksAllowed=new Promise((n,o)=>{this.loadContentPacks=()=>n()}),this.electron.ipcRenderer.on("add-persistent-content-pack",n=>Pe(this,null,function*(){if(yield this.loadingContentPacksAllowed,!this.$store||!this.vuexHistory){this.pendingContentPacks.push(n);return}yield this.vuexHistory.transaction(()=>Pe(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",n)}))})),this.electron.ipcRenderer.on("add-persistent-background",n=>Pe(this,null,function*(){const o="persistentBg-"+n,s=n.split("/");yield kp(o,n),xd.backgrounds.push({id:o,variants:[[o]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()})),this.electron.ipcRenderer.on("push-message",n=>Pe(this,null,function*(){ue.fire(new ot(n))})),this.electron.ipcRenderer.on("config.downloadFolderUpdate",n=>Pe(this,null,function*(){this.state.downloadLocation=n})),this.electron.ipcRenderer.onConversation("load-packs",n=>Pe(this,null,function*(){const o=yield Jt.getInstance(),s=yield Promise.all(n.map(r=>Pe(this,null,function*(){const[i,a]=r.split(";",2);a!=null&&!o.hasPack(i)&&(yield o.loadTempPack(a));const l=o.getPack(i);return l.dddg2Path||l.dddg1Path})));if(!this.$store||!this.vuexHistory){s.forEach(r=>this.pendingContentPacks.push(r));return}yield this.vuexHistory.transaction(()=>Pe(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",s)}))})),this.electron.ipcRenderer.onConversation("auto-load.changed",n=>Pe(this,null,function*(){this.state.autoAdd=n})),this.electron.ipcRenderer.onConversation("reload-repo",()=>Pe(this,null,function*(){yield(yield Jt.getInstance()).reloadLocalRepo()})),this.electron.ipcRenderer.onConversation("replace-pack",n=>Pe(this,null,function*(){const o={processed:!1,contentPack:n};!this.$store||!this.vuexHistory?this.pendingContentPacksReplace.push(o):yield this.vuexHistory.transaction(()=>Pe(this,null,function*(){yield this.$store.dispatch("content/replaceContentPack",o)}))})),this.electron.ipcRenderer.onConversation("resolvable-error",(n,o)=>new Promise((s,r)=>{ue.fire(new Gl(n,o.map(i=>({exec:()=>s(i),name:i}))))}));let t=!1;this.electron.ipcRenderer.on("update.progress",n=>{n==="done"?(t=!1,ue.fire(new ot("An update is ready and will be installed once DDDG closes."))):t||(t=!0,ue.fire(new ot("An update is ready and will be installed once DDDG closes.")))}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(t){this.electron.ipcRenderer.send("open-folder",t)}onPanelChange(t){}saveSettings(t){return Pe(this,null,function*(){var n;yield this.electron.ipcRenderer.sendConvo("config.set","nsfw",t.nsfw),yield this.electron.ipcRenderer.sendConvo("config.set","darkMode",(n=t.darkMode)!=null?n:void 0),yield this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",t.defaultCharacterTalkingZoom)})}loadGameMode(){return Pe(this,null,function*(){this._gameMode=(yield this.electron.ipcRenderer.sendConvo("config.get","gameMode"))||"ddlc"})}setGameMode(t){return Pe(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("config.set","gameMode",t),this.electron.ipcRenderer.send("reload")})}loadSettings(){return Pe(this,null,function*(){var t,n,o;return{lq:!1,nsfw:(t=yield this.electron.ipcRenderer.sendConvo("config.get","nsfw"))!=null?t:!1,darkMode:(n=yield this.electron.ipcRenderer.sendConvo("config.get","darkMode"))!=null?n:void 0,defaultCharacterTalkingZoom:(o=yield this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom"))!=null?o:void 0}})}localRepoInstall(t,n,o){return Pe(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("repo.install",t,n,o)})}localRepoUninstall(t){return Pe(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("repo.uninstall",t)})}autoLoadAdd(t){return Pe(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("auto-load.add",t)})}autoLoadRemove(t){return Pe(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("auto-load.remove",t)})}saveToFile(t,n,o="image/png",s=1){return new Promise((r,i)=>{t.toBlob(a=>Pe(this,null,function*(){if(!a){i();return}const l=yield a.arrayBuffer();yield this.electron.ipcRenderer.sendConvo("save-file",n,new Uint8Array(l)),r(URL.createObjectURL(a))}),o,s)})}prompt(t,n){return Pe(this,null,function*(){return yield this.electron.ipcRenderer.sendConvo("show-prompt",t,n)})}connectToStore(t,n){this.vuexHistory=t,this.$store=n,this.invalidateInstalledBGs(),this.vuexHistory.transaction(()=>Pe(this,null,function*(){if(this.pendingContentPacks.length>0&&(yield this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks)),this.pendingContentPacksReplace.length>0)for(const o of this.pendingContentPacksReplace)yield this.$store.dispatch("content/replaceContentPack",o)}))}invalidateInstalledBGs(){!this.vuexHistory||!this.$store||this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation!=null&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),!(!this.vuexHistory||!this.$store)&&this.vuexHistory.transaction(()=>Pe(this,null,function*(){yield this.$store.dispatch("content/replaceContentPack",{contentPack:xd})}))}}function $b(){return window.isElectron?new wb:"msSaveOrOpenBlob"in window.navigator?new vb:new Pp}const q=$b();window.toast=q;var Cb=Object.defineProperty,Pb=(e,t,n)=>t in e?Cb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sp=(e,t,n)=>(Pb(e,typeof t!="symbol"?t+"":t,n),n),ds=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});let di;function mo(){if(di)return di;if(!q.supports.allowWebP)return Promise.resolve(!1);const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",t="data:image/webp;base64,UklGRogAAABXRUJQVlA4THwAAAAv/8SzAA/wGbPPmH3GbP7jAQSSNu9f+rzDwYj+G23bpt3Gx3xD8353j73f5b87+e9OALmT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9OAriT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9O/rsTwe7kvzsL";return di=(()=>ds(this,null,function*(){const n=yield Promise.all([jd(e,1,2),jd(t,720,1280)]);return n[0]&&n[1]}))()}function jd(e,t,n){return new Promise((o,s)=>{const r=document.createElement("img");r.addEventListener("load",()=>{o(r.width===n&&r.height===t)}),r.addEventListener("error",()=>{o(!1)}),r.src=e})}let ci;function Sb(){return ci||(ci=new Promise((e,t)=>{const n="data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",o=document.createElement("img");o.addEventListener("load",()=>{console.log("Heif no error. "+(o.width===2&&o.height===1)),e(o.width===2&&o.height===1)}),o.addEventListener("error",()=>{console.log("Heif not supported"),e(!1)}),o.src=n}))}class kb{constructor(){Sp(this,"cache",new Map)}get(t){const n=this.cache.get(t);if(n)return n;const o=Yi(t);return this.cache.set(t,o),o}remove(t){this.cache.delete(t)}}class Ob{constructor(){Sp(this,"cache",new Map)}get(t){var n;const o=(n=this.cache.get(t))==null?void 0:n.deref();if(o)return o;const s=jb(t);return this.cache.set(t,new WeakRef(s)),s}remove(t){this.cache.delete(t)}}let ui=null;function lr(){return ui||(window.assetCache=ui=q.supports.assetCaching||typeof WeakRef=="undefined"?new kb:new Ob)}const Fn={};function Er(e,t=!0){return Xl(q.supports.lq&&!t?e.lq:e.hq)}function Mn(e,t=!0){const n=q.supports.lq&&!t?e.lq:e.hq;return Fn[n]?Fn[n]:n}function Xl(e){return Fn[e]&&(e=Fn[e]),lr().get(e)}const Fe="./";function co(e,t=!0){return ds(this,null,function*(){const n=`${Fe}assets/${e}${t?"":".lq"}${(yield mo())?".webp":".png"}`.replace(/\/+/,"/");return yield lr().get(n)})}function xb(e,t=!0){return ds(this,null,function*(){return`${Fe}assets/${e}${q.supports.lq&&!t?".lq":""}${(yield mo())?".webp":".png"}`.replace(/\/+/,"/")})}function kp(e,t){Fn[e]=t}function jb(e){return ds(this,null,function*(){const t=!!Fn[e];return t&&(e=Fn[e]),(()=>ds(this,null,function*(){try{return yield Yi(e)}catch(n){if(e.endsWith(".webp")&&!t)try{return yield Yi(e.replace(/\.webp$/,".png"))}catch(o){return ue.fire(new or(e)),lr().remove(e),new rr}else return ue.fire(new or(e)),lr().remove(e),new rr}}))()})}function Yi(e){return new Promise((t,n)=>{const o=new Image;o.addEventListener("load",()=>{t(new ql(o)),q.supports.assetCaching||document.body.removeChild(o)}),o.addEventListener("error",s=>{t(new rr),q.supports.assetCaching||document.body.removeChild(o)}),o.crossOrigin="Anonymous",o.src=e,o.style.display="none",document.body.appendChild(o)})}const Ib=ee({props:{label:String,modelValue:{type:Boolean,default:!1}},computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},checkbox(){return this.$refs.checkbox}}});const ne=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},Tb={class:"toggle_box"},Eb=["id"],Bb=["for"],Ab=["for"];function Db(e,t,n,o,s,r){return g(),y("div",Tb,[de(u("input",{id:e._.uid,type:"checkbox",ref:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.value=i)},null,8,Eb),[[Lm,e.value]]),u("label",{for:e._.uid,class:"switch"},null,8,Bb),u("label",{for:e._.uid,class:"toggle_label"},fe(e.label),9,Ab)])}const Rt=ne(Ib,[["render",Db]]),Kl={methods:{verticalScrollRedirect(e){if(e.type!=="wheel"||!e.currentTarget)return;const t=e.currentTarget,n=getComputedStyle(t),o=e;if(o.deltaY===0)return;if(n.overflowY==="auto"){if(o.deltaY>0){if(t.scrollHeight>t.scrollTop+t.clientHeight){e.stopPropagation();return}}else if(t.scrollTop>0){e.stopPropagation();return}}const s=t.scrollLeft;t.scrollLeft+=o.deltaY,t.scrollLeft!==s&&e.stopPropagation()}}},st={mixins:[Kl],computed:{vertical(){return this.$store.state.ui.vertical}},mounted(){this.updateVertical(),this.$el.addEventListener("wheel",e=>{this.vertical||this.verticalScrollRedirect(e)},{passive:!0})},methods:{updateVertical(){!this.$el||(this.vertical?this.$el.classList.add("vertical"):this.$el.classList.remove("vertical"))}},watch:{vertical(){this.updateVertical()}}},Rb=window.HTMLDialogElement!=null,Hb=ee({props:{noBaseSize:Boolean,options:{type:Array,default:[]}},computed:{nativeDialogs(){return Rb}},methods:{open(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&!e.open&&e.showModal()}window.addEventListener("click",this.clickSomewhere)},close(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&e.open&&e.close(),this.$emit("leave")}window.removeEventListener("click",this.clickSomewhere)},clickSomewhere(e){const t=this.$refs.dialog;t&&t.open?e.target===t&&(this.close(),e.preventDefault(),e.stopPropagation()):window.removeEventListener("click",this.clickSomewhere)}},mounted(){this.open()},activated(){this.open()},deactivated(){this.close()},unmounted(){this.close()}});const Mb={key:0,id:"submit-options"},Fb=["onClick"],Nb={key:0,id:"submit-options"},Lb=["onClick"];function Ub(e,t,n,o,s,r){return e.nativeDialogs?(g(),y("dialog",{key:0,ref:"dialog",class:pe(["native",{"base-size":!e.noBaseSize}]),onCancel:t[0]||(t[0]=(...i)=>e.close&&e.close(...i))},[qt(e.$slots,"default",{},void 0,!0),e.options.length>0?(g(),y("div",Mb,[(g(!0),y(U,null,$e(e.options,i=>(g(),y("button",{key:i,class:"option",onClick:a=>e.$emit("option",i)},fe(i),9,Fb))),128))])):X("",!0)],34)):(g(),y("div",{key:1,class:"dialog-wrapper",onClick:t[2]||(t[2]=i=>e.$emit("leave"))},[u("dialog",{ref:"dialog",open:"",class:pe({"base-size":!e.noBaseSize}),onClick:t[1]||(t[1]=G(()=>{},["stop"]))},[qt(e.$slots,"default",{},void 0,!0),e.options.length>0?(g(),y("div",Nb,[(g(!0),y(U,null,$e(e.options,i=>(g(),y("button",{key:i,class:"option",onClick:a=>e.$emit("option",i)},fe(i),9,Lb))),128))])):X("",!0)],2)]))}const Yl=ne(Hb,[["render",Ub],["__scopeId","data-v-dfb4ac8d"]]),Vb=ee({mixins:[Kl],props:{to:{type:String,required:!0}},computed:{href(){let e=this.to;return e=e.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),e=e.replace(/^wiki:\/\/(.*)/,(t,n)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+n.replaceAll(" ","-")),e}}}),Wb=["href"];function zb(e,t,n,o,s,r){return g(),y("a",{target:"_blank",rel:"noopener noreferrer",href:e.href},[qt(e.$slots,"default")],8,Wb)}const Jl=ne(Vb,[["render",zb]]);var Gb=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});function Ji(e,t){return Gb(this,null,function*(){try{yield t()}catch(n){console.error("Error in promise",e,n),ue.fire(new Vl("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+e+'", '+qb(n)))}})}function qb(e){if(e instanceof Error){if(e.stack!=null){const t=e.stack.split(`
`);return t[0].includes(e.name)&&t[0].includes(e.message)?t[0]+`
<br />`+t[1]:e.name+": "+e.message+`
<br />`+t[0]}return e.name+": "+e.message}return e instanceof Object?JSON.stringify(e):""+e}var No=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Xb=ee({mixins:[st],components:{Toggle:Rt,ModalDialog:Yl,L:Jl},data:()=>({allowSavesModal:!1,denySavesModal:!1,waitOnSaveChange:!1,showModeDialog:!1}),computed:{savesAllowed:{get(){return q.savingEnabled},set(e){this.waitOnSaveChange=!0,q.savingEnabled=e,this.saveSettings()}},inPlusMode(){return q.gameMode==="ddlc_plus"},savesEnabledInEnv(){return q.supports.optionalSaving},lqAllowed(){return q.supports.lq},looseTextParsing:{get(){return q.state.looseTextParsing},set(e){q.state.looseTextParsing=e,this.saveSettings()}},lqRendering:{get(){return this.$store.state.ui.lqRendering},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setLqRendering",e)})),this.saveSettings()}},nsfw:{get(){return!!this.$store.state.ui.nsfw},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setNsfw",e),this.saveSettings()}))}},defaultCharacterTalkingZoom:{get(){return!!this.$store.state.ui.defaultCharacterTalkingZoom},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setDefaultCharacterTalkingZoom",e),this.saveSettings()}))}},theme:{get(){return this.$store.state.ui.useDarkTheme},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setDarkTheme",e),this.saveSettings()}))}},showDownloadFolder(){return q.supports.setDownloadFolder},downloadFolder(){return q.state.downloadLocation}},watch:{savesAllowed(){this.waitOnSaveChange=!1}},methods:{allowSaves(e){this.allowSavesModal=!1,e==="Allow"&&(this.savesAllowed=!0)},denySaves(e){this.denySavesModal=!1,e==="Deny"&&(this.savesAllowed=!1)},modeChange(e){Ji("changing modes",()=>No(this,null,function*(){e==="Enter Classic Mode"?yield q.setGameMode("ddlc"):e==="Enter Plus mode"?yield q.setGameMode("ddlc_plus"):this.showModeDialog=!1}))},saveSettings(){var e;q.saveSettings({lq:this.$store.state.ui.lqRendering,nsfw:this.$store.state.ui.nsfw,darkMode:(e=this.$store.state.ui.useDarkTheme)!=null?e:void 0,looseTextParsing:q.state.looseTextParsing,defaultCharacterTalkingZoom:this.$store.state.ui.defaultCharacterTalkingZoom})},setDownloadFolder(){q.updateDownloadFolder()},openDownloadFolder(){q.openFolder("downloads")}}});const pt=e=>(ze("data-v-11f6d92f"),e=e(),Ge(),e),Kb={class:"panel"},Yb=pt(()=>u("h1",null,"Settings",-1)),Jb={class:"modal-scroll-area"},Zb=pt(()=>u("p",null,"Do you want to allow DDDG to save settings on your device?",-1)),Qb=pt(()=>u("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),ev=pt(()=>u("p",null,"You can revoke this permission at any time.",-1)),tv={class:"modal-scroll-area"},nv=pt(()=>u("p",null,"Do you want to deny DDDG from saving settings on your device?",-1)),ov=pt(()=>u("p",null," This will cause all your settings to reset when leaving the page. ",-1)),sv=pt(()=>u("div",{class:"modal-scroll-area"},[u("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)),rv={key:0,disabled:""},iv=pt(()=>u("td",null,[u("label",null,"Theme:")],-1)),lv=pt(()=>u("option",{value:null},"System",-1)),av=pt(()=>u("option",{value:!1},"Light",-1)),dv=pt(()=>u("option",{value:!0},"Dark",-1)),cv=[lv,av,dv],uv={key:4,class:"downloadTable"},pv=pt(()=>u("td",null,[u("label",null,"Download folder:")],-1));function fv(e,t,n,o,s,r){const i=E("l"),a=E("modal-dialog"),l=E("toggle");return g(),y("div",Kb,[Yb,(g(),L(ip,{to:"#modal-messages"},[e.allowSavesModal?(g(),L(a,{key:0,options:["Allow","Deny"],onLeave:t[0]||(t[0]=d=>e.allowSaves("Deny")),onOption:e.allowSaves,"no-base-size":""},{default:B(()=>[u("div",Jb,[Zb,Qb,ev,u("p",null,[O(" Our usual "),C(i,{to:"wiki://Privacy Statement"},{default:B(()=>[O("privacy policy")]),_:1}),O(" still applies. ")])])]),_:1},8,["onOption"])):X("",!0),e.denySavesModal?(g(),L(a,{key:1,options:["Deny","Cancle"],onLeave:t[1]||(t[1]=d=>e.denySaves("Cancle")),onOption:e.denySaves,"no-base-size":""},{default:B(()=>[u("div",tv,[nv,ov,u("p",null,[O(" Our usual "),C(i,{to:"wiki://Privacy Statement"},{default:B(()=>[O("privacy policy")]),_:1}),O(" still applies. ")])])]),_:1},8,["onOption"])):X("",!0),e.showModeDialog?(g(),L(a,{key:2,options:[e.inPlusMode?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:t[2]||(t[2]=d=>e.showModeDialog=!1),onOption:e.modeChange,"no-base-size":""},{default:B(()=>[sv]),_:1},8,["options","onOption"])):X("",!0)])),e.waitOnSaveChange?(g(),y("button",rv,"Applying...")):!e.savesAllowed&&e.savesEnabledInEnv?(g(),y("button",{key:1,onClick:t[3]||(t[3]=d=>e.allowSavesModal=!0)}," Allow saving options ")):e.savesAllowed&&e.savesEnabledInEnv?(g(),y("button",{key:2,onClick:t[4]||(t[4]=d=>e.denySavesModal=!0)}," Deny saving options ")):X("",!0),u("button",{onClick:t[5]||(t[5]=d=>e.showModeDialog=!0)},[e.inPlusMode?(g(),y(U,{key:0},[O(" Enter Classic Mode ")],64)):(g(),y(U,{key:1},[O(" Enter DDLC Plus Mode ")],64))]),e.lqAllowed?(g(),L(l,{key:3,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:e.lqRendering,"onUpdate:modelValue":t[6]||(t[6]=d=>e.lqRendering=d)},null,8,["modelValue"])):X("",!0),C(l,{label:"NSFW Mode?",modelValue:e.nsfw,"onUpdate:modelValue":t[7]||(t[7]=d=>e.nsfw=d)},null,8,["modelValue"]),C(l,{label:"Enlarge talking objects? (Default value)",modelValue:e.defaultCharacterTalkingZoom,"onUpdate:modelValue":t[8]||(t[8]=d=>e.defaultCharacterTalkingZoom=d)},null,8,["modelValue"]),C(l,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:e.looseTextParsing,"onUpdate:modelValue":t[9]||(t[9]=d=>e.looseTextParsing=d)},null,8,["modelValue"]),u("table",null,[u("tr",null,[iv,u("td",null,[de(u("select",{"onUpdate:modelValue":t[10]||(t[10]=d=>e.theme=d)},cv,512),[[_t,e.theme]])])])]),e.showDownloadFolder?(g(),y("table",uv,[u("tr",null,[pv,u("td",null,fe(e.downloadFolder),1),u("td",null,[u("button",{onClick:t[11]||(t[11]=(...d)=>e.setDownloadFolder&&e.setDownloadFolder(...d))},"Set"),u("button",{onClick:t[12]||(t[12]=(...d)=>e.openDownloadFolder&&e.openDownloadFolder(...d))},"Open")])])])):X("",!0)])}const hv=ne(Xb,[["render",fv],["__scopeId","data-v-11f6d92f"]]),gv=ee({props:{icon:{type:String,required:!0},iconPos:{type:String,default:"left"},disabled:{type:Boolean,default:!1},shortcut:{type:String,default:null}},computed:{showPopup(){return this.shortcut!=null&&!this.shortcut.startsWith("!")},popupText(){const e=this.shortcut;return e==null?"":e.startsWith("!")?e.substring(1):e}}});const mv=["disabled"],bv={class:"material-icons","aria-hidden":"true"},vv={class:"content"},yv={key:0,class:"shortcut-popup"};function _v(e,t,n,o,s,r){return g(),y("button",{class:pe([e.iconPos]),disabled:e.disabled},[u("div",bv,fe(e.icon),1),u("div",vv,[qt(e.$slots,"default",{},void 0,!0)]),e.showPopup?(g(),y("div",yv,fe(e.popupText),1)):X("",!0)],10,mv)}const Ln=ne(gv,[["render",_v],["__scopeId","data-v-b2a4f97d"]]);var wv=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const $v=ee({components:{DButton:Ln},computed:{characters(){return this.$store.state.content.current.characters}},methods:{assetPath(e){return e.chibi?q.supports.lq?e.chibi.lq:e.chibi.hq:""},onChosen(e){this.vuexHistory.transaction(()=>wv(this,null,function*(){yield this.$store.dispatch("panels/createCharacters",{characterType:e,panelId:this.$store.state.panels.currentPanel})}))}}});const Cv=["title","onClick","onKeypress"],Pv=["src","alt"];function Sv(e,t,n,o,s,r){const i=E("d-button");return g(),y(U,null,[(g(!0),y(U,null,$e(e.characters,a=>(g(),y("div",{class:"character",tabindex:"0",key:a.id,title:a.label,onClick:G(l=>e.onChosen(a.id.toLowerCase()),["left"]),onKeypress:[Le(G(l=>e.onChosen(a.id.toLowerCase()),["prevent","stop"]),["enter"]),Le(G(l=>e.onChosen(a.id.toLowerCase()),["prevent","stop"]),["space"])]},[u("img",{src:e.assetPath(a),alt:a.label},null,8,Pv)],40,Cv))),128)),C(i,{class:"custom-sprite",icon:"extension",onClick:t[0]||(t[0]=a=>e.$emit("show-dialog","type: Characters"))},{default:B(()=>[O(" Search in content packs ")]),_:1})],64)}const kv=ne($v,[["render",Sv],["__scopeId","data-v-11c7e802"]]),Ov=ee({computed:{vertical(){return this.$store.state.ui.vertical}},data:()=>({visible:!1}),methods:{show(){this.visible=!0},hide(){this.visible=!1},drop(e){if(this.hide(),e.stopPropagation(),e.preventDefault(),!!e.dataTransfer)for(const t of e.dataTransfer.items)t.kind==="file"&&t.type.match(/image.*/)&&this.$emit("drop",t.getAsFile())}}});function xv(e,t,n,o,s,r){return e.visible?(g(),y("div",{key:0,onDragleave:t[0]||(t[0]=i=>e.visible=!1),onDrop:t[1]||(t[1]=(...i)=>e.drop&&e.drop(...i)),class:pe({vertical:e.vertical})},[qt(e.$slots,"default",{},void 0,!0)],34)):X("",!0)}const Op=ne(Ov,[["render",xv],["__scopeId","data-v-9b740976"]]);var jv=Object.defineProperty,Iv=Object.defineProperties,Tv=Object.getOwnPropertyDescriptors,Id=Object.getOwnPropertySymbols,Ev=Object.prototype.hasOwnProperty,Bv=Object.prototype.propertyIsEnumerable,Td=(e,t,n)=>t in e?jv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ed=(e,t)=>{for(var n in t||(t={}))Ev.call(t,n)&&Td(e,n,t[n]);if(Id)for(var n of Id(t))Bv.call(t,n)&&Td(e,n,t[n]);return e},Bd=(e,t)=>Iv(e,Tv(t)),Ft=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Ad={packId:"dddg.uploads.sprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Av=ee({mixins:[st],components:{DropTarget:Op,DButton:Ln},computed:{sprites(){return this.$store.state.content.current.sprites.map(e=>{let t=null;const n=e.variants[0].map(o=>{const s=Mn(o,!1);return s.startsWith("uploads:")?(Object.keys(this.$store.state.uploadUrls),t=s,Cp):s});return Bd(Ed({},e),{missing:t,urls:n})})},showSpritesFolder(){return q.supports.openableFolders.has("sprites")}},methods:{assetSpriteBackground(e){return e.variants[0].map(t=>`url('${Mn(t,!1)}')`).join(",")},showDropTarget(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.spriteDt.show()))},hideDropTarget(){this.$refs.spriteDt.hide()},onSpriteFileUpload(){const e=this.$refs.spriteUpload;if(!!e.files)for(const t of e.files)this.addCustomSpriteFile(t)},onMissingSpriteFileUpload(e){return Ft(this,null,function*(){const t=this.$refs.missingSpriteUpload,n=t.uploadingSprite;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const o=t.files[0];yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){const s=URL.createObjectURL(o);yield this.$store.dispatch("uploadUrls/add",{name:n,url:s})}))})},uploadFromURL(){return Ft(this,null,function*(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){yield this.addNewCustomSprite(t,e)}))})},addSpriteToScene(e){return Ft(this,null,function*(){yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){yield this.$store.dispatch("panels/createSprite",{panelId:this.$store.state.panels.currentPanel,assets:e.variants[0]})}))})},reuploadingSprite(e){const t=this.$refs.missingSpriteUpload;t.uploadingSprite=Mn(e.variants[0][0]).substring(8),t.click()},addCustomSpriteFile(e){return Ft(this,null,function*(){yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){const t=URL.createObjectURL(e),n=yield this.$store.dispatch("uploadUrls/add",{name:e.name,url:t});yield this.addNewCustomSprite(e.name,n)}))})},addNewCustomSprite(e,t){return Ft(this,null,function*(){const n=this.$store.state.content.contentPacks.find(s=>s.packId===Ad.packId)||Ad,o=Bd(Ed({},n),{sprites:[...n.sprites,{id:t,label:e,variants:[[{lq:t,hq:t}]],defaultScale:[1,1],hd:null}]});yield this.$store.dispatch("content/replaceContentPack",{contentPack:o,processed:!0})})},openSpritesFolder(){q.openFolder("sprites")}}});const Dv=["title","onClick","onKeypress"],Rv=["title","onClick","onKeypress"];function Hv(e,t,n,o,s,r){const i=E("drop-target"),a=E("d-button");return g(),y("div",{class:pe(["sub-item-grid",{vertical:e.vertical}]),onDragenter:t[4]||(t[4]=(...l)=>e.showDropTarget&&e.showDropTarget(...l)),onMouseleave:t[5]||(t[5]=(...l)=>e.hideDropTarget&&e.hideDropTarget(...l))},[C(i,{ref:"spriteDt",class:"drop-target",onDrop:e.addCustomSpriteFile},{default:B(()=>[O("Drop here to add as a new sprite ")]),_:1},8,["onDrop"]),(g(!0),y(U,null,$e(e.sprites,l=>(g(),y(U,null,[l.missing!==null?(g(),y("div",{class:"sprite",tabindex:"0",key:l.label,title:l.label,style:Re({background:e.assetSpriteBackground(l)}),onClick:d=>e.reuploadingSprite(l),onKeypress:[Le(G(d=>e.reuploadingSprite(l),["prevent","stop"]),["enter"]),Le(G(d=>e.reuploadingSprite(l),["prevent","stop"]),["space"])]},fe(l.label),45,Dv)):(g(),y("div",{class:"sprite",tabindex:"0",key:l.label,title:l.label,style:Re({background:e.assetSpriteBackground(l)}),onClick:d=>e.addSpriteToScene(l),onKeypress:[Le(G(d=>e.addSpriteToScene(l),["prevent","stop"]),["enter"]),Le(G(d=>e.addSpriteToScene(l),["prevent","stop"]),["space"])]},fe(l.label),45,Rv))],64))),256)),C(a,{class:"custom-sprite",icon:"publish",onClick:t[1]||(t[1]=l=>e.$refs.spriteUpload.click())},{default:B(()=>[O(" Upload new sprite "),u("input",{type:"file",ref:"spriteUpload",onChange:t[0]||(t[0]=(...l)=>e.onSpriteFileUpload&&e.onSpriteFileUpload(...l))},null,544)]),_:1}),C(a,{icon:"insert_link",onClick:e.uploadFromURL},{default:B(()=>[O(" New sprite from URL ")]),_:1},8,["onClick"]),C(a,{icon:"extension",onClick:t[2]||(t[2]=l=>e.$emit("show-dialog","type: Sprites"))},{default:B(()=>[O(" Search in content packs ")]),_:1}),e.showSpritesFolder?(g(),L(a,{key:0,icon:"folder",onClick:e.openSpritesFolder},{default:B(()=>[O(" Open sprites folder ")]),_:1},8,["onClick"])):X("",!0),u("input",{type:"file",ref:"missingSpriteUpload",onChange:t[3]||(t[3]=(...l)=>e.onMissingSpriteFileUpload&&e.onMissingSpriteFileUpload(...l))},null,544)],34)}const Mv=ne(Av,[["render",Hv],["__scopeId","data-v-08f94fb6"]]);var xn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Fv=ee({components:{DButton:Ln},methods:{addTextBox(){return xn(this,null,function*(){return yield this.createUiElement("createTextBox")})},addChoice(){return xn(this,null,function*(){return yield this.createUiElement("createChoice")})},addDialog(){return xn(this,null,function*(){return yield this.createUiElement("createNotification")})},addPoem(){return xn(this,null,function*(){return yield this.createUiElement("createPoem")})},addConsole(){return xn(this,null,function*(){return yield this.createUiElement("createConsole")})},createUiElement(e){return xn(this,null,function*(){this.vuexHistory.transaction(()=>xn(this,null,function*(){yield this.$store.dispatch(`panels/${e}`,{panelId:this.$store.state.panels.currentPanel})}))})}}});function Nv(e,t,n,o,s,r){return g(),y(U,null,[u("button",{onClick:t[0]||(t[0]=(...i)=>e.addTextBox&&e.addTextBox(...i))},"Textbox"),u("button",{onClick:t[1]||(t[1]=(...i)=>e.addPoem&&e.addPoem(...i))},"Poem"),u("button",{onClick:t[2]||(t[2]=(...i)=>e.addDialog&&e.addDialog(...i))},"Notification"),u("button",{onClick:t[3]||(t[3]=(...i)=>e.addChoice&&e.addChoice(...i))},"Choice"),u("button",{onClick:t[4]||(t[4]=(...i)=>e.addConsole&&e.addConsole(...i))},"Console")],64)}const Lv=ne(Fv,[["render",Nv]]);var Uv=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Vv=ee({mixins:[st],components:{DButton:Ln,Characters:kv,Sprites:Mv,UI:Lv},data:()=>({group:"characters",groups:{characters:{icon:"emoji_people",text:"Char&shy;acters"},sprites:{icon:"change_history",text:"Sprites"},ui:{icon:"view_quilt",text:"UI"}}}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},hasClipboardContent(){return this.$store.state.ui.clipboard!=null},showSpritesFolder(){return q.supports.openableFolders.has("sprites")}},methods:{paste(){this.vuexHistory.transaction(()=>Uv(this,null,function*(){yield this.$store.dispatch("panels/pasteObjectFromClipboard",{panelId:this.currentPanel.id})}))}}});const Wv=e=>(ze("data-v-1a6b7167"),e=e(),Ge(),e),zv={class:"panel"},Gv=Wv(()=>u("h1",null,"Add",-1)),qv=["innerHTML"],Xv=["disabled"];function Kv(e,t,n,o,s,r){const i=E("d-button"),a=E("Characters"),l=E("Sprites"),d=E("UI");return g(),y("div",zv,[Gv,u("div",{class:pe({"group-selector":!0,vertical:e.vertical})},[(g(!0),y(U,null,$e(e.groups,(c,p)=>(g(),L(i,{key:p,class:pe({active:e.group===p}),"icon-pos":"top",icon:c.icon,onClick:f=>e.group=p},{default:B(()=>[u("span",{innerHTML:c.text},null,8,qv)]),_:2},1032,["class","icon","onClick"]))),128))],2),u("div",{class:pe({"item-grid":!0,vertical:e.vertical})},[e.group==="characters"?(g(),L(a,{key:0,onShowDialog:t[0]||(t[0]=c=>e.$emit("show-dialog",c))})):e.group==="sprites"?(g(),L(l,{key:1,onShowDialog:t[1]||(t[1]=c=>e.$emit("show-dialog",c))})):e.group==="ui"?(g(),L(d,{key:2})):X("",!0),u("button",{onClick:t[2]||(t[2]=(...c)=>e.paste&&e.paste(...c)),disabled:!e.hasClipboardContent},"Paste",8,Xv)],2)])}const Yv=ne(Vv,[["render",Kv],["__scopeId","data-v-1a6b7167"]]);function Go(e,t,n){let o=t+n;const s=e.length;return o<0&&(o+=s),o>=s&&(o-=s),o}const Br=1280,Zl=720,Jv=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Zv=1,Qv=1/1.5,ey=-74,ty=-26,ny=[200,240,400,493,640,786,880,1040,1080],oy=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Br,screenHeight:Zl,positions:Jv,sdCharacterScaleFactor:Zv,hdCharacterScaleFactor:Qv,CloseUpYOffset:ey,BaseCharacterYPos:ty,characterPositions:ny},Symbol.toStringTag,{value:"Module"}));var sy=Object.defineProperty,ry=(e,t,n)=>t in e?sy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ar=(e,t,n)=>(ry(e,typeof t!="symbol"?t+"":t,n),n);const Zn=class{constructor(e,t,n,o){this.r=e,this.g=t,this.b=n,this.a=o}static validCss(e){return this.validCssRgb(e)||this.validHex(e)}static fromCss(e){if(this.validCssRgb(e))return this.fromCssRgb(e);if(this.validHex(e))return this.fromHex(e);throw new Error("Invalid RGB color format")}static validCssRgb(e){return this.rgbEx.test(e)||this.rgbaEx.test(e)}static fromCssRgb(e){if(!this.validCssRgb(e))throw new Error("Invalid RGB color format");const t=e.slice(0,-1),n=t.indexOf("("),s=t.slice(n+1).split(",").map(r=>parseFloat(r.trim()));return new Zn(s[0],s[1],s[2],s.length===4?s[3]:1)}static validHex(e){return this.hexShortEx.test(e)||this.hexLongEx.test(e)}static fromHex(e){if(!this.validHex(e))throw new Error("Invalid Hex color format");const t=e.slice(1);if(t.length===3)return new Zn(parseInt(t[0]+t[0],16),parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),1);if(t.length===4)return new Zn(parseInt(t[0]+t[0],16),parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)/255);if(t.length===6)return new Zn(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16),1);if(t.length===8)return new Zn(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16),parseInt(t[6]+t[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:e,g:t,b:n}=this;const{a:o}=this;e/=255,t/=255,n/=255;const s=Math.max(e,t,n),r=Math.min(e,t,n);let i,a;const l=(s+r)/2;if(s===r)i=a=0;else{const d=s-r;switch(a=l>.5?d/(2-s-r):d/(s+r),s){case e:i=(t-n)/d+(t<n?6:0);break;case t:i=(n-e)/d+2;break;case n:i=(e-t)/d+4;break}i/=6}return new me(i,a,l,o)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};let ae=Zn;Ar(ae,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i);Ar(ae,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i);Ar(ae,"hexShortEx",/^#[0-9A-Z]{3,4}$/i);Ar(ae,"hexLongEx",/^#[0-9A-Z]{6,8}$/i);class me{constructor(t,n,o,s){this.h=t,this.s=n,this.l=o,this.a=s,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(t){let{h:n,s:o,l:s,a:r}=this;return n+=t.h,n>=1?n-=1:n<0&&(n+=1),o+t.s>1?o-=t.s:(o+=t.s,o<0&&(o=0)),s+t.l>1||s+t.l<0?s-=t.l:s+=t.l,r+t.a>1||r+t.a<0?r-=t.a:r+=t.a,new me(n,o,s,r)}toRgb(){const{h:t,s:n,l:o,a:s}=this;let r,i,a;if(n===0)r=i=a=o;else{const l=o<.5?o*(1+n):o+n-o*n,d=2*o-l;r=me.hue2rgb(d,l,t+1/3),i=me.hue2rgb(d,l,t),a=me.hue2rgb(d,l,t-1/3)}return new ae(Math.round(r*255),Math.round(i*255),Math.round(a*255),s)}toHSL(){return this}static hue2rgb(t,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?t+(n-t)*6*o:o<1/2?n:o<2/3?t+(n-t)*(2/3-o)*6:t}}const iy=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),ly="#ffe6f4",ay="#ffbde1",dy=420,cy=22,uy=640,xp=270,py=7,fy=3,hy=(Zl-xp)/2,gy={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},my=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:iy,ChoiceButtonColor:ly,ChoiceButtonBorderColor:ay,ChoiceButtonWidth:dy,ChoiceSpacing:cy,ChoiceX:uy,ChoiceYOffset:xp,ChoicePadding:py,Outline:fy,ChoiceY:hy,ChoiceTextStyle:gy},Symbol.toStringTag,{value:"Module"})),jp="#ffa8d2",by="#552222",vy="#ffeef6",Ql="#bb5599",Ip=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Tp=new me(.002028397565922768,0,.13725490196078438,0),Ep=.82,Bp=new me(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Ap=12,yy=1.5,Zi=12,Ut=1.5,_y=.6,wy=new me(.08045977011494243,-.5714285714285714,-.5960784313725489,0),$y=new me(0,-.14285714285714296,.3,0),Dp=new me(.004269293924466178,-.01869158878504662,-.039215686274509665,0),Qi=9.5,Vt=47,Rp=new me(.0023347701149424305,0,.10784313725490202,0),Hp=3,Cy=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:jp,controlsDefaultColor:by,nameboxDefaultColor:vy,nameboxStrokeDefaultColor:Ql,nameboxTextOutlineDelta:Ip,nameboxBackgroundDelta:Tp,nameboxGradientMiddleStopPosition:Ep,nameboxGradientEndDelta:Bp,nameboxRounding:Ap,nameboxRoundingBuffer:yy,textboxRounding:Zi,textboxRoundingBuffer:Ut,nameColorThreshold:_y,controlColorDelta:wy,controlDisableColorDelta:$y,dotColorDelta:Dp,dotRadius:Qi,dotPatternSize:Vt,textboxOutlineColorDelta:Rp,textboxOutlineWidth:Hp},Symbol.toStringTag,{value:"Module"}));var Py=Object.defineProperty,Sy=Object.defineProperties,ky=Object.getOwnPropertyDescriptors,Dd=Object.getOwnPropertySymbols,Oy=Object.prototype.hasOwnProperty,xy=Object.prototype.propertyIsEnumerable,Rd=(e,t,n)=>t in e?Py(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mp=(e,t)=>{for(var n in t||(t={}))Oy.call(t,n)&&Rd(e,n,t[n]);if(Dd)for(var n of Dd(t))xy.call(t,n)&&Rd(e,n,t[n]);return e},Fp=(e,t)=>Sy(e,ky(t));const Oo=816,ea=900,Dr=146,jy=0,Iy=29,Ty=8,gs=38,Rr=44,Ey=6,By=93,Ay=404,Dy=9,Ry=9,Et=39,ms=168,bs=34,Hr=29,ta=12,na=-126,oa=-72,sa=-38,ra=30.75,ia=26,Np=426,el=58,la={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Mr=Fp(Mp({},la),{fontName:"riffic",fontSize:24,strokeColor:Ql,strokeWidth:6,color:"white",letterSpacing:1}),aa={align:"left",font:"13px aller",fill:{style:"#522"}},Lp=Fp(Mp({},aa),{fill:{style:"#a66"}}),Hy={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},da={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},xo=Br/2-Oo/2,My=Br/2-ea/2,Fy=xo+gs,Up=xo+bs,Ny=Up+ms/2,Ly=xo+na,Uy=xo+oa,Vy=xo+sa,Wy="normal",zy=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:Oo,TextBoxCorruptedWidth:ea,TextBoxHeight:Dr,TextBoxKerning:jy,TextBoxLineHeight:Iy,TextBoxCorruptedKerning:Ty,TextBoxTextXOffset:gs,TextBoxTextYOffset:Rr,TextBoxBottomSpacing:Ey,HdSpacing:By,HdSideMargin:Ay,TextBoxTextCorruptedXOffset:Dy,TextBoxTextCorruptedYOffset:Ry,NameboxHeight:Et,NameboxWidth:ms,NameboxXOffset:bs,NameboxTextYOffset:Hr,ControlsYBottomOffset:ta,ControlsXHistoryOffset:na,ControlsXSkipOffset:oa,ControlsXStuffOffset:sa,ArrowXRightOffset:ra,ArrowYBottomOffset:ia,GlowRX:Np,GlowRY:el,BaseTextStyle:la,NameboxTextStyle:Mr,ControlsTextStyle:aa,ControlsTextDisabledStyle:Lp,TextBoxCorruptedStyle:Hy,TextBoxStyle:da,TextBoxX:xo,TextBoxCorruptedX:My,TextBoxTextX:Fy,NameboxX:Up,NameboxTextX:Ny,ControlsXHistory:Ly,ControlsXSkip:Uy,ControlsXStuff:Vy,DefaultTextboxStyle:Wy},Symbol.toStringTag,{value:"Module"}));var Gy=Object.defineProperty,qy=Object.defineProperties,Xy=Object.getOwnPropertyDescriptors,Hd=Object.getOwnPropertySymbols,Ky=Object.prototype.hasOwnProperty,Yy=Object.prototype.propertyIsEnumerable,Md=(e,t,n)=>t in e?Gy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Jy=(e,t)=>{for(var n in t||(t={}))Ky.call(t,n)&&Md(e,n,t[n]);if(Hd)for(var n of Hd(t))Yy.call(t,n)&&Md(e,n,t[n]);return e},Zy=(e,t)=>qy(e,Xy(t));const Qy="#ffe6f4",e_="#ffbde1",t_="rgba(255,255,255,0.6)",n_=40,o_=30,s_=Zy(Jy({},la),{fontName:"riffic",fontSize:24,strokeColor:Ql,strokeWidth:8,letterSpacing:1,color:"white"}),r_={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},i_=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:Qy,NotificationBorderColor:e_,NotificationBackdropColor:t_,NotificationPadding:n_,NotificationSpacing:o_,NotificationOkTextStyle:s_,NotificationTextStyle:r_},Symbol.toStringTag,{value:"Module"}));var l_=Object.defineProperty,a_=Object.defineProperties,d_=Object.getOwnPropertyDescriptors,Fd=Object.getOwnPropertySymbols,c_=Object.prototype.hasOwnProperty,u_=Object.prototype.propertyIsEnumerable,Nd=(e,t,n)=>t in e?l_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,on=(e,t)=>{for(var n in t||(t={}))c_.call(t,n)&&Nd(e,n,t[n]);if(Fd)for(var n of Fd(t))u_.call(t,n)&&Nd(e,n,t[n]);return e},sn=(e,t)=>a_(e,d_(t));const Vp=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],p_=0,f_=0,h_=Br/2,g_=Zl/2,m_=33,b_=100,v_=30,y_=800,__=720,w_="rgba(51,51,51,0.75)",$_=480,C_=180,P_=3,S_=7,rn={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Wp=[sn(on({},rn),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),sn(on({},rn),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),sn(on({},rn),{name:"Monika",fontName:"journal",fontSize:34}),sn(on({},rn),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),sn(on({},rn),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),sn(on({},rn),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),sn(on({},rn),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),sn(on({},rn),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})],k_=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:Vp,defaultPoemBackground:p_,defaultPoemStyle:f_,defaultX:h_,defaultY:g_,poemTopPadding:m_,poemBottomPadding:b_,poemPadding:v_,defaultPoemWidth:y_,defaultPoemHeight:__,consoleBackgroundColor:w_,consoleWidth:$_,consoleHeight:C_,defaultConsoleBackground:P_,defaultConsoleStyle:S_,poemTextStyles:Wp},Symbol.toStringTag,{value:"Module"})),O_={Base:oy,Choices:my,Notification:i_,Poem:k_,TextBox:zy,TextBoxCustom:Cy},Fr=1920,ca=1080,x_=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],j_=1.5,I_=1,T_=-111,E_=-39,B_=[300,360,600,740,960,1180,1320,1560,1620],A_=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Fr,screenHeight:ca,positions:x_,sdCharacterScaleFactor:j_,hdCharacterScaleFactor:I_,CloseUpYOffset:T_,BaseCharacterYPos:E_,characterPositions:B_},Symbol.toStringTag,{value:"Module"})),D_=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),R_="#ffe6f4",H_="#ffbde1",M_=630,F_=33,N_=960,zp=405,L_=10.5,U_=4.5,V_=(ca-zp)/2,W_={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},z_=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:D_,ChoiceButtonColor:R_,ChoiceButtonBorderColor:H_,ChoiceButtonWidth:M_,ChoiceSpacing:F_,ChoiceX:N_,ChoiceYOffset:zp,ChoicePadding:L_,Outline:U_,ChoiceY:V_,ChoiceTextStyle:W_},Symbol.toStringTag,{value:"Module"})),Gp="#ffa8d2",G_="#552222",q_="#ffeef6",ua="#bb5599",qp=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Xp=new me(.002028397565922768,0,.13725490196078438,0),Kp=.82,Yp=new me(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Jp=15,X_=1.5,tl=19,Wt=1.5,K_=.6,Y_=new me(.08045977011494243,-.5714285714285714,-.5960784313725489,0),J_=new me(0,-.14285714285714296,.3,0),Zp=new me(.004269293924466178,-.01869158878504662,-.039215686274509665,0),nl=9.5*1.5,zt=47*1.5,Qp=new me(.0023347701149424305,0,.10784313725490202,0),ef=5,Z_=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:Gp,controlsDefaultColor:G_,nameboxDefaultColor:q_,nameboxStrokeDefaultColor:ua,nameboxTextOutlineDelta:qp,nameboxBackgroundDelta:Xp,nameboxGradientMiddleStopPosition:Kp,nameboxGradientEndDelta:Yp,nameboxRounding:Jp,nameboxRoundingBuffer:X_,textboxRounding:tl,textboxRoundingBuffer:Wt,nameColorThreshold:K_,controlColorDelta:Y_,controlDisableColorDelta:J_,dotColorDelta:Zp,dotRadius:nl,dotPatternSize:zt,textboxOutlineColorDelta:Qp,textboxOutlineWidth:ef},Symbol.toStringTag,{value:"Module"}));var Q_=Object.defineProperty,ew=Object.defineProperties,tw=Object.getOwnPropertyDescriptors,Ld=Object.getOwnPropertySymbols,nw=Object.prototype.hasOwnProperty,ow=Object.prototype.propertyIsEnumerable,Ud=(e,t,n)=>t in e?Q_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tf=(e,t)=>{for(var n in t||(t={}))nw.call(t,n)&&Ud(e,n,t[n]);if(Ld)for(var n of Ld(t))ow.call(t,n)&&Ud(e,n,t[n]);return e},nf=(e,t)=>ew(e,tw(t));const pa=1220,of=900,sf=219,sw=0,rw=29,iw=8,fa=57,rf=68,lw=54,aw=9,dw=9,to=59,ha=252,ga=49,lf=43,af=12*1.5,df=-126*1.5,cf=-72*1.5,uf=-38*1.5,pf=30.75*1.5,ff=26*1.5,hf=426*1.5,ol=58*1.5,ma={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},gf=nf(tf({},ma),{fontName:"riffic",fontSize:36,strokeColor:ua,strokeWidth:9,color:"white",letterSpacing:2}),ar={align:"left",font:"24px aller",fill:{style:"#522"}},mf=nf(tf({},ar),{fill:{style:"#a66"}}),bf={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},cw={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},jo=Fr/2-pa/2,uw=Fr/2-of/2,pw=jo+fa,vf=jo+ga,fw=vf+ha/2,hw=jo+df,gw=jo+cf,mw=jo+uf,bw="custom_plus",vw=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:pa,TextBoxCorruptedWidth:of,TextBoxHeight:sf,TextBoxKerning:sw,TextBoxLineHeight:rw,TextBoxCorruptedKerning:iw,TextBoxTextXOffset:fa,TextBoxTextYOffset:rf,TextBoxBottomSpacing:lw,TextBoxTextCorruptedXOffset:aw,TextBoxTextCorruptedYOffset:dw,NameboxHeight:to,NameboxWidth:ha,NameboxXOffset:ga,NameboxTextYOffset:lf,ControlsYBottomOffset:af,ControlsXHistoryOffset:df,ControlsXSkipOffset:cf,ControlsXStuffOffset:uf,ArrowXRightOffset:pf,ArrowYBottomOffset:ff,GlowRX:hf,GlowRY:ol,BaseTextStyle:ma,NameboxTextStyle:gf,ControlsTextStyle:ar,ControlsTextDisabledStyle:mf,TextBoxStyle:bf,TextBoxCorruptedStyle:cw,TextBoxX:jo,TextBoxCorruptedX:uw,TextBoxTextX:pw,NameboxX:vf,NameboxTextX:fw,ControlsXHistory:hw,ControlsXSkip:gw,ControlsXStuff:mw,DefaultTextboxStyle:bw},Symbol.toStringTag,{value:"Module"}));var yw=Object.defineProperty,_w=Object.defineProperties,ww=Object.getOwnPropertyDescriptors,Vd=Object.getOwnPropertySymbols,$w=Object.prototype.hasOwnProperty,Cw=Object.prototype.propertyIsEnumerable,Wd=(e,t,n)=>t in e?yw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pw=(e,t)=>{for(var n in t||(t={}))$w.call(t,n)&&Wd(e,n,t[n]);if(Vd)for(var n of Vd(t))Cw.call(t,n)&&Wd(e,n,t[n]);return e},Sw=(e,t)=>_w(e,ww(t));const kw="#ffe6f4",Ow="#ffbde1",xw="rgba(255,255,255,0.6)",jw=60,Iw=45,Tw=Sw(Pw({},ma),{fontName:"riffic",fontSize:36,strokeColor:ua,strokeWidth:12,letterSpacing:1,color:"white"}),Ew={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Bw=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:kw,NotificationBorderColor:Ow,NotificationBackdropColor:xw,NotificationPadding:jw,NotificationSpacing:Iw,NotificationOkTextStyle:Tw,NotificationTextStyle:Ew},Symbol.toStringTag,{value:"Module"}));var Aw=Object.defineProperty,Dw=Object.defineProperties,Rw=Object.getOwnPropertyDescriptors,zd=Object.getOwnPropertySymbols,Hw=Object.prototype.hasOwnProperty,Mw=Object.prototype.propertyIsEnumerable,Gd=(e,t,n)=>t in e?Aw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ln=(e,t)=>{for(var n in t||(t={}))Hw.call(t,n)&&Gd(e,n,t[n]);if(zd)for(var n of zd(t))Mw.call(t,n)&&Gd(e,n,t[n]);return e},an=(e,t)=>Dw(e,Rw(t));const Fw=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Nw=0,Lw=0,Uw=Fr/2,Vw=ca/2,Ww=33,zw=100,Gw=30,qw=800,Xw=720,Kw="rgba(51,51,51,0.75)",Yw=480,Jw=180,Zw=3,Qw=7,dn={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},e$=[an(ln({},dn),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),an(ln({},dn),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),an(ln({},dn),{name:"Monika",fontName:"journal",fontSize:34}),an(ln({},dn),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),an(ln({},dn),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),an(ln({},dn),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),an(ln({},dn),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),an(ln({},dn),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})],t$=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:Fw,defaultPoemBackground:Nw,defaultPoemStyle:Lw,defaultX:Uw,defaultY:Vw,poemTopPadding:Ww,poemBottomPadding:zw,poemPadding:Gw,defaultPoemWidth:qw,defaultPoemHeight:Xw,consoleBackgroundColor:Kw,consoleWidth:Yw,consoleHeight:Jw,defaultConsoleBackground:Zw,defaultConsoleStyle:Qw,poemTextStyles:e$},Symbol.toStringTag,{value:"Module"})),n$={Base:A_,Choices:z_,Notification:Bw,Poem:t$,TextBox:vw,TextBoxCustom:Z_};function Y(){return q.gameMode==="ddlc_plus"?n$:O_}function Io(){return{flip:!1,rotation:0,version:0,opacity:100,x:Y().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,zoom:1}}var o$=Object.defineProperty,s$=Object.defineProperties,r$=Object.getOwnPropertyDescriptors,qd=Object.getOwnPropertySymbols,i$=Object.prototype.hasOwnProperty,l$=Object.prototype.propertyIsEnumerable,Xd=(e,t,n)=>t in e?o$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dr=(e,t)=>{for(var n in t||(t={}))i$.call(t,n)&&Xd(e,n,t[n]);if(qd)for(var n of qd(t))l$.call(t,n)&&Xd(e,n,t[n]);return e},a$=(e,t)=>s$(e,r$(t)),d$=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const c$={setPose(e,t){const n=e.panels[t.panelId].objects[t.id];n.poseId=t.poseId,++n.version},setCharStyleGroup(e,{id:t,panelId:n,styleGroupId:o}){const s=e.panels[n].objects[t];s.styleGroupId=o,++s.version},setCharStyle(e,{id:t,panelId:n,styleId:o}){const s=e.panels[n].objects[t];s.styleId=o,++s.version},setClose(e,t){const n=e.panels[t.panelId].objects[t.id];n.close=t.close,++n.version},setPosePosition(e,t){const n=e.panels[t.panelId].objects[t.id];n.posePositions=dr(dr({},n.posePositions),t.posePositions),++n.version},setFreeMove(e,t){const n=e.panels[t.panelId].objects[t.id];if(n.freeMove=t.freeMove,!n.freeMove){const o=Y();n.x=o.Base.characterPositions[ur(n.x)],n.y=o.Base.BaseCharacterYPos}}};function Nr(e,t){return e.getters["content/getCharacters"].get(t.characterType)}function jn(e,t){return e["content/getCharacters"].get(t)}function bn(e,t){return e.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId]}function u$(e,t){const n=bn(e,t),o=[...Object.keys(n.positions).filter(s=>n.positions[s].length>1)];return n.compatibleHeads.length>0&&o.unshift("head"),o}function cr(e,t,n=t.posePositions.headType||0){const o=bn(e,t).compatibleHeads;return o.length===0?null:e.heads[o[n]]}function ur(e){return Y().Base.characterPositions.map((o,s)=>({pos:Math.abs(e-o),idx:s})).sort((o,s)=>o.pos-s.pos)[0].idx}const p$={createCharacters({rootState:e,rootGetters:t,commit:n,state:o},s){var r;const i=o.panels[s.panelId].lastObjId+1,a=Y(),l=jn(t,s.characterType),d=l.hd?a.Base.hdCharacterScaleFactor:a.Base.sdCharacterScaleFactor;return n("create",{object:a$(dr({},Io()),{id:i,panelId:e.panels.currentPanel,onTop:!1,type:"character",y:a.Base.BaseCharacterYPos,preserveRatio:!0,ratio:1,width:l.size[0]*l.defaultScale[0]*d,height:l.size[1]*l.defaultScale[1]*d,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:(r=l.label)!=null?r:l.id,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom})}),i},seekPart({state:e,commit:t,dispatch:n,rootGetters:o},{delta:s,id:r,panelId:i,part:a}){if(a==="head"){n("seekHead",{id:r,panelId:i,delta:s});return}const l=e.panels[i].objects[r],d=bn(jn(o,l.characterType),l);!d.positions[a]||t("setPosePosition",{id:r,panelId:i,posePositions:{[a]:Go(d.positions[a],l.posePositions[a]||0,s)}})},seekPose({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=a.styleGroups[i.styleGroupId].styles[i.styleId].poses;Gn(t,i,a,d=>{d.poseId=Go(l,d.poseId,r)})},seekStyle({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=a.styleGroups.flatMap((c,p)=>c.styles.map((f,b)=>({styleGroupIdx:p,styleIdx:b,styleGroupJson:JSON.stringify(f.components)}))).sort((c,p)=>c.styleGroupJson.localeCompare(p.styleGroupJson)),d=l.findIndex(c=>c.styleGroupIdx===i.styleGroupId&&c.styleIdx===i.styleId);Gn(t,i,a,c=>{const p=Go(l,d,r),f=l[p];c.styleGroupId=f.styleGroupIdx,c.styleId=f.styleIdx})},seekHead({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=bn(a,i);let d=cr(a,i);if(!d)return;let c=(i.posePositions.head||0)+r,p=i.posePositions.headType||0;(c<0||c>=d.variants.length)&&(p=Go(l.compatibleHeads.map(f=>a.heads[f]),p,r),d=cr(a,i,p),c=r===1?0:d.variants.length-1),t("setPosePosition",{id:o,panelId:s,posePositions:{head:c,headType:p}})},setPart({state:e,commit:t,rootGetters:n},{panelId:o,id:s,part:r,val:i}){const a=e.panels[o].objects[s],l=jn(n,a.characterType);r==="pose"?Gn(t,a,l,d=>{d.poseId=i}):r==="style"?Gn(t,a,l,d=>{d.styleId=i}):Gn(t,a,l,d=>{d.posePositions[r]=i})},setCharStyle({state:e,commit:t,rootGetters:n},{panelId:o,id:s,styleGroupId:r,styleId:i}){const a=e.panels[o].objects[s],l=jn(n,a.characterType);Gn(t,a,l,d=>{d.styleGroupId=r,d.styleId=i})},setCharacterPosition({state:e,commit:t},{panelId:n,id:o,x:s,y:r}){const i=e.panels[n].objects[o];if(!i.freeMove){const a=Y();s=a.Base.characterPositions[ur(s)],r=a.Base.BaseCharacterYPos+(i.close?a.Base.CloseUpYOffset:0)}i.x===s&&i.y===r||t("setPosition",{panelId:n,id:o,x:s,y:r})},shiftCharacterSlot({state:e,commit:t},{panelId:n,id:o,delta:s}){const r=e.panels[n].objects[o],i=Y();let l=ur(r.x)+s;l<0&&(l=0),l>=i.Base.characterPositions.length&&(l=i.Base.characterPositions.length-1),t("setPosition",{panelId:n,id:o,x:i.Base.characterPositions[l],y:r.y})}};function f$(e,t,n,o){return d$(this,null,function*(){const s=e.state.panels[t].objects[n],r=o.characters.find(j=>j.id===s.characterType);if(!r){console.error("Character data is missing. Dropping the character."),yield e.dispatch("removeObject",{id:n,panelId:t});return}const i=yf(s),a=r.styleGroups[s.styleGroupId],l=a.styles[i.styleId],d=l.poses[i.poseId],c=e.rootState.content.current.characters.find(j=>j.id===r.id);if(!c){console.error("Character data is missing. Dropping the character."),yield e.dispatch("removeObject",{id:n,panelId:t});return}const p=c.styleGroups.findIndex(j=>j.id===a.id);i.styleGroupId=p===-1?0:p;const f=c.styleGroups[i.styleGroupId],b=JSON.stringify(l.components),v=f.styles.findIndex(j=>JSON.stringify(j.components)===b);i.styleId=v===-1?0:v;const w=f.styles[i.styleId],H=w.poses.findIndex(j=>j.id===d.id);i.poseId=H===-1?0:H;const D=w.poses[i.poseId];for(const j in D.positions){if(!D.positions.hasOwnProperty(j))continue;const K=D.positions[j];if(d.positions[j]){const Q=i.posePositions[j];Q>=0&&Q<K.length}}const $=d.compatibleHeads[s.posePositions.headType],x=D.compatibleHeads.indexOf($);if(x===-1)i.posePositions.headType=0,i.posePositions.head=0;else{x!==s.posePositions.headType&&(i.posePositions.headType=x);const j=JSON.stringify(r.heads[$].variants[s.posePositions.head]),K=c.heads[$].variants.findIndex(Q=>JSON.stringify(Q)===j);K===-1?i.posePositions.head=0:i.posePositions.head=K}_f(e.commit,s,i)})}function yf(e){return{styleGroupId:e.styleGroupId,styleId:e.styleId,poseId:e.poseId,posePositions:dr({},e.posePositions)}}function _f(e,t,n){n.styleGroupId!==t.styleGroupId&&e("setCharStyleGroup",{id:t.id,panelId:t.panelId,styleGroupId:n.styleGroupId}),n.styleId!==t.styleId&&(console.log(`Setting style of ${t.id} to ${n.styleId}`),e("setCharStyle",{id:t.id,panelId:t.panelId,styleId:n.styleId})),n.poseId!==t.poseId&&e("setPose",{id:t.id,panelId:t.panelId,poseId:n.poseId}),JSON.stringify(n.posePositions)!==JSON.stringify(t.posePositions)&&e("setPosePosition",{id:t.id,panelId:t.panelId,posePositions:n.posePositions})}function Gn(e,t,n,o){const s=yf(t);o(s),n.styleGroups[s.styleGroupId]||(s.styleGroupId=0);const r=n.styleGroups[s.styleGroupId];r.styles[s.styleId]||(s.styleId=0);const i=r.styles[s.styleId];i.poses[s.poseId]||(s.poseId=0);const a=i.poses[s.poseId];for(const p in a.positions)!a.positions[p]||a.positions[p][s.posePositions[p]]||(s.posePositions[p]=0);const d=n.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId].compatibleHeads[t.posePositions.headType||0],c=a.compatibleHeads.indexOf(d);c>=0?s.posePositions.headType=c:(s.posePositions.headType=0,s.posePositions.head=0),_f(e,t,s)}const h$=ee({props:{title:{required:!0,type:String}}});const g$={class:"fieldset_wrapper"},m$={key:0},b$={class:"fieldset_contents"};function v$(e,t,n,o,s,r){return g(),y("div",g$,[u("fieldset",null,[e.title>""?(g(),y("legend",m$,fe(e.title),1)):X("",!0),u("div",b$,[qt(e.$slots,"default",{},void 0,!0)])])])}const Ht=ne(h$,[["render",v$],["__scopeId","data-v-d714a009"]]);var y$=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Kd=960,_$=ee({props:{part:{required:!0},value:{required:!0},size:{type:Number,default:150}},data:()=>({lookups:[],loaded:!1}),computed:{scaleX(){return this.size/this.part.size[0]},scaleY(){return this.size/this.part.size[1]},backgroundSize(){return`${Math.floor(Kd*this.scaleX)}px ${Math.floor(Kd*this.scaleY)}px`},backgroundPosition(){return`${Math.floor(this.part.offset[0]*-this.scaleX)}px ${Math.floor(this.part.offset[1]*-this.scaleY)}px`},background(){var e,t;let n="";const o=this.backgroundSize,s=(e=this.part.offset)!=null?e:[0,0];for(let r=0;r<this.part.images.length;++r){const i=this.part.images[r],a=this.lookups[r];if(!a)continue;r>0&&(n+=", ");const l=(t=i.offset)!=null?t:[0,0],d=`${Math.floor((s[0]-l[0])*-this.scaleX)}px ${Math.floor((s[1]-l[1])*-this.scaleY)}px`;n+=`url('${a.replace("'","\\'")}') ${d} / ${o}`}return n},style(){return{height:this.size+"px",width:this.size+"px",background:this.background}}},created(){return y$(this,null,function*(){this.lookups=yield Promise.all(this.part.images.map(e=>typeof e.asset=="string"?xb(e.asset,!1):Mn(e.asset,!1)))})},methods:{quickClick(e){e.preventDefault(),this.$emit("quick-click")}}});function w$(e,t,n,o,s,r){var i;return g(),y("div",{class:pe({part:!0,active:(i=e.part)==null?void 0:i.active}),style:Re(e.style),tabindex:"0",onClick:t[0]||(t[0]=a=>e.$emit("click")),onContextmenu:t[1]||(t[1]=(...a)=>e.quickClick&&e.quickClick(...a)),onKeydown:[t[2]||(t[2]=Le(G(a=>e.$emit("click"),["prevent"]),["enter"])),t[3]||(t[3]=Le(G((...a)=>e.quickClick&&e.quickClick(...a),["prevent"]),["space"]))]},null,38)}const $$=ne(_$,[["render",w$],["__scopeId","data-v-037b2b66"]]);var C$=Object.defineProperty,P$=Object.defineProperties,S$=Object.getOwnPropertyDescriptors,Yd=Object.getOwnPropertySymbols,k$=Object.prototype.hasOwnProperty,O$=Object.prototype.propertyIsEnumerable,Jd=(e,t,n)=>t in e?C$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,x$=(e,t)=>{for(var n in t||(t={}))k$.call(t,n)&&Jd(e,n,t[n]);if(Yd)for(var n of Yd(t))O$.call(t,n)&&Jd(e,n,t[n]);return e},j$=(e,t)=>P$(e,S$(t));const I$=ee({mixins:[Kl],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const e=this.noWraping?"no-wraping":"wraping",n=od("div",j$(x$({},{}),{class:["d-flow",this.finalDirection,e],style:{gap:this.gap}}),this.$slots.default());if(this.maxSize!==void 0){const o=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return od("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:o}},[n])}return n},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}});const vs=ne(I$,[["__scopeId","data-v-f45f382d"]]);var Zd=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const T$=ee({components:{PartButton:$$,DFieldset:Ht,DFlow:vs},props:{character:{type:Object,required:!0},part:{required:!0,type:String}},data:()=>({isWebPSupported:null,stylePriorities:[]}),computed:{vertical(){return this.$store.state.ui.vertical},styleComponents(){if(this.part!=="style")return[];const e=this.charData.styleGroups[this.character.styleGroupId];return e.styleComponents.map(t=>{const n={};for(const o in t.variants){if(!t.variants.hasOwnProperty(o))continue;const s=t.variants[o];n[o]={size:e.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:s}],active:!1}}return{label:t.label,name:t.id,buttons:n}})},parts(){const e={};let t,n,o;const s=this.charData,r=bn(s,this.character);switch(this.part){case"head":const i=this.character.posePositions.headType||0,a=this.character.posePositions.head||0;for(let d=0;d<r.compatibleHeads.length;++d){const c=r.compatibleHeads[d],p=s.heads[c];for(let f=0;f<p.variants.length;++f){const b=p.variants[f];e[`${d}_${f}`]={size:p.previewSize,offset:p.previewOffset,images:b.map(v=>({asset:v,offset:[0,0]})),active:a===f&&i===d}}}return e;case"pose":const l=s.styleGroups[this.character.styleGroupId].styles[this.character.styleId];for(let d=0;d<l.poses.length;++d){const c=l.poses[d];e[d]=this.generatePosePreview(c),e[d].active=d===this.character.poseId}return e;case"style":for(let d=0;d<s.styleGroups.length;++d){const c=s.styleGroups[d];e[c.id]=this.generatePosePreview(c.styles[0].poses[0]),e[c.id].active=d===this.character.styleGroupId}return e;default:t=r.positions[this.part],o=r.previewSize,n=r.previewOffset;break}for(let i=0;i<t.length;++i){const a=t[i];e[i]={images:a.map(l=>({offset:[0,0],asset:l})),size:o,offset:n,active:i===(this.character.posePositions[this.part]||0)}}return e},charData(){return Nr(this.$store,this.character)}},methods:{updateStyleData(){const e=this.charData.styleGroups[this.character.styleGroupId].styles[this.character.styleId];this.stylePriorities=Object.keys(e.components).map(t=>[t,e.components[t]])},generatePosePreview(e){const t=this.charData;let n=[];for(const o of e.renderCommands)switch(o.type){case"pose-part":const s=e.positions[o.part];if(s==null||s.length===0)break;n=n.concat(s[0].map(a=>({asset:a,offset:o.offset})));break;case"head":const r=t.heads[e.compatibleHeads[0]];if(e.compatibleHeads.length===0)break;const i=r.variants[0];n=n.concat(i.map(a=>({asset:a,offset:o.offset})));break;case"image":n=n.concat(o.images.map(a=>({asset:a,offset:o.offset})));break}return{images:n,size:e.previewSize,offset:e.previewOffset,active:!1}},updatePose(e){e==null&&(e=this.character.styleGroupId);const n=this.charData.styleGroups[e];let o=n.styles;for(const s of this.stylePriorities){const r=o.filter(i=>i.components[s[0]]===s[1]);r.length>0&&(o=r)}this.vuexHistory.transaction(()=>Zd(this,null,function*(){yield this.$store.dispatch("panels/setCharStyle",{id:this.character.id,panelId:this.character.panelId,styleGroupId:e,styleId:n.styles.indexOf(o[0])})}))},choose(e){if(this.part==="style")this.updatePose(this.charData.styleGroups.findIndex(t=>t.id===e));else if(this.part==="head"){const[t,n]=e.split("_",2).map(o=>parseInt(o,10));this.$store.commit("panels/setPosePosition",{id:this.character.id,panelId:this.character.panelId,posePositions:{headType:t,head:n}})}else this.setPart(this.part,parseInt(e,10))},choose_component(e,t){const n=this.stylePriorities.findIndex(o=>o[0]===e);this.stylePriorities.splice(n,1),this.stylePriorities.unshift([e,t]),this.updatePose()},onKeydown(e){(e.key==="Backspace"||e.key==="Escape")&&(this.$emit("leave"),e.preventDefault(),e.stopPropagation())},setPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPart",{id:this.character.id,panelId:this.character.panelId,part:e,val:t})})}},created(){return Zd(this,null,function*(){this.updateStyleData(),this.isWebPSupported=yield mo()})},watch:{character(){this.updateStyleData()}}});const $n=e=>(ze("data-v-15457ce1"),e=e(),Ge(),e),E$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),B$=$n(()=>u("span",{class:"text-block"},"Create new expressions",-1)),A$=[E$,B$],D$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),R$=$n(()=>u("span",{class:"text-block"},"Search in content packs",-1)),H$=[D$,R$],M$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),F$=$n(()=>u("span",null,"Search in content packs",-1)),N$=[M$,F$],L$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),U$=$n(()=>u("span",null,"Search in content packs",-1)),V$=[L$,U$];function W$(e,t,n,o,s,r){const i=E("part-button"),a=E("d-flow"),l=E("d-fieldset");return g(),L(a,{"no-wraping":"",onKeydown:e.onKeydown},{default:B(()=>[u("button",{onClick:t[0]||(t[0]=d=>e.$emit("leave"))},"Back"),e.part==="head"?(g(),y("button",{key:0,onClick:t[1]||(t[1]=d=>e.$emit("show-expression-dialog",{character:e.character.characterType})),class:"icon-button"},A$)):X("",!0),e.part==="head"?(g(),y("button",{key:1,onClick:t[2]||(t[2]=d=>e.$emit("show-dialog","type: Expressions character: "+e.charData.label)),class:"icon-button"},H$)):e.part==="style"?(g(),y("button",{key:2,onClick:t[3]||(t[3]=d=>e.$emit("show-dialog","type: Styles character: "+e.charData.label)),class:"icon-button"},N$)):(g(),y("button",{key:3,onClick:t[4]||(t[4]=d=>e.$emit("show-dialog","type: Poses character: "+e.charData.label)),class:"icon-button"},V$)),(g(!0),y(U,null,$e(e.parts,(d,c)=>(g(),L(i,{key:c,value:c,part:d,onClick:p=>{e.choose(c),e.$emit("leave")},onQuickClick:p=>e.choose(c)},null,8,["value","part","onClick","onQuickClick"]))),128)),(g(!0),y(U,null,$e(e.styleComponents,d=>(g(),L(l,{key:d.name,title:d.label},{default:B(()=>[C(a,{noWraping:""},{default:B(()=>[(g(!0),y(U,null,$e(d.buttons,(c,p)=>(g(),L(i,{size:130,key:p,value:p,part:c,onClick:f=>e.choose_component(d.name,p)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["onKeydown"])}const z$=ne(T$,[["render",W$],["__scopeId","data-v-15457ce1"]]);function ys(){return function(t,n,o=!1){return{get(){return this.object[t]},set(s){this.vuexHistory.transaction(()=>{this.$store[o?"dispatch":"commit"](n,{panelId:this.object.panelId,id:this.object.id,[t]:s})})}}}}function ba(e){return function(n){return{get(){return this.object[n]},set(o){this.vuexHistory.transaction(()=>{this.$store.commit(e,{panelId:this.object.panelId,id:this.object.id,key:n,value:o})})}}}}var G$=Object.defineProperty,q$=(e,t,n)=>t in e?G$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,X$=(e,t,n)=>(q$(e,typeof t!="symbol"?t+"":t,n),n);const Qd=5;class K${constructor(t){this.str=t,X$(this,"pos",0)}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-Qd),this.pos+Qd)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function ec(e,t=!0){const n=[],o=new K$(e);let s=Lr;for(;s!==Ur;){const r=o.pos;try{s=s(n,o)}catch(i){if(t&&s!==sl)o.pos=r,s=(a,l)=>sl(a,l,!0);else throw i}}return n}function Lr(e,t){return t.current()===void 0?Ur:t.current()==="{"?Y$:t.current()===`
`?J$:sl}function Ur(){return Ur}function sl(e,t,n=!1){const{pos:o}=t;let s="",r=n,i;for(;;){if(t.current()===void 0){i=Ur;break}else if(r)s+=t.current(),r=!1;else if(t.current()==="\\")r=!0;else if(t.current()==="{"||t.current()===`
`){i=Lr;break}else s+=t.current();t.next()}return e.push({type:"text",pos:o,content:s}),i}function pi(e,t){throw new Error(`Error when parsing text at position ${e.pos}: (around: "${e.around}") ${t}`)}function Y$(e,t){const{pos:n}=t;if(t.current()!=="{")throw new Error("Parser error: Command does not start with {");const o=t.next()==="/";o&&t.next();let s="",r="",i=!1;for(;t.current()===void 0&&pi(t,"Unexpected end of text inside a command"),t.current()!=="}";)i?r+=t.current():t.current().match(/[a-z]/i)?s+=t.current():t.current()==="="?(o&&pi(t,"Closing commands may not contain arguments"),i=!0):pi(t,`Unexpected character '${t.current()}' in command name.`),t.next();return t.next(),o?e.push({type:"commandClose",commandName:s,pos:n}):e.push({type:"command",pos:n,argument:r,commandName:s}),Lr}function J$(e,t){return e.push({type:"newline",pos:t.pos}),t.next(),Lr}var Z$=Object.defineProperty,Q$=Object.defineProperties,e0=Object.getOwnPropertyDescriptors,tc=Object.getOwnPropertySymbols,t0=Object.prototype.hasOwnProperty,n0=Object.prototype.propertyIsEnumerable,nc=(e,t,n)=>t in e?Z$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tt=(e,t)=>{for(var n in t||(t={}))t0.call(t,n)&&nc(e,n,t[n]);if(tc)for(var n of tc(t))n0.call(t,n)&&nc(e,n,t[n]);return e},nt=(e,t)=>Q$(e,e0(t));const oc=new Map([qn("i",e=>nt(tt({},e),{isItalic:!0})),qn("b",e=>nt(tt({},e),{isBold:!0})),qn("u",e=>nt(tt({},e),{isUnderlined:!0})),qn("s",e=>nt(tt({},e),{isStrikethrough:!0})),qn("plain",e=>nt(tt({},e),{isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),qn("edited",e=>nt(tt({},e),{fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),Ds("k",(e,t,n)=>nt(tt({},e),{letterSpacing:t?e.letterSpacing+n:n})),Ds("size",(e,t,n)=>nt(tt({},e),{fontSize:t?e.fontSize+n:n})),Ds("alpha",(e,t,n)=>nt(tt({},e),{alpha:t?e.alpha+n:n})),Ds("stroke",(e,t,n)=>nt(tt({},e),{strokeWidth:t?e.strokeWidth+n:n})),["font",(e,t)=>nt(tt({},e),{fontName:t})],["color",(e,t)=>nt(tt({},e),{color:t})],["outlinecolor",(e,t)=>nt(tt({},e),{strokeColor:t})]]);function qn(e,t){return[e,(n,o)=>{if(o!=="")throw new Error(`Operator '${e}' does not take any arguments.`);return t(n)}]}function Ds(e,t){return[e,(n,o)=>{if(o=="")throw new Error(`Operator '${e}' needs an argument.`);const s=o[0]==="+"||o[0]==="-",r=Number(o);if(isNaN(r))throw new Error(`Operator '${e}' needs a numeric argument.`);return t(n,s,r)}]}var Ee=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},At={},wf={};Object.defineProperty(wf,"__esModule",{value:!0});var at={};Object.defineProperty(at,"__esModule",{value:!0});at.createFactoryWithConstraint=at.isExact=at.noop=at.assert=at.UnreachableCaseError=void 0;class o0 extends Error{constructor(t){super(`Unreachable case: ${t}`)}}at.UnreachableCaseError=o0;function s0(e,t="no additional info provided"){if(!e)throw new Error("Assertion Error: "+t)}at.assert=s0;function r0(...e){}at.noop=r0;const i0=()=>e=>e;at.isExact=i0;const l0=()=>e=>e;at.createFactoryWithConstraint=l0;var $f={};Object.defineProperty($f,"__esModule",{value:!0});(function(e){var t=Ee&&Ee.__createBinding||(Object.create?function(o,s,r,i){i===void 0&&(i=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,i,a)}:function(o,s,r,i){i===void 0&&(i=r),o[i]=s[r]}),n=Ee&&Ee.__exportStar||function(o,s){for(var r in o)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&t(s,o,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(wf,e),n(at,e),n($f,e)})(At);function bo(e){e.width=0,e.height=0,va.delete(e.disposalId||0)}function cs(){const e=document.createElement("canvas");return d0(e),e}const va=new Map;let a0=0;function d0(e){e.disposalId=a0++,typeof WeakRef!="undefined"&&va.set(e.disposalId,new WeakRef(e))}window.addEventListener("unload",()=>{va.forEach(e=>{const t=e.deref();!t||bo(t)})});var c0=Object.defineProperty,u0=(e,t,n)=>t in e?c0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fi=(e,t,n)=>(u0(e,typeof t!="symbol"?t+"":t,n),n),p0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class dt{constructor(t,n){this.str=t,this.baseStyle=n,fi(this,"renderParts"),fi(this,"tokens"),fi(this,"loose"),this.loose=q.state.looseTextParsing;try{this.tokens=ec(t,this.loose)}catch(o){if(o instanceof Error)this.tokens=[{type:"text",pos:0,content:o.message}];else throw o}this.rebuildParts()}rebuildParts(){this.renderParts=dt.getRenderParts(this.tokens,this.baseStyle,this.loose)}loadFonts(){return p0(this,null,function*(){if(!("fonts"in document))return;const t=new Set;let n=null;for(const s of this.renderParts)"style"in s&&s.style!==n&&(n=s.style,n.fontName&&t.add(n.fontName));let o=!1;for(const s of t){const r=document,i=`8px ${s}`;r.fonts.check(i)||(o=!0,yield r.fonts.load(i))}if(o){const s=ec(this.str);this.renderParts=dt.getRenderParts(s,this.baseStyle,this.loose)}})}render(t){t.save();let n=null;for(const o of this.renderParts)o.type!=="newline"&&(o.style!==n&&(n=o.style,rl(n,t)),n.strokeWidth>0&&n.strokeColor>""&&t.strokeText(o.character,o.x,o.y));for(const o of this.renderParts)o.type!=="newline"&&(o.style!==n&&(n=o.style,rl(n,t)),t.fillText(o.character,o.x,o.y));t.restore()}quote(){let t;(r=>{r[r.None=0]="None",r[r.ExplictQuote=1]="ExplictQuote",r[r.ImplictQuote=2]="ImplictQuote",r[r.Star=3]="Star"})(t||(t={}));let n=-1,o=0;for(let r=0;r<this.renderParts.length;++r){const i=this.renderParts[r];if(i.type==="character")switch(o){case 0:if(i.character.match(/\s/))continue;i.character==='"'?(o=1,n=r):i.character==="*"?(o=3,n=r):(this.renderParts.splice(r,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Lo(i.style,'"')}),r++,n=r,o=2);break;case 1:n=r,i.character==='"'&&(o=0);break;case 2:if(i.character.match(/\s/))continue;i.character==="*"&&(this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Lo(i.style,'"')}),o=3,r++),n=r;break;case 3:i.character==="*"&&(o=0),n=r;break;default:throw new At.UnreachableCaseError(o)}}const s=this.renderParts[n];s&&o===3&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:"*",height:s.height,width:Lo(s.style,'"')}),s&&(o===1||o===2)&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:'"',height:s.height,width:Lo(s.style,'"')})}fixAlignment(t,n,o,s,r){let i=0,a=[];function l(){let v=n;t==="center"?v=n+(o-n)/2-i/2:t==="right"&&(v=o-i);for(const w of a)w.x=v,v+=w.width}let d=this.renderParts;r>0&&(d=dt.applyLineWrapping(this.renderParts.slice(0),r));let c=s;const p=[];let f=0;for(const v of d)f=Math.max(f,v.height),v.type==="newline"&&(p.push(f),f=0);p.push(f);let b=0;for(const v of d)if(f=Math.max(f,v.height),v.y=c,a.push(v),i+=v.width,v.type==="newline")l(),c+=p[++b]||0,i=0,f=0,a=[];else if(v.type==="character"){const w=a[a.length-1];w.type==="character"&&(i+=w.style.letterSpacing,w.width+=w.style.letterSpacing)}l()}getHeight(t){let n=0,o=0;const s=t===0?this.renderParts:dt.applyLineWrapping(this.renderParts.slice(0),t);for(const r of s)n=Math.max(n,r.height),r.type==="newline"&&(o+=n,n=0);return o+=n,o}getWidth(){let t=0,n=0,o=null;for(const s of this.renderParts)t+=s.width,s.type==="newline"?(n=Math.max(n,t),t=0,o=null):s.type==="character"&&(o&&o.type==="character"&&(t+=o.style.letterSpacing),o=s);return n=Math.max(n,t),n}static getRenderParts(t,n,o){const s=[],r=[],i=[];let a=ic(n),l=n,d=null;function c(p){for(const f of p)s.push({type:"character",character:f,height:a,width:Lo(l,f),style:l,x:0,y:0})}for(const p of t){const f=p.type;switch(f){case"command":if(oc.has(p.commandName))r.push(l),i.push(d),l=oc.get(p.commandName)(l,p.argument),a=ic(l),d=p;else if(o)c("{"+p.commandName+"}");else throw new Error(`There is no text command called '${p.commandName}' at position ${p.pos}.`);break;case"commandClose":if(!d)if(o){c("{/"+p.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${p.pos}. Closed '${p.commandName}', but no commands are currently open.`);if(p.commandName!==d.commandName)if(o){c("{/"+p.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${p.pos}. Closed '${p.commandName}', expected to close '${d}' first. (Opened at position ${d.pos})`);d=i.pop(),l=r.pop();break;case"newline":s.push({height:a,width:0,x:0,y:0,type:"newline"});break;case"text":c(p.content);break;default:throw new At.UnreachableCaseError(f)}}return s}static applyLineWrapping(t,n){let o=-1,s=0,r=0;const i=[];for(const a of t)if(a.type==="newline")o=-1,s=0,r=0,i.push(a);else if(a.type==="character")a.character===" "?s>n?(o=-1,s=0,r=0,i.push({type:"newline",height:a.height,width:0,x:0,y:0})):(s+=a.width,r=s,o=i.length,i.push(a)):(s+=a.width,s>n&&o!==-1&&(s-=r,i.splice(o,1,{type:"newline",height:a.height,width:0,x:0,y:0}),o=-1,r=0),i.push(a));else throw new At.UnreachableCaseError(a);return i}}const ya=cs();ya.width=0;ya.height=0;const sc=ya.getContext("2d");let rc=null;function Lo(e,t){return e!==rc&&(rl(e,sc),rc=e),sc.measureText(t).width}const hi=new Map;function ic(e){const t=e.fontSize+" "+e.fontName;if(hi.has(t))return hi.get(t)*e.lineSpacing;const n=document.createElement("span");n.innerHTML="Hg",n.style.fontFamily=e.fontName,n.style.fontSize=`${e.fontSize}px`,n.style.lineHeight="1";const o=document.createElement("div");o.style.opacity="0",o.style.fontFamily=e.fontName,o.style.fontSize=`${e.fontSize}px`,o.style.lineHeight="1",o.style.position="absolute",o.style.top="0",o.style.left="0",o.appendChild(n),document.body.appendChild(o);try{const s=o.offsetHeight;return hi.set(t,s),s*e.lineSpacing}finally{o.remove()}}function rl(e,t){t.textAlign="left",t.font=(e.isItalic?"italic ":"")+(e.isBold?"bold ":"")+e.fontSize+"px "+e.fontName,t.lineJoin="round",e.strokeWidth>0&&e.strokeColor>""?(t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth):(t.strokeStyle="",t.lineWidth=0),t.globalAlpha=e.alpha||0,t.fillStyle=e.color}class Qn{}var f0=Object.defineProperty,lc=Object.getOwnPropertySymbols,h0=Object.prototype.hasOwnProperty,g0=Object.prototype.propertyIsEnumerable,il=(e,t,n)=>t in e?f0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uo=(e,t)=>{for(var n in t||(t={}))h0.call(t,n)&&il(e,n,t[n]);if(lc)for(var n of lc(t))g0.call(t,n)&&il(e,n,t[n]);return e},m0=(e,t,n)=>(il(e,typeof t!="symbol"?t+"":t,n),n),b0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class vo{constructor(t,n,o,s){this.canvas=t,this.fsCtx=n,this.hq=o,this.preview=s,m0(this,"aborted",!1)}static make(t,n,o){return new vo(t,t.getContext("2d"),n,o)}static makeWithContext(t,n,o,s){return new vo(t,n,o,s)}drawText(t){if(this.aborted)throw new Qn;this.fsCtx.save();const{font:n,align:o,x:s=0,y:r=0,text:i=""}=Uo(Uo({},{font:"20px aller",align:"left"}),t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width,this.fsCtx.strokeText(i,s,r)),t.fill&&(this.fsCtx.fillStyle=t.fill.style,this.fsCtx.fillText(i,s,r)),this.fsCtx.restore()}measureText(t){if(this.aborted)throw new Qn;this.fsCtx.save();const{font:n,align:o,text:s=""}=Uo(Uo({},{font:"20px aller",align:"left"}),t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width),t.fill&&(this.fsCtx.fillStyle=t.fill.style);const r=this.fsCtx.measureText(s);return this.fsCtx.restore(),r}drawImage(t){if(this.aborted)throw new Qn;const{image:n,flip:o,x:s,y:r,w:i,h:a,filters:l,composite:d}=Uo({flip:!1,w:t.image.width,h:t.image.height,composite:"source-over"},t);if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=d,l)if("filter"in this.fsCtx){const c=[];for(const p of l)p.type==="drop-shadow"?c.push(`drop-shadow(${p.offsetX}px ${p.offsetY}px ${p.blurRadius}px ${p.color})`):p.type==="hue-rotate"?c.push(`hue-rotate(${p.value}deg)`):p.type==="blur"?c.push(`blur(${p.value}px)`):c.push(`${p.type}(${p.value*100}%)`);this.fsCtx.filter=c.join(" ")}else{let c=1;for(const p of l)p.type==="opacity"&&(c*=p.value);this.fsCtx.globalAlpha=c}if(t.shadow){const c=t.shadow;c.color!=null&&(this.fsCtx.shadowColor=c.color),c.blur!=null&&(this.fsCtx.shadowBlur=c.blur),c.offsetX!=null&&(this.fsCtx.shadowOffsetX=c.offsetX),c.offsetY!=null&&(this.fsCtx.shadowOffsetY=c.offsetY)}if(t.rotation!=null&&t.rotation!==0){const c=t.rotationAnchor?t.rotationAnchor.x:0,p=t.rotationAnchor?t.rotationAnchor.y:0;t.rotationAnchor&&this.fsCtx.translate(c,p),this.fsCtx.rotate(t.rotation),t.rotationAnchor&&this.fsCtx.translate(-c,-p)}this.fsCtx.translate(s+i/2,r+a/2),this.fsCtx.scale(o?-1:1,1),n.paintOnto(this.fsCtx,{x:-i/2,y:-a/2,w:i,h:a}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:t,y:n,w:o,h:s,outline:r,fill:i,composition:a}){if(this.aborted)throw new Qn;this.fsCtx.save(),this.fsCtx.beginPath(),this.fsCtx.rect(t,n,o,s),a&&(this.fsCtx.globalCompositeOperation=a),i&&(this.fsCtx.fillStyle=i.style,this.fsCtx.fill()),r&&(this.fsCtx.strokeStyle=r.style,this.fsCtx.lineWidth=r.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:t,fill:n,path:o}){if(this.aborted)throw new Qn;this.fsCtx.save(),this.fsCtx.beginPath(),o(this.fsCtx),n&&(this.fsCtx.fillStyle=n.style,this.fsCtx.fill()),t&&(this.fsCtx.strokeStyle=t.style,this.fsCtx.lineWidth=t.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(t,n="repeat"){return t instanceof _s&&(t=t.previewCanvas),this.fsCtx.createPattern(t,n)}customTransform(t,n){return b0(this,null,function*(){this.fsCtx.save(),yield t(this.fsCtx),yield n(this),this.fsCtx.restore()})}linearGradient(t,n,o,s){return this.fsCtx.createLinearGradient(t,n,o,s)}applyFilters(t){if(t.length===0)return;this.fsCtx.save();let n=1;for(const o of t)o.type==="opacity"&&(n*=o.value);if("filter"in this.fsCtx){const o=[];for(const s of t)s.type!=="opacity"&&(s.type==="drop-shadow"?o.push(`drop-shadow(${s.offsetX}px ${s.offsetY}px ${s.blurRadius}px ${s.color})`):s.type==="hue-rotate"?o.push(`hue-rotate(${s.value}deg)`):s.type==="blur"?o.push(`blur(${s.value}px)`):o.push(`${s.type}(${s.value*100}%)`));this.fsCtx.filter=o.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),n!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${n})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}var v0=Object.defineProperty,y0=(e,t,n)=>t in e?v0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gi=(e,t,n)=>(y0(e,typeof t!="symbol"?t+"":t,n),n),Rs=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class _s{constructor(t,n){gi(this,"previewCanvas"),gi(this,"runningContext",null),gi(this,"_disposed",!1);const o=Y();this.previewCanvas=cs(),this.previewCanvas.width=t!=null?t:o.Base.screenWidth,this.previewCanvas.height=n!=null?n:o.Base.screenHeight}get disposed(){return this._disposed}render(t,n=!0,o=!0){return Rs(this,null,function*(){this.runningContext&&this.runningContext.abort();const s=this.previewCanvas.getContext("2d");s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const r=this.runningContext=vo.makeWithContext(this.previewCanvas,s,n,o);try{yield t(this.runningContext)}catch(i){if(i instanceof Qn)return!1;throw i}finally{r===this.runningContext&&(this.runningContext=null)}return!0})}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(t,n){n.w!=null&&n.h!=null?t.drawImage(this.previewCanvas,n.x,n.y,n.w,n.h):t.drawImage(this.previewCanvas,n.x,n.y)}download(t,n){return Rs(this,null,function*(){const o=yield this.drawToCanvas(t);return yield q.saveToFile(o,n)})}renderToBlob(t){return Rs(this,null,function*(){const n=yield this.drawToCanvas(t);return yield new Promise((o,s)=>{n.toBlob(r=>{r?o(r):s()})})})}drawToCanvas(t){return Rs(this,null,function*(){const n=cs();n.width=this.previewCanvas.width,n.height=this.previewCanvas.height;const o=n.getContext("2d");return o.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),yield t(vo.makeWithContext(n,o,!0,!1)),n})}dispose(){this.runningContext&&this.runningContext.abort(),bo(this.previewCanvas),this._disposed=!0}getDataAt(t,n){return this.previewCanvas.getContext("2d").getImageData(t,n,1,1).data}}function pr(e,t,n,o,s){const r=Math.cos(s),i=Math.sin(s),a=e-n,l=t-o,d=r*a-i*l+n,c=i*a+r*l+o;return[d,c]}var _0=Object.defineProperty,w0=(e,t,n)=>t in e?_0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,In=(e,t,n)=>(w0(e,typeof t!="symbol"?t+"":t,n),n),mi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())}),qo=(e=>(e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Focused=2]="Focused",e[e.Both=3]="Both",e))(qo||{});class Cf{constructor(t){this.obj=t,In(this,"localRenderer",null),In(this,"lastVersion",null),In(this,"hitDetectionFallback",!1),In(this,"renderable",!1),In(this,"_disposed",!1),In(this,"lastHq",!1),In(this,"ready",Promise.resolve())}get id(){return this.obj.id}get x(){return this.obj.x}get y(){return this.obj.y}get version(){return this.obj.version}get flip(){return this.obj.flip}get rotation(){return this.obj.rotation/180*Math.PI}get composite(){return this.obj.composite}get filters(){return this.obj.filters}get width(){return this.obj.width}get height(){return this.obj.height}get allowSkippingLocalCanvas(){return!0}updateLocalCanvas(t,n){return mi(this,null,function*(){if(this._disposed)throw new Error("Disposed renderable called");yield this.ready;const o=this.canvasWidth,s=this.canvasHeight;if(s===0&&o===0){this.renderable=!1;return}if(this.renderable=!0,this.lastHq=t,!n){this.localRenderer=new _s(o,s);try{yield this.localRenderer.render(this.renderLocal.bind(this),t)}catch(r){throw this.localRenderer.dispose(),this.localRenderer=null,r}}})}needsRedraw(){return this.localRenderer===null||this.lastVersion!==this.version}getRenderRotation(){return[this.flip?-this.rotation:this.rotation,{x:this.x,y:this.y+this.height/2}]}render(t,n,o){return mi(this,null,function*(){if(this._disposed)throw new Error("Disposed renderable called");if(this.canSkipLocal()||(o=!1),(t!==0||this.localRenderer)&&(o=!1),(this.lastHq!==n.hq||this.needsRedraw())&&(yield this.updateLocalCanvas(n.hq,o)),this.lastVersion=this.version,!this.renderable)return;const[r,i]=this.getRenderRotation();let a;switch(t){case 0:a=void 0;break;case 1:a={blur:20,color:"red"};break;case 2:a={blur:20,color:"blue"};break;case 3:a={blur:20,color:"purple"};break}o?yield n.customTransform(l=>mi(this,null,function*(){l.translate(this.canvasDrawPosX,this.canvasDrawPosY)}),this.renderLocal.bind(this)):n.drawImage({image:this.localRenderer,x:this.canvasDrawPosX,y:this.canvasDrawPosY,w:this.canvasDrawWidth,h:this.canvasDrawHeight,rotation:r,rotationAnchor:i,flip:this.flip,shadow:t&&n.preview?a:void 0,composite:this.composite,filters:this.filters})})}canSkipLocal(){return this.allowSkippingLocalCanvas&&this.obj.filters.length===0&&!this.obj.flip}hitTest(t,n){if(!this.localRenderer)return!1;const o=this.getHitbox(),s=o.x0+(o.x1-o.x0)/2,r=o.y0+(o.y1-o.y0)/2,[i,a]=pr(t,n,s,r,this.flip?this.rotation:-this.rotation);if(!(i>=o.x0&&i<=o.x1&&a>=o.y0&&a<=o.y1))return!1;if(this.hitDetectionFallback)return!0;try{return this.pixelPerfectHitTest(t,n)}catch(d){this.hitDetectionFallback=!0}return!0}pixelPerfectHitTest(t,n){if(!this.localRenderer)return!1;const[o,s]=this.getRenderRotation(),[r,i]=s?pr(t,n,s.x,s.y,-o):[t,n],a=Math.round(r-this.canvasDrawPosX),l=Math.round(i-this.canvasDrawPosY),d=this.canvasDrawWidth,c=this.canvasDrawHeight;if(a>=0&&a<=d&&l>=0&&l<=c){const p=this.flip?this.canvasDrawWidth-a:a,f=this.canvasWidth/this.canvasDrawWidth,b=this.canvasHeight/this.canvasDrawHeight;return this.localRenderer.getDataAt(Math.round(p*f),Math.round(l*b))[3]!==0}return!1}getHitbox(){return{x0:this.x-this.width/2,x1:this.x+this.width/2,y0:this.y,y1:this.y+this.height}}updatedContent(t,n){}get disposed(){return this._disposed}dispose(){var t;this._disposed=!0,(t=this.localRenderer)==null||t.dispose(),this.localRenderer=null}}var $0=Object.defineProperty,C0=Object.getPrototypeOf,P0=Reflect.get,S0=(e,t,n)=>t in e?$0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gt=(e,t,n)=>(S0(e,typeof t!="symbol"?t+"":t,n),n),k0=(e,t,n)=>P0(C0(e),n,t),bi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class To extends Cf{constructor(t){super(t),gt(this,"lastWidth",-1),gt(this,"lastHeight",-1),gt(this,"lastX",-1),gt(this,"lastY",-1),gt(this,"lastFlip",null),gt(this,"canvasHeight"),gt(this,"canvasWidth"),gt(this,"canvasDrawHeight"),gt(this,"canvasDrawWidth"),gt(this,"canvasDrawPosX",0),gt(this,"canvasDrawPosY",0);const n=Y().Base;this.canvasHeight=n.screenHeight,this.canvasWidth=n.screenWidth,this.canvasDrawHeight=n.screenHeight,this.canvasDrawWidth=n.screenWidth}getRenderRotation(){return[0,void 0]}needsRedraw(){return super.needsRedraw()?!0:this.width!==this.lastWidth||this.height!==this.lastHeight||this.x!==this.lastX||this.y!==this.lastY||this.flip!==this.lastFlip}updateLocalCanvas(t,n){return bi(this,null,function*(){this.lastWidth=this.width,this.lastHeight=this.height,this.lastX=this.x,this.lastY=this.y,this.lastFlip=this.flip,yield k0(To.prototype,this,"updateLocalCanvas").call(this,t,n)})}renderLocal(t){return bi(this,null,function*(){const n=Y().Base;if(this.rotation===0)return yield this.draw(t);yield t.customTransform(o=>bi(this,null,function*(){const s=this.getHitbox(),r=s.x0+(s.x1-s.x0)/2,i=s.y0+(s.y1-s.y0)/2,a=this.flip?n.screenWidth-r:r;o.translate(a,i),o.rotate(this.rotation),o.translate(-a,-i)}),this.draw.bind(this))})}getHitbox(){const t=this.centeredVertically,n=this.width/2,o=this.height/2;return{x0:this.x-n,x1:this.x+n,y0:t?this.y-o:this.y,y1:t?this.y+o:this.y+this.height}}get centeredVertically(){return!1}}var O0=Object.defineProperty,ac=Object.getOwnPropertySymbols,x0=Object.prototype.hasOwnProperty,j0=Object.prototype.propertyIsEnumerable,dc=(e,t,n)=>t in e?O0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vi=(e,t)=>{for(var n in t||(t={}))x0.call(t,n)&&dc(e,n,t[n]);if(ac)for(var n of ac(t))j0.call(t,n)&&dc(e,n,t[n]);return e};class _a{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return Oo}static get defaultHeight(){return Dr}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-Et-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return aa}getControlsDisabledStyle(){return Lp}get textboxStyle(){return da}renderControls(t,n){const o=Y(),s=this.width,r=s/2,l=(this.base.obj.flip?o.Base.screenWidth-this.base.obj.x:this.base.obj.x)-r+s/2,d=this.getControlsStyle();t.drawText(vi({text:"History",x:l+na,y:n},d)),t.drawText(vi({text:"Skip",x:l+oa,y:n},this.base.obj.skip?d:this.getControlsDisabledStyle())),t.drawText(vi({text:"Auto   Save   Load   Settings",x:l+sa,y:n},d))}}var I0=Object.defineProperty,T0=(e,t,n)=>t in e?I0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yo=(e,t,n)=>(T0(e,typeof t!="symbol"?t+"":t,n),n),yi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Eo extends _a{constructor(){super(...arguments),yo(this,"backgroundImage","textbox"),yo(this,"xOffset",0)}get height(){return Dr+Et}get width(){return Oo}get nameboxWidth(){return ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return Mr}get textOffsetX(){return gs}get textOffsetY(){return Rr}renderNamebox(t,n,o){return yi(this,null,function*(){t.drawImage({image:yield co("namebox"),x:n,y:o})})}renderBackdrop(t,n,o){return yi(this,null,function*(){n+=this.xOffset;const s=yield co(this.backgroundImage);t.drawImage({image:s,x:n,y:o})})}render(t){return yi(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;yield this.renderBackdrop(t,a,l+this.nameboxHeight),this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l));const d=l+s,c=d-ta;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next"),x:a+o-ra,y:d-ia})})}}yo(Eo,"id","normal");yo(Eo,"label","Normal");yo(Eo,"priority",0);yo(Eo,"gameMode","ddlc");var E0=Object.defineProperty,B0=(e,t,n)=>t in e?E0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_o=(e,t,n)=>(B0(e,typeof t!="symbol"?t+"":t,n),n);class ws extends Eo{constructor(){super(...arguments),_o(this,"backgroundImage","textbox_monika"),_o(this,"xOffset",(Oo-ea)/2)}}_o(ws,"id","corrupt");_o(ws,"label","Corrupted");_o(ws,"priority",1);_o(ws,"gameMode","ddlc");function fr(e,t,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+s,r),e.arcTo(t+o,n+s,t,n+s,r),e.arcTo(t,n+s,t,n,r),e.arcTo(t,n,t+o,n,r),e.closePath()}function Pf(e,t,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+s,r),e.lineTo(t+o,n+s),e.lineTo(t,n+s),e.arcTo(t,n,t+o,n,r),e.closePath()}var A0=Object.defineProperty,D0=Object.defineProperties,R0=Object.getOwnPropertyDescriptors,cc=Object.getOwnPropertySymbols,H0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,ll=(e,t,n)=>t in e?A0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,F0=(e,t)=>{for(var n in t||(t={}))H0.call(t,n)&&ll(e,n,t[n]);if(cc)for(var n of cc(t))M0.call(t,n)&&ll(e,n,t[n]);return e},N0=(e,t)=>D0(e,R0(t)),wo=(e,t,n)=>(ll(e,typeof t!="symbol"?t+"":t,n),n),kt=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class $s extends _a{constructor(){super(...arguments),wo(this,"backgroundImage","textbox"),wo(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+Et}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return N0(F0({},Mr),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return gs}get textOffsetY(){return Rr}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const t=this.refObject;return t!=null&&t.textboxColor!=null?t.textboxColor:jp}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Ip).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Tp).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(t,n,o){return kt(this,null,function*(){const s=this.nameboxWidth,r=this.nameboxHeight;yield t.customTransform(i=>kt(this,null,function*(){i.beginPath(),Pf(i,n,o,s,r,Ap),i.clip()}),i=>kt(this,null,function*(){const a=i.linearGradient(n,o,n,o+r),l=ae.fromCss(this.nameboxBackgroundColor),d=new ae(l.r,l.g,l.b,.95),c=d.toHSL().shift(Bp).toRgb();a.addColorStop(0,d.toCss()),a.addColorStop(Ep,d.toCss()),a.addColorStop(1,c.toCss()),i.drawRect({x:n,y:o,w:this.obj.width,h:r,fill:{style:a}})}))})}renderBackdrop(t,n,o){return kt(this,null,function*(){const s=ae.fromCss(this.customColor).toHSL(),r=new _s(Vt,Vt);yield r.render(a=>kt(this,null,function*(){const l={style:s.shift(Dp).toRgb().toCss()};function d(c,p){a.drawPath({path:f=>{f.ellipse(c,p,Qi,Qi,0,0,2*Math.PI)},fill:l})}d(0,0),d(Vt,0),d(0,Vt),d(Vt,Vt),d(Vt/2,Vt/2)}),!0),yield t.customTransform(a=>kt(this,null,function*(){a.beginPath(),fr(a,n+Ut,o+Ut,this.width-Ut*2,this.height-Et-Ut*2,Zi),a.clip()}),a=>kt(this,null,function*(){const l=this.obj.height,d=this.obj.width,c=a.linearGradient(n,o,n,o+l),p=ae.fromHex(this.customColor);c.addColorStop(0,p.toCss()),c.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),a.drawRect({x:n,y:o,w:d,h:l,fill:{style:c},outline:{style:"#ffdfee",width:6}}),yield a.customTransform(b=>kt(this,null,function*(){b.translate(n,o)}),b=>kt(this,null,function*(){const v=a.patternFrom(r);a.drawRect({x:0,y:0,w:d,h:l,fill:{style:v},composition:"source-atop"})}));const f=a.linearGradient(n,o+l-el,n,o+l);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),a.drawPath({path:b=>{b.ellipse(n+d/2,o+l,Np,el,0,0,2*Math.PI)},fill:{style:f}})}));const i=s.shift(Rp).toRgb().toCss();t.drawPath({path:a=>{fr(a,n+Ut,o+Ut,this.width-Ut*2,this.height-Et-Ut*2,Zi)},outline:{style:i,width:Hp}}),r.dispose()})}render(t){return kt(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l)),yield this.renderBackdrop(t,a,l+this.nameboxHeight);const d=l+s,c=d-ta;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next"),x:a+o-ra,y:d-ia})})}}wo($s,"id","custom");wo($s,"label","Custom");wo($s,"priority",0);wo($s,"gameMode","ddlc");var L0=Object.defineProperty,U0=(e,t,n)=>t in e?L0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vr=(e,t,n)=>(U0(e,typeof t!="symbol"?t+"":t,n),n),V0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Cs extends _a{get height(){return Dr+Et}get width(){return Oo}get nameboxWidth(){return ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return Mr}get textOffsetX(){return gs}get textOffsetY(){return Rr}get textboxStyle(){return da}render(t){return V0(this,null,function*(){})}}Vr(Cs,"id","none");Vr(Cs,"label","None");Vr(Cs,"priority",0);Vr(Cs,"gameMode","ddlc");var W0=Object.defineProperty,uc=Object.getOwnPropertySymbols,z0=Object.prototype.hasOwnProperty,G0=Object.prototype.propertyIsEnumerable,al=(e,t,n)=>t in e?W0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,pc=(e,t)=>{for(var n in t||(t={}))z0.call(t,n)&&al(e,n,t[n]);if(uc)for(var n of uc(t))G0.call(t,n)&&al(e,n,t[n]);return e},q0=(e,t,n)=>(al(e,typeof t!="symbol"?t+"":t,n),n);const Sf=class{constructor(e){this.base=e}static get resizable(){return!1}static get defaultWidth(){return pa}static get defaultHeight(){return sf}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-to-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return ar}getControlsDisabledStyle(){return mf}renderControls(e,t){const n=Y(),o=this.width,s=o/2,i=(this.base.obj.flip?n.Base.screenWidth-this.base.obj.x:this.base.obj.x)-s,a=this.getControlsStyle(),l=["History","Skip","Auto","Save","Load","Settings"],d=[];let c=0;for(const b of l){const v=Sf.controlWidth(e,b);d.push(v),c+=v}const p=Math.min((o-c)/(l.length+2),78);let f=i+(o-c-p*(l.length-1))/2;for(let b=0;b<l.length;++b){const v=l[b],w=d[b],H=v==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():a;e.drawText(pc({text:v,x:f,y:t},H)),f+=w+p}}static controlWidth(e,t){if(this.widthCache[t])return this.widthCache[t];const n=e.measureText(pc({text:t},ar)).width;return this.widthCache[t]=n,n}};let kf=Sf;q0(kf,"widthCache",{});var X0=Object.defineProperty,K0=Object.defineProperties,Y0=Object.getOwnPropertyDescriptors,fc=Object.getOwnPropertySymbols,J0=Object.prototype.hasOwnProperty,Z0=Object.prototype.propertyIsEnumerable,dl=(e,t,n)=>t in e?X0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Q0=(e,t)=>{for(var n in t||(t={}))J0.call(t,n)&&dl(e,n,t[n]);if(fc)for(var n of fc(t))Z0.call(t,n)&&dl(e,n,t[n]);return e},eC=(e,t)=>K0(e,Y0(t)),$o=(e,t,n)=>(dl(e,typeof t!="symbol"?t+"":t,n),n),Ot=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Ps extends kf{constructor(){super(...arguments),$o(this,"backgroundImage","textbox"),$o(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+to}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:ha}get nameboxHeight(){return to}get nameboxOffsetX(){return ga}get nameboxOffsetY(){return lf}get nameboxStyle(){return eC(Q0({},gf),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return fa}get textOffsetY(){return rf}get textboxStyle(){return bf}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const t=this.refObject;return t!=null&&t.textboxColor!=null?t.textboxColor:Gp}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(qp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Xp).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(t,n,o){return Ot(this,null,function*(){const s=this.nameboxWidth,r=this.nameboxHeight;yield t.customTransform(i=>Ot(this,null,function*(){i.beginPath(),Pf(i,n,o,s,r,Jp),i.clip()}),i=>Ot(this,null,function*(){const a=i.linearGradient(n,o,n,o+r),l=ae.fromCss(this.nameboxBackgroundColor),d=new ae(l.r,l.g,l.b,.95),c=d.toHSL().shift(Yp).toRgb();a.addColorStop(0,d.toCss()),a.addColorStop(Kp,d.toCss()),a.addColorStop(1,c.toCss()),i.drawRect({x:n,y:o,w:this.obj.width,h:r,fill:{style:a}})}))})}renderBackdrop(t,n,o){return Ot(this,null,function*(){const s=ae.fromCss(this.customColor).toHSL(),r=new _s(zt,zt);yield r.render(a=>Ot(this,null,function*(){const l={style:s.shift(Zp).toRgb().toCss()};function d(c,p){a.drawPath({path:f=>{f.ellipse(c,p,nl,nl,0,0,2*Math.PI)},fill:l})}d(0,0),d(zt,0),d(0,zt),d(zt,zt),d(zt/2,zt/2)}),!0),yield t.customTransform(a=>Ot(this,null,function*(){a.beginPath(),fr(a,n+Wt,o+Wt,this.width-Wt*2,this.height-to-Wt*2,tl),a.clip()}),a=>Ot(this,null,function*(){const l=this.obj.height,d=this.obj.width,c=a.linearGradient(n,o,n,o+l),p=ae.fromHex(this.customColor);c.addColorStop(0,p.toCss()),c.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),a.drawRect({x:n,y:o,w:d,h:l,fill:{style:c},outline:{style:"#ffdfee",width:6}}),yield a.customTransform(b=>Ot(this,null,function*(){b.translate(n,o)}),b=>Ot(this,null,function*(){const v=a.patternFrom(r);a.drawRect({x:0,y:0,w:d,h:l,fill:{style:v},composition:"source-atop"})}));const f=a.linearGradient(n,o+l-ol,n,o+l);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),a.drawPath({path:b=>{b.ellipse(n+d/2,o+l,hf,ol,0,0,2*Math.PI)},fill:{style:f}})}));const i=s.shift(Qp).toRgb().toCss();t.drawPath({path:a=>{fr(a,n+Wt,o+Wt,this.width-Wt*2,this.height-to-Wt*2,tl)},outline:{style:i,width:ef}}),r.dispose()})}render(t){return Ot(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l)),yield this.renderBackdrop(t,a,l+this.nameboxHeight);const d=l+s,c=d-af;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next_plus"),x:a+o-pf,y:d-ff})})}}$o(Ps,"id","custom_plus");$o(Ps,"label","Custom (Plus)");$o(Ps,"priority",0);$o(Ps,"gameMode","ddlc_plus");var tC=Object.defineProperty,nC=(e,t,n)=>t in e?tC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,hc=(e,t,n)=>(nC(e,typeof t!="symbol"?t+"":t,n),n),_i=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const oC=[Eo,ws,$s,Cs,Ps],Jo=(()=>{const e={};for(const t of oC)e[t.id]=t;return e})();class sC extends To{constructor(){super(...arguments),hc(this,"refObject",null),hc(this,"_lastRenderer",null)}get y(){return this.obj.y}get width(){return this.textboxRenderer.width}get height(){return this.textboxRenderer.height}get textboxRenderer(){const t=this.forcedStyle,n=Jo[t];if(this._lastRenderer&&this._lastRenderer.constructor===n)return this._lastRenderer;const o=new n(this);return this._lastRenderer=o,o}get forcedStyle(){const t=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&t&&(t.textboxColor!=null||t.nameboxWidth!=null)?"custom":this.obj.style}updatedContent(t,n){super.updatedContent(t,n);const o=this.obj.talkingObjId;if(o!==null&&o!=="$other$"){const s=t.state.panels.panels[n].objects[o];this.refObject=s!=null?s:null;return}this.refObject=null}draw(t){return _i(this,null,function*(){var n,o;const s=Y(),r=this.textboxRenderer,i=r.width,a=i/2,d=(this.flip?s.Base.screenWidth-this.obj.x:this.obj.x)-a,c=this.obj.y;if(yield r.render(t),this.obj.talkingObjId!==null){const p=this.obj.talkingObjId==="$other$"?this.obj.talkingOther:(o=(n=this.refObject)==null?void 0:n.label)!=null?o:"Missing name";yield this.renderName(t,d+r.nameboxOffsetX,c,p)}yield this.renderText(t,d,c,this.obj.autoWrap?i:0)})}renderName(t,n,o,s){return _i(this,null,function*(){const r=this.textboxRenderer,i=r.nameboxWidth,a=r.nameboxStyle,l=new dt(s,a);yield l.loadFonts(),l.fixAlignment("center",n,n+i,o+r.nameboxOffsetY,0),l.render(t.fsCtx)})}renderText(t,n,o,s){return _i(this,null,function*(){const r=this.textboxRenderer,i=new dt(this.obj.text,r.textboxStyle);this.obj.autoQuoting&&this.obj.talkingObjId!==null&&i.quote(),yield i.loadFonts(),i.fixAlignment("left",n+r.textOffsetX,0,o+r.nameboxHeight+r.textOffsetY,s-r.textOffsetX*2),i.render(t.fsCtx)})}}const rC=ee({components:{Toggle:Rt,DFieldset:Ht},props:{obj:{required:!0}},computed:{freeMove:{get(){return this.obj.freeMove},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setFreeMove",{id:this.obj.id,panelId:this.obj.panelId,freeMove:e})})}},preserveRatio:{get(){return this.obj.preserveRatio},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPreserveRatio",{id:this.obj.id,panelId:this.obj.panelId,preserveRatio:e})})}},pos:{get(){return ur(this.obj.x)},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:Y().Base.characterPositions[e],y:this.obj.y})})}},x:{get(){return this.obj.x},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:e,y:this.y})})}},y:{get(){return this.obj.y},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:this.x,y:e})})}},height:{get(){return this.obj.height},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setHeight",{id:this.obj.id,panelId:this.obj.panelId,height:e})})}},width:{get(){return this.obj.width},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setWidth",{id:this.obj.id,panelId:this.obj.panelId,width:e})})}},allowSize(){const e=this.obj;return e.type==="textBox"?Jo[e.style].resizable:!(e.type==="character"&&!e.freeMove)},allowStepMove(){return"freeMove"in this.obj},positionNames(){return Y().Base.positions},isFirstPos(){return this.pos===0},isLastPos(){return this.pos===Y().Base.positions.length-1}}});const Wr=e=>(ze("data-v-c33846f6"),e=e(),Ge(),e),iC={colspan:"2"},lC={key:0},aC={colspan:"2"},dC={class:"arrow-col"},cC=["disabled"],uC=["value"],pC={class:"arrow-col"},fC=["disabled"],hC=Wr(()=>u("td",null,[u("label",{for:"sprite_x"},"X:")],-1)),gC=Wr(()=>u("td",null,[u("label",{for:"sprite_y"},"Y:")],-1)),mC=Wr(()=>u("td",null,[u("label",{for:"sprite_w"},"Width:")],-1)),bC=Wr(()=>u("td",null,[u("label",{for:"sprite_h"},"Height:")],-1)),vC={colspan:"2"};function yC(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{title:"Position"+(e.allowSize?"/Size":"")},{default:B(()=>[u("table",null,[u("tr",null,[u("td",iC,[e.allowStepMove?(g(),L(i,{key:0,modelValue:e.freeMove,"onUpdate:modelValue":t[0]||(t[0]=l=>e.freeMove=l),label:"Move freely?"},null,8,["modelValue"])):X("",!0)])]),e.allowStepMove&&!e.freeMove?(g(),y("tr",lC,[u("td",aC,[u("table",null,[u("tr",null,[u("td",dC,[u("button",{onClick:t[1]||(t[1]=l=>--e.pos),disabled:e.isFirstPos},"<",8,cC)]),u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=l=>e.pos=l)},[(g(!0),y(U,null,$e(e.positionNames,(l,d)=>(g(),y("option",{key:d,value:d},fe(l),9,uC))),128))],512),[[_t,e.pos,void 0,{number:!0}]])]),u("td",pC,[u("button",{onClick:t[3]||(t[3]=l=>++e.pos),disabled:e.isLastPos},">",8,fC)])])])])])):(g(),y(U,{key:1},[u("tr",null,[hC,u("td",null,[de(u("input",{id:"sprite_x",type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>e.x=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},null,544),[[Te,e.x,void 0,{number:!0}]])])]),u("tr",null,[gC,u("td",null,[de(u("input",{id:"sprite_y",type:"number","onUpdate:modelValue":t[6]||(t[6]=l=>e.y=l),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},null,544),[[Te,e.y,void 0,{number:!0}]])])])],64)),e.allowSize?(g(),y(U,{key:2},[u("tr",null,[mC,u("td",null,[de(u("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":t[8]||(t[8]=l=>e.width=l),onKeydown:t[9]||(t[9]=G(()=>{},["stop"]))},null,544),[[Te,e.width,void 0,{number:!0}]])])]),u("tr",null,[bC,u("td",null,[de(u("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":t[10]||(t[10]=l=>e.height=l),onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Te,e.height,void 0,{number:!0}]])])]),u("tr",null,[u("td",vC,[C(i,{modelValue:e.preserveRatio,"onUpdate:modelValue":t[12]||(t[12]=l=>e.preserveRatio=l),label:"Lock ratio?"},null,8,["modelValue"])])])],64)):X("",!0)])]),_:1},8,["title"])}const _C=ne(rC,[["render",yC],["__scopeId","data-v-c33846f6"]]),wC=ee({components:{Toggle:Rt,DFieldset:Ht},props:{object:{required:!0}},computed:{onTop:ys()("onTop","panels/setOnTop",!0)},methods:{shiftLayer(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/shiftLayer",{id:this.object.id,panelId:this.object.panelId,delta:e})})}}});const zr=e=>(ze("data-v-d80e9416"),e=e(),Ge(),e),$C=zr(()=>u("i",{class:"material-icons"},"vertical_align_bottom",-1)),CC=[$C],PC=zr(()=>u("i",{class:"material-icons"},"arrow_downward",-1)),SC=[PC],kC=zr(()=>u("i",{class:"material-icons"},"arrow_upward",-1)),OC=[kC],xC=zr(()=>u("i",{class:"material-icons"},"vertical_align_top",-1)),jC=[xC];function IC(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{id:"layerfs",title:"Layer:"},{default:B(()=>[u("table",null,[u("tbody",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[0]||(t[0]=l=>e.shiftLayer(-1/0)),title:"Move to back"},CC)]),u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.shiftLayer(-1)),title:"Move backwards"},SC)]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.shiftLayer(1)),title:"Move forwards"},OC)]),u("td",null,[u("button",{onClick:t[3]||(t[3]=l=>e.shiftLayer(1/0)),title:"Move to front"},jC)])])])]),C(i,{modelValue:e.onTop,"onUpdate:modelValue":t[4]||(t[4]=l=>e.onTop=l),label:"In front?"},null,8,["modelValue"])]),_:1})}const TC=ne(wC,[["render",IC],["__scopeId","data-v-d80e9416"]]),EC=ee({props:{obj:{required:!0}},methods:{onClick(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/removeObject",{panelId:this.obj.panelId,id:this.obj.id})})}}});function BC(e,t,n,o,s,r){return g(),y("button",{onClick:t[0]||(t[0]=(...i)=>e.onClick&&e.onClick(...i))},"Delete")}const AC=ne(EC,[["render",BC]]),Hs=255,wi=8,DC=ee({props:{label:{type:String,required:!0},gradientStops:{required:!0},modelValue:{type:Number,required:!0},maxValue:{type:Number,required:!0},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},data:()=>({slideActive:!1}),computed:{vertical(){return this.$store.state.ui.vertical},pointerPath(){const e=this.modelValue/this.maxValue*Hs;return`M${e} 0L${e+14} 0L${e+7} 12Z`},gradientOffset(){return!this.shiftGradient||this.modelValue===0?0:this.modelValue/this.maxValue}},methods:{enterSlide(e){this.slideActive=!0,this.moveSlide(e)},moveSlide(e){if(!this.slideActive)return;const t=this.$refs.svg;if(!t.contains(e.target)&&e.target!==t)return;if(e instanceof MouseEvent&&e.which!==1){this.slideActive=!1;return}const n=t.getBoundingClientRect(),o=n.width/(wi+Hs+wi),r=((e instanceof MouseEvent?e.clientX:e.touches[0].clientX)-n.x)/o;e.preventDefault();const i=Math.max(Math.min(r-wi,Hs),0)/Hs*this.maxValue;this.$emit("update:modelValue",i)},exitSlide(){this.slideActive=!1}}});const RC=["for"],HC=["id","x1","x2"],MC=["offset"],FC=["fill"],NC=["d"],LC=["id","max","value"];function UC(e,t,n,o,s,r){return g(),y("div",{class:pe({slider:!0,vertical:e.vertical}),onKeydown:t[8]||(t[8]=G(()=>{},["stop"]))},[e.noInput?X("",!0):(g(),y("label",{key:0,for:e._.uid},fe(e.label),9,RC)),u("div",null,[(g(),y("svg",{ref:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:t[0]||(t[0]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onMousemove:t[2]||(t[2]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onMouseup:t[4]||(t[4]=(...i)=>e.exitSlide&&e.exitSlide(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.exitSlide&&e.exitSlide(...i))},[u("defs",null,[u("linearGradient",{id:`gradient${e._.uid}`,x1:e.gradientOffset*100+"%",y1:"0%",x2:(e.gradientOffset+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(g(!0),y(U,null,$e(e.gradientStops,(i,a)=>(g(),y("stop",{key:a,offset:a/(e.gradientStops.length-1)*100+"%",style:Re("stop-color:"+i)},null,12,MC))),128))],8,HC)]),u("g",null,[u("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${e._.uid})`},null,8,FC),u("path",{d:e.pointerPath,"stroke-width":"2",class:"slider-pointer"},null,8,NC)])],544))]),e.noInput?X("",!0):(g(),y("input",{key:1,id:e._.uid,class:"sliderInput",min:"0",max:e.maxValue,value:e.modelValue,type:"number",onInput:t[6]||(t[6]=i=>e.$emit("update:modelValue",parseFloat(i.target.value))),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},null,40,LC))],34)}const Of=ne(DC,[["render",UC],["__scopeId","data-v-7a5dc4a7"]]),VC=ee({components:{Slider:Of},props:{modelValue:{type:String,validator:e=>!!e.match(/^#[0-9a-f]{6,8}$/i)},mode:{type:String},relative:Boolean},data:()=>({lastRGBEmit:null,v1:0,v2:0,v3:0,a:0}),computed:{vertical(){return this.$store.state.ui.vertical},maxValue1(){return this.mode==="rgba"?255:360},label1(){return this.mode==="rgba"?"Red":"Hue"},stops1(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v2:0,n=this.relative?this.v3:0;e=[new ae(0,t,n,1),new ae(255,t,n,1)]}else{const t=this.relative?this.v2/100:1,n=this.relative?this.v3/100:.5;e=this.eightsStops(o=>new me(o,t,n,1))}return e.map(t=>t.toRgb().toCss())},maxValue2(){return this.mode==="rgba"?255:100},label2(){return this.mode==="rgba"?"Green":"Saturation"},stops2(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,n=this.relative?this.v3:0;e=[new ae(t,0,n,1),new ae(t,255,n,1)]}else{const t=this.relative?this.v1/360:0,n=this.relative?this.v3/100:.5;e=this.eightsStops(o=>new me(t,o,n,1))}return e.map(t=>t.toRgb().toCss())},maxValue3(){return this.mode==="rgba"?255:100},label3(){return this.mode==="rgba"?"Blue":"Luminosity"},stops3(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,n=this.relative?this.v2:0;e=[new ae(t,n,0,1),new ae(t,n,255,1)]}else{const t=this.relative?this.v1/360:0,n=this.relative?this.v2/100:.5;e=this.eightsStops(o=>new me(t,n,o,1))}return e.map(t=>t.toRgb().toCss())},stopsAlpha(){const e=ae.fromHex(this.modelValue);return[new ae(e.r,e.g,e.b,0).toCss(),new ae(e.r,e.g,e.b,1).toCss()]}},created(){this.initValues()},methods:{valueChanged(){this.modelValue!==this.lastRGBEmit&&this.initValues()},updateValue(){let e;this.mode==="rgba"?e=new ae(this.v1,this.v2,this.v3,this.a/255):e=new me(this.v1/360,this.v2/100,this.v3/100,this.a/255);const t=e.toRgb().toHex();if(this.lastRGBEmit!==t){if(t.length!==9)throw new Error(`Invalid color code: ${t}`);this.lastRGBEmit=t,this.$emit("update:modelValue",t)}},initValues(){const e=ae.fromHex(this.modelValue);if(this.lastRGBEmit=e.toHex(),this.a=e.a*255,this.mode==="hsla"){const t=e.toHSL();this.v1=t.h*360,this.v2=t.s*100,this.v3=t.l*100}else this.v1=e.r,this.v2=e.g,this.v3=e.b},eightsStops(e){const t=[];for(let n=0;n<=8;++n)t.push(e(n/8));return t}},watch:{value(){this.valueChanged()},v1(){this.updateValue()},v2(){this.updateValue()},v3(){this.updateValue()},a(){this.updateValue()},mode(){this.initValues()}}});function WC(e,t,n,o,s,r){const i=E("slider");return g(),y("div",null,[C(i,{label:e.label1,modelValue:e.v1,"onUpdate:modelValue":t[0]||(t[0]=a=>e.v1=a),"max-value":e.maxValue1,"gradient-stops":e.stops1},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:e.label2,modelValue:e.v2,"onUpdate:modelValue":t[1]||(t[1]=a=>e.v2=a),"max-value":e.maxValue2,"gradient-stops":e.stops2},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:e.label3,modelValue:e.v3,"onUpdate:modelValue":t[2]||(t[2]=a=>e.v3=a),"max-value":e.maxValue3,"gradient-stops":e.stops3},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:"Alpha",modelValue:e.a,"onUpdate:modelValue":t[3]||(t[3]=a=>e.a=a),"max-value":255,"gradient-stops":e.stopsAlpha},null,8,["modelValue","gradient-stops"])])}const zC=ne(VC,[["render",WC],["__scopeId","data-v-f8c6e84c"]]);var GC=Object.defineProperty,qC=Object.defineProperties,XC=Object.getOwnPropertyDescriptors,gc=Object.getOwnPropertySymbols,KC=Object.prototype.hasOwnProperty,YC=Object.prototype.propertyIsEnumerable,mc=(e,t,n)=>t in e?GC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,JC=(e,t)=>{for(var n in t||(t={}))KC.call(t,n)&&mc(e,n,t[n]);if(gc)for(var n of gc(t))YC.call(t,n)&&mc(e,n,t[n]);return e},ZC=(e,t)=>qC(e,XC(t));const bc="dddg.generated.colors",QC=ee({components:{SliderGroup:zC,DButton:Ln},inheritAttrs:!1,emits:["leave","update:modelValue"],props:{modelValue:{required:!0,type:String},title:{default:""},format:{type:String,default:"hex"}},data:()=>({mode:"hsla",relative:!0}),computed:{vertical(){return this.$store.state.ui.vertical},swatches(){return this.$store.state.content.current.colors},color:{get(){return this.format==="rgb"?ae.fromCss(this.modelValue).toHex():this.modelValue},set(e){if(this.format==="rgb"){const t=ae.fromCss(e);this.$emit("update:modelValue",t.toCss())}else this.$emit("update:modelValue",e)}}},mounted(){ue.subscribe(sr,this.settingColor)},unmounted(){ue.unsubscribe(sr,this.settingColor)},methods:{settingColor(e){this.color=ae.fromCss(e.color).toHex()},updateHex(e){const t=e.target.value;ae.validHex(t)&&(t.length===7||t.length===9)&&(this.color=t)},addSwatch(){if(this.swatches.find(n=>n.color===this.color))return;const e=this.$store.state.content.contentPacks.find(n=>n.packId===bc)||{packId:bc,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},t=ZC(JC({},e),{colors:[...e.colors,{label:this.color,color:this.color}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:t,processed:!0})})},pickColor(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!0)})}}});const e1={class:"column"},t1={class:"hex-selector"},n1=["for"],o1=["id","value"],s1=["title","onClick"];function r1(e,t,n,o,s,r){const i=E("slider-group"),a=E("d-button");return g(),y("div",{class:pe({color:!0,vertical:e.vertical})},[u("h2",null,fe(e.title),1),u("button",{onClick:t[0]||(t[0]=l=>e.$emit("leave"))},"OK"),u("table",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.mode="hsla")},"HSLA")]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.mode="rgba")},"RGBA")])])]),u("div",e1,[C(i,{mode:e.mode,modelValue:e.color,"onUpdate:modelValue":t[3]||(t[3]=l=>e.color=l),relative:!0},null,8,["mode","modelValue"]),u("div",t1,[u("label",{class:"hex-label",for:`hex_${e._.uid}`},"Hex",8,n1),u("input",{id:`hex_${e._.uid}`,value:e.color,onInput:t[4]||(t[4]=(...l)=>e.updateHex&&e.updateHex(...l)),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},null,40,o1)]),u("button",{onClick:t[6]||(t[6]=(...l)=>e.addSwatch&&e.addSwatch(...l))},"Add as swatch"),C(a,{icon:"colorize",onClick:e.pickColor},{default:B(()=>[O("Pick color")]),_:1},8,["onClick"])]),u("div",{id:"color-swatches",class:pe({vertical:e.vertical})},[(g(!0),y(U,null,$e(e.swatches,l=>(g(),y("button",{class:"swatch",key:l.color,style:Re({backgroundColor:l.color}),title:l.label,onClick:d=>{e.color=l.color,e.$emit("leave")}},null,12,s1))),128))],2)],2)}const Gr=ne(QC,[["render",r1],["__scopeId","data-v-be180e24"]]);var i1=Object.defineProperty,vc=Object.getOwnPropertySymbols,l1=Object.prototype.hasOwnProperty,a1=Object.prototype.propertyIsEnumerable,yc=(e,t,n)=>t in e?i1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,d1=(e,t)=>{for(var n in t||(t={}))l1.call(t,n)&&yc(e,n,t[n]);if(vc)for(var n of vc(t))a1.call(t,n)&&yc(e,n,t[n]);return e};const _c=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function cl(e,t,n){const s=[...t().filters];let r;switch(e.type){case"hue-rotate":r={type:e.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":r={type:e.type,value:1};break;case"drop-shadow":r={type:e.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new At.UnreachableCaseError(e.type)}s.splice(e.idx,0,r),n({panelId:e.panelId,id:e.id,filters:s})}function ul(e,t,n){const s=[...t().filters];s.splice(e.idx,1),n({id:e.id,panelId:e.panelId,filters:s})}function pl(e,t,n){const s=[...t().filters],r=s[e.idx];s.splice(e.idx,1),s.splice(e.idx+e.moveBy,0,r),n({id:e.id,panelId:e.panelId,filters:s})}function fl(e,t,n){const s=[...t().filters],r=d1({},s[e.idx]);s[e.idx]=r,r.type==="drop-shadow"?(e.blurRadius!==void 0&&(r.blurRadius=e.blurRadius),e.color!==void 0&&(r.color=e.color),e.offsetX!==void 0&&(r.offsetX=e.offsetX),e.offsetY!==void 0&&(r.offsetY=e.offsetY)):r.value=e.value,n({id:e.id,panelId:e.panelId,filters:s})}var c1=Object.defineProperty,wc=Object.getOwnPropertySymbols,u1=Object.prototype.hasOwnProperty,p1=Object.prototype.propertyIsEnumerable,$c=(e,t,n)=>t in e?c1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,f1=(e,t)=>{for(var n in t||(t={}))u1.call(t,n)&&$c(e,n,t[n]);if(wc)for(var n of wc(t))p1.call(t,n)&&$c(e,n,t[n]);return e},h1=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const eo=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),g1=(()=>{try{const e=cs();e.width=0,e.height=0;const n="filter"in e.getContext("2d");if(bo(e),n)return Array.from(eo.keys()).sort()}catch(e){}return["opacity"]})(),m1=ee({components:{DFlow:vs,DFieldset:Ht,Color:Gr,Slider:Of,L:Jl},props:{type:{type:String,required:!0},title:{type:String},id:{},panelId:{required:!0},noComposition:{type:Boolean,default:!1}},emits:["leave"],data:()=>({addEffectSelection:"",currentFilterIdx:0,showShadowColor:!1}),computed:{object(){switch(this.type){case"object":return this.$store.state.panels.panels[this.panelId].objects[this.id];case"background":return this.$store.state.panels.panels[this.panelId].background;case"panel":return this.$store.state.panels.panels[this.panelId];default:throw new At.UnreachableCaseError(this.type)}},compositionMode:{get(){return this.object.composite},set(e){this.vuexHistory.transaction(()=>{switch(this.type){case"object":this.$store.commit("panels/setComposition",{id:this.id,panelId:this.panelId,composite:e});break;case"background":break;case"panel":break;default:throw new At.UnreachableCaseError(this.type)}})}},filters(){return this.object.filters},filterTypes(){return g1},currentFilter(){var e;return(e=this.filters[this.currentFilterIdx])!=null?e:null},isPercentFilter(){const e=this.currentFilter;return e?_c.has(e.type):!1},maxValue(){const e=this.currentFilter;if(!!e){if(e.type==="hue-rotate")return 360;if(e.type==="grayscale"||e.type==="sepia"||e.type==="opacity"||e.type==="invert")return 100}},minValue(){const e=this.currentFilter;if(!!e)switch(e.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}},shadowColor:{get(){const e=this.currentFilter;if(!!e&&"color"in e)return e.color},set(e){this.setValue({color:e})}},shadowX:{get(){const e=this.currentFilter;if(!!e&&"offsetX"in e)return e.offsetX},set(e){this.setValue({offsetX:e})}},shadowY:{get(){const e=this.currentFilter;if(!!e&&"offsetY"in e)return e.offsetY},set(e){this.setValue({offsetY:e})}},shadowBlur:{get(){const e=this.currentFilter;if(!!e&&"blurRadius"in e)return e.blurRadius},set(e){this.setValue({blurRadius:e})}},hueStops(){return this.eightsStops(t=>new me(t,1,.5,1)).map(t=>t.toRgb().toCss())}},methods:{getFilterLabel(e){return eo.get(e)},getFilterText(e){return _c.has(e.type)?`${eo.get(e.type)} ${(e.value*100).toFixed()}%`:e.type==="hue-rotate"?`${eo.get(e.type)} ${e.value.toFixed()}\xB0`:e.type==="blur"?`${eo.get(e.type)} ${e.value.toFixed()}px`:eo.get(e.type)},objectTypeScope(e){switch(this.type){case"object":return"panels/object_"+e;case"background":return"panels/background"+e[0].toUpperCase()+e.slice(1);case"panel":return"panels/"+e}},addFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("addFilter"),{id:this.id,panelId:this.panelId,type:this.addEffectSelection,idx:this.currentFilterIdx+1})})},selectFilter(e){this.currentFilterIdx=e},removeFilter(){this.vuexHistory.transaction(()=>h1(this,null,function*(){yield this.$store.dispatch(this.objectTypeScope("removeFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx}),this.currentFilterIdx>=this.object.filters.length&&(this.currentFilterIdx=this.object.filters.length-1)}))},moveFilter(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("moveFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx,moveBy:e}),this.currentFilterIdx+=e})},setValue(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("setFilter"),f1({id:this.id,panelId:this.panelId,idx:this.currentFilterIdx},e))})},eightsStops(e){const t=[];for(let n=0;n<=8;++n)t.push(e(n/8));return t}}});const ce=e=>(ze("data-v-d8e66f9b"),e=e(),Ge(),e),b1=ce(()=>u("h2",null,"Image options",-1)),v1={class:"column ok-col"},y1={key:0,class:"column"},_1=ce(()=>u("label",{for:"compositionSelect"},"Compositing Mode:",-1)),w1=ce(()=>u("option",{value:"source-over"},"source-over",-1)),$1=ce(()=>u("option",{value:"source-atop"},"source-atop",-1)),C1=ce(()=>u("option",{value:"destination-over"},"destination-over",-1)),P1=ce(()=>u("option",{value:"destination-in"},"destination-in",-1)),S1=ce(()=>u("option",{value:"destination-in"},"destination-out",-1)),k1=ce(()=>u("option",{value:"destination-in"},"destination-atop",-1)),O1=ce(()=>u("option",{value:"lighter"},"lighter",-1)),x1=ce(()=>u("option",{value:"xor"},"xor",-1)),j1=ce(()=>u("option",{value:"multiply"},"multiply",-1)),I1=ce(()=>u("option",{value:"screen"},"screen",-1)),T1=ce(()=>u("option",{value:"overlay"},"overlay",-1)),E1=ce(()=>u("option",{value:"darken"},"darken",-1)),B1=ce(()=>u("option",{value:"lighten"},"lighten",-1)),A1=ce(()=>u("option",{value:"color-dodge"},"color-dodge",-1)),D1=ce(()=>u("option",{value:"color-burn"},"color-burn",-1)),R1=ce(()=>u("option",{value:"hard-light"},"hard-light",-1)),H1=ce(()=>u("option",{value:"soft-light"},"soft-light",-1)),M1=ce(()=>u("option",{value:"difference"},"difference",-1)),F1=ce(()=>u("option",{value:"exclusion"},"exclusion",-1)),N1=ce(()=>u("option",{value:"hue"},"hue",-1)),L1=ce(()=>u("option",{value:"saturation"},"saturation",-1)),U1=ce(()=>u("option",{value:"color"},"color",-1)),V1=ce(()=>u("option",{value:"luminosity"},"luminosity",-1)),W1=[w1,$1,C1,P1,S1,k1,O1,x1,j1,I1,T1,E1,B1,A1,D1,R1,H1,M1,F1,N1,L1,U1,V1],z1=ce(()=>u("label",{for:"addEffect"},"Add new effect",-1)),G1=["value"],q1=["disabled"],X1=["disabled"],K1=["disabled"],Y1=["disabled"],J1=["onClick","onKeydown"],Z1={key:0,class:"value-input-table"},Q1=ce(()=>u("td",null,[u("label",{for:"shadow_color"},"Color:")],-1)),eP=ce(()=>u("td",null,[u("label",{for:"filter_x"},"X:")],-1)),tP=ce(()=>u("td",null,[u("label",{for:"filter_y"},"Y:")],-1)),nP=ce(()=>u("td",null,[u("label",{for:"filter_blur"},"Blur:")],-1)),oP=ce(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),sP=["value","max","min"],rP={key:0},iP={colspan:"2"},lP=ce(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),aP=["value","max","min"],dP={key:0},cP={colspan:"2"};function uP(e,t,n,o,s,r){const i=E("color"),a=E("l"),l=E("d-flow"),d=E("slider"),c=E("d-fieldset");return e.showShadowColor?(g(),L(i,{key:0,modelValue:e.shadowColor,"onUpdate:modelValue":t[0]||(t[0]=p=>e.shadowColor=p),format:"rgb",onLeave:t[1]||(t[1]=p=>e.showShadowColor=!1)},null,8,["modelValue"])):(g(),L(l,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:B(()=>[b1,u("div",v1,[u("button",{onClick:t[2]||(t[2]=p=>e.$emit("leave"))},"Back")]),e.noComposition?X("",!0):(g(),y("div",y1,[_1,C(a,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:B(()=>[O("[?] ")]),_:1}),de(u("select",{id:"compositionSelect","onUpdate:modelValue":t[3]||(t[3]=p=>e.compositionMode=p),onKeydown:t[4]||(t[4]=G(()=>{},["stop"]))},W1,544),[[_t,e.compositionMode]])])),C(c,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:B(()=>[C(l,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:B(()=>[C(l,{direction:"vertical","no-wraping":""},{default:B(()=>[z1,de(u("select",{id:"addEffect","onUpdate:modelValue":t[5]||(t[5]=p=>e.addEffectSelection=p),onKeydown:t[6]||(t[6]=G(()=>{},["stop"]))},[(g(!0),y(U,null,$e(e.filterTypes,p=>(g(),y("option",{key:p,value:p},fe(e.getFilterLabel(p)),9,G1))),128))],544),[[_t,e.addEffectSelection]]),u("button",{disabled:e.addEffectSelection==="",onClick:t[7]||(t[7]=(...p)=>e.addFilter&&e.addFilter(...p)),onKeydown:t[8]||(t[8]=G(()=>{},["stop"]))}," Add ",40,q1),u("button",{disabled:!e.currentFilter,onClick:t[9]||(t[9]=(...p)=>e.removeFilter&&e.removeFilter(...p)),onKeydown:t[10]||(t[10]=G(()=>{},["stop"]))}," Remove ",40,X1),u("button",{disabled:e.currentFilterIdx===0,onClick:t[11]||(t[11]=p=>e.moveFilter(-1)),onKeydown:t[12]||(t[12]=G(()=>{},["stop"]))}," Move up ",40,K1),u("button",{disabled:e.currentFilterIdx===e.filters.length-1||e.filters.length===0,onClick:t[13]||(t[13]=p=>e.moveFilter(1)),onKeydown:t[14]||(t[14]=G(()=>{},["stop"]))}," Move down ",40,Y1)]),_:1}),C(l,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:B(()=>[(g(!0),y(U,null,$e(e.filters,(p,f)=>(g(),y("div",{key:f,class:pe({choiceBtn:!0,active:f===e.currentFilterIdx}),tabindex:"0",onClick:b=>e.selectFilter(f),onKeydown:[Le(b=>e.selectFilter(f),["enter"]),Le(G(b=>e.selectFilter(f),["prevent"]),["space"])]},fe(e.getFilterText(p)),43,J1))),128))]),_:1}),e.currentFilter?(g(),y("table",Z1,[e.currentFilter.type==="drop-shadow"?(g(),y(U,{key:0},[u("tr",null,[Q1,u("td",null,[u("button",{id:"shadow_color",class:"color-button",style:Re({background:e.shadowColor}),onClick:t[15]||(t[15]=p=>e.showShadowColor=!0)}," \xA0 ",4)])]),u("tr",null,[eP,u("td",null,[de(u("input",{id:"filter_x",type:"number","onUpdate:modelValue":t[16]||(t[16]=p=>e.shadowX=p),onKeydown:t[17]||(t[17]=G(()=>{},["stop"]))},null,544),[[Te,e.shadowX,void 0,{number:!0}]])])]),u("tr",null,[tP,u("td",null,[de(u("input",{id:"filter_y",type:"number","onUpdate:modelValue":t[18]||(t[18]=p=>e.shadowY=p),onKeydown:t[19]||(t[19]=G(()=>{},["stop"]))},null,544),[[Te,e.shadowY,void 0,{number:!0}]])])]),u("tr",null,[nP,u("td",null,[de(u("input",{id:"filter_blur",type:"number","onUpdate:modelValue":t[20]||(t[20]=p=>e.shadowBlur=p),onKeydown:t[21]||(t[21]=G(()=>{},["stop"]))},null,544),[[Te,e.shadowBlur,void 0,{number:!0}]])])])],64)):e.isPercentFilter?(g(),y(U,{key:1},[u("tr",null,[oP,u("td",null,[u("input",{id:"filter_value",value:(e.currentFilter.value*100).toFixed(),type:"number",max:e.maxValue,min:e.minValue,onInput:t[22]||(t[22]=p=>e.setValue({value:Number(p.target.value/100)})),onKeydown:t[23]||(t[23]=G(()=>{},["stop"]))},null,40,sP),O("% ")])]),e.minValue===0&&e.maxValue!==void 0?(g(),y("tr",rP,[u("td",iP,[C(d,{gradientStops:["#000000","#ffffff"],label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value*100,"no-input":"","onUpdate:modelValue":t[24]||(t[24]=p=>e.setValue({value:Math.round(p)/100}))},null,8,["maxValue","modelValue"])])])):X("",!0)],64)):(g(),y(U,{key:2},[u("tr",null,[lP,u("td",null,[u("input",{id:"filter_value",value:e.currentFilter.value,type:"number",max:e.maxValue,min:e.minValue,onInput:t[25]||(t[25]=p=>e.setValue({value:Number(p.target.value)})),onKeydown:t[26]||(t[26]=G(()=>{},["stop"]))},null,40,aP)])]),e.minValue===0&&e.maxValue!==void 0?(g(),y("tr",dP,[u("td",cP,[C(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"no-input":"","onUpdate:modelValue":t[27]||(t[27]=p=>e.setValue({value:Math.round(p)}))},null,8,["gradientStops","maxValue","modelValue"]),C(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):X("",!0)],64))])):X("",!0)]),_:1})]),_:1})]),_:1}))}const wa=ne(m1,[["render",uP],["__scopeId","data-v-d8e66f9b"]]),pP=ee({inheritAttrs:!1,components:{Color:Gr},props:{modelValue:{type:String,required:!0},title:{type:String,default:""}},data:()=>({colorSelector:"",selectedFont:"",selectedColor:"#000000",rememberedStart:0,rememberedEnd:0,error:""}),computed:{vertical(){return this.$store.state.ui.vertical}},watch:{selectedFont(){this.selectedFont!==""&&(this.insertCommand("font",this.selectedFont),this.selectedFont="")}},methods:{onValueChanged(){const e=Y(),t=this.$refs.textArea.value;try{new dt(t,e.TextBox.NameboxTextStyle),this.error=""}catch(n){this.error=n.message}this.$emit("update:modelValue",t)},selectColor(e){const t=this.$refs.textArea;this.colorSelector=e,this.rememberedStart=t.selectionStart,this.rememberedEnd=t.selectionEnd},applyColor(){const e=this.selectedColor,t=this.colorSelector,n=()=>{const o=this.$refs.textArea;if(!o){this.$nextTick(n);return}o.selectionStart=this.rememberedStart,o.selectionEnd=this.rememberedEnd,this.insertCommand(t==="text"?"color":"outlinecolor",e)};this.$nextTick(n),this.selectedColor="#000000",this.colorSelector=""},insertText(e){const t=this.$refs.textArea,n=t.value,o=t.selectionStart,s=t.selectionEnd;t.value=n.slice(0,o)+e+n.slice(s),t.selectionStart=t.selectionEnd=o+e.length,t.focus(),this.onValueChanged()},insertCommand(e,t){const n=this.$refs.textArea,o=n.value,s=n.selectionStart,r=n.selectionEnd,i=o.slice(s,r),a=o.slice(0,s),l=o.slice(r);let d=e;t&&(d+="="+t),n.value=`${a}{${d}}${i}{/${e}}${l}`,n.selectionStart=s+d.length+2,n.selectionEnd=n.selectionStart+i.length,n.focus(),this.onValueChanged()}}});const fP=e=>(ze("data-v-61424637"),e=e(),Ge(),e),hP={class:"column ok-col"},gP={class:"column"},mP=["value"],bP={key:0,class:"column error-col"},vP={class:"column"},yP=fP(()=>u("p",{class:"hint-col"},"Apply style to selected text:",-1)),_P={class:"column"},wP={class:"column"},$P={class:"column"},CP=nm('<option value data-v-61424637>Font</option><option value="aller" style="font-family:aller;" data-v-61424637> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-61424637> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-61424637> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-61424637> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-61424637> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-61424637> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-61424637> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-61424637> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-61424637> Halogen (MC) </option>',10),PP=[CP];function SP(e,t,n,o,s,r){const i=E("color");return e.colorSelector?(g(),L(i,{key:0,modelValue:e.selectedColor,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedColor=a),onLeave:e.applyColor},null,8,["modelValue","onLeave"])):(g(),y("div",{key:1,class:pe({"text-subpanel":!0,vertical:e.vertical})},[u("h2",null,fe(e.title),1),u("div",hP,[u("button",{onClick:t[1]||(t[1]=a=>e.$emit("leave"))},"OK")]),u("div",gP,[u("textarea",{ref:"textArea",value:e.modelValue,onInput:t[2]||(t[2]=(...a)=>e.onValueChanged&&e.onValueChanged(...a)),onKeydown:t[3]||(t[3]=G(()=>{},["stop"])),onKeypress:t[4]||(t[4]=G(()=>{},["stop"]))},null,40,mP)]),e.error?(g(),y("div",bP,fe(e.error),1)):X("",!0),u("div",vP,[u("button",{onClick:t[5]||(t[5]=a=>e.insertText("\\\\")),class:"style-button"},"Insert \\"),u("button",{onClick:t[6]||(t[6]=a=>e.insertText("\\{")),class:"style-button"},"Insert {"),u("button",{onClick:t[7]||(t[7]=a=>e.insertText("\\}")),class:"style-button"},"Insert }")]),yP,u("div",_P,[u("button",{onClick:t[8]||(t[8]=a=>e.insertCommand("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),u("button",{onClick:t[9]||(t[9]=a=>e.insertCommand("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),u("button",{onClick:t[10]||(t[10]=a=>e.insertCommand("plain")),class:"style-button"}," Plain "),u("button",{onClick:t[11]||(t[11]=a=>e.insertCommand("edited")),class:"style-button edited-style"}," Edited "),u("button",{onClick:t[12]||(t[12]=a=>e.insertCommand("k",2)),class:"style-button",style:{"letter-spacing":"5px"}}," Kerning ")]),u("div",wP,[u("button",{onClick:t[13]||(t[13]=a=>e.insertCommand("alpha",.5)),class:"style-button"}," Alpha ")]),u("div",$P,[u("button",{onClick:t[14]||(t[14]=a=>e.insertCommand("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),de(u("select",{"onUpdate:modelValue":t[15]||(t[15]=a=>e.selectedFont=a),class:"style-button"},PP,512),[[_t,e.selectedFont]]),u("button",{onClick:t[16]||(t[16]=a=>e.selectColor("text")),class:"style-button"}," Text color "),u("button",{onClick:t[17]||(t[17]=a=>e.selectColor("outline")),class:"style-button"}," Outline color ")])],2))}const kP=ne(pP,[["render",SP],["__scopeId","data-v-61424637"]]);var Xn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const $i=ys(),OP=ee({mixins:[st],components:{Toggle:Rt,PositionAndSize:_C,Layers:TC,Delete:AC,TextEditor:kP,ImageOptions:wa,Color:Gr,ModalDialog:Yl,DFieldset:Ht},props:{object:{type:Object,required:!0},title:String,textHandler:{type:Object},colorHandler:{type:Object},showAltPanel:Boolean},data:()=>({imageOptionsOpen:!1,canEdit:!0,modalNameInput:"",showRename:!1,localColorHandler:null}),computed:{flip:$i("flip","panels/setFlip"),rotation:$i("rotation","panels/setRotation"),enlargeWhenTalking:$i("enlargeWhenTalking","panels/setEnlargeWhenTalking"),currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},nameboxWidth:{get(){const e=this.object.nameboxWidth;return e===null?"":e+""},set(e){const t=e.trim()===""?null:parseInt(e);this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setObjectNameboxWidth",{id:this.object.id,panelId:this.object.panelId,nameboxWidth:t})}))}},zoom:{get(){return this.object.zoom*100},set(e){this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setObjectZoom",{id:this.object.id,panelId:this.object.panelId,zoom:e/100})}))}},defaultNameboxWidth(){return Y().TextBox.NameboxWidth},finalColorHandler(){return this.localColorHandler||this.colorHandler||null},hasLabel(){return this.object.label!==null},heading(){var e,t;return(t=(e=this.object.label)!=null?e:this.title)!=null?t:"Object"},useCustomTextboxColor:{get(){return this.object.textboxColor!==null},set(e){this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e?Y().TextBoxCustom.textboxDefaultColor:null})}))}}},methods:{copy(){this.vuexHistory.transaction(()=>Xn(this,null,function*(){yield this.$store.dispatch("panels/copyObjectToClipboard",{panelId:this.object.panelId,id:this.object.id})}))},enableNameEdit(){var e;this.modalNameInput=(e=this.object.label)!=null?e:"",this.showRename=!0},renameOption(e){this.showRename=!1,e==="Apply"&&this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setLabel",{panelId:this.object.panelId,id:this.object.id,label:this.modalNameInput})}))},selectTextboxColor(){this.localColorHandler={title:"Textbox color",get:()=>this.object.textboxColor,set:e=>{this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e})}))},leave:()=>{this.localColorHandler=null}}}}});const Bo=e=>(ze("data-v-96a1ac72"),e=e(),Ge(),e),xP={class:"panel"},jP=Bo(()=>u("span",{class:"icon material-icons"},"edit",-1)),IP=Bo(()=>u("p",{class:"modal-text"},"Enter the new name",-1)),TP={class:"modal-text"},EP={class:"input-table"},BP=Bo(()=>u("td",null,[u("label",{for:"rotation"},"Rotation: \xB0")],-1)),AP={key:0},DP=Bo(()=>u("td",null,[u("label",{for:"zoom"},"Zoom: ")],-1)),RP={key:0},HP=Bo(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),MP=Bo(()=>u("td",null,[u("label",{for:"namebox_width"},"Namebox width:")],-1)),FP=["placeholder"];function NP(e,t,n,o,s,r){const i=E("modal-dialog"),a=E("text-editor"),l=E("color"),d=E("image-options"),c=E("position-and-size"),p=E("layers"),f=E("toggle"),b=E("d-fieldset"),v=E("delete");return g(),y("div",xP,[u("h1",{style:Re({fontStyle:e.hasLabel?"italic":"normal"}),onClick:t[0]||(t[0]=(...w)=>e.enableNameEdit&&e.enableNameEdit(...w))},[O(fe(e.heading)+" ",1),jP],4),(g(),L(ip,{to:"#modal-messages"},[e.showRename?(g(),L(i,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:e.renameOption,onLeave:t[3]||(t[3]=w=>e.renameOption("Cancel"))},{default:B(()=>[IP,u("p",TP,[de(u("input",{"onUpdate:modelValue":t[1]||(t[1]=w=>e.modalNameInput=w),style:{width:"100%"},onKeydown:t[2]||(t[2]=Le(G(w=>e.renameOption("Apply"),["prevent","stop"]),["enter"]))},null,544),[[Te,e.modalNameInput]])])]),_:1},8,["onOption"])):X("",!0)])),e.textHandler?(g(),L(a,{key:0,title:e.textHandler.title,modelValue:e.textHandler.get(),"onUpdate:modelValue":t[4]||(t[4]=w=>e.textHandler.set(w)),onLeave:t[5]||(t[5]=w=>e.textHandler.leave())},null,8,["title","modelValue"])):e.finalColorHandler?(g(),L(l,{key:1,title:e.finalColorHandler.title,modelValue:e.finalColorHandler.get(),"onUpdate:modelValue":t[6]||(t[6]=w=>e.finalColorHandler.set(w)),onLeave:t[7]||(t[7]=w=>e.finalColorHandler.leave())},null,8,["title","modelValue"])):e.imageOptionsOpen?(g(),L(d,{key:2,type:"object","panel-id":e.object.panelId,id:e.object.id,onLeave:t[8]||(t[8]=w=>e.imageOptionsOpen=!1)},null,8,["panel-id","id"])):e.showAltPanel?qt(e.$slots,"alt-panel",{key:3},void 0,!0):(g(),y(U,{key:4},[qt(e.$slots,"default",{},void 0,!0),C(c,{obj:e.object},null,8,["obj"]),C(p,{object:e.object},null,8,["object"]),C(f,{modelValue:e.flip,"onUpdate:modelValue":t[9]||(t[9]=w=>e.flip=w),label:"Flip?"},null,8,["modelValue"]),u("table",EP,[u("tr",null,[BP,u("td",null,[de(u("input",{id:"rotation",class:"smol",type:"number","onUpdate:modelValue":t[10]||(t[10]=w=>e.rotation=w),onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Te,e.rotation]])])]),e.object.type==="character"||e.object.type==="sprite"?(g(),y("tr",AP,[DP,u("td",null,[de(u("input",{id:"zoom",type:"number",class:"smol",step:"1",min:"0","onUpdate:modelValue":t[12]||(t[12]=w=>e.zoom=w),onKeydown:t[13]||(t[13]=G(()=>{},["stop"]))},null,544),[[Te,e.zoom]])])])):X("",!0)]),qt(e.$slots,"options",{},void 0,!0),e.hasLabel?(g(),L(b,{key:0,title:"Textbox settings"},{default:B(()=>[e.object.type==="character"||e.object.type==="sprite"?(g(),L(f,{key:0,label:"Enlarge when talking",modelValue:e.enlargeWhenTalking,"onUpdate:modelValue":t[14]||(t[14]=w=>e.enlargeWhenTalking=w)},null,8,["modelValue"])):X("",!0),C(f,{label:"Use custom textbox color",modelValue:e.useCustomTextboxColor,"onUpdate:modelValue":t[15]||(t[15]=w=>e.useCustomTextboxColor=w)},null,8,["modelValue"]),u("table",null,[e.useCustomTextboxColor?(g(),y("tr",RP,[HP,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Re({background:e.object.textboxColor}),onClick:t[16]||(t[16]=(...w)=>e.selectTextboxColor&&e.selectTextboxColor(...w))},null,4)])])):X("",!0),u("tr",null,[MP,u("td",null,[de(u("input",{id:"namebox_width",type:"number",placeholder:e.defaultNameboxWidth,"onUpdate:modelValue":t[17]||(t[17]=w=>e.nameboxWidth=w)},null,8,FP),[[Te,e.nameboxWidth,void 0,{lazy:!0}]])])])])]),_:1})):X("",!0),u("button",{onClick:t[18]||(t[18]=w=>e.imageOptionsOpen=!0)},"Image options"),u("button",{onClick:t[19]||(t[19]=(...w)=>e.copy&&e.copy(...w))},"Copy"),C(v,{obj:e.object},null,8,["obj"])],64))])}const Ao=ne(OP,[["render",NP],["__scopeId","data-v-96a1ac72"]]);var Cc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Pc=ys(),LP=ee({mixins:[st],components:{Toggle:Rt,Parts:z$,DFieldset:Ht,ObjectTool:Ao},data:()=>({panelForParts:null}),computed:{flip:Pc("flip","panels/setFlip"),closeUp:Pc("close","panels/setClose"),missingHead(){const e=this.charData,t=this.object,n=cr(e,t);if(!n)return null;for(const o of n.variants){const s=Mn(o[0],!1);if(console.log(s),s.startsWith("uploads:"))return s.substring(8)}return null},selection(){return this.$store.state.ui.selection},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.selection];if(e.type==="character")return e},charData(){return Nr(this.$store,this.object)},label(){var e;return(e=this.charData.label)!=null?e:""},parts(){return u$(this.charData,this.object)},hasMultipleStyles(){return this.charData.styleGroups[this.object.styleGroupId].styles.length>1||this.charData.styleGroups.length>1},hasMultiplePoses(){return this.charData.styleGroups[this.object.styleGroupId].styles[this.object.styleId].poses.length>1}},methods:{reuploadHead(){this.$refs.missingHeadUpload.click()},onMissingHeadFileUpload(e){return Cc(this,null,function*(){const t=this.$refs.missingHeadUpload;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const n=t.files[0];yield this.vuexHistory.transaction(()=>Cc(this,null,function*(){const o=URL.createObjectURL(n);yield this.$store.dispatch("uploadUrls/add",{name:this.missingHead,url:o})}))})},seekPose(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPose",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekStyle(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekStyle",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPart",{id:this.object.id,panelId:this.object.panelId,delta:t,part:e})})},captialize(e){return e.charAt(0).toUpperCase()+e.substring(1)}},watch:{selection(){this.panelForParts=null}}});const UP={class:"warning"},VP={style:{"word-wrap":"break-word"}},WP={key:0},zP={class:"arrow-col"},GP={class:"arrow-col"},qP={key:1},XP={class:"arrow-col"},KP={class:"arrow-col"},YP={class:"arrow-col"},JP=["onClick"],ZP=["onClick"],QP={class:"arrow-col"},eS=["onClick"];function tS(e,t,n,o,s,r){const i=E("parts"),a=E("d-fieldset"),l=E("toggle"),d=E("object-tool");return g(),L(d,{object:e.object,title:e.label,showAltPanel:!!e.panelForParts},{"alt-panel":B(()=>[e.panelForParts?(g(),L(i,{key:0,character:e.object,part:e.panelForParts,onLeave:t[0]||(t[0]=c=>e.panelForParts=null),onShowDialog:t[1]||(t[1]=c=>e.$emit("show-dialog",c)),onShowExpressionDialog:t[2]||(t[2]=c=>e.$emit("show-expression-dialog",c))},null,8,["character","part"])):X("",!0)]),default:B(()=>[e.missingHead?(g(),y(U,{key:0},[u("p",UP,[O(" MISSING Head sprite! Click below to re-upload "),u("span",VP,'"'+fe(e.missingHead)+'"',1),O(". ")]),u("button",{onClick:t[3]||(t[3]=c=>e.reuploadHead())},"Re-Upload"),u("input",{type:"file",ref:"missingHeadUpload",onChange:t[4]||(t[4]=(...c)=>e.onMissingHeadFileUpload&&e.onMissingHeadFileUpload(...c))},null,544)],64)):X("",!0),e.hasMultiplePoses||e.parts.length>0||e.hasMultipleStyles?(g(),L(a,{key:1,class:"pose-list",title:"Pose:"},{default:B(()=>[u("table",null,[u("tbody",null,[e.hasMultipleStyles?(g(),y("tr",WP,[u("td",zP,[u("button",{onClick:t[5]||(t[5]=c=>e.seekStyle(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[6]||(t[6]=c=>e.panelForParts="style")}," Style ")]),u("td",GP,[u("button",{onClick:t[7]||(t[7]=c=>e.seekStyle(1))},">")])])):X("",!0),e.hasMultiplePoses?(g(),y("tr",qP,[u("td",XP,[u("button",{onClick:t[8]||(t[8]=c=>e.seekPose(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[9]||(t[9]=c=>e.panelForParts="pose")}," Pose ")]),u("td",KP,[u("button",{onClick:t[10]||(t[10]=c=>e.seekPose(1))},">")])])):X("",!0),(g(!0),y(U,null,$e(e.parts,c=>(g(),y("tr",{key:c},[u("td",YP,[u("button",{onClick:p=>e.seekPart(c,-1)},"<",8,JP)]),u("td",null,[u("button",{class:"middle-button",onClick:p=>e.panelForParts=c},fe(e.captialize(c)),9,ZP)]),u("td",QP,[u("button",{onClick:p=>e.seekPart(c,1)},">",8,eS)])]))),128))])])]),_:1})):X("",!0)]),options:B(()=>[C(l,{modelValue:e.closeUp,"onUpdate:modelValue":t[11]||(t[11]=c=>e.closeUp=c),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"])}const nS=ne(LP,[["render",tS],["__scopeId","data-v-f2647495"]]);var Sc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const oS=ee({mixins:[st],components:{ObjectTool:Ao},computed:{missing(){for(const e of this.object.assets){const t=Mn(e,!1);if(console.log(t),t.startsWith("uploads:"))return t.substring(8)}return null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="sprite")return e}},methods:{reupload(){this.$refs.missingSpriteUpload.click()},onMissingSpriteFileUpload(e){return Sc(this,null,function*(){const t=this.$refs.missingSpriteUpload;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const n=t.files[0];yield this.vuexHistory.transaction(()=>Sc(this,null,function*(){const o=URL.createObjectURL(n);yield this.$store.dispatch("uploadUrls/add",{name:this.missing,url:o})}))})}}});const sS={class:"warning"},rS={style:{"word-wrap":"break-word"}};function iS(e,t,n,o,s,r){const i=E("object-tool");return g(),L(i,{object:e.object,title:"Custom Sprite"},{default:B(()=>[e.missing?(g(),y(U,{key:0},[u("p",sS,[O(" MISSING SPRITE! Click below to re-upload "),u("span",rS,'"'+fe(e.missing)+'"',1),O(". ")]),u("button",{onClick:t[0]||(t[0]=a=>e.reupload())},"Re-Upload"),u("input",{type:"file",ref:"missingSpriteUpload",onChange:t[1]||(t[1]=(...a)=>e.onMissingSpriteFileUpload&&e.onMissingSpriteFileUpload(...a))},null,544)],64)):X("",!0)]),_:1},8,["object"])}const lS=ne(oS,[["render",iS],["__scopeId","data-v-38366137"]]);function kc(e,t,n){return e>t?e:t>n?n:t}var aS=Object.defineProperty,dS=Object.defineProperties,cS=Object.getOwnPropertyDescriptors,Oc=Object.getOwnPropertySymbols,uS=Object.prototype.hasOwnProperty,pS=Object.prototype.propertyIsEnumerable,xc=(e,t,n)=>t in e?aS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,jc=(e,t)=>{for(var n in t||(t={}))uS.call(t,n)&&xc(e,n,t[n]);if(Oc)for(var n of Oc(t))pS.call(t,n)&&xc(e,n,t[n]);return e},fS=(e,t)=>dS(e,cS(t)),hS=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Ic=4,gS={setTalkingObject(e,t){const n=e.panels[t.panelId].objects[t.id];n.talkingObjId=t.talkingObjId,++n.version},setTalkingOther(e,t){const n=e.panels[t.panelId].objects[t.id];n.talkingOther=t.talkingOther,n.talkingObjId="$other$",++n.version},setResetBounds(e,t){const n=e.panels[t.panelId].objects[t.id];n.resetBounds=t.resetBounds,n.x=t.resetBounds.x,n.y=t.resetBounds.y,n.height=t.resetBounds.height,n.width=t.resetBounds.width,n.rotation=t.resetBounds.rotation,++n.version},setTextBoxProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},mS={createTextBox({commit:e,state:t,rootState:n},o){var s;const r=Y(),i=t.panels[o.panelId].lastObjId+1,a=r.TextBox.DefaultTextboxStyle,l=Jo[a],d=o.resetBounds||{x:l.defaultX,y:l.defaultY,width:l.defaultWidth,height:l.defaultHeight,rotation:0};return e("create",{object:fS(jc(jc({},Io()),d),{panelId:n.panels.currentPanel,id:i,onTop:!0,type:"textBox",preserveRatio:!1,ratio:r.TextBox.TextBoxWidth/r.TextBox.TextBoxHeight,continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:a,overrideColor:!1,customColor:r.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:r.TextBoxCustom.controlsDefaultColor,customNameboxColor:r.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:r.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:(s=o.text)!=null?s:"Click here to edit the textbox",resetBounds:d})}),i},setStyle({state:e,commit:t},n){const o=Y(),s=e.panels[n.panelId].objects[n.id],r=Jo[s.style],i=Jo[n.style],a=10;let l=!1;const d={panelId:n.panelId,id:n.id,x:s.x,y:s.y};let c=!1;const p={panelId:n.panelId,id:n.id,width:s.width,height:s.height};i.resizable?(r.defaultWidth!==i.defaultWidth&&(c=!0,p.width=Math.max(p.width+i.defaultWidth-r.defaultWidth,a)),r.defaultHeight!==i.defaultHeight&&(c=!0,p.height=Math.max(p.height+i.defaultHeight-r.defaultHeight,a))):(c=!0,p.width=i.defaultWidth,p.height=i.defaultHeight),r.defaultX!==i.defaultX&&(l=!0,d.x=kc(-p.width+a,d.x+i.defaultX-r.defaultX,o.Base.screenWidth-a)),r.defaultY!==i.defaultY&&(l=!0,d.y=kc(-p.height+a,d.y+i.defaultY-r.defaultY,o.Base.screenHeight-a)),l&&t("setPosition",d),c&&t("setSize",p),t("setTextBoxProperty",Gs(n.panelId,n.id,"style",n.style))},resetTextboxBounds({commit:e,state:t},n){const o=t.panels[n.panelId].objects[n.id];e("setPosition",{panelId:n.panelId,id:n.id,x:o.resetBounds.x,y:o.resetBounds.y}),e("setSize",{panelId:n.panelId,id:n.id,height:o.resetBounds.height,width:o.resetBounds.width}),e("setRotation",{panelId:n.panelId,id:n.id,rotation:o.resetBounds.rotation})},splitTextbox(e,t){return hS(this,arguments,function*({commit:n,state:o,dispatch:s},r){const i=o.panels[r.panelId].objects[r.id];if(i.type!=="textBox")return;const a=(i.width-Ic)/2,l=a/2+Ic/2,d=[i.x,i.y];let c=[i.x-l,i.y],p=[i.x+l,i.y];i.rotation!==0&&(c=pr(c[0],c[1],d[0],d[1],i.rotation/180*Math.PI),p=pr(p[0],p[1],d[0],d[1],i.rotation/180*Math.PI)),n("setResetBounds",{id:r.id,panelId:r.panelId,resetBounds:{x:c[0],y:c[1],width:a,height:i.height,rotation:i.rotation}});const f=i.style==="custom_plus"?"custom_plus":"custom";i.style!==f&&(yield s("setStyle",Gs(r.panelId,r.id,"style",f)));const b=yield s("createTextBox",{panelId:r.panelId,resetBounds:{x:p[0],y:p[1],width:a,height:i.height,rotation:i.rotation}});yield s("setStyle",Gs(r.panelId,b,"style",f)),i.flip&&n("setFlip",{id:b,panelId:r.panelId,flip:i.flip})})}};function Gs(e,t,n,o){return{id:t,panelId:e,key:n,value:o}}const Tc=ys(),Nt=ba("panels/setTextBoxProperty"),bS=ee({components:{Toggle:Rt,DFieldset:Ht,ObjectTool:Ao,DFlow:vs},mixins:[st],data:()=>({textEditor:"",colorSelect:""}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},customizable(){return this.textBoxStyle.startsWith("custom")},nameboxWidthDefault(){return Y().TextBox.NameboxWidth},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="textBox")return e},textHandler(){if(!!this.textEditor)return{title:this.textEditorName,get:()=>this.textEditor==="name"?this.object.talkingOther:this.textEditor==="body"?this.dialog:"",set:e=>{this.textEditor==="name"?this.talkingOther=e:this.textEditor==="body"&&(this.dialog=e)},leave:()=>{this.textEditor=""}}},colorHandler(){if(!!this.colorSelect)return{title:this.colorName,get:()=>{switch(this.colorSelect){case"":return"#000000";case"base":return this.object.customColor;case"controls":return this.object.customControlsColor;case"namebox":return this.object.customNameboxColor;case"nameboxStroke":return this.object.customNameboxStroke;default:throw new At.UnreachableCaseError(this.colorSelect)}},set:e=>{this.vuexHistory.transaction(()=>{const t=this.currentPanel.id,n=this.object.id;let o={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[this.colorSelect];e!==void 0&&this.$store.commit("panels/setTextBoxProperty",Gs(t,n,o,e))})},leave:()=>{this.colorSelect=""}}},talkingObjId:{get(){var e;return(e=this.object.talkingObjId)!=null?e:"$null$"},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setTalkingObject",{id:this.object.id,panelId:this.object.panelId,talkingObjId:e==="$null$"?null:e})})}},talkingOther:Tc("talkingOther","panels/setTalkingOther"),textBoxStyle:Tc("style","panels/setStyle",!0),showControls:Nt("controls"),allowSkipping:Nt("skip"),autoQuoting:Nt("autoQuoting"),autoWrap:Nt("autoWrap"),showContinueArrow:Nt("continue"),dialog:Nt("text"),overrideColor:Nt("overrideColor"),deriveCustomColors:Nt("deriveCustomColors"),customNameboxWidth:Nt("customNameboxWidth"),nameList(){const e=this.currentPanel,t=[];for(const n of[...e.order,...e.onTopOrder]){const o=e.objects[n];o.label!==null&&t.push([n,o.label])}return t},textEditorName(){return this.textEditor==="name"?"Name":this.textEditor==="body"?"Dialog":""},customControlsColor(){return this.object.customControlsColor},colorName(){switch(this.colorSelect){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new At.UnreachableCaseError(this.colorSelect)}}},methods:{splitTextbox(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/splitTextbox",{id:this.object.id,panelId:this.object.panelId})})},resetPosition(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/resetTextboxBounds",{id:this.object.id,panelId:this.object.panelId})})},jumpToCharacter(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",this.talkingObjId)})}}});const qe=e=>(ze("data-v-725704da"),e=e(),Ge(),e),vS={class:"upper-combos"},yS=qe(()=>u("td",null,[u("label",{for:"text_style"},"Style:")],-1)),_S={colspan:"2"},wS=qe(()=>u("option",{value:"normal"},"Normal",-1)),$S=qe(()=>u("option",{value:"corrupt"},"Corrupt",-1)),CS=qe(()=>u("option",{value:"custom"},"Custom",-1)),PS=qe(()=>u("option",{value:"custom_plus"},"Custom (Plus)",-1)),SS=qe(()=>u("option",{value:"none"},"None",-1)),kS=[wS,$S,CS,PS,SS],OS=qe(()=>u("td",null,[u("label",{for:"current_talking"},"Person talking:")],-1)),xS=qe(()=>u("option",{value:"$null$"},"No-one",-1)),jS=["value"],IS=qe(()=>u("option",{value:"$other$"},"Other",-1)),TS=["disabled"],ES=qe(()=>u("td",null,[u("label",{for:"custom_name"},"Other name:")],-1)),BS={id:"dialog_text_wrapper"},AS=qe(()=>u("label",{for:"dialog_text"},"Dialog:",-1)),DS={key:0},RS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),HS=["placeholder","disabled"],MS={colspan:"2"},FS={key:0},NS=qe(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),LS={key:1},US={colspan:"2"},VS=qe(()=>u("td",null,[u("label",{for:"custom_controls_color"},"Controls Color:")],-1)),WS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_color"},"Namebox Color:")],-1)),zS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1));function GS(e,t,n,o,s,r){const i=E("toggle"),a=E("d-flow"),l=E("d-fieldset"),d=E("object-tool");return g(),L(d,{object:e.object,title:"Textbox",textHandler:e.textHandler,colorHandler:e.colorHandler},{default:B(()=>[u("table",vS,[u("tr",null,[yS,u("td",_S,[de(u("select",{id:"text_style","onUpdate:modelValue":t[0]||(t[0]=c=>e.textBoxStyle=c),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},kS,544),[[_t,e.textBoxStyle]])])]),u("tr",null,[OS,u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=c=>e.talkingObjId=c),onKeydown:t[3]||(t[3]=G(()=>{},["stop"]))},[xS,(g(!0),y(U,null,$e(e.nameList,([c,p])=>(g(),y("option",{key:c,value:c},fe(p),9,jS))),128)),IS],544),[[_t,e.talkingObjId]])]),u("td",null,[u("button",{title:"Jump to talking character",onClick:t[4]||(t[4]=(...c)=>e.jumpToCharacter&&e.jumpToCharacter(...c)),disabled:e.talkingObjId==="$null$"||e.talkingObjId==="$other$"}," > ",8,TS)])]),u("tr",null,[ES,u("td",null,[de(u("input",{id:"custom_name","onUpdate:modelValue":t[5]||(t[5]=c=>e.talkingOther=c),onKeydown:t[6]||(t[6]=G(()=>{},["stop"]))},null,544),[[Te,e.talkingOther]])]),u("td",null,[u("button",{onClick:t[7]||(t[7]=c=>e.textEditor="name")},"...")])])]),C(i,{label:"Auto quoting?",modelValue:e.autoQuoting,"onUpdate:modelValue":t[8]||(t[8]=c=>e.autoQuoting=c)},null,8,["modelValue"]),C(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[9]||(t[9]=c=>e.autoWrap=c)},null,8,["modelValue"]),u("div",BS,[AS,de(u("textarea",{"onUpdate:modelValue":t[10]||(t[10]=c=>e.dialog=c),id:"dialog_text",onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Te,e.dialog]]),u("button",{onClick:t[12]||(t[12]=c=>e.textEditor="body")},"Formatting")])]),options:B(()=>[C(l,{title:"Customization:",class:pe(e.customizable?"customization-set":"")},{default:B(()=>[C(a,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:B(()=>[C(i,{label:"Controls visible?",modelValue:e.showControls,"onUpdate:modelValue":t[13]||(t[13]=c=>e.showControls=c)},null,8,["modelValue"]),C(i,{label:"Able to skip?",modelValue:e.allowSkipping,"onUpdate:modelValue":t[14]||(t[14]=c=>e.allowSkipping=c)},null,8,["modelValue"]),C(i,{label:"Continue arrow?",modelValue:e.showContinueArrow,"onUpdate:modelValue":t[15]||(t[15]=c=>e.showContinueArrow=c)},null,8,["modelValue"]),e.customizable?(g(),y("table",DS,[u("tr",null,[RS,u("td",null,[de(u("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:e.nameboxWidthDefault,"onUpdate:modelValue":t[16]||(t[16]=c=>e.customNameboxWidth=c),disabled:e.overrideColor,onKeydown:t[17]||(t[17]=G(()=>{},["stop"]))},null,40,HS),[[Te,e.customNameboxWidth,void 0,{number:!0}]])])]),u("tr",null,[u("td",MS,[C(i,{modelValue:e.overrideColor,"onUpdate:modelValue":t[18]||(t[18]=c=>e.overrideColor=c),label:"Override color"},null,8,["modelValue"])])]),e.overrideColor?(g(),y("tr",FS,[NS,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Re({background:e.object.customColor}),onClick:t[19]||(t[19]=c=>e.colorSelect="base")},null,4)])])):X("",!0),e.overrideColor?(g(),y("tr",LS,[u("td",US,[C(i,{id:"derive_custom_colors",modelValue:e.deriveCustomColors,"onUpdate:modelValue":t[20]||(t[20]=c=>e.deriveCustomColors=c),label:"Derive other colors"},null,8,["modelValue"])])])):X("",!0),e.overrideColor&&!e.deriveCustomColors?(g(),y(U,{key:2},[u("tr",null,[VS,u("td",null,[u("button",{id:"custom_controls_color",class:"color-button",style:Re({background:e.object.customControlsColor}),onClick:t[21]||(t[21]=c=>e.colorSelect="controls")},null,4)])]),u("tr",null,[WS,u("td",null,[u("button",{id:"custom_namebox_color",class:"color-button",style:Re({background:e.object.customNameboxColor}),onClick:t[22]||(t[22]=c=>e.colorSelect="namebox")},null,4)])]),u("tr",null,[zS,u("td",null,[u("button",{id:"custom_namebox_stroke",class:"color-button",style:Re({background:e.object.customNameboxStroke}),onClick:t[23]||(t[23]=c=>e.colorSelect="nameboxStroke")},null,4)])])],64)):X("",!0)])):X("",!0)]),_:1})]),_:1},8,["class"]),u("button",{onClick:t[24]||(t[24]=(...c)=>e.resetPosition&&e.resetPosition(...c))},"Reset position"),u("button",{onClick:t[25]||(t[25]=(...c)=>e.splitTextbox&&e.splitTextbox(...c))},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"])}const qS=ne(bS,[["render",GS],["__scopeId","data-v-725704da"]]),XS=ys(),KS=ee({mixins:[st],components:{Toggle:Rt,DFieldset:Ht,DFlow:vs,ObjectTool:Ao},data:()=>({currentIdx:0,textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="choice")return e},autoWrap:XS("autoWrap","panels/setAutoWrapping"),buttonText:YS("text"),buttons(){return this.object.choices},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.buttonText,set:e=>{this.buttonText=e},leave:()=>{this.textEditor=!1}}}},methods:{select(e){this.currentIdx=e},addChoice(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/addChoice",{id:this.object.id,panelId:this.object.panelId,text:""})})},removeChoice(){this.vuexHistory.transaction(()=>{this.currentIdx===this.object.choices.length-1&&this.currentIdx>0&&this.select(this.currentIdx-1),this.$store.dispatch("panels/removeChoice",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx})})}}});function YS(e){return{get(){return this.object.choices[this.currentIdx][e]},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setChoiceProperty",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx,key:e,value:t})})}}}const JS=e=>(ze("data-v-60e50bc5"),e=e(),Ge(),e),ZS=["onClick"],QS=JS(()=>u("tr",null,[u("td",{colspan:"2"},[u("label",{for:"choice-button-input"},"Text")])],-1));function ek(e,t,n,o,s,r){const i=E("d-flow"),a=E("d-fieldset"),l=E("toggle"),d=E("object-tool");return g(),L(d,{object:e.object,title:"Choice",textHandler:e.textHandler},{default:B(()=>[C(a,{class:"buttons",title:"Buttons:"},{default:B(()=>[C(i,{maxSize:"100%",direction:"vertical",noWraping:""},{default:B(()=>[(g(!0),y(U,null,$e(e.buttons,(c,p)=>(g(),y("div",{class:pe({choiceBtn:!0,active:p===e.currentIdx}),key:p,onClick:f=>e.select(p)},fe(c.text.trim()===""?"[Empty]":c.text),11,ZS))),128))]),_:1})]),_:1}),C(a,{class:"current_button",title:"Current button:"},{default:B(()=>[u("table",null,[QS,u("tr",null,[u("td",null,[de(u("input",{id:"choice-button-input","onUpdate:modelValue":t[0]||(t[0]=c=>e.buttonText=c),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Te,e.buttonText]])]),u("td",null,[u("button",{onClick:t[2]||(t[2]=c=>e.textEditor=!0)},"...")])])])]),_:1}),u("button",{onClick:t[3]||(t[3]=(...c)=>e.addChoice&&e.addChoice(...c))},"Add"),u("button",{onClick:t[4]||(t[4]=(...c)=>e.removeChoice&&e.removeChoice(...c))},"Remove"),C(l,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[5]||(t[5]=c=>e.autoWrap=c)},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const tk=ne(KS,[["render",ek],["__scopeId","data-v-60e50bc5"]]),nk=ee({mixins:[st],components:{L:Jl}});const Qt=e=>(ze("data-v-8073b468"),e=e(),Ge(),e),ok={class:"panel"},sk=Qt(()=>u("h1",null,"Help and Credits",-1)),rk=Qt(()=>u("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),ik=Qt(()=>u("p",null,[O(" Doki Doki Dialog Generator developed by EDave64 "),u("br"),O("Based on gemdude46's DDLC Shitpost generator ")],-1)),lk=Qt(()=>u("p",null,[O(" MC Sprite by Childish-N "),u("br"),O("MC Casual Sprite by SlightlySimple "),u("br"),O("MC Chibi by SlightlySimple ")],-1)),ak=Qt(()=>u("p",null,[O(" MC Chad Sprite by Cylent-Nite "),u("br"),O("MC Chad Poses and expressions by SlightlySimple "),u("br"),O("MC Chad Poses and chibi by Meddy-sin ")],-1)),dk=Qt(()=>u("p",null,[O(" FeMC Sprite by Meddy-sin "),u("br"),O("FeMC Casual Sprite by SlightlySimple ")],-1)),ck=Qt(()=>u("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),uk=Qt(()=>u("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),pk=Qt(()=>u("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1));function fk(e,t,n,o,s,r){const i=E("l");return g(),y("div",ok,[sk,C(i,{class:"btn",to:"wiki://Dokumentation"},{default:B(()=>[O("Help")]),_:1}),C(i,{class:"btn",to:"github://"},{default:B(()=>[O("Fork me on GitHub")]),_:1}),C(i,{class:"btn",to:"wiki://Privacy Statement"},{default:B(()=>[O("Privacy Statement")]),_:1}),rk,ik,u("p",null,[O(" Unused House Background by "),C(i,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:B(()=>[O(" Fatelogic ")]),_:1})]),u("p",null,[O(" Aller Font by "),C(i,{to:"https://www.daltonmaag.com/library/aller"},{default:B(()=>[O("Dalton Maag Ltd")]),_:1})]),u("p",null,[O(" Riffic Bold Font by "),C(i,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:B(()=>[O("InkyType")]),_:1})]),u("p",null,[O(" Verily Serif Mono Font by "),C(i,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:B(()=>[O("Stephen G. Hartke")]),_:1})]),u("p",null,[O(" F25 Bank Printer Font by "),C(i,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:B(()=>[O("F25 Digital Typeface Design")]),_:1})]),u("p",null,[O(" Journal Font by "),C(i,{to:"https://www.dafont.com/journal.font"},{default:B(()=>[O("Fontourist")]),_:1})]),u("p",null,[O(" Hashtag Font by "),C(i,{to:"https://www.dafont.com/hashtag.font"},{default:B(()=>[O(" TitanVex")]),_:1})]),u("p",null,[O(" JP Hand Slanted Font by "),C(i,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:B(()=>[O("Jonathan Paterson")]),_:1})]),u("p",null,[O(" As I Lay Dying Font by "),C(i,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:B(()=>[O("Moises Esqueda")]),_:1})]),u("p",null,[O(" Damagrafik Script Font by "),C(i,{to:"https://www.dafont.com/damagrafik-script.font"},{default:B(()=>[O("Davide Terenzi")]),_:1})]),u("p",null,[O(" Ammy's Handwriting Font by "),C(i,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:B(()=>[O("Ammy K.")]),_:1})]),u("p",null,[O(" Halogen Font by "),C(i,{to:"https://www.dafont.com/halogen.font"},{default:B(()=>[O("JLH Fonts")]),_:1})]),lk,u("p",null,[C(i,{to:"https://www.reddit.com/ofkg59"},{default:B(()=>[O("Concept MC")]),_:1}),O(" by StormBlazed76, "),C(i,{to:"https://www.reddit.com/og6shh"},{default:B(()=>[O("red")]),_:1}),O(" and "),C(i,{to:"https://www.reddit.com/oft3vb"},{default:B(()=>[O("yellow")]),_:1}),O(" eyes by YinuS_WinneR, "),C(i,{to:"https://www.reddit.com/ofof3o"},{default:B(()=>[O("chibi")]),_:1}),O(" by Hadrosaur838 ")]),ak,dk,u("p",null,[C(i,{to:"https://www.reddit.com/oizaow"},{default:B(()=>[O("Concept FeMC")]),_:1}),O(" by ShidoDraws, "),C(i,{to:"https://www.reddit.com/oosuxu"},{default:B(()=>[O("additional poses, expressions and chibi")]),_:1}),O(" by SlightlySimple ")]),ck,uk,pk])}const hk=ne(nk,[["render",fk],["__scopeId","data-v-8073b468"]]),gk=ee({props:{backgroundId:{type:String,required:!0}},data:()=>({isWebPSupported:null,assets:[]}),computed:{background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.getters["content/getBackgrounds"].get(this.backgroundId)||null},isActive(){return this.backgroundId===this.background.current},title(){var e;switch(this.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return(e=this.bgData.label)!=null?e:""},style(){var e;switch(this.backgroundId){case"buildin.static-color":return{"background-color":this.background.color};case"buildin.transparent":return{}}const t=(e=this.bgData)==null?void 0:e.variants[0].map(n=>`url('${Mn(n,!1)}')`).join(",");return{backgroundImage:t!=null?t:""}}}});const mk=["title"];function bk(e,t,n,o,s,r){return g(),y("div",{class:pe({background:!0,active:e.isActive}),title:e.title,style:Re(e.style),tabindex:"0",onClick:t[0]||(t[0]=i=>e.$emit("input",e.backgroundId)),onKeydown:[t[1]||(t[1]=Le(i=>e.$emit("input",e.backgroundId),["enter"])),t[2]||(t[2]=Le(G(i=>e.$emit("input",e.backgroundId),["prevent"]),["space"]))]},fe(e.title),47,mk)}const vk=ne(gk,[["render",bk],["__scopeId","data-v-f141eda2"]]),yk=ee({components:{Toggle:Rt,DFieldset:Ht},computed:{vertical(){return this.$store.state.ui.vertical},color:{get(){return this.background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},flipped:{get(){return this.background.flipped},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundFlipped",{flipped:e,panelId:this.$store.state.panels.currentPanel})})}},scaling:{get(){return this.background.scaling.toString()},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundScaling",{scaling:parseInt(e,10),panelId:this.$store.state.panels.currentPanel})})}},currentBackgroundId(){return this.background.current},background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.state.content.current.backgrounds.find(e=>e.id===this.currentBackgroundId)||null},isColor(){return this.currentBackgroundId==="buildin.static-color"},isVariant(){return!!this.bgData},hasVariants(){return this.bgData?this.bgData.variants.length>1:!1}},methods:{seekVariant(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekBackgroundVariant",{delta:e,panelId:this.$store.state.panels.currentPanel})})}}});const Ss=e=>(ze("data-v-c3bc3296"),e=e(),Ge(),e),_k=Ss(()=>u("label",{for:"bg_color"},"Color:",-1)),wk={key:1},$k={colspan:"3"},Ck={key:0},Pk={class:"arrow-col"},Sk=Ss(()=>u("td",{style:{"text-align":"center"}},"Variant",-1)),kk={class:"arrow-col"},Ok={colspan:"3"},xk=Ss(()=>u("option",{value:"0"},"None",-1)),jk=Ss(()=>u("option",{value:"1"},"Stretch",-1)),Ik=Ss(()=>u("option",{value:"2"},"Cover",-1)),Tk=[xk,jk,Ik],Ek={colspan:"3"};function Bk(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{class:pe({"bg-settings":!0,vertical:e.vertical}),title:"Settings:"},{default:B(()=>[e.isColor?(g(),y(U,{key:0},[_k,u("button",{id:"bg_color",class:"color-button",style:Re({background:e.color}),onClick:t[0]||(t[0]=l=>e.$emit("change-color"))},null,4)],64)):X("",!0),e.isVariant?(g(),y("table",wk,[u("tr",null,[u("td",$k,[C(i,{modelValue:e.flipped,"onUpdate:modelValue":t[1]||(t[1]=l=>e.flipped=l),label:"Flipped?"},null,8,["modelValue"])])]),e.hasVariants?(g(),y("tr",Ck,[u("td",Pk,[u("button",{class:"small-button",onClick:t[2]||(t[2]=l=>e.seekVariant(-1))},"<")]),Sk,u("td",kk,[u("button",{class:"small-button",onClick:t[3]||(t[3]=l=>e.seekVariant(1))},">")])])):X("",!0),u("tr",null,[u("td",Ok,[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.scaling=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},Tk,544),[[_t,e.scaling]])])]),u("tr",null,[u("td",Ek,[u("button",{id:"image_options_button",onClick:t[6]||(t[6]=l=>e.$emit("open-image-options"))}," Image options ")])])])):X("",!0)]),_:1},8,["class"])}const Ak=ne(yk,[["render",Bk],["__scopeId","data-v-c3bc3296"]]);var Dk=Object.defineProperty,Rk=Object.defineProperties,Hk=Object.getOwnPropertyDescriptors,Ec=Object.getOwnPropertySymbols,Mk=Object.prototype.hasOwnProperty,Fk=Object.prototype.propertyIsEnumerable,Bc=(e,t,n)=>t in e?Dk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Nk=(e,t)=>{for(var n in t||(t={}))Mk.call(t,n)&&Bc(e,n,t[n]);if(Ec)for(var n of Ec(t))Fk.call(t,n)&&Bc(e,n,t[n]);return e},Lk=(e,t)=>Rk(e,Hk(t)),Ac=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Dc={packId:"dddg.uploads.backgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Uk=ee({mixins:[st],components:{BackgroundButton:vk,BackgroundSettings:Ak,DropTarget:Op,Color:Gr,ImageOptions:wa,DButton:Ln},data:()=>({colorSelect:!1,imageOptions:!1}),computed:{bgColor:{get(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel].background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},backgrounds(){return[...this.$store.state.content.current.backgrounds.map(e=>e.id),"buildin.static-color","buildin.transparent"]},showBackgroundsFolder(){return q.supports.openableFolders.has("backgrounds")}},methods:{setBackground(e){this.$store.commit("panels/setCurrentBackground",{current:e,panelId:this.$store.state.panels.currentPanel})},onFileUpload(e){const t=this.$refs.upload;if(!!t.files)for(const n of t.files)this.addImageFile(n)},addImageFile(e){return Ac(this,null,function*(){yield this.vuexHistory.transaction(()=>Ac(this,null,function*(){const t=URL.createObjectURL(e),n=yield this.$store.dispatch("uploadUrls/add",{name:e.name,url:t});this.addNewCustomBackground(e.name,e.name,n)}))})},addByUrl(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];this.addNewCustomBackground(t,t,e)},addNewCustomBackground(e,t,n){const o=this.$store.state.content.contentPacks.find(r=>r.packId===Dc.packId)||Dc,s=Lk(Nk({},o),{backgrounds:[...o.backgrounds,{id:e,label:t,variants:[[n]],scaling:"none"}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:s}),this.setBackground(e)})},dragEnter(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.dt.show()))},openBackgroundFolder(){q.openFolder("backgrounds")}}});const xf=e=>(ze("data-v-2ee6c538"),e=e(),Ge(),e),Vk=xf(()=>u("h1",null,"Background",-1)),Wk=xf(()=>u("i",{class:"material-icons"},"extension",-1));function zk(e,t,n,o,s,r){const i=E("drop-target"),a=E("color"),l=E("image-options"),d=E("background-settings"),c=E("d-button"),p=E("background-button");return g(),y("div",{class:"panel",onDragenter:t[9]||(t[9]=(...f)=>e.dragEnter&&e.dragEnter(...f)),onMouseleave:t[10]||(t[10]=f=>e.$refs.dt.hide())},[C(i,{ref:"dt",class:"drop-target",onDrop:e.addImageFile},{default:B(()=>[O("Drop here to add as a new background ")]),_:1},8,["onDrop"]),Vk,e.colorSelect?(g(),L(a,{key:0,modelValue:e.bgColor,"onUpdate:modelValue":t[0]||(t[0]=f=>e.bgColor=f),onLeave:t[1]||(t[1]=f=>e.colorSelect=!1)},null,8,["modelValue"])):e.imageOptions?(g(),L(l,{key:1,type:"background",title:"","panel-id":e.$store.state.panels.currentPanel,"no-composition":"",onLeave:t[2]||(t[2]=f=>e.imageOptions=!1)},null,8,["panel-id"])):(g(),y(U,{key:2},[C(d,{onChangeColor:t[3]||(t[3]=f=>e.colorSelect=!0),onOpenImageOptions:t[4]||(t[4]=f=>e.imageOptions=!0)}),u("button",{class:"btn upload-background",onClick:t[6]||(t[6]=f=>e.$refs.upload.click())},[O(" Upload "),u("input",{type:"file",ref:"upload",onChange:t[5]||(t[5]=(...f)=>e.onFileUpload&&e.onFileUpload(...f))},null,544)]),u("button",{class:"upload-background",onClick:t[7]||(t[7]=(...f)=>e.addByUrl&&e.addByUrl(...f))},"Add by URL"),u("button",{class:"upload-background",onClick:t[8]||(t[8]=f=>e.$emit("show-dialog","type: Backgrounds"))},[Wk,O(" Search in content packs ")]),e.showBackgroundsFolder?(g(),L(c,{key:0,icon:"folder",class:"upload-background",onClick:e.openBackgroundFolder},{default:B(()=>[O(" Open backgrounds folder ")]),_:1},8,["onClick"])):X("",!0),(g(!0),y(U,null,$e(e.backgrounds,f=>(g(),L(p,{key:f,backgroundId:f,onInput:b=>e.setBackground(f)},null,8,["backgroundId","onInput"]))),128))],64))],32)}const Gk=ne(Uk,[["render",zk],["__scopeId","data-v-2ee6c538"]]);var qk=Object.defineProperty,Xk=Object.defineProperties,Kk=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,Yk=Object.prototype.hasOwnProperty,Jk=Object.prototype.propertyIsEnumerable,Hc=(e,t,n)=>t in e?qk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Zk=(e,t)=>{for(var n in t||(t={}))Yk.call(t,n)&&Hc(e,n,t[n]);if(Rc)for(var n of Rc(t))Jk.call(t,n)&&Hc(e,n,t[n]);return e},Qk=(e,t)=>Xk(e,Kk(t)),eO=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const tO={},nO={createSprite(e,t){return eO(this,arguments,function*({commit:n,rootState:o,state:s},r){const i=yield Er(r.assets[0],!1);if(!(i instanceof ql))return;const a=s.panels[r.panelId].lastObjId+1;return n("create",{object:Qk(Zk({},Io()),{assets:r.assets,height:i.height,width:i.width,id:a,panelId:o.panels.currentPanel,onTop:!1,preserveRatio:!0,ratio:i.width/i.height,type:"sprite",y:0,enlargeWhenTalking:o.ui.defaultCharacterTalkingZoom})}),a})}};var oO=Object.defineProperty,sO=Object.defineProperties,rO=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,iO=Object.prototype.hasOwnProperty,lO=Object.prototype.propertyIsEnumerable,Fc=(e,t,n)=>t in e?oO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,aO=(e,t)=>{for(var n in t||(t={}))iO.call(t,n)&&Fc(e,n,t[n]);if(Mc)for(var n of Mc(t))lO.call(t,n)&&Fc(e,n,t[n]);return e},dO=(e,t)=>sO(e,rO(t));const cO={setChoicesProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version},setChoiceProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n.choices[t.choiceIdx][t.key]=t.value,++n.version},setChoices(e,t){const n=e.panels[t.panelId].objects[t.id];n.choices=t.choices,++n.version}},uO={createChoice({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:dO(aO({},Io()),{y:s.Choices.ChoiceY,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,id:r,onTop:!0,autoWrap:!0,type:"choice",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,choiceDistance:s.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:s.Choices.ChoiceButtonColor})}),r},addChoice({state:e,commit:t},n){const o=e.panels[n.panelId].objects[n.id];t("setChoices",{id:n.id,panelId:n.panelId,choices:[...o.choices,{selected:!1,text:n.text}]})},removeChoice({state:e,commit:t},n){const s=[...e.panels[n.panelId].objects[n.id].choices];s.splice(n.choiceIdx,1),s.length===0&&s.push({selected:!1,text:""}),t("setChoices",{id:n.id,panelId:n.panelId,choices:s})}};var pO=Object.defineProperty,fO=Object.defineProperties,hO=Object.getOwnPropertyDescriptors,Nc=Object.getOwnPropertySymbols,gO=Object.prototype.hasOwnProperty,mO=Object.prototype.propertyIsEnumerable,Lc=(e,t,n)=>t in e?pO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,bO=(e,t)=>{for(var n in t||(t={}))gO.call(t,n)&&Lc(e,n,t[n]);if(Nc)for(var n of Nc(t))mO.call(t,n)&&Lc(e,n,t[n]);return e},vO=(e,t)=>fO(e,hO(t));const yO={setNotificationProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},_O={createNotification({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:vO(bO({},Io()),{y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,autoWrap:!1,id:r,onTop:!0,type:"notification",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0})}),r}};var wO=Object.defineProperty,$O=Object.defineProperties,CO=Object.getOwnPropertyDescriptors,Uc=Object.getOwnPropertySymbols,PO=Object.prototype.hasOwnProperty,SO=Object.prototype.propertyIsEnumerable,Vc=(e,t,n)=>t in e?wO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,kO=(e,t)=>{for(var n in t||(t={}))PO.call(t,n)&&Vc(e,n,t[n]);if(Uc)for(var n of Uc(t))SO.call(t,n)&&Vc(e,n,t[n]);return e},OO=(e,t)=>$O(e,CO(t));const xO={setPoemProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},jO={createPoem({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:t.panels.currentPanel,flip:!1,rotation:0,id:r,onTop:!0,opacity:100,type:"poem",version:0,preserveRatio:!1,autoWrap:!0,ratio:s.Poem.defaultPoemWidth/s.Poem.defaultPoemHeight,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,zoom:1}}),r},createConsole({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:OO(kO({},Io()),{subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:t.panels.currentPanel,id:r,onTop:!0,type:"poem",preserveRatio:!1,ratio:s.Poem.consoleWidth/s.Poem.consoleHeight,background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0})}),r}};var IO=Object.defineProperty,TO=Object.defineProperties,EO=Object.getOwnPropertyDescriptors,Wc=Object.getOwnPropertySymbols,BO=Object.prototype.hasOwnProperty,AO=Object.prototype.propertyIsEnumerable,zc=(e,t,n)=>t in e?IO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ye=(e,t)=>{for(var n in t||(t={}))BO.call(t,n)&&zc(e,n,t[n]);if(Wc)for(var n of Wc(t))AO.call(t,n)&&zc(e,n,t[n]);return e},Gc=(e,t)=>TO(e,EO(t));const DO=Ye(Ye(Ye(Ye(Ye(Ye({create(e,{object:t}){const n=e.panels[t.panelId];t.id>n.lastObjId&&(n.lastObjId=t.id),n.objects[t.id]=t,(t.onTop?n.onTopOrder:n.order).push(t.id)},removeFromList(e,t){const n=e.panels[t.panelId],o=t.onTop?n.onTopOrder:n.order,s=o.indexOf(t.id);o.splice(s,1)},addToList(e,t){const n=e.panels[t.panelId];(t.onTop?n.onTopOrder:n.order).splice(t.position,0,t.id)},setOnTop(e,t){const o=e.panels[t.panelId].objects[t.id];o.onTop=t.onTop},setPosition(e,t){const o=e.panels[t.panelId].objects[t.id];o.x=t.x,o.y=t.y},setFlip(e,t){const o=e.panels[t.panelId].objects[t.id];o.flip=t.flip},setSize(e,t){const o=e.panels[t.panelId].objects[t.id];o.width=t.width,o.height=t.height},setRatio(e,t){const o=e.panels[t.panelId].objects[t.id];o.preserveRatio=t.preserveRatio,o.ratio=t.ratio},setRotation(e,t){const o=e.panels[t.panelId].objects[t.id];o.rotation=t.rotation<0?360-Math.abs(t.rotation)%360:t.rotation%360},removeObject(e,t){const n=e.panels[t.panelId];delete n.objects[t.id]},setComposition(e,t){const o=e.panels[t.panelId].objects[t.id];o.composite=t.composite},object_setFilters(e,t){const o=e.panels[t.panelId].objects[t.id];o.filters=t.filters},setLabel(e,t){const o=e.panels[t.panelId].objects[t.id];o.label=t.label},setTextboxColor(e,t){const o=e.panels[t.panelId].objects[t.id];o.textboxColor=t.textboxColor},setEnlargeWhenTalking(e,t){const o=e.panels[t.panelId].objects[t.id];o.enlargeWhenTalking=t.enlargeWhenTalking,++o.version},setObjectNameboxWidth(e,t){const o=e.panels[t.panelId].objects[t.id];o.nameboxWidth=t.nameboxWidth,++o.version},setObjectZoom(e,t){const o=e.panels[t.panelId].objects[t.id];o.zoom=t.zoom,++o.version}},tO),c$),gS),cO),yO),xO),RO=Ye(Ye(Ye(Ye(Ye(Ye({removeObject({state:e,commit:t,rootState:n},o){var s;const r=e.panels[o.panelId],i=r.objects[o.id];n.ui.selection===o.id&&t("ui/setSelection",null,{root:!0});for(const a of[...r.onTopOrder,...r.order]){const l=r.objects[a];i.id===a||l.type!=="textBox"||l.talkingObjId===i.id&&t("setTalkingOther",{id:l.id,talkingOther:(s=i.label)!=null?s:"",panelId:o.panelId})}t("removeFromList",{id:o.id,panelId:o.panelId,onTop:i.onTop}),t("removeObject",{id:o.id,panelId:o.panelId})},setPosition({state:e,commit:t,dispatch:n},o){e.panels[o.panelId].objects[o.id].type==="character"?n("setCharacterPosition",o):t("setPosition",o)},setOnTop({state:e,commit:t},n){const o=e.panels[n.panelId],s=o.objects[n.id];s.onTop!==n.onTop&&(t("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),t("addToList",{id:n.id,panelId:n.panelId,position:(n.onTop?o.onTopOrder:o.order).length,onTop:n.onTop}),t("setOnTop",{panelId:n.panelId,id:n.id,onTop:n.onTop}))},shiftLayer({state:e,commit:t},n){const o=e.panels[n.panelId],s=o.objects[n.id],r=s.onTop?o.onTopOrder:o.order;let a=r.indexOf(s.id)+n.delta;a<0&&(a=0),a>r.length&&(a=r.length),t("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),t("addToList",{panelId:n.panelId,id:n.id,position:a,onTop:s.onTop})},setPreserveRatio({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=n.preserveRatio?s.width/s.height:0;e("setRatio",{panelId:n.panelId,id:n.id,preserveRatio:n.preserveRatio,ratio:r})},setWidth({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=s.preserveRatio?n.width/s.ratio:s.height;e("setSize",{panelId:n.panelId,id:n.id,height:r,width:n.width})},setHeight({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=s.preserveRatio?n.height*s.ratio:s.width;e("setSize",{panelId:n.panelId,id:n.id,height:n.height,width:r})},copyObjects({commit:e,state:t},{sourcePanelId:n,targetPanelId:o}){const s=t.panels[n],r=t.panels[o],i=[...s.onTopOrder,...s.order],a=new Map;let l=r.lastObjId;for(const d of i){const c=++l;a.set(d,c)}for(const d of i){const c=s.objects[d],p=JSON.parse(JSON.stringify(c));if("talkingObjId"in p){const f=p;f.talkingObjId!==null&&f.talkingObjId!=="$other$"&&a.has(f.talkingObjId)&&(f.talkingObjId=a.get(f.talkingObjId))}e("create",{object:Gc(Ye({},p),{id:a.get(d),panelId:o})})}},copyObjectToClipboard({commit:e,state:t},{id:n,panelId:o}){const s=t.panels[o].objects[n];e("ui/setClipboard",JSON.stringify(s),{root:!0})},pasteObjectFromClipboard({commit:e,state:t,rootState:n}){if(n.ui.clipboard==null)return;const o=JSON.parse(n.ui.clipboard);e("create",{object:Gc(Ye({},o),{id:t.panels[t.currentPanel].lastObjId+1,panelId:t.currentPanel})})},object_addFilter({state:e,commit:t},n){cl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_removeFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_moveFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_setFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))}},nO),p$),mS),uO),_O),jO);function HO(e,t){const n=e.state.panels;for(const o in n){const s=n[o];for(const r in s.objects){const i=s.objects[r];if(i.type==="character"){f$(e,i.panelId,i.id,t);return}}}}var MO=Object.defineProperty,FO=Object.defineProperties,NO=Object.getOwnPropertyDescriptors,qc=Object.getOwnPropertySymbols,LO=Object.prototype.hasOwnProperty,UO=Object.prototype.propertyIsEnumerable,Xc=(e,t,n)=>t in e?MO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ci=(e,t)=>{for(var n in t||(t={}))LO.call(t,n)&&Xc(e,n,t[n]);if(qc)for(var n of qc(t))UO.call(t,n)&&Xc(e,n,t[n]);return e},VO=(e,t)=>FO(e,NO(t)),qs=(e=>(e[e.None=0]="None",e[e.Stretch=1]="Stretch",e[e.Cover=2]="Cover",e))(qs||{});const WO="buildin.transparent",Ms={panelToUrl:new Map,urlToPanel:new Map,register(e,t){if(this.panelToUrl.has(e)){if(this.panelToUrl.get(e)===t)return;this.unregister(e,this.panelToUrl.get(e))}this.panelToUrl.set(e,t),this.urlToPanel.has(t)?this.urlToPanel.get(t).push(e):this.urlToPanel.set(t,[e])},unregister(e,t){if(this.urlToPanel.has(t)){const n=this.urlToPanel.get(t);n.splice(n.indexOf(e),1),n.length===0&&(this.urlToPanel.delete(t),URL.revokeObjectURL(t))}this.panelToUrl.delete(e)}},zO={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[],currentPanel:null},mutations:Ci({setCurrentPanel(e,{panelId:t}){e.currentPanel=t},setPanelPreview(e,{panelId:t,url:n}){e.panels[t].lastRender=n,Ms.register(t,n)},createPanel(e,{panel:t}){e.lastPanelId=t.id,e.panels[t.id]=t},setPanelOrder(e,{panelOrder:t}){e.panelOrder=[...t]},setCurrentBackground(e,{current:t,panelId:n}){const o=e.panels[n];o.background.current=t,o.background.variant=0},setBackgroundColor(e,{color:t,panelId:n}){const o=e.panels[n];o.background.color=t},setBackgroundFlipped(e,{flipped:t,panelId:n}){const o=e.panels[n];o.background.flipped=t},setBackgroundVariant(e,{variant:t,panelId:n}){const o=e.panels[n];o.background.variant=t},setBackgroundScaling(e,{scaling:t,panelId:n}){const o=e.panels[n];o.background.scaling=t},deletePanel(e,{panelId:t}){Ms.unregister(t,Ms.panelToUrl.get(t)),delete e.panels[t]},setComposition(e,t){const n=e.panels[t.panelId];n.composite=t.composite},setFilters(e,t){const n=e.panels[t.panelId];n.filters=t.filters},backgroundSetComposition(e,t){const n=e.panels[t.panelId];n.background.composite=t.composite},backgroundSetFilters(e,t){const n=e.panels[t.panelId];n.background.filters=t.filters}},DO),actions:Ci({createPanel({state:e,commit:t}){const n=e.lastPanelId+1;return t("createPanel",{panel:{id:n,background:{color:"#000000",current:WO,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),t("setPanelOrder",{panelOrder:[...e.panelOrder,n]}),t("setCurrentPanel",{panelId:n}),n},duplicatePanel({state:e,commit:t},{panelId:n}){const o=e.panels[n],s=e.lastPanelId+1;Ms.register(s,o.lastRender);const r=JSON.parse(JSON.stringify(o));let i=-1;const a=new Map,l={};for(const c in r.objects)a.set(+c,++i);for(const c in r.objects){const p=r.objects[c],f=a.get(+c);if(l[f]=p,p.panelId=s,p.id=f,"talkingObjId"in p){const b=p;b.talkingObjId!==null&&b.talkingObjId!=="$other$"&&a.has(b.talkingObjId)&&(b.talkingObjId=a.get(b.talkingObjId))}}t("createPanel",{panel:VO(Ci({},r),{id:s,lastObjId:i,objects:l,order:r.order.map(c=>a.get(c)),onTopOrder:r.onTopOrder.map(c=>a.get(c))})});const d=e.panelOrder.indexOf(n);t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,d+1),s,...e.panelOrder.slice(d+1)]}),t("setCurrentPanel",{panelId:s})},seekBackgroundVariant({state:e,rootGetters:t,commit:n},{delta:o}){const s=e.panels[e.currentPanel],i=t["content/getBackgrounds"].get(s.background.current);!i||n("setBackgroundVariant",{panelId:e.currentPanel,variant:Go(i.variants,s.background.variant,o)})},delete({state:e,commit:t},{panelId:n}){if(e.panelOrder.length<=1)return;const o=e.panelOrder.indexOf(n);let s;o===e.panelOrder.length-1?s=o-1:s=o+1,t("setCurrentPanel",{panelId:e.panelOrder[s]}),t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,o),...e.panelOrder.slice(o+1)]}),t("deletePanel",{panelId:n})},fixContentPackRemoval(e,t){const{state:n,rootGetters:o,commit:s,rootState:r}=e;for(const i of Object.values(n.panels)){const a=t.backgrounds.find(p=>p.id===i.background.current);if(!a)return;const l=o["content/getBackgrounds"].get(i.background.current);if(!l){r.content.current.backgrounds.length>0?s("setCurrentBackground",{current:r.content.current.backgrounds[0].id,panelId:i.id}):s("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const d=JSON.stringify(a.variants[i.background.variant]),c=l.variants.findIndex(p=>JSON.stringify(p)===d);c!==i.background.variant&&s("setBackgroundVariant",{variant:c===-1?0:c,panelId:i.id})}HO(e,t)},move({state:e,commit:t},{panelId:n,delta:o}){const s=[...e.panelOrder],r=s.indexOf(n);s.splice(r,1);const i=Math.max(r+o,0);s.splice(i,0,n),t("setPanelOrder",{panelOrder:s})},addFilter({state:e,commit:t},n){cl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},removeFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},moveFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},setFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},backgroundAddFilter({state:e,commit:t},n){cl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundRemoveFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundMoveFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundSetFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))}},RO)};var jf=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class GO{constructor(t,n,o,s,r,i){this.id=t,this.assets=n,this.flip=o,this.scale=s,this.compositeMode=r,this.filters=i}render(t){return jf(this,null,function*(){const{screenWidth:n,screenHeight:o}=Y().Base,s=yield Promise.all(this.assets.map(r=>Er(r,t.hq)));for(const r of s){let i=0,a=0,l=r.width,d=r.height;switch(this.scale){case qs.None:i=n/2-l/2,a=o/2-d/2;break;case qs.Stretch:l=n,d=o;break;case qs.Cover:const c=l/d,p=n/o;c>p?(d=o,l=d*c):(l=n,d=l/c),i=n/2-l/2,a=o/2-d/2}t.drawImage({image:r,x:i,y:a,w:l,h:d,flip:this.flip,composite:this.compositeMode,filters:this.filters})}})}}const Kc={id:"buildin.static-color",name:"Static color",color:"#000000",render(e){return jf(this,null,function*(){const{screenWidth:t,screenHeight:n}=Y().Base;e.drawRect({x:0,y:0,w:t,h:n,fill:{style:this.color}})})}};var qO=Object.defineProperty,XO=(e,t,n)=>t in e?qO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pi=(e,t,n)=>(XO(e,typeof t!="symbol"?t+"":t,n),n),If=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Tf extends Cf{constructor(){super(...arguments),Pi(this,"refTextbox",null),Pi(this,"lastUploadCount",0),Pi(this,"missingAsset",!1)}get canvasDrawWidth(){return this.width*this.objZoom}get canvasDrawHeight(){return this.height*this.objZoom}get canvasDrawPosX(){return this.x-this.width/2+(this.height-this.canvasDrawHeight)/2}get canvasDrawPosY(){return this.y+(this.height-this.canvasDrawHeight)}get allowSkippingLocalCanvas(){return!1}get objZoom(){return(this.obj.enlargeWhenTalking&&this.refTextbox?1.05:1)*this.obj.zoom}getHitbox(){const t=super.getHitbox(),n=this.width*(this.objZoom-1),o=this.height*(this.objZoom-1);return{x0:t.x0-n/2,x1:t.x1+n/2,y0:t.y0-o,y1:t.y1}}updatedContent(t,n){const o=t.state.panels.panels[n],s=[...o.order,...o.onTopOrder];this.refTextbox=null;for(const i of s){const a=t.state.panels.panels[n].objects[i];if(a.type==="textBox"&&a.talkingObjId===this.obj.id){this.refTextbox=a;return}}const r=Object.keys(t.state.uploadUrls).length;this.missingAsset&&r!==this.lastUploadCount&&(this.localRenderer&&this.localRenderer.dispose(),this.localRenderer=null,this.lastUploadCount=r,this.reloadAssets(),console.log("forceing sprite rerender "+this.id))}renderLocal(t){return If(this,null,function*(){const n=yield this.getAssetList();console.log("rerendering local");const o=yield Promise.all(n.filter(s=>s.assets).map(s=>KO(s,t.hq)));this.missingAsset=!1;for(const s of o)for(const r of s.assets)r instanceof rr&&(this.missingAsset=!0),t.drawImage({image:r,composite:s.composite,x:s.offset[0],y:s.offset[1]})})}}function KO(e,t){return If(this,null,function*(){return"loaded"in e?e:{loaded:!0,offset:e.offset,assets:yield Promise.all(e.assets.map(n=>Er(n,t))),composite:e.composite}})}var YO=Object.defineProperty,JO=(e,t,n)=>t in e?YO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vo=(e,t,n)=>(JO(e,typeof t!="symbol"?t+"":t,n),n),Yc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class ZO extends Tf{constructor(t){super(t),Vo(this,"assets"),Vo(this,"ready",null),Vo(this,"canvasHeight",0),Vo(this,"canvasWidth",0),Vo(this,"needAssetUpdate",!0),this.init()}get version(){return this.assets===null?-1:this.obj.version}init(){return Yc(this,null,function*(){yield this.reloadAssets()})}reloadAssets(){return Yc(this,null,function*(){let t;this.ready=new Promise((r,i)=>{t=r});const n=yield Promise.all(this.obj.assets.map(r=>Er(r)));let o=0,s=0;for(const r of n)r.height>s&&(s=r.height),r.width>o&&(o=r.width);this.canvasWidth=o,this.canvasHeight=s,this.assets=[{loaded:!0,assets:n,offset:[0,0]}],t()})}getAssetList(){var t;return(t=this.assets)!=null?t:[]}}var QO=Object.defineProperty,ex=(e,t,n)=>t in e?QO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tx=(e,t,n)=>(ex(e,typeof t!="symbol"?t+"":t,n),n);class nx extends Tf{constructor(t,n){super(t),this.data=n,tx(this,"scaleable",!0)}reloadAssets(){}updatedContent(t,n){super.updatedContent(t,n),this.data=Nr(t,this.obj)}getAssetList(){const t=bn(this.data,this.obj),n=cr(this.data,this.obj),o=[];for(const s of t.renderCommands)switch(s.type){case"head":o.push({offset:s.offset,composite:s.composite,assets:n?n.variants[this.obj.posePositions.head||0]:[]});break;case"image":o.push({offset:s.offset,composite:s.composite,assets:s.images});break;case"pose-part":const r=t.positions[s.part];if(!r||r.length===0)break;const i=r[this.obj.posePositions[s.part]||0];if(!i)break;o.push({offset:s.offset,composite:s.composite,assets:i});break}return o}get canvasHeight(){return bn(this.data,this.obj).size[1]}get canvasWidth(){return bn(this.data,this.obj).size[0]}get closeZoom(){let t=1;return this.obj.close&&(t*=2),t}get width(){return this.obj.width*this.closeZoom}get height(){return this.obj.height*this.closeZoom}}var ox=Object.defineProperty,sx=(e,t,n)=>t in e?ox(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Jc=(e,t,n)=>(sx(e,typeof t!="symbol"?t+"":t,n),n),Zc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class rx extends To{constructor(){super(...arguments),Jc(this,"_height",0),Jc(this,"choiceRenderers",[])}get height(){return this._height}get centeredVertically(){return!0}draw(t){return Zc(this,null,function*(){yield this.updateChoiceBounds();const n=Y(),o=this.obj.width,s=this.height,r=o/2,a=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r;let l=this.obj.y-s/2;for(const d of this.choiceRenderers){yield d.loadFonts();const c=d.getHeight(this.obj.autoWrap?this.obj.width:0);t.drawRect({x:a,y:l,w:o,h:c+n.Choices.ChoicePadding*2,outline:{style:n.Choices.ChoiceButtonBorderColor,width:n.Choices.Outline},fill:{style:n.Choices.ChoiceButtonColor}}),d.fixAlignment("center",a,a+o,l+n.Choices.ChoiceSpacing*1.25,this.obj.autoWrap?o:0),d.render(t.fsCtx),l+=c+n.Choices.ChoicePadding*2+n.Choices.ChoiceSpacing}})}updateChoiceBounds(){return Zc(this,null,function*(){const t=Y();this.choiceRenderers=this.obj.choices.map(n=>new dt(n.text||" ",t.Choices.ChoiceTextStyle)),this._height=this.choiceRenderers.reduce((n,o)=>n+o.getHeight(this.obj.autoWrap?this.obj.width:0)+t.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1)})}}var ix=Object.defineProperty,lx=Object.getPrototypeOf,ax=Reflect.get,dx=(e,t,n)=>t in e?ix(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Qc=(e,t,n)=>(dx(e,typeof t!="symbol"?t+"":t,n),n),cx=(e,t,n)=>ax(lx(e),n,t),eu=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class $a extends To{constructor(){super(...arguments),Qc(this,"_height",0),Qc(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}get id(){return this.obj.id}render(t,n,o){return eu(this,null,function*(){const s=Y();this.obj.backdrop&&n.drawRect({x:0,y:0,w:s.Base.screenWidth,h:s.Base.screenHeight,fill:{style:Y().Notification.NotificationBackdropColor}}),yield cx($a.prototype,this,"render").call(this,t,n,o)})}draw(t){return eu(this,null,function*(){const n=Y(),o=new dt(this.obj.text,n.Notification.NotificationTextStyle),s=new dt("OK",n.Notification.NotificationOkTextStyle);yield o.loadFonts(),yield s.loadFonts();const r=this.obj.autoWrap?this.obj.width-n.Notification.NotificationPadding*2:0,i=this.obj.autoWrap?r:o.getWidth(),a=o.getHeight(r),l=this.obj.autoWrap?r:s.getWidth(),d=s.getHeight(r),c=this._width=Math.max(i,l)+n.Notification.NotificationPadding*2,p=this._height=a+n.Notification.NotificationPadding*2+n.Notification.NotificationSpacing+d,f=c/2,v=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-f,w=this.obj.y-p/2;t.drawRect({x:v,y:w,w:c,h:p,outline:{style:n.Choices.ChoiceButtonBorderColor,width:3},fill:{style:n.Choices.ChoiceButtonColor}}),o.fixAlignment("center",v,v+c,w+n.Notification.NotificationPadding*1.5,r),o.render(t.fsCtx),s.fixAlignment("center",v,v+c,w+p-n.Notification.NotificationPadding,r),s.render(t.fsCtx)})}}var ux=Object.defineProperty,px=(e,t,n)=>t in e?ux(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tu=(e,t,n)=>(px(e,typeof t!="symbol"?t+"":t,n),n),fx=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const hx=-2,gx=26,mx=10,bx=10;class vx extends To{constructor(){super(...arguments),tu(this,"_height",0),tu(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}draw(t){return fx(this,null,function*(){const n=Y(),o=n.Poem.poemBackgrounds[this.obj.background],s=this.flip?n.Base.screenWidth-this.obj.x:this.obj.x;let r=this.obj.y,i=s+bx,a=n.Poem.poemPadding,l=n.Poem.poemTopPadding,d=a*2;if(o.file==="internal:console"){const f=this._height=this.obj.height,b=this._width=this.obj.width;t.drawRect({x:s-b/2,y:this.obj.y-f/2,h:f,w:b,fill:{style:n.Poem.consoleBackgroundColor}}),a=hx,l=gx,d=mx}else if(o.file==="internal:transparent")this._height=this.obj.height,this._width=this.obj.width;else{const f=yield Xl(`assets/poemBackgrounds/${o.file}`);t.drawImage({image:f,x:s-f.width/2,y:this.obj.y-f.height/2}),this._height=f.height,this._width=f.width}r-=this.height/2,i-=this.width/2;const c=n.Poem.poemTextStyles[this.obj.font],p=new dt(this.obj.text,c);yield p.loadFonts(),p.fixAlignment("left",i+a,i+a,r+l+a,this.obj.autoWrap?this.width-d:0),p.render(t.fsCtx)})}}var yx=Object.defineProperty,_x=(e,t,n)=>t in e?yx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xs=(e,t,n)=>(_x(e,typeof t!="symbol"?t+"":t,n),n),wx=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Ef=class{constructor(e,t,n,o){this.store=e,this._panelId=t,this.canvasWidth=n,this.canvasHeight=o,Xs(this,"renderObjectCache",new Map),Xs(this,"renderer"),Xs(this,"_disposed",!1),this.renderer=new _s(n,o)}get panelId(){return this._panelId}setPanelId(e){if(this._disposed)throw new Error("Disposed scene-renderer called");this._panelId!==e&&(this._panelId=e,this.renderObjectCache.forEach(t=>{t.dispose()}),this.renderObjectCache.clear())}render(e,t,n){if(this._disposed)throw new Error("Disposed scene-renderer called");return this.panel?this.renderer.render(this.renderCallback.bind(this,n),e,t):Promise.resolve(!1)}download(){if(this._disposed)throw new Error("Disposed scene-renderer called");const e=new Date,t=`panel-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this,!0),t)}paintOnto(e,t){this.renderer.paintOnto(e,t)}objectsAt(e,t){return this.getRenderObjects().filter(n=>n.hitTest(e,t)).map(n=>n.id)}renderCallback(e,t){return wx(this,null,function*(){var n;if(this._disposed)throw new Error("Disposed scene-renderer called");t.fsCtx.imageSmoothingEnabled=!0,t.fsCtx.imageSmoothingQuality=t.hq?"high":"low",yield(n=this.getBackgroundRenderer())==null?void 0:n.render(t);const o=this.store.state.ui.selection;for(const s of this.getRenderObjects()){s.updatedContent(this.store,this.panelId);const r=o===s.id,i=document.querySelector(Ef.FocusProp),a=(i==null?void 0:i.getAttribute("data-obj-id"))===""+s.id;yield s.render((r?qo.Selected:qo.None)+(a?qo.Focused:qo.None),t,e)}t.applyFilters([...this.panel.filters]),t.preview&&t.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:yield co("backgrounds/transparent")})})}getRenderObjects(){const e=this.store.state.panels.panels[this.panelId],t=[...e.order,...e.onTopOrder],n=e.objects,o=Array.from(this.renderObjectCache.keys()).filter(s=>!t.includes(s));for(const s of o)this.renderObjectCache.get(s).dispose(),this.renderObjectCache.delete(s);return t.map(s=>{let r=this.renderObjectCache.get(s);if(!r){const i=n[s],a=i.type;switch(a){case"sprite":r=new ZO(i);break;case"character":const l=i;r=new nx(l,Nr(this.store,l));break;case"textBox":r=new sC(i);break;case"choice":r=new rx(i);break;case"notification":r=new $a(i);break;case"poem":r=new vx(i);break;default:throw new At.UnreachableCaseError(a)}this.renderObjectCache.set(s,r)}return r})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const e=this.panel;switch(e.background.current){case"buildin.static-color":return Kc.color=e.background.color,Kc;default:const n=this.store.getters["content/getBackgrounds"].get(e.background.current);if(!n)return null;const o=n.variants[e.background.variant];return new GO(e.background.current,o,e.background.flipped,e.background.scaling,e.background.composite,e.background.filters)}}get disposed(){return this._disposed}dispose(){this._disposed=!0,this.renderer.dispose()}};let hr=Ef;Xs(hr,"FocusProp",typeof CSS!="undefined"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");var Ie=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const $x=1.5,nu=1/4,Cx=.5,ou=100,su=90,ru=70,Px=ee({mixins:[st],components:{DFieldset:Ht,DFlow:vs,DButton:Ln,ImageOptions:wa},data:()=>({webpSupport:!1,heifSupport:!1,ppi:q.supports.limitedCanvasSpace?10:0,pages:"",format:"image/png",quality:su,imageOptions:!1,isMounted:!1,thumbnailCtx:null}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},isLossy(){return this.format!=="image/png"},canDeletePanel(){return this.panelButtons.length>1},panelButtons(){return this.$store.state.panels.panelOrder.map(t=>{const n=this.$store.state.panels.panels[t],o=this.$store.state.panels.panels[t],s=[...o.order,...o.onTopOrder].map(r=>this.$store.state.panels.panels[t].objects[r]).map(this.extractObjectText);return{id:t,image:n.lastRender,text:s.reduce((r,i)=>r.length>i.length?r:i,"")}})},canMoveAhead(){return this.$store.state.panels.panelOrder.indexOf(this.currentPanel.id)>0},canMoveBehind(){const e=this.$store.state.panels.panelOrder;return e.indexOf(this.currentPanel.id)<e.length-1},missingThumbnails(){const e=this.$store;return e.state.panels.panelOrder.filter(n=>e.state.panels.panels[n].lastRender==null)}},created(){return Ie(this,null,function*(){ue.subscribe(Wl,()=>requestAnimationFrame(()=>this.renderCurrentThumbnail()));const e=Y().Base,t=cs();t.width=e.screenWidth*nu,t.height=e.screenHeight*nu,this.thumbnailCtx=Cr(t.getContext("2d")),[this.webpSupport,this.heifSupport]=yield Promise.all([mo(),Sb()])})},mounted(){this.isMounted=!0,this.moveFocusToActivePanel(),requestAnimationFrame(()=>this.renderCurrentThumbnail().catch(()=>{}))},unmounted(){this.isMounted=!1,bo(this.thumbnailCtx.canvas)},methods:{restoreThumbnails(){return Ie(this,null,function*(){const e=Y().Base;if(!this.isMounted||q.supports.limitedCanvasSpace)return;const t=this.missingThumbnails;if(t.length===0)return;const n=t[0],o=new hr(this.$store,n,e.screenWidth,e.screenHeight);yield o.render(!1,!1,!0),yield this.renderPanelThumbnail(o),setTimeout(()=>{this.restoreThumbnails()},500)})},download(){return Ie(this,null,function*(){yield Ji("export image",()=>Ie(this,null,function*(){const e=this.getPanelDistibution(),t=new Date,n=`cd-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}`,o=this.format.split("/")[1],s=this.format,r=this.quality;yield this.renderObjects(e,!0,(i,a)=>Ie(this,null,function*(){yield q.saveToFile(a,`${n}_${i}.${o}`,s,r/ou)}))}))})},estimateExportSize(){return Ie(this,null,function*(){const e=this.getPanelDistibution(),t=this.format||"image/png",n=this.quality||su,s=(yield this.renderObjects(e,!1,(l,d)=>Ie(this,null,function*(){return new Promise((c,p)=>{d.toBlob(f=>{if(!f){p(`Image ${l+1} could not be rendered.`);return}c(f.size)},t,n/ou)})}))).map(l=>(l*$x/1024/1024).toFixed(2)+"MiB"),r=s.length>1?"files":"file",i=s.length>1?"These":"It",a=s.length>1?"sizes":"size";ue.fire(new ot(`This would export ${s.length} ${r}. ${i} would have the following (aproximate) ${a}: ${s.join(",")}`))})},renderObjects(e,t,n){return Ie(this,null,function*(){const o=Y().Base,s=[];for(let r=0;r<e.length;++r){const i=e[r],a=document.createElement("canvas");a.width=o.screenWidth,a.height=o.screenHeight*i.length;try{const l=a.getContext("2d");for(let d=0;d<i.length;++d){const c=i[d],p=new hr(this.$store,c,o.screenWidth,o.screenHeight);try{yield p.render(t,!1,!0),p.paintOnto(l,{x:0,y:o.screenHeight*d,w:o.screenWidth,h:o.screenHeight})}finally{p.dispose()}}s.push(yield n(r,a))}finally{bo(a)}}return s})},getLimitedPanelList(){const e=this.$store.state.panels.panelOrder.length-1,t=0,n=this.pages.split(","),o=[];let s=!1;for(const r of n){const i=r.trim(),a=i.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!a){i!==""&&ue.fire(new ot(`Could not read '${r}' in the page list.`));continue}if(s=!0,a[2])o.push(parseInt(a[2],10)-1);else{const l=Math.max(parseInt(a[3],10)-1,t),d=Math.min(parseInt(a[4],10)-1,e);if(l==null||d==null||l>d)continue;for(let c=l;c<=d;++c)o.push(c)}}return s?o.sort((r,i)=>r-i).filter((r,i,a)=>a[i-1]!==r).map(r=>this.$store.state.panels.panelOrder[r]):this.$store.state.panels.panelOrder},getPanelDistibution(){const e=this.getLimitedPanelList();if(isNaN(this.ppi)&&(this.ppi=0),this.ppi===0)return[e];const t=[];for(let n=0;n<e.length/this.ppi;++n){const o=n*this.ppi,s=o+this.ppi;t.push([...e.slice(o,s)])}return t},moveFocusToActivePanel(){const e=this.$el.querySelector(".panel_button.active");e&&this.scrollIntoView(e)},scrollIntoView(e){const t=e.parentElement.parentElement;this.$store.state.ui.vertical?(t.scrollTop=e.offsetTop-t.clientHeight/2,t.scrollLeft=0):(t.scrollLeft=e.offsetLeft-t.clientWidth/2,t.scrollTop=0)},extractObjectText(e){switch(e.type){case"textBox":return e.text;case"notification":return e.text;case"poem":return e.text;case"choice":return e.choices.map(t=>`[${t.text}]`).join(`
`)}return""},addNewPanel(){return Ie(this,null,function*(){yield this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/duplicatePanel",{panelId:this.$store.state.panels.currentPanel})})),yield this.$nextTick(),this.moveFocusToActivePanel()})},updateCurrentPanel(e){this.vuexHistory.transaction(()=>Ie(this,null,function*(){this.$store.commit("panels/setCurrentPanel",{panelId:e})})),this.$nextTick(()=>{this.moveFocusToActivePanel()})},deletePanel(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/delete",{panelId:this.$store.state.panels.currentPanel})})),this.$nextTick(()=>{this.moveFocusToActivePanel()})},moveAhead(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:-1})}))},moveBehind(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:1})}))},renderCurrentThumbnail(){return Ie(this,null,function*(){const e=window.getMainSceneRenderer,t=e&&e();!t||(yield this.renderPanelThumbnail(t))})},renderPanelThumbnail(e){return Ie(this,null,function*(){yield Ji("render thumbnail",()=>Ie(this,null,function*(){const t=e.panelId;e.paintOnto(this.thumbnailCtx,{x:0,y:0,w:this.thumbnailCtx.canvas.width,h:this.thumbnailCtx.canvas.height}),this.thumbnailCtx.canvas.toBlob(n=>{if(!n)return;const o=URL.createObjectURL(n);this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPanelPreview",{panelId:t,url:o})})},(yield mo())?"image/webp":"image/jpeg",Cx)}))})},save(){return Ie(this,null,function*(){const e=yield this.$store.dispatch("getSave",!0),t=new Blob([e],{type:"text/plain"}),n=new Date,s=`${`save-${[n.getFullYear(),`${n.getMonth()+1}`.padStart(2,"0"),`${n.getDate()}`.padStart(2,"0"),`${n.getHours()}`.padStart(2,"0"),`${n.getMinutes()}`.padStart(2,"0"),`${n.getSeconds()}`.padStart(2,"0")].join("-")}`}.dddg`,r=document.createElement("a"),i=URL.createObjectURL(t);r.setAttribute("download",s),r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)})},load(){return Ie(this,null,function*(){yield this.vuexHistory.transaction(()=>Ie(this,null,function*(){const e=this.$refs.loadUpload;if(!e.files)return;ue.fire(new zl);const t=yield Sx(e.files[0]);yield this.$store.dispatch("loadSave",t),q.supports.limitedCanvasSpace&&ue.fire(new ot("To prevent running out of memory, thumbnails will not be automatically restored in the background."))})),yield this.renderCurrentThumbnail(),setTimeout(()=>{this.restoreThumbnails()},1e3)})}},watch:{quality(e,t){if(e===100){ue.fire(new ot("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(t>ru&&e<=ru){ue.fire(new ot("Note: A quality level below 70% might be very noticeable and impair legibility of text."));return}},ppi(e,t){if(!!q.supports.limitedCanvasSpace&&(t<=10&&e>10||e===0&&this.panelButtons.length>10)){ue.fire(new ot("Note: Safari has strict limitations on available memory. More images per panel can easily cause crashes."));return}}}});function Sx(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=function(){t(o.result)},o.onerror=function(s){n(s)},o.readAsText(e)})}const Un=e=>(ze("data-v-03fb9b42"),e=e(),Ge(),e),kx={class:"panel"},Ox=Un(()=>u("h1",null,"Panels",-1)),xx=["onClick","onKeydown"],jx={class:"panel_text"},Ix={class:"panel_nr"},Tx={class:"column"},Ex=Un(()=>u("td",null,[u("label",{for:"export_format"},"Format")],-1)),Bx=Un(()=>u("option",{value:"image/png"},"PNG (lossless)",-1)),Ax={key:0,value:"image/webp"},Dx={key:1,value:"image/heif"},Rx=Un(()=>u("option",{value:"image/jpeg"},"JPEG (lossy)",-1)),Hx={key:0},Mx=Un(()=>u("td",null,[u("label",{for:"export_quality"},"Quality:")],-1)),Fx=Un(()=>u("td",null,[u("label",{for:"export_ppi"},[O(" Panels per image: "),u("br"),u("small",null,"(0 for one single image)")])],-1)),Nx=Un(()=>u("td",null,[u("label",{for:"export_pages"},[O(" Panels to export: "),u("br"),u("small",null,"(Leave empty for all)")])],-1)),Lx={class:"column"};function Ux(e,t,n,o,s,r){const i=E("image-options"),a=E("d-flow"),l=E("d-fieldset"),d=E("d-button");return g(),y("div",kx,[Ox,e.imageOptions?(g(),L(i,{key:0,type:"panel",title:"","panel-id":e.currentPanel.id,"no-composition":"",onLeave:t[0]||(t[0]=c=>{e.imageOptions=!1,e.renderCurrentThumbnail()})},null,8,["panel-id"])):(g(),y(U,{key:1},[C(l,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:B(()=>[C(a,{"no-wraping":"",maxSize:"350px"},{default:B(()=>[(g(!0),y(U,null,$e(e.panelButtons,(c,p)=>(g(),y("div",{key:c.id,class:pe({panel_button:!0,active:c.id===e.currentPanel.id}),style:Re(`background-image: url('${c.image}')`),tabindex:"0",onClick:f=>e.updateCurrentPanel(c.id),onKeydown:[Le(f=>e.updateCurrentPanel(c.id),["enter"]),Le(G(f=>e.updateCurrentPanel(c.id),["prevent"]),["space"])]},[u("div",jx,[u("p",null,fe(c.text),1)]),u("div",Ix,fe(p+1),1)],46,xx))),128))]),_:1})]),_:1}),u("div",Tx,[C(d,{icon:"add_to_queue",onClick:e.addNewPanel},{default:B(()=>[O(" Add new")]),_:1},8,["onClick"]),C(d,{icon:"remove_from_queue",onClick:e.deletePanel,disabled:!e.canDeletePanel},{default:B(()=>[O(" Delete panel ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"arrow_upward",onClick:e.moveAhead,disabled:!e.canMoveAhead},{default:B(()=>[O(" Move ahead ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"arrow_downward",onClick:e.moveBehind,disabled:!e.canMoveBehind},{default:B(()=>[O(" Move behind ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"color_lens",onClick:t[1]||(t[1]=c=>e.imageOptions=!0)},{default:B(()=>[O(" Image options ")]),_:1})]),C(l,{title:"Export"},{default:B(()=>[u("table",null,[u("tr",null,[Ex,u("td",null,[de(u("select",{id:"export_format","onUpdate:modelValue":t[2]||(t[2]=c=>e.format=c)},[Bx,e.webpSupport?(g(),y("option",Ax," WebP (lossy) ")):X("",!0),e.heifSupport?(g(),y("option",Dx," HEIF (lossy) ")):X("",!0),Rx],512),[[_t,e.format]])])]),e.isLossy?(g(),y("tr",Hx,[Mx,u("td",null,[de(u("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=c=>e.quality=c),onKeydown:t[4]||(t[4]=G(()=>{},["stop"]))},null,544),[[Te,e.quality,void 0,{number:!0}]])])])):X("",!0),u("tr",null,[Fx,u("td",null,[de(u("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":t[5]||(t[5]=c=>e.ppi=c),onKeydown:t[6]||(t[6]=G(()=>{},["stop"])),onBlur:t[7]||(t[7]=c=>{e.ppi===""&&(e.ppi=0)})},null,544),[[Te,e.ppi,void 0,{number:!0}]])])]),u("tr",null,[Nx,u("td",null,[de(u("input",{id:"export_pages","onUpdate:modelValue":t[8]||(t[8]=c=>e.pages=c),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[Te,e.pages]])])]),u("tr",null,[u("td",null,[C(d,{icon:"photo_camera",onClick:e.download},{default:B(()=>[O(" Download ")]),_:1},8,["onClick"])]),u("td",null,[u("button",{onClick:t[9]||(t[9]=(...c)=>e.estimateExportSize&&e.estimateExportSize(...c))},"Estimate filesizes")])])])]),_:1}),u("div",Lx,[C(d,{icon:"save",onClick:e.save},{default:B(()=>[O("Save")]),_:1},8,["onClick"]),C(d,{icon:"folder_open",onClick:t[11]||(t[11]=c=>e.$refs.loadUpload.click())},{default:B(()=>[O(" Load "),u("input",{type:"file",ref:"loadUpload",onChange:t[10]||(t[10]=(...c)=>e.load&&e.load(...c))},null,544)]),_:1})])],64))])}const Vx=ne(Px,[["render",Ux],["__scopeId","data-v-03fb9b42"]]),Si=ba("panels/setNotificationProperty"),Wx=ee({mixins:[st],components:{Toggle:Rt,ObjectTool:Ao},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="notification")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:Si("text"),autoWrap:Si("autoWrap"),renderBackdrop:Si("backdrop")}});const zx=e=>(ze("data-v-cd3c38a2"),e=e(),Ge(),e),Gx={id:"notification_text_wrapper"},qx=zx(()=>u("label",{for:"notification_text"},"Text:",-1));function Xx(e,t,n,o,s,r){const i=E("toggle"),a=E("object-tool");return g(),L(a,{object:e.object,title:"Notification",textHandler:e.textHandler},{default:B(()=>[u("div",Gx,[qx,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),id:"notification_text",onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Te,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")])]),options:B(()=>[C(i,{modelValue:e.renderBackdrop,"onUpdate:modelValue":t[3]||(t[3]=l=>e.renderBackdrop=l),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const Kx=ne(Wx,[["render",Xx],["__scopeId","data-v-cd3c38a2"]]),Fs=ba("panels/setPoemProperty"),Yx=ee({mixins:[st],components:{Toggle:Rt,ObjectTool:Ao},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},backgrounds(){return Vp},poemTextStyles(){return Wp},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="poem")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:Fs("text"),autoWrap:Fs("autoWrap"),poemStyle:Fs("font"),poemBackground:Fs("background")}});const Jx=e=>(ze("data-v-47525611"),e=e(),Ge(),e),Zx={id:"poem_text"},Qx=Jx(()=>u("label",{for:"poem_text"},"Text:",-1)),ej=["value"],tj=["value"];function nj(e,t,n,o,s,r){const i=E("toggle"),a=E("object-tool");return g(),L(a,{object:e.object,title:e.object.subType==="poem"?"Poem":"Console",textHandler:e.textHandler},{default:B(()=>[u("div",Zx,[Qx,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Te,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")]),C(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[3]||(t[3]=l=>e.autoWrap=l)},null,8,["modelValue"]),e.object.subType==="poem"?(g(),y(U,{key:0},[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.poemBackground=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},[(g(!0),y(U,null,$e(e.backgrounds,(l,d)=>(g(),y("option",{value:d,key:d},fe(l.name),9,ej))),128))],544),[[_t,e.poemBackground]]),de(u("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.poemStyle=l),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},[(g(!0),y(U,null,$e(e.poemTextStyles,(l,d)=>(g(),y("option",{value:d,key:d},fe(l.name),9,tj))),128))],544),[[_t,e.poemStyle]])],64)):X("",!0)]),_:1},8,["object","title","textHandler"])}const oj=ne(Yx,[["render",nj],["__scopeId","data-v-47525611"]]),sj={a:"add",s:"backgrounds",d:"panels",f:"settings"},rj=ee({components:{SettingsPanel:hv,AddPanel:Yv,BackgroundsPanel:Gk,CreditsPanel:hk,CharacterPanel:nS,TextBoxPanel:qS,ChoicePanel:tk,SpritePanel:lS,PanelsPanel:Vx,NotificationPanel:Kx,PoemPanel:oj},data:()=>({panelSelection:"add"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},vertical(){return this.$store.state.ui.vertical},selection(){return this.$store.state.ui.selection},panel(){if(this.panelSelection==="selection")if(this.selection===null)this.panelSelection="add";else return this.currentPanel.objects[this.selection].type;return this.panelSelection},hasPrevRender(){return this.$store.state.ui.lastDownload!==null}},methods:{setPanel(e){e===this.panelSelection&&(e="add"),this.panelSelection=e,this.selection!==null&&this.$store.commit("ui/setSelection",null)},resetScroll(){console.log("resetting scrolls"),this.$refs.panels instanceof HTMLElement&&(this.$refs.panels.scrollTop=0,this.$refs.panels.scrollLeft=0)},onKeydown(e){if(e.ctrlKey){const t=sj[e.key];t&&(this.setPanel(t),e.preventDefault(),e.stopPropagation())}}},watch:{selection(e){if(e!=null){this.panelSelection="selection";return}this.panelSelection==="selection"&&(this.panelSelection="add")}},created(){q.onPanelChange(e=>{this.panelSelection=e}),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown)}});const ij={id:"toolbar"},lj=u("i",{class:"material-icons","aria-hidden":"true"},"add_box",-1),aj=u("div",{class:"shortcut-popup"},"A",-1),dj=[lj,aj],cj=u("i",{class:"material-icons","aria-hidden":"true"},"panorama",-1),uj=u("div",{class:"shortcut-popup"},"S",-1),pj=[cj,uj],fj=u("i",{class:"material-icons","aria-hidden":"true"},"view_module",-1),hj=u("div",{class:"shortcut-popup"},"D",-1),gj=[fj,hj],mj=u("i",{class:"material-icons","aria-hidden":"true"},"settings_applications",-1),bj=u("div",{class:"shortcut-popup"},"F",-1),vj=[mj,bj],yj={id:"toolbar-end"},_j=u("i",{class:"material-icons","aria-hidden":"true"},"help",-1),wj=[_j],$j=u("i",{class:"material-icons","aria-hidden":"true"},"extension",-1),Cj=[$j],Pj=["disabled"],Sj=u("i",{class:"material-icons","aria-hidden":"true"},"flip_to_back",-1),kj=[Sj],Oj=u("i",{class:"material-icons","aria-hidden":"true"},"photo_camera",-1),xj=[Oj];function jj(e,t,n,o,s,r){const i=E("settings-panel"),a=E("backgrounds-panel"),l=E("credits-panel"),d=E("character-panel"),c=E("sprite-panel"),p=E("text-box-panel"),f=E("choice-panel"),b=E("panels-panel"),v=E("notification-panel"),w=E("poem-panel"),H=E("add-panel");return g(),y("div",{id:"panels",class:pe({vertical:e.vertical}),onScroll:t[12]||(t[12]=(...D)=>e.resetScroll&&e.resetScroll(...D)),ref:"panels"},[u("div",ij,[u("button",{class:pe({active:e.panel==="add"}),onClick:t[0]||(t[0]=D=>e.setPanel("add")),title:"Add new objects to the scene","aria-label":"Add new objects to the scene"},dj,2),u("button",{class:pe({active:e.panel==="backgrounds"}),onClick:t[1]||(t[1]=D=>e.setPanel("backgrounds")),"aria-label":"Change the current background",title:"Change the current background"},pj,2),u("button",{class:pe({active:e.panel==="panels"}),title:"Panels","aria-label":"Panels",onClick:t[2]||(t[2]=D=>e.setPanel("panels"))},gj,2),u("button",{class:pe({active:e.panel==="settings"}),title:"Settings","aria-label":"Settings",onClick:t[3]||(t[3]=D=>e.setPanel("settings"))},vj,2)]),e.panel==="settings"?(g(),L(i,{key:0})):e.panel==="backgrounds"?(g(),L(a,{key:1,onShowDialog:t[4]||(t[4]=D=>e.$emit("show-dialog",D))})):e.panel==="help_credits"?(g(),L(l,{key:2})):e.panel==="character"?(g(),L(d,{key:3,onShowDialog:t[5]||(t[5]=D=>e.$emit("show-dialog",D)),onShowExpressionDialog:t[6]||(t[6]=D=>e.$emit("show-expression-dialog",D))})):e.panel==="sprite"?(g(),L(c,{key:4})):e.panel==="textBox"?(g(),L(p,{key:5})):e.panel==="choice"?(g(),L(f,{key:6})):e.panel==="panels"?(g(),L(b,{key:7})):e.panel==="notification"?(g(),L(v,{key:8})):e.panel==="poem"?(g(),L(w,{key:9})):(g(),L(H,{key:10,onShowDialog:t[7]||(t[7]=D=>e.$emit("show-dialog",D))})),u("div",yj,[u("button",{class:pe({active:e.panel==="help_credits"}),onClick:t[8]||(t[8]=D=>e.setPanel("help_credits")),title:"Help & Credits","aria-label":"Help & Credits"},wj,2),u("button",{class:pe({active:e.panel==="packs"}),onClick:t[9]||(t[9]=D=>e.$emit("show-dialog")),title:"Content packs","aria-label":"Content packs"},Cj,2),u("button",{onClick:t[10]||(t[10]=D=>e.$emit("show-prev-render")),title:"Show last downloaded panel","aria-label":"Show last downloaded panel",disabled:!e.hasPrevRender},kj,8,Pj),u("button",{title:"Take a screenshot of the current scene","aria-label":"Take a screenshot of the current scene",onClick:t[11]||(t[11]=D=>e.$emit("download"))},xj)])],34)}const Ij=ne(rj,[["render",jj]]);var Tj=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Ej=5e3,ki=2e4,iu=100,Bj=ee({props:{loading:{default:!1,type:Boolean}},data:()=>({messages:[],errors:[],resolvableErrors:[],showLoading:!1,showLoadingTimeout:0,hideLoadingTimeout:0}),computed:{vertical(){return this.$store.state.ui.vertical}},created(){this.onLoadingChange(this.loading),ue.subscribe(or,e=>{this.messages.push(`Failed to load asset '${e.path}'`),setTimeout(()=>{this.messages.shift()},Ej)}),ue.subscribe(yp,e=>{this.messages.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{this.messages.shift()},ki)}),ue.subscribe(Vl,e=>{this.errors.push(e.message)}),ue.subscribe(Gl,e=>{this.resolvableErrors.push(e)}),ue.subscribe(ot,e=>{this.messages.push(e.message),setTimeout(()=>{this.messages.shift()},ki)}),ue.subscribe($p,e=>{this.messages.push(e.error.name),this.messages.push(JSON.stringify(e.error.stack)),this.messages.push(e.info),setTimeout(()=>{this.messages.shift(),this.messages.shift(),this.messages.shift()},ki)})},methods:{onLoadingChange(e){e?(this.hideLoadingTimeout&&(clearTimeout(this.hideLoadingTimeout),this.hideLoadingTimeout=0),!this.showLoading&&!this.showLoadingTimeout&&(this.showLoadingTimeout=setTimeout(()=>{this.showLoading=!0,this.showLoadingTimeout=0},iu))):(this.showLoadingTimeout&&(clearTimeout(this.showLoadingTimeout),this.showLoadingTimeout=0),this.showLoading&&!this.hideLoadingTimeout&&(this.hideLoadingTimeout=setTimeout(()=>{this.showLoading=!1,this.hideLoadingTimeout=0},iu)))},dismissError(e){this.errors.splice(e,1)},resolvableAction(e,t){return Tj(this,null,function*(){const n=this.resolvableErrors[e];this.resolvableErrors.splice(e,1),yield n.actions.find(s=>s.name===t).exec()})}},watch:{loading(e){this.onLoadingChange(e)}}});const Aj={key:0},Dj=["onClick"],Rj=["onClick"];function Hj(e,t,n,o,s,r){return g(),y("div",{id:"messageConsole",class:pe({vertical:e.vertical})},[e.showLoading?(g(),y("p",Aj,"Loading...")):X("",!0),(g(!0),y(U,null,$e(e.messages,(i,a)=>(g(),y("p",{key:i+"_"+a},fe(i),1))),128)),(g(!0),y(U,null,$e(e.resolvableErrors,(i,a)=>(g(),y("p",{class:"error",key:"resolvableError_"+a},[O(fe(i.message)+" ",1),(g(!0),y(U,null,$e(i.actions,l=>(g(),y("a",{href:"#",key:"resolvableError_"+a+l.name,onClick:d=>e.resolvableAction(a,l.name)},"["+fe(l.name)+"]",9,Dj))),128))]))),128)),(g(!0),y(U,null,$e(e.errors,(i,a)=>(g(),y("p",{class:"error",key:"error_"+a},[O(fe(i)+" ",1),u("a",{href:"#",onClick:l=>e.dismissError(a)},"[Dismiss]",8,Rj)]))),128))],2)}const Mj=ne(Bj,[["render",Hj],["__scopeId","data-v-20f42fc5"]]);var Kn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Fj=ee({props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean}},data:()=>({sdCtx:null,currentlyRendering:!1,queuedRender:null,showingLast:!1,dropSpriteCount:0,dropPreventClick:!1,draggedObject:null,dragXOffset:0,dragYOffset:0,dragXOriginal:0,dragYOriginal:0,sceneRendererCache:null}),computed:{selection(){var e;return(e=this.$store.state.ui.selection)!=null?e:null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},lqRendering(){return this.$store.state.ui.lqRendering},sceneRender(){const e=this.$store.state.panels.currentPanel;return this.sceneRendererCache?this.sceneRendererCache.setPanelId(e):(console.log("New scene renderer!"),this.sceneRendererCache=Cr(new hr(this.$store,e,this.bitmapWidth,this.bitmapHeight))),this.sceneRendererCache},bitmapHeight(){return this.preLoading,Y().Base.screenHeight},bitmapWidth(){return this.preLoading,Y().Base.screenWidth},pickerMode(){return this.$store.state.ui.pickColor},cursor(){return this.pickerMode?"crosshair":"default"}},methods:{download(){return Kn(this,null,function*(){const e=yield this.sceneRender.download();yield this.vuexHistory.transaction(()=>Kn(this,null,function*(){const t=this.$store.state.ui.lastDownload;this.$store.commit("ui/setLastDownload",e),t!=null&&URL.revokeObjectURL(t)}))})},invalidateRender(){this.queuedRender==null&&(this.queuedRender=requestAnimationFrame(this.render_))},render_(){return Kn(this,null,function*(){if(this.queuedRender!=null&&(cancelAnimationFrame(this.queuedRender),this.queuedRender=null),!this.$store.state.unsafe){try{yield this.sceneRender.render(!this.lqRendering,!0,!1)}catch(e){console.log(e)}this.display(),ue.fire(new Wl)}})},renderLoadingScreen(){const e=document.createElement("canvas");e.height=this.bitmapHeight,e.width=this.bitmapWidth;try{vo.make(e,!0,!1).drawText({text:"Starting...",x:e.width/2,y:e.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),this.sdCtx.drawImage(e,this.canvasWidth,this.canvasHeight)}finally{bo(e)}},display(){this.showingLast=!1,this.sceneRender.paintOnto(this.sdCtx,{x:0,y:0,w:this.bitmapWidth,h:this.bitmapHeight})},toRendererCoordinate(e,t){const n=this.$refs.sd,o=e-n.offsetLeft,s=t-n.offsetTop,r=o/n.offsetWidth*n.width,i=s/n.offsetWidth*n.width;return[r,i]},onUiClick(e){var t;const[n,o]=this.toRendererCoordinate(e.clientX,e.clientY);if(this.pickerMode){const a=this.sdCtx.getImageData(n,o,1,1).data,l=`rgba(${a[0].toString()},${a[1].toString()},${a[2].toString()},${(a[3]/255).toString()})`;this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!1),ue.fire(new sr(l))});return}if(this.dropPreventClick){this.dropPreventClick=!1;return}const s=this.sceneRender.objectsAt(n,o),r=s.findIndex(a=>a===this.selection);let i;r===0?i=null:r!==-1?i=s[r-1]:i=(t=s[s.length-1])!=null?t:null,this.$store.state.ui.selection!==i&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",i)})},onDragStart(e){if(e.preventDefault(),this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,n]=this.toRendererCoordinate(e.clientX,e.clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=n-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onTouchStart(e){if(this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,n]=this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=n-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onSpriteDragMove(e){if(!this.draggedObject)return;e.preventDefault();let[t,n]=e instanceof MouseEvent?this.toRendererCoordinate(e.clientX,e.clientY):this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);t-=this.dragXOffset,n-=this.dragYOffset;const o=Math.abs(t-this.dragXOriginal),s=Math.abs(n-this.dragYOriginal);o+s>1&&(this.dropPreventClick=!0),e.shiftKey&&(o>s?n=this.dragYOriginal:t=this.dragXOriginal),this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{panelId:this.draggedObject.panelId,id:this.draggedObject.id,x:t,y:n})})},onDrop(e){return Kn(this,null,function*(){if(e.stopPropagation(),e.preventDefault(),!!e.dataTransfer){for(const t of e.dataTransfer.items)if(t.kind==="file"&&t.type.match(/image.*/)){const n=t.getAsFile(),o=URL.createObjectURL(n);try{const s=yield this.$store.dispatch("uploadUrls/add",{name:n.name,url:o});yield this.vuexHistory.transaction(()=>Kn(this,null,function*(){yield this.$store.dispatch("panels/createSprite",{panelId:this.$store.state.panels.currentPanel,assets:[{hq:s,lq:s,sourcePack:"dddg.uploaded.sprites"}]})}))}catch(s){URL.revokeObjectURL(o)}}}})},onSpriteDrop(e){this.draggedObject&&("TouchEvent"in window&&e instanceof TouchEvent&&(this.dropPreventClick=!1),this.draggedObject=null)},onMouseEnter(e){e.buttons!==1&&(this.draggedObject=null)}},watch:{canvasWidth(){this.display()},canvasHeight(){this.display()}},created(){return Kn(this,null,function*(){if(typeof WeakRef!="undefined"){const e=new WeakRef(this);window.getMainSceneRenderer=function(){var t;return(t=e.deref())==null?void 0:t.sceneRender}}else window.getMainSceneRenderer=()=>this.sceneRender;ue.subscribe(Tr,()=>this.invalidateRender()),ue.subscribe(zl,()=>{const e=this.sceneRendererCache;e&&e.setPanelId(-1)}),this.$store.subscribe(e=>{e.type!=="panels/setPanelPreview"&&e.type!=="panels/currentPanel"&&this.invalidateRender()})})},mounted(){const e=this.$refs.sd;this.sdCtx=e.getContext("2d"),this.renderLoadingScreen(),this.invalidateRender()},unmounted(){var e;(e=this.sceneRendererCache)==null||e.dispose()}});const Nj=["height","width"];function Lj(e,t,n,o,s,r){return g(),y("canvas",{id:"scaled_display",ref:"sd",height:e.bitmapHeight,width:e.bitmapWidth,style:Re({width:e.canvasWidth+"px",height:e.canvasHeight+"px",cursor:e.cursor}),draggable:"true",onClick:t[0]||(t[0]=(...i)=>e.onUiClick&&e.onUiClick(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.onTouchStart&&e.onTouchStart(...i)),onDragstart:t[2]||(t[2]=(...i)=>e.onDragStart&&e.onDragStart(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onMousemove:t[4]||(t[4]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onMouseup:t[6]||(t[6]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onDragover:t[7]||(t[7]=(...i)=>e.onDragOver&&e.onDragOver(...i)),onDrop:t[8]||(t[8]=(...i)=>e.onDrop&&e.onDrop(...i)),onMouseenter:t[9]||(t[9]=(...i)=>e.onMouseEnter&&e.onMouseEnter(...i)),onContextmenu:t[10]||(t[10]=G(()=>{},["prevent"]))},"HTML5 is required to use the Doki Doki Dialog Generator. ",44,Nj)}const Uj=ne(Fj,[["render",Lj]]),Ca={"dddg.buildin.backgrounds.nsfw":`${Fe}packs/buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${Fe}packs/buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${Fe}packs/buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${Fe}packs/buildin.base.yuri.nsfw.json`},Vj=new Set(Object.keys(Ca)),Wj=Object.values(Ca);var Oi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const lu=16/9,Ns=20,zj=50,Gj=200,qj=ee({components:{ToolBox:Ij,MessageConsole:Mj,Render:Uj,ModalDialog:Yl,SingleBox:za(()=>_d(()=>import("./SingleBox.3b19c91c.js"),["./SingleBox.3b19c91c.js","./SingleBox.299f4dad.css"],import.meta.url)),ExpressionBuilder:za(()=>_d(()=>import("./index.6293c807.js"),["./index.6293c807.js","./index.841d3301.css"],import.meta.url))},data:()=>({canvasWidth:0,canvasHeight:0,blendOver:null,uiSize:192,currentlyRendering:!1,panel:"",dialogVisable:!1,canvasTooSmall:!1,expressionBuilderVisible:!1,expressionBuilderCharacter:"",expressionBuilderHeadGroup:void 0,systemPrefersDarkMode:!1,preLoading:!0,classes:new Set,classTimeout:null,queuedRerender:null}),computed:{isSafari(){return!1},useDarkTheme(){var e;return(e=this.userPrefersDarkMode)!=null?e:this.systemPrefersDarkMode},userPrefersDarkMode(){return this.$store.state.ui.useDarkTheme},nsfw(){return this.$store.state.ui.nsfw},objects(){const e=this.$store.state.panels,t=e.panels[e.currentPanel];return t==null?[]:[...t.order,...t.onTopOrder]}},methods:{drawLastDownload(){const e=this.$store.state.ui.lastDownload;e!=null&&this.$refs.render.blendOver(e)},setBlendOver(){this.blendOver=this.$store.state.ui.lastDownload},optimum(e,t){let n=e/lu,o=t*lu;return n>t?n=t:o=e,[o,n]},optimizeWithMenu(e,t){const n=this.optimum(e,t-this.uiSize),o=this.optimum(e-this.uiSize,t);return!this.isSafari&&n[0]*n[1]>o[0]*o[1]?[n[0],n[1],!1]:[o[0],o[1],!0]},updateArea(){const[e,t,n]=this.optimizeWithMenu(document.documentElement.clientWidth,document.documentElement.clientHeight);this.canvasWidth=e,this.canvasHeight=t,this.canvasTooSmall=Math.max(e,t)<Gj,this.$store.state.ui.vertical!==n&&this.$store.commit("ui/setVertical",n)},showDialog(e){if(this.dialogVisable=!0,e==null)return;const t=()=>{this.$refs.packDialog?this.$refs.packDialog.setSearch(e):setTimeout(t,zj)};this.$nextTick(t)},showExpressionDialog(e){this.expressionBuilderVisible=!0,this.expressionBuilderCharacter=e.character,this.expressionBuilderHeadGroup=e.headGroup},rerender(){this.queuedRerender==null&&(this.queuedRerender=requestAnimationFrame(()=>{this.queuedRerender=null,ue.fire(new Tr)}))},onKeydown(e){if(e.key==="Control"){this.classTimeout===null&&(this.classTimeout=setTimeout(()=>{this.classTimeout=null,this.classes.add("ctrl-key")},500));return}if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}this.vuexHistory.transaction(()=>{if(e.ctrlKey){if(e.key==="z"){e.preventDefault();return}else if(e.key==="y"){e.preventDefault();return}else if(e.key==="v"){this.$store.dispatch("panels/pasteObjectFromClipboard",{}),e.preventDefault();return}}const n=this.$store.state.panels.panels[this.$store.state.panels.currentPanel].objects[this.$store.state.ui.selection];if(n==null)return;if(e.key==="Delete"){this.$store.dispatch("panels/removeObject",{id:n.id,panelId:n.panelId});return}if(e.key==="c"||e.key==="x"){this.$store.dispatch("panels/copyObjectToClipboard",{id:n.id,panelId:n.panelId}),e.key==="x"&&this.$store.dispatch("panels/removeObject",{id:n.id,panelId:n.panelId}),e.preventDefault();return}if(e.key==="/"||e.key==="*"){let r=e.key==="/"?-10:10;e.shiftKey&&(r/=Math.abs(r)),this.$store.commit("panels/setRotation",{id:n.id,panelId:n.panelId,rotation:n.rotation+r}),e.stopPropagation(),e.preventDefault();return}if(n.type==="character"){const r=n;if(!r.freeMove){if(e.key==="ArrowLeft"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:-1});return}if(e.key==="ArrowRight"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:1});return}}}let{x:o,y:s}=n;if(e.key==="ArrowLeft")o-=e.shiftKey?1:Ns;else if(e.key==="ArrowRight")o+=e.shiftKey?1:Ns;else if(e.key==="ArrowUp")s-=e.shiftKey?1:Ns;else if(e.key==="ArrowDown")s+=e.shiftKey?1:Ns;else return;this.$store.dispatch("panels/setPosition",{id:n.id,panelId:n.panelId,x:o,y:s})})},onKeyup(e){if(e.key==="Control"){this.classTimeout!=null&&clearTimeout(this.classTimeout),this.classTimeout=null,this.classes.delete("ctrl-key");return}},applyTheme(){document.body.classList.toggle("dark-theme",this.useDarkTheme)},select(e){this.$store.state.ui.selection!==e&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",e)})}},watch:{systemPrefersDarkMode(){this.applyTheme()},userPrefersDarkMode(){this.applyTheme()},nsfw(e){return Oi(this,null,function*(){e?yield this.$store.dispatch("content/loadContentPacks",Wj):yield this.$store.dispatch("removePacks",{packs:Vj})})}},mounted(){if(window.addEventListener("keypress",e=>{e.key==="Escape"&&this.vuexHistory.transaction(()=>{this.$store.state.ui.selection!==null&&this.$store.commit("ui/setSelection",null)})}),window.addEventListener("resize",this.updateArea),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.matchMedia!=null){const e=window.matchMedia("(prefers-color-scheme: dark)");this.systemPrefersDarkMode=e.matches,e.addListener(t=>{this.systemPrefersDarkMode=t.matches})}},created(){return Oi(this,null,function*(){this.updateArea(),Jt.setStore(this.$store),window.app=this,window.store=this.$store,window.env=q,Rn(()=>this.$store.state.ui.selection,t=>{var n,o;((n=document.activeElement)==null?void 0:n.getAttribute("data-obj-id"))!==""+t&&((o=document.querySelector(`*[data-obj-id='${t}']`))==null||o.focus({focusVisible:!1,preventScroll:!0}))}),document.body.addEventListener("drop",t=>{t.preventDefault()},!0),document.body.addEventListener("dragover",t=>{t.preventDefault()},!0),yield q.loadGameMode(),this.preLoading=!1,q.connectToStore(this.vuexHistory,this.$store);const e=yield q.loadSettings();yield this.vuexHistory.transaction(()=>Oi(this,null,function*(){var t,n,o,s;q.state.looseTextParsing=e.looseTextParsing||!0,this.$store.commit("ui/setLqRendering",(t=e.lq)!=null?t:!1),this.$store.commit("ui/setDarkTheme",(n=e.darkMode)!=null?n:null),this.$store.commit("ui/setDefaultCharacterTalkingZoom",(o=e.defaultCharacterTalkingZoom)!=null?o:!0),yield this.$store.dispatch("content/loadContentPacks",[`${Fe}packs/buildin.base.backgrounds.json`,`${Fe}packs/buildin.base.monika.json`,`${Fe}packs/buildin.base.sayori.json`,`${Fe}packs/buildin.base.natsuki.json`,`${Fe}packs/buildin.base.yuri.json`,`${Fe}packs/buildin.extra.mc.json`,`${Fe}packs/buildin.extra.concept_mc.json`,`${Fe}packs/buildin.extra.mc_chad.json`,`${Fe}packs/buildin.extra.femc.json`,`${Fe}packs/buildin.extra.concept_femc.json`,`${Fe}packs/buildin.extra.amy.json`]),yield q.loadContentPacks();const r=yield this.$store.dispatch("panels/createPanel");Object.keys(this.$store.state.panels.panels[r].objects).length===0&&(yield this.$store.dispatch("panels/createTextBox",{panelId:r,text:`Hi! Click here to edit this textbox! ${this.$store.state.ui.vertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more!`})),yield this.$store.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:this.$store.state.panels.currentPanel}),yield this.$store.commit("ui/setNsfw",(s=e.nsfw)!=null?s:!1)}))})},unmounted(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup)}});const Xj={key:0},Kj={class:"hidden-selectors"},Yj=["data-obj-id","onKeydown"],Jj=u("div",{id:"modal-messages"},null,-1);function Zj(e,t,n,o,s,r){const i=E("render"),a=E("message-console"),l=E("tool-box"),d=E("single-box"),c=E("modal-dialog"),p=E("expression-builder");return g(),y(U,null,[e.canvasTooSmall&&e.isSafari?(g(),y("div",Xj," Protrait mode is not supported by safari. Please turn the device sideways. ")):(g(),y("div",{key:1,id:"app",class:pe(Array.from(e.classes))},[u("div",Kj,[(g(!0),y(U,null,$e(e.objects,f=>(g(),y("div",{key:f,tabindex:"0","data-obj-id":f,onFocus:t[0]||(t[0]=b=>e.rerender()),onBlur:t[1]||(t[1]=b=>e.rerender()),onKeydown:[Le(G(b=>e.select(f),["prevent"]),["enter"]),Le(G(b=>e.select(f),["prevent"]),["space"])]},null,40,Yj))),128))]),C(i,{ref:"render",canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,preLoading:e.preLoading},null,8,["canvasWidth","canvasHeight","preLoading"]),C(a),C(l,{onShowPrevRender:e.drawLastDownload,onDownload:t[2]||(t[2]=f=>e.$refs.render.download()),onShowDialog:e.showDialog,onShowExpressionDialog:e.showExpressionDialog},null,8,["onShowPrevRender","onShowDialog","onShowExpressionDialog"]),(g(),L($g,null,[e.dialogVisable?(g(),L(c,{key:0,ref:"dialog",onLeave:t[4]||(t[4]=f=>e.dialogVisable=!1)},{default:B(()=>[C(d,{ref:"packDialog",onLeave:t[3]||(t[3]=f=>e.dialogVisable=!1)},null,512)]),_:1},512)):X("",!0)],1024)),e.expressionBuilderVisible?(g(),L(c,{key:0,ref:"dialog",onLeave:t[6]||(t[6]=f=>e.expressionBuilderVisible=!1)},{default:B(()=>[C(p,{character:e.expressionBuilderCharacter,initHeadGroup:e.expressionBuilderHeadGroup,onLeave:t[5]||(t[5]=f=>e.expressionBuilderVisible=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):X("",!0)],2)),Jj],64)}const Qj=ne(qj,[["render",Zj]]);var eI=Object.defineProperty,tI=Object.defineProperties,nI=Object.getOwnPropertyDescriptors,au=Object.getOwnPropertySymbols,oI=Object.prototype.hasOwnProperty,sI=Object.prototype.propertyIsEnumerable,du=(e,t,n)=>t in e?eI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qr=(e,t)=>{for(var n in t||(t={}))oI.call(t,n)&&du(e,n,t[n]);if(au)for(var n of au(t))sI.call(t,n)&&du(e,n,t[n]);return e},rI=(e,t)=>tI(e,nI(t));function Ks(e,t){return{backgrounds:iI(e.backgrounds,t.backgrounds),characters:aI(e.characters,t.characters),dependencies:hl(e.dependencies,t.dependencies),fonts:Bt(e.fonts,t.fonts,n=>n.id,(n,o)=>rI(qr({},n),{files:hl(n.files,o.files)})),poemStyles:Bt(e.poemStyles,t.poemStyles,n=>n.label,()=>{throw new Error}),poemBackgrounds:[...e.poemBackgrounds,...t.poemBackgrounds],sprites:Bt(e.sprites,t.sprites,n=>n.id,(n,o)=>{var s;return{id:n.id,label:n.label,variants:[...n.variants,...o.variants],defaultScale:n.defaultScale,hd:n.hd,sdVersion:(s=n.sdVersion)!=null?s:o.sdVersion}}),colors:Bt(e.colors,t.colors,n=>n.color,n=>n)}}function iI(e,t){return Bt(e,t,n=>n.id,lI)}function lI(e,t){var n;return{id:e.id,label:e.label,variants:[...e.variants,...t.variants],scaling:e.scaling,sdVersion:(n=e.sdVersion)!=null?n:t.sdVersion}}function aI(e,t){return Bt(e,t,n=>n.id,dI)}function dI(e,t){return{chibi:e.chibi,id:e.id,label:e.label,heads:pI(e.heads,t.heads),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion,styleGroups:Bt(e.styleGroups,t.styleGroups,n=>n.id,(n,o)=>({id:n.id,styleComponents:Bt(n.styleComponents,o.styleComponents,s=>s.id,(s,r)=>({id:s.id,label:s.label,variants:cI(s.variants,r.variants)})),styles:Bt(n.styles,o.styles,s=>JSON.stringify(s.components),(s,r)=>({components:s.components,poses:Bt(s.poses,r.poses,i=>i.id,uI)}))}))}}function cI(e,t){const n=qr({},e);for(const o in t)!t.hasOwnProperty(o)||n.hasOwnProperty(o)||(n[o]=t[o]);return n}function uI(e,t){const n=qr({},e.positions);for(const o in t.positions)n[o]?n[o]=[...n[o],...t.positions[o]]:n[o]=t.positions[o];return{id:e.id,compatibleHeads:hl(e.compatibleHeads,t.compatibleHeads),previewOffset:e.previewOffset,previewSize:e.previewSize,scale:e.scale,size:e.size,renderCommands:e.renderCommands,positions:n}}function pI(e,t){const n=qr({},e);for(const o in t){if(!t.hasOwnProperty(o))continue;const s=t[o];if(n[o]){const r=n[o];n[o]={previewOffset:r.previewOffset,previewSize:r.previewSize,variants:[...r.variants,...s.variants]}}else n[o]=s}return n}function hl(e,t){const n=[...e];for(const o of t)n.includes(o)||n.push(o);return n}function Bt(e,t,n,o){const s=[...e],r=new Map(e.map((i,a)=>[n(i),a]));for(const i of t){const a=n(i);if(r.has(a)){const l=r.get(a),d=s[l];s.splice(l,1,o(d,i))}else r.set(a,s.length),s.push(i)}return s}function fI(){return Bf().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Bf(){return typeof navigator!="undefined"&&typeof window!="undefined"?window:typeof global!="undefined"?global:{}}const hI=typeof Proxy=="function",gI="devtools-plugin:setup",mI="plugin:settings:set";let Yn,gl;function bI(){var e;return Yn!==void 0||(typeof window!="undefined"&&window.performance?(Yn=!0,gl=window.performance):typeof global!="undefined"&&((e=global.perf_hooks)===null||e===void 0?void 0:e.performance)?(Yn=!0,gl=global.perf_hooks.performance):Yn=!1),Yn}function vI(){return bI()?gl.now():Date.now()}class yI{constructor(t,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=n;const o={};if(t.settings)for(const i in t.settings){const a=t.settings[i];o[i]=a.defaultValue}const s=`__vue-devtools-plugin-settings__${t.id}`;let r=Object.assign({},o);try{const i=localStorage.getItem(s),a=JSON.parse(i);Object.assign(r,a)}catch(i){}this.fallbacks={getSettings(){return r},setSettings(i){try{localStorage.setItem(s,JSON.stringify(i))}catch(a){}r=i},now(){return vI()}},n&&n.on(mI,(i,a)=>{i===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(i,a)=>this.target?this.target.on[a]:(...l)=>{this.onQueue.push({method:a,args:l})}}),this.proxiedTarget=new Proxy({},{get:(i,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...l)=>(this.targetQueue.push({method:a,args:l,resolve:()=>{}}),this.fallbacks[a](...l)):(...l)=>new Promise(d=>{this.targetQueue.push({method:a,args:l,resolve:d})})})}setRealTarget(t){return en(this,null,function*(){this.target=t;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(yield this.target[n.method](...n.args))})}}function _I(e,t){const n=e,o=Bf(),s=fI(),r=hI&&n.enableEarlyProxy;if(s&&(o.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))s.emit(gI,e,t);else{const i=r?new yI(n,s):null;(o.__VUE_DEVTOOLS_PLUGINS__=o.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:i}),i&&t(i.proxiedTarget)}}/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var wI="store";function Do(e,t){Object.keys(e).forEach(function(n){return t(e[n],n)})}function $I(e){return e!==null&&typeof e=="object"}function CI(e){return e&&typeof e.then=="function"}function PI(e,t){return function(){return e(t)}}function Af(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var o=t.indexOf(e);o>-1&&t.splice(o,1)}}function Df(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;Xr(e,n,[],e._modules.root,!0),Pa(e,n,t)}function Pa(e,t,n){var o=e._state,s=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var r=e._wrappedGetters,i={},a={},l=Ch(!0);l.run(function(){Do(r,function(d,c){i[c]=PI(d,e),a[c]=nr(function(){return i[c]()}),Object.defineProperty(e.getters,c,{get:function(){return a[c].value},enumerable:!0})})}),e._state=Kt({data:t}),e._scope=l,e.strict&&jI(e),o&&n&&e._withCommit(function(){o.data=null}),s&&s.stop()}function Xr(e,t,n,o,s){var r=!n.length,i=e._modules.getNamespace(n);if(o.namespaced&&(e._modulesNamespaceMap[i],e._modulesNamespaceMap[i]=o),!r&&!s){var a=Sa(t,n.slice(0,-1)),l=n[n.length-1];e._withCommit(function(){a[l]=o.state})}var d=o.context=SI(e,i,n);o.forEachMutation(function(c,p){var f=i+p;kI(e,f,c,d)}),o.forEachAction(function(c,p){var f=c.root?p:i+p,b=c.handler||c;OI(e,f,b,d)}),o.forEachGetter(function(c,p){var f=i+p;xI(e,f,c,d)}),o.forEachChild(function(c,p){Xr(e,t,n.concat(p),c,s)})}function SI(e,t,n){var o=t==="",s={dispatch:o?e.dispatch:function(r,i,a){var l=gr(r,i,a),d=l.payload,c=l.options,p=l.type;return(!c||!c.root)&&(p=t+p),e.dispatch(p,d)},commit:o?e.commit:function(r,i,a){var l=gr(r,i,a),d=l.payload,c=l.options,p=l.type;(!c||!c.root)&&(p=t+p),e.commit(p,d,c)}};return Object.defineProperties(s,{getters:{get:o?function(){return e.getters}:function(){return Rf(e,t)}},state:{get:function(){return Sa(e.state,n)}}}),s}function Rf(e,t){if(!e._makeLocalGettersCache[t]){var n={},o=t.length;Object.keys(e.getters).forEach(function(s){if(s.slice(0,o)===t){var r=s.slice(o);Object.defineProperty(n,r,{get:function(){return e.getters[s]},enumerable:!0})}}),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}function kI(e,t,n,o){var s=e._mutations[t]||(e._mutations[t]=[]);s.push(function(i){n.call(e,o.state,i)})}function OI(e,t,n,o){var s=e._actions[t]||(e._actions[t]=[]);s.push(function(i){var a=n.call(e,{dispatch:o.dispatch,commit:o.commit,getters:o.getters,state:o.state,rootGetters:e.getters,rootState:e.state},i);return CI(a)||(a=Promise.resolve(a)),e._devtoolHook?a.catch(function(l){throw e._devtoolHook.emit("vuex:error",l),l}):a})}function xI(e,t,n,o){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(r){return n(o.state,o.getters,r.state,r.getters)})}function jI(e){Rn(function(){return e._state.data},function(){},{deep:!0,flush:"sync"})}function Sa(e,t){return t.reduce(function(n,o){return n[o]},e)}function gr(e,t,n){return $I(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}var II="vuex bindings",cu="vuex:mutations",xi="vuex:actions",Jn="vuex",TI=0;function EI(e,t){_I({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[II]},function(n){n.addTimelineLayer({id:cu,label:"Vuex Mutations",color:uu}),n.addTimelineLayer({id:xi,label:"Vuex Actions",color:uu}),n.addInspector({id:Jn,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree(function(o){if(o.app===e&&o.inspectorId===Jn)if(o.filter){var s=[];Nf(s,t._modules.root,o.filter,""),o.rootNodes=s}else o.rootNodes=[Ff(t._modules.root,"")]}),n.on.getInspectorState(function(o){if(o.app===e&&o.inspectorId===Jn){var s=o.nodeId;Rf(t,s),o.state=DI(HI(t._modules,s),s==="root"?t.getters:t._makeLocalGettersCache,s)}}),n.on.editInspectorState(function(o){if(o.app===e&&o.inspectorId===Jn){var s=o.nodeId,r=o.path;s!=="root"&&(r=s.split("/").filter(Boolean).concat(r)),t._withCommit(function(){o.set(t._state.data,r,o.state.value)})}}),t.subscribe(function(o,s){var r={};o.payload&&(r.payload=o.payload),r.state=s,n.notifyComponentUpdate(),n.sendInspectorTree(Jn),n.sendInspectorState(Jn),n.addTimelineEvent({layerId:cu,event:{time:Date.now(),title:o.type,data:r}})}),t.subscribeAction({before:function(o,s){var r={};o.payload&&(r.payload=o.payload),o._id=TI++,o._time=Date.now(),r.state=s,n.addTimelineEvent({layerId:xi,event:{time:o._time,title:o.type,groupId:o._id,subtitle:"start",data:r}})},after:function(o,s){var r={},i=Date.now()-o._time;r.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},o.payload&&(r.payload=o.payload),r.state=s,n.addTimelineEvent({layerId:xi,event:{time:Date.now(),title:o.type,groupId:o._id,subtitle:"end",data:r}})}})})}var uu=8702998,BI=6710886,AI=16777215,Hf={label:"namespaced",textColor:AI,backgroundColor:BI};function Mf(e){return e&&e!=="root"?e.split("/").slice(-2,-1)[0]:"Root"}function Ff(e,t){return{id:t||"root",label:Mf(t),tags:e.namespaced?[Hf]:[],children:Object.keys(e._children).map(function(n){return Ff(e._children[n],t+n+"/")})}}function Nf(e,t,n,o){o.includes(n)&&e.push({id:o||"root",label:o.endsWith("/")?o.slice(0,o.length-1):o||"Root",tags:t.namespaced?[Hf]:[]}),Object.keys(t._children).forEach(function(s){Nf(e,t._children[s],n,o+s+"/")})}function DI(e,t,n){t=n==="root"?t:t[n];var o=Object.keys(t),s={state:Object.keys(e.state).map(function(i){return{key:i,editable:!0,value:e.state[i]}})};if(o.length){var r=RI(t);s.getters=Object.keys(r).map(function(i){return{key:i.endsWith("/")?Mf(i):i,editable:!1,value:ml(function(){return r[i]})}})}return s}function RI(e){var t={};return Object.keys(e).forEach(function(n){var o=n.split("/");if(o.length>1){var s=t,r=o.pop();o.forEach(function(i){s[i]||(s[i]={_custom:{value:{},display:i,tooltip:"Module",abstract:!0}}),s=s[i]._custom.value}),s[r]=ml(function(){return e[n]})}else t[n]=ml(function(){return e[n]})}),t}function HI(e,t){var n=t.split("/").filter(function(o){return o});return n.reduce(function(o,s,r){var i=o[s];if(!i)throw new Error('Missing module "'+s+'" for path "'+t+'".');return r===n.length-1?i:i._children},t==="root"?e:e.root._children)}function ml(e){try{return e()}catch(t){return t}}var $t=function(t,n){this.runtime=n,this._children=Object.create(null),this._rawModule=t;var o=t.state;this.state=(typeof o=="function"?o():o)||{}},Lf={namespaced:{configurable:!0}};Lf.namespaced.get=function(){return!!this._rawModule.namespaced};$t.prototype.addChild=function(t,n){this._children[t]=n};$t.prototype.removeChild=function(t){delete this._children[t]};$t.prototype.getChild=function(t){return this._children[t]};$t.prototype.hasChild=function(t){return t in this._children};$t.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)};$t.prototype.forEachChild=function(t){Do(this._children,t)};$t.prototype.forEachGetter=function(t){this._rawModule.getters&&Do(this._rawModule.getters,t)};$t.prototype.forEachAction=function(t){this._rawModule.actions&&Do(this._rawModule.actions,t)};$t.prototype.forEachMutation=function(t){this._rawModule.mutations&&Do(this._rawModule.mutations,t)};Object.defineProperties($t.prototype,Lf);var Vn=function(t){this.register([],t,!1)};Vn.prototype.get=function(t){return t.reduce(function(n,o){return n.getChild(o)},this.root)};Vn.prototype.getNamespace=function(t){var n=this.root;return t.reduce(function(o,s){return n=n.getChild(s),o+(n.namespaced?s+"/":"")},"")};Vn.prototype.update=function(t){Uf([],this.root,t)};Vn.prototype.register=function(t,n,o){var s=this;o===void 0&&(o=!0);var r=new $t(n,o);if(t.length===0)this.root=r;else{var i=this.get(t.slice(0,-1));i.addChild(t[t.length-1],r)}n.modules&&Do(n.modules,function(a,l){s.register(t.concat(l),a,o)})};Vn.prototype.unregister=function(t){var n=this.get(t.slice(0,-1)),o=t[t.length-1],s=n.getChild(o);!s||!s.runtime||n.removeChild(o)};Vn.prototype.isRegistered=function(t){var n=this.get(t.slice(0,-1)),o=t[t.length-1];return n?n.hasChild(o):!1};function Uf(e,t,n){if(t.update(n),n.modules)for(var o in n.modules){if(!t.getChild(o))return;Uf(e.concat(o),t.getChild(o),n.modules[o])}}function MI(e){return new Ze(e)}var Ze=function(t){var n=this;t===void 0&&(t={});var o=t.plugins;o===void 0&&(o=[]);var s=t.strict;s===void 0&&(s=!1);var r=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Vn(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var i=this,a=this,l=a.dispatch,d=a.commit;this.dispatch=function(f,b){return l.call(i,f,b)},this.commit=function(f,b,v){return d.call(i,f,b,v)},this.strict=s;var c=this._modules.root.state;Xr(this,c,[],this._modules.root),Pa(this,c),o.forEach(function(p){return p(n)})},ka={state:{configurable:!0}};Ze.prototype.install=function(t,n){t.provide(n||wI,this),t.config.globalProperties.$store=this;var o=this._devtools!==void 0?this._devtools:!1;o&&EI(t,this)};ka.state.get=function(){return this._state.data};ka.state.set=function(e){};Ze.prototype.commit=function(t,n,o){var s=this,r=gr(t,n,o),i=r.type,a=r.payload,l={type:i,payload:a},d=this._mutations[i];!d||(this._withCommit(function(){d.forEach(function(p){p(a)})}),this._subscribers.slice().forEach(function(c){return c(l,s.state)}))};Ze.prototype.dispatch=function(t,n){var o=this,s=gr(t,n),r=s.type,i=s.payload,a={type:r,payload:i},l=this._actions[r];if(!!l){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(a,o.state)})}catch(c){}var d=l.length>1?Promise.all(l.map(function(c){return c(i)})):l[0](i);return new Promise(function(c,p){d.then(function(f){try{o._actionSubscribers.filter(function(b){return b.after}).forEach(function(b){return b.after(a,o.state)})}catch(b){}c(f)},function(f){try{o._actionSubscribers.filter(function(b){return b.error}).forEach(function(b){return b.error(a,o.state,f)})}catch(b){}p(f)})})}};Ze.prototype.subscribe=function(t,n){return Af(t,this._subscribers,n)};Ze.prototype.subscribeAction=function(t,n){var o=typeof t=="function"?{before:t}:t;return Af(o,this._actionSubscribers,n)};Ze.prototype.watch=function(t,n,o){var s=this;return Rn(function(){return t(s.state,s.getters)},n,Object.assign({},o))};Ze.prototype.replaceState=function(t){var n=this;this._withCommit(function(){n._state.data=t})};Ze.prototype.registerModule=function(t,n,o){o===void 0&&(o={}),typeof t=="string"&&(t=[t]),this._modules.register(t,n),Xr(this,this.state,t,this._modules.get(t),o.preserveState),Pa(this,this.state)};Ze.prototype.unregisterModule=function(t){var n=this;typeof t=="string"&&(t=[t]),this._modules.unregister(t),this._withCommit(function(){var o=Sa(n.state,t.slice(0,-1));delete o[t[t.length-1]]}),Df(this)};Ze.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),this._modules.isRegistered(t)};Ze.prototype.hotUpdate=function(t){this._modules.update(t),Df(this,!0)};Ze.prototype._withCommit=function(t){var n=this._committing;this._committing=!0,t(),this._committing=n};Object.defineProperties(Ze.prototype,ka);function Vf(){return{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1}}const FI={namespaced:!0,state:Vf(),mutations:{setVertical(e,t){e.vertical=t},setNsfw(e,t){e.nsfw=t},setLqRendering(e,t){e.lqRendering=t},setSelection(e,t){e.selection=t},setLastDownload(e,t){e.lastDownload=t},setClipboard(e,t){e.clipboard=t},setDarkTheme(e,t){e.useDarkTheme=t},setDefaultCharacterTalkingZoom(e,t){e.defaultCharacterTalkingZoom=t},setColorPicker(e,t){e.pickColor=t}}};var vn={},mr=Ee&&Ee.__assign||function(){return mr=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},mr.apply(this,arguments)},Wf=Ee&&Ee.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},NI=Ee&&Ee.__read||function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,r=[],i;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)r.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r},LI=Ee&&Ee.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(NI(arguments[t]));return e};Object.defineProperty(vn,"__esModule",{value:!0});vn.mapObject=zf=vn.assetWalker=bl=vn.normalizePath=void 0;var UI=10;function VI(e,t,n,o){for(var s,r,i="",a=0,l=new Map(Array.from(t.entries()).map(function(f){return[new RegExp("{"+f[0]+"}","g"),f[1]]}));i!==e;){if(i=e,++a>UI)throw new Error("Maximum replacement recursion exceeded!");try{for(var d=(s=void 0,Wf(l.entries())),c=d.next();!c.done;c=d.next()){var p=c.value;e=e.replace(p[0],p[1])}}catch(f){s={error:f}}finally{try{c&&!c.done&&(r=d.return)&&r.call(d)}finally{if(s)throw s.error}}e=e.replace(/{format(:.*?:.*?)+}/gi,function(f){f=f.slice(8,-1);for(var b=f.split(":"),v=0;v<b.length;v+=2)if(n.has(b[v]))return b[v+1];return""}),e=e.replace(/{lq:(.*?):(.*?)}/gi,function(f){return f.slice(4,-1).split(":")[o?0:1]})}return e}var bl=vn.normalizePath=VI;function WI(e,t){return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies,characters:e.characters.map(function(n){return zI(n,t)}),backgrounds:e.backgrounds.map(function(n){return QI(n,t)}),fonts:e.fonts.map(function(n){return eT(n,t)}),poemStyles:LI(e.poemStyles),poemBackgrounds:e.poemBackgrounds.map(function(n){return tT(n,t)}),sprites:e.sprites.map(function(n){return nT(n,t)}),colors:e.colors}}var zf=vn.assetWalker=WI;function zI(e,t){return{id:e.id,label:e.label,chibi:e.chibi?t(e.chibi,"image"):void 0,heads:JI(e.heads,t),styleGroups:e.styleGroups.map(function(n){return GI(n,t)}),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion}}function GI(e,t){return{id:e.id,styleComponents:e.styleComponents.map(function(n){return XI(n,t)}),styles:e.styles.map(function(n){return qI(n,t)})}}function qI(e,t){return{components:e.components,poses:e.poses.map(function(n){return YI(n,t)})}}function XI(e,t){return mr(mr({},e),{variants:KI(e.variants,t)})}function KI(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=t(e[o],"image"));return n}function YI(e,t){var n,o,s={};try{for(var r=Wf(Object.keys(e.positions)),i=r.next();!i.done;i=r.next()){var a=i.value,l=e.positions[a];s[a]=l.map(function(d){return d.map(function(c){return t(c,"image")})})}}catch(d){n={error:d}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}return{compatibleHeads:e.compatibleHeads,id:e.id,previewOffset:e.previewOffset,previewSize:e.previewSize,renderCommands:e.renderCommands.map(function(d){return d.type==="image"?{type:"image",offset:d.offset,images:d.images.map(function(c){return t(c,"image")})}:d}),size:e.size,scale:e.scale,positions:s}}function JI(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=ZI(e[o],t));return n}function ZI(e,t){return{previewOffset:e.previewOffset,previewSize:e.previewSize,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})})}}function QI(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})}),scaling:e.scaling,sdVersion:e.sdVersion}}function eT(e,t){return{id:e.id,label:e.label,files:e.files.map(function(n){return t(n,"font")})}}function tT(e,t){return{id:e.id,fontColor:e.fontColor,label:e.label,images:e.images.map(function(n){return t(n,"image")}),sdVersion:e.sdVersion}}function nT(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})}),defaultScale:e.defaultScale,hd:e.hd,sdVersion:e.sdVersion}}function oT(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=t(e[o],o));return n}vn.mapObject=oT;var ke={},br=Ee&&Ee.__assign||function(){return br=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},br.apply(this,arguments)};Object.defineProperty(ke,"__esModule",{value:!0});ke.expandId=ke.normalizeStyleComponent=ke.normalizeColor=ke.normalizeBackground=ke.normalizeFont=ke.normalizePoemBackground=ke.normalizePoemStyles=ke.normalizeSprite=ke.mapNormalize=Gf=ke.normalizeContentPack=void 0;var sT=vn;function rT(e,t){var n={paths:t,packId:e.packId},o=Ke("",e.folder||"/",n);return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies||[],characters:jt(iT,e.characters,o,n),backgrounds:jt(Jf,e.backgrounds,o,n),fonts:jt(Yf,e.fonts,o,n),poemStyles:jt(Xf,e.poemStyles,o,n),poemBackgrounds:jt(Kf,e.poemBackgrounds,o,n),sprites:jt(qf,e.sprites,o,n),colors:jt(Zf,e.colors,o,n)}}var Gf=ke.normalizeContentPack=rT;function jt(e,t,n,o){return t?t.map(function(s){return e(s,n,o)}):[]}ke.mapNormalize=jt;function qf(e,t,n){var o,s=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label||e.variants[0][0],variants:e.variants.map(function(r){return Kr(r,s,n)}),defaultScale:e.defaultScale||[1,1],sdVersion:e.sdVersion,hd:(o=e.hd)!==null&&o!==void 0?o:null}}ke.normalizeSprite=qf;function Xf(e){return{label:e.label,defaultFont:e.defaultFont||"Aller",fontSize:e.fontSize!==void 0?e.fontSize:30,letterSpacing:e.letterSpacing!==void 0?e.letterSpacing:1,lineSpacing:e.lineSpacing!==void 0?e.lineSpacing:1.2}}ke.normalizePoemStyles=Xf;function Kf(e,t,n){var o=Ke(t,e.folder,n);return{id:e.id,label:e.label,images:Kr(e.images,o,n),fontColor:e.fontColor||"black",sdVersion:e.sdVersion}}ke.normalizePoemBackground=Kf;function Yf(e,t,n){var o=Ke(t,e.folder,n);return{id:wt(n.packId,e.id?e.id:e.label?e.label:e.files[0]),label:e.label?e.label:e.id?e.id:e.files[0],files:Kr(e.files,o,n)}}ke.normalizeFont=Yf;function Jf(e,t,n){var o,s=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label?e.label:e.variants[0][0],variants:e.variants.map(function(r){return Kr(r,s,n)}),scaling:["none","strech","cover"].includes((o=e.scaling)===null||o===void 0?void 0:o.toLowerCase())?e.scaling.toLowerCase():"cover",sdVersion:e.sdVersion}}ke.normalizeBackground=Jf;function Zf(e){return{label:e.label||e.color,color:e.color}}ke.normalizeColor=Zf;function Kr(e,t,n){return e.map(function(o){return Ke(t,o,n)})}function iT(e,t,n){var o,s,r,i=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label,chibi:e.chibi?Ke(i,e.chibi,n):void 0,heads:cT(e.heads,i,n),defaultScale:(o=e.defaultScale)!==null&&o!==void 0?o:[.8,.8],size:(s=e.size)!==null&&s!==void 0?s:[960,960],hd:(r=e.hd)!==null&&r!==void 0?r:!1,sdVersion:e.sdVersion,styleGroups:jt(lT,e.styleGroups,i,n)}}function lT(e,t,n){var o=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),styleComponents:jt(Qf,e.styleComponents,o,n),styles:e.styles.map(function(s){return aT(s,o,n)})}}function aT(e,t,n){var o=Ke(t,e.folder,n),s={};if(e.components)for(var r in e.components)!e.components.hasOwnProperty(r)||(s[wt(n.packId,r)]=e.components[r]);return{components:s,poses:e.poses.map(function(i){return uT(i,o,n)})}}function Qf(e,t,n){return{id:wt(n.packId,e.id),label:e.label,variants:dT(e.variants,t,n)}}ke.normalizeStyleComponent=Qf;function dT(e,t,n){if(!e)return{};var o={};for(var s in e)!e.hasOwnProperty(s)||(o[s]=Ke(t,e[s],n));return o}function cT(e,t,n){var o={};if(!e)return o;for(var s in e)if(!!e.hasOwnProperty(s)){var r=e[s],i=void 0;if(r instanceof Array)i={variants:vl(r,t,n),previewOffset:[290,70],previewSize:[380,380]};else{var a=Ke(t,r.folder,n);i={variants:vl(r.variants,a,n),previewOffset:r.previewOffset||[290,70],previewSize:r.previewSize||[380,380]}}o[wt(n.packId,s)]=i}return o}function uT(e,t,n){var o,s,r=Ke(t,e.folder,n);return{compatibleHeads:((o=e.compatibleHeads)===null||o===void 0?void 0:o.map(function(i){return wt(n.packId,i)}))||[],id:wt(n.packId,e.id),previewOffset:e.previewOffset||[0,0],previewSize:e.previewSize||[960,960],size:e.size||[960,960],scale:e.scale||.8,positions:sT.mapObject(e.positions||{},function(i){return vl(i,r,n)}),renderCommands:((s=e.renderCommands)===null||s===void 0?void 0:s.map(function(i){return pT(i,t,n)}))||[{type:"head",offset:[0,0]},{type:"pose-part",part:"Left",offset:[0,0]},{type:"pose-part",part:"Right",offset:[0,0]},{type:"pose-part",part:"Variant",offset:[0,0]}]}}function pT(e,t,n){if(e.type==="image"){var o=Ke(t,e.folder,n);return{type:"image",composite:e.composite,offset:e.offset||[0,0],images:eh(e.images,o,n)}}else return br(br({},e),{offset:e.offset||[0,0]})}function vl(e,t,n){return e.map(function(o){return eh(o,t,n)})}function eh(e,t,n){return e.map(function(o){return Ke(t,o,n)})}function fT(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function Ke(e,t,n){if(!t)return e;for(var o in n.paths)if(t.startsWith(o))return n.paths[o]+t.slice(o.length);return fT(t)?t:e+t}function wt(e,t){return t.indexOf(":")!==-1?t:e+":"+t}ke.expandId=wt;var us={},Ys=Ee&&Ee.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},hT=Ee&&Ee.__read||function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,r=[],i;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)r.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r},ji=Ee&&Ee.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(hT(arguments[t]));return e};Object.defineProperty(us,"__esModule",{value:!0});us.expandOrTranslateId=th=us.convert=void 0;var yl=ke;function gT(e,t,n){if(!e.packId)throw new Error("");return{packId:e.packId,packCredits:e.packCredits?[e.packCredits]:[],dependencies:mT(e.id),backgrounds:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],characters:[bT(e,t,n)],colors:[]}}var th=us.convert=gT,nh={"ddlc.monika":xt("dddg.buildin.base.monika","ddlc.monika",{heads:["straight","sideways"],poses:["normal","leaned","old","glitch"],styleGroups:["uniform","old","glitch"]}),"ddlc.natsuki":xt("dddg.buildin.base.natsuki","ddlc.natsuki",{heads:["straight","straight_nsfw","sideways","turnedAway"],poses:["normal","crossed_arms","vomit","glitch"],styleGroups:["uniform","casual","old"],extraPoseAssoc:[["normal_causal","normal"],["crossed_arms_casual","crossed_arms"]],extraHeadAssoc:[["straight_nsfw","straight"]]}),"ddlc.sayori":xt("dddg.buildin.sayori","ddlc.sayori",{heads:["straight","sideways"],poses:["normal","sideways","old","glitch","dead"],styleGroups:["uniform","casual","old","glitch","hanging"],extraPoseAssoc:[["normal_casual","normal"]]}),"ddlc.yuri":xt("dddg.buildin.yuri","ddlc.yuri",{heads:["straight","sideways"],poses:["normal","sideways","stabbing","glitching","dragon"],styleGroups:["uniform","casual","glitch"],extraPoseAssoc:[["normal_causal","normal"],["hairplay_casual","hairplay"]]}),"ddlc.fan.mc1":xt("dddg.buildin.mc_classic","ddlc.fan.mc1",{heads:["straight"],poses:["normal"],styleGroups:[],extraStyleGroupAssoc:[["uniform-yellow","uniform"]]}),"ddlc.fan.mc2":xt("dddg.buildin.mc","ddlc.fan.mc2",{heads:["straight","straight_red"],poses:["normal","crossed_arms","casual","glitching","dragon"],styleGroups:["uniform","casual"],extraPoseAssoc:[["crossed_arms_casual","crossed_arms"],["crossed_arms_red","crossed_arms"],["normal_red","normal"],["casual_red","casual"],["casual_crossed_arms_red","crossed_arms"]],defaultStyleComponents:[{id:"eyes",label:"Eyes",variants:{yellow:"/parts/mc/yellow-eyes{ext}",red:"/parts/mc/red-eyes{ext}"}}]}),"ddlc.fan.mc_chad":xt("dddg.buildin.mc_chad","ddlc.fan.mc_chad",{heads:["straight","straight_closed","straight_red"],poses:["normal","youknowihadto"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal_casual","normal"],["youknowihadto_casual","youknowihadto"],["normal_red","normal"],["youknowihadto_red","youknowihadto"],["normal_casual_red","normal"],["youknowihadto_casual_red","youknowihadto"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/chad/yellow-eyes{ext}",red:"/parts/chad/red-eyes{ext}"}}]}),"ddlc.fan.femc":xt("dddg.buildin.femc","ddlc.fan.femc",{heads:["straight","straight_lh","straight_closed","straight_hetero","straight_hetero_lh"],poses:["normal","crossed_arms"],styleGroups:["uniform","casual","uniform_strict"],extraPoseAssoc:[["casual_normal","normal"],["casual_crossed_arms","crossed_arms"],["uniform_normal","normal"],["uniform_crossed_arms","crossed_arms"],["normal_long_hair","normal"],["crossed_arms_long_hair","crossed_arms"],["casual_normal_long_hair","normal"],["casual_crossed_arms_long_hair","crossed_arms"],["uniform_normal_long_hair","normal"],["uniform_crossed_arms_long_hair","crossed_arms"],["normal_hetero","normal"],["crossed_arms_hetero","crossed_arms"],["casual_normal_hetero","normal"],["casual_crossed_arms_hetero","crossed_arms"],["uniform_normal_hetero","normal"],["uniform_crossed_arms_hetero","crossed_arms"],["normal_long_hair_hetero","normal"],["crossed_arms_long_hair_hetero","crossed_arms"],["casual_normal_long_hair_hetero","normal"],["casual_crossed_arms_long_hair_hetero","crossed_arms"],["uniform_normal_long_hair_hetero","normal"],["uniform_crossed_arms_long_hair_hetero","crossed_arms"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/femc/yellow-eyes{ext}",hetero:"/parts/femc/hetero-eyes{ext}"}},{label:"Hairs",id:"hairs",variants:{sh:"/parts/femc/short-hair{ext}",lh:"/parts/femc/long-hair{ext}"}}]}),"ddlc.fan.amy1":xt("dddg.buildin.amy1","ddlc.fan.amy1",{heads:["straight"],poses:["normal","crossed_arms"],styleGroups:["uniform"]}),"ddlc.fan.amy2":xt("dddg.buildin.amy2","ddlc.fan.amy2",{heads:["straight","straight_closed","straight_red"],poses:["normal","folded_hands_up","folded_hands_down","hands_on_glasses"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal-casual","normal"],["folded_hands_up-casual","folded_hands_up"],["folded_hands_down-casual","folded_hands_down"],["hands_on_glasses-casual","hands_on_glasses"]]})};function mT(e){return[]}function bT(e,t,n){var o={characterId:e.id,packId:e.packId,paths:t};return{id:_n("character",e.id,o),chibi:e.chibi,label:e.name,heads:$T(e.heads,o,n),styleGroups:vT(e,o,n),defaultScale:[.8,.8],size:[960,960],hd:!1}}function vT(e,t,n){var o,s,r=nh[t.characterId],i=[],a=new Map,l=CT(e,t),d=l.length===0?r&&r.defaultStyleComponents?yT(r.defaultStyleComponents,t):[]:l,c=e.poses.map(function(H){return H.style}).filter(function(H,D,$){return $.indexOf(H)===D}),p=new Map(e.styles.map(function(H){return[H.name,H]})),f=function(H){var D,$,x,j,K=p.get(H);if(K&&K.nsfw&&!n)return"continue";var Q=H,le={};try{for(var N=(D=void 0,Ys(d)),oe=N.next();!oe.done;oe=N.next()){var te=oe.value;try{for(var he=(x=void 0,Ys(Object.keys(te.variants))),M=he.next();!M.done;M=he.next()){var ve=M.value,Ue=new RegExp("-"+ve+"\\b");if(Q.match(Ue)){le[te.id]=ve,Q=Q.replace(Ue,"");break}}}catch(Ce){x={error:Ce}}finally{try{M&&!M.done&&(j=he.return)&&j.call(he)}finally{if(x)throw x.error}}}}catch(Ce){D={error:Ce}}finally{try{oe&&!oe.done&&($=N.return)&&$.call(N)}finally{if(D)throw D.error}}Q=_n("styleGroups",Q,t);var Ct=a.get(Q);Ct||(Ct={id:Q,styleComponents:d,styles:[]},a.set(Q,Ct),i.push(Q)),Ct.styles.push({components:le,poses:wT(e.poses.filter(function(Ce){return Ce.style===H}),t,n)})};try{for(var b=Ys(c),v=b.next();!v.done;v=b.next()){var w=v.value;f(w)}}catch(H){o={error:H}}finally{try{v&&!v.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}return i.map(function(H){return a.get(H)})}function yT(e,t){return yl.mapNormalize(yl.normalizeStyleComponent,e,"",{packId:t.packId,paths:t.paths})}function _T(e,t){return e?[{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"},{type:"head",offset:t}]:[{type:"head",offset:t},{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"}]}function wT(e,t,n){return e.map(function(o){return{compatibleHeads:o.compatibleHeads.map(function(s){return _n("heads",s.toString(),t)}),id:_n("poses",o.name,t),renderCommands:_T(o.headInForeground,o.headAnchor),previewOffset:o.offset,previewSize:o.size,size:[960,960],scale:.8,positions:{Static:"static"in o?[[o.static]]:[],Left:"left"in o?Ii(o.left,n):[],Right:"right"in o?Ii(o.right,n):[],Variant:"variant"in o?Ii(o.variant,n):[]}}})}function Ii(e,t){return e.filter(function(n){return!n.nsfw||t}).map(function(n){return[n.img]})}function $T(e,t,n){var o,s,r={};try{for(var i=Ys(Object.keys(e)),a=i.next();!a.done;a=i.next()){var l=a.value,d=e[l];d.nsfw&&!n||(r[_n("heads",l,t)]={previewOffset:d.offset,previewSize:d.size,variants:d.all.filter(function(c){return!c.nsfw||n}).map(function(c){return[c.img]})})}}catch(c){o={error:c}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}return r}function CT(e,t){var n=[],o=[];return Object.keys(e.eyes).length>0&&(Object.keys(e.eyes).forEach(function(s){return o.push(s)}),n.push({label:"Eyes",id:_n("eyes","eyes",t),variants:e.eyes})),Object.keys(e.hairs).length>0&&(Object.keys(e.hairs).forEach(function(s){return o.push(s)}),n.push({label:"Hairs",id:_n("hairs","hairs",t),variants:e.hairs})),n}function Ti(e,t){return new Map(t.map(function(n){return[n,e+":"+n]}))}function xt(e,t,n){return n.extraHeadAssoc?n.extraHeadAssoc=n.extraHeadAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraHeadAssoc=[],n.extraPoseAssoc?n.extraPoseAssoc=n.extraPoseAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraPoseAssoc=[],n.extraStyleGroupAssoc?n.extraStyleGroupAssoc=n.extraStyleGroupAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraStyleGroupAssoc=[],{character:e+":"+t,eyes:e+":eyes",hairs:e+":hair",defaultStyleComponents:n.defaultStyleComponents||[],heads:new Map(ji(Ti(e,n.heads),n.extraHeadAssoc)),poses:new Map(ji(Ti(e,n.poses),n.extraPoseAssoc)),styleGroups:new Map(ji(Ti(e,n.styleGroups),n.extraStyleGroupAssoc))}}function _n(e,t,n){var o=nh[n.characterId];if(o){if(e==="character"||e==="hairs"||e==="eyes")return o[e];var s=o[e].get(t);if(s)return s}return yl.expandId(n.packId,t)}us.expandOrTranslateId=_n;var Oa={};Object.defineProperty(Oa,"__esModule",{value:!0});var oh=Oa.normalizeCharacter=void 0;function PT(e,t){var n=wn("",e.folder||"/",t),o=void 0;return e.chibi&&(o=wn(n,e.chibi,t)),o===void 0&&e.internalId&&(o=(t["/"]||"")+"chibis/"+e.internalId),{id:e.id,packId:e.packId,packCredits:e.packCredits,name:e.name,nsfw:!!e.nsfw,chibi:o,eyes:pu(e.eyes,n,t),hairs:pu(e.hairs,n,t),styles:OT(e.styles),heads:ST(e.heads,n,t),poses:kT(e.poses,n,t)}}oh=Oa.normalizeCharacter=PT;function pu(e,t,n){if(!e)return{};var o={};for(var s in e)!e.hasOwnProperty(s)||(o[s]=wn(t,e[s],n));return o}function ST(e,t,n){var o={};if(!e)return o;for(var s in e)if(!!e.hasOwnProperty(s)){var r=e[s],i=void 0;if(r instanceof Array)i={all:Zo(r,t,n),nsfw:!1,offset:[290,70],size:[380,380]};else{var a=wn(t,r.folder,n);i={all:Zo(r.all,a,n),nsfw:!!r.nsfw,offset:r.offset||[290,70],size:r.size||[380,380]}}o[s]=i}return o}function kT(e,t,n){return e?e.map(function(o){var s=wn(t,o.folder,n),r={compatibleHeads:o.compatibleHeads||[],headAnchor:o.headAnchor||[0,0],headInForeground:!!o.headInForeground,name:o.name,nsfw:!!o.nsfw,style:o.style,offset:[0,0],size:[960,960]};if("static"in o)r.static=wn(s,o.static,n);else if("variant"in o)r.variant=Zo(o.variant,s,n);else if("left"in o)r.left=Zo(o.left,s,n),r.right=Zo(o.right,s,n);else throw new Error("Invalid pose");return r}):[]}function Zo(e,t,n){return e.map(function(o){return typeof o=="string"?{img:wn(t,o,n),nsfw:!1}:{img:wn(t,o.img,n),nsfw:o.nsfw||!1}})}function OT(e){return e?e.map(function(t){return{name:t.name,label:t.label,nsfw:t.nsfw||!1}}):[]}function xT(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function wn(e,t,n){if(!t)return e;for(var o in n)if(t.startsWith(o))return n[o]+t.slice(o.length);return xT(t)?t:e+t}var Qo=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});function fu(e){return e.split("/").slice(0,-1).join("/")+"/"}const hu=new Set(["png","gif","bmp","svg"]);function sh(){return{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}}}const jT={namespaced:!0,state:sh(),mutations:{setContentPacks(e,t){e.contentPacks=t},setCurrentContent(e,t){e.current=t}},actions:{removeContentPacks({commit:e,state:t,dispatch:n},o){const s=JSON.parse(JSON.stringify(t.current)),r=t.contentPacks.filter(i=>!o.has(i.packId));e("setContentPacks",r),e("setCurrentContent",r.reduce((i,a)=>Ks(i,a))),n("panels/fixContentPackRemoval",s,{root:!0})},replaceContentPack(e,t){return Qo(this,arguments,function*({commit:n,state:o},s){debugger;const r=s.processed?s.contentPack:yield vr(s.contentPack);let i=o.contentPacks;const a=i.findIndex(l=>l.packId===s.contentPack.packId);a===-1?i.push(r):i.splice(a,1,r),i=i,n("setContentPacks",i),n("setCurrentContent",i.reduce((l,d)=>Ks(l,d)))})},loadContentPacks(e,t){return Qo(this,arguments,function*({commit:n,state:o},s){typeof s=="string"&&(s=[s]);const r=yield Promise.all(s.map(d=>Qo(this,null,function*(){return _l(d)}))),i=yield Promise.all(r.map(d=>vr(d))),a=new Set(o.contentPacks.map(d=>d.packId));let l=o.current;for(const d of i){for(const c of d.dependencies)if(!a.has(c))throw new Error(`Missing dependency '${c}'. Refusing to install ${d.packId}`);l=Ks(l,d)}return n("setContentPacks",[...o.contentPacks,...i]),n("setCurrentContent",l),r.map(d=>d.packId)})}},getters:{getCharacters({current:e}){const t=new Map;for(const n of e.characters)t.set(n.id,n);return t},getBackgrounds({current:e}){const t=new Map;for(const n of e.backgrounds)t.set(n.id,n);return t}}};function _l(e){return Qo(this,null,function*(){const t=yield fetch(e);if(!t.ok)throw new Error(`Could not load content pack. Server responded with: ${t.statusText}`);let n;try{n=yield t.json()}catch(o){throw new Error("Content pack is not valid json!")}try{const o={"./":fu(e),"/":fu(location.href)+"assets/"};return n.version==="2.0"?Gf(n,o):th(oh(n,o),o,!1)}catch(o){throw new Error("Content pack is not in a valid format!")}})}function vr(e){return Qo(this,null,function*(){const t=new Set((yield mo())?["webp",...hu]:hu),n=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return zf(e,(o,s)=>{var r;const i=bl(o,n,t,!1),a=bl(o,n,t,!0);return{hq:i,lq:a,sourcePack:(r=e.packId)!=null?r:"buildIn"}})})}const IT={namespaced:!0,state:{},mutations:{add(e,{name:t,url:n}){e[t]=n}},actions:{add({state:e,commit:t},{name:n,url:o}){if(e[n])throw new Error(`There is already an uploaded file called "${n}"`);const s="uploads:"+n;return t("add",{name:s,url:o}),kp(s,o),s}}};var TT=Object.defineProperty,ET=Object.defineProperties,BT=Object.getOwnPropertyDescriptors,gu=Object.getOwnPropertySymbols,AT=Object.prototype.hasOwnProperty,DT=Object.prototype.propertyIsEnumerable,mu=(e,t,n)=>t in e?TT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,RT=(e,t)=>{for(var n in t||(t={}))AT.call(t,n)&&mu(e,n,t[n]);if(gu)for(var n of gu(t))DT.call(t,n)&&mu(e,n,t[n]);return e},HT=(e,t)=>ET(e,BT(t)),Ls=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const MT=MI({state:{unsafe:!1},mutations:{setUnsafe(e,t){e.unsafe=t}},actions:{removePacks(e,t){return Ls(this,arguments,function*({dispatch:n,commit:o},{packs:s}){o("setUnsafe",!0),n("content/removeContentPacks",s),o("setUnsafe",!1)})},getSave(e,t){return Ls(this,arguments,function*({state:n},o){const s=yield Jt.getInstance();return JSON.stringify(n,(r,i)=>{if(r!=="ui"&&r!=="lastRender")return r==="uploadUrls"?Object.keys(i):r==="content"&&o?i.contentPacks.filter(a=>{var l,d;return!((l=a.packId)!=null&&l.startsWith("dddg.buildin."))||((d=a.packId)==null?void 0:d.endsWith(".nsfw"))}).map(a=>{var l;let d=(l=a.packId)!=null&&l.startsWith("dddg.uploads.")?a:a.packId;if(a.packId!=null){const c=s.getPack(a.packId);c&&c.repoUrl!=null&&(d+=`;${c.repoUrl}`)}return d}):i},2)})},loadSave(e,t){return Ls(this,arguments,function*({state:n},o){const s=JSON.parse(o),r=s.content;s.ui=HT(RT({},Vf()),{vertical:n.ui.vertical,lqRendering:n.ui.lqRendering,nsfw:r.find(l=>typeof l=="string"&&l.startsWith("dddg.buildin.")&&l.endsWith(".nsfw"))!==void 0,clipboard:n.ui.clipboard,useDarkTheme:n.ui.useDarkTheme,defaultCharacterTalkingZoom:n.ui.defaultCharacterTalkingZoom}),s.uploadUrls={},s.content=sh();const i=yield Jt.getInstance();s.content.contentPacks=[...n.content.contentPacks.filter(l=>{var d;return(d=l.packId)==null?void 0:d.startsWith("dddg.buildin.")}),...(yield Promise.all(r.map(l=>Ls(this,null,function*(){if(typeof l!="string")return l;let d=null,c;l.indexOf(";")>=0?[c,d]=l.split(";"):c=l;const p=n.content.contentPacks.find(v=>v.packId===c);if(p)return p;if(l.startsWith("dddg.buildin.")&&l.endsWith(".nsfw")){const v=yield _l(Ca[l]);return yield vr(v)}d!=null&&!i.hasPack(c)&&(yield i.loadTempPack(d));const f=i.getPack(c);if(!f)return console.warn(`Pack Id ${l} not found!`),null;const b=yield _l(f.dddg2Path||f.dddg1Path);return yield vr(b)})))).filter(l=>l!==null)];let a=s.content.current;for(const l of s.content.contentPacks)a=Ks(a,l);s.content.current=a,this.replaceState(s),ue.fire(new Tr)})}},modules:{ui:FI,panels:zO,content:jT,uploadUrls:IT}}),FT={install(e,t={}){if(!e.config.globalProperties.$store)throw new Error("VuexUndoRedo plugin must be installed after the Vuex plugin.");t.resetStateMutation||(t.resetStateMutation="emptyState"),t.mutations||(t.mutations={});const n=e.config.globalProperties.$store;function o(c,p){let f={};switch(typeof p.payload){case"object":p.payload instanceof Array&&(f=[]),n.commit(`${p.type}`,Object.assign(f,p.payload));break;default:n.commit(`${p.type}`,p.payload)}}function s(c,p){return en(this,null,function*(){return yield c.transaction(()=>{p.forEach(f=>{o(c,f)})})})}function r(c){return en(this,null,function*(){const p=c.data.done.slice(0);c.data.done=[],n.commit(t.resetStateMutation);for(let f=0;f<p.length;++f)yield s(c,p[f])})}const i={};function a(c){if(!i[c]){const p=c.split("/"),f={ignore:v=>!1,combinable:(v,w)=>!1,combinator:(v,w)=>w};let b="";for(const v of p)t.mutations[b+"*"]&&Object.assign(f,t.mutations[b+"*"]),b+=v+"/";t.mutations[c]&&Object.assign(f,t.mutations[c]),i[c]=f}return i[c]}const l={data:Kt({done:[],undone:[],snapshots:[],transactionsSinceSnapshot:0,newMutation:!0,ignoreMutations:t.ignoreMutations||[],currentTransaction:null,transactionQueue:[],initialized:!1}),initialize(){l.initialized||(l.initialized=!0,n.subscribe(c=>{const p=()=>{c.type===t.resetStateMutation||a(c.type).ignore(c)||(l.currentTransaction.push(c),l.newMutation&&(l.data.undone=[]))};l.currentTransaction?p():l.transaction(()=>{p()})}))},redo(){return en(this,null,function*(){if(l.data.undone.length<=0)return;const c=l.data.undone.pop();l.newMutation=!1,yield s(l,c),l.newMutation=!0})},undo(){return en(this,null,function*(){l.data.done.length<=0||(l.data.undone.push(l.data.done.pop()),l.newMutation=!1,yield r(l),l.newMutation=!0)})},clearHistory(){return new Promise((c,p)=>{const f=()=>en(this,null,function*(){l.currentTransaction=[],l.transactionsSinceSnapshot=0,l.data.undone=[],l.data.done=[],c(),l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()()});l.currentTransaction?l.data.transactionQueue.push(f):f()})},transaction(c){return new Promise((p,f)=>{const b=()=>en(this,null,function*(){l.currentTransaction=[],l.transactionsSinceSnapshot++;try{yield c()}catch(v){console.log("Error during transaction!: ",v)}l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()(),p()});l.currentTransaction?l.data.transactionQueue.push(b):b()})}};window.storeHistory=l,e.config.globalProperties.vuexHistory=l,l.initialize()}};qm(Qj).use(MT).use(FT).mount("#main_wrapper");export{Ht as A,Mn as B,Xl as C,Op as D,_s as E,U as F,nx as G,_t as H,Jl as L,Jt as R,qo as S,LT as T,$p as V,ne as _,u as a,G as b,y as c,ee as d,X as e,nm as f,Ge as g,C as h,B as i,Rt as j,q as k,O as l,L as m,pe as n,g as o,ze as p,Re as q,$e as r,E as s,fe as t,ue as u,Te as v,de as w,Kt as x,qt as y,Kl as z};
