import{d as j,u as le,c as L,e as _,r as y,a as b,o as f,w as V,n as ie,b as c,f as T,g as I,t as A,h as Q,i as q,_ as Y,j as K,k as W,F as N,l as ce,m as z,p as ue,q as R,s as se,v as X,T as de,x as $,y as Z,z as pe,A as ne,B as fe,C as ve,D as he,E as me,G as be,H as ge,R as ee,I as ke,V as ye}from"./index-DLKK9bwh.js";const we=["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],Ce={a:["href"],img:["src"]},De=["href","src"],Pe=["http","https"],xe={a:{target:"_blank",rel:"noopener noreferrer"}};function te(p){const e=document.createElement("div"),t=document.createElement("div");t.innerHTML=p;for(const s of Array.from(t.childNodes))for(const o of F(s))e.appendChild(o);return e.innerHTML}const Te=/^(\w+):/;function F(p){if(p.nodeType!==Node.ELEMENT_NODE)return[p];const e=p,t=e.tagName.toLowerCase();if(we.includes(t)){const s=document.createElement(t),o=Array.prototype.slice.call(e.attributes),d=Ce[t]||[];for(const u of o)if(d.includes(u.name)){if(De.includes(u.name)){const h=u.value.match(Te);if(h&&!Pe.includes(h[1]))continue}s.setAttribute(u.name,e.getAttribute(u.name))}const i=xe[t];if(i)for(const u in i)Object.prototype.hasOwnProperty.call(i,u)&&s.setAttribute(u,i[u]);const l=Array.prototype.slice.call(e.childNodes);for(const u of l){const h=F(u);for(const w of h)s.appendChild(w)}return[s]}else{let s=[];s.push(document.createTextNode(`<${t}>`));for(const o of e.childNodes)s=s.concat(F(o));return s.push(document.createTextNode(`</${t}>`)),s}}const Le=["innerHTML"],Ae={key:1},Me={key:2,disabled:""},_e=["title","src"],Se={key:2},Ee=["innerHTML"],Ie=j({__name:"pack-display",props:{selected:{},repo:{},showBack:{type:Boolean}},setup(p){const e=p,t=le(),s=[["reddit","https://reddit.com/u/%1","reddit.png"],["deviantart","https://www.deviantart.com/%1","deviantart.png"],["twitter","https://twitter.com/%1","twitter.svg"],["pixiv","https://www.pixiv.net/users/%1","pixiv.ico"],["patreon","https://www.patreon.com/%1","patreon.png"],["facebook","https://www.facebook.com/%1","facebook.png"],["github","https://github.com/%1","github.png"],["website","%1","website.svg"]],o=L(()=>e.repo.getPack(e.selected)),d=L(()=>o.value.preview.map(r=>`url('${r}')`).join(",")),i=L(()=>o.value.loaded),l=L(()=>!o.value.loaded),u=L(()=>_.supports.autoLoading),h=L(()=>_.supports.localRepo?!o.value.installed:!1),w=L(()=>_.supports.localRepo?o.value.installed:!1),v=L({get(){return _.state.autoAdd.includes(e.selected)},set(r){let a=e.selected;const n=o.value;n.repoUrl!=null&&(a+=`;${n.repoUrl}`),r?_.autoLoadAdd(a):_.autoLoadRemove(a)}}),D=y(!1);function E(r){const a=e.repo.getAuthor(r);return a&&a.currentName!=null?a.currentName:r}function P(r){const a=e.repo.getAuthor(r);return a?s.filter(n=>a[n[0]]).map(n=>{const m=a[n[0]];return{target:n[1].replace("%1",m),platform:n[0][0].toUpperCase()+n[0].slice(1),icon:"icons/"+n[2]}}):[]}async function M(){if(o.value.installed)return;const r={};for(const n of o.value.authors)r[n]={...e.repo.getAuthor(n)};const a=JSON.parse(JSON.stringify(o.value));delete a.autoloading,delete a.online,delete a.loaded,delete a.installed;try{D.value=!0,await _.localRepoInstall(o.value.dddg2Path||o.value.dddg1Path,a,r)}catch(n){ue("Installing pack",n)}finally{D.value=!1}}async function k(){var a;const r=o.value;if(r.installed){r.repoUrl!=null&&!((a=e.repo)!=null&&a.hasPack(r.id,!0))&&await e.repo.loadTempPack(r.repoUrl);try{D.value=!0,await _.localRepoUninstall(r.id)}finally{D.value=!1}}}async function g(){await t.dispatch("removePacks",{packs:new Set([o.value.id])})}async function x(){await t.dispatch("content/loadContentPacks",o.value.dddg2Path||o.value.dddg1Path)}return(r,a)=>(f(),b("div",{class:"pack-display",style:ie({backgroundImage:d.value}),onClick:a[2]||(a[2]=V(()=>{},["stop"]))},[c("header",null,[c("h1",null,[r.showBack?(f(),b("button",{key:0,class:"exit-button",onClick:a[0]||(a[0]=n=>r.$emit("leave",!0))},a[3]||(a[3]=[c("i",{class:"material-icons"},"arrow_back",-1)]))):T("",!0),I(" "+A(o.value.name),1)]),c("h2",null,A(o.value.id),1)]),o.value.disclaimer?(f(),b("section",{key:0,class:"disclaimer",innerHTML:Q(te)(o.value.disclaimer)},null,8,Le)):T("",!0),o.value.source?(f(),b("section",Ae,[q(Y,{to:o.value.source},{default:K(()=>a[4]||(a[4]=[I("Source")])),_:1},8,["to"])])):T("",!0),c("section",null,[l.value?(f(),b("button",{key:0,onClick:x},a[5]||(a[5]=[c("i",{class:"material-icons"},"add",-1),I(" Activate ")]))):T("",!0),i.value?(f(),b("button",{key:1,onClick:g},a[6]||(a[6]=[c("i",{class:"material-icons"},"remove",-1),I(" Deactivate ")]))):T("",!0),D.value?(f(),b("button",Me,"Processing...")):(f(),b(N,{key:3},[h.value?(f(),b("button",{key:0,onClick:M},a[7]||(a[7]=[c("i",{class:"material-icons"},"add",-1),I(" Store locally ")]))):T("",!0),w.value?(f(),b("button",{key:1,onClick:k},a[8]||(a[8]=[c("i",{class:"material-icons"},"remove",-1),I(" Remove locally ")]))):T("",!0)],64)),u.value?(f(),W(ce,{key:4,label:"Load on startup",modelValue:v.value,"onUpdate:modelValue":a[1]||(a[1]=n=>v.value=n)},null,8,["modelValue"])):T("",!0)]),c("section",null,[a[9]||(a[9]=c("h3",null,"Authors",-1)),c("table",null,[c("tbody",null,[(f(!0),b(N,null,z(o.value.authors,n=>(f(),b("tr",{key:n},[c("td",null,A(E(n)),1),c("td",null,[(f(!0),b(N,null,z(P(n),m=>(f(),W(Y,{key:m.target,to:m.target,class:"platform_button"},{default:K(()=>[c("img",{title:m.platform,src:m.icon,height:"32",width:"32",alt:""},null,8,_e)]),_:2},1032,["to"]))),128))])]))),128))])])]),o.value.description?(f(),b("section",Se,[a[10]||(a[10]=c("h3",null,"Credits",-1)),c("p",{innerHTML:Q(te)(o.value.description)},null,8,Ee)])):T("",!0)],4))}}),$e=R(Ie,[["__scopeId","data-v-f92ac414"]]),Ne=["author","character","type","pack","engine"],J=new Map;for(const p of Ne)for(let e=1;e<=p.length;++e){const t=p.slice(0,e);J.set(t,p)}const Be=/\s/;function He(p){const e=[];let t="",s="",o=!1,d=!1;function i(){e.push({type:s||"all",payload:t.toLowerCase()}),t="",s="",d=!1,o=!1}for(const l of p){if(d){t+=l,d=!1;continue}switch(l){case"\\":d=!0;continue;case":":const u=t.toLowerCase();if(!o&&s===""&&J.has(u)){s=J.get(u),t="";continue}break;case'"':o?i():o=!0;continue}!o&&Be.test(l)?t&&i():t+=l}return t&&i(),e}const ae=new Map([["engine",0],["pack",1],["type",2],["character",2],["author",2],["all",3]]);function Oe(p){return Ue(Ve(p))}function Ue(p){return p.sort((e,t)=>ae.get(e.type)-ae.get(t.type)||t.payload.length-e.payload.length)}function Ve(p){const e=new Map;for(const s of p){let o=e.get(s.type);o||(o=[],e.set(s.type,o)),o.push(s)}for(const s of e.keys()){const d=e.get(s).sort((i,l)=>i.payload.localeCompare(l.payload)).filter((i,l,u)=>u[l+1]?!u[l+1].payload.startsWith(i.payload):!0);e.set(s,d.filter((i,l,u)=>!u.find((h,w)=>w!==l&&h.payload.indexOf(i.payload)!==-1)))}const t=Array.from(e.keys()).filter(s=>s!=="all");return e.set("all",(e.get("all")||[]).filter(s=>!t.find(o=>e.get(o).find(d=>d.payload.indexOf(s.payload)!==-1)))),[...e.values()].flatMap(s=>s)}class B{constructor(e){e=e.replace(/[\s-]/g,"").toLowerCase();const t=new Set;for(const[s,o]of B.engines)s.toLowerCase().indexOf(e)>=0&&t.add(o);this.matchingProps=Array.from(t)}get isImpossible(){return this.matchingProps.length===0}match(e){for(const t of this.matchingProps)if(e[t])return!0;return!1}}B.engines=[["Doki Doki Dialog Generator 1","dddg1Path"],["Doki Doki Dialouge Generator 1","dddg1Path"],["DDDG1","dddg1Path"],["Doki Doki Dialog Generator 2","dddg2Path"],["Doki Doki Dialouge Generator 2","dddg2Path"],["DDDG2","dddg2Path"],["Doki Doki Comic Club 2","ddcc2Path"],["DDCC2","ddcc2Path"]].map(([p,e])=>[p.replace(/\s/g,"").toLowerCase(),e]);class re{constructor(e,t){e=e.toLowerCase();const s=new Set;for(const o in t){if(!Object.prototype.hasOwnProperty.call(t,o))continue;const d=t[o],i=Object.keys(d);(o.toLowerCase().indexOf(e)>=0||i.find(l=>d[l].toLowerCase().indexOf(e)>=0))&&s.add(o)}this.matchingAuthors=s}get isImpossible(){return this.matchingAuthors.size===0}match(e){return!!e.authors.find(t=>this.matchingAuthors.has(t))}}class H{constructor(e,t,s){e=e.toLowerCase(),this.matchingCharacters=new Set(H.getUniqueCharacters(s).filter(o=>o.toLowerCase().indexOf(e)>=0))}get isImpossible(){return this.matchingCharacters.size===0}match(e){return!!e.characters.find(t=>this.matchingCharacters.has(t))}static getUniqueCharacters(e){let t=this.uniqueCharacters.get(e);return t||(t=Array.from(new Set(e.flatMap(s=>s.characters))),this.uniqueCharacters.set(e,t)),t}}H.uniqueCharacters=new Map;class O{constructor(e){e=e.toLowerCase(),this.matchingTypes=new Set(O.types.filter(t=>t.toLowerCase().indexOf(e)>=0))}get isImpossible(){return this.matchingTypes.size===0}match(e){return!!e.kind.find(t=>this.matchingTypes.has(t))}}O.types=["Styles","Characters","Expressions","Poses","Backgrounds","Sprites","Misc"];class S{constructor(e,t,s){e=e.toLowerCase(),this.payload=e;const o=S.getTriplets(s);for(let d=0,i=e.length-2;d<i;++d)if(!o.has(e.substr(d,3))){this.isImpossible=!0;return}this.isImpossible=!1}match(e){if(this.isImpossible)return!1;const t=this.payload;return!!(e.id.toLowerCase().indexOf(t)>=0||e.name.toLowerCase().indexOf(t)>=0||e.searchWords.find(s=>s.toLowerCase().indexOf(t)>=0))}static getTriplets(e){let t=this.tripletCache.get(e);if(!t){t=new Set;for(const s of e){S.splitTriplets(s.id,t),S.splitTriplets(s.name,t);for(const o of s.searchWords)S.splitTriplets(o,t)}this.tripletCache.set(e,t)}return t}static splitTriplets(e,t){e=e.toLowerCase();for(let s=0,o=e.length-2;s<o;++s)t.add(e.substr(s,3))}}S.tripletCache=new Map;class G{constructor(e,t,s){this.matchers=G.allMatchers.map(o=>new o(e,t,s)).filter(o=>!o.isImpossible)}get isImpossible(){return this.matchers.length===0}match(e){return!!this.matchers.find(t=>t.match(e))}}G.allMatchers=[B,re,H,O,S];const qe=new Map([["all",G],["author",re],["character",H],["engine",B],["pack",S],["type",O]]);function ze(p,e,t){return p.map(s=>new(qe.get(s.type))(s.payload,e,t))}function je(p,e,t){const s=He(p),o=Oe(s),d=ze(o,e,t);return d.find(i=>i.isImpossible)?[]:t.filter(i=>d.every(l=>l.match(i)))}const Re=["tabindex","onClick","onKeydown"],Ge={key:0},Ke=["onMousedown","onClick"],oe=10,We=j({__name:"pack-list",props:{search:{},repo:{},disabled:{type:Boolean,default:!1}},emits:["selected","select-search-bar"],setup(p,{emit:e}){const t=p,s=e,o=y(null),d=y(null),i=y(null),l=y(""),u=y(!1),h=y(""),w=L(()=>t.repo?t.repo.getPacks():[]),v=L(()=>{const r=g(w.value,t.search);if(l.value&&r.length>0){const a=l.value;let n;if(typeof r[0][a]=="string"?n=(m,C)=>m.name.localeCompare(C.name):r[0][a]instanceof Array&&(n=(m,C)=>m[a].join(", ").localeCompare(C[a].join(", "))),n){if(u.value){const m=n;n=(C,U)=>m(U,C)}r.sort(n)}}return r});function D(){d.value.$el.focus()}function E(r){const a=v.value.findIndex(n=>n.id===h.value);switch(r.key){case"Enter":s("selected",{id:h.value,source:"keyboard"}),r.stopPropagation(),r.preventDefault();break;case"ArrowUp":r.preventDefault(),r.stopPropagation(),a===0?s("select-search-bar"):h.value=v.value[a-1].id;break;case"ArrowDown":r.preventDefault(),r.stopPropagation(),a<v.value.length-1&&(h.value=v.value[a+1].id);break;case"PageUp":{r.preventDefault(),r.stopPropagation();let n=a-oe;n<0&&(n=0),h.value=v.value[n].id;break}case"PageDown":{r.preventDefault(),r.stopPropagation();let n=a+oe;const m=v.value.length-1;n>m&&(n=m),h.value=v.value[n].id;break}}}function P(r,a){switch(r.key){case"Enter":case" ":k(a),r.preventDefault(),r.stopPropagation();break;case"ArrowDown":D(),r.stopPropagation(),r.preventDefault();break;case"ArrowUp":s("select-search-bar"),r.stopPropagation(),r.preventDefault();break}}function M(){if(v.value.length===0){h.value="";return}h.value===""&&(h.value=v.value[0].id),$(()=>{const r=document.querySelector(".list tbody .focused"),a=o.value.offsetHeight-i.value.offsetHeight,n=o.value.scrollTop,m=n+a;if(r){const C=r.offsetTop-i.value.offsetHeight,U=C+r.offsetHeight;U>m?o.value.scrollTop=U-a:C<n&&(o.value.scrollTop=C)}})}function k(r){l.value===r?u.value?(l.value="",u.value=!1):u.value=!0:(l.value=r,u.value=!1)}function g(r,a){return a?je(a,t.repo?t.repo.getAuthors():{},r):[...r]}function x(r){return r.loaded?"Active":r.installed?"Installed":""}return se(()=>h.value,M),(r,a)=>(f(),b("div",{ref_key:"root",ref:o,class:"list"},[c("table",null,[c("thead",null,[c("tr",{ref_key:"header",ref:i},[(f(),b(N,null,z([["name","Pack"],["characters","Character"],["kind","Type"],["authors","Authors"],["state","Status"]],(n,m)=>c("th",{key:m,tabindex:r.disabled?-1:0,onClick:C=>k(n[0]),onKeydown:C=>P(C,n[0])},[c("div",null,[c("div",null,A(n[1]),1),l.value===n[0]?(f(),b("div",Ge,A(u.value?"▼":"▲"),1)):T("",!0)])],40,Re)),64))],512)]),q(de,{name:"tbody-group",key:"list-transition",tag:"tbody",ref_key:"tbody",ref:d,tabindex:r.disabled?-1:0,onKeydown:E,onFocus:M},{default:K(()=>[(f(!0),b(N,null,z(v.value,n=>(f(),b("tr",{key:n.id,class:X({"tbody-group-item":!0,focused:h.value===n.id}),onMousedown:m=>h.value=n.id,onClick:m=>s("selected",{id:n.id,source:"pointer"})},[c("td",null,A(n.name),1),c("td",null,A(n.characters.join(", ")),1),c("td",null,A(n.kind.join(", ")),1),c("td",null,A(n.authors.join(", ")),1),c("td",null,A(x(n)),1)],42,Ke))),128))]),_:1},8,["tabindex"])])],512))}}),Fe=R(We,[["__scopeId","data-v-6da6efa1"]]),Je={class:"search-area"},Xe={class:"search-bar"},Qe=["disabled"],Ye=["disabled"],Ze=250,et=j({__name:"search-bar",props:Z({disabled:{type:Boolean}},{modelValue:{default:""},modelModifiers:{}}),emits:Z(["leave","focus-list"],["update:modelValue"]),setup(p,{expose:e,emit:t}){const s=pe(p,"modelValue"),o=t,d=y(null),i=y(""),l=y(null),u=y("");function h(){const k=d.value;k!=null&&k.focus()}function w(k){k.key==="ArrowDown"&&(o("focus-list"),k.preventDefault(),k.stopPropagation())}function v(){if(u.value===s.value){u.value="";return}i.value=s.value}function D(){l.value!=null&&clearTimeout(l.value),l.value=setTimeout(E,Ze)}function E(){l.value!=null&&clearTimeout(l.value),l.value=null;const k=document.createElement("div");k.innerHTML=i.value,u.value=k.innerText,s.value=k.innerText}se(()=>s.value,v,{immediate:!0});const P=y(!1);function M(){P.value=!1}return ne(()=>{document.body.addEventListener("click",M)}),fe(()=>{document.body.removeEventListener("click",M)}),e({focus:h}),(k,g)=>(f(),b("div",Je,[c("div",Xe,[ve(c("input",{class:"input",ref_key:"input",ref:d,"onUpdate:modelValue":g[0]||(g[0]=x=>i.value=x),disabled:k.disabled,onInput:D,onClick:g[1]||(g[1]=V(()=>{},["stop"])),onKeydown:w},null,40,Qe),[[he,i.value]]),c("button",{class:X({help:!0,toggled:P.value}),disabled:k.disabled,onClick:g[2]||(g[2]=V(x=>P.value=!P.value,["stop"]))},g[5]||(g[5]=[c("i",{class:"material-icons"},"info",-1)]),10,Ye),c("button",{class:"exit-button",onClick:g[3]||(g[3]=x=>o("leave"))},g[6]||(g[6]=[c("i",{class:"material-icons"},"clear",-1)]))]),P.value?(f(),b("div",{key:0,class:"info-area",onClick:g[4]||(g[4]=V(()=>{},["stop"]))},g[7]||(g[7]=[me("<p data-v-5237331b> Enter the text you want to search for. E.g. <code data-v-5237331b>Monika</code></p><p data-v-5237331b> If multiple words are given, each word must be found. E.g. <code data-v-5237331b>Monika Pose</code></p><p data-v-5237331b> To search phrases with spaces, surround them with double quotes. E.g. <code data-v-5237331b>&quot;Monika R63&quot; Pose</code></p><p data-v-5237331b> To limit your search to specific attributes of a pack, you can use the following prefixes: </p><table data-v-5237331b><tbody data-v-5237331b><tr data-v-5237331b><th data-v-5237331b>Prefix</th><th data-v-5237331b>Description</th><th data-v-5237331b>Example</th></tr><tr data-v-5237331b><td data-v-5237331b>Character:</td><td data-v-5237331b></td><td data-v-5237331b><code data-v-5237331b>Character: Monika</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Artist:</td><td data-v-5237331b></td><td data-v-5237331b><code data-v-5237331b>Artist: edave64</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Type:</td><td data-v-5237331b><code data-v-5237331b>Backgrounds</code>, <code data-v-5237331b>Sprites</code>, <code data-v-5237331b>Expressions</code>, <code data-v-5237331b>Styles</code>, <code data-v-5237331b>Poses</code> or <code data-v-5237331b>Characters</code></td><td data-v-5237331b><code data-v-5237331b>Type: Poses</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Engine:</td><td data-v-5237331b><code data-v-5237331b>Doki Doki Dialog Generator</code>, <code data-v-5237331b>DDDG</code> or <code data-v-5237331b>Doki Doki Comic Club</code>, <code data-v-5237331b>DDCC</code></td><td data-v-5237331b><code data-v-5237331b>Engine: DDCC</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Pack:</td><td data-v-5237331b>The pack itself must contain the text</td><td data-v-5237331b><code data-v-5237331b>Pack: Angry</code></td></tr></tbody></table><p data-v-5237331b> Prefixes can be shorted, so <code data-v-5237331b>Character: Monika</code> can be shortend to <code data-v-5237331b>C: Monika</code></p>",6)]))):T("",!0)]))}}),tt=R(et,[["__scopeId","data-v-5237331b"]]),at={key:1,class:"ask-download"},ot={key:1,class:"page fly-right"},st=j({__name:"single-box",emits:["leave"],setup(p,{expose:e,emit:t}){const s=t,o=y(null),d=y(null),i=y(null),l=y(""),u=y([]),h=y({}),w=y(null),v=y(null),D=L(()=>l.value.endsWith(".json")&&(l.value.startsWith("http://")||l.value.startsWith("https://")));function E(a){v.value=null,l.value=a}function P(a){v.value=null,a&&x()}function M(a){a.key==="Escape"&&(v.value="",$(()=>{o.value.focus()}))}function k({id:a,source:n}){v.value=a,n==="keyboard"&&$(()=>{i.value.focus()})}function g(){$(()=>{d.value&&d.value.focus()})}function x(){$(()=>{o.value&&o.value.focus()})}async function r(){try{const n=await(await ee.getInstance()).loadTempPack(l.value);l.value="",n!=null&&(v.value=n)}catch(a){ke.fire(new ye(a,"Error while loading external pack")),console.error(a)}}return be(x),ne(x),ge("Initializing repo list",async()=>{const a=await ee.getInstance();w.value=a,u.value=a.getPacks(),h.value=a.getAuthors()}),e({setSearch:E}),(a,n)=>(f(),b("div",{class:"pages",onKeydown:M},[v.value?(f(),b("div",ot,[q($e,{ref_key:"dialog",ref:i,class:"pack-display",repo:w.value,selected:v.value,"show-back":"",onLeave:P},null,8,["repo","selected"])])):(f(),b("div",{key:0,class:X(["page fly-left",{blured:v.value}])},[q(tt,{class:"search-bar",ref_key:"searchBar",ref:o,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=m=>l.value=m),disabled:!!v.value,onFocusList:g,onLeave:n[1]||(n[1]=m=>s("leave"))},null,8,["modelValue","disabled"]),D.value?(f(),b("div",at,[I(" Do you want to download the pack from '"+A(l.value)+"'? ",1),c("button",{onClick:r},"Add package")])):(f(),W(Fe,{key:0,class:"list",ref_key:"list",ref:d,search:l.value,repo:w.value,disabled:!!v.value,onSelected:k,onSelectSearchBar:n[2]||(n[2]=m=>o.value.focus())},null,8,["search","repo","disabled"]))],2))],32))}}),rt=R(st,[["__scopeId","data-v-239086b9"]]);export{rt as default};
