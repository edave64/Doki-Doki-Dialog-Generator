const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./single-box-pt0tHbtb.js","./single-box-g7pxxkyq.css","./expression-builder-Eo7CZxHL.js","./expression-builder-CStVRu5x.css"])))=>i.map(i=>d[i]);
var Eh=Object.defineProperty;var Dh=(t,e,n)=>e in t?Eh(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var B=(t,e,n)=>Dh(t,typeof e!="symbol"?e+"":e,n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();/**
* @vue/shared v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function ta(t){const e=Object.create(null);for(const n of t.split(","))e[n]=1;return n=>n in e}const Me={},so=[],Gt=()=>{},Lh=()=>!1,vr=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),na=t=>t.startsWith("onUpdate:"),tt=Object.assign,oa=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},Nh=Object.prototype.hasOwnProperty,Ee=(t,e)=>Nh.call(t,e),ve=Array.isArray,ro=t=>So(t)==="[object Map]",xo=t=>So(t)==="[object Set]",su=t=>So(t)==="[object Date]",Fh=t=>So(t)==="[object RegExp]",xe=t=>typeof t=="function",Je=t=>typeof t=="string",Bt=t=>typeof t=="symbol",Ve=t=>t!==null&&typeof t=="object",Vd=t=>(Ve(t)||xe(t))&&xe(t.then)&&xe(t.catch),Ud=Object.prototype.toString,So=t=>Ud.call(t),Hh=t=>So(t).slice(8,-1),Wd=t=>So(t)==="[object Object]",sa=t=>Je(t)&&t!=="NaN"&&t[0]!=="-"&&""+parseInt(t,10)===t,Yo=ta(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),br=t=>{const e=Object.create(null);return n=>e[n]||(e[n]=t(n))},Vh=/-(\w)/g,on=br(t=>t.replace(Vh,(e,n)=>n?n.toUpperCase():"")),Uh=/\B([A-Z])/g,rn=br(t=>t.replace(Uh,"-$1").toLowerCase()),qd=br(t=>t.charAt(0).toUpperCase()+t.slice(1)),Hr=br(t=>t?`on${qd(t)}`:""),gt=(t,e)=>!Object.is(t,e),io=(t,...e)=>{for(let n=0;n<t.length;n++)t[n](...e)},zd=(t,e,n,o=!1)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,writable:o,value:n})},Fs=t=>{const e=parseFloat(t);return isNaN(e)?t:e},Wh=t=>{const e=Je(t)?Number(t):NaN;return isNaN(e)?t:e};let ru;const mr=()=>ru||(ru=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function et(t){if(ve(t)){const e={};for(let n=0;n<t.length;n++){const o=t[n],s=Je(o)?Xh(o):et(o);if(s)for(const r in s)e[r]=s[r]}return e}else if(Je(t)||Ve(t))return t}const qh=/;(?![^(]*\))/g,zh=/:([^]+)/,Gh=/\/\*[^]*?\*\//g;function Xh(t){const e={};return t.replace(Gh,"").split(qh).forEach(n=>{if(n){const o=n.split(zh);o.length>1&&(e[o[0].trim()]=o[1].trim())}}),e}function Le(t){let e="";if(Je(t))e=t;else if(ve(t))for(let n=0;n<t.length;n++){const o=Le(t[n]);o&&(e+=o+" ")}else if(Ve(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const Yh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",Kh=ta(Yh);function Gd(t){return!!t||t===""}function Jh(t,e){if(t.length!==e.length)return!1;let n=!0;for(let o=0;n&&o<t.length;o++)n=vs(t[o],e[o]);return n}function vs(t,e){if(t===e)return!0;let n=su(t),o=su(e);if(n||o)return n&&o?t.getTime()===e.getTime():!1;if(n=Bt(t),o=Bt(e),n||o)return t===e;if(n=ve(t),o=ve(e),n||o)return n&&o?Jh(t,e):!1;if(n=Ve(t),o=Ve(e),n||o){if(!n||!o)return!1;const s=Object.keys(t).length,r=Object.keys(e).length;if(s!==r)return!1;for(const i in t){const l=t.hasOwnProperty(i),a=e.hasOwnProperty(i);if(l&&!a||!l&&a||!vs(t[i],e[i]))return!1}}return String(t)===String(e)}function ra(t,e){return t.findIndex(n=>vs(n,e))}const Xd=t=>!!(t&&t.__v_isRef===!0),Te=t=>Je(t)?t:t==null?"":ve(t)||Ve(t)&&(t.toString===Ud||!xe(t.toString))?Xd(t)?Te(t.value):JSON.stringify(t,Yd,2):String(t),Yd=(t,e)=>Xd(e)?Yd(t,e.value):ro(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((n,[o,s],r)=>(n[Vr(o,r)+" =>"]=s,n),{})}:xo(e)?{[`Set(${e.size})`]:[...e.values()].map(n=>Vr(n))}:Bt(e)?Vr(e):Ve(e)&&!ve(e)&&!Wd(e)?String(e):e,Vr=(t,e="")=>{var n;return Bt(t)?`Symbol(${(n=t.description)!=null?n:e})`:t};/**
* @vue/reactivity v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let ft;class Kd{constructor(e=!1){this.detached=e,this._active=!0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=ft,!e&&ft&&(this.index=(ft.scopes||(ft.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].pause();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,n;if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].resume();for(e=0,n=this.effects.length;e<n;e++)this.effects[e].resume()}}run(e){if(this._active){const n=ft;try{return ft=this,e()}finally{ft=n}}}on(){ft=this}off(){ft=this.parent}stop(e){if(this._active){this._active=!1;let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(this.effects.length=0,n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.cleanups.length=0,this.scopes){for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0}}}function ia(t){return new Kd(t)}function Jd(){return ft}function Zh(t,e=!1){ft&&ft.cleanups.push(t)}let We;const Ur=new WeakSet;class Zd{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,ft&&ft.active&&ft.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Ur.has(this)&&(Ur.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||ef(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,iu(this),tf(this);const e=We,n=At;We=this,At=!0;try{return this.fn()}finally{nf(this),We=e,At=n,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)ua(e);this.deps=this.depsTail=void 0,iu(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Ur.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Cl(this)&&this.run()}get dirty(){return Cl(this)}}let Qd=0,Ko,Jo;function ef(t,e=!1){if(t.flags|=8,e){t.next=Jo,Jo=t;return}t.next=Ko,Ko=t}function la(){Qd++}function aa(){if(--Qd>0)return;if(Jo){let e=Jo;for(Jo=void 0;e;){const n=e.next;e.next=void 0,e.flags&=-9,e=n}}let t;for(;Ko;){let e=Ko;for(Ko=void 0;e;){const n=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(o){t||(t=o)}e=n}}if(t)throw t}function tf(t){for(let e=t.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function nf(t){let e,n=t.depsTail,o=n;for(;o;){const s=o.prevDep;o.version===-1?(o===n&&(n=s),ua(o),Qh(o)):e=o,o.dep.activeLink=o.prevActiveLink,o.prevActiveLink=void 0,o=s}t.deps=e,t.depsTail=n}function Cl(t){for(let e=t.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(of(e.dep.computed)||e.dep.version!==e.version))return!0;return!!t._dirty}function of(t){if(t.flags&4&&!(t.flags&16)||(t.flags&=-17,t.globalVersion===is))return;t.globalVersion=is;const e=t.dep;if(t.flags|=2,e.version>0&&!t.isSSR&&t.deps&&!Cl(t)){t.flags&=-3;return}const n=We,o=At;We=t,At=!0;try{tf(t);const s=t.fn(t._value);(e.version===0||gt(s,t._value))&&(t._value=s,e.version++)}catch(s){throw e.version++,s}finally{We=n,At=o,nf(t),t.flags&=-3}}function ua(t,e=!1){const{dep:n,prevSub:o,nextSub:s}=t;if(o&&(o.nextSub=s,t.prevSub=void 0),s&&(s.prevSub=o,t.nextSub=void 0),n.subs===t&&(n.subs=o,!o&&n.computed)){n.computed.flags&=-5;for(let r=n.computed.deps;r;r=r.nextDep)ua(r,!0)}!e&&!--n.sc&&n.map&&n.map.delete(n.key)}function Qh(t){const{prevDep:e,nextDep:n}=t;e&&(e.nextDep=n,t.prevDep=void 0),n&&(n.prevDep=e,t.nextDep=void 0)}let At=!0;const sf=[];function Cn(){sf.push(At),At=!1}function xn(){const t=sf.pop();At=t===void 0?!0:t}function iu(t){const{cleanup:e}=t;if(t.cleanup=void 0,e){const n=We;We=void 0;try{e()}finally{We=n}}}let is=0;class eg{constructor(e,n){this.sub=e,this.dep=n,this.version=n.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class yr{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0}track(e){if(!We||!At||We===this.computed)return;let n=this.activeLink;if(n===void 0||n.sub!==We)n=this.activeLink=new eg(We,this),We.deps?(n.prevDep=We.depsTail,We.depsTail.nextDep=n,We.depsTail=n):We.deps=We.depsTail=n,rf(n);else if(n.version===-1&&(n.version=this.version,n.nextDep)){const o=n.nextDep;o.prevDep=n.prevDep,n.prevDep&&(n.prevDep.nextDep=o),n.prevDep=We.depsTail,n.nextDep=void 0,We.depsTail.nextDep=n,We.depsTail=n,We.deps===n&&(We.deps=o)}return n}trigger(e){this.version++,is++,this.notify(e)}notify(e){la();try{for(let n=this.subs;n;n=n.prevSub)n.sub.notify()&&n.sub.dep.notify()}finally{aa()}}}function rf(t){if(t.dep.sc++,t.sub.flags&4){const e=t.dep.computed;if(e&&!t.dep.subs){e.flags|=20;for(let o=e.deps;o;o=o.nextDep)rf(o)}const n=t.dep.subs;n!==t&&(t.prevSub=n,n&&(n.nextSub=t)),t.dep.subs=t}}const Hs=new WeakMap,Mn=Symbol(""),xl=Symbol(""),ls=Symbol("");function at(t,e,n){if(At&&We){let o=Hs.get(t);o||Hs.set(t,o=new Map);let s=o.get(n);s||(o.set(n,s=new yr),s.map=o,s.key=n),s.track()}}function Zt(t,e,n,o,s,r){const i=Hs.get(t);if(!i){is++;return}const l=a=>{a&&a.trigger()};if(la(),e==="clear")i.forEach(l);else{const a=ve(t),u=a&&sa(n);if(a&&n==="length"){const c=Number(o);i.forEach((d,g)=>{(g==="length"||g===ls||!Bt(g)&&g>=c)&&l(d)})}else switch((n!==void 0||i.has(void 0))&&l(i.get(n)),u&&l(i.get(ls)),e){case"add":a?u&&l(i.get("length")):(l(i.get(Mn)),ro(t)&&l(i.get(xl)));break;case"delete":a||(l(i.get(Mn)),ro(t)&&l(i.get(xl)));break;case"set":ro(t)&&l(i.get(Mn));break}}aa()}function tg(t,e){const n=Hs.get(t);return n&&n.get(e)}function qn(t){const e=Re(t);return e===t?e:(at(e,"iterate",ls),Tt(t)?e:e.map(ut))}function wr(t){return at(t=Re(t),"iterate",ls),t}const ng={__proto__:null,[Symbol.iterator](){return Wr(this,Symbol.iterator,ut)},concat(...t){return qn(this).concat(...t.map(e=>ve(e)?qn(e):e))},entries(){return Wr(this,"entries",t=>(t[1]=ut(t[1]),t))},every(t,e){return Yt(this,"every",t,e,void 0,arguments)},filter(t,e){return Yt(this,"filter",t,e,n=>n.map(ut),arguments)},find(t,e){return Yt(this,"find",t,e,ut,arguments)},findIndex(t,e){return Yt(this,"findIndex",t,e,void 0,arguments)},findLast(t,e){return Yt(this,"findLast",t,e,ut,arguments)},findLastIndex(t,e){return Yt(this,"findLastIndex",t,e,void 0,arguments)},forEach(t,e){return Yt(this,"forEach",t,e,void 0,arguments)},includes(...t){return qr(this,"includes",t)},indexOf(...t){return qr(this,"indexOf",t)},join(t){return qn(this).join(t)},lastIndexOf(...t){return qr(this,"lastIndexOf",t)},map(t,e){return Yt(this,"map",t,e,void 0,arguments)},pop(){return Ro(this,"pop")},push(...t){return Ro(this,"push",t)},reduce(t,...e){return lu(this,"reduce",t,e)},reduceRight(t,...e){return lu(this,"reduceRight",t,e)},shift(){return Ro(this,"shift")},some(t,e){return Yt(this,"some",t,e,void 0,arguments)},splice(...t){return Ro(this,"splice",t)},toReversed(){return qn(this).toReversed()},toSorted(t){return qn(this).toSorted(t)},toSpliced(...t){return qn(this).toSpliced(...t)},unshift(...t){return Ro(this,"unshift",t)},values(){return Wr(this,"values",ut)}};function Wr(t,e,n){const o=wr(t),s=o[e]();return o!==t&&!Tt(t)&&(s._next=s.next,s.next=()=>{const r=s._next();return r.value&&(r.value=n(r.value)),r}),s}const og=Array.prototype;function Yt(t,e,n,o,s,r){const i=wr(t),l=i!==t&&!Tt(t),a=i[e];if(a!==og[e]){const d=a.apply(t,r);return l?ut(d):d}let u=n;i!==t&&(l?u=function(d,g){return n.call(this,ut(d),g,t)}:n.length>2&&(u=function(d,g){return n.call(this,d,g,t)}));const c=a.call(i,u,o);return l&&s?s(c):c}function lu(t,e,n,o){const s=wr(t);let r=n;return s!==t&&(Tt(t)?n.length>3&&(r=function(i,l,a){return n.call(this,i,l,a,t)}):r=function(i,l,a){return n.call(this,i,ut(l),a,t)}),s[e](r,...o)}function qr(t,e,n){const o=Re(t);at(o,"iterate",ls);const s=o[e](...n);return(s===-1||s===!1)&&fa(n[0])?(n[0]=Re(n[0]),o[e](...n)):s}function Ro(t,e,n=[]){Cn(),la();const o=Re(t)[e].apply(t,n);return aa(),xn(),o}const sg=ta("__proto__,__v_isRef,__isVue"),lf=new Set(Object.getOwnPropertyNames(Symbol).filter(t=>t!=="arguments"&&t!=="caller").map(t=>Symbol[t]).filter(Bt));function rg(t){Bt(t)||(t=String(t));const e=Re(this);return at(e,"has",t),e.hasOwnProperty(t)}class af{constructor(e=!1,n=!1){this._isReadonly=e,this._isShallow=n}get(e,n,o){if(n==="__v_skip")return e.__v_skip;const s=this._isReadonly,r=this._isShallow;if(n==="__v_isReactive")return!s;if(n==="__v_isReadonly")return s;if(n==="__v_isShallow")return r;if(n==="__v_raw")return o===(s?r?gg:ff:r?df:cf).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(o)?e:void 0;const i=ve(e);if(!s){let a;if(i&&(a=ng[n]))return a;if(n==="hasOwnProperty")return rg}const l=Reflect.get(e,n,ye(e)?e:o);return(Bt(n)?lf.has(n):sg(n))||(s||at(e,"get",n),r)?l:ye(l)?i&&sa(n)?l:l.value:Ve(l)?s?pf(l):sn(l):l}}class uf extends af{constructor(e=!1){super(!1,e)}set(e,n,o,s){let r=e[n];if(!this._isShallow){const a=Dn(r);if(!Tt(o)&&!Dn(o)&&(r=Re(r),o=Re(o)),!ve(e)&&ye(r)&&!ye(o))return a?!1:(r.value=o,!0)}const i=ve(e)&&sa(n)?Number(n)<e.length:Ee(e,n),l=Reflect.set(e,n,o,ye(e)?e:s);return e===Re(s)&&(i?gt(o,r)&&Zt(e,"set",n,o):Zt(e,"add",n,o)),l}deleteProperty(e,n){const o=Ee(e,n);e[n];const s=Reflect.deleteProperty(e,n);return s&&o&&Zt(e,"delete",n,void 0),s}has(e,n){const o=Reflect.has(e,n);return(!Bt(n)||!lf.has(n))&&at(e,"has",n),o}ownKeys(e){return at(e,"iterate",ve(e)?"length":Mn),Reflect.ownKeys(e)}}class ig extends af{constructor(e=!1){super(!0,e)}set(e,n){return!0}deleteProperty(e,n){return!0}}const lg=new uf,ag=new ig,ug=new uf(!0);const Sl=t=>t,Ss=t=>Reflect.getPrototypeOf(t);function cg(t,e,n){return function(...o){const s=this.__v_raw,r=Re(s),i=ro(r),l=t==="entries"||t===Symbol.iterator&&i,a=t==="keys"&&i,u=s[t](...o),c=n?Sl:e?_l:ut;return!e&&at(r,"iterate",a?xl:Mn),{next(){const{value:d,done:g}=u.next();return g?{value:d,done:g}:{value:l?[c(d[0]),c(d[1])]:c(d),done:g}},[Symbol.iterator](){return this}}}}function _s(t){return function(...e){return t==="delete"?!1:t==="clear"?void 0:this}}function dg(t,e){const n={get(s){const r=this.__v_raw,i=Re(r),l=Re(s);t||(gt(s,l)&&at(i,"get",s),at(i,"get",l));const{has:a}=Ss(i),u=e?Sl:t?_l:ut;if(a.call(i,s))return u(r.get(s));if(a.call(i,l))return u(r.get(l));r!==i&&r.get(s)},get size(){const s=this.__v_raw;return!t&&at(Re(s),"iterate",Mn),Reflect.get(s,"size",s)},has(s){const r=this.__v_raw,i=Re(r),l=Re(s);return t||(gt(s,l)&&at(i,"has",s),at(i,"has",l)),s===l?r.has(s):r.has(s)||r.has(l)},forEach(s,r){const i=this,l=i.__v_raw,a=Re(l),u=e?Sl:t?_l:ut;return!t&&at(a,"iterate",Mn),l.forEach((c,d)=>s.call(r,u(c),u(d),i))}};return tt(n,t?{add:_s("add"),set:_s("set"),delete:_s("delete"),clear:_s("clear")}:{add(s){!e&&!Tt(s)&&!Dn(s)&&(s=Re(s));const r=Re(this);return Ss(r).has.call(r,s)||(r.add(s),Zt(r,"add",s,s)),this},set(s,r){!e&&!Tt(r)&&!Dn(r)&&(r=Re(r));const i=Re(this),{has:l,get:a}=Ss(i);let u=l.call(i,s);u||(s=Re(s),u=l.call(i,s));const c=a.call(i,s);return i.set(s,r),u?gt(r,c)&&Zt(i,"set",s,r):Zt(i,"add",s,r),this},delete(s){const r=Re(this),{has:i,get:l}=Ss(r);let a=i.call(r,s);a||(s=Re(s),a=i.call(r,s)),l&&l.call(r,s);const u=r.delete(s);return a&&Zt(r,"delete",s,void 0),u},clear(){const s=Re(this),r=s.size!==0,i=s.clear();return r&&Zt(s,"clear",void 0,void 0),i}}),["keys","values","entries",Symbol.iterator].forEach(s=>{n[s]=cg(s,t,e)}),n}function ca(t,e){const n=dg(t,e);return(o,s,r)=>s==="__v_isReactive"?!t:s==="__v_isReadonly"?t:s==="__v_raw"?o:Reflect.get(Ee(n,s)&&s in o?n:o,s,r)}const fg={get:ca(!1,!1)},pg={get:ca(!1,!0)},hg={get:ca(!0,!1)};const cf=new WeakMap,df=new WeakMap,ff=new WeakMap,gg=new WeakMap;function vg(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function bg(t){return t.__v_skip||!Object.isExtensible(t)?0:vg(Hh(t))}function sn(t){return Dn(t)?t:da(t,!1,lg,fg,cf)}function mg(t){return da(t,!1,ug,pg,df)}function pf(t){return da(t,!0,ag,hg,ff)}function da(t,e,n,o,s){if(!Ve(t)||t.__v_raw&&!(e&&t.__v_isReactive))return t;const r=s.get(t);if(r)return r;const i=bg(t);if(i===0)return t;const l=new Proxy(t,i===2?o:n);return s.set(t,l),l}function bn(t){return Dn(t)?bn(t.__v_raw):!!(t&&t.__v_isReactive)}function Dn(t){return!!(t&&t.__v_isReadonly)}function Tt(t){return!!(t&&t.__v_isShallow)}function fa(t){return t?!!t.__v_raw:!1}function Re(t){const e=t&&t.__v_raw;return e?Re(e):t}function as(t){return!Ee(t,"__v_skip")&&Object.isExtensible(t)&&zd(t,"__v_skip",!0),t}const ut=t=>Ve(t)?sn(t):t,_l=t=>Ve(t)?pf(t):t;function ye(t){return t?t.__v_isRef===!0:!1}function q(t){return hf(t,!1)}function yg(t){return hf(t,!0)}function hf(t,e){return ye(t)?t:new wg(t,e)}class wg{constructor(e,n){this.dep=new yr,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=n?e:Re(e),this._value=n?e:ut(e),this.__v_isShallow=n}get value(){return this.dep.track(),this._value}set value(e){const n=this._rawValue,o=this.__v_isShallow||Tt(e)||Dn(e);e=o?e:Re(e),gt(e,n)&&(this._rawValue=e,this._value=o?e:ut(e),this.dep.trigger())}}function ie(t){return ye(t)?t.value:t}const kg={get:(t,e,n)=>e==="__v_raw"?t:ie(Reflect.get(t,e,n)),set:(t,e,n,o)=>{const s=t[e];return ye(s)&&!ye(n)?(s.value=n,!0):Reflect.set(t,e,n,o)}};function gf(t){return bn(t)?t:new Proxy(t,kg)}class Cg{constructor(e){this.__v_isRef=!0,this._value=void 0;const n=this.dep=new yr,{get:o,set:s}=e(n.track.bind(n),n.trigger.bind(n));this._get=o,this._set=s}get value(){return this._value=this._get()}set value(e){this._set(e)}}function xg(t){return new Cg(t)}function Sg(t){const e=ve(t)?new Array(t.length):{};for(const n in t)e[n]=Pg(t,n);return e}class _g{constructor(e,n,o){this._object=e,this._key=n,this._defaultValue=o,this.__v_isRef=!0,this._value=void 0}get value(){const e=this._object[this._key];return this._value=e===void 0?this._defaultValue:e}set value(e){this._object[this._key]=e}get dep(){return tg(Re(this._object),this._key)}}function Pg(t,e,n){const o=t[e];return ye(o)?o:new _g(t,e,n)}class Og{constructor(e,n,o){this.fn=e,this.setter=n,this._value=void 0,this.dep=new yr(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=is-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!n,this.isSSR=o}notify(){if(this.flags|=16,!(this.flags&8)&&We!==this)return ef(this,!0),!0}get value(){const e=this.dep.track();return of(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function Ig(t,e,n=!1){let o,s;return xe(t)?o=t:(o=t.get,s=t.set),new Og(o,s,n)}const Ps={},Vs=new WeakMap;let $n;function Tg(t,e=!1,n=$n){if(n){let o=Vs.get(n);o||Vs.set(n,o=[]),o.push(t)}}function jg(t,e,n=Me){const{immediate:o,deep:s,once:r,scheduler:i,augmentJob:l,call:a}=n,u=f=>s?f:Tt(f)||s===!1||s===0?Qt(f,1):Qt(f);let c,d,g,b,_=!1,w=!1;if(ye(t)?(d=()=>t.value,_=Tt(t)):bn(t)?(d=()=>u(t),_=!0):ve(t)?(w=!0,_=t.some(f=>bn(f)||Tt(f)),d=()=>t.map(f=>{if(ye(f))return f.value;if(bn(f))return u(f);if(xe(f))return a?a(f,2):f()})):xe(t)?e?d=a?()=>a(t,2):t:d=()=>{if(g){Cn();try{g()}finally{xn()}}const f=$n;$n=c;try{return a?a(t,3,[b]):t(b)}finally{$n=f}}:d=Gt,e&&s){const f=d,C=s===!0?1/0:s;d=()=>Qt(f(),C)}const P=Jd(),y=()=>{c.stop(),P&&P.active&&oa(P.effects,c)};if(r&&e){const f=e;e=(...C)=>{f(...C),y()}}let h=w?new Array(t.length).fill(Ps):Ps;const v=f=>{if(!(!(c.flags&1)||!c.dirty&&!f))if(e){const C=c.run();if(s||_||(w?C.some((T,$)=>gt(T,h[$])):gt(C,h))){g&&g();const T=$n;$n=c;try{const $=[C,h===Ps?void 0:w&&h[0]===Ps?[]:h,b];a?a(e,3,$):e(...$),h=C}finally{$n=T}}}else c.run()};return l&&l(v),c=new Zd(d),c.scheduler=i?()=>i(v,!1):v,b=f=>Tg(f,!1,c),g=c.onStop=()=>{const f=Vs.get(c);if(f){if(a)a(f,4);else for(const C of f)C();Vs.delete(c)}},e?o?v(!0):h=c.run():i?i(v.bind(null,!0),!0):c.run(),y.pause=c.pause.bind(c),y.resume=c.resume.bind(c),y.stop=y,y}function Qt(t,e=1/0,n){if(e<=0||!Ve(t)||t.__v_skip||(n=n||new Set,n.has(t)))return t;if(n.add(t),e--,ye(t))Qt(t.value,e,n);else if(ve(t))for(let o=0;o<t.length;o++)Qt(t[o],e,n);else if(xo(t)||ro(t))t.forEach(o=>{Qt(o,e,n)});else if(Wd(t)){for(const o in t)Qt(t[o],e,n);for(const o of Object.getOwnPropertySymbols(t))Object.prototype.propertyIsEnumerable.call(t,o)&&Qt(t[o],e,n)}return t}/**
* @vue/runtime-core v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function bs(t,e,n,o){try{return o?t(...o):t()}catch(s){ms(s,e,n)}}function Et(t,e,n,o){if(xe(t)){const s=bs(t,e,n,o);return s&&Vd(s)&&s.catch(r=>{ms(r,e,n)}),s}if(ve(t)){const s=[];for(let r=0;r<t.length;r++)s.push(Et(t[r],e,n,o));return s}}function ms(t,e,n,o=!0){const s=e?e.vnode:null,{errorHandler:r,throwUnhandledErrorInProduction:i}=e&&e.appContext.config||Me;if(e){let l=e.parent;const a=e.proxy,u=`https://vuejs.org/error-reference/#runtime-${n}`;for(;l;){const c=l.ec;if(c){for(let d=0;d<c.length;d++)if(c[d](t,a,u)===!1)return}l=l.parent}if(r){Cn(),bs(r,null,10,[t,a,u]),xn();return}}$g(t,n,s,o,i)}function $g(t,e,n,o=!0,s=!1){if(s)throw t;console.error(t)}const pt=[];let Ut=-1;const lo=[];let hn=null,Zn=0;const vf=Promise.resolve();let Us=null;function tn(t){const e=Us||vf;return t?e.then(this?t.bind(this):t):e}function Rg(t){let e=Ut+1,n=pt.length;for(;e<n;){const o=e+n>>>1,s=pt[o],r=us(s);r<t||r===t&&s.flags&2?e=o+1:n=o}return e}function pa(t){if(!(t.flags&1)){const e=us(t),n=pt[pt.length-1];!n||!(t.flags&2)&&e>=us(n)?pt.push(t):pt.splice(Rg(e),0,t),t.flags|=1,bf()}}function bf(){Us||(Us=vf.then(yf))}function Ag(t){ve(t)?lo.push(...t):hn&&t.id===-1?hn.splice(Zn+1,0,t):t.flags&1||(lo.push(t),t.flags|=1),bf()}function au(t,e,n=Ut+1){for(;n<pt.length;n++){const o=pt[n];if(o&&o.flags&2){if(t&&o.id!==t.uid)continue;pt.splice(n,1),n--,o.flags&4&&(o.flags&=-2),o(),o.flags&4||(o.flags&=-2)}}}function mf(t){if(lo.length){const e=[...new Set(lo)].sort((n,o)=>us(n)-us(o));if(lo.length=0,hn){hn.push(...e);return}for(hn=e,Zn=0;Zn<hn.length;Zn++){const n=hn[Zn];n.flags&4&&(n.flags&=-2),n.flags&8||n(),n.flags&=-2}hn=null,Zn=0}}const us=t=>t.id==null?t.flags&2?-1:1/0:t.id;function yf(t){try{for(Ut=0;Ut<pt.length;Ut++){const e=pt[Ut];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),bs(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;Ut<pt.length;Ut++){const e=pt[Ut];e&&(e.flags&=-2)}Ut=-1,pt.length=0,mf(),Us=null,(pt.length||lo.length)&&yf()}}let rt=null,wf=null;function Ws(t){const e=rt;return rt=t,wf=t&&t.type.__scopeId||null,e}function te(t,e=rt,n){if(!e||t._n)return t;const o=(...s)=>{o._d&&wu(-1);const r=Ws(e);let i;try{i=t(...s)}finally{Ws(r),o._d&&wu(1)}return i};return o._n=!0,o._c=!0,o._d=!0,o}function Ie(t,e){if(rt===null)return t;const n=_r(rt),o=t.dirs||(t.dirs=[]);for(let s=0;s<e.length;s++){let[r,i,l,a=Me]=e[s];r&&(xe(r)&&(r={mounted:r,updated:r}),r.deep&&Qt(i),o.push({dir:r,instance:n,value:i,oldValue:void 0,arg:l,modifiers:a}))}return t}function Pn(t,e,n,o){const s=t.dirs,r=e&&e.dirs;for(let i=0;i<s.length;i++){const l=s[i];r&&(l.oldValue=r[i].value);let a=l.dir[o];a&&(Cn(),Et(a,n,8,[t.el,l,t,e]),xn())}}const kf=Symbol("_vte"),Mg=t=>t.__isTeleport,Zo=t=>t&&(t.disabled||t.disabled===""),uu=t=>t&&(t.defer||t.defer===""),cu=t=>typeof SVGElement<"u"&&t instanceof SVGElement,du=t=>typeof MathMLElement=="function"&&t instanceof MathMLElement,Pl=(t,e)=>{const n=t&&t.to;return Je(n)?e?e(n):null:n},Cf={name:"Teleport",__isTeleport:!0,process(t,e,n,o,s,r,i,l,a,u){const{mc:c,pc:d,pbc:g,o:{insert:b,querySelector:_,createText:w,createComment:P}}=u,y=Zo(e.props);let{shapeFlag:h,children:v,dynamicChildren:f}=e;if(t==null){const C=e.el=w(""),T=e.anchor=w("");b(C,n,o),b(T,n,o);const $=(x,I)=>{h&16&&(s&&s.isCE&&(s.ce._teleportTarget=x),c(v,x,I,s,r,i,l,a))},m=()=>{const x=e.target=Pl(e.props,_),I=Sf(x,e,w,b);x&&(i!=="svg"&&cu(x)?i="svg":i!=="mathml"&&du(x)&&(i="mathml"),y||($(x,I),As(e,!1)))};y&&($(n,T),As(e,!0)),uu(e.props)?nt(()=>{m(),e.el.__isMounted=!0},r):m()}else{if(uu(e.props)&&!t.el.__isMounted){nt(()=>{Cf.process(t,e,n,o,s,r,i,l,a,u),delete t.el.__isMounted},r);return}e.el=t.el,e.targetStart=t.targetStart;const C=e.anchor=t.anchor,T=e.target=t.target,$=e.targetAnchor=t.targetAnchor,m=Zo(t.props),x=m?n:T,I=m?C:$;if(i==="svg"||cu(T)?i="svg":(i==="mathml"||du(T))&&(i="mathml"),f?(g(t.dynamicChildren,f,x,s,r,i,l),ya(t,e,!0)):a||d(t,e,x,I,s,r,i,l,!1),y)m?e.props&&t.props&&e.props.to!==t.props.to&&(e.props.to=t.props.to):Os(e,n,C,u,1);else if((e.props&&e.props.to)!==(t.props&&t.props.to)){const E=e.target=Pl(e.props,_);E&&Os(e,E,null,u,0)}else m&&Os(e,T,$,u,1);As(e,y)}},remove(t,e,n,{um:o,o:{remove:s}},r){const{shapeFlag:i,children:l,anchor:a,targetStart:u,targetAnchor:c,target:d,props:g}=t;if(d&&(s(u),s(c)),r&&s(a),i&16){const b=r||!Zo(g);for(let _=0;_<l.length;_++){const w=l[_];o(w,e,n,b,!!w.dynamicChildren)}}},move:Os,hydrate:Bg};function Os(t,e,n,{o:{insert:o},m:s},r=2){r===0&&o(t.targetAnchor,e,n);const{el:i,anchor:l,shapeFlag:a,children:u,props:c}=t,d=r===2;if(d&&o(i,e,n),(!d||Zo(c))&&a&16)for(let g=0;g<u.length;g++)s(u[g],e,n,2);d&&o(l,e,n)}function Bg(t,e,n,o,s,r,{o:{nextSibling:i,parentNode:l,querySelector:a,insert:u,createText:c}},d){const g=e.target=Pl(e.props,a);if(g){const b=Zo(e.props),_=g._lpa||g.firstChild;if(e.shapeFlag&16)if(b)e.anchor=d(i(t),e,l(t),n,o,s,r),e.targetStart=_,e.targetAnchor=_&&i(_);else{e.anchor=i(t);let w=_;for(;w;){if(w&&w.nodeType===8){if(w.data==="teleport start anchor")e.targetStart=w;else if(w.data==="teleport anchor"){e.targetAnchor=w,g._lpa=e.targetAnchor&&i(e.targetAnchor);break}}w=i(w)}e.targetAnchor||Sf(g,e,c,u),d(_&&i(_),e,g,n,o,s,r)}As(e,b)}return e.anchor&&i(e.anchor)}const xf=Cf;function As(t,e){const n=t.ctx;if(n&&n.ut){let o,s;for(e?(o=t.el,s=t.anchor):(o=t.targetStart,s=t.targetAnchor);o&&o!==s;)o.nodeType===1&&o.setAttribute("data-v-owner",n.uid),o=o.nextSibling;n.ut()}}function Sf(t,e,n,o){const s=e.targetStart=n(""),r=e.targetAnchor=n("");return s[kf]=r,t&&(o(s,t),o(r,t)),r}const zn=Symbol("_leaveCb"),Is=Symbol("_enterCb");function Eg(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Dt(()=>{t.isMounted=!0}),ba(()=>{t.isUnmounting=!0}),t}const _t=[Function,Array],Dg={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:_t,onEnter:_t,onAfterEnter:_t,onEnterCancelled:_t,onBeforeLeave:_t,onLeave:_t,onAfterLeave:_t,onLeaveCancelled:_t,onBeforeAppear:_t,onAppear:_t,onAfterAppear:_t,onAppearCancelled:_t};function Lg(t,e){const{leavingVNodes:n}=t;let o=n.get(e.type);return o||(o=Object.create(null),n.set(e.type,o)),o}function Ol(t,e,n,o,s){const{appear:r,mode:i,persisted:l=!1,onBeforeEnter:a,onEnter:u,onAfterEnter:c,onEnterCancelled:d,onBeforeLeave:g,onLeave:b,onAfterLeave:_,onLeaveCancelled:w,onBeforeAppear:P,onAppear:y,onAfterAppear:h,onAppearCancelled:v}=e,f=String(t.key),C=Lg(n,t),T=(x,I)=>{x&&Et(x,o,9,I)},$=(x,I)=>{const E=I[1];T(x,I),ve(x)?x.every(L=>L.length<=1)&&E():x.length<=1&&E()},m={mode:i,persisted:l,beforeEnter(x){let I=a;if(!n.isMounted)if(r)I=P||a;else return;x[zn]&&x[zn](!0);const E=C[f];E&&Rn(t,E)&&E.el[zn]&&E.el[zn](),T(I,[x])},enter(x){let I=u,E=c,L=d;if(!n.isMounted)if(r)I=y||u,E=h||c,L=v||d;else return;let H=!1;const V=x[Is]=ae=>{H||(H=!0,ae?T(L,[x]):T(E,[x]),m.delayedLeave&&m.delayedLeave(),x[Is]=void 0)};I?$(I,[x,V]):V()},leave(x,I){const E=String(t.key);if(x[Is]&&x[Is](!0),n.isUnmounting)return I();T(g,[x]);let L=!1;const H=x[zn]=V=>{L||(L=!0,I(),V?T(w,[x]):T(_,[x]),x[zn]=void 0,C[E]===t&&delete C[E])};C[E]=t,b?$(b,[x,H]):H()},clone(x){return Ol(x,e,n,o)}};return m}function uo(t,e){t.shapeFlag&6&&t.component?(t.transition=e,uo(t.component.subTree,e)):t.shapeFlag&128?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function _f(t,e=!1,n){let o=[],s=0;for(let r=0;r<t.length;r++){let i=t[r];const l=n==null?i.key:String(n)+String(i.key!=null?i.key:r);i.type===ce?(i.patchFlag&128&&s++,o=o.concat(_f(i.children,e,l))):(e||i.type!==Xt)&&o.push(l!=null?wn(i,{key:l}):i)}if(s>1)for(let r=0;r<o.length;r++)o[r].patchFlag=-2;return o}/*! #__NO_SIDE_EFFECTS__ */function Oe(t,e){return xe(t)?tt({name:t.name},e,{setup:t}):t}function ha(t){t.ids=[t.ids[0]+t.ids[2]+++"-",0,0]}function Ng(t){const e=Sr(),n=yg(null);if(e){const s=e.refs===Me?e.refs={}:e.refs;Object.defineProperty(s,t,{enumerable:!0,get:()=>n.value,set:r=>n.value=r})}return n}function qs(t,e,n,o,s=!1){if(ve(t)){t.forEach((_,w)=>qs(_,e&&(ve(e)?e[w]:e),n,o,s));return}if(Bn(o)&&!s){o.shapeFlag&512&&o.type.__asyncResolved&&o.component.subTree.component&&qs(t,e,n,o.component.subTree);return}const r=o.shapeFlag&4?_r(o.component):o.el,i=s?null:r,{i:l,r:a}=t,u=e&&e.r,c=l.refs===Me?l.refs={}:l.refs,d=l.setupState,g=Re(d),b=d===Me?()=>!1:_=>Ee(g,_);if(u!=null&&u!==a&&(Je(u)?(c[u]=null,b(u)&&(d[u]=null)):ye(u)&&(u.value=null)),xe(a))bs(a,l,12,[i,c]);else{const _=Je(a),w=ye(a);if(_||w){const P=()=>{if(t.f){const y=_?b(a)?d[a]:c[a]:a.value;s?ve(y)&&oa(y,r):ve(y)?y.includes(r)||y.push(r):_?(c[a]=[r],b(a)&&(d[a]=c[a])):(a.value=[r],t.k&&(c[t.k]=a.value))}else _?(c[a]=i,b(a)&&(d[a]=i)):w&&(a.value=i,t.k&&(c[t.k]=i))};i?(P.id=-1,nt(P,n)):P()}}}const fu=t=>t.nodeType===8;mr().requestIdleCallback;mr().cancelIdleCallback;function Fg(t,e){if(fu(t)&&t.data==="["){let n=1,o=t.nextSibling;for(;o;){if(o.nodeType===1){if(e(o)===!1)break}else if(fu(o))if(o.data==="]"){if(--n===0)break}else o.data==="["&&n++;o=o.nextSibling}}else e(t)}const Bn=t=>!!t.type.__asyncLoader;/*! #__NO_SIDE_EFFECTS__ */function pu(t){xe(t)&&(t={loader:t});const{loader:e,loadingComponent:n,errorComponent:o,delay:s=200,hydrate:r,timeout:i,suspensible:l=!0,onError:a}=t;let u=null,c,d=0;const g=()=>(d++,u=null,b()),b=()=>{let _;return u||(_=u=e().catch(w=>{if(w=w instanceof Error?w:new Error(String(w)),a)return new Promise((P,y)=>{a(w,()=>P(g()),()=>y(w),d+1)});throw w}).then(w=>_!==u&&u?u:(w&&(w.__esModule||w[Symbol.toStringTag]==="Module")&&(w=w.default),c=w,w)))};return Oe({name:"AsyncComponentWrapper",__asyncLoader:b,__asyncHydrate(_,w,P){const y=r?()=>{const h=r(P,v=>Fg(_,v));h&&(w.bum||(w.bum=[])).push(h)}:P;c?y():b().then(()=>!w.isUnmounted&&y())},get __asyncResolved(){return c},setup(){const _=st;if(ha(_),c)return()=>zr(c,_);const w=v=>{u=null,ms(v,_,13,!o)};if(l&&_.suspense||fo)return b().then(v=>()=>zr(v,_)).catch(v=>(w(v),()=>o?F(o,{error:v}):null));const P=q(!1),y=q(),h=q(!!s);return s&&setTimeout(()=>{h.value=!1},s),i!=null&&setTimeout(()=>{if(!P.value&&!y.value){const v=new Error(`Async component timed out after ${i}ms.`);w(v),y.value=v}},i),b().then(()=>{P.value=!0,_.parent&&ga(_.parent.vnode)&&_.parent.update()}).catch(v=>{w(v),y.value=v}),()=>{if(P.value&&c)return zr(c,_);if(y.value&&o)return F(o,{error:y.value});if(n&&!h.value)return F(n)}}})}function zr(t,e){const{ref:n,props:o,children:s,ce:r}=e.vnode,i=F(t,o,s);return i.ref=n,i.ce=r,delete e.vnode.ce,i}const ga=t=>t.type.__isKeepAlive,Hg={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(t,{slots:e}){const n=Sr(),o=n.ctx;if(!o.renderer)return()=>{const h=e.default&&e.default();return h&&h.length===1?h[0]:h};const s=new Map,r=new Set;let i=null;const l=n.suspense,{renderer:{p:a,m:u,um:c,o:{createElement:d}}}=o,g=d("div");o.activate=(h,v,f,C,T)=>{const $=h.component;u(h,v,f,0,l),a($.vnode,h,v,f,$,l,C,h.slotScopeIds,T),nt(()=>{$.isDeactivated=!1,$.a&&io($.a);const m=h.props&&h.props.onVnodeMounted;m&&Pt(m,$.parent,h)},l)},o.deactivate=h=>{const v=h.component;Xs(v.m),Xs(v.a),u(h,g,null,1,l),nt(()=>{v.da&&io(v.da);const f=h.props&&h.props.onVnodeUnmounted;f&&Pt(f,v.parent,h),v.isDeactivated=!0},l)};function b(h){Gr(h),c(h,n,l,!0)}function _(h){s.forEach((v,f)=>{const C=xu(v.type);C&&!h(C)&&w(f)})}function w(h){const v=s.get(h);v&&(!i||!Rn(v,i))?b(v):i&&Gr(i),s.delete(h),r.delete(h)}Fe(()=>[t.include,t.exclude],([h,v])=>{h&&_(f=>Uo(h,f)),v&&_(f=>!Uo(v,f))},{flush:"post",deep:!0});let P=null;const y=()=>{P!=null&&(Ys(n.subTree.type)?nt(()=>{s.set(P,Ts(n.subTree))},n.subTree.suspense):s.set(P,Ts(n.subTree)))};return Dt(y),va(y),ba(()=>{s.forEach(h=>{const{subTree:v,suspense:f}=n,C=Ts(v);if(h.type===C.type&&h.key===C.key){Gr(C);const T=C.component.da;T&&nt(T,f);return}b(h)})}),()=>{if(P=null,!e.default)return i=null;const h=e.default(),v=h[0];if(h.length>1)return i=null,h;if(!co(v)||!(v.shapeFlag&4)&&!(v.shapeFlag&128))return i=null,v;let f=Ts(v);if(f.type===Xt)return i=null,f;const C=f.type,T=xu(Bn(f)?f.type.__asyncResolved||{}:C),{include:$,exclude:m,max:x}=t;if($&&(!T||!Uo($,T))||m&&T&&Uo(m,T))return f.shapeFlag&=-257,i=f,v;const I=f.key==null?C:f.key,E=s.get(I);return f.el&&(f=wn(f),v.shapeFlag&128&&(v.ssContent=f)),P=I,E?(f.el=E.el,f.component=E.component,f.transition&&uo(f,f.transition),f.shapeFlag|=512,r.delete(I),r.add(I)):(r.add(I),x&&r.size>parseInt(x,10)&&w(r.values().next().value)),f.shapeFlag|=256,i=f,Ys(v.type)?v:f}}},Vg=Hg;function Uo(t,e){return ve(t)?t.some(n=>Uo(n,e)):Je(t)?t.split(",").includes(e):Fh(t)?(t.lastIndex=0,t.test(e)):!1}function Pf(t,e){If(t,"a",e)}function Of(t,e){If(t,"da",e)}function If(t,e,n=st){const o=t.__wdc||(t.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return t()});if(kr(e,o,n),n){let s=n.parent;for(;s&&s.parent;)ga(s.parent.vnode)&&Ug(o,e,n,s),s=s.parent}}function Ug(t,e,n,o){const s=kr(e,t,o,!0);Sn(()=>{oa(o[e],s)},n)}function Gr(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function Ts(t){return t.shapeFlag&128?t.ssContent:t}function kr(t,e,n=st,o=!1){if(n){const s=n[t]||(n[t]=[]),r=e.__weh||(e.__weh=(...i)=>{Cn();const l=ws(n),a=Et(e,n,t,i);return l(),xn(),a});return o?s.unshift(r):s.push(r),r}}const ln=t=>(e,n=st)=>{(!fo||t==="sp")&&kr(t,(...o)=>e(...o),n)},Wg=ln("bm"),Dt=ln("m"),qg=ln("bu"),va=ln("u"),ba=ln("bum"),Sn=ln("um"),zg=ln("sp"),Gg=ln("rtg"),Xg=ln("rtc");function Yg(t,e=st){kr("ec",t,e)}const Kg=Symbol.for("v-ndc");function qe(t,e,n,o){let s;const r=n,i=ve(t);if(i||Je(t)){const l=i&&bn(t);let a=!1;l&&(a=!Tt(t),t=wr(t)),s=new Array(t.length);for(let u=0,c=t.length;u<c;u++)s[u]=e(a?ut(t[u]):t[u],u,void 0,r)}else if(typeof t=="number"){s=new Array(t);for(let l=0;l<t;l++)s[l]=e(l+1,l,void 0,r)}else if(Ve(t))if(t[Symbol.iterator])s=Array.from(t,(l,a)=>e(l,a,void 0,r));else{const l=Object.keys(t);s=new Array(l.length);for(let a=0,u=l.length;a<u;a++){const c=l[a];s[a]=e(t[c],c,a,r)}}else s=[];return s}function qt(t,e,n={},o,s){if(rt.ce||rt.parent&&Bn(rt.parent)&&rt.parent.ce)return e!=="default"&&(n.name=e),j(),pe(ce,null,[F("slot",n,o)],64);let r=t[e];r&&r._c&&(r._d=!1),j();const i=r&&Tf(r(n)),l=n.key||i&&i.key,a=pe(ce,{key:(l&&!Bt(l)?l:`_${e}`)+""},i||[],i&&t._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function Tf(t){return t.some(e=>co(e)?!(e.type===Xt||e.type===ce&&!Tf(e.children)):!0)?t:null}const Il=t=>t?Yf(t)?_r(t):Il(t.parent):null,Qo=tt(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Il(t.parent),$root:t=>Il(t.root),$host:t=>t.ce,$emit:t=>t.emit,$options:t=>$f(t),$forceUpdate:t=>t.f||(t.f=()=>{pa(t.update)}),$nextTick:t=>t.n||(t.n=tn.bind(t.proxy)),$watch:t=>yv.bind(t)}),Xr=(t,e)=>t!==Me&&!t.__isScriptSetup&&Ee(t,e),Jg={get({_:t},e){if(e==="__v_skip")return!0;const{ctx:n,setupState:o,data:s,props:r,accessCache:i,type:l,appContext:a}=t;let u;if(e[0]!=="$"){const b=i[e];if(b!==void 0)switch(b){case 1:return o[e];case 2:return s[e];case 4:return n[e];case 3:return r[e]}else{if(Xr(o,e))return i[e]=1,o[e];if(s!==Me&&Ee(s,e))return i[e]=2,s[e];if((u=t.propsOptions[0])&&Ee(u,e))return i[e]=3,r[e];if(n!==Me&&Ee(n,e))return i[e]=4,n[e];Tl&&(i[e]=0)}}const c=Qo[e];let d,g;if(c)return e==="$attrs"&&at(t.attrs,"get",""),c(t);if((d=l.__cssModules)&&(d=d[e]))return d;if(n!==Me&&Ee(n,e))return i[e]=4,n[e];if(g=a.config.globalProperties,Ee(g,e))return g[e]},set({_:t},e,n){const{data:o,setupState:s,ctx:r}=t;return Xr(s,e)?(s[e]=n,!0):o!==Me&&Ee(o,e)?(o[e]=n,!0):Ee(t.props,e)||e[0]==="$"&&e.slice(1)in t?!1:(r[e]=n,!0)},has({_:{data:t,setupState:e,accessCache:n,ctx:o,appContext:s,propsOptions:r}},i){let l;return!!n[i]||t!==Me&&Ee(t,i)||Xr(e,i)||(l=r[0])&&Ee(l,i)||Ee(o,i)||Ee(Qo,i)||Ee(s.config.globalProperties,i)},defineProperty(t,e,n){return n.get!=null?t._.accessCache[e]=0:Ee(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function zs(t){return ve(t)?t.reduce((e,n)=>(e[n]=null,e),{}):t}function Ln(t,e){return!t||!e?t||e:ve(t)&&ve(e)?t.concat(e):tt({},zs(t),zs(e))}let Tl=!0;function Zg(t){const e=$f(t),n=t.proxy,o=t.ctx;Tl=!1,e.beforeCreate&&hu(e.beforeCreate,t,"bc");const{data:s,computed:r,methods:i,watch:l,provide:a,inject:u,created:c,beforeMount:d,mounted:g,beforeUpdate:b,updated:_,activated:w,deactivated:P,beforeDestroy:y,beforeUnmount:h,destroyed:v,unmounted:f,render:C,renderTracked:T,renderTriggered:$,errorCaptured:m,serverPrefetch:x,expose:I,inheritAttrs:E,components:L,directives:H,filters:V}=e;if(u&&Qg(u,o,null),i)for(const A in i){const S=i[A];xe(S)&&(o[A]=S.bind(n))}if(s){const A=s.call(n,n);Ve(A)&&(t.data=sn(A))}if(Tl=!0,r)for(const A in r){const S=r[A],R=xe(S)?S.bind(n,n):xe(S.get)?S.get.bind(n,n):Gt,se=!xe(S)&&xe(S.set)?S.set.bind(n):Gt,U=D({get:R,set:se});Object.defineProperty(o,A,{enumerable:!0,configurable:!0,get:()=>U.value,set:ne=>U.value=ne})}if(l)for(const A in l)jf(l[A],o,n,A);if(a){const A=xe(a)?a.call(n):a;Reflect.ownKeys(A).forEach(S=>{Af(S,A[S])})}c&&hu(c,t,"c");function ue(A,S){ve(S)?S.forEach(R=>A(R.bind(n))):S&&A(S.bind(n))}if(ue(Wg,d),ue(Dt,g),ue(qg,b),ue(va,_),ue(Pf,w),ue(Of,P),ue(Yg,m),ue(Xg,T),ue(Gg,$),ue(ba,h),ue(Sn,f),ue(zg,x),ve(I))if(I.length){const A=t.exposed||(t.exposed={});I.forEach(S=>{Object.defineProperty(A,S,{get:()=>n[S],set:R=>n[S]=R})})}else t.exposed||(t.exposed={});C&&t.render===Gt&&(t.render=C),E!=null&&(t.inheritAttrs=E),L&&(t.components=L),H&&(t.directives=H),x&&ha(t)}function Qg(t,e,n=Gt){ve(t)&&(t=jl(t));for(const o in t){const s=t[o];let r;Ve(s)?"default"in s?r=kt(s.from||o,s.default,!0):r=kt(s.from||o):r=kt(s),ye(r)?Object.defineProperty(e,o,{enumerable:!0,configurable:!0,get:()=>r.value,set:i=>r.value=i}):e[o]=r}}function hu(t,e,n){Et(ve(t)?t.map(o=>o.bind(e.proxy)):t.bind(e.proxy),e,n)}function jf(t,e,n,o){let s=o.includes(".")?Wf(n,o):()=>n[o];if(Je(t)){const r=e[t];xe(r)&&Fe(s,r)}else if(xe(t))Fe(s,t.bind(n));else if(Ve(t))if(ve(t))t.forEach(r=>jf(r,e,n,o));else{const r=xe(t.handler)?t.handler.bind(n):e[t.handler];xe(r)&&Fe(s,r,t)}}function $f(t){const e=t.type,{mixins:n,extends:o}=e,{mixins:s,optionsCache:r,config:{optionMergeStrategies:i}}=t.appContext,l=r.get(e);let a;return l?a=l:!s.length&&!n&&!o?a=e:(a={},s.length&&s.forEach(u=>Gs(a,u,i,!0)),Gs(a,e,i)),Ve(e)&&r.set(e,a),a}function Gs(t,e,n,o=!1){const{mixins:s,extends:r}=e;r&&Gs(t,r,n,!0),s&&s.forEach(i=>Gs(t,i,n,!0));for(const i in e)if(!(o&&i==="expose")){const l=ev[i]||n&&n[i];t[i]=l?l(t[i],e[i]):e[i]}return t}const ev={data:gu,props:vu,emits:vu,methods:Wo,computed:Wo,beforeCreate:ct,created:ct,beforeMount:ct,mounted:ct,beforeUpdate:ct,updated:ct,beforeDestroy:ct,beforeUnmount:ct,destroyed:ct,unmounted:ct,activated:ct,deactivated:ct,errorCaptured:ct,serverPrefetch:ct,components:Wo,directives:Wo,watch:nv,provide:gu,inject:tv};function gu(t,e){return e?t?function(){return tt(xe(t)?t.call(this,this):t,xe(e)?e.call(this,this):e)}:e:t}function tv(t,e){return Wo(jl(t),jl(e))}function jl(t){if(ve(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function ct(t,e){return t?[...new Set([].concat(t,e))]:e}function Wo(t,e){return t?tt(Object.create(null),t,e):e}function vu(t,e){return t?ve(t)&&ve(e)?[...new Set([...t,...e])]:tt(Object.create(null),zs(t),zs(e??{})):e}function nv(t,e){if(!t)return e;if(!e)return t;const n=tt(Object.create(null),t);for(const o in e)n[o]=ct(t[o],e[o]);return n}function Rf(){return{app:null,config:{isNativeTag:Lh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let ov=0;function sv(t,e){return function(o,s=null){xe(o)||(o=tt({},o)),s!=null&&!Ve(s)&&(s=null);const r=Rf(),i=new WeakSet,l=[];let a=!1;const u=r.app={_uid:ov++,_component:o,_props:s,_container:null,_context:r,_instance:null,version:Nv,get config(){return r.config},set config(c){},use(c,...d){return i.has(c)||(c&&xe(c.install)?(i.add(c),c.install(u,...d)):xe(c)&&(i.add(c),c(u,...d))),u},mixin(c){return r.mixins.includes(c)||r.mixins.push(c),u},component(c,d){return d?(r.components[c]=d,u):r.components[c]},directive(c,d){return d?(r.directives[c]=d,u):r.directives[c]},mount(c,d,g){if(!a){const b=u._ceVNode||F(o,s);return b.appContext=r,g===!0?g="svg":g===!1&&(g=void 0),t(b,c,g),a=!0,u._container=c,c.__vue_app__=u,_r(b.component)}},onUnmount(c){l.push(c)},unmount(){a&&(Et(l,u._instance,16),t(null,u._container),delete u._container.__vue_app__)},provide(c,d){return r.provides[c]=d,u},runWithContext(c){const d=En;En=u;try{return c()}finally{En=d}}};return u}}let En=null;function Af(t,e){if(st){let n=st.provides;const o=st.parent&&st.parent.provides;o===n&&(n=st.provides=Object.create(o)),n[t]=e}}function kt(t,e,n=!1){const o=st||rt;if(o||En){const s=En?En._context.provides:o?o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides:void 0;if(s&&t in s)return s[t];if(arguments.length>1)return n&&xe(e)?e.call(o&&o.proxy):e}}function rv(){return!!(st||rt||En)}const Mf={},Bf=()=>Object.create(Mf),Ef=t=>Object.getPrototypeOf(t)===Mf;function iv(t,e,n,o=!1){const s={},r=Bf();t.propsDefaults=Object.create(null),Df(t,e,s,r);for(const i in t.propsOptions[0])i in s||(s[i]=void 0);n?t.props=o?s:mg(s):t.type.props?t.props=s:t.props=r,t.attrs=r}function lv(t,e,n,o){const{props:s,attrs:r,vnode:{patchFlag:i}}=t,l=Re(s),[a]=t.propsOptions;let u=!1;if((o||i>0)&&!(i&16)){if(i&8){const c=t.vnode.dynamicProps;for(let d=0;d<c.length;d++){let g=c[d];if(Cr(t.emitsOptions,g))continue;const b=e[g];if(a)if(Ee(r,g))b!==r[g]&&(r[g]=b,u=!0);else{const _=on(g);s[_]=$l(a,l,_,b,t,!1)}else b!==r[g]&&(r[g]=b,u=!0)}}}else{Df(t,e,s,r)&&(u=!0);let c;for(const d in l)(!e||!Ee(e,d)&&((c=rn(d))===d||!Ee(e,c)))&&(a?n&&(n[d]!==void 0||n[c]!==void 0)&&(s[d]=$l(a,l,d,void 0,t,!0)):delete s[d]);if(r!==l)for(const d in r)(!e||!Ee(e,d))&&(delete r[d],u=!0)}u&&Zt(t.attrs,"set","")}function Df(t,e,n,o){const[s,r]=t.propsOptions;let i=!1,l;if(e)for(let a in e){if(Yo(a))continue;const u=e[a];let c;s&&Ee(s,c=on(a))?!r||!r.includes(c)?n[c]=u:(l||(l={}))[c]=u:Cr(t.emitsOptions,a)||(!(a in o)||u!==o[a])&&(o[a]=u,i=!0)}if(r){const a=Re(n),u=l||Me;for(let c=0;c<r.length;c++){const d=r[c];n[d]=$l(s,a,d,u[d],t,!Ee(u,d))}}return i}function $l(t,e,n,o,s,r){const i=t[n];if(i!=null){const l=Ee(i,"default");if(l&&o===void 0){const a=i.default;if(i.type!==Function&&!i.skipFactory&&xe(a)){const{propsDefaults:u}=s;if(n in u)o=u[n];else{const c=ws(s);o=u[n]=a.call(null,e),c()}}else o=a;s.ce&&s.ce._setProp(n,o)}i[0]&&(r&&!l?o=!1:i[1]&&(o===""||o===rn(n))&&(o=!0))}return o}const av=new WeakMap;function Lf(t,e,n=!1){const o=n?av:e.propsCache,s=o.get(t);if(s)return s;const r=t.props,i={},l=[];let a=!1;if(!xe(t)){const c=d=>{a=!0;const[g,b]=Lf(d,e,!0);tt(i,g),b&&l.push(...b)};!n&&e.mixins.length&&e.mixins.forEach(c),t.extends&&c(t.extends),t.mixins&&t.mixins.forEach(c)}if(!r&&!a)return Ve(t)&&o.set(t,so),so;if(ve(r))for(let c=0;c<r.length;c++){const d=on(r[c]);bu(d)&&(i[d]=Me)}else if(r)for(const c in r){const d=on(c);if(bu(d)){const g=r[c],b=i[d]=ve(g)||xe(g)?{type:g}:tt({},g),_=b.type;let w=!1,P=!0;if(ve(_))for(let y=0;y<_.length;++y){const h=_[y],v=xe(h)&&h.name;if(v==="Boolean"){w=!0;break}else v==="String"&&(P=!1)}else w=xe(_)&&_.name==="Boolean";b[0]=w,b[1]=P,(w||Ee(b,"default"))&&l.push(d)}}const u=[i,l];return Ve(t)&&o.set(t,u),u}function bu(t){return t[0]!=="$"&&!Yo(t)}const Nf=t=>t[0]==="_"||t==="$stable",ma=t=>ve(t)?t.map(Wt):[Wt(t)],uv=(t,e,n)=>{if(e._n)return e;const o=te((...s)=>ma(e(...s)),n);return o._c=!1,o},Ff=(t,e,n)=>{const o=t._ctx;for(const s in t){if(Nf(s))continue;const r=t[s];if(xe(r))e[s]=uv(s,r,o);else if(r!=null){const i=ma(r);e[s]=()=>i}}},Hf=(t,e)=>{const n=ma(e);t.slots.default=()=>n},Vf=(t,e,n)=>{for(const o in e)(n||o!=="_")&&(t[o]=e[o])},cv=(t,e,n)=>{const o=t.slots=Bf();if(t.vnode.shapeFlag&32){const s=e._;s?(Vf(o,e,n),n&&zd(o,"_",s,!0)):Ff(e,o)}else e&&Hf(t,e)},dv=(t,e,n)=>{const{vnode:o,slots:s}=t;let r=!0,i=Me;if(o.shapeFlag&32){const l=e._;l?n&&l===1?r=!1:Vf(s,e,n):(r=!e.$stable,Ff(e,s)),i=e}else e&&(Hf(t,e),i={default:1});if(r)for(const l in s)!Nf(l)&&i[l]==null&&delete s[l]},nt=_v;function fv(t){return pv(t)}function pv(t,e){const n=mr();n.__VUE__=!0;const{insert:o,remove:s,patchProp:r,createElement:i,createText:l,createComment:a,setText:u,setElementText:c,parentNode:d,nextSibling:g,setScopeId:b=Gt,insertStaticContent:_}=t,w=(k,O,M,z=null,G=null,X=null,re=void 0,ee=null,Z=!!O.dynamicChildren)=>{if(k===O)return;k&&!Rn(k,O)&&(z=K(k),ne(k,G,X,!0),k=null),O.patchFlag===-2&&(Z=!1,O.dynamicChildren=null);const{type:J,ref:me,shapeFlag:le}=O;switch(J){case xr:P(k,O,M,z);break;case Xt:y(k,O,M,z);break;case Ms:k==null&&h(O,M,z,re);break;case ce:L(k,O,M,z,G,X,re,ee,Z);break;default:le&1?C(k,O,M,z,G,X,re,ee,Z):le&6?H(k,O,M,z,G,X,re,ee,Z):(le&64||le&128)&&J.process(k,O,M,z,G,X,re,ee,Z,Y)}me!=null&&G&&qs(me,k&&k.ref,X,O||k,!O)},P=(k,O,M,z)=>{if(k==null)o(O.el=l(O.children),M,z);else{const G=O.el=k.el;O.children!==k.children&&u(G,O.children)}},y=(k,O,M,z)=>{k==null?o(O.el=a(O.children||""),M,z):O.el=k.el},h=(k,O,M,z)=>{[k.el,k.anchor]=_(k.children,O,M,z,k.el,k.anchor)},v=({el:k,anchor:O},M,z)=>{let G;for(;k&&k!==O;)G=g(k),o(k,M,z),k=G;o(O,M,z)},f=({el:k,anchor:O})=>{let M;for(;k&&k!==O;)M=g(k),s(k),k=M;s(O)},C=(k,O,M,z,G,X,re,ee,Z)=>{O.type==="svg"?re="svg":O.type==="math"&&(re="mathml"),k==null?T(O,M,z,G,X,re,ee,Z):x(k,O,G,X,re,ee,Z)},T=(k,O,M,z,G,X,re,ee)=>{let Z,J;const{props:me,shapeFlag:le,transition:be,dirs:ke}=k;if(Z=k.el=i(k.type,X,me&&me.is,me),le&8?c(Z,k.children):le&16&&m(k.children,Z,null,z,G,Yr(k,X),re,ee),ke&&Pn(k,null,z,"created"),$(Z,k,k.scopeId,re,z),me){for(const Ue in me)Ue!=="value"&&!Yo(Ue)&&r(Z,Ue,null,me[Ue],X,z);"value"in me&&r(Z,"value",null,me.value,X),(J=me.onVnodeBeforeMount)&&Pt(J,z,k)}ke&&Pn(k,null,z,"beforeMount");const je=hv(G,be);je&&be.beforeEnter(Z),o(Z,O,M),((J=me&&me.onVnodeMounted)||je||ke)&&nt(()=>{J&&Pt(J,z,k),je&&be.enter(Z),ke&&Pn(k,null,z,"mounted")},G)},$=(k,O,M,z,G)=>{if(M&&b(k,M),z)for(let X=0;X<z.length;X++)b(k,z[X]);if(G){let X=G.subTree;if(O===X||Ys(X.type)&&(X.ssContent===O||X.ssFallback===O)){const re=G.vnode;$(k,re,re.scopeId,re.slotScopeIds,G.parent)}}},m=(k,O,M,z,G,X,re,ee,Z=0)=>{for(let J=Z;J<k.length;J++){const me=k[J]=ee?gn(k[J]):Wt(k[J]);w(null,me,O,M,z,G,X,re,ee)}},x=(k,O,M,z,G,X,re)=>{const ee=O.el=k.el;let{patchFlag:Z,dynamicChildren:J,dirs:me}=O;Z|=k.patchFlag&16;const le=k.props||Me,be=O.props||Me;let ke;if(M&&On(M,!1),(ke=be.onVnodeBeforeUpdate)&&Pt(ke,M,O,k),me&&Pn(O,k,M,"beforeUpdate"),M&&On(M,!0),(le.innerHTML&&be.innerHTML==null||le.textContent&&be.textContent==null)&&c(ee,""),J?I(k.dynamicChildren,J,ee,M,z,Yr(O,G),X):re||S(k,O,ee,null,M,z,Yr(O,G),X,!1),Z>0){if(Z&16)E(ee,le,be,M,G);else if(Z&2&&le.class!==be.class&&r(ee,"class",null,be.class,G),Z&4&&r(ee,"style",le.style,be.style,G),Z&8){const je=O.dynamicProps;for(let Ue=0;Ue<je.length;Ue++){const Ne=je[Ue],bt=le[Ne],ht=be[Ne];(ht!==bt||Ne==="value")&&r(ee,Ne,bt,ht,G,M)}}Z&1&&k.children!==O.children&&c(ee,O.children)}else!re&&J==null&&E(ee,le,be,M,G);((ke=be.onVnodeUpdated)||me)&&nt(()=>{ke&&Pt(ke,M,O,k),me&&Pn(O,k,M,"updated")},z)},I=(k,O,M,z,G,X,re)=>{for(let ee=0;ee<O.length;ee++){const Z=k[ee],J=O[ee],me=Z.el&&(Z.type===ce||!Rn(Z,J)||Z.shapeFlag&70)?d(Z.el):M;w(Z,J,me,null,z,G,X,re,!0)}},E=(k,O,M,z,G)=>{if(O!==M){if(O!==Me)for(const X in O)!Yo(X)&&!(X in M)&&r(k,X,O[X],null,G,z);for(const X in M){if(Yo(X))continue;const re=M[X],ee=O[X];re!==ee&&X!=="value"&&r(k,X,ee,re,G,z)}"value"in M&&r(k,"value",O.value,M.value,G)}},L=(k,O,M,z,G,X,re,ee,Z)=>{const J=O.el=k?k.el:l(""),me=O.anchor=k?k.anchor:l("");let{patchFlag:le,dynamicChildren:be,slotScopeIds:ke}=O;ke&&(ee=ee?ee.concat(ke):ke),k==null?(o(J,M,z),o(me,M,z),m(O.children||[],M,me,G,X,re,ee,Z)):le>0&&le&64&&be&&k.dynamicChildren?(I(k.dynamicChildren,be,M,G,X,re,ee),(O.key!=null||G&&O===G.subTree)&&ya(k,O,!0)):S(k,O,M,me,G,X,re,ee,Z)},H=(k,O,M,z,G,X,re,ee,Z)=>{O.slotScopeIds=ee,k==null?O.shapeFlag&512?G.ctx.activate(O,M,z,re,Z):V(O,M,z,G,X,re,Z):ae(k,O,Z)},V=(k,O,M,z,G,X,re)=>{const ee=k.component=Av(k,z,G);if(ga(k)&&(ee.ctx.renderer=Y),Mv(ee,!1,re),ee.asyncDep){if(G&&G.registerDep(ee,ue,re),!k.el){const Z=ee.subTree=F(Xt);y(null,Z,O,M)}}else ue(ee,k,O,M,G,X,re)},ae=(k,O,M)=>{const z=O.component=k.component;if(xv(k,O,M))if(z.asyncDep&&!z.asyncResolved){A(z,O,M);return}else z.next=O,z.update();else O.el=k.el,z.vnode=O},ue=(k,O,M,z,G,X,re)=>{const ee=()=>{if(k.isMounted){let{next:le,bu:be,u:ke,parent:je,vnode:Ue}=k;{const Ft=Uf(k);if(Ft){le&&(le.el=Ue.el,A(k,le,re)),Ft.asyncDep.then(()=>{k.isUnmounted||ee()});return}}let Ne=le,bt;On(k,!1),le?(le.el=Ue.el,A(k,le,re)):le=Ue,be&&io(be),(bt=le.props&&le.props.onVnodeBeforeUpdate)&&Pt(bt,je,le,Ue),On(k,!0);const ht=mu(k),Nt=k.subTree;k.subTree=ht,w(Nt,ht,d(Nt.el),K(Nt),k,G,X),le.el=ht.el,Ne===null&&Sv(k,ht.el),ke&&nt(ke,G),(bt=le.props&&le.props.onVnodeUpdated)&&nt(()=>Pt(bt,je,le,Ue),G)}else{let le;const{el:be,props:ke}=O,{bm:je,m:Ue,parent:Ne,root:bt,type:ht}=k,Nt=Bn(O);On(k,!1),je&&io(je),!Nt&&(le=ke&&ke.onVnodeBeforeMount)&&Pt(le,Ne,O),On(k,!0);{bt.ce&&bt.ce._injectChildStyle(ht);const Ft=k.subTree=mu(k);w(null,Ft,M,z,k,G,X),O.el=Ft.el}if(Ue&&nt(Ue,G),!Nt&&(le=ke&&ke.onVnodeMounted)){const Ft=O;nt(()=>Pt(le,Ne,Ft),G)}(O.shapeFlag&256||Ne&&Bn(Ne.vnode)&&Ne.vnode.shapeFlag&256)&&k.a&&nt(k.a,G),k.isMounted=!0,O=M=z=null}};k.scope.on();const Z=k.effect=new Zd(ee);k.scope.off();const J=k.update=Z.run.bind(Z),me=k.job=Z.runIfDirty.bind(Z);me.i=k,me.id=k.uid,Z.scheduler=()=>pa(me),On(k,!0),J()},A=(k,O,M)=>{O.component=k;const z=k.vnode.props;k.vnode=O,k.next=null,lv(k,O.props,z,M),dv(k,O.children,M),Cn(),au(k),xn()},S=(k,O,M,z,G,X,re,ee,Z=!1)=>{const J=k&&k.children,me=k?k.shapeFlag:0,le=O.children,{patchFlag:be,shapeFlag:ke}=O;if(be>0){if(be&128){se(J,le,M,z,G,X,re,ee,Z);return}else if(be&256){R(J,le,M,z,G,X,re,ee,Z);return}}ke&8?(me&16&&Ye(J,G,X),le!==J&&c(M,le)):me&16?ke&16?se(J,le,M,z,G,X,re,ee,Z):Ye(J,G,X,!0):(me&8&&c(M,""),ke&16&&m(le,M,z,G,X,re,ee,Z))},R=(k,O,M,z,G,X,re,ee,Z)=>{k=k||so,O=O||so;const J=k.length,me=O.length,le=Math.min(J,me);let be;for(be=0;be<le;be++){const ke=O[be]=Z?gn(O[be]):Wt(O[be]);w(k[be],ke,M,null,G,X,re,ee,Z)}J>me?Ye(k,G,X,!0,!1,le):m(O,M,z,G,X,re,ee,Z,le)},se=(k,O,M,z,G,X,re,ee,Z)=>{let J=0;const me=O.length;let le=k.length-1,be=me-1;for(;J<=le&&J<=be;){const ke=k[J],je=O[J]=Z?gn(O[J]):Wt(O[J]);if(Rn(ke,je))w(ke,je,M,null,G,X,re,ee,Z);else break;J++}for(;J<=le&&J<=be;){const ke=k[le],je=O[be]=Z?gn(O[be]):Wt(O[be]);if(Rn(ke,je))w(ke,je,M,null,G,X,re,ee,Z);else break;le--,be--}if(J>le){if(J<=be){const ke=be+1,je=ke<me?O[ke].el:z;for(;J<=be;)w(null,O[J]=Z?gn(O[J]):Wt(O[J]),M,je,G,X,re,ee,Z),J++}}else if(J>be)for(;J<=le;)ne(k[J],G,X,!0),J++;else{const ke=J,je=J,Ue=new Map;for(J=je;J<=be;J++){const mt=O[J]=Z?gn(O[J]):Wt(O[J]);mt.key!=null&&Ue.set(mt.key,J)}let Ne,bt=0;const ht=be-je+1;let Nt=!1,Ft=0;const $o=new Array(ht);for(J=0;J<ht;J++)$o[J]=0;for(J=ke;J<=le;J++){const mt=k[J];if(bt>=ht){ne(mt,G,X,!0);continue}let Ht;if(mt.key!=null)Ht=Ue.get(mt.key);else for(Ne=je;Ne<=be;Ne++)if($o[Ne-je]===0&&Rn(mt,O[Ne])){Ht=Ne;break}Ht===void 0?ne(mt,G,X,!0):($o[Ht-je]=J+1,Ht>=Ft?Ft=Ht:Nt=!0,w(mt,O[Ht],M,null,G,X,re,ee,Z),bt++)}const nu=Nt?gv($o):so;for(Ne=nu.length-1,J=ht-1;J>=0;J--){const mt=je+J,Ht=O[mt],ou=mt+1<me?O[mt+1].el:z;$o[J]===0?w(null,Ht,M,ou,G,X,re,ee,Z):Nt&&(Ne<0||J!==nu[Ne]?U(Ht,M,ou,2):Ne--)}}},U=(k,O,M,z,G=null)=>{const{el:X,type:re,transition:ee,children:Z,shapeFlag:J}=k;if(J&6){U(k.component.subTree,O,M,z);return}if(J&128){k.suspense.move(O,M,z);return}if(J&64){re.move(k,O,M,Y);return}if(re===ce){o(X,O,M);for(let le=0;le<Z.length;le++)U(Z[le],O,M,z);o(k.anchor,O,M);return}if(re===Ms){v(k,O,M);return}if(z!==2&&J&1&&ee)if(z===0)ee.beforeEnter(X),o(X,O,M),nt(()=>ee.enter(X),G);else{const{leave:le,delayLeave:be,afterLeave:ke}=ee,je=()=>o(X,O,M),Ue=()=>{le(X,()=>{je(),ke&&ke()})};be?be(X,je,Ue):Ue()}else o(X,O,M)},ne=(k,O,M,z=!1,G=!1)=>{const{type:X,props:re,ref:ee,children:Z,dynamicChildren:J,shapeFlag:me,patchFlag:le,dirs:be,cacheIndex:ke}=k;if(le===-2&&(G=!1),ee!=null&&qs(ee,null,M,k,!0),ke!=null&&(O.renderCache[ke]=void 0),me&256){O.ctx.deactivate(k);return}const je=me&1&&be,Ue=!Bn(k);let Ne;if(Ue&&(Ne=re&&re.onVnodeBeforeUnmount)&&Pt(Ne,O,k),me&6)_e(k.component,M,z);else{if(me&128){k.suspense.unmount(M,z);return}je&&Pn(k,null,O,"beforeUnmount"),me&64?k.type.remove(k,O,M,Y,z):J&&!J.hasOnce&&(X!==ce||le>0&&le&64)?Ye(J,O,M,!1,!0):(X===ce&&le&384||!G&&me&16)&&Ye(Z,O,M),z&&we(k)}(Ue&&(Ne=re&&re.onVnodeUnmounted)||je)&&nt(()=>{Ne&&Pt(Ne,O,k),je&&Pn(k,null,O,"unmounted")},M)},we=k=>{const{type:O,el:M,anchor:z,transition:G}=k;if(O===ce){Se(M,z);return}if(O===Ms){f(k);return}const X=()=>{s(M),G&&!G.persisted&&G.afterLeave&&G.afterLeave()};if(k.shapeFlag&1&&G&&!G.persisted){const{leave:re,delayLeave:ee}=G,Z=()=>re(M,X);ee?ee(k.el,X,Z):Z()}else X()},Se=(k,O)=>{let M;for(;k!==O;)M=g(k),s(k),k=M;s(O)},_e=(k,O,M)=>{const{bum:z,scope:G,job:X,subTree:re,um:ee,m:Z,a:J}=k;Xs(Z),Xs(J),z&&io(z),G.stop(),X&&(X.flags|=8,ne(re,k,O,M)),ee&&nt(ee,O),nt(()=>{k.isUnmounted=!0},O),O&&O.pendingBranch&&!O.isUnmounted&&k.asyncDep&&!k.asyncResolved&&k.suspenseId===O.pendingId&&(O.deps--,O.deps===0&&O.resolve())},Ye=(k,O,M,z=!1,G=!1,X=0)=>{for(let re=X;re<k.length;re++)ne(k[re],O,M,z,G)},K=k=>{if(k.shapeFlag&6)return K(k.component.subTree);if(k.shapeFlag&128)return k.suspense.next();const O=g(k.anchor||k.el),M=O&&O[kf];return M?g(M):O};let Ce=!1;const Pe=(k,O,M)=>{k==null?O._vnode&&ne(O._vnode,null,null,!0):w(O._vnode||null,k,O,null,null,null,M),O._vnode=k,Ce||(Ce=!0,au(),mf(),Ce=!1)},Y={p:w,um:ne,m:U,r:we,mt:V,mc:m,pc:S,pbc:I,n:K,o:t};return{render:Pe,hydrate:void 0,createApp:sv(Pe)}}function Yr({type:t,props:e},n){return n==="svg"&&t==="foreignObject"||n==="mathml"&&t==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function On({effect:t,job:e},n){n?(t.flags|=32,e.flags|=4):(t.flags&=-33,e.flags&=-5)}function hv(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function ya(t,e,n=!1){const o=t.children,s=e.children;if(ve(o)&&ve(s))for(let r=0;r<o.length;r++){const i=o[r];let l=s[r];l.shapeFlag&1&&!l.dynamicChildren&&((l.patchFlag<=0||l.patchFlag===32)&&(l=s[r]=gn(s[r]),l.el=i.el),!n&&l.patchFlag!==-2&&ya(i,l)),l.type===xr&&(l.el=i.el)}}function gv(t){const e=t.slice(),n=[0];let o,s,r,i,l;const a=t.length;for(o=0;o<a;o++){const u=t[o];if(u!==0){if(s=n[n.length-1],t[s]<u){e[o]=s,n.push(o);continue}for(r=0,i=n.length-1;r<i;)l=r+i>>1,t[n[l]]<u?r=l+1:i=l;u<t[n[r]]&&(r>0&&(e[o]=n[r-1]),n[r]=o)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=e[i];return n}function Uf(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:Uf(e)}function Xs(t){if(t)for(let e=0;e<t.length;e++)t[e].flags|=8}const vv=Symbol.for("v-scx"),bv=()=>kt(vv);function mv(t,e){return wa(t,null,{flush:"sync"})}function Fe(t,e,n){return wa(t,e,n)}function wa(t,e,n=Me){const{immediate:o,deep:s,flush:r,once:i}=n,l=tt({},n),a=e&&o||!e&&r!=="post";let u;if(fo){if(r==="sync"){const b=bv();u=b.__watcherHandles||(b.__watcherHandles=[])}else if(!a){const b=()=>{};return b.stop=Gt,b.resume=Gt,b.pause=Gt,b}}const c=st;l.call=(b,_,w)=>Et(b,c,_,w);let d=!1;r==="post"?l.scheduler=b=>{nt(b,c&&c.suspense)}:r!=="sync"&&(d=!0,l.scheduler=(b,_)=>{_?b():pa(b)}),l.augmentJob=b=>{e&&(b.flags|=4),d&&(b.flags|=2,c&&(b.id=c.uid,b.i=c))};const g=jg(t,e,l);return fo&&(u?u.push(g):a&&g()),g}function yv(t,e,n){const o=this.proxy,s=Je(t)?t.includes(".")?Wf(o,t):()=>o[t]:t.bind(o,o);let r;xe(e)?r=e:(r=e.handler,n=e);const i=ws(this),l=wa(s,r.bind(o),n);return i(),l}function Wf(t,e){const n=e.split(".");return()=>{let o=t;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}function ys(t,e,n=Me){const o=Sr(),s=on(e),r=rn(e),i=qf(t,s),l=xg((a,u)=>{let c,d=Me,g;return mv(()=>{const b=t[s];gt(c,b)&&(c=b,u())}),{get(){return a(),n.get?n.get(c):c},set(b){const _=n.set?n.set(b):b;if(!gt(_,c)&&!(d!==Me&&gt(b,d)))return;const w=o.vnode.props;w&&(e in w||s in w||r in w)&&(`onUpdate:${e}`in w||`onUpdate:${s}`in w||`onUpdate:${r}`in w)||(c=b,u()),o.emit(`update:${e}`,_),gt(b,_)&&gt(b,d)&&!gt(_,g)&&u(),d=b,g=_}}});return l[Symbol.iterator]=()=>{let a=0;return{next(){return a<2?{value:a++?i||Me:l,done:!1}:{done:!0}}}},l}const qf=(t,e)=>e==="modelValue"||e==="model-value"?t.modelModifiers:t[`${e}Modifiers`]||t[`${on(e)}Modifiers`]||t[`${rn(e)}Modifiers`];function wv(t,e,...n){if(t.isUnmounted)return;const o=t.vnode.props||Me;let s=n;const r=e.startsWith("update:"),i=r&&qf(o,e.slice(7));i&&(i.trim&&(s=n.map(c=>Je(c)?c.trim():c)),i.number&&(s=n.map(Fs)));let l,a=o[l=Hr(e)]||o[l=Hr(on(e))];!a&&r&&(a=o[l=Hr(rn(e))]),a&&Et(a,t,6,s);const u=o[l+"Once"];if(u){if(!t.emitted)t.emitted={};else if(t.emitted[l])return;t.emitted[l]=!0,Et(u,t,6,s)}}function zf(t,e,n=!1){const o=e.emitsCache,s=o.get(t);if(s!==void 0)return s;const r=t.emits;let i={},l=!1;if(!xe(t)){const a=u=>{const c=zf(u,e,!0);c&&(l=!0,tt(i,c))};!n&&e.mixins.length&&e.mixins.forEach(a),t.extends&&a(t.extends),t.mixins&&t.mixins.forEach(a)}return!r&&!l?(Ve(t)&&o.set(t,null),null):(ve(r)?r.forEach(a=>i[a]=null):tt(i,r),Ve(t)&&o.set(t,i),i)}function Cr(t,e){return!t||!vr(e)?!1:(e=e.slice(2).replace(/Once$/,""),Ee(t,e[0].toLowerCase()+e.slice(1))||Ee(t,rn(e))||Ee(t,e))}function mu(t){const{type:e,vnode:n,proxy:o,withProxy:s,propsOptions:[r],slots:i,attrs:l,emit:a,render:u,renderCache:c,props:d,data:g,setupState:b,ctx:_,inheritAttrs:w}=t,P=Ws(t);let y,h;try{if(n.shapeFlag&4){const f=s||o,C=f;y=Wt(u.call(C,f,c,d,b,g,_)),h=l}else{const f=e;y=Wt(f.length>1?f(d,{attrs:l,slots:i,emit:a}):f(d,null)),h=e.props?l:kv(l)}}catch(f){es.length=0,ms(f,t,1),y=F(Xt)}let v=y;if(h&&w!==!1){const f=Object.keys(h),{shapeFlag:C}=v;f.length&&C&7&&(r&&f.some(na)&&(h=Cv(h,r)),v=wn(v,h,!1,!0))}return n.dirs&&(v=wn(v,null,!1,!0),v.dirs=v.dirs?v.dirs.concat(n.dirs):n.dirs),n.transition&&uo(v,n.transition),y=v,Ws(P),y}const kv=t=>{let e;for(const n in t)(n==="class"||n==="style"||vr(n))&&((e||(e={}))[n]=t[n]);return e},Cv=(t,e)=>{const n={};for(const o in t)(!na(o)||!(o.slice(9)in e))&&(n[o]=t[o]);return n};function xv(t,e,n){const{props:o,children:s,component:r}=t,{props:i,children:l,patchFlag:a}=e,u=r.emitsOptions;if(e.dirs||e.transition)return!0;if(n&&a>=0){if(a&1024)return!0;if(a&16)return o?yu(o,i,u):!!i;if(a&8){const c=e.dynamicProps;for(let d=0;d<c.length;d++){const g=c[d];if(i[g]!==o[g]&&!Cr(u,g))return!0}}}else return(s||l)&&(!l||!l.$stable)?!0:o===i?!1:o?i?yu(o,i,u):!0:!!i;return!1}function yu(t,e,n){const o=Object.keys(e);if(o.length!==Object.keys(t).length)return!0;for(let s=0;s<o.length;s++){const r=o[s];if(e[r]!==t[r]&&!Cr(n,r))return!0}return!1}function Sv({vnode:t,parent:e},n){for(;e;){const o=e.subTree;if(o.suspense&&o.suspense.activeBranch===t&&(o.el=t.el),o===t)(t=e.vnode).el=n,e=e.parent;else break}}const Ys=t=>t.__isSuspense;function _v(t,e){e&&e.pendingBranch?ve(t)?e.effects.push(...t):e.effects.push(t):Ag(t)}const ce=Symbol.for("v-fgt"),xr=Symbol.for("v-txt"),Xt=Symbol.for("v-cmt"),Ms=Symbol.for("v-stc"),es=[];let wt=null;function j(t=!1){es.push(wt=t?null:[])}function Pv(){es.pop(),wt=es[es.length-1]||null}let cs=1;function wu(t,e=!1){cs+=t,t<0&&wt&&e&&(wt.hasOnce=!0)}function Gf(t){return t.dynamicChildren=cs>0?wt||so:null,Pv(),cs>0&&wt&&wt.push(t),t}function N(t,e,n,o,s,r){return Gf(p(t,e,n,o,s,r,!0))}function pe(t,e,n,o,s){return Gf(F(t,e,n,o,s,!0))}function co(t){return t?t.__v_isVNode===!0:!1}function Rn(t,e){return t.type===e.type&&t.key===e.key}const Xf=({key:t})=>t??null,Bs=({ref:t,ref_key:e,ref_for:n})=>(typeof t=="number"&&(t=""+t),t!=null?Je(t)||ye(t)||xe(t)?{i:rt,r:t,k:e,f:!!n}:t:null);function p(t,e=null,n=null,o=0,s=null,r=t===ce?0:1,i=!1,l=!1){const a={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&Xf(e),ref:e&&Bs(e),scopeId:wf,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:rt};return l?(ka(a,n),r&128&&t.normalize(a)):n&&(a.shapeFlag|=Je(n)?8:16),cs>0&&!i&&wt&&(a.patchFlag>0||r&6)&&a.patchFlag!==32&&wt.push(a),a}const F=Ov;function Ov(t,e=null,n=null,o=0,s=null,r=!1){if((!t||t===Kg)&&(t=Xt),co(t)){const l=wn(t,e,!0);return n&&ka(l,n),cs>0&&!r&&wt&&(l.shapeFlag&6?wt[wt.indexOf(t)]=l:wt.push(l)),l.patchFlag=-2,l}if(Lv(t)&&(t=t.__vccOpts),e){e=Iv(e);let{class:l,style:a}=e;l&&!Je(l)&&(e.class=Le(l)),Ve(a)&&(fa(a)&&!ve(a)&&(a=tt({},a)),e.style=et(a))}const i=Je(t)?1:Ys(t)?128:Mg(t)?64:Ve(t)?4:xe(t)?2:0;return p(t,e,n,o,s,i,r,!0)}function Iv(t){return t?fa(t)||Ef(t)?tt({},t):t:null}function wn(t,e,n=!1,o=!1){const{props:s,ref:r,patchFlag:i,children:l,transition:a}=t,u=e?jv(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:t.type,props:u,key:u&&Xf(u),ref:e&&e.ref?n&&r?ve(r)?r.concat(Bs(e)):[r,Bs(e)]:Bs(e):r,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:l,target:t.target,targetStart:t.targetStart,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==ce?i===-1?16:i|16:i,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:a,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&wn(t.ssContent),ssFallback:t.ssFallback&&wn(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return a&&o&&uo(c,a.clone(c)),c}function Q(t=" ",e=0){return F(xr,null,t,e)}function Tv(t,e){const n=F(Ms,null,t);return n.staticCount=e,n}function he(t="",e=!1){return e?(j(),pe(Xt,null,t)):F(Xt,null,t)}function Wt(t){return t==null||typeof t=="boolean"?F(Xt):ve(t)?F(ce,null,t.slice()):co(t)?gn(t):F(xr,null,String(t))}function gn(t){return t.el===null&&t.patchFlag!==-1||t.memo?t:wn(t)}function ka(t,e){let n=0;const{shapeFlag:o}=t;if(e==null)e=null;else if(ve(e))n=16;else if(typeof e=="object")if(o&65){const s=e.default;s&&(s._c&&(s._d=!1),ka(t,s()),s._c&&(s._d=!0));return}else{n=32;const s=e._;!s&&!Ef(e)?e._ctx=rt:s===3&&rt&&(rt.slots._===1?e._=1:(e._=2,t.patchFlag|=1024))}else xe(e)?(e={default:e,_ctx:rt},n=32):(e=String(e),o&64?(n=16,e=[Q(e)]):n=8);t.children=e,t.shapeFlag|=n}function jv(...t){const e={};for(let n=0;n<t.length;n++){const o=t[n];for(const s in o)if(s==="class")e.class!==o.class&&(e.class=Le([e.class,o.class]));else if(s==="style")e.style=et([e.style,o.style]);else if(vr(s)){const r=e[s],i=o[s];i&&r!==i&&!(ve(r)&&r.includes(i))&&(e[s]=r?[].concat(r,i):i)}else s!==""&&(e[s]=o[s])}return e}function Pt(t,e,n,o=null){Et(t,e,7,[n,o])}const $v=Rf();let Rv=0;function Av(t,e,n){const o=t.type,s=(e?e.appContext:t.appContext)||$v,r={uid:Rv++,vnode:t,type:o,parent:e,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new Kd(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(s.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:Lf(o,s),emitsOptions:zf(o,s),emit:null,emitted:null,propsDefaults:Me,inheritAttrs:o.inheritAttrs,ctx:Me,data:Me,props:Me,attrs:Me,slots:Me,refs:Me,setupState:Me,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=e?e.root:r,r.emit=wv.bind(null,r),t.ce&&t.ce(r),r}let st=null;const Sr=()=>st||rt;let Ks,Rl;{const t=mr(),e=(n,o)=>{let s;return(s=t[n])||(s=t[n]=[]),s.push(o),r=>{s.length>1?s.forEach(i=>i(r)):s[0](r)}};Ks=e("__VUE_INSTANCE_SETTERS__",n=>st=n),Rl=e("__VUE_SSR_SETTERS__",n=>fo=n)}const ws=t=>{const e=st;return Ks(t),t.scope.on(),()=>{t.scope.off(),Ks(e)}},ku=()=>{st&&st.scope.off(),Ks(null)};function Yf(t){return t.vnode.shapeFlag&4}let fo=!1;function Mv(t,e=!1,n=!1){e&&Rl(e);const{props:o,children:s}=t.vnode,r=Yf(t);iv(t,o,r,e),cv(t,s,n);const i=r?Bv(t,e):void 0;return e&&Rl(!1),i}function Bv(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=new Proxy(t.ctx,Jg);const{setup:o}=n;if(o){Cn();const s=t.setupContext=o.length>1?Dv(t):null,r=ws(t),i=bs(o,t,0,[t.props,s]),l=Vd(i);if(xn(),r(),(l||t.sp)&&!Bn(t)&&ha(t),l){if(i.then(ku,ku),e)return i.then(a=>{Cu(t,a)}).catch(a=>{ms(a,t,0)});t.asyncDep=i}else Cu(t,i)}else Kf(t)}function Cu(t,e,n){xe(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:Ve(e)&&(t.setupState=gf(e)),Kf(t)}function Kf(t,e,n){const o=t.type;t.render||(t.render=o.render||Gt);{const s=ws(t);Cn();try{Zg(t)}finally{xn(),s()}}}const Ev={get(t,e){return at(t,"get",""),t[e]}};function Dv(t){const e=n=>{t.exposed=n||{}};return{attrs:new Proxy(t.attrs,Ev),slots:t.slots,emit:t.emit,expose:e}}function _r(t){return t.exposed?t.exposeProxy||(t.exposeProxy=new Proxy(gf(as(t.exposed)),{get(e,n){if(n in e)return e[n];if(n in Qo)return Qo[n](t)},has(e,n){return n in e||n in Qo}})):t.proxy}function xu(t,e=!0){return xe(t)?t.displayName||t.name:t.name||e&&t.__name}function Lv(t){return xe(t)&&"__vccOpts"in t}const D=(t,e)=>Ig(t,e,fo);function Su(t,e,n){const o=arguments.length;return o===2?Ve(e)&&!ve(e)?co(e)?F(t,null,[e]):F(t,e):F(t,null,e):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&co(n)&&(n=[n]),F(t,e,n))}const Nv="3.5.13";/**
* @vue/runtime-dom v3.5.13
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let Al;const _u=typeof window<"u"&&window.trustedTypes;if(_u)try{Al=_u.createPolicy("vue",{createHTML:t=>t})}catch{}const Jf=Al?t=>Al.createHTML(t):t=>t,Fv="http://www.w3.org/2000/svg",Hv="http://www.w3.org/1998/Math/MathML",Jt=typeof document<"u"?document:null,Pu=Jt&&Jt.createElement("template"),Vv={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,o)=>{const s=e==="svg"?Jt.createElementNS(Fv,t):e==="mathml"?Jt.createElementNS(Hv,t):n?Jt.createElement(t,{is:n}):Jt.createElement(t);return t==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:t=>Jt.createTextNode(t),createComment:t=>Jt.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>Jt.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,o,s,r){const i=n?n.previousSibling:e.lastChild;if(s&&(s===r||s.nextSibling))for(;e.insertBefore(s.cloneNode(!0),n),!(s===r||!(s=s.nextSibling)););else{Pu.innerHTML=Jf(o==="svg"?`<svg>${t}</svg>`:o==="mathml"?`<math>${t}</math>`:t);const l=Pu.content;if(o==="svg"||o==="mathml"){const a=l.firstChild;for(;a.firstChild;)l.appendChild(a.firstChild);l.removeChild(a)}e.insertBefore(l,n)}return[i?i.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},an="transition",Ao="animation",po=Symbol("_vtc"),Zf={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Uv=tt({},Dg,Zf),In=(t,e=[])=>{ve(t)?t.forEach(n=>n(...e)):t&&t(...e)},Ou=t=>t?ve(t)?t.some(e=>e.length>1):t.length>1:!1;function Wv(t){const e={};for(const L in t)L in Zf||(e[L]=t[L]);if(t.css===!1)return e;const{name:n="v",type:o,duration:s,enterFromClass:r=`${n}-enter-from`,enterActiveClass:i=`${n}-enter-active`,enterToClass:l=`${n}-enter-to`,appearFromClass:a=r,appearActiveClass:u=i,appearToClass:c=l,leaveFromClass:d=`${n}-leave-from`,leaveActiveClass:g=`${n}-leave-active`,leaveToClass:b=`${n}-leave-to`}=t,_=qv(s),w=_&&_[0],P=_&&_[1],{onBeforeEnter:y,onEnter:h,onEnterCancelled:v,onLeave:f,onLeaveCancelled:C,onBeforeAppear:T=y,onAppear:$=h,onAppearCancelled:m=v}=e,x=(L,H,V,ae)=>{L._enterCancelled=ae,dn(L,H?c:l),dn(L,H?u:i),V&&V()},I=(L,H)=>{L._isLeaving=!1,dn(L,d),dn(L,b),dn(L,g),H&&H()},E=L=>(H,V)=>{const ae=L?$:h,ue=()=>x(H,L,V);In(ae,[H,ue]),Iu(()=>{dn(H,L?a:r),Vt(H,L?c:l),Ou(ae)||Tu(H,o,w,ue)})};return tt(e,{onBeforeEnter(L){In(y,[L]),Vt(L,r),Vt(L,i)},onBeforeAppear(L){In(T,[L]),Vt(L,a),Vt(L,u)},onEnter:E(!1),onAppear:E(!0),onLeave(L,H){L._isLeaving=!0;const V=()=>I(L,H);Vt(L,d),L._enterCancelled?(Vt(L,g),Ml()):(Ml(),Vt(L,g)),Iu(()=>{L._isLeaving&&(dn(L,d),Vt(L,b),Ou(f)||Tu(L,o,P,V))}),In(f,[L,V])},onEnterCancelled(L){x(L,!1,void 0,!0),In(v,[L])},onAppearCancelled(L){x(L,!0,void 0,!0),In(m,[L])},onLeaveCancelled(L){I(L),In(C,[L])}})}function qv(t){if(t==null)return null;if(Ve(t))return[Kr(t.enter),Kr(t.leave)];{const e=Kr(t);return[e,e]}}function Kr(t){return Wh(t)}function Vt(t,e){e.split(/\s+/).forEach(n=>n&&t.classList.add(n)),(t[po]||(t[po]=new Set)).add(e)}function dn(t,e){e.split(/\s+/).forEach(o=>o&&t.classList.remove(o));const n=t[po];n&&(n.delete(e),n.size||(t[po]=void 0))}function Iu(t){requestAnimationFrame(()=>{requestAnimationFrame(t)})}let zv=0;function Tu(t,e,n,o){const s=t._endId=++zv,r=()=>{s===t._endId&&o()};if(n!=null)return setTimeout(r,n);const{type:i,timeout:l,propCount:a}=Qf(t,e);if(!i)return o();const u=i+"end";let c=0;const d=()=>{t.removeEventListener(u,g),r()},g=b=>{b.target===t&&++c>=a&&d()};setTimeout(()=>{c<a&&d()},l+1),t.addEventListener(u,g)}function Qf(t,e){const n=window.getComputedStyle(t),o=_=>(n[_]||"").split(", "),s=o(`${an}Delay`),r=o(`${an}Duration`),i=ju(s,r),l=o(`${Ao}Delay`),a=o(`${Ao}Duration`),u=ju(l,a);let c=null,d=0,g=0;e===an?i>0&&(c=an,d=i,g=r.length):e===Ao?u>0&&(c=Ao,d=u,g=a.length):(d=Math.max(i,u),c=d>0?i>u?an:Ao:null,g=c?c===an?r.length:a.length:0);const b=c===an&&/\b(transform|all)(,|$)/.test(o(`${an}Property`).toString());return{type:c,timeout:d,propCount:g,hasTransform:b}}function ju(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max(...e.map((n,o)=>$u(n)+$u(t[o])))}function $u(t){return t==="auto"?0:Number(t.slice(0,-1).replace(",","."))*1e3}function Ml(){return document.body.offsetHeight}function Gv(t,e,n){const o=t[po];o&&(e=(e?[e,...o]:[...o]).join(" ")),e==null?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}const Ru=Symbol("_vod"),Xv=Symbol("_vsh"),Yv=Symbol(""),Kv=/(^|;)\s*display\s*:/;function Jv(t,e,n){const o=t.style,s=Je(n);let r=!1;if(n&&!s){if(e)if(Je(e))for(const i of e.split(";")){const l=i.slice(0,i.indexOf(":")).trim();n[l]==null&&Es(o,l,"")}else for(const i in e)n[i]==null&&Es(o,i,"");for(const i in n)i==="display"&&(r=!0),Es(o,i,n[i])}else if(s){if(e!==n){const i=o[Yv];i&&(n+=";"+i),o.cssText=n,r=Kv.test(n)}}else e&&t.removeAttribute("style");Ru in t&&(t[Ru]=r?o.display:"",t[Xv]&&(o.display="none"))}const Au=/\s*!important$/;function Es(t,e,n){if(ve(n))n.forEach(o=>Es(t,e,o));else if(n==null&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const o=Zv(t,e);Au.test(n)?t.setProperty(rn(o),n.replace(Au,""),"important"):t[o]=n}}const Mu=["Webkit","Moz","ms"],Jr={};function Zv(t,e){const n=Jr[e];if(n)return n;let o=on(e);if(o!=="filter"&&o in t)return Jr[e]=o;o=qd(o);for(let s=0;s<Mu.length;s++){const r=Mu[s]+o;if(r in t)return Jr[e]=r}return e}const Bu="http://www.w3.org/1999/xlink";function Eu(t,e,n,o,s,r=Kh(e)){o&&e.startsWith("xlink:")?n==null?t.removeAttributeNS(Bu,e.slice(6,e.length)):t.setAttributeNS(Bu,e,n):n==null||r&&!Gd(n)?t.removeAttribute(e):t.setAttribute(e,r?"":Bt(n)?String(n):n)}function Du(t,e,n,o,s){if(e==="innerHTML"||e==="textContent"){n!=null&&(t[e]=e==="innerHTML"?Jf(n):n);return}const r=t.tagName;if(e==="value"&&r!=="PROGRESS"&&!r.includes("-")){const l=r==="OPTION"?t.getAttribute("value")||"":t.value,a=n==null?t.type==="checkbox"?"on":"":String(n);(l!==a||!("_value"in t))&&(t.value=a),n==null&&t.removeAttribute(e),t._value=n;return}let i=!1;if(n===""||n==null){const l=typeof t[e];l==="boolean"?n=Gd(n):n==null&&l==="string"?(n="",i=!0):l==="number"&&(n=0,i=!0)}try{t[e]=n}catch{}i&&t.removeAttribute(s||e)}function vn(t,e,n,o){t.addEventListener(e,n,o)}function Qv(t,e,n,o){t.removeEventListener(e,n,o)}const Lu=Symbol("_vei");function eb(t,e,n,o,s=null){const r=t[Lu]||(t[Lu]={}),i=r[e];if(o&&i)i.value=o;else{const[l,a]=tb(e);if(o){const u=r[e]=sb(o,s);vn(t,l,u,a)}else i&&(Qv(t,l,i,a),r[e]=void 0)}}const Nu=/(?:Once|Passive|Capture)$/;function tb(t){let e;if(Nu.test(t)){e={};let o;for(;o=t.match(Nu);)t=t.slice(0,t.length-o[0].length),e[o[0].toLowerCase()]=!0}return[t[2]===":"?t.slice(3):rn(t.slice(2)),e]}let Zr=0;const nb=Promise.resolve(),ob=()=>Zr||(nb.then(()=>Zr=0),Zr=Date.now());function sb(t,e){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;Et(rb(o,n.value),e,5,[o])};return n.value=t,n.attached=ob(),n}function rb(t,e){if(ve(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map(o=>s=>!s._stopped&&o&&o(s))}else return e}const Fu=t=>t.charCodeAt(0)===111&&t.charCodeAt(1)===110&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,ib=(t,e,n,o,s,r)=>{const i=s==="svg";e==="class"?Gv(t,o,i):e==="style"?Jv(t,n,o):vr(e)?na(e)||eb(t,e,n,o,r):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):lb(t,e,o,i))?(Du(t,e,o),!t.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&Eu(t,e,o,i,r,e!=="value")):t._isVueCE&&(/[A-Z]/.test(e)||!Je(o))?Du(t,on(e),o,r,e):(e==="true-value"?t._trueValue=o:e==="false-value"&&(t._falseValue=o),Eu(t,e,o,i))};function lb(t,e,n,o){if(o)return!!(e==="innerHTML"||e==="textContent"||e in t&&Fu(e)&&xe(n));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="form"||e==="list"&&t.tagName==="INPUT"||e==="type"&&t.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const s=t.tagName;if(s==="IMG"||s==="VIDEO"||s==="CANVAS"||s==="SOURCE")return!1}return Fu(e)&&Je(n)?!1:e in t}const ep=new WeakMap,tp=new WeakMap,Js=Symbol("_moveCb"),Hu=Symbol("_enterCb"),ab=t=>(delete t.props.mode,t),ub=ab({name:"TransitionGroup",props:tt({},Uv,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=Sr(),o=Eg();let s,r;return va(()=>{if(!s.length)return;const i=t.moveClass||`${t.name||"v"}-move`;if(!pb(s[0].el,n.vnode.el,i))return;s.forEach(cb),s.forEach(db);const l=s.filter(fb);Ml(),l.forEach(a=>{const u=a.el,c=u.style;Vt(u,i),c.transform=c.webkitTransform=c.transitionDuration="";const d=u[Js]=g=>{g&&g.target!==u||(!g||/transform$/.test(g.propertyName))&&(u.removeEventListener("transitionend",d),u[Js]=null,dn(u,i))};u.addEventListener("transitionend",d)})}),()=>{const i=Re(t),l=Wv(i);let a=i.tag||ce;if(s=[],r)for(let u=0;u<r.length;u++){const c=r[u];c.el&&c.el instanceof Element&&(s.push(c),uo(c,Ol(c,l,o,n)),ep.set(c,c.el.getBoundingClientRect()))}r=e.default?_f(e.default()):[];for(let u=0;u<r.length;u++){const c=r[u];c.key!=null&&uo(c,Ol(c,l,o,n))}return F(a,null,r)}}}),D_=ub;function cb(t){const e=t.el;e[Js]&&e[Js](),e[Hu]&&e[Hu]()}function db(t){tp.set(t,t.el.getBoundingClientRect())}function fb(t){const e=ep.get(t),n=tp.get(t),o=e.left-n.left,s=e.top-n.top;if(o||s){const r=t.el.style;return r.transform=r.webkitTransform=`translate(${o}px,${s}px)`,r.transitionDuration="0s",t}}function pb(t,e,n){const o=t.cloneNode(),s=t[po];s&&s.forEach(l=>{l.split(/\s+/).forEach(a=>a&&o.classList.remove(a))}),n.split(/\s+/).forEach(l=>l&&o.classList.add(l)),o.style.display="none";const r=e.nodeType===1?e:e.parentNode;r.appendChild(o);const{hasTransform:i}=Qf(o);return r.removeChild(o),i}const ho=t=>{const e=t.props["onUpdate:modelValue"]||!1;return ve(e)?n=>io(e,n):e};function hb(t){t.target.composing=!0}function Vu(t){const e=t.target;e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}const nn=Symbol("_assign"),Ke={created(t,{modifiers:{lazy:e,trim:n,number:o}},s){t[nn]=ho(s);const r=o||s.props&&s.props.type==="number";vn(t,e?"change":"input",i=>{if(i.target.composing)return;let l=t.value;n&&(l=l.trim()),r&&(l=Fs(l)),t[nn](l)}),n&&vn(t,"change",()=>{t.value=t.value.trim()}),e||(vn(t,"compositionstart",hb),vn(t,"compositionend",Vu),vn(t,"change",Vu))},mounted(t,{value:e}){t.value=e??""},beforeUpdate(t,{value:e,oldValue:n,modifiers:{lazy:o,trim:s,number:r}},i){if(t[nn]=ho(i),t.composing)return;const l=(r||t.type==="number")&&!/^0\d/.test(t.value)?Fs(t.value):t.value,a=e??"";l!==a&&(document.activeElement===t&&t.type!=="range"&&(o&&e===n||s&&t.value.trim()===a)||(t.value=a))}},gb={deep:!0,created(t,e,n){t[nn]=ho(n),vn(t,"change",()=>{const o=t._modelValue,s=ds(t),r=t.checked,i=t[nn];if(ve(o)){const l=ra(o,s),a=l!==-1;if(r&&!a)i(o.concat(s));else if(!r&&a){const u=[...o];u.splice(l,1),i(u)}}else if(xo(o)){const l=new Set(o);r?l.add(s):l.delete(s),i(l)}else i(np(t,r))})},mounted:Uu,beforeUpdate(t,e,n){t[nn]=ho(n),Uu(t,e,n)}};function Uu(t,{value:e,oldValue:n},o){t._modelValue=e;let s;if(ve(e))s=ra(e,o.props.value)>-1;else if(xo(e))s=e.has(o.props.value);else{if(e===n)return;s=vs(e,np(t,!0))}t.checked!==s&&(t.checked=s)}const Ct={deep:!0,created(t,{value:e,modifiers:{number:n}},o){const s=xo(e);vn(t,"change",()=>{const r=Array.prototype.filter.call(t.options,i=>i.selected).map(i=>n?Fs(ds(i)):ds(i));t[nn](t.multiple?s?new Set(r):r:r[0]),t._assigning=!0,tn(()=>{t._assigning=!1})}),t[nn]=ho(o)},mounted(t,{value:e}){Wu(t,e)},beforeUpdate(t,e,n){t[nn]=ho(n)},updated(t,{value:e}){t._assigning||Wu(t,e)}};function Wu(t,e){const n=t.multiple,o=ve(e);if(!(n&&!o&&!xo(e))){for(let s=0,r=t.options.length;s<r;s++){const i=t.options[s],l=ds(i);if(n)if(o){const a=typeof l;a==="string"||a==="number"?i.selected=e.some(u=>String(u)===String(l)):i.selected=ra(e,l)>-1}else i.selected=e.has(l);else if(vs(ds(i),e)){t.selectedIndex!==s&&(t.selectedIndex=s);return}}!n&&t.selectedIndex!==-1&&(t.selectedIndex=-1)}}function ds(t){return"_value"in t?t._value:t.value}function np(t,e){const n=e?"_trueValue":"_falseValue";return n in t?t[n]:e}const vb=["ctrl","shift","alt","meta"],bb={stop:t=>t.stopPropagation(),prevent:t=>t.preventDefault(),self:t=>t.target!==t.currentTarget,ctrl:t=>!t.ctrlKey,shift:t=>!t.shiftKey,alt:t=>!t.altKey,meta:t=>!t.metaKey,left:t=>"button"in t&&t.button!==0,middle:t=>"button"in t&&t.button!==1,right:t=>"button"in t&&t.button!==2,exact:(t,e)=>vb.some(n=>t[`${n}Key`]&&!e.includes(n))},fe=(t,e)=>{const n=t._withMods||(t._withMods={}),o=e.join(".");return n[o]||(n[o]=(s,...r)=>{for(let i=0;i<e.length;i++){const l=bb[e[i]];if(l&&l(s,e))return}return t(s,...r)})},mb={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},ot=(t,e)=>{const n=t._withKeys||(t._withKeys={}),o=e.join(".");return n[o]||(n[o]=s=>{if(!("key"in s))return;const r=rn(s.key);if(e.some(i=>i===r||mb[i]===r))return t(s)})},yb=tt({patchProp:ib},Vv);let qu;function wb(){return qu||(qu=fv(yb))}const op=(...t)=>{const e=wb().createApp(...t),{mount:n}=e;return e.mount=o=>{const s=Cb(o);if(!s)return;const r=e._component;!xe(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.nodeType===1&&(s.textContent="");const i=n(s,!1,kb(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},e};function kb(t){if(t instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&t instanceof MathMLElement)return"mathml"}function Cb(t){return Je(t)?document.querySelector(t):t}/*!
 * pinia v3.0.3
 * (c) 2025 Eduardo San Martin Morote
 * @license MIT
 */let sp;const Pr=t=>sp=t,rp=Symbol();function Bl(t){return t&&typeof t=="object"&&Object.prototype.toString.call(t)==="[object Object]"&&typeof t.toJSON!="function"}var ts;(function(t){t.direct="direct",t.patchObject="patch object",t.patchFunction="patch function"})(ts||(ts={}));function xb(){const t=ia(!0),e=t.run(()=>q({}));let n=[],o=[];const s=as({install(r){Pr(s),s._a=r,r.provide(rp,s),r.config.globalProperties.$pinia=s,o.forEach(i=>n.push(i)),o=[]},use(r){return this._a?n.push(r):o.push(r),this},_p:n,_a:null,_e:t,_s:new Map,state:e});return s}const ip=()=>{};function zu(t,e,n,o=ip){t.push(e);const s=()=>{const r=t.indexOf(e);r>-1&&(t.splice(r,1),o())};return!n&&Jd()&&Zh(s),s}function Gn(t,...e){t.slice().forEach(n=>{n(...e)})}const Sb=t=>t(),Gu=Symbol(),Qr=Symbol();function El(t,e){t instanceof Map&&e instanceof Map?e.forEach((n,o)=>t.set(o,n)):t instanceof Set&&e instanceof Set&&e.forEach(t.add,t);for(const n in e){if(!e.hasOwnProperty(n))continue;const o=e[n],s=t[n];Bl(s)&&Bl(o)&&t.hasOwnProperty(n)&&!ye(o)&&!bn(o)?t[n]=El(s,o):t[n]=o}return t}const _b=Symbol();function Pb(t){return!Bl(t)||!Object.prototype.hasOwnProperty.call(t,_b)}const{assign:fn}=Object;function Ob(t){return!!(ye(t)&&t.effect)}function Ib(t,e,n,o){const{state:s,actions:r,getters:i}=e,l=n.state.value[t];let a;function u(){l||(n.state.value[t]=s?s():{});const c=Sg(n.state.value[t]);return fn(c,r,Object.keys(i||{}).reduce((d,g)=>(d[g]=as(D(()=>{Pr(n);const b=n._s.get(t);return i[g].call(b,b)})),d),{}))}return a=lp(t,u,e,n,o,!0),a}function lp(t,e,n={},o,s,r){let i;const l=fn({actions:{}},n),a={deep:!0};let u,c,d=[],g=[],b;const _=o.state.value[t];!r&&!_&&(o.state.value[t]={}),q({});let w;function P(m){let x;u=c=!1,typeof m=="function"?(m(o.state.value[t]),x={type:ts.patchFunction,storeId:t,events:b}):(El(o.state.value[t],m),x={type:ts.patchObject,payload:m,storeId:t,events:b});const I=w=Symbol();tn().then(()=>{w===I&&(u=!0)}),c=!0,Gn(d,x,o.state.value[t])}const y=r?function(){const{state:x}=n,I=x?x():{};this.$patch(E=>{fn(E,I)})}:ip;function h(){i.stop(),d=[],g=[],o._s.delete(t)}const v=(m,x="")=>{if(Gu in m)return m[Qr]=x,m;const I=function(){Pr(o);const E=Array.from(arguments),L=[],H=[];function V(A){L.push(A)}function ae(A){H.push(A)}Gn(g,{args:E,name:I[Qr],store:C,after:V,onError:ae});let ue;try{ue=m.apply(this&&this.$id===t?this:C,E)}catch(A){throw Gn(H,A),A}return ue instanceof Promise?ue.then(A=>(Gn(L,A),A)).catch(A=>(Gn(H,A),Promise.reject(A))):(Gn(L,ue),ue)};return I[Gu]=!0,I[Qr]=x,I},f={_p:o,$id:t,$onAction:zu.bind(null,g),$patch:P,$reset:y,$subscribe(m,x={}){const I=zu(d,m,x.detached,()=>E()),E=i.run(()=>Fe(()=>o.state.value[t],L=>{(x.flush==="sync"?c:u)&&m({storeId:t,type:ts.direct,events:b},L)},fn({},a,x)));return I},$dispose:h},C=sn(f);o._s.set(t,C);const $=(o._a&&o._a.runWithContext||Sb)(()=>o._e.run(()=>(i=ia()).run(()=>e({action:v}))));for(const m in $){const x=$[m];if(ye(x)&&!Ob(x)||bn(x))r||(_&&Pb(x)&&(ye(x)?x.value=_[m]:El(x,_[m])),o.state.value[t][m]=x);else if(typeof x=="function"){const I=v(x,m);$[m]=I,l.actions[m]=x}}return fn(C,$),fn(Re(C),$),Object.defineProperty(C,"$state",{get:()=>o.state.value[t],set:m=>{P(x=>{fn(x,m)})}}),o._p.forEach(m=>{fn(C,i.run(()=>m({store:C,app:o._a,pinia:o,options:l})))}),_&&r&&n.hydrate&&n.hydrate(C.$state,_),u=!0,c=!0,C}/*! #__NO_SIDE_EFFECTS__ */function Tb(t,e,n){let o;const s=typeof e=="function";o=s?n:e;function r(i,l){const a=rv();return i=i||(a?kt(rp,null):null),i&&Pr(i),i=sp,i._s.has(t)||(s?lp(t,e,o,i):Ib(t,o,i)),i._s.get(t)}return r.$id=t,r}const jb="modulepreload",$b=function(t,e){return new URL(t,e).href},Xu={},Yu=function(e,n,o){let s=Promise.resolve();if(n&&n.length>0){let i=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(g=>({status:"fulfilled",value:g}),g=>({status:"rejected",reason:g}))))};const l=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),u=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=i(n.map(c=>{if(c=$b(c,o),c in Xu)return;Xu[c]=!0;const d=c.endsWith(".css"),g=d?'[rel="stylesheet"]':"";if(!!o)for(let w=l.length-1;w>=0;w--){const P=l[w];if(P.href===c&&(!d||P.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${c}"]${g}`))return;const _=document.createElement("link");if(_.rel=d?"stylesheet":jb,d||(_.as="script"),_.crossOrigin="",_.href=c,u&&_.setAttribute("nonce",u),document.head.appendChild(_),d)return new Promise((w,P)=>{_.addEventListener("load",w),_.addEventListener("error",()=>P(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return s.then(i=>{for(const l of i||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})};function Rb(t){return{all:t=t||new Map,on:function(e,n){var o=t.get(e);o?o.push(n):t.set(e,[n])},off:function(e,n){var o=t.get(e);o&&(n?o.splice(o.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var o=t.get(e);o&&o.slice().map(function(s){s(n)}),(o=t.get("*"))&&o.slice().map(function(s){s(e,n)})}}}const ei=Rb(),$e={fire(t){ei.emit(t.kind,t)},subscribe(t,e){ei.on(t.kind,e)},unsubscribe(t,e){ei.off(t.kind,e)}};class Zs{constructor(e){B(this,"kind","AssetFailureEvent");this.path=e}}B(Zs,"kind","AssetFailureEvent");class Nn{constructor(e){B(this,"kind","FailureEvent");this.message=e}}B(Nn,"kind","FailureEvent");class ap{constructor(e){B(this,"kind","CustomAssetFailureEvent");this.error=e}}B(ap,"kind","CustomAssetFailureEvent");class Or{constructor(){B(this,"kind","InvalidateRenderEvent")}}B(Or,"kind","InvalidateRenderEvent");const fr=class fr{constructor(){B(this,"kind",fr.kind)}};B(fr,"kind","RenderUpdatedEvent");let Qs=fr;const pr=class pr{constructor(){B(this,"kind",pr.kind)}};B(pr,"kind","StateLoadingEvent");let er=pr;class Ot{constructor(e){B(this,"kind","ShowMessageEvent");this.message=e}}B(Ot,"kind","ShowMessageEvent");class Ca{constructor(e,n){B(this,"kind","ResolvableErrorEvent");this.message=e,this.actions=n}}B(Ca,"kind","ResolvableErrorEvent");class tr{constructor(e){B(this,"kind","ColorPickedEvent");this.color=e}}B(tr,"kind","ColorPickedEvent");class up{constructor(e,n){B(this,"kind","VueErrorEvent");this.error=e,this.info=n}}B(up,"kind","VueErrorEvent");function St(){return kt("viewport")}const Ku=new WeakMap,Ju=new WeakMap;function cp(){const t=St(),e=Ku.get(t);if(e)return e;const n=D({get(){return t.value.selection},set(o){t.value.selection=o}});return Ku.set(t,n),n}function _n(){const t=St(),e=Ju.get(t);if(e)return e;console.log("make computed");const n=D(()=>t.value.isVertical);return Ju.set(t,n),n}const Ab={key:0},Mb=["onClick"],Bb=["onClick"],Eb=5e3,ti=2e4,Zu=100,Db=Oe({__name:"message-console",props:{loading:{type:Boolean}},setup(t){const e=t,n=q([]),o=q([]),s=q([]),r=q(!1),i=q(0),l=q(0),a=_n();u(e.loading),$e.subscribe(Zs,g=>{n.value.push(`Failed to load asset '${g.path}'`),setTimeout(()=>{n.value.shift()},Eb)}),$e.subscribe(ap,()=>{n.value.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{n.value.shift()},ti)}),$e.subscribe(Nn,g=>{o.value.push(g.message)}),$e.subscribe(Ca,g=>{s.value.push(g)}),$e.subscribe(Ot,g=>{n.value.push(g.message),setTimeout(()=>{n.value.shift()},ti)}),$e.subscribe(up,g=>{n.value.push(g.error.name),n.value.push(JSON.stringify(g.error.stack)),n.value.push(g.info),setTimeout(()=>{n.value.shift(),n.value.shift(),n.value.shift()},ti)});function u(g){g?(l.value&&(clearTimeout(l.value),l.value=0),!r.value&&!i.value&&(i.value=setTimeout(()=>{r.value=!0,i.value=0},Zu))):(i.value&&(clearTimeout(i.value),i.value=0),r.value&&!l.value&&(l.value=setTimeout(()=>{r.value=!1,l.value=0},Zu)))}function c(g){o.value.splice(g,1)}async function d(g,b){const _=s.value[g];s.value.splice(g,1),await _.actions.find(P=>P.name===b).exec()}return Fe(()=>e.loading,g=>{u(g)}),(g,b)=>(j(),N("div",{id:"messageConsole",class:Le({vertical:ie(a)})},[r.value?(j(),N("p",Ab,"Loading...")):he("",!0),(j(!0),N(ce,null,qe(n.value,(_,w)=>(j(),N("p",{key:_+"_"+w},Te(_),1))),128)),(j(!0),N(ce,null,qe(s.value,(_,w)=>(j(),N("p",{class:"error",key:"resolvableError_"+w},[Q(Te(_.message)+" ",1),(j(!0),N(ce,null,qe(_.actions,P=>(j(),N("a",{href:"#",key:"resolvableError_"+w+P.name,onClick:y=>d(w,P.name)},"["+Te(P.name)+"]",9,Mb))),128))]))),128)),(j(!0),N(ce,null,qe(o.value,(_,w)=>(j(),N("p",{class:"error",key:"error_"+w},[Q(Te(_)+" ",1),p("a",{href:"#",onClick:P=>c(w)},"[Dismiss]",8,Bb)]))),128))],2))}}),Be=(t,e)=>{const n=t.__vccOpts||t;for(const[o,s]of e)n[o]=s;return n},Lb=Be(Db,[["__scopeId","data-v-6b48a3f4"]]),Nb={key:0,id:"submit-options"},Fb=["onClick"],Hb={key:0,id:"submit-options"},Vb=["onClick"],Ub=Oe({__name:"modal-dialog",props:{noBaseSize:{type:Boolean,default:!1},options:{default:()=>[]}},emits:["leave","option"],setup(t,{emit:e}){const n=t,o=e,s=typeof HTMLDialogElement<"u",r=q(null);function i(){if(s){const u=r.value;u!=null&&!u.open&&u.showModal()}window.addEventListener("click",a)}function l(){if(s){const u=r.value;u!=null&&u.open&&u.close(),o("leave")}window.removeEventListener("click",a)}function a(u){const c=r.value;c!=null&&c.open?u.target===c&&(l(),u.preventDefault(),u.stopPropagation()):window.removeEventListener("click",a)}return Dt(i),Pf(i),Of(l),Sn(l),(u,c)=>s?(j(),N("dialog",{key:0,ref_key:"dialog",ref:r,class:Le(["native",{"base-size":!n.noBaseSize}]),onCancel:l},[qt(u.$slots,"default",{},void 0,!0),u.options.length>0?(j(),N("div",Nb,[(j(!0),N(ce,null,qe(u.options,d=>(j(),N("button",{key:d,class:"option",onClick:g=>o("option",d)},Te(d),9,Fb))),128))])):he("",!0)],34)):(j(),N("div",{key:1,class:"dialog-wrapper",onClick:c[1]||(c[1]=d=>o("leave"))},[p("dialog",{ref_key:"dialog",ref:r,open:"",class:Le({"base-size":!n.noBaseSize}),onClick:c[0]||(c[0]=fe(()=>{},["stop"]))},[qt(u.$slots,"default",{},void 0,!0),u.options.length>0?(j(),N("div",Hb,[(j(!0),N(ce,null,qe(n.options,d=>(j(),N("button",{key:d,class:"option",onClick:g=>o("option",d)},Te(d),9,Vb))),128))])):he("",!0)],2)]))}}),ao=Be(Ub,[["__scopeId","data-v-07b9fd71"]]),Wb="./",xa="/dddg-assets/v2/assets/",dt=`${Wb}packs/`,Sa=!0;function qb(){return dp().__VUE_DEVTOOLS_GLOBAL_HOOK__}function dp(){return typeof navigator<"u"&&typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}}const zb=typeof Proxy=="function",Gb="devtools-plugin:setup",Xb="plugin:settings:set";let Xn,Dl;function Yb(){var t;return Xn!==void 0||(typeof window<"u"&&window.performance?(Xn=!0,Dl=window.performance):typeof globalThis<"u"&&(!((t=globalThis.perf_hooks)===null||t===void 0)&&t.performance)?(Xn=!0,Dl=globalThis.perf_hooks.performance):Xn=!1),Xn}function Kb(){return Yb()?Dl.now():Date.now()}class Jb{constructor(e,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=n;const o={};if(e.settings)for(const i in e.settings){const l=e.settings[i];o[i]=l.defaultValue}const s=`__vue-devtools-plugin-settings__${e.id}`;let r=Object.assign({},o);try{const i=localStorage.getItem(s),l=JSON.parse(i);Object.assign(r,l)}catch{}this.fallbacks={getSettings(){return r},setSettings(i){try{localStorage.setItem(s,JSON.stringify(i))}catch{}r=i},now(){return Kb()}},n&&n.on(Xb,(i,l)=>{i===this.plugin.id&&this.fallbacks.setSettings(l)}),this.proxiedOn=new Proxy({},{get:(i,l)=>this.target?this.target.on[l]:(...a)=>{this.onQueue.push({method:l,args:a})}}),this.proxiedTarget=new Proxy({},{get:(i,l)=>this.target?this.target[l]:l==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(l)?(...a)=>(this.targetQueue.push({method:l,args:a,resolve:()=>{}}),this.fallbacks[l](...a)):(...a)=>new Promise(u=>{this.targetQueue.push({method:l,args:a,resolve:u})})})}async setRealTarget(e){this.target=e;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(await this.target[n.method](...n.args))}}function Zb(t,e){const n=t,o=dp(),s=qb(),r=zb&&n.enableEarlyProxy;if(s&&(o.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))s.emit(Gb,t,e);else{const i=r?new Jb(n,s):null;(o.__VUE_DEVTOOLS_PLUGINS__=o.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:e,proxy:i}),i&&e(i.proxiedTarget)}}/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var fp="store";function Qb(t){return t===void 0&&(t=null),kt(t!==null?t:fp)}function _o(t,e){Object.keys(t).forEach(function(n){return e(t[n],n)})}function em(t){return t!==null&&typeof t=="object"}function tm(t){return t&&typeof t.then=="function"}function nm(t,e){return function(){return t(e)}}function pp(t,e,n){return e.indexOf(t)<0&&(n&&n.prepend?e.unshift(t):e.push(t)),function(){var o=e.indexOf(t);o>-1&&e.splice(o,1)}}function hp(t,e){t._actions=Object.create(null),t._mutations=Object.create(null),t._wrappedGetters=Object.create(null),t._modulesNamespaceMap=Object.create(null);var n=t.state;Ir(t,n,[],t._modules.root,!0),_a(t,n,e)}function _a(t,e,n){var o=t._state,s=t._scope;t.getters={},t._makeLocalGettersCache=Object.create(null);var r=t._wrappedGetters,i={},l={},a=ia(!0);a.run(function(){_o(r,function(u,c){i[c]=nm(u,t),l[c]=D(function(){return i[c]()}),Object.defineProperty(t.getters,c,{get:function(){return l[c].value},enumerable:!0})})}),t._state=sn({data:e}),t._scope=a,t.strict&&lm(t),o&&n&&t._withCommit(function(){o.data=null}),s&&s.stop()}function Ir(t,e,n,o,s){var r=!n.length,i=t._modules.getNamespace(n);if(o.namespaced&&(t._modulesNamespaceMap[i],t._modulesNamespaceMap[i]=o),!r&&!s){var l=Pa(e,n.slice(0,-1)),a=n[n.length-1];t._withCommit(function(){l[a]=o.state})}var u=o.context=om(t,i,n);o.forEachMutation(function(c,d){var g=i+d;sm(t,g,c,u)}),o.forEachAction(function(c,d){var g=c.root?d:i+d,b=c.handler||c;rm(t,g,b,u)}),o.forEachGetter(function(c,d){var g=i+d;im(t,g,c,u)}),o.forEachChild(function(c,d){Ir(t,e,n.concat(d),c,s)})}function om(t,e,n){var o=e==="",s={dispatch:o?t.dispatch:function(r,i,l){var a=nr(r,i,l),u=a.payload,c=a.options,d=a.type;return(!c||!c.root)&&(d=e+d),t.dispatch(d,u)},commit:o?t.commit:function(r,i,l){var a=nr(r,i,l),u=a.payload,c=a.options,d=a.type;(!c||!c.root)&&(d=e+d),t.commit(d,u,c)}};return Object.defineProperties(s,{getters:{get:o?function(){return t.getters}:function(){return gp(t,e)}},state:{get:function(){return Pa(t.state,n)}}}),s}function gp(t,e){if(!t._makeLocalGettersCache[e]){var n={},o=e.length;Object.keys(t.getters).forEach(function(s){if(s.slice(0,o)===e){var r=s.slice(o);Object.defineProperty(n,r,{get:function(){return t.getters[s]},enumerable:!0})}}),t._makeLocalGettersCache[e]=n}return t._makeLocalGettersCache[e]}function sm(t,e,n,o){var s=t._mutations[e]||(t._mutations[e]=[]);s.push(function(i){n.call(t,o.state,i)})}function rm(t,e,n,o){var s=t._actions[e]||(t._actions[e]=[]);s.push(function(i){var l=n.call(t,{dispatch:o.dispatch,commit:o.commit,getters:o.getters,state:o.state,rootGetters:t.getters,rootState:t.state},i);return tm(l)||(l=Promise.resolve(l)),t._devtoolHook?l.catch(function(a){throw t._devtoolHook.emit("vuex:error",a),a}):l})}function im(t,e,n,o){t._wrappedGetters[e]||(t._wrappedGetters[e]=function(r){return n(o.state,o.getters,r.state,r.getters)})}function lm(t){Fe(function(){return t._state.data},function(){},{deep:!0,flush:"sync"})}function Pa(t,e){return e.reduce(function(n,o){return n[o]},t)}function nr(t,e,n){return em(t)&&t.type&&(n=e,e=t,t=t.type),{type:t,payload:e,options:n}}var am="vuex bindings",Qu="vuex:mutations",ni="vuex:actions",Yn="vuex",um=0;function cm(t,e){Zb({id:"org.vuejs.vuex",app:t,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[am]},function(n){n.addTimelineLayer({id:Qu,label:"Vuex Mutations",color:ec}),n.addTimelineLayer({id:ni,label:"Vuex Actions",color:ec}),n.addInspector({id:Yn,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree(function(o){if(o.app===t&&o.inspectorId===Yn)if(o.filter){var s=[];yp(s,e._modules.root,o.filter,""),o.rootNodes=s}else o.rootNodes=[mp(e._modules.root,"")]}),n.on.getInspectorState(function(o){if(o.app===t&&o.inspectorId===Yn){var s=o.nodeId;gp(e,s),o.state=pm(gm(e._modules,s),s==="root"?e.getters:e._makeLocalGettersCache,s)}}),n.on.editInspectorState(function(o){if(o.app===t&&o.inspectorId===Yn){var s=o.nodeId,r=o.path;s!=="root"&&(r=s.split("/").filter(Boolean).concat(r)),e._withCommit(function(){o.set(e._state.data,r,o.state.value)})}}),e.subscribe(function(o,s){var r={};o.payload&&(r.payload=o.payload),r.state=s,n.notifyComponentUpdate(),n.sendInspectorTree(Yn),n.sendInspectorState(Yn),n.addTimelineEvent({layerId:Qu,event:{time:Date.now(),title:o.type,data:r}})}),e.subscribeAction({before:function(o,s){var r={};o.payload&&(r.payload=o.payload),o._id=um++,o._time=Date.now(),r.state=s,n.addTimelineEvent({layerId:ni,event:{time:o._time,title:o.type,groupId:o._id,subtitle:"start",data:r}})},after:function(o,s){var r={},i=Date.now()-o._time;r.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},o.payload&&(r.payload=o.payload),r.state=s,n.addTimelineEvent({layerId:ni,event:{time:Date.now(),title:o.type,groupId:o._id,subtitle:"end",data:r}})}})})}var ec=8702998,dm=6710886,fm=16777215,vp={label:"namespaced",textColor:fm,backgroundColor:dm};function bp(t){return t&&t!=="root"?t.split("/").slice(-2,-1)[0]:"Root"}function mp(t,e){return{id:e||"root",label:bp(e),tags:t.namespaced?[vp]:[],children:Object.keys(t._children).map(function(n){return mp(t._children[n],e+n+"/")})}}function yp(t,e,n,o){o.includes(n)&&t.push({id:o||"root",label:o.endsWith("/")?o.slice(0,o.length-1):o||"Root",tags:e.namespaced?[vp]:[]}),Object.keys(e._children).forEach(function(s){yp(t,e._children[s],n,o+s+"/")})}function pm(t,e,n){e=n==="root"?e:e[n];var o=Object.keys(e),s={state:Object.keys(t.state).map(function(i){return{key:i,editable:!0,value:t.state[i]}})};if(o.length){var r=hm(e);s.getters=Object.keys(r).map(function(i){return{key:i.endsWith("/")?bp(i):i,editable:!1,value:Ll(function(){return r[i]})}})}return s}function hm(t){var e={};return Object.keys(t).forEach(function(n){var o=n.split("/");if(o.length>1){var s=e,r=o.pop();o.forEach(function(i){s[i]||(s[i]={_custom:{value:{},display:i,tooltip:"Module",abstract:!0}}),s=s[i]._custom.value}),s[r]=Ll(function(){return t[n]})}else e[n]=Ll(function(){return t[n]})}),e}function gm(t,e){var n=e.split("/").filter(function(o){return o});return n.reduce(function(o,s,r){var i=o[s];if(!i)throw new Error('Missing module "'+s+'" for path "'+e+'".');return r===n.length-1?i:i._children},e==="root"?t:t.root._children)}function Ll(t){try{return t()}catch(e){return e}}var Lt=function(e,n){this.runtime=n,this._children=Object.create(null),this._rawModule=e;var o=e.state;this.state=(typeof o=="function"?o():o)||{}},wp={namespaced:{configurable:!0}};wp.namespaced.get=function(){return!!this._rawModule.namespaced};Lt.prototype.addChild=function(e,n){this._children[e]=n};Lt.prototype.removeChild=function(e){delete this._children[e]};Lt.prototype.getChild=function(e){return this._children[e]};Lt.prototype.hasChild=function(e){return e in this._children};Lt.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)};Lt.prototype.forEachChild=function(e){_o(this._children,e)};Lt.prototype.forEachGetter=function(e){this._rawModule.getters&&_o(this._rawModule.getters,e)};Lt.prototype.forEachAction=function(e){this._rawModule.actions&&_o(this._rawModule.actions,e)};Lt.prototype.forEachMutation=function(e){this._rawModule.mutations&&_o(this._rawModule.mutations,e)};Object.defineProperties(Lt.prototype,wp);var Wn=function(e){this.register([],e,!1)};Wn.prototype.get=function(e){return e.reduce(function(n,o){return n.getChild(o)},this.root)};Wn.prototype.getNamespace=function(e){var n=this.root;return e.reduce(function(o,s){return n=n.getChild(s),o+(n.namespaced?s+"/":"")},"")};Wn.prototype.update=function(e){kp([],this.root,e)};Wn.prototype.register=function(e,n,o){var s=this;o===void 0&&(o=!0);var r=new Lt(n,o);if(e.length===0)this.root=r;else{var i=this.get(e.slice(0,-1));i.addChild(e[e.length-1],r)}n.modules&&_o(n.modules,function(l,a){s.register(e.concat(a),l,o)})};Wn.prototype.unregister=function(e){var n=this.get(e.slice(0,-1)),o=e[e.length-1],s=n.getChild(o);s&&s.runtime&&n.removeChild(o)};Wn.prototype.isRegistered=function(e){var n=this.get(e.slice(0,-1)),o=e[e.length-1];return n?n.hasChild(o):!1};function kp(t,e,n){if(e.update(n),n.modules)for(var o in n.modules){if(!e.getChild(o))return;kp(t.concat(o),e.getChild(o),n.modules[o])}}function vm(t){return new vt(t)}var vt=function(e){var n=this;e===void 0&&(e={});var o=e.plugins;o===void 0&&(o=[]);var s=e.strict;s===void 0&&(s=!1);var r=e.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Wn(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var i=this,l=this,a=l.dispatch,u=l.commit;this.dispatch=function(g,b){return a.call(i,g,b)},this.commit=function(g,b,_){return u.call(i,g,b,_)},this.strict=s;var c=this._modules.root.state;Ir(this,c,[],this._modules.root),_a(this,c),o.forEach(function(d){return d(n)})},Oa={state:{configurable:!0}};vt.prototype.install=function(e,n){e.provide(n||fp,this),e.config.globalProperties.$store=this;var o=this._devtools!==void 0?this._devtools:!1;o&&cm(e,this)};Oa.state.get=function(){return this._state.data};Oa.state.set=function(t){};vt.prototype.commit=function(e,n,o){var s=this,r=nr(e,n,o),i=r.type,l=r.payload,a={type:i,payload:l},u=this._mutations[i];u&&(this._withCommit(function(){u.forEach(function(d){d(l)})}),this._subscribers.slice().forEach(function(c){return c(a,s.state)}))};vt.prototype.dispatch=function(e,n){var o=this,s=nr(e,n),r=s.type,i=s.payload,l={type:r,payload:i},a=this._actions[r];if(a){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(l,o.state)})}catch{}var u=a.length>1?Promise.all(a.map(function(c){return c(i)})):a[0](i);return new Promise(function(c,d){u.then(function(g){try{o._actionSubscribers.filter(function(b){return b.after}).forEach(function(b){return b.after(l,o.state)})}catch{}c(g)},function(g){try{o._actionSubscribers.filter(function(b){return b.error}).forEach(function(b){return b.error(l,o.state,g)})}catch{}d(g)})})}};vt.prototype.subscribe=function(e,n){return pp(e,this._subscribers,n)};vt.prototype.subscribeAction=function(e,n){var o=typeof e=="function"?{before:e}:e;return pp(o,this._actionSubscribers,n)};vt.prototype.watch=function(e,n,o){var s=this;return Fe(function(){return e(s.state,s.getters)},n,Object.assign({},o))};vt.prototype.replaceState=function(e){var n=this;this._withCommit(function(){n._state.data=e})};vt.prototype.registerModule=function(e,n,o){o===void 0&&(o={}),typeof e=="string"&&(e=[e]),this._modules.register(e,n),Ir(this,this.state,e,this._modules.get(e),o.preserveState),_a(this,this.state)};vt.prototype.unregisterModule=function(e){var n=this;typeof e=="string"&&(e=[e]),this._modules.unregister(e),this._withCommit(function(){var o=Pa(n.state,e.slice(0,-1));delete o[e[e.length-1]]}),hp(this)};vt.prototype.hasModule=function(e){return typeof e=="string"&&(e=[e]),this._modules.isRegistered(e)};vt.prototype.hotUpdate=function(e){this._modules.update(e),hp(this,!0)};vt.prototype._withCommit=function(e){var n=this._committing;this._committing=!0,e(),this._committing=n};Object.defineProperties(vt.prototype,Oa);const bm="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",lt=class lt{constructor(e,n,o){B(this,"onlineRepo");B(this,"localRepo");B(this,"tempRepo",sn({authors:{},packs:[]}));B(this,"combinedList");B(this,"authors");this.$store=o,window.repo=this,e||(e={authors:{},packs:[]},$e.fire(new Ot("Couldn't load remote repository."))),n||(n={authors:{},packs:[]},ge.supports.localRepo&&$e.fire(new Ot("Couldn't load local repository."))),this.onlineRepo=q(e),this.localRepo=q(n),this.combinedList=D(()=>{const s=this.onlineRepo.value,r=(s==null?void 0:s.packs)??[],i=new Map(r.map(y=>[y.id,y])),l=this.localRepo.value,a=(l==null?void 0:l.packs)??[],u=new Map(a.map(y=>[y.id,y])),d=this.tempRepo.packs,g=new Map(d.map(y=>[y.id,y])),b=new Set(ge.state.autoAdd),_=this.$store.state.content.contentPacks.map(y=>y.packId).filter(y=>y!=null),w=new Set(_),P=new Set;return[..._,...a.map(y=>y.id),...r.map(y=>y.id),...d.map(y=>y.id)].filter(y=>y.startsWith("dddg.buildin.")||y.startsWith("dddg.uploads.")||y.startsWith("dddg.desktop.")||y==="concept_femc.shido_draws.edave64"||P.has(y)?!1:(P.add(y),!0)).map(y=>({...i.get(y)??{characters:[],kind:[],authors:[]},...u.get(y),...g.get(y),autoloading:b.has(y),installed:u.has(y),online:i.has(y)||g.has(y),loaded:w.has(y)}))}),this.authors=D(()=>{const s=this.onlineRepo.value,r=(s==null?void 0:s.authors)??{},i=this.localRepo.value,l=(i==null?void 0:i.authors)??{};return{...r,...l}}),Object.freeze(this)}static getInstance(){return lt.instance||(lt.instance=this.createInstance()),lt.instance}static async createInstance(){const e=lt.loadRepo(bm),n=ge.supports.localRepo?await lt.loadRepo(ge.localRepositoryUrl):null,[o,s,r]=await Promise.all([e,n,lt.$store]);return new lt(o,s,r)}static async loadRepo(e){try{const[n,o]=await Promise.all([lt.fetchJSON(e+"repo.json"),lt.fetchJSON(e+"people.json")]);return{packs:n,authors:o}}catch{return null}}static async fetchJSON(e){const n=await fetch(e);if(!n.ok)throw new Error("Could not load json");return await n.json()}async reloadLocalRepo(){this.localRepo.value=ge.supports.localRepo?await lt.loadRepo(ge.localRepositoryUrl):null}getPacks(){return this.combinedList.value}hasPack(e,n=!1){var o;return n?!!((o=this.onlineRepo.value)!=null&&o.packs.find(s=>s.id===e)):!!this.getPacks().find(s=>s.id===e)}getPack(e){return this.getPacks().find(n=>n.id===e)??null}getAuthor(e){return this.authors.value[e]||null}getAuthors(){return this.authors.value}async loadTempPack(e){const n=fetch(e);let o;try{o=await n}catch{throw new Error(`Failed to load '${e}'`)}if(!o.ok)throw o.status===404?new Error(`The pack '${e}' does not exist anymore.`):new Error(`Failed to load '${e}': ${o.statusText||o.status}`);let s;try{s=await o.json()}catch(i){throw new Error(`The contents of '${e}' is not a valid JSON: ${i.message}`)}if(!s.pack&&(!s.packs||s.packs.length===0))throw new Error(`The json file '${e}' does not contain any packages`);if(s.authors)for(const i in s.authors)this.tempRepo.authors[i]&&(this.tempRepo.authors[i]=s.authors[i]);let r=null;if(s.pack&&(this.addTempPack(s.pack,e),r=s.pack.id),s.packs)for(const i of s.packs)this.addTempPack(i,e),r===null&&(r=i.id);return r}addTempPack(e,n){if(e.repoUrl=n,e.dddg1Path&&(e.dddg1Path=new URL(e.dddg1Path,n).toString()),e.dddg2Path&&(e.dddg2Path=new URL(e.dddg2Path,n).toString()),e.preview)for(let o=0;o<e.preview.length;++o)e.preview[o]=new URL(e.preview[o],n).toString();this.tempRepo.packs.find(o=>o.id===e.id)||this.tempRepo.packs.push(e)}};B(lt,"instance"),B(lt,"setStore"),B(lt,"$store",new Promise(e=>{lt.setStore=e}));let kn=lt;const oe=Cp();function Cp(){const t=[];let e=!1;return function(o){return new Promise(s=>{const r=async()=>{try{o.length>0?await o(Cp()):await o()}catch(i){console.log("Error during transaction!: ",i)}finally{e=!1}t.length>0&&t.shift()(),s()};e?t.push(r):r()})}}const or=navigator.userAgent,mm=!!or.match(/iPad/i)||!!or.match(/iPhone/i),ym=!!or.match(/WebKit/i),tc=mm&&ym&&!or.match(/CriOS/i);class xp{constructor(){B(this,"state",sn({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder",hasTemplate:!1}));B(this,"supports");B(this,"_gameMode",null);B(this,"$store",null);B(this,"isSavingEnabled",q(!1));B(this,"localRepositoryUrl","");B(this,"loading");B(this,"creatingDB");B(this,"loadingContentPacksAllowed");B(this,"loadContentPacks");B(this,"updateProgress",null);const e=Qe.canSave(),n=this.isSavingEnabled;window.addEventListener("beforeunload",o=>{o.preventDefault(),o.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise(o=>{this.loadContentPacks=()=>o()}),this.supports=sn({optionalSaving:e,get autoLoading(){return e&&n.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!tc,allowWebP:!0,limitedCanvasSpace:tc}),e?this.loading=(async()=>{this.savingEnabled=await Qe.doesDbExists()})():this.loading=Promise.resolve(),this.loading.then(async()=>{if(await this.loadingContentPacksAllowed,this.creatingDB&&await this.creatingDB,this.savingEnabled){const o=await Qe.loadAutoload()??[];this.state.autoAdd=o;const s=await kn.getInstance(),r=await Promise.all(o.map(async i=>{const[l,a]=i.split(";",2);a!=null&&!s.hasPack(l)&&await s.loadTempPack(a);const u=s.getPack(l);return u.dddg2Path??u.dddg1Path}));await oe(async()=>{await this.$store.dispatch("content/loadContentPacks",r)})}})}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(e){e?(localStorage.setItem("saving","true"),this.creatingDB=Qe.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=Qe.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}storeSaveFile(e,n){const o=document.createElement("a"),s=URL.createObjectURL(e);return o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),Promise.resolve()}async loadGameMode(){const n=new URLSearchParams(location.search).get("mode");if(n==="ddlc"||n==="ddlc_plus"){this._gameMode=n;return}await this.loading,await this.creatingDB;let o="";this.isSavingEnabled.value&&(o=await Qe.loadGameMode());let s="ddlc";(o==="ddlc"||o==="ddlc_plus")&&(s=o),this._gameMode=s}async setGameMode(e){this.isSavingEnabled.value&&await Qe.saveGameMode(e);const n=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${n}?mode=${e}`}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(){throw new Error("Method not implemented.")}connectToStore(e){this.$store=e}openNewWindow(){const e=window.open(void 0,"_blank","left=100,top=100");return!e||e.closed?null:e}async saveToFile(e,n,o="image/png",s=1){const r=document.createElement("a");r.setAttribute("download",n);const i=await this.createObjectURL(e,o,s);return r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),i}localRepoInstall(){return Promise.reject(new Error("This environment does not support a local repository"))}localRepoUninstall(){throw new Error("This environment does not support a local repository")}async autoLoadAdd(e){await this.loading,await this.creatingDB,await Qe.saveAutoload([...this.state.autoAdd,e]),this.state.autoAdd.push(e)}async autoLoadRemove(e){await this.loading,await this.creatingDB;const n=this.normalizePackId(e);await Qe.saveAutoload(this.state.autoAdd.filter(s=>this.normalizePackId(s)!=n));const o=this.state.autoAdd.indexOf(e);this.state.autoAdd.splice(o,1)}normalizePackId(e){const n=e.split(";");return n.length===1?n[0]:n[n.length-1]}async loadSettings(){await this.loading,await this.creatingDB;const e={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?{...e,...await Qe.loadSettings()}:e}async saveSettings(e){await this.loading,await this.creatingDB,this.isSavingEnabled.value&&await Qe.saveSettings(e)}async loadDefaultTemplate(){var n;if(await this.loading,await this.creatingDB,!this.isSavingEnabled.value)return!1;const e=await Qe.loadTemplate();return e==null?!1:(this.state.hasTemplate=!0,await((n=this.$store)==null?void 0:n.dispatch("loadSave",e)),!0)}async saveDefaultTemplate(){var n;if(await this.loading,await this.creatingDB,!this.isSavingEnabled.value)return;const e=await((n=this.$store)==null?void 0:n.dispatch("getSave",!0));Qe.saveTemplate(e),this.state.hasTemplate=!0}async clearDefaultTemplate(){await this.loading,await this.creatingDB,this.isSavingEnabled.value&&(await Qe.saveTemplate(null),this.state.hasTemplate=!1)}async isInitialized(){await this.loading,await this.creatingDB}prompt(e,n){return new Promise(o=>{o(prompt(e,n))})}onPanelChange(){}createObjectURL(e,n,o){return new Promise((s,r)=>{if(!(window.URL!=null&&window.URL.createObjectURL!=null))return s(e.toDataURL(n,o));if(e.toBlob!=null)e.toBlob(l=>{if(!l){r();return}s(URL.createObjectURL(l))},n,o);else{const l=e.toDataURL(n,o),a=this.dataURItoBlob(l,n);s(URL.createObjectURL(a))}})}dataURItoBlob(e,n){const o=atob(e.split(",")[1]),s=o.length,r=new Uint8Array(s);for(let i=0;i<s;i++)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})}}const Qe={indexedDB:(()=>{try{return window.indexedDB??window.mozIndexedDB??window.webkitIndexedDB??window.msIndexedDB??null}catch{return null}})(),transaction:(()=>{try{return window.IDBTransaction??window.mozIDBTransaction??window.webkitIDBTransaction??window.msIDBTransaction??null}catch{return null}})(),db:null,canSave(){return!!(Qe.indexedDB&&window.localStorage!=null)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return Qe.db?Qe.db:Qe.db=new Promise((t,e)=>{const n=Qe.indexedDB.open("dddg",3);n.onerror=o=>{e(o)},n.onupgradeneeded=o=>{const s=n.result,r=o.oldVersion??o.version;r<1&&s.createObjectStore("settings"),r===1&&(s.deleteObjectStore("settings"),s.createObjectStore("settings"))},n.onsuccess=()=>{t(n.result)}})},clearDB(){return new Promise((t,e)=>{if(!Qe.db){t();return}const n=Qe.indexedDB.deleteDatabase("dddg");Qe.db=null,n.onerror=o=>{e(o)},n.onsuccess=()=>{t()}})},loadAutoload(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("autoload")))},saveAutoload(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put([...t],"autoload"))})},loadGameMode(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("gameMode")))},saveGameMode(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put(t,"gameMode"))})},saveTemplate(t){return this.objectStorePromise("readwrite",async e=>{t==null?await this.reqPromise(e.delete("template")):await this.reqPromise(e.put(t,"template"))})},loadTemplate(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("template")))},saveSettings(t){return this.objectStorePromise("readwrite",async e=>{await this.reqPromise(e.put({...t},"settings"))})},loadSettings(){return this.objectStorePromise("readonly",async t=>await this.reqPromise(t.get("settings")))},async objectStorePromise(t,e){const n=await this.db;if(!n)throw new Error("No database");const s=n.transaction(["settings"],t).objectStore("settings");return await e(s)},reqPromise(t){return new Promise((e,n)=>{t.onerror=o=>{n(o)},t.onsuccess=()=>{e(t.result)}})}};class wm extends xp{saveToFile(e,n,o="image/png",s=1){let r=e.toDataURL(o,s);const i=this.dataURItoBlob(r,o);return window.URL!=null&&window.URL.createObjectURL!=null&&(r=URL.createObjectURL(i)),window.navigator.msSaveBlob(i,n),Promise.resolve(r)}}class km{constructor(){B(this,"state",sn({looseTextParsing:!0,autoAdd:[],downloadLocation:"",hasTemplate:!1}));B(this,"localRepositoryUrl","/repo/");B(this,"_gameMode",null);B(this,"electron",window);B(this,"$store",null);B(this,"bgInvalidation",null);B(this,"pendingContentPacks",[]);B(this,"pendingContentPacksReplace",[]);B(this,"loadingContentPacksAllowed");B(this,"loadContentPacks");B(this,"updateProgress",q("wait"));B(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0,allowWebP:!0,limitedCanvasSpace:!1});B(this,"savingEnabled",!0);this.loadingContentPacksAllowed=new Promise(n=>{this.loadContentPacks=()=>n()}),this.electron.ipcRenderer.on("add-persistent-content-pack",async n=>{if(await this.loadingContentPacksAllowed,!this.$store){this.pendingContentPacks.push(n);return}await oe(async()=>{await this.$store.dispatch("content/loadContentPacks",n)})}),this.electron.ipcRenderer.on("add-persistent-background",async n=>{const o="persistentBg-"+n,s=n.split("/");_p(o,n),nc.backgrounds.push({id:o,variants:[[o]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()}),this.electron.ipcRenderer.on("push-message",n=>{$e.fire(new Ot(n))}),this.electron.ipcRenderer.on("config.downloadFolderUpdate",n=>{this.state.downloadLocation=n}),this.electron.ipcRenderer.onConversation("load-packs",async n=>{const o=await kn.getInstance(),s=await Promise.all(n.map(async r=>{const[i,l]=r.split(";",2);l!=null&&!o.hasPack(i)&&await o.loadTempPack(l);const a=o.getPack(i);return a.dddg2Path||a.dddg1Path}));if(!this.$store){s.forEach(r=>this.pendingContentPacks.push(r));return}await oe(async()=>{await this.$store.dispatch("content/loadContentPacks",s)})}),this.electron.ipcRenderer.onConversation("auto-load.changed",n=>{this.state.autoAdd=n}),this.electron.ipcRenderer.onConversation("reload-repo",async()=>{await(await kn.getInstance()).reloadLocalRepo()}),this.electron.ipcRenderer.onConversation("replace-pack",async n=>{const o={processed:!1,contentPack:n};this.$store?await oe(async()=>{await this.$store.dispatch("content/replaceContentPack",o)}):this.pendingContentPacksReplace.push(o)}),this.electron.ipcRenderer.onConversation("resolvable-error",(n,o)=>new Promise(s=>{$e.fire(new Ca(n,o.map(r=>({exec:()=>s(r),name:r}))))}));let e=!1;this.electron.ipcRenderer.on("update.progress",n=>{this.updateProgress.value=n,n==="done"?(e=!1,$e.fire(new Ot("An update is downloaded and will be installed once DDDG closes."))):e||(e=!0,$e.fire(new Ot("An update was found and will download in the background.")))}),this.electron.ipcRenderer.on("update.checkStopped",()=>{this.updateProgress.value="none"}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}loadDefaultTemplate(){throw new Error("Method not implemented.")}saveDefaultTemplate(){throw new Error("Method not implemented.")}clearDefaultTemplate(){throw new Error("Method not implemented.")}storeSaveFile(e,n){const o=document.createElement("a"),s=URL.createObjectURL(e);return o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),Promise.resolve()}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(e){this.electron.ipcRenderer.send("open-folder",e)}onPanelChange(){}async saveSettings(e){await this.electron.ipcRenderer.sendConvo("config.set","nsfw",e.nsfw),await this.electron.ipcRenderer.sendConvo("config.set","darkMode",e.darkMode??void 0),await this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",e.defaultCharacterTalkingZoom)}async loadGameMode(){this._gameMode=await this.electron.ipcRenderer.sendConvo("config.get","gameMode")||"ddlc"}async setGameMode(e){await this.electron.ipcRenderer.sendConvo("config.set","gameMode",e),this.electron.ipcRenderer.send("reload")}async loadSettings(){return{lq:!1,nsfw:await this.electron.ipcRenderer.sendConvo("config.get","nsfw")??!1,darkMode:await this.electron.ipcRenderer.sendConvo("config.get","darkMode")??void 0,defaultCharacterTalkingZoom:await this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom")??void 0}}async localRepoInstall(e,n,o){await this.electron.ipcRenderer.sendConvo("repo.install",e,n,o)}async localRepoUninstall(e){await this.electron.ipcRenderer.sendConvo("repo.uninstall",e)}async autoLoadAdd(e){await this.electron.ipcRenderer.sendConvo("auto-load.add",e)}async autoLoadRemove(e){await this.electron.ipcRenderer.sendConvo("auto-load.remove",e)}saveToFile(e,n,o="image/png",s=1){return new Promise((r,i)=>{e.toBlob(async l=>{if(!l){i();return}const a=await l.arrayBuffer();await this.electron.ipcRenderer.sendConvo("save-file",n,new Uint8Array(a)),r(URL.createObjectURL(l))},o,s)})}async prompt(e,n){return await this.electron.ipcRenderer.sendConvo("show-prompt",e,n)}openNewWindow(){return window.open(void 0,"_blank","left=100,top=100")}connectToStore(e){this.$store=e,this.invalidateInstalledBGs(),oe(async()=>{if(this.pendingContentPacks.length>0&&await this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks),this.pendingContentPacksReplace.length>0)for(const n of this.pendingContentPacksReplace)await this.$store.dispatch("content/replaceContentPack",n)})}invalidateInstalledBGs(){this.$store&&this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation!=null&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),this.$store&&oe(async()=>{await this.$store.dispatch("content/replaceContentPack",{contentPack:nc})})}}const nc={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};function Cm(){return window.isElectron?new km:"msSaveOrOpenBlob"in window.navigator?new wm:new xp}const ge=Cm(),Sp="data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3c!--%20Source:%20https://fonts.google.com/icons?selected=Material%2520Icons%2520Round%253Awarning%253A%20--%3e%3csvg%20fill='%23FFFFFF'%20version='1.1'%20viewBox='0%200%2024%2024'%20xmlns='http://www.w3.org/2000/svg'%3e%3cdefs%3e%3cfilter%20id='a'%20x='-.07126'%20y='-.079384'%20width='1.1425'%20height='1.1597'%20color-interpolation-filters='sRGB'%3e%3cfeGaussianBlur%20stdDeviation='0.36070242'/%3e%3c/filter%3e%3c/defs%3e%3cpath%20d='M4.47%2021h15.06c1.54%200%202.5-1.67%201.73-3L13.73%204.99c-.77-1.33-2.69-1.33-3.46%200L2.74%2018c-.77%201.33.19%203%201.73%203zM12%2014c-.55%200-1-.45-1-1v-2c0-.55.45-1%201-1s1%20.45%201%201v2c0%20.55-.45%201-1%201zm1%204h-2v-2h2v2z'%20fill='%23fff'%20filter='url(%23a)'%20stroke='%23fff'/%3e%3cpath%20d='M4.47%2021h15.06c1.54%200%202.5-1.67%201.73-3L13.73%204.99c-.77-1.33-2.69-1.33-3.46%200L2.74%2018c-.77%201.33.19%203%201.73%203zM12%2014c-.55%200-1-.45-1-1v-2c0-.55.45-1%201-1s1%20.45%201%201v2c0%20.55-.45%201-1%201zm1%204h-2v-2h2v2z'%20fill='%23000'/%3e%3c/svg%3e";class Fn{constructor(e){B(this,"width");B(this,"height");this.html=e,this.width=e.width,this.height=e.height}paintOnto(e,n={}){const{w:o,h:s}={w:this.width,h:this.height,...n},{x:r,y:i}={x:-o/2,y:-s/2,...n};e.drawImage(this.html,r,i,o,s)}}let Nl=null;setTimeout(()=>vo(Sp).then(t=>{t instanceof Fn&&(Nl=t)}),0);class fs{constructor(){B(this,"width",300);B(this,"height",300)}paintOnto(e,n={}){Nl&&Nl.paintOnto(e,n)}}let oi;function go(){if(oi)return oi;if(!ge.supports.allowWebP)return Promise.resolve(!1);const t="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",e="data:image/webp;base64,UklGRogAAABXRUJQVlA4THwAAAAv/8SzAA/wGbPPmH3GbP7jAQSSNu9f+rzDwYj+G23bpt3Gx3xD8353j73f5b87+e9OALmT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9OAriT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9O/rsTwe7kvzsL";return oi=(async()=>{const n=await Promise.all([Fl(t,1,2),Fl(e,720,1280)]);return n[0]&&n[1]})()}function Fl(t,e,n){return new Promise(o=>{const s=document.createElement("img");s.addEventListener("load",()=>{o(s.width===n&&s.height===e)}),s.addEventListener("error",()=>{o(!1)}),s.src=t})}let si;function xm(){return si||(si=(async()=>await Fl("data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",1,2))())}class Sm{constructor(){B(this,"cache",new Map)}get(e){const n=this.cache.get(e);if(n)return n;const o=rr(e);return this.cache.set(e,o),o}remove(e){this.cache.delete(e)}}class _m{constructor(){B(this,"cache",new Map)}get(e){var s;const n=(s=this.cache.get(e))==null?void 0:s.deref();if(n)return n;const o=Om(e);return this.cache.set(e,new WeakRef(o)),o}remove(e){this.cache.delete(e)}}let ri=null;function sr(){return ri||(window.assetCache=ri=ge.supports.assetCaching||typeof WeakRef>"u"?new Sm:new _m)}const Hn={};function Ia(t,e=!0){return vo(ge.supports.lq&&!e?t.lq:t.hq)}function mn(t,e=!0){const n=ge.supports.lq&&Sa&&!e?t.lq:t.hq;return Hn[n]?Hn[n]:n}function vo(t){return Hn[t]&&(t=Hn[t]),sr().get(t)}async function ps(t,e=!0){const n=`${xa}${t}${ge.supports.lq&&Sa&&!e?".lq":""}${await go()?".webp":".png"}`.replace(/\/+/,"/");return await sr().get(n)}async function Pm(t,e=!0){return`${xa}${t}${ge.supports.lq&&Sa&&!e?".lq":""}${await go()?".webp":".png"}`.replace(/\/+/,"/")}function _p(t,e){Hn[t]=e}async function Om(t){const e=!!Hn[t];return e&&(t=Hn[t]),await(async()=>{try{return await rr(t)}catch{if(t.endsWith(".webp")&&!e)try{return await rr(t.replace(/\.webp$/,".png"))}catch{return $e.fire(new Zs(t)),sr().remove(t),new fs}else return $e.fire(new Zs(t)),sr().remove(t),new fs}})()}function rr(t,e=!1){return new Promise(n=>{const o=new Image;o.addEventListener("load",()=>{n(new Fn(o)),(e||!ge.supports.assetCaching)&&document.body.removeChild(o)}),o.addEventListener("error",()=>{n(new fs),(e||!ge.supports.assetCaching)&&document.body.removeChild(o)}),o.crossOrigin="Anonymous",o.src=t,o.style.display="none",document.body.appendChild(o)})}const Rt=class Rt{constructor(e,n,o,s){this.r=e,this.g=n,this.b=o,this.a=s,Object.freeze(this)}static validCss(e){return this.validCssRgb(e)||this.validHex(e)}static fromCss(e){if(this.validCssRgb(e))return this.fromCssRgb(e);if(this.validHex(e))return this.fromHex(e);throw new Error("Invalid RGB color format")}static validCssRgb(e){return this.rgbEx.test(e)||this.rgbaEx.test(e)}static fromCssRgb(e){if(!this.validCssRgb(e))throw new Error("Invalid RGB color format");const n=e.slice(0,-1),o=n.indexOf("("),r=n.slice(o+1).split(",").map(i=>parseFloat(i.trim()));return new Rt(r[0],r[1],r[2],r.length===4?r[3]:1)}static validHex(e){return this.hexShortEx.test(e)||this.hexLongEx.test(e)}static fromHex(e){if(!this.validHex(e))throw new Error("Invalid Hex color format");const n=e.slice(1);if(n.length===3)return new Rt(parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),1);if(n.length===4)return new Rt(parseInt(n[0]+n[0],16),parseInt(n[1]+n[1],16),parseInt(n[2]+n[2],16),parseInt(n[3]+n[3],16)/255);if(n.length===6)return new Rt(parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16),1);if(n.length===8)return new Rt(parseInt(n[0]+n[1],16),parseInt(n[2]+n[3],16),parseInt(n[4]+n[5],16),parseInt(n[6]+n[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:e,g:n,b:o}=this;const{a:s}=this;e/=255,n/=255,o/=255;const r=Math.max(e,n,o),i=Math.min(e,n,o);let l,a;const u=(r+i)/2;if(r===i)l=a=0;else{const c=r-i;switch(a=u>.5?c/(2-r-i):c/(r+i),r){case e:l=(n-o)/c+(n<o?6:0);break;case n:l=(o-e)/c+2;break;case o:l=(e-n)/c+4;break}l/=6}return new He(l,a,u,s)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};B(Rt,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i),B(Rt,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i),B(Rt,"hexShortEx",/^#[0-9A-F]{3,4}$/i),B(Rt,"hexLongEx",/^#[0-9A-F]{6,8}$/i);let De=Rt;class He{constructor(e,n,o,s){this.h=e,this.s=n,this.l=o,this.a=s,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(e){let{h:n,s:o,l:s,a:r}=this;return n+=e.h,n>=1?n-=1:n<0&&(n+=1),o+e.s>1?o-=e.s:(o+=e.s,o<0&&(o=0)),s+e.l>1||s+e.l<0?s-=e.l:s+=e.l,r+e.a>1||r+e.a<0?r-=e.a:r+=e.a,new He(n,o,s,r)}toRgb(){const{h:e,s:n,l:o,a:s}=this;let r,i,l;if(n===0)r=i=l=o;else{const a=o<.5?o*(1+n):o+n-o*n,u=2*o-a;r=He.hue2rgb(u,a,e+1/3),i=He.hue2rgb(u,a,e),l=He.hue2rgb(u,a,e-1/3)}return new De(Math.round(r*255),Math.round(i*255),Math.round(l*255),s)}toHSL(){return this}static hue2rgb(e,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?e+(n-e)*6*o:o<1/2?n:o<2/3?e+(n-e)*(2/3-o)*6:e}}const Tr=1280,Ta=720,Im=128,Tm=32,jm="rgba(60,60,60,0.8)",$m=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Pp=1,Rm=1/1.5,Am=-74,Mm=358,Bm=[200,240,400,493,640,786,880,1040,1080],Em=Object.freeze(Object.defineProperty({__proto__:null,BaseCharacterYPos:Mm,CloseUpYOffset:Am,WheelBackground:jm,characterPositions:Bm,hdCharacterScaleFactor:Rm,positions:$m,screenHeight:Ta,screenWidth:Tr,sdCharacterScaleFactor:Pp,wheelInnerRadius:Im,wheelWidth:Tm},Symbol.toStringTag,{value:"Module"})),Dm=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Lm="#ffe6f4",Nm="#ffbde1",Fm=420,Hm=22,Vm=640,Op=270,Um=7,Ip=3,Wm=Math.ceil(Ip/2),qm=(Ta-Op)/2,zm={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Gm=Object.freeze(Object.defineProperty({__proto__:null,ChoiceButtonBorderColor:Nm,ChoiceButtonColor:Lm,ChoiceButtonWidth:Fm,ChoiceOuterPadding:Wm,ChoicePadding:Um,ChoiceSpacing:Hm,ChoiceTextStyle:zm,ChoiceX:Vm,ChoiceY:qm,ChoiceYOffset:Op,Outline:Ip,nameboxTextOutlineDelta:Dm},Symbol.toStringTag,{value:"Module"})),Tp="#ffa8d2",Xm="#552222",Ym="#ffeef6",ja="#bb5599",jp=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),$p=new He(.002028397565922768,0,.13725490196078438,0),Rp=.82,Ap=new He(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Mp=12,Bp=12,Km=.6,Jm=new He(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Zm=new He(0,-.14285714285714296,.3,0),Qm=new He(.004269293924466178,-.01869158878504662,-.039215686274509665,0),ey=9.5,ty=47,Ep=new He(.0023347701149424305,0,.10784313725490202,0),Qn=3,Dp=Object.freeze(Object.defineProperty({__proto__:null,controlColorDelta:Jm,controlDisableColorDelta:Zm,controlsDefaultColor:Xm,dotColorDelta:Qm,dotPatternSize:ty,dotRadius:ey,nameColorThreshold:Km,nameboxBackgroundDelta:$p,nameboxDefaultColor:Ym,nameboxGradientEndDelta:Ap,nameboxGradientMiddleStopPosition:Rp,nameboxRounding:Mp,nameboxStrokeDefaultColor:ja,nameboxTextOutlineDelta:jp,textboxDefaultColor:Tp,textboxOutlineColorDelta:Ep,textboxOutlineWidth:Qn,textboxRounding:Bp},Symbol.toStringTag,{value:"Module"})),Po=816,$a=900,jr=146,ny=0,oy=29,sy=8,ks=38,$r=44,ry=6,iy=93,ly=404,ay=9,uy=9,Vn=39,Cs=168,xs=34,Rr=29,Ra=12,Aa=-126,Ma=-72,Ba=-38,Ea=30.75,Da=26,Lp=426,Hl=58,La={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Ar={...La,fontName:"riffic",fontSize:24,strokeColor:ja,strokeWidth:6,color:"white",letterSpacing:1},Na={align:"left",font:"13px aller",fill:{style:"#522"}},Np={...Na,fill:{style:"#a66"}},cy={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},Fa={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},Oo=Tr/2-Po/2,dy=Tr/2-$a/2,fy=Oo+ks,Fp=Oo+xs,py=Fp+Cs/2,hy=Oo+Aa,gy=Oo+Ma,vy=Oo+Ba,by="normal",my=Object.freeze(Object.defineProperty({__proto__:null,ArrowXRightOffset:Ea,ArrowYBottomOffset:Da,BaseTextStyle:La,ControlsTextDisabledStyle:Np,ControlsTextStyle:Na,ControlsXHistory:hy,ControlsXHistoryOffset:Aa,ControlsXSkip:gy,ControlsXSkipOffset:Ma,ControlsXStuff:vy,ControlsXStuffOffset:Ba,ControlsYBottomOffset:Ra,DefaultTextboxStyle:by,GlowRX:Lp,GlowRY:Hl,HdSideMargin:ly,HdSpacing:iy,NameboxHeight:Vn,NameboxTextStyle:Ar,NameboxTextX:py,NameboxTextYOffset:Rr,NameboxWidth:Cs,NameboxX:Fp,NameboxXOffset:xs,TextBoxBottomSpacing:ry,TextBoxCorruptedKerning:sy,TextBoxCorruptedStyle:cy,TextBoxCorruptedWidth:$a,TextBoxCorruptedX:dy,TextBoxHeight:jr,TextBoxKerning:ny,TextBoxLineHeight:oy,TextBoxStyle:Fa,TextBoxTextCorruptedXOffset:ay,TextBoxTextCorruptedYOffset:uy,TextBoxTextX:fy,TextBoxTextXOffset:ks,TextBoxTextYOffset:$r,TextBoxWidth:Po,TextBoxX:Oo},Symbol.toStringTag,{value:"Module"})),yy="#ffe6f4",wy="#ffbde1",ky="rgba(255,255,255,0.6)",Cy=40,xy=30,Sy={...La,fontName:"riffic",fontSize:24,strokeColor:ja,strokeWidth:8,letterSpacing:1,color:"white"},_y={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Py=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackdropColor:ky,NotificationBackgroundColor:yy,NotificationBorderColor:wy,NotificationOkTextStyle:Sy,NotificationPadding:Cy,NotificationSpacing:xy,NotificationTextStyle:_y},Symbol.toStringTag,{value:"Module"})),Hp=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Oy=0,Iy=0,Ty=Tr/2,jy=Ta/2,$y=33,Ry=100,Ay=30,My=800,By=720,Ey=Pp,Dy="#333333bf",Ly=480,Ny=180,Fy=3,Hy=7,un={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},Vp=[{...un,name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0},{...un,name:"Natsuki",fontName:"ammy_handwriting",fontSize:28},{...un,name:"Monika",fontName:"journal",fontSize:34},{...un,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32},{...un,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8},{...un,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40},{...un,name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53},{...un,name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1}],Vy=Object.freeze(Object.defineProperty({__proto__:null,backgroundScale:Ey,consoleBackgroundColor:Dy,consoleHeight:Ny,consoleWidth:Ly,defaultConsoleBackground:Fy,defaultConsoleStyle:Hy,defaultPoemBackground:Oy,defaultPoemHeight:By,defaultPoemStyle:Iy,defaultPoemWidth:My,defaultX:Ty,defaultY:jy,poemBackgrounds:Hp,poemBottomPadding:Ry,poemPadding:Ay,poemTextStyles:Vp,poemTopPadding:$y},Symbol.toStringTag,{value:"Module"})),Uy={Base:Em,Choices:Gm,Notification:Py,Poem:Vy,TextBox:my,TextBoxCustom:Dp},Mr=1920,Ha=1080,Wy=128,qy=32,zy="rgba(60,60,60,0.8)",Gy=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Up=1.5,Xy=1,Yy=-111,Ky=537,Jy=[300,360,600,740,960,1180,1320,1560,1620],Zy=Object.freeze(Object.defineProperty({__proto__:null,BaseCharacterYPos:Ky,CloseUpYOffset:Yy,WheelBackground:zy,characterPositions:Jy,hdCharacterScaleFactor:Xy,positions:Gy,screenHeight:Ha,screenWidth:Mr,sdCharacterScaleFactor:Up,wheelInnerRadius:Wy,wheelWidth:qy},Symbol.toStringTag,{value:"Module"})),Qy=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),ew="#ffe6f4",tw="#ffbde1",nw=630,ow=33,sw=960,Wp=405,rw=10.5,qp=4.5,iw=Math.ceil(qp/2),lw=(Ha-Wp)/2,aw={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},uw=Object.freeze(Object.defineProperty({__proto__:null,ChoiceButtonBorderColor:tw,ChoiceButtonColor:ew,ChoiceButtonWidth:nw,ChoiceOuterPadding:iw,ChoicePadding:rw,ChoiceSpacing:ow,ChoiceTextStyle:aw,ChoiceX:sw,ChoiceY:lw,ChoiceYOffset:Wp,Outline:qp,nameboxTextOutlineDelta:Qy},Symbol.toStringTag,{value:"Module"})),zp="#ffa8d2",cw="#552222",dw="#ffeef6",Va="#bb5599",Gp=new He(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Xp=new He(.002028397565922768,0,.13725490196078438,0),Yp=.82,Kp=new He(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Jp=15,Zp=19,fw=.6,pw=new He(.08045977011494243,-.5714285714285714,-.5960784313725489,0),hw=new He(0,-.14285714285714296,.3,0),gw=new He(.004269293924466178,-.01869158878504662,-.039215686274509665,0),vw=9.5*1.5,bw=47*1.5,Qp=new He(.0023347701149424305,0,.10784313725490202,0),eo=5,eh=Object.freeze(Object.defineProperty({__proto__:null,controlColorDelta:pw,controlDisableColorDelta:hw,controlsDefaultColor:cw,dotColorDelta:gw,dotPatternSize:bw,dotRadius:vw,nameColorThreshold:fw,nameboxBackgroundDelta:Xp,nameboxDefaultColor:dw,nameboxGradientEndDelta:Kp,nameboxGradientMiddleStopPosition:Yp,nameboxRounding:Jp,nameboxStrokeDefaultColor:Va,nameboxTextOutlineDelta:Gp,textboxDefaultColor:zp,textboxOutlineColorDelta:Qp,textboxOutlineWidth:eo,textboxRounding:Zp},Symbol.toStringTag,{value:"Module"})),Ua=1220,th=900,nh=219,mw=0,yw=29,ww=8,Wa=57,oh=68,kw=54,Cw=9,xw=9,qa=59,za=252,Ga=49,sh=43,rh=12*1.5,ih=-126*1.5,lh=-72*1.5,ah=-38*1.5,uh=30.75*1.5,ch=26*1.5,dh=426*1.5,Vl=58*1.5,Xa={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},fh={...Xa,fontName:"riffic",fontSize:36,strokeColor:Va,strokeWidth:9,color:"white",letterSpacing:2},ir={align:"left",font:"24px aller",fill:{style:"#522"}},ph={...ir,fill:{style:"#a66"}},hh={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},Sw={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},Io=Mr/2-Ua/2,_w=Mr/2-th/2,Pw=Io+Wa,gh=Io+Ga,Ow=gh+za/2,Iw=Io+ih,Tw=Io+lh,jw=Io+ah,$w="custom_plus",Rw=Object.freeze(Object.defineProperty({__proto__:null,ArrowXRightOffset:uh,ArrowYBottomOffset:ch,BaseTextStyle:Xa,ControlsTextDisabledStyle:ph,ControlsTextStyle:ir,ControlsXHistory:Iw,ControlsXHistoryOffset:ih,ControlsXSkip:Tw,ControlsXSkipOffset:lh,ControlsXStuff:jw,ControlsXStuffOffset:ah,ControlsYBottomOffset:rh,DefaultTextboxStyle:$w,GlowRX:dh,GlowRY:Vl,NameboxHeight:qa,NameboxTextStyle:fh,NameboxTextX:Ow,NameboxTextYOffset:sh,NameboxWidth:za,NameboxX:gh,NameboxXOffset:Ga,TextBoxBottomSpacing:kw,TextBoxCorruptedKerning:ww,TextBoxCorruptedStyle:Sw,TextBoxCorruptedWidth:th,TextBoxCorruptedX:_w,TextBoxHeight:nh,TextBoxKerning:mw,TextBoxLineHeight:yw,TextBoxStyle:hh,TextBoxTextCorruptedXOffset:Cw,TextBoxTextCorruptedYOffset:xw,TextBoxTextX:Pw,TextBoxTextXOffset:Wa,TextBoxTextYOffset:oh,TextBoxWidth:Ua,TextBoxX:Io},Symbol.toStringTag,{value:"Module"})),Aw="#ffe6f4",Mw="#ffbde1",Bw="rgba(255,255,255,0.6)",Ew=60,Dw=45,Lw={...Xa,fontName:"riffic",fontSize:36,strokeColor:Va,strokeWidth:12,letterSpacing:1,color:"white"},Nw={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Fw=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackdropColor:Bw,NotificationBackgroundColor:Aw,NotificationBorderColor:Mw,NotificationOkTextStyle:Lw,NotificationPadding:Ew,NotificationSpacing:Dw,NotificationTextStyle:Nw},Symbol.toStringTag,{value:"Module"})),Hw=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Vw=0,Uw=0,Ww=Mr/2,qw=Ha/2,zw=26,Gw=150,Xw=61,Yw=1200,Kw=1080,Jw=Up,Zw="#333333bf",Qw=720,e0=270,t0=3,n0=7,cn={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:18},o0=[{...cn,name:"Sayori",fontName:"hashtag",fontSize:45,lineSpacing:.95,letterSpacing:1},{...cn,name:"Natsuki",fontName:"ammy_handwriting",fontSize:41,letterSpacing:-.5},{...cn,name:"Monika",fontName:"journal",fontSize:36,lineSpacing:1.4,letterSpacing:.5},{...cn,name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.55,fontSize:48},{...cn,name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:27,letterSpacing:-12},{...cn,name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:60},{...cn,name:"MC",fontName:"halogen",fontSize:45,lineSpacing:1.53},{...cn,name:"Console",fontName:"f25_bank_printer",fontSize:27,color:"white",lineSpacing:1.1}],s0=Object.freeze(Object.defineProperty({__proto__:null,backgroundScale:Jw,consoleBackgroundColor:Zw,consoleHeight:e0,consoleWidth:Qw,defaultConsoleBackground:t0,defaultConsoleStyle:n0,defaultPoemBackground:Vw,defaultPoemHeight:Kw,defaultPoemStyle:Uw,defaultPoemWidth:Yw,defaultX:Ww,defaultY:qw,poemBackgrounds:Hw,poemBottomPadding:Gw,poemPadding:Xw,poemTextStyles:o0,poemTopPadding:zw},Symbol.toStringTag,{value:"Module"})),r0={Base:Zy,Choices:uw,Notification:Fw,Poem:s0,TextBox:Rw,TextBoxCustom:eh};function de(){return ge.gameMode==="ddlc_plus"?r0:Uy}const Mo=192,Bo=16/9,hs=Tb("viewport",{state:()=>({currentViewportCount:0,viewports:{}})});function oc(t){const e=hs();if(t.body.dataset.viewportId!=null)return as(e.viewports[+t.body.dataset.viewportId]);const n=e.currentViewportCount++,o=new i0(t);return e.viewports[n]=o,t.body.dataset.viewportId=n.toString(),as(o)}class i0{constructor(e){B(this,"_selection",q(null));B(this,"_pickColor",q(!1));B(this,"_currentPanel",q(null));B(this,"_width");B(this,"_height");var o;this.doc=e,this._width=q(e.documentElement.clientWidth),this._height=q(e.documentElement.clientHeight);const n=hs();((o=n.viewports[0])==null?void 0:o.currentPanel)!=null&&(this._currentPanel.value=n.viewports[0].currentPanel),e.defaultView.addEventListener("resize",()=>{this._width.value=e.documentElement.clientWidth,this._height.value=e.documentElement.clientHeight})}get width(){return this._width.value}get height(){return this._height.value}get selection(){return this._selection.value}set selection(e){this._selection.value=e}get currentPanel(){return this._currentPanel.value}set currentPanel(e){this._currentPanel.value=e}get pickColor(){return this._pickColor.value}set pickColor(e){this._pickColor.value=e}get isVertical(){const e=this.height;return(this.width+Mo)/e>=Bo}get canvasWidth(){if(this.isVertical){const e=this.width-Mo,n=this.height*Bo;return Math.min(e,n)}else{const e=this.width,n=(this.height-Mo)*Bo;return Math.min(e,n)}}get canvasHeight(){if(this.isVertical){const e=this.height,n=(this.width-Mo)/Bo;return Math.min(e,n)}else{const e=this.height-Mo,n=this.width/Bo;return Math.min(e,n)}}}var en=(t=>(t[t.None=0]="None",t[t.Selected=1]="Selected",t[t.Focused=2]="Focused",t[t.Indirectly=4]="Indirectly",t))(en||{});const l0={0:void 0,1:"#f00",2:"#00f",3:"#f0f",4:"#f66",6:"#f6f"};function bo(t){t.width=0,t.height=0,Ya.delete(t.disposalId||0)}function Un(){const t=document.createElement("canvas");return u0(t),t}const Ya=new Map;let a0=0;function u0(t){t.disposalId=a0++,!(typeof WeakRef>"u")&&Ya.set(t.disposalId,new WeakRef(t))}window.addEventListener("unload",()=>{Ya.forEach(t=>{const e=t.deref();e&&bo(e)})});class to{}class mo{constructor(e,n,o,s){B(this,"aborted",!1);this.canvas=e,this.fsCtx=n,this.hq=o,this.preview=s}static make(e,n,o){return new mo(e,e.getContext("2d"),n,o)}static makeWithContext(e,n,o,s){return new mo(e,n,o,s)}drawText(e){if(this.aborted)throw new to;this.fsCtx.save();const{font:n,align:o,x:s=0,y:r=0,text:i=""}={font:"20px aller",align:"left",...e};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width,this.fsCtx.strokeText(i,s,r)),e.fill&&(this.fsCtx.fillStyle=e.fill.style,this.fsCtx.fillText(i,s,r)),this.fsCtx.restore()}measureText(e){if(this.aborted)throw new to;this.fsCtx.save();const{font:n,align:o,text:s=""}={font:"20px aller",align:"left",...e};this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,e.outline&&(this.fsCtx.strokeStyle=e.outline.style,this.fsCtx.lineWidth=e.outline.width),e.fill&&(this.fsCtx.fillStyle=e.fill.style);const r=this.fsCtx.measureText(s);return this.fsCtx.restore(),r}drawImage(e){if(this.aborted)throw new to;const{image:n,flip:o,x:s,y:r,w:i,h:l,filters:a,composite:u}={flip:!1,w:e.image.width,h:e.image.height,composite:"source-over",...e};if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=u,a)if("filter"in this.fsCtx){const c=[];for(const d of a)d.type==="drop-shadow"?c.push(`drop-shadow(${d.offsetX}px ${d.offsetY}px ${d.blurRadius}px ${d.color})`):d.type==="hue-rotate"?c.push(`hue-rotate(${d.value}deg)`):d.type==="blur"?c.push(`blur(${d.value}px)`):c.push(`${d.type}(${d.value*100}%)`);this.fsCtx.filter=c.join(" ")}else{let c=1;for(const d of a)d.type==="opacity"&&(c*=d.value);this.fsCtx.globalAlpha=c}if(e.shadow){const c=e.shadow;c.color!=null&&(this.fsCtx.shadowColor=c.color),c.blur!=null&&(this.fsCtx.shadowBlur=c.blur),c.offsetX!=null&&(this.fsCtx.shadowOffsetX=c.offsetX),c.offsetY!=null&&(this.fsCtx.shadowOffsetY=c.offsetY)}if(e.rotation!=null&&e.rotation!==0){const c=e.rotationAnchor?e.rotationAnchor.x:0,d=e.rotationAnchor?e.rotationAnchor.y:0;e.rotationAnchor&&this.fsCtx.translate(c,d),this.fsCtx.rotate(e.rotation),e.rotationAnchor&&this.fsCtx.translate(-c,-d)}this.fsCtx.translate(s+i/2,r+l/2),this.fsCtx.scale(o?-1:1,1),n.paintOnto(this.fsCtx,{x:-i/2,y:-l/2,w:i,h:l}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:e,y:n,w:o,h:s,outline:r,fill:i,composition:l,rotation:a,rotationAnchor:u}){if(this.aborted)throw new to;if(this.fsCtx.save(),a!=null&&a!==0){const c=u?u.x:0,d=u?u.y:0;u&&this.fsCtx.translate(c,d),this.fsCtx.rotate(a),u&&this.fsCtx.translate(-c,-d)}this.fsCtx.beginPath(),this.fsCtx.rect(e,n,o,s),l&&(this.fsCtx.globalCompositeOperation=l),i&&(this.fsCtx.fillStyle=i.style,this.fsCtx.fill()),r&&(this.fsCtx.strokeStyle=r.style,this.fsCtx.lineWidth=r.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:e,fill:n,path:o}){if(this.aborted)throw new to;this.fsCtx.save(),this.fsCtx.beginPath(),o(this.fsCtx),n&&(this.fsCtx.fillStyle=n.style,this.fsCtx.fill()),e&&(this.fsCtx.strokeStyle=e.style,this.fsCtx.lineWidth=e.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(e,n="repeat"){return e instanceof vh&&(e=e.previewCanvas),this.fsCtx.createPattern(e,n)}async customTransform(e,n){this.fsCtx.save(),await e(this.fsCtx),await n(this),this.fsCtx.restore()}linearGradient(e,n,o,s){return this.fsCtx.createLinearGradient(e,n,o,s)}applyFilters(e){if(e.length===0)return;this.fsCtx.save();let n=1;for(const o of e)o.type==="opacity"&&(n*=o.value);if("filter"in this.fsCtx){const o=[];for(const s of e)s.type!=="opacity"&&(s.type==="drop-shadow"?o.push(`drop-shadow(${s.offsetX}px ${s.offsetY}px ${s.blurRadius}px ${s.color})`):s.type==="hue-rotate"?o.push(`hue-rotate(${s.value}deg)`):s.type==="blur"?o.push(`blur(${s.value}px)`):o.push(`${s.type}(${s.value*100}%)`));this.fsCtx.filter=o.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),n!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${n})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}class vh{constructor(e,n){B(this,"previewCanvas");B(this,"runningContext",null);B(this,"_disposed",!1);const o=de();this.previewCanvas=Un(),this.previewCanvas.width=e??o.Base.screenWidth,this.previewCanvas.height=n??o.Base.screenHeight}get disposed(){return this._disposed}async render(e,n=!0,o=!0){this.runningContext&&this.runningContext.abort();const s=this.previewCanvas.getContext("2d");s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const r=this.runningContext=mo.makeWithContext(this.previewCanvas,s,n,o);try{await e(this.runningContext)}catch(i){if(i instanceof to)return!1;throw i}finally{r===this.runningContext&&(this.runningContext=null)}return!0}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(e,n){n.w!=null&&n.h!=null?e.drawImage(this.previewCanvas,n.x,n.y,n.w,n.h):e.drawImage(this.previewCanvas,n.x,n.y)}async download(e,n){const o=await this.drawToCanvas(e);return await ge.saveToFile(o,n)}async renderToBlob(e){const n=await this.drawToCanvas(e);return await new Promise((o,s)=>{n.toBlob(r=>{r?o(r):s()})})}async drawToCanvas(e){const n=Un();n.width=this.previewCanvas.width,n.height=this.previewCanvas.height;const o=n.getContext("2d");return o.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),await e(mo.makeWithContext(n,o,!0,!1)),n}dispose(){this.runningContext&&this.runningContext.abort(),bo(this.previewCanvas),this._disposed=!0}getDataAt(e,n){return this.previewCanvas.getContext("2d").getImageData(e,n,1,1).data}}function qo(t,e,n){let o=e+n;const s=t.length;return o<0&&(o+=s),o>=s&&(o-=s),o}function To(){return{flip:!1,rotation:0,version:0,opacity:100,x:de().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,scaleX:1,scaleY:1,ratio:1,preserveRatio:!0,skewX:0,skewY:0,linkedTo:null}}const c0={setPose(t,e){const n=t.panels[e.panelId].objects[e.id];n.poseId=e.poseId,++n.version},setCharStyleGroup(t,{id:e,panelId:n,styleGroupId:o}){const s=t.panels[n].objects[e];s.styleGroupId=o,++s.version},setCharStyle(t,{id:e,panelId:n,styleId:o}){const s=t.panels[n].objects[e];s.styleId=o,++s.version},setClose(t,e){const n=t.panels[e.panelId].objects[e.id];n.close=e.close,++n.version},setPosePosition(t,e){const n=t.panels[e.panelId].objects[e.id];n.posePositions={...n.posePositions,...e.posePositions},++n.version},setFreeMove(t,e){const n=t.panels[e.panelId].objects[e.id];if(n.freeMove=e.freeMove,!n.freeMove){const o=de();n.x=o.Base.characterPositions[ar(n.x)],n.y=o.Base.BaseCharacterYPos}}};function Br(t,e){return t.getters["content/getCharacters"].get(e.characterType)}function Tn(t,e){return t["content/getCharacters"].get(e)}function yo(t,e){return t.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId]}function d0(t,e){const n=yo(t,e),o=Object.keys(n.positions).filter(s=>n.positions[s].length>1);return n.compatibleHeads.length>0&&o.unshift("head"),o}function lr(t,e,n=e.posePositions.headType||0){const o=yo(t,e).compatibleHeads;return o.length===0?null:t.heads[o[n]]}function ar(t){return de().Base.characterPositions.map((o,s)=>({pos:Math.abs(t-o),idx:s})).sort((o,s)=>o.pos-s.pos)[0].idx}const f0={createCharacters({rootState:t,rootGetters:e,commit:n,state:o},s){const r=o.panels[s.panelId].lastObjId+1,i=de(),l=Tn(e,s.characterType),a=l.hd?i.Base.hdCharacterScaleFactor:i.Base.sdCharacterScaleFactor;return n("create",{object:{...To(),id:r,panelId:s.panelId,onTop:!1,type:"character",y:i.Base.BaseCharacterYPos,width:l.size[0],height:l.size[1],scaleX:l.defaultScale[0]*a,scaleY:l.defaultScale[1]*a,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:l.label??l.id,enlargeWhenTalking:t.ui.defaultCharacterTalkingZoom,linkedTo:null}}),r},seekPart({state:t,commit:e,dispatch:n,rootGetters:o},{delta:s,id:r,panelId:i,part:l}){if(l==="head"){n("seekHead",{id:r,panelId:i,delta:s});return}const a=t.panels[i].objects[r],u=yo(Tn(o,a.characterType),a);u.positions[l]&&e("setPosePosition",{id:r,panelId:i,posePositions:{[l]:qo(u.positions[l],a.posePositions[l]||0,s)}})},seekPose({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=Tn(n,i.characterType),a=l.styleGroups[i.styleGroupId].styles[i.styleId].poses;Kn(e,i,l,u=>{u.poseId=qo(a,u.poseId,r)})},seekStyle({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=Tn(n,i.characterType),a=l.styleGroups.flatMap((c,d)=>c.styles.map((g,b)=>({styleGroupIdx:d,styleIdx:b,styleGroupJson:JSON.stringify(g.components)}))).sort((c,d)=>c.styleGroupJson.localeCompare(d.styleGroupJson)),u=a.findIndex(c=>c.styleGroupIdx===i.styleGroupId&&c.styleIdx===i.styleId);Kn(e,i,l,c=>{const d=qo(a,u,r),g=a[d];c.styleGroupId=g.styleGroupIdx,c.styleId=g.styleIdx})},seekHead({state:t,commit:e,rootGetters:n},{id:o,panelId:s,delta:r}){const i=t.panels[s].objects[o],l=Tn(n,i.characterType),a=yo(l,i);let u=lr(l,i);if(!u)return;let c=(i.posePositions.head||0)+r,d=i.posePositions.headType||0;(c<0||c>=u.variants.length)&&(d=qo(a.compatibleHeads.map(g=>l.heads[g]),d,r),u=lr(l,i,d),c=r===1?0:u.variants.length-1),e("setPosePosition",{id:o,panelId:s,posePositions:{head:c,headType:d}})},setPart({state:t,commit:e,rootGetters:n},{panelId:o,id:s,part:r,val:i}){const l=t.panels[o].objects[s],a=Tn(n,l.characterType);r==="pose"?Kn(e,l,a,u=>{u.poseId=i}):r==="style"?Kn(e,l,a,u=>{u.styleId=i}):Kn(e,l,a,u=>{u.posePositions[r]=i})},setCharStyle({state:t,commit:e,rootGetters:n},{panelId:o,id:s,styleGroupId:r,styleId:i}){const l=t.panels[o].objects[s],a=Tn(n,l.characterType);Kn(e,l,a,u=>{u.styleGroupId=r,u.styleId=i})},setCharacterPosition({state:t,commit:e},{panelId:n,id:o,x:s,y:r}){const i=t.panels[n].objects[o];if(!i.freeMove){const l=de();s=l.Base.characterPositions[ar(s)],r=l.Base.BaseCharacterYPos}i.x===s&&i.y===r||e("setPosition",{panelId:n,id:o,x:s,y:r})},shiftCharacterSlot({state:t,commit:e},{panelId:n,id:o,delta:s}){const r=t.panels[n].objects[o],i=de();let a=ar(r.x)+s;a<0&&(a=0),a>=i.Base.characterPositions.length&&(a=i.Base.characterPositions.length-1),e("setPosition",{panelId:n,id:o,x:i.Base.characterPositions[a],y:r.y})}};async function p0(t,e,n,o){const s=t.state.panels[e].objects[n],r=o.characters.find(f=>f.id===s.characterType);if(!r){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:n,panelId:e});return}const i=bh(s),l=r.styleGroups[s.styleGroupId],a=l.styles[i.styleId],u=a.poses[i.poseId],c=t.rootState.content.current.characters.find(f=>f.id===r.id);if(!c){console.error("Character data is missing. Dropping the character."),await t.dispatch("removeObject",{id:n,panelId:e});return}const d=c.styleGroups.findIndex(f=>f.id===l.id);i.styleGroupId=d===-1?0:d;const g=c.styleGroups[i.styleGroupId],b=JSON.stringify(a.components),_=g.styles.findIndex(f=>JSON.stringify(f.components)===b);i.styleId=_===-1?0:_;const w=g.styles[i.styleId],P=w.poses.findIndex(f=>f.id===u.id);i.poseId=P===-1?0:P;const y=w.poses[i.poseId];for(const f in y.positions){if(!Object.prototype.hasOwnProperty.call(y.positions,f))continue;const C=y.positions[f];if(u.positions[f]){const T=i.posePositions[f];T>=0&&T<C.length}}const h=u.compatibleHeads[s.posePositions.headType],v=y.compatibleHeads.indexOf(h);if(v===-1)i.posePositions.headType=0,i.posePositions.head=0;else{v!==s.posePositions.headType&&(i.posePositions.headType=v);const f=JSON.stringify(r.heads[h].variants[s.posePositions.head]),C=c.heads[h].variants.findIndex(T=>JSON.stringify(T)===f);C===-1?i.posePositions.head=0:i.posePositions.head=C}mh(t.commit,s,i)}function bh(t){return{styleGroupId:t.styleGroupId,styleId:t.styleId,poseId:t.poseId,posePositions:{...t.posePositions}}}function mh(t,e,n){n.styleGroupId!==e.styleGroupId&&t("setCharStyleGroup",{id:e.id,panelId:e.panelId,styleGroupId:n.styleGroupId}),n.styleId!==e.styleId&&(console.log(`Setting style of ${e.id} to ${n.styleId}`),t("setCharStyle",{id:e.id,panelId:e.panelId,styleId:n.styleId})),n.poseId!==e.poseId&&t("setPose",{id:e.id,panelId:e.panelId,poseId:n.poseId}),JSON.stringify(n.posePositions)!==JSON.stringify(e.posePositions)&&t("setPosePosition",{id:e.id,panelId:e.panelId,posePositions:n.posePositions})}function Kn(t,e,n,o){const s=bh(e);o(s),n.styleGroups[s.styleGroupId]||(s.styleGroupId=0);const r=n.styleGroups[s.styleGroupId];r.styles[s.styleId]||(s.styleId=0);const i=r.styles[s.styleId];i.poses[s.poseId]||(s.poseId=0);const l=i.poses[s.poseId];for(const d in l.positions)l.positions[d]&&(l.positions[d][s.posePositions[d]]||(s.posePositions[d]=0));const u=n.styleGroups[e.styleGroupId].styles[e.styleId].poses[e.poseId].compatibleHeads[e.posePositions.headType||0],c=l.compatibleHeads.indexOf(u);c>=0?s.posePositions.headType=c:(s.posePositions.headType=0,s.posePositions.head=0),mh(t,e,s)}var jn={},ii={},sc;function h0(){return sc||(sc=1,Object.defineProperty(ii,"__esModule",{value:!0})),ii}var li={},rc;function g0(){return rc||(rc=1,Object.defineProperty(li,"__esModule",{value:!0})),li}var ai={},ic;function v0(){return ic||(ic=1,Object.defineProperty(ai,"__esModule",{value:!0})),ai}var ui={},lc;function b0(){return lc||(lc=1,Object.defineProperty(ui,"__esModule",{value:!0})),ui}var ci={},ac;function m0(){return ac||(ac=1,Object.defineProperty(ci,"__esModule",{value:!0})),ci}var di={},uc;function y0(){return uc||(uc=1,Object.defineProperty(di,"__esModule",{value:!0})),di}var fi={},cc;function w0(){return cc||(cc=1,Object.defineProperty(fi,"__esModule",{value:!0})),fi}var pi={},dc;function k0(){return dc||(dc=1,Object.defineProperty(pi,"__esModule",{value:!0})),pi}var hi={},fc;function C0(){return fc||(fc=1,Object.defineProperty(hi,"__esModule",{value:!0})),hi}var gi={},pc;function x0(){return pc||(pc=1,Object.defineProperty(gi,"__esModule",{value:!0})),gi}var vi={},hc;function S0(){return hc||(hc=1,Object.defineProperty(vi,"__esModule",{value:!0})),vi}var bi={},gc;function _0(){return gc||(gc=1,Object.defineProperty(bi,"__esModule",{value:!0})),bi}var mi={},vc;function P0(){return vc||(vc=1,Object.defineProperty(mi,"__esModule",{value:!0})),mi}var yi={},bc;function O0(){return bc||(bc=1,Object.defineProperty(yi,"__esModule",{value:!0})),yi}var wi={},mc;function I0(){return mc||(mc=1,Object.defineProperty(wi,"__esModule",{value:!0})),wi}var ki={},yc;function T0(){return yc||(yc=1,Object.defineProperty(ki,"__esModule",{value:!0})),ki}var Ci={},wc;function j0(){return wc||(wc=1,Object.defineProperty(Ci,"__esModule",{value:!0})),Ci}var xi={},kc;function $0(){return kc||(kc=1,Object.defineProperty(xi,"__esModule",{value:!0})),xi}var Si={},Cc;function R0(){return Cc||(Cc=1,Object.defineProperty(Si,"__esModule",{value:!0})),Si}var _i={},xc;function A0(){return xc||(xc=1,Object.defineProperty(_i,"__esModule",{value:!0})),_i}var Pi={},Sc;function M0(){return Sc||(Sc=1,Object.defineProperty(Pi,"__esModule",{value:!0})),Pi}var Oi={},_c;function B0(){return _c||(_c=1,Object.defineProperty(Oi,"__esModule",{value:!0})),Oi}var Ii={},Pc;function E0(){return Pc||(Pc=1,Object.defineProperty(Ii,"__esModule",{value:!0})),Ii}var Ti={},Oc;function D0(){return Oc||(Oc=1,Object.defineProperty(Ti,"__esModule",{value:!0})),Ti}var ji={},Ic;function L0(){return Ic||(Ic=1,Object.defineProperty(ji,"__esModule",{value:!0})),ji}var $i={},Tc;function N0(){return Tc||(Tc=1,Object.defineProperty($i,"__esModule",{value:!0})),$i}var Ri={},jc;function F0(){return jc||(jc=1,Object.defineProperty(Ri,"__esModule",{value:!0})),Ri}var Ai={},$c;function H0(){return $c||($c=1,Object.defineProperty(Ai,"__esModule",{value:!0})),Ai}var Mi={},Rc;function V0(){return Rc||(Rc=1,Object.defineProperty(Mi,"__esModule",{value:!0})),Mi}var Bi={},Ac;function U0(){return Ac||(Ac=1,Object.defineProperty(Bi,"__esModule",{value:!0})),Bi}var Ei={},Mc;function W0(){return Mc||(Mc=1,Object.defineProperty(Ei,"__esModule",{value:!0})),Ei}var Di={},Bc;function q0(){return Bc||(Bc=1,Object.defineProperty(Di,"__esModule",{value:!0})),Di}var Li={},Ec;function z0(){return Ec||(Ec=1,Object.defineProperty(Li,"__esModule",{value:!0})),Li}var Ni={},Dc;function G0(){return Dc||(Dc=1,Object.defineProperty(Ni,"__esModule",{value:!0})),Ni}var Fi={},Lc;function X0(){return Lc||(Lc=1,Object.defineProperty(Fi,"__esModule",{value:!0})),Fi}var Hi={},Nc;function Y0(){return Nc||(Nc=1,Object.defineProperty(Hi,"__esModule",{value:!0})),Hi}var Vi={},Fc;function K0(){return Fc||(Fc=1,Object.defineProperty(Vi,"__esModule",{value:!0})),Vi}var Ui={},Hc;function J0(){return Hc||(Hc=1,Object.defineProperty(Ui,"__esModule",{value:!0})),Ui}var Wi={},Vc;function Z0(){return Vc||(Vc=1,Object.defineProperty(Wi,"__esModule",{value:!0})),Wi}var qi={},Uc;function Q0(){return Uc||(Uc=1,Object.defineProperty(qi,"__esModule",{value:!0})),qi}var zi={},Wc;function e1(){return Wc||(Wc=1,Object.defineProperty(zi,"__esModule",{value:!0})),zi}var Gi={},qc;function t1(){return qc||(qc=1,Object.defineProperty(Gi,"__esModule",{value:!0})),Gi}var Xi={},zc;function n1(){return zc||(zc=1,Object.defineProperty(Xi,"__esModule",{value:!0})),Xi}var Yi={},Gc;function o1(){return Gc||(Gc=1,Object.defineProperty(Yi,"__esModule",{value:!0})),Yi}var Ki={},Xc;function s1(){return Xc||(Xc=1,Object.defineProperty(Ki,"__esModule",{value:!0})),Ki}var Ji={},Yc;function r1(){return Yc||(Yc=1,Object.defineProperty(Ji,"__esModule",{value:!0})),Ji}var Zi={},Kc;function i1(){return Kc||(Kc=1,Object.defineProperty(Zi,"__esModule",{value:!0})),Zi}var Qi={},Jc;function l1(){return Jc||(Jc=1,Object.defineProperty(Qi,"__esModule",{value:!0})),Qi}var el={},Zc;function a1(){return Zc||(Zc=1,Object.defineProperty(el,"__esModule",{value:!0})),el}var tl={},Qc;function u1(){return Qc||(Qc=1,Object.defineProperty(tl,"__esModule",{value:!0})),tl}var nl={},ed;function c1(){return ed||(ed=1,Object.defineProperty(nl,"__esModule",{value:!0})),nl}var ol={},td;function d1(){return td||(td=1,Object.defineProperty(ol,"__esModule",{value:!0})),ol}var sl={},nd;function f1(){return nd||(nd=1,Object.defineProperty(sl,"__esModule",{value:!0})),sl}var rl={},od;function p1(){return od||(od=1,Object.defineProperty(rl,"__esModule",{value:!0})),rl}var il={},sd;function h1(){return sd||(sd=1,Object.defineProperty(il,"__esModule",{value:!0})),il}var ll={},rd;function g1(){return rd||(rd=1,Object.defineProperty(ll,"__esModule",{value:!0})),ll}var al={},id;function v1(){return id||(id=1,Object.defineProperty(al,"__esModule",{value:!0})),al}var ul={},ld;function b1(){return ld||(ld=1,Object.defineProperty(ul,"__esModule",{value:!0})),ul}var cl={},ad;function m1(){return ad||(ad=1,Object.defineProperty(cl,"__esModule",{value:!0})),cl}var dl={},ud;function y1(){return ud||(ud=1,Object.defineProperty(dl,"__esModule",{value:!0})),dl}var fl={},cd;function w1(){return cd||(cd=1,Object.defineProperty(fl,"__esModule",{value:!0})),fl}var pl={},dd;function k1(){return dd||(dd=1,Object.defineProperty(pl,"__esModule",{value:!0})),pl}var hl={},fd;function C1(){return fd||(fd=1,Object.defineProperty(hl,"__esModule",{value:!0})),hl}var gl={},pd;function x1(){return pd||(pd=1,Object.defineProperty(gl,"__esModule",{value:!0})),gl}var vl={},hd;function S1(){return hd||(hd=1,Object.defineProperty(vl,"__esModule",{value:!0})),vl}var Eo={},gd;function _1(){if(gd)return Eo;gd=1,Object.defineProperty(Eo,"__esModule",{value:!0}),Eo.UnreachableCaseError=void 0;class t extends Error{constructor(n){super(`Unreachable case: ${n}`)}}return Eo.UnreachableCaseError=t,Eo}var Do={},vd;function P1(){if(vd)return Do;vd=1,Object.defineProperty(Do,"__esModule",{value:!0}),Do.assert=void 0;function t(e,n="no additional info provided"){if(!e)throw new Error("Assertion Error: "+n)}return Do.assert=t,Do}var Lo={},bd;function O1(){if(bd)return Lo;bd=1,Object.defineProperty(Lo,"__esModule",{value:!0}),Lo.createFactoryWithConstraint=void 0;const t=()=>e=>e;return Lo.createFactoryWithConstraint=t,Lo}var No={},md;function I1(){if(md)return No;md=1,Object.defineProperty(No,"__esModule",{value:!0}),No.isExact=void 0;const t=()=>e=>e;return No.isExact=t,No}var Fo={},yd;function T1(){if(yd)return Fo;yd=1,Object.defineProperty(Fo,"__esModule",{value:!0}),Fo.noop=void 0;function t(...e){}return Fo.noop=t,Fo}var bl={},wd;function j1(){return wd||(wd=1,Object.defineProperty(bl,"__esModule",{value:!0})),bl}var kd;function $1(){return kd||(kd=1,function(t){var e=jn&&jn.__createBinding||(Object.create?function(o,s,r,i){i===void 0&&(i=r);var l=Object.getOwnPropertyDescriptor(s,r);(!l||("get"in l?!s.__esModule:l.writable||l.configurable))&&(l={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,i,l)}:function(o,s,r,i){i===void 0&&(i=r),o[i]=s[r]}),n=jn&&jn.__exportStar||function(o,s){for(var r in o)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&e(s,o,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(h0(),t),n(g0(),t),n(v0(),t),n(b0(),t),n(m0(),t),n(y0(),t),n(w0(),t),n(k0(),t),n(C0(),t),n(x0(),t),n(S0(),t),n(_0(),t),n(P0(),t),n(O0(),t),n(I0(),t),n(T0(),t),n(j0(),t),n($0(),t),n(R0(),t),n(A0(),t),n(M0(),t),n(B0(),t),n(E0(),t),n(D0(),t),n(L0(),t),n(N0(),t),n(F0(),t),n(H0(),t),n(V0(),t),n(U0(),t),n(W0(),t),n(q0(),t),n(z0(),t),n(G0(),t),n(X0(),t),n(Y0(),t),n(K0(),t),n(J0(),t),n(Z0(),t),n(Q0(),t),n(e1(),t),n(t1(),t),n(n1(),t),n(o1(),t),n(s1(),t),n(r1(),t),n(i1(),t),n(l1(),t),n(a1(),t),n(u1(),t),n(c1(),t),n(d1(),t),n(f1(),t),n(p1(),t),n(h1(),t),n(g1(),t),n(v1(),t),n(b1(),t),n(m1(),t),n(y1(),t),n(w1(),t),n(k1(),t),n(C1(),t),n(x1(),t),n(S1(),t),n(_1(),t),n(P1(),t),n(O1(),t),n(I1(),t),n(T1(),t),n(j1(),t)}(jn)),jn}var Mt=$1(),Ho={},Cd;function R1(){if(Cd)return Ho;Cd=1,Object.defineProperty(Ho,"__esModule",{value:!0}),Ho.normalizeCharacter=void 0;function t(a,u){var c=l("",a.folder||"/",u),d=void 0;return a.chibi&&(d=l(c,a.chibi,u)),d===void 0&&a.internalId&&(d=(u["/"]||"")+"chibis/"+a.internalId),{id:a.id,packId:a.packId,packCredits:a.packCredits,name:a.name,nsfw:!!a.nsfw,chibi:d,eyes:e(a.eyes,c,u),hairs:e(a.hairs,c,u),styles:r(a.styles),heads:n(a.heads,c,u),poses:o(a.poses,c,u)}}Ho.normalizeCharacter=t;function e(a,u,c){if(!a)return{};var d={};for(var g in a)a.hasOwnProperty(g)&&(d[g]=l(u,a[g],c));return d}function n(a,u,c){var d={};if(!a)return d;for(var g in a)if(a.hasOwnProperty(g)){var b=a[g],_=void 0;if(b instanceof Array)_={all:s(b,u,c),nsfw:!1,offset:[290,70],size:[380,380]};else{var w=l(u,b.folder,c);_={all:s(b.all,w,c),nsfw:!!b.nsfw,offset:b.offset||[290,70],size:b.size||[380,380]}}d[g]=_}return d}function o(a,u,c){return a?a.map(function(d){var g=l(u,d.folder,c),b={compatibleHeads:d.compatibleHeads||[],headAnchor:d.headAnchor||[0,0],headInForeground:!!d.headInForeground,name:d.name,nsfw:!!d.nsfw,style:d.style,offset:[0,0],size:[960,960]};if("static"in d)b.static=l(g,d.static,c);else if("variant"in d)b.variant=s(d.variant,g,c);else if("left"in d)b.left=s(d.left,g,c),b.right=s(d.right,g,c);else throw new Error("Invalid pose");return b}):[]}function s(a,u,c){return a.map(function(d){return typeof d=="string"?{img:l(u,d,c),nsfw:!1}:{img:l(u,d.img,c),nsfw:d.nsfw||!1}})}function r(a){return a?a.map(function(u){return{name:u.name,label:u.label,nsfw:u.nsfw||!1}}):[]}function i(a){return a.startsWith("blob:")||a.startsWith("http://")||a.startsWith("https://")||a.startsWith("://")}function l(a,u,c){if(!u)return a;for(var d in c)if(u.startsWith(d))return c[d]+u.slice(d.length);return i(u)?u:a+u}return Ho}var A1=R1(),yt={},ze={},it={},xd;function yh(){if(xd)return it;xd=1;var t=it&&it.__assign||function(){return t=Object.assign||function(f){for(var C,T=1,$=arguments.length;T<$;T++){C=arguments[T];for(var m in C)Object.prototype.hasOwnProperty.call(C,m)&&(f[m]=C[m])}return f},t.apply(this,arguments)},e=it&&it.__values||function(f){var C=typeof Symbol=="function"&&Symbol.iterator,T=C&&f[C],$=0;if(T)return T.call(f);if(f&&typeof f.length=="number")return{next:function(){return f&&$>=f.length&&(f=void 0),{value:f&&f[$++],done:!f}}};throw new TypeError(C?"Object is not iterable.":"Symbol.iterator is not defined.")},n=it&&it.__read||function(f,C){var T=typeof Symbol=="function"&&f[Symbol.iterator];if(!T)return f;var $=T.call(f),m,x=[],I;try{for(;(C===void 0||C-- >0)&&!(m=$.next()).done;)x.push(m.value)}catch(E){I={error:E}}finally{try{m&&!m.done&&(T=$.return)&&T.call($)}finally{if(I)throw I.error}}return x},o=it&&it.__spread||function(){for(var f=[],C=0;C<arguments.length;C++)f=f.concat(n(arguments[C]));return f};Object.defineProperty(it,"__esModule",{value:!0}),it.mapObject=it.assetWalker=it.normalizePath=void 0;var s=10;function r(f,C,T,$){for(var m,x,I="",E=0,L=new Map(Array.from(C.entries()).map(function(ue){return[new RegExp("{"+ue[0]+"}","g"),ue[1]]}));I!==f;){if(I=f,++E>s)throw new Error("Maximum replacement recursion exceeded!");try{for(var H=(m=void 0,e(L.entries())),V=H.next();!V.done;V=H.next()){var ae=V.value;f=f.replace(ae[0],ae[1])}}catch(ue){m={error:ue}}finally{try{V&&!V.done&&(x=H.return)&&x.call(H)}finally{if(m)throw m.error}}f=f.replace(/{format(:.*?:.*?)+}/gi,function(ue){ue=ue.slice(8,-1);for(var A=ue.split(":"),S=0;S<A.length;S+=2)if(T.has(A[S]))return A[S+1];return""}),f=f.replace(/{lq:(.*?):(.*?)}/gi,function(ue){return ue.slice(4,-1).split(":")[$?0:1]})}return f}it.normalizePath=r;function i(f,C){return{packId:f.packId,packCredits:f.packCredits,dependencies:f.dependencies,characters:f.characters.map(function(T){return l(T,C)}),backgrounds:f.backgrounds.map(function(T){return w(T,C)}),fonts:f.fonts.map(function(T){return P(T,C)}),poemStyles:o(f.poemStyles),poemBackgrounds:f.poemBackgrounds.map(function(T){return y(T,C)}),sprites:f.sprites.map(function(T){return h(T,C)}),colors:f.colors}}it.assetWalker=i;function l(f,C){return{id:f.id,label:f.label,chibi:f.chibi?C(f.chibi,"image"):void 0,heads:b(f.heads,C),styleGroups:f.styleGroups.map(function(T){return a(T,C)}),defaultScale:f.defaultScale,hd:f.hd,size:f.size,sdVersion:f.sdVersion}}function a(f,C){return{id:f.id,styleComponents:f.styleComponents.map(function(T){return c(T,C)}),styles:f.styles.map(function(T){return u(T,C)})}}function u(f,C){return{components:f.components,poses:f.poses.map(function(T){return g(T,C)})}}function c(f,C){return t(t({},f),{variants:d(f.variants,C)})}function d(f,C){var T={};for(var $ in f)f.hasOwnProperty($)&&(T[$]=C(f[$],"image"));return T}function g(f,C){var T,$,m={};try{for(var x=e(Object.keys(f.positions)),I=x.next();!I.done;I=x.next()){var E=I.value,L=f.positions[E];m[E]=L.map(function(H){return H.map(function(V){return C(V,"image")})})}}catch(H){T={error:H}}finally{try{I&&!I.done&&($=x.return)&&$.call(x)}finally{if(T)throw T.error}}return{compatibleHeads:f.compatibleHeads,id:f.id,previewOffset:f.previewOffset,previewSize:f.previewSize,renderCommands:f.renderCommands.map(function(H){return H.type==="image"?{type:"image",offset:H.offset,images:H.images.map(function(V){return C(V,"image")})}:H}),size:f.size,scale:f.scale,positions:m}}function b(f,C){var T={};for(var $ in f)f.hasOwnProperty($)&&(T[$]=_(f[$],C));return T}function _(f,C){return{previewOffset:f.previewOffset,previewSize:f.previewSize,variants:f.variants.map(function(T){return T.map(function($){return C($,"image")})})}}function w(f,C){return{id:f.id,label:f.label,variants:f.variants.map(function(T){return T.map(function($){return C($,"image")})}),scaling:f.scaling,sdVersion:f.sdVersion}}function P(f,C){return{id:f.id,label:f.label,files:f.files.map(function(T){return C(T,"font")})}}function y(f,C){return{id:f.id,fontColor:f.fontColor,label:f.label,images:f.images.map(function(T){return C(T,"image")}),sdVersion:f.sdVersion}}function h(f,C){return{id:f.id,label:f.label,variants:f.variants.map(function(T){return T.map(function($){return C($,"image")})}),defaultScale:f.defaultScale,hd:f.hd,sdVersion:f.sdVersion}}function v(f,C){var T={};for(var $ in f)f.hasOwnProperty($)&&(T[$]=C(f[$],$));return T}return it.mapObject=v,it}var Sd;function wh(){if(Sd)return ze;Sd=1;var t=ze&&ze.__assign||function(){return t=Object.assign||function(m){for(var x,I=1,E=arguments.length;I<E;I++){x=arguments[I];for(var L in x)Object.prototype.hasOwnProperty.call(x,L)&&(m[L]=x[L])}return m},t.apply(this,arguments)};Object.defineProperty(ze,"__esModule",{value:!0}),ze.expandId=ze.normalizeStyleComponent=ze.normalizeColor=ze.normalizeBackground=ze.normalizeFont=ze.normalizePoemBackground=ze.normalizePoemStyles=ze.normalizeSprite=ze.mapNormalize=ze.normalizeContentPack=void 0;var e=yh();function n(m,x){var I={paths:x,packId:m.packId},E=T("",m.folder||"/",I);return{packId:m.packId,packCredits:m.packCredits,dependencies:m.dependencies||[],characters:o(d,m.characters,E,I),backgrounds:o(a,m.backgrounds,E,I),fonts:o(l,m.fonts,E,I),poemStyles:o(r,m.poemStyles,E,I),poemBackgrounds:o(i,m.poemBackgrounds,E,I),sprites:o(s,m.sprites,E,I),colors:o(u,m.colors,E,I)}}ze.normalizeContentPack=n;function o(m,x,I,E){return x?x.map(function(L){return m(L,I,E)}):[]}ze.mapNormalize=o;function s(m,x,I){var E,L=T(x,m.folder,I);return{id:$(I.packId,m.id),label:m.label||m.variants[0][0],variants:m.variants.map(function(H){return c(H,L,I)}),defaultScale:m.defaultScale||[1,1],sdVersion:m.sdVersion,hd:(E=m.hd)!==null&&E!==void 0?E:null}}ze.normalizeSprite=s;function r(m){return{label:m.label,defaultFont:m.defaultFont||"Aller",fontSize:m.fontSize!==void 0?m.fontSize:30,letterSpacing:m.letterSpacing!==void 0?m.letterSpacing:1,lineSpacing:m.lineSpacing!==void 0?m.lineSpacing:1.2}}ze.normalizePoemStyles=r;function i(m,x,I){var E=T(x,m.folder,I);return{id:m.id,label:m.label,images:c(m.images,E,I),fontColor:m.fontColor||"black",sdVersion:m.sdVersion}}ze.normalizePoemBackground=i;function l(m,x,I){var E=T(x,m.folder,I);return{id:$(I.packId,m.id?m.id:m.label?m.label:m.files[0]),label:m.label?m.label:m.id?m.id:m.files[0],files:c(m.files,E,I)}}ze.normalizeFont=l;function a(m,x,I){var E,L=T(x,m.folder,I);return{id:$(I.packId,m.id),label:m.label?m.label:m.variants[0][0],variants:m.variants.map(function(H){return c(H,L,I)}),scaling:["none","strech","cover"].includes((E=m.scaling)===null||E===void 0?void 0:E.toLowerCase())?m.scaling.toLowerCase():"cover",sdVersion:m.sdVersion}}ze.normalizeBackground=a;function u(m){return{label:m.label||m.color,color:m.color}}ze.normalizeColor=u;function c(m,x,I){return m.map(function(E){return T(x,E,I)})}function d(m,x,I){var E,L,H,V=T(x,m.folder,I);return{id:$(I.packId,m.id),label:m.label,chibi:m.chibi?T(V,m.chibi,I):void 0,heads:P(m.heads,V,I),defaultScale:(E=m.defaultScale)!==null&&E!==void 0?E:[.8,.8],size:(L=m.size)!==null&&L!==void 0?L:[960,960],hd:(H=m.hd)!==null&&H!==void 0?H:!1,sdVersion:m.sdVersion,styleGroups:o(g,m.styleGroups,V,I)}}function g(m,x,I){var E=T(x,m.folder,I);return{id:$(I.packId,m.id),styleComponents:o(_,m.styleComponents,E,I),styles:m.styles.map(function(L){return b(L,E,I)})}}function b(m,x,I){var E=T(x,m.folder,I),L={};if(m.components)for(var H in m.components)m.components.hasOwnProperty(H)&&(L[$(I.packId,H)]=m.components[H]);return{components:L,poses:m.poses.map(function(V){return y(V,E,I)})}}function _(m,x,I){return{id:$(I.packId,m.id),label:m.label,variants:w(m.variants,x,I)}}ze.normalizeStyleComponent=_;function w(m,x,I){if(!m)return{};var E={};for(var L in m)m.hasOwnProperty(L)&&(E[L]=T(x,m[L],I));return E}function P(m,x,I){var E={};if(!m)return E;for(var L in m)if(m.hasOwnProperty(L)){var H=m[L],V=void 0;if(H instanceof Array)V={variants:v(H,x,I),previewOffset:[290,70],previewSize:[380,380]};else{var ae=T(x,H.folder,I);V={variants:v(H.variants,ae,I),previewOffset:H.previewOffset||[290,70],previewSize:H.previewSize||[380,380]}}E[$(I.packId,L)]=V}return E}function y(m,x,I){var E,L,H=T(x,m.folder,I);return{compatibleHeads:((E=m.compatibleHeads)===null||E===void 0?void 0:E.map(function(V){return $(I.packId,V)}))||[],id:$(I.packId,m.id),previewOffset:m.previewOffset||[0,0],previewSize:m.previewSize||[960,960],size:m.size||[960,960],scale:m.scale||.8,positions:e.mapObject(m.positions||{},function(V){return v(V,H,I)}),renderCommands:((L=m.renderCommands)===null||L===void 0?void 0:L.map(function(V){return h(V,x,I)}))||[{type:"head",offset:[0,0]},{type:"pose-part",part:"Left",offset:[0,0]},{type:"pose-part",part:"Right",offset:[0,0]},{type:"pose-part",part:"Variant",offset:[0,0]}]}}function h(m,x,I){if(m.type==="image"){var E=T(x,m.folder,I);return{type:"image",composite:m.composite,offset:m.offset||[0,0],images:f(m.images,E,I)}}else return t(t({},m),{offset:m.offset||[0,0]})}function v(m,x,I){return m.map(function(E){return f(E,x,I)})}function f(m,x,I){return m.map(function(E){return T(x,E,I)})}function C(m){return m.startsWith("blob:")||m.startsWith("http://")||m.startsWith("https://")||m.startsWith("://")}function T(m,x,I){if(!x)return m;for(var E in I.paths)if(x.startsWith(E))return I.paths[E]+x.slice(E.length);return C(x)?x:m+x}function $(m,x){return x.indexOf(":")!==-1?x:m+":"+x}return ze.expandId=$,ze}var _d;function M1(){if(_d)return yt;_d=1;var t=yt&&yt.__values||function(h){var v=typeof Symbol=="function"&&Symbol.iterator,f=v&&h[v],C=0;if(f)return f.call(h);if(h&&typeof h.length=="number")return{next:function(){return h&&C>=h.length&&(h=void 0),{value:h&&h[C++],done:!h}}};throw new TypeError(v?"Object is not iterable.":"Symbol.iterator is not defined.")},e=yt&&yt.__read||function(h,v){var f=typeof Symbol=="function"&&h[Symbol.iterator];if(!f)return h;var C=f.call(h),T,$=[],m;try{for(;(v===void 0||v-- >0)&&!(T=C.next()).done;)$.push(T.value)}catch(x){m={error:x}}finally{try{T&&!T.done&&(f=C.return)&&f.call(C)}finally{if(m)throw m.error}}return $},n=yt&&yt.__spread||function(){for(var h=[],v=0;v<arguments.length;v++)h=h.concat(e(arguments[v]));return h};Object.defineProperty(yt,"__esModule",{value:!0}),yt.expandOrTranslateId=yt.convert=void 0;var o=wh();function s(h,v,f){if(!h.packId)throw new Error("");return{packId:h.packId,packCredits:h.packCredits?[h.packCredits]:[],dependencies:i(h.id),backgrounds:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],characters:[l(h,v,f)],colors:[]}}yt.convert=s;var r={"ddlc.monika":P("dddg.buildin.base.monika","ddlc.monika",{heads:["straight","sideways"],poses:["normal","leaned","old","glitch"],styleGroups:["uniform","old","glitch"]}),"ddlc.natsuki":P("dddg.buildin.base.natsuki","ddlc.natsuki",{heads:["straight","straight_nsfw","sideways","turnedAway"],poses:["normal","crossed_arms","vomit","glitch"],styleGroups:["uniform","casual","old"],extraPoseAssoc:[["normal_causal","normal"],["crossed_arms_casual","crossed_arms"]],extraHeadAssoc:[["straight_nsfw","straight"]]}),"ddlc.sayori":P("dddg.buildin.sayori","ddlc.sayori",{heads:["straight","sideways"],poses:["normal","sideways","old","glitch","dead"],styleGroups:["uniform","casual","old","glitch","hanging"],extraPoseAssoc:[["normal_casual","normal"]]}),"ddlc.yuri":P("dddg.buildin.yuri","ddlc.yuri",{heads:["straight","sideways"],poses:["normal","sideways","stabbing","glitching","dragon"],styleGroups:["uniform","casual","glitch"],extraPoseAssoc:[["normal_causal","normal"],["hairplay_casual","hairplay"]]}),"ddlc.fan.mc1":P("dddg.buildin.mc_classic","ddlc.fan.mc1",{heads:["straight"],poses:["normal"],styleGroups:[],extraStyleGroupAssoc:[["uniform-yellow","uniform"]]}),"ddlc.fan.mc2":P("dddg.buildin.mc","ddlc.fan.mc2",{heads:["straight","straight_red"],poses:["normal","crossed_arms","casual","glitching","dragon"],styleGroups:["uniform","casual"],extraPoseAssoc:[["crossed_arms_casual","crossed_arms"],["crossed_arms_red","crossed_arms"],["normal_red","normal"],["casual_red","casual"],["casual_crossed_arms_red","crossed_arms"]],defaultStyleComponents:[{id:"eyes",label:"Eyes",variants:{yellow:"/parts/mc/yellow-eyes{ext}",red:"/parts/mc/red-eyes{ext}"}}]}),"ddlc.fan.mc_chad":P("dddg.buildin.mc_chad","ddlc.fan.mc_chad",{heads:["straight","straight_closed","straight_red"],poses:["normal","youknowihadto"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal_casual","normal"],["youknowihadto_casual","youknowihadto"],["normal_red","normal"],["youknowihadto_red","youknowihadto"],["normal_casual_red","normal"],["youknowihadto_casual_red","youknowihadto"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/chad/yellow-eyes{ext}",red:"/parts/chad/red-eyes{ext}"}}]}),"ddlc.fan.femc":P("dddg.buildin.femc","ddlc.fan.femc",{heads:["straight","straight_lh","straight_closed","straight_hetero","straight_hetero_lh"],poses:["normal","crossed_arms"],styleGroups:["uniform","casual","uniform_strict"],extraPoseAssoc:[["casual_normal","normal"],["casual_crossed_arms","crossed_arms"],["uniform_normal","normal"],["uniform_crossed_arms","crossed_arms"],["normal_long_hair","normal"],["crossed_arms_long_hair","crossed_arms"],["casual_normal_long_hair","normal"],["casual_crossed_arms_long_hair","crossed_arms"],["uniform_normal_long_hair","normal"],["uniform_crossed_arms_long_hair","crossed_arms"],["normal_hetero","normal"],["crossed_arms_hetero","crossed_arms"],["casual_normal_hetero","normal"],["casual_crossed_arms_hetero","crossed_arms"],["uniform_normal_hetero","normal"],["uniform_crossed_arms_hetero","crossed_arms"],["normal_long_hair_hetero","normal"],["crossed_arms_long_hair_hetero","crossed_arms"],["casual_normal_long_hair_hetero","normal"],["casual_crossed_arms_long_hair_hetero","crossed_arms"],["uniform_normal_long_hair_hetero","normal"],["uniform_crossed_arms_long_hair_hetero","crossed_arms"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/femc/yellow-eyes{ext}",hetero:"/parts/femc/hetero-eyes{ext}"}},{label:"Hairs",id:"hairs",variants:{sh:"/parts/femc/short-hair{ext}",lh:"/parts/femc/long-hair{ext}"}}]}),"ddlc.fan.amy1":P("dddg.buildin.amy1","ddlc.fan.amy1",{heads:["straight"],poses:["normal","crossed_arms"],styleGroups:["uniform"]}),"ddlc.fan.amy2":P("dddg.buildin.amy2","ddlc.fan.amy2",{heads:["straight","straight_closed","straight_red"],poses:["normal","folded_hands_up","folded_hands_down","hands_on_glasses"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal-casual","normal"],["folded_hands_up-casual","folded_hands_up"],["folded_hands_down-casual","folded_hands_down"],["hands_on_glasses-casual","hands_on_glasses"]]})};function i(h){return[]}function l(h,v,f){var C={characterId:h.id,packId:h.packId,paths:v};return{id:y("character",h.id,C),chibi:h.chibi,label:h.name,heads:b(h.heads,C,f),styleGroups:a(h,C,f),defaultScale:[.8,.8],size:[960,960],hd:!1}}function a(h,v,f){var C,T,$=r[v.characterId],m=[],x=new Map,I=_(h,v),E=I.length===0?$&&$.defaultStyleComponents?u($.defaultStyleComponents,v):[]:I,L=h.poses.map(function(S){return S.style}).filter(function(S,R,se){return se.indexOf(S)===R}),H=new Map(h.styles.map(function(S){return[S.name,S]})),V=function(S){var R,se,U,ne,we=H.get(S);if(we&&we.nsfw&&!f)return"continue";var Se=S,_e={};try{for(var Ye=(R=void 0,t(E)),K=Ye.next();!K.done;K=Ye.next()){var Ce=K.value;try{for(var Pe=(U=void 0,t(Object.keys(Ce.variants))),Y=Pe.next();!Y.done;Y=Pe.next()){var W=Y.value,k=new RegExp("-"+W+"\\b");if(Se.match(k)){_e[Ce.id]=W,Se=Se.replace(k,"");break}}}catch(M){U={error:M}}finally{try{Y&&!Y.done&&(ne=Pe.return)&&ne.call(Pe)}finally{if(U)throw U.error}}}}catch(M){R={error:M}}finally{try{K&&!K.done&&(se=Ye.return)&&se.call(Ye)}finally{if(R)throw R.error}}Se=y("styleGroups",Se,v);var O=x.get(Se);O||(O={id:Se,styleComponents:E,styles:[]},x.set(Se,O),m.push(Se)),O.styles.push({components:_e,poses:d(h.poses.filter(function(M){return M.style===S}),v,f)})};try{for(var ae=t(L),ue=ae.next();!ue.done;ue=ae.next()){var A=ue.value;V(A)}}catch(S){C={error:S}}finally{try{ue&&!ue.done&&(T=ae.return)&&T.call(ae)}finally{if(C)throw C.error}}return m.map(function(S){return x.get(S)})}function u(h,v){return o.mapNormalize(o.normalizeStyleComponent,h,"",{packId:v.packId,paths:v.paths})}function c(h,v){return h?[{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"},{type:"head",offset:v}]:[{type:"head",offset:v},{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"}]}function d(h,v,f){return h.map(function(C){return{compatibleHeads:C.compatibleHeads.map(function(T){return y("heads",T.toString(),v)}),id:y("poses",C.name,v),renderCommands:c(C.headInForeground,C.headAnchor),previewOffset:C.offset,previewSize:C.size,size:[960,960],scale:.8,positions:{Static:"static"in C?[[C.static]]:[],Left:"left"in C?g(C.left,f):[],Right:"right"in C?g(C.right,f):[],Variant:"variant"in C?g(C.variant,f):[]}}})}function g(h,v){return h.filter(function(f){return!f.nsfw||v}).map(function(f){return[f.img]})}function b(h,v,f){var C,T,$={};try{for(var m=t(Object.keys(h)),x=m.next();!x.done;x=m.next()){var I=x.value,E=h[I];E.nsfw&&!f||($[y("heads",I,v)]={previewOffset:E.offset,previewSize:E.size,variants:E.all.filter(function(L){return!L.nsfw||f}).map(function(L){return[L.img]})})}}catch(L){C={error:L}}finally{try{x&&!x.done&&(T=m.return)&&T.call(m)}finally{if(C)throw C.error}}return $}function _(h,v){var f=[],C=[];return Object.keys(h.eyes).length>0&&(Object.keys(h.eyes).forEach(function(T){return C.push(T)}),f.push({label:"Eyes",id:y("eyes","eyes",v),variants:h.eyes})),Object.keys(h.hairs).length>0&&(Object.keys(h.hairs).forEach(function(T){return C.push(T)}),f.push({label:"Hairs",id:y("hairs","hairs",v),variants:h.hairs})),f}function w(h,v){return new Map(v.map(function(f){return[f,h+":"+f]}))}function P(h,v,f){return f.extraHeadAssoc?f.extraHeadAssoc=f.extraHeadAssoc.map(function(C){return[C[0],h+":"+C[1]]}):f.extraHeadAssoc=[],f.extraPoseAssoc?f.extraPoseAssoc=f.extraPoseAssoc.map(function(C){return[C[0],h+":"+C[1]]}):f.extraPoseAssoc=[],f.extraStyleGroupAssoc?f.extraStyleGroupAssoc=f.extraStyleGroupAssoc.map(function(C){return[C[0],h+":"+C[1]]}):f.extraStyleGroupAssoc=[],{character:h+":"+v,eyes:h+":eyes",hairs:h+":hair",defaultStyleComponents:f.defaultStyleComponents||[],heads:new Map(n(w(h,f.heads),f.extraHeadAssoc)),poses:new Map(n(w(h,f.poses),f.extraPoseAssoc)),styleGroups:new Map(n(w(h,f.styleGroups),f.extraStyleGroupAssoc))}}function y(h,v,f){var C=r[f.characterId];if(C){if(h==="character"||h==="hairs"||h==="eyes")return C[h];var T=C[h].get(v);if(T)return T}return o.expandId(f.packId,v)}return yt.expandOrTranslateId=y,yt}var B1=M1(),E1=wh(),ml=yh();function Ds(t,e){return{backgrounds:D1(t.backgrounds,e.backgrounds),characters:N1(t.characters,e.characters),dependencies:Ul(t.dependencies,e.dependencies),fonts:zt(t.fonts,e.fonts,n=>n.id,(n,o)=>({...n,files:Ul(n.files,o.files)})),poemStyles:zt(t.poemStyles,e.poemStyles,n=>n.label,()=>{throw new Error}),poemBackgrounds:[...t.poemBackgrounds,...e.poemBackgrounds],sprites:zt(t.sprites,e.sprites,n=>n.id,(n,o)=>({id:n.id,label:n.label,variants:[...n.variants,...o.variants],defaultScale:n.defaultScale,hd:n.hd,sdVersion:n.sdVersion??o.sdVersion})),colors:zt(t.colors,e.colors,n=>n.color,n=>n)}}function D1(t,e){return zt(t,e,n=>n.id,L1)}function L1(t,e){return{id:t.id,label:t.label,variants:[...t.variants,...e.variants],scaling:t.scaling,sdVersion:t.sdVersion??e.sdVersion}}function N1(t,e){return zt(t,e,n=>n.id,F1)}function F1(t,e){return{chibi:t.chibi,id:t.id,label:t.label,heads:U1(t.heads,e.heads),defaultScale:t.defaultScale,hd:t.hd,size:t.size,sdVersion:t.sdVersion,styleGroups:zt(t.styleGroups,e.styleGroups,n=>n.id,(n,o)=>({id:n.id,styleComponents:zt(n.styleComponents,o.styleComponents,s=>s.id,(s,r)=>({id:s.id,label:s.label,variants:H1(s.variants,r.variants)})),styles:zt(n.styles,o.styles,s=>JSON.stringify(s.components),(s,r)=>({components:s.components,poses:zt(s.poses,r.poses,i=>i.id,V1)}))}))}}function H1(t,e){const n={...t};for(const o in e)Object.prototype.hasOwnProperty.call(e,o)&&(Object.prototype.hasOwnProperty.call(n,o)||(n[o]=e[o]));return n}function V1(t,e){const n={...t.positions};for(const o in e.positions)n[o]?n[o]=[...n[o],...e.positions[o]]:n[o]=e.positions[o];return{id:t.id,compatibleHeads:Ul(t.compatibleHeads,e.compatibleHeads),previewOffset:t.previewOffset,previewSize:t.previewSize,scale:t.scale,size:t.size,renderCommands:t.renderCommands,positions:n}}function U1(t,e){const n={...t};for(const o in e){if(!Object.prototype.hasOwnProperty.call(e,o))continue;const s=e[o];if(n[o]){const r=n[o];n[o]={previewOffset:r.previewOffset,previewSize:r.previewSize,variants:[...r.variants,...s.variants]}}else n[o]=s}return n}function Ul(t,e){const n=[...t];for(const o of e)n.includes(o)||n.push(o);return n}function zt(t,e,n,o){const s=[...t],r=new Map(t.map((i,l)=>[n(i),l]));for(const i of e){const l=n(i);if(r.has(l)){const a=r.get(l),u=s[a];s.splice(a,1,o(u,i))}else r.set(l,s.length),s.push(i)}return s}function W1(t){return t.split("/").slice(0,-1).join("/")+"/"}const Pd=new Set(["png","gif","bmp","svg"]);function kh(){return{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}}}const q1={namespaced:!0,state:kh(),mutations:{setContentPacks(t,e){t.contentPacks=e},setCurrentContent(t,e){t.current=e}},actions:{removeContentPacks({commit:t,state:e,dispatch:n},o){const s=JSON.parse(JSON.stringify(e.current)),r=e.contentPacks.filter(i=>!o.has(i.packId));t("setContentPacks",r),t("setCurrentContent",r.reduce((i,l)=>Ds(i,l))),n("panels/fixContentPackRemoval",s,{root:!0})},async replaceContentPack({commit:t,state:e},n){const o=n.processed?n.contentPack:await ur(n.contentPack);let s=e.contentPacks;const r=s.findIndex(i=>i.packId===n.contentPack.packId);r===-1?s.push(o):s.splice(r,1,o),s=s,t("setContentPacks",s),t("setCurrentContent",s.reduce((i,l)=>Ds(i,l)))},async loadContentPacks({commit:t,state:e},n){typeof n=="string"&&(n=[n]);const o=await Promise.all(n.map(async l=>await Wl(l))),s=await Promise.all(o.map(l=>ur(l))),r=new Set(e.contentPacks.map(l=>l.packId));let i=e.current;for(const l of s){for(const a of l.dependencies)if(!r.has(a))throw new Error(`Missing dependency '${a}'. Refusing to install ${l.packId}`);i=Ds(i,l)}return t("setContentPacks",[...e.contentPacks,...s]),t("setCurrentContent",i),o.map(l=>l.packId)}},getters:{getCharacters({current:t}){const e=new Map;for(const n of t.characters)e.set(n.id,n);return e},getBackgrounds({current:t}){const e=new Map;for(const n of t.backgrounds)e.set(n.id,n);return e}}};async function Wl(t){const e=await fetch(t);if(!e.ok)throw new Error(`Could not load content pack. Server responded with: ${e.statusText}`);let n;try{n=await e.json()}catch{throw new Error("Content pack is not valid json!")}try{const o={"./":W1(t),"/":xa};return n.version==="2.0"?E1.normalizeContentPack(n,o):B1.convert(A1.normalizeCharacter(n,o),o,!1)}catch{throw new Error("Content pack is not in a valid format!")}}async function ur(t){const e=new Set(await go()?["webp",...Pd]:Pd),n=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return ml.assetWalker(t,o=>{const s=ml.normalizePath(o,n,e,!1),r=ml.normalizePath(o,n,e,!0);return{hq:s,lq:r,sourcePack:t.packId??"buildIn"}})}function cr(t,e,n){return t>e?t:e>n?n:e}function ql(t,e){return(t%e+e)%e}function z1(t,e){return t===null&&e===null?!0:t===null||e===null?!1:t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.e===e.e&&t.f===e.f}function dr(t){const{a:e,b:n,c:o,d:s,e:r,f:i}=t,l=e*s-n*o,a={x:r,y:i,rotation:0,scaleX:0,scaleY:0,skewX:0,skewY:0};if(e!=0||n!=0){const u=Math.sqrt(e*e+n*n);a.rotation=(n>0?Math.acos(e/u):-Math.acos(e/u))/Math.PI*180,a.scaleX=u,a.scaleY=l/u,a.skewX=Math.atan((e*o+n*s)/(u*u))/Math.PI*180,a.skewY=0}else if(o!=0||s!=0){const u=Math.sqrt(o*o+s*s);a.rotation=(Math.PI/2-(s>0?Math.acos(-o/u):-Math.acos(o/u)))/Math.PI*180,a.scaleX=l/u,a.scaleY=u,a.skewX=0,a.skewY=Math.atan((e*o+n*s)/(u*u))/Math.PI*180}return a}const G1={setChoicesProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version},setChoiceProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n.choices[e.choiceIdx][e.key]=e.value,++n.version},setChoices(t,e){const n=t.panels[e.panelId].objects[e.id];n.choices=e.choices,++n.version}},X1={createChoice({commit:t,state:e},n){const o=de(),s=e.panels[n.panelId].lastObjId+1;return t("create",{object:{...To(),y:o.Choices.ChoiceY,width:o.Choices.ChoiceButtonWidth,height:0,panelId:n.panelId,id:s,onTop:!0,autoWrap:!0,type:"choice",choiceDistance:o.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:o.Choices.ChoiceButtonColor}}),s},addChoice({state:t,commit:e},n){const o=t.panels[n.panelId].objects[n.id];e("setChoices",{id:n.id,panelId:n.panelId,choices:[...o.choices,{selected:!1,text:n.text}]})},removeChoice({state:t,commit:e},n){const s=[...t.panels[n.panelId].objects[n.id].choices];s.splice(n.choiceIdx,1),s.length===0&&s.push({selected:!1,text:""}),e("setChoices",{id:n.id,panelId:n.panelId,choices:s})}},Y1={setNotificationProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},K1={createNotification({commit:t,rootState:e,state:n},o){const s=de(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{...To(),y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:o.panelId,autoWrap:!1,id:r,onTop:!0,type:"notification",customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0}}),r}},J1={setPoemProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},Z1={createPoem({commit:t,rootState:e,state:n},o){const s=de(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:o.panelId,flip:!1,rotation:0,id:r,onTop:!0,opacity:100,type:"poem",version:0,autoWrap:!0,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,scaleX:1,scaleY:1,skewX:0,skewY:0,ratio:1,preserveRatio:!0,consoleColor:s.Poem.consoleBackgroundColor,overflow:!1,linkedTo:null}}),r},createConsole({commit:t,rootState:e,state:n},o){const s=de(),r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{...To(),subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:o.panelId,id:r,onTop:!0,type:"poem",background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0,consoleColor:s.Poem.consoleBackgroundColor}}),r}},Q1={},ek={async createSprite({commit:t,rootState:e,state:n},o){const s=await Ia(o.assets[0],!1);if(!(s instanceof Fn))return;const r=n.panels[o.panelId].lastObjId+1;return t("create",{object:{...To(),assets:o.assets,height:s.height,width:s.width,id:r,panelId:o.panelId,onTop:!1,type:"sprite",y:de().Base.screenHeight/2,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom}}),r}},Od=5;class tk{constructor(e){B(this,"pos",0);this.str=e}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-Od),this.pos+Od)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function Id(t,e=!0){const n=[],o=new tk(t);let s=Er;for(;s!==Dr;){const r=o.pos;try{s=s(n,o)}catch(i){if(e&&s!==zl)o.pos=r,s=(l,a)=>zl(l,a,!0);else throw i}}return n}function Er(t,e){return e.current()===void 0?Dr:e.current()==="{"?nk:e.current()===`
`?ok:zl}function Dr(){return Dr}function zl(t,e,n=!1){const{pos:o}=e;let s="",r=n,i;for(;;){if(e.current()===void 0){i=Dr;break}else if(r)s+=e.current(),r=!1;else if(e.current()==="\\")r=!0;else if(e.current()==="{"||e.current()===`
`){i=Er;break}else s+=e.current();e.next()}return t.push({type:"text",pos:o,content:s}),i}function yl(t,e){throw new Error(`Error when parsing text at position ${t.pos}: (around: "${t.around}") ${e}`)}function nk(t,e){const{pos:n}=e;if(e.current()!=="{")throw new Error("Parser error: Command does not start with {");const o=e.next()==="/";o&&e.next();let s="",r="",i=!1;for(;e.current()===void 0&&yl(e,"Unexpected end of text inside a command"),e.current()!=="}";)i?r+=e.current():e.current().match(/[a-z]/i)?s+=e.current():e.current()==="="?(o&&yl(e,"Closing commands may not contain arguments"),i=!0):yl(e,`Unexpected character '${e.current()}' in command name.`),e.next();return e.next(),o?t.push({type:"commandClose",commandName:s,pos:n}):t.push({type:"command",pos:n,argument:r,commandName:s}),Er}function ok(t,e){return t.push({type:"newline",pos:e.pos}),e.next(),Er}const Td=new Map([Jn("i",t=>({...t,isItalic:!0})),Jn("b",t=>({...t,isBold:!0})),Jn("u",t=>({...t,isUnderlined:!0})),Jn("s",t=>({...t,isStrikethrough:!0})),Jn("plain",t=>({...t,isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),Jn("edited",t=>({...t,fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),js("k",(t,e,n)=>({...t,letterSpacing:e?t.letterSpacing+n:n})),js("size",(t,e,n)=>({...t,fontSize:e?t.fontSize+n:n})),js("alpha",(t,e,n)=>({...t,alpha:e?t.alpha+n:n})),js("stroke",(t,e,n)=>({...t,strokeWidth:e?t.strokeWidth+n:n})),["font",(t,e)=>({...t,fontName:e})],["color",(t,e)=>({...t,color:e})],["outlinecolor",(t,e)=>({...t,strokeColor:e})]]);function Jn(t,e){return[t,(n,o)=>{if(o!=="")throw new Error(`Operator '${t}' does not take any arguments.`);return e(n)}]}function js(t,e){return[t,(n,o)=>{if(o=="")throw new Error(`Operator '${t}' needs an argument.`);const s=o[0]==="+"||o[0]==="-",r=Number(o);if(isNaN(r))throw new Error(`Operator '${t}' needs a numeric argument.`);return e(n,s,r)}]}class jt{constructor(e,n){B(this,"renderParts");B(this,"tokens");B(this,"loose");B(this,"lastLayoutHeight",null);B(this,"lastLayoutWidth",null);this.str=e,this.baseStyle=n,this.loose=ge.state.looseTextParsing;try{this.tokens=Id(e,this.loose)}catch(o){if(o instanceof Error)this.tokens=[{type:"text",pos:0,content:o.message}];else throw o}this.rebuildParts()}rebuildParts(){this.renderParts=jt.getRenderParts(this.tokens,this.baseStyle,this.loose)}loadFonts(){if(!("fonts"in document))return;const e=new Set;let n=null;for(const s of this.renderParts)"style"in s&&s.style!==n&&(n=s.style,n.fontName&&e.add(n.fontName));const o=[];for(const s of e){const r=document,i=`8px '${s.replaceAll("'","\\'")}'`;r.fonts.check(i)||o.push(r.fonts.load(i))}if(o.length!==0)return Promise.all(o).then(()=>{const s=Id(this.str);this.renderParts=jt.getRenderParts(s,this.baseStyle,this.loose)})}render(e){e.save();let n=null;for(const o of this.renderParts)o.type==="character"&&(o.style!==n&&(n=o.style,Gl(n,e)),n.strokeWidth>0&&n.strokeColor>""&&e.strokeText(o.character,o.x,o.y));for(const o of this.renderParts)o.type==="character"&&(o.style!==n&&(n=o.style,Gl(n,e)),e.fillText(o.character,o.x,o.y));e.restore()}quote(){let e;(r=>{r[r.None=0]="None",r[r.ExplictQuote=1]="ExplictQuote",r[r.ImplictQuote=2]="ImplictQuote",r[r.Star=3]="Star"})(e||(e={}));let n=-1,o=0;for(let r=0;r<this.renderParts.length;++r){const i=this.renderParts[r];if(i.type==="character")switch(o){case 0:if(i.character.match(/\s/))continue;i.character==='"'?(o=1,n=r):i.character==="*"?(o=3,n=r):(this.renderParts.splice(r,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Vo(i.style,'"')}),r++,n=r,o=2);break;case 1:n=r,i.character==='"'&&(o=0);break;case 2:if(i.character.match(/\s/))continue;i.character==="*"&&(this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Vo(i.style,'"')}),o=3,r++),n=r;break;case 3:i.character==="*"&&(o=0),n=r;break;default:throw new Mt.UnreachableCaseError(o)}}const s=this.renderParts[n];s&&o===3&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:"*",height:s.height,width:Vo(s.style,'"')}),s&&(o===1||o===2)&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:'"',height:s.height,width:Vo(s.style,'"')})}applyLayout(e,n,o,s,r){const i=this.renderParts,l=[];let a=null,u=0,c=0;const d=()=>{a={type:"group",renderParts:[],height:0,width:0},u=s,c=-1,l.push(a)};d();for(const f of i)if(f.type==="newline"||f.type==="alignment")if(l.push(f),f.type==="alignment"&&r){const C=u;d(),u=C}else d();else{if(u<f.width&&r){const C={type:"newline",height:f.height,width:f.height,x:0,y:0};if(f.character===" "){l.push(C),d();continue}else if(c!==-1){const T=a.renderParts.splice(c).slice(1),$=T.reduce((x,I)=>x+I.width,0),m=T.reduce((x,I)=>x>I.height?x:I.height,0);a.width-=$,a.height===m&&(a.height=a.renderParts.reduce((x,I)=>x>I.height?x:I.height,0)),l.push(C),d(),a.renderParts=T,a.width=$,a.height=m,u-=$}}else f.character===" "&&(c=a.renderParts.length);a.renderParts.push(f),a.height=Math.max(a.height,f.height),a.width+=f.width,u-=f.width}const g=[];let b=0;for(const f of l)b=Math.max(b,f.height),f.type==="newline"&&(g.push(b),b=0);g.push(b);let _=0,w=e,P=o,y=0,h=s;for(const f of l){if(f.type==="newline"){P+=g[++_]||0,y=0,h=s;continue}if(f.type==="alignment"){w=f.alignment;continue}switch(w){case"left":v(f,y,P),y+=f.width;break;case"center":v(f,y+(h-y)/2-f.width/2,P);break;case"right":v(f,h-f.width,P),h-=f.width;break}}this.lastLayoutHeight=P,this.lastLayoutWidth=s;function v(f,C,T){let $=C;for(const m of f.renderParts)m.y=T,m.x=n+$,$+=m.width}}getHeight(e){let n=0,o=0;const s=e===0?this.renderParts:jt.applyLineWrapping(this.renderParts.slice(0),e);for(const r of s)n=Math.max(n,r.height),r.type==="newline"&&(o+=n,n=0);return o+=n,o}getWidth(){let e=0,n=0;for(const o of this.renderParts)e+=o.width,o.type==="newline"&&(n=Math.max(n,e),e=0);return n=Math.max(n,e),n}static getRenderParts(e,n,o){const s=[],r=[],i=[];let l=Rd(n),a=n,u=null;function c(d){for(const g of d)s.push({type:"character",character:g,height:l,width:Vo(a,g),style:a,x:0,y:0})}for(const d of e){const g=d.type;switch(g){case"command":if(d.commandName==="align"){const b=d.argument.toLowerCase();if(b!=="left"&&b!=="center"&&b!=="right")if(o){c("{align="+d.argument+"}");continue}else throw new Error(`There is no text command called '${d.commandName}' at position ${d.pos}.`);s.push({type:"alignment",alignment:b,height:l,width:0,x:0,y:0})}else if(Td.has(d.commandName)){r.push(a),i.push(u);try{a=Td.get(d.commandName)(a,d.argument),l=Rd(a),u=d}catch(b){if(o){r.pop(),i.pop(),c("{"+d.commandName+(d.argument?"="+d.argument:"")+"}"),console.error("Parsing error",b);continue}else throw b}}else if(o)c("{"+d.commandName+"}");else throw new Error(`There is no text command called '${d.commandName}' at position ${d.pos}.`);break;case"commandClose":if(!u)if(o){c("{/"+d.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${d.pos}. Closed '${d.commandName}', but no commands are currently open.`);if(d.commandName!==u.commandName)if(o){c("{/"+d.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${d.pos}. Closed '${d.commandName}', expected to close '${u}' first. (Opened at position ${u.pos})`);u=i.pop(),a=r.pop();break;case"newline":s.push({height:l,width:0,x:0,y:0,type:"newline"});break;case"text":c(d.content);break;default:throw new Mt.UnreachableCaseError(g)}}return s}static applyLineWrapping(e,n){let o=-1,s=0,r=0;const i=[];for(const l of e)if(l.type==="newline")o=-1,s=0,r=0,i.push(l);else if(l.type==="alignment")console.error("Alignment in context where it's not supported.");else if(l.type==="character")l.character===" "?s>n?(o=-1,s=0,r=0,i.push({type:"newline",height:l.height,width:0,x:0,y:0})):(s+=l.width,r=s,o=i.length,i.push(l)):(s+=l.width,s>n&&o!==-1&&(s-=r,i.splice(o,1,{type:"newline",height:l.height,width:0,x:0,y:0}),o=-1,r=0),i.push(l));else throw new Mt.UnreachableCaseError(l);return i}}const Ka=Un();Ka.width=0;Ka.height=0;const jd=Ka.getContext("2d");let $d=null;function Vo(t,e){t!==$d&&(Gl(t,jd),$d=t);let n=t.letterSpacing;return(typeof n!="number"||isNaN(n)||!isFinite(n))&&(n=0),jd.measureText(e).width+n}const wl=new Map;function Rd(t){const e=t.fontSize+" "+t.fontName;if(wl.has(e))return wl.get(e)*t.lineSpacing;const n=document.createElement("span");n.innerHTML="Hg",n.style.fontFamily=t.fontName,n.style.fontSize=`${t.fontSize}px`,n.style.lineHeight="1";const o=document.createElement("div");o.style.opacity="0",o.style.fontFamily=t.fontName,o.style.fontSize=`${t.fontSize}px`,o.style.lineHeight="1",o.style.position="absolute",o.style.top="0",o.style.left="0",o.appendChild(n),document.body.appendChild(o);try{const s=o.offsetHeight;return wl.set(e,s),s*t.lineSpacing}finally{o.remove()}}function Gl(t,e){e.textAlign="left",e.font=(t.isItalic?"italic ":"")+(t.isBold?"bold ":"")+t.fontSize+"px "+t.fontName,e.lineJoin="round",t.strokeWidth>0&&t.strokeColor>""?(e.strokeStyle=t.strokeColor,e.lineWidth=t.strokeWidth):(e.strokeStyle="",e.lineWidth=0),e.globalAlpha=t.alpha||0,e.fillStyle=t.color}function Ch(t,e,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),t.moveTo(e+r,n),t.arcTo(e+o,n,e+o,n+s,r),t.arcTo(e+o,n+s,e,n+s,r),t.arcTo(e,n+s,e,n,r),t.arcTo(e,n,e+o,n,r),t.closePath()}function xh(t,e,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),t.moveTo(e+r,n),t.arcTo(e+o,n,e+o,n+s,r),t.lineTo(e+o,n+s),t.lineTo(e,n+s),t.arcTo(e,n,e+o,n,r),t.closePath()}function yn(t,e){t.save();try{e()}finally{t.restore()}}function ns(t,e){e.align&&(t.textAlign=e.align),e.font!=null&&(t.font=e.font),e.fill&&(t.fillStyle=e.fill.style),e.outline&&(t.strokeStyle=e.outline.style,t.lineWidth=e.outline.width)}function sk(t,e){if("filter"in t){let n="";for(const o of e)o.type==="drop-shadow"?n+=` drop-shadow(${o.offsetX}px ${o.offsetY}px ${o.blurRadius}px ${o.color})`:o.type==="hue-rotate"?n+=` hue-rotate(${o.value}deg)`:o.type==="blur"?n+=` blur(${o.value}px)`:n+=` ${o.type}(${o.value*100}%)`;t.filter=(t.filter==="none"?"":t.filter)+n.trimStart()}else{let n=1;for(const o of e)o.type==="opacity"&&(n*=o.value);t.globalAlpha*=n}}class Sh{constructor(e){B(this,"lastVersion",null);B(this,"localCanvasInvalid",!0);B(this,"lastHit",null);B(this,"lastLocalTransform",null);B(this,"refTextbox",null);B(this,"preparedTransform");B(this,"hitDetectionFallback",!1);B(this,"localCanvas",null);this.obj=e}get id(){return this.obj.id}get canSkipLocal(){return!1}get transformIsLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get x(){return this.obj.x}get y(){return this.obj.y}getTransfrom(){let e=new DOMMatrix;const n=this.obj;e=e.translate(this.x,this.y);const o=this.height/2*n.scaleX;return"close"in n&&n.close&&(e=e.translate(0,de().Base.CloseUpYOffset),e=e.translate(0,-o),e=e.scale(2,2),e=e.translate(0,o)),this.isTalking&&n.enlargeWhenTalking&&(e=e.translate(0,+o),e=e.scale(1.05,1.05),e=e.translate(0,-o)),(n.flip||n.rotation!==0||n.scaleX!==1||n.scaleY!==1||n.skewX!==0||n.skewY!==0)&&(n.rotation!==0&&(e=e.rotate(0,0,n.rotation)),n.skewX!==0&&(e=e.skewX(n.skewX)),n.skewY!==0&&(e=e.skewY(n.skewY)),n.flip&&(e=e.flipX()),(n.scaleX!==1||n.scaleY!==1)&&(e=e.scale(n.scaleX,n.scaleY))),e}getLocalSize(){if(this.transformIsLocal){const e=de();return new DOMPointReadOnly(e.Base.screenWidth,e.Base.screenHeight)}else return new DOMPointReadOnly(this.width,this.height)}get isTalking(){return this.refTextbox!==null}get linkedTo(){return this.obj.linkedTo}prepareData(e,n){this.refTextbox=null;const o=[...e.order,...e.onTopOrder];for(const s of o){const r=e.objects[s];if(r.type==="textBox"&&r.talkingObjId===this.obj.id){this.refTextbox=r;return}}}prepareTransform(e){return this.preparedTransform=e.multiply(this.getTransfrom()),this.preparedTransform}prepareRender(e){if(this.lastVersion!==this.obj.version&&(this.localCanvasInvalid=!0,this.lastVersion=this.obj.version),this.transformIsLocal){const n=this.preparedTransform;z1(n,this.lastLocalTransform)||(this.localCanvasInvalid=!0,this.lastLocalTransform=n)}else this.lastLocalTransform=null}render(e,n,o,s,r){o||(n=en.None),(!this.canSkipLocal||n!==en.None)&&(r=!1);const i=this.getLocalSize(),l=this.preparedTransform.translate(-this.width/2,-this.height/2);if(this.localCanvas&&(this.localCanvas.width!==i.x||this.localCanvas.height!==i.y)&&(this.localCanvasInvalid=!0),this.localCanvasInvalid&&!r){this.localCanvas||(this.localCanvas=Un()),this.localCanvas.width=i.x,this.localCanvas.height=i.y;const u=this.localCanvas.getContext("2d");if(!u)throw new Error("No canvas context received. Possibly out of memory?");this.transformIsLocal&&u.setTransform(l),this.renderLocal(u,s),this.localCanvasInvalid=!1,u.resetTransform()}const a=l0[n];yn(e,()=>{a!=null&&(e.shadowColor=a,e.shadowBlur=20),(!this.transformIsLocal||r)&&e.setTransform(l),e.globalCompositeOperation=this.obj.composite??"source-over",sk(e,this.obj.filters),r?this.renderLocal(e,s):this.localCanvas&&this.localCanvas.height!==0&&this.localCanvas.width!==0&&e.drawImage(this.localCanvas,0,0)})}dispose(){}hitTest(e){const n=e.matrixTransform(this.preparedTransform.translate(-this.width/2,-this.height/2).inverse()),o=this.getLocalSize();if(n.x<0||n.y<0||n.x>o.x||n.y>o.y)return console.log("Hitbox text",n),!1;if(this.hitDetectionFallback||!this.localCanvas||this.localCanvasInvalid)return!0;try{const s=this.transformIsLocal?e:n;return this.lastHit=s,this.localCanvas.getContext("2d",{willReadFrequently:!0}).getImageData(s.x|0,s.y|0,1,1).data[3]!==0}catch(s){throw this.hitDetectionFallback=!0,s}}}class Lr extends Sh{get canSkipLocal(){return this.obj.composite==="source-over"&&this.obj.filters.length===0}get transformIsLocal(){const e=this.preparedTransform;return this.obj.overflow?!0:ge.supports.limitedCanvasSpace?!1:!(e.a===1&&e.b===0&&e.c===0&&e.d===1)}}class Ja{constructor(e){B(this,"nextArrow",null);this.base=e}static get defaultWidth(){return Po}static get defaultHeight(){return jr+Vn}static get defaultX(){return de().Base.screenWidth/2}static get defaultY(){return de().Base.screenHeight-this.defaultHeight/2-de().TextBox.TextBoxBottomSpacing}get allowSkippingLocal(){return!0}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return Na}getControlsDisabledStyle(){return Np}get textboxStyle(){return Fa}renderControls(e,n){const s=this.width/2,r=this.getControlsStyle();ns(e,r),e.fillText("History",s+Aa,n),ns(e,this.base.obj.skip?r:this.getControlsDisabledStyle()),e.fillText("Skip",s+Ma,n),ns(e,r),e.fillText("Auto   Save   Load   Settings",s+Ba,n)}prepare(){if(!(this.nextArrow instanceof Fn))return(async()=>{this.nextArrow=await ps("next")})()}}class no extends Ja{constructor(){super(...arguments);B(this,"backgroundImage","textbox");B(this,"xOffset",0);B(this,"nameBoxAsset",null);B(this,"backdropAsset",null)}static get resizable(){return!1}get height(){return jr+Vn}get width(){return Po}get nameboxWidth(){return Cs}get nameboxHeight(){return Vn}get nameboxOffsetX(){return xs}get nameboxOffsetY(){return Rr}get nameboxStyle(){return Ar}get textOffsetX(){return ks}get textOffsetY(){return $r}renderNamebox(n,o,s){var r;(r=this.nameBoxAsset)==null||r.paintOnto(n,{x:o,y:s})}renderBackdrop(n,o,s){var r;o+=this.xOffset,(r=this.backdropAsset)==null||r.paintOnto(n,{x:o,y:s})}render(n){var l;const o=this.width,s=this.height;this.renderBackdrop(n,0,0+this.nameboxHeight),this.obj.talkingObjId!==null&&this.renderNamebox(n,0+this.nameboxOffsetX,0);const r=s,i=r-Ra;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&((l=this.nextArrow)==null||l.paintOnto(n,{x:o-Ea,y:r-Da}))}prepare(){const n=super.prepare();if(!(!n&&this.backdropAsset&&this.nameBoxAsset))return Promise.all([n,this.backdropAsset instanceof Fn?void 0:(async()=>{this.backdropAsset=await ps(this.backgroundImage)})(),this.nameBoxAsset instanceof Fn?void 0:(async()=>{this.nameBoxAsset=await ps("namebox")})()])}}B(no,"id","normal"),B(no,"label","Normal"),B(no,"priority",0),B(no,"gameMode","ddlc");class zo extends no{constructor(){super(...arguments);B(this,"backgroundImage","textbox_monika");B(this,"xOffset",(Po-$a)/2)}}B(zo,"id","corrupt"),B(zo,"label","Corrupted"),B(zo,"priority",1),B(zo,"gameMode","ddlc");class oo extends Ja{constructor(){super(...arguments);B(this,"_dotPattern",null);B(this,"_lastColor",null);B(this,"backgroundImage","textbox");B(this,"xOffset",0)}static get resizable(){return!0}get allowSkippingLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth??Cs}get nameboxHeight(){return Vn}get nameboxOffsetX(){return xs}get nameboxOffsetY(){return Rr}get nameboxStyle(){return{...Ar,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return ks}get textOffsetY(){return $r}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const n=this.refObject;return n!=null&&n.textboxColor!=null?n.textboxColor:Tp}get nameboxOutlineColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(jp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift($p).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(n,o,s){yn(n,()=>{const r=this.nameboxWidth,i=this.nameboxHeight;n.beginPath(),xh(n,o,s,r,i,Mp),n.clip();const l=n.createLinearGradient(o,s,o,s+i),a=De.fromCss(this.nameboxBackgroundColor),u=new De(a.r,a.g,a.b,.95),c=u.toHSL().shift(Ap).toRgb();l.addColorStop(0,u.toCss()),l.addColorStop(Rp,u.toCss()),l.addColorStop(1,c.toCss()),n.fillStyle=l,n.fillRect(o,s,this.obj.width,i)})}renderBackdrop(n,o){const s=De.fromCss(this.customColor),r=s.toHSL(),i=this.obj.height-o,l=this.obj.width,a=()=>Ch(n,Qn/2,o+Qn/2,l-Qn,i-Qn,Bp);yn(n,()=>{n.beginPath(),a(),n.clip();const c=n.createLinearGradient(0,o,0,i);c.addColorStop(0,s.toCss()),c.addColorStop(1,`rgba(${s.r},${s.g},${s.b},0.6667)`),n.fillStyle=c,n.strokeStyle="#ffdfee",n.lineWidth=6,n.fillRect(0,o,l,i),yn(n,()=>{n.translate(0,o),n.fillStyle=this.getDotPattern(),n.globalCompositeOperation="source-atop",n.fillRect(0,0,l,i)});const d=n.createLinearGradient(0,o+i-Hl,0,o+i);d.addColorStop(0,"rgba(255,255,255,0.3137)"),d.addColorStop(.5,"rgba(255,255,255,0.0627)"),d.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=d,n.beginPath(),n.ellipse(l/2,o+i,Lp,Hl,0,0,2*Math.PI),n.closePath(),n.fill()});const u=r.shift(Ep).toRgb().toCss();n.strokeStyle=u,n.lineWidth=Qn,n.beginPath(),a(),n.stroke()}render(n){const o=this.obj.height,s=this.obj.width;this.obj.talkingObjId!==null&&this.renderNamebox(n,this.nameboxOffsetX,0),this.renderBackdrop(n,this.nameboxHeight);const r=o,i=r-Ra;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&this.nextArrow&&this.nextArrow.paintOnto(n,{x:s-Ea,y:r-Da})}getDotPattern(n=Dp){if(this._dotPattern&&this._lastColor===this.customColor)return this._dotPattern;this._lastColor=this.customColor;const{dotPatternSize:o,dotColorDelta:s,dotRadius:r}=n,i=De.fromCss(this.customColor).toHSL(),l=Un();l.height=o,l.width=o;const a=l.getContext("2d");if(!a)throw new Error("Failed to create canvas for textbox dot-pattern. Out of memory?");a.fillStyle=i.shift(s).toRgb().toCss();function u(d,g){a.beginPath(),a.ellipse(d,g,r,r,0,0,2*Math.PI),a.closePath(),a.fill()}u(0,0),u(o,0),u(0,o),u(o,o),u(o/2,o/2);const c=a.createPattern(l,"repeat");if(!c)throw new Error("Failed to create textbox dot-pattern. Out of memory?");return this._dotPattern=c,c}}B(oo,"id","custom"),B(oo,"label","Custom"),B(oo,"priority",0),B(oo,"gameMode","ddlc");const hr=class hr{constructor(e){B(this,"nextArrow",null);this.base=e}static get resizable(){return!1}static get defaultWidth(){return Ua}static get defaultHeight(){return nh+qa}static get defaultX(){return de().Base.screenWidth/2}static get defaultY(){return de().Base.screenHeight-this.defaultHeight/2-de().TextBox.TextBoxBottomSpacing}get allowSkippingLocal(){return!0}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return ir}getControlsDisabledStyle(){return ph}renderControls(e,n){const o=this.width,s=o/2,i=s-s,l=this.getControlsStyle(),a=["History","Skip","Auto","Save","Load","Settings"],u=[];let c=0;for(const b of a){const _=hr.controlWidth(e,b);u.push(_),c+=_}const d=Math.min((o-c)/(a.length+2),78);let g=i+(o-c-d*(a.length-1))/2;for(let b=0;b<a.length;++b){const _=a[b],w=u[b],P=_==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():l;ns(e,P),e.fillText(_,g,n),g+=w+d}}static controlWidth(e,n){if(this.widthCache[n])return this.widthCache[n];ns(e,ir);const o=e.measureText(n).width;return this.widthCache[n]=o,o}prepare(){if(!(this.nextArrow instanceof Fn))return(async()=>{this.nextArrow=await ps("next_plus")})()}};B(hr,"widthCache",{});let Xl=hr;class Go extends Xl{constructor(){super(...arguments);B(this,"_lastColor",null);B(this,"_dotPattern",null);B(this,"backgroundImage","textbox");B(this,"xOffset",0)}static get resizable(){return!0}get allowSkippingLocal(){return!1}get height(){return this.obj.height}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:za}get nameboxHeight(){return qa}get nameboxOffsetX(){return Ga}get nameboxOffsetY(){return sh}get nameboxStyle(){return{...fh,strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"}}get textOffsetX(){return Wa}get textOffsetY(){return oh}get textboxStyle(){return hh}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const n=this.refObject;return n!=null&&n.textboxColor!=null?n.textboxColor:zp}get nameboxOutlineColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(Gp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?De.fromCss(this.customColor).toHSL().shift(Xp).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(n,o,s){yn(n,()=>{const r=this.nameboxWidth,i=this.nameboxHeight;n.beginPath(),xh(n,o,s,r,i,Jp),n.clip();const l=n.createLinearGradient(o,s,o,s+i),a=De.fromCss(this.nameboxBackgroundColor),u=new De(a.r,a.g,a.b,.95),c=u.toHSL().shift(Kp).toRgb();l.addColorStop(0,u.toCss()),l.addColorStop(Yp,u.toCss()),l.addColorStop(1,c.toCss()),n.fillStyle=l,n.fillRect(o,s,this.obj.width,i)})}renderBackdrop(n,o){const s=this.obj.height-o,r=this.obj.width,i=De.fromCss(this.customColor).toHSL(),l=()=>Ch(n,eo/2,o+eo/2,r-eo,s-eo,Zp);yn(n,()=>{n.beginPath(),l(),n.clip();const u=n.createLinearGradient(0,o,0,o+s),c=De.fromHex(this.customColor);u.addColorStop(0,c.toCss()),u.addColorStop(1,`rgba(${c.r},${c.g},${c.b},0.6667)`),n.fillStyle=u,n.strokeStyle="#ffdfee",n.lineWidth=6,n.fillRect(0,o,r,s),n.strokeRect(0,o,r,s),n.fillStyle=this.getDotPattern(),n.globalCompositeOperation="source-atop",n.fillRect(0,o,r,s);const d=n.createLinearGradient(0,o+s-Vl,0,o+s);d.addColorStop(0,"rgba(255,255,255,0.3137)"),d.addColorStop(.5,"rgba(255,255,255,0.0627)"),d.addColorStop(1,"rgba(255,255,255,0)"),n.fillStyle=d,n.beginPath(),n.ellipse(r/2,o+s,dh,Vl,0,0,2*Math.PI),n.closePath(),n.fill()});const a=i.shift(Qp).toRgb().toCss();n.strokeStyle=a,n.lineWidth=eo,n.beginPath(),l(),n.stroke()}render(n){const o=this.obj.height,s=this.obj.width;this.obj.talkingObjId!==null&&this.renderNamebox(n,this.nameboxOffsetX,0),this.renderBackdrop(n,this.nameboxHeight);const r=o,i=r-rh;this.obj.controls&&this.renderControls(n,i),this.obj.continue&&this.nextArrow&&this.nextArrow.paintOnto(n,{x:s-uh,y:r-ch})}getDotPattern(){return oo.prototype.getDotPattern.call(this,eh)}}B(Go,"id","custom_plus"),B(Go,"label","Custom (Plus)"),B(Go,"priority",0),B(Go,"gameMode","ddlc_plus");class Xo extends Ja{static get resizable(){return!0}get height(){return jr+Vn}get width(){return Po}get nameboxWidth(){return Cs}get nameboxHeight(){return Vn}get nameboxOffsetX(){return xs}get nameboxOffsetY(){return Rr}get nameboxStyle(){return Ar}get textOffsetX(){return ks}get textOffsetY(){return $r}get textboxStyle(){return Fa}async render(){}}B(Xo,"id","none"),B(Xo,"label","None"),B(Xo,"priority",0),B(Xo,"gameMode","ddlc");const rk=[no,zo,oo,Xo,Go],os=(()=>{const t={};for(const e of rk)t[e.id]=e;return t})();class ik extends Lr{constructor(){super(...arguments);B(this,"nbTextRenderer",null);B(this,"textRenderer",null);B(this,"_lastRefVars",null);B(this,"refObject",null);B(this,"_lastRenderer",null)}getRefVars(){const n=this.refObject;return n?JSON.stringify([n.label,n.textboxColor,n.nameboxWidth]):null}getName(){var n;return this.obj.talkingObjId==="$other$"?this.obj.talkingOther:((n=this.refObject)==null?void 0:n.label)??"Missing name"}get canSkipLocal(){var n;return super.canSkipLocal&&(((n=this._lastRenderer)==null?void 0:n.allowSkippingLocal)??!0)}prepareData(n,o){super.prepareData(n,o),typeof this.obj.talkingObjId=="number"&&(this.refObject=n.objects[this.obj.talkingObjId]??null)}prepareRender(n){const o=super.prepareRender(n),s=this.textboxRenderer.prepare(),r=this.getRefVars();r!==this._lastRefVars&&(this.localCanvasInvalid=!0,this._lastRefVars=r),this.nbTextRenderer=new jt(this.getName(),this.textboxRenderer.nameboxStyle),this.textRenderer=new jt(this.obj.text,this.textboxRenderer.textboxStyle);const i=this.nbTextRenderer.loadFonts(),l=this.textRenderer.loadFonts();if(!(!o&&!s&&!i&&!l))return Promise.all([o,s,i,l])}renderLocal(n){const o=this.textboxRenderer,s=o.width;if(!this.obj.overflow){const r=new Path2D;r.rect(0,0,o.width,this.height),n.clip(r)}o.render(n),this.obj.talkingObjId!==null&&this.renderName(n),this.renderText(n,0,0,s)}renderName(n){const o=this.textboxRenderer,s=o.nameboxWidth,r=o.nameboxOffsetX,i=o.nameboxOffsetX/2;console.log("rendering name",n.getTransform()),this.nbTextRenderer.applyLayout("center",r+i,o.nameboxOffsetY,s-i*2,!1),this.nbTextRenderer.render(n)}renderText(n,o,s,r){const i=this.textboxRenderer,l=this.textRenderer;this.obj.autoQuoting&&this.obj.talkingObjId!==null&&l.quote(),l.applyLayout("left",o+i.textOffsetX,s+i.nameboxHeight+i.textOffsetY,r-i.textOffsetX*2,this.obj.autoWrap),l.render(n)}get forcedStyle(){const n=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&n&&(n.textboxColor!=null||n.nameboxWidth!=null)?"custom":this.obj.style}get textboxRenderer(){const n=this.forcedStyle,o=os[n];if(this._lastRenderer&&this._lastRenderer.constructor===o)return this._lastRenderer;const s=new o(this);return this._lastRenderer=s,s}}const Ad=4,lk={setTalkingObject(t,e){const n=t.panels[e.panelId].objects[e.id];n.talkingObjId=e.talkingObjId,++n.version},setTalkingOther(t,e){const n=t.panels[e.panelId].objects[e.id];n.talkingOther=e.talkingOther,n.talkingObjId="$other$",++n.version},setResetBounds(t,e){const n=t.panels[e.panelId].objects[e.id];n.resetBounds=e.resetBounds,n.x=e.resetBounds.x,n.y=e.resetBounds.y,n.height=e.resetBounds.height,n.width=e.resetBounds.width,n.rotation=e.resetBounds.rotation,n.skewX=e.resetBounds.skewX,n.skewY=e.resetBounds.skewY,n.scaleX=e.resetBounds.scaleX,n.scaleY=e.resetBounds.scaleY,++n.version},setTextBoxProperty(t,e){const n=t.panels[e.panelId].objects[e.id];n[e.key]=e.value,++n.version}},ak={createTextBox({commit:t,state:e,rootState:n},o){const s=de(),r=e.panels[o.panelId].lastObjId+1,i=s.TextBox.DefaultTextboxStyle,l=os[i],a=o.resetBounds||{x:l.defaultX,y:l.defaultY,width:l.defaultWidth,height:l.defaultHeight,rotation:0,scaleX:1,scaleY:1,skewX:0,skewY:0};return t("create",{object:{...To(),...a,panelId:o.panelId,id:r,onTop:!0,type:"textBox",continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:i,overrideColor:!1,customColor:s.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:s.TextBoxCustom.controlsDefaultColor,customNameboxColor:s.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:s.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:o.text??"Click here to edit the textbox",resetBounds:a,overflow:!1}}),r},setStyle({state:t,commit:e},n){const o=de(),s=t.panels[n.panelId].objects[n.id],r=os[s.style],i=os[n.style],l=10;let a=!1;const u={panelId:n.panelId,id:n.id,x:s.x,y:s.y};let c=!1;const d={panelId:n.panelId,id:n.id,width:s.width,height:s.height};i.resizable?(r.defaultWidth!==i.defaultWidth&&(c=!0,d.width=Math.max(d.width+i.defaultWidth-r.defaultWidth,l)),r.defaultHeight!==i.defaultHeight&&(c=!0,d.height=Math.max(d.height+i.defaultHeight-r.defaultHeight,l))):(c=!0,d.width=i.defaultWidth,d.height=i.defaultHeight),r.defaultX!==i.defaultX&&(a=!0,u.x=cr(-d.width+l,u.x+i.defaultX-r.defaultX,o.Base.screenWidth-l)),r.defaultY!==i.defaultY&&(a=!0,u.y=cr(-d.height+l,u.y+i.defaultY-r.defaultY,o.Base.screenHeight-l)),a&&e("setPosition",u),c&&e("setSize",d),e("setTextBoxProperty",_h(n.panelId,n.id,"style",n.style))},resetTextboxBounds({commit:t,state:e},n){const o=e.panels[n.panelId].objects[n.id];t("setPosition",{panelId:n.panelId,id:n.id,x:o.resetBounds.x,y:o.resetBounds.y}),t("setSize",{panelId:n.panelId,id:n.id,height:o.resetBounds.height,width:o.resetBounds.width}),t("setRotation",{panelId:n.panelId,id:n.id,rotation:o.resetBounds.rotation}),t("setObjectScale",{panelId:n.panelId,id:n.id,scaleX:o.resetBounds.scaleX,scaleY:o.resetBounds.scaleY}),t("setObjectSkew",{panelId:n.panelId,id:n.id,skewX:o.resetBounds.skewX,skewY:o.resetBounds.skewY})},async splitTextbox({commit:t,state:e,dispatch:n},o){const s=e.panels[o.panelId].objects[o.id];if(s.type!=="textBox")return;const r=(s.width-Ad)/2,i=r/2+Ad/2;let l=new DOMMatrixReadOnly().translate(s.x,s.y);s.rotation!==0&&(l=l.rotate(0,0,s.rotation)),s.skewX!==0&&(l=l.skewX(s.skewX)),s.skewY!==0&&(l=l.skewY(s.skewY)),s.flip&&(l=l.flipX()),l=l.scale(s.scaleX,s.scaleY);const a=l.transformPoint(new DOMPointReadOnly(-i,0)),u=l.transformPoint(new DOMPointReadOnly(i,0));t("setResetBounds",{id:o.id,panelId:o.panelId,resetBounds:{x:a.x,y:a.y,width:r,height:s.height,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY}});const c=s.style==="custom_plus"?"custom_plus":"custom";s.style!==c&&await n("setStyle",{...o,style:c});const d=await n("createTextBox",{panelId:o.panelId,resetBounds:{x:u.x,y:u.y,width:r,height:s.height,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY}});await n("setStyle",{panelId:o.panelId,id:d,style:c}),s.flip&&t("setFlip",{id:d,panelId:o.panelId,flip:s.flip}),t("setLink",{id:d,panelId:o.panelId,link:s.linkedTo,rotation:s.rotation,scaleX:s.scaleX,scaleY:s.scaleY,skewX:s.skewX,skewY:s.skewY,x:u.x,y:u.y})}};function _h(t,e,n,o){return{id:e,panelId:t,key:n,value:o}}const Md=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function Yl(t,e,n){const s=[...e().filters];let r;switch(t.type){case"hue-rotate":r={type:t.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":r={type:t.type,value:1};break;case"drop-shadow":r={type:t.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new Mt.UnreachableCaseError(t.type)}s.splice(t.idx,0,r),n({panelId:t.panelId,id:t.id,filters:s})}function Kl(t,e,n){const s=[...e().filters];s.splice(t.idx,1),n({id:t.id,panelId:t.panelId,filters:s})}function Jl(t,e,n){const s=[...e().filters],r=s[t.idx];s.splice(t.idx,1),s.splice(t.idx+t.moveBy,0,r),n({id:t.id,panelId:t.panelId,filters:s})}function Zl(t,e,n){const s=[...e().filters],r={...s[t.idx]};s[t.idx]=r,r.type==="drop-shadow"?(t.blurRadius!==void 0&&(r.blurRadius=t.blurRadius),t.color!==void 0&&(r.color=t.color),t.offsetX!==void 0&&(r.offsetX=t.offsetX),t.offsetY!==void 0&&(r.offsetY=t.offsetY)):r.value=t.value,n({id:t.id,panelId:t.panelId,filters:s})}const uk={create(t,{object:e}){const n=t.panels[e.panelId];e.id>n.lastObjId&&(n.lastObjId=e.id),n.objects[e.id]=e,(e.onTop?n.onTopOrder:n.order).push(e.id)},removeFromList(t,e){const n=t.panels[e.panelId],o=e.onTop?n.onTopOrder:n.order,s=o.indexOf(e.id);o.splice(s,1)},addToList(t,e){const n=t.panels[e.panelId];(e.onTop?n.onTopOrder:n.order).splice(e.position,0,e.id)},setOnTop(t,e){const o=t.panels[e.panelId].objects[e.id];o.onTop=e.onTop},setPosition(t,e){const o=t.panels[e.panelId].objects[e.id];o.x=Kt(e.x),o.y=Kt(e.y)},setLink(t,e){const n=t.panels[e.panelId],o=n.objects[e.id];let s=n.objects[e.link];if(!s&&e.link)throw new Error("Linked object does not exist.");if(s===o)throw new Error("Object cannot link to itself.");for(;s;)if(s=n.objects[s.linkedTo],s===o)throw new Error("Objects cannot be linked recursively.");o.linkedTo=e.link,o.x=Kt(e.x),o.y=Kt(e.y),o.rotation=Kt(e.rotation),o.scaleX=Kt(e.scaleX),o.scaleY=Kt(e.scaleY),o.skewX=Kt(e.skewX),o.skewY=Kt(e.skewY)},setFlip(t,e){const o=t.panels[e.panelId].objects[e.id];o.flip=e.flip},setSize(t,e){const o=t.panels[e.panelId].objects[e.id];o.width=Math.round(e.width*100)/100,o.height=Math.round(e.height*100)/100,++o.version},setRatio(t,e){const o=t.panels[e.panelId].objects[e.id];o.preserveRatio=e.preserveRatio,o.ratio=e.ratio},setRotation(t,e){const o=t.panels[e.panelId].objects[e.id];o.rotation=e.rotation<0?360-Math.abs(e.rotation)%360:e.rotation%360},removeObject(t,e){const n=t.panels[e.panelId];delete n.objects[e.id]},setComposition(t,e){const o=t.panels[e.panelId].objects[e.id];o.composite=e.composite},object_setFilters(t,e){const o=t.panels[e.panelId].objects[e.id];o.filters=e.filters},setLabel(t,e){const o=t.panels[e.panelId].objects[e.id];o.label=e.label,++o.version},setTextboxColor(t,e){const o=t.panels[e.panelId].objects[e.id];o.textboxColor=e.textboxColor,++o.version},setEnlargeWhenTalking(t,e){const o=t.panels[e.panelId].objects[e.id];o.enlargeWhenTalking=e.enlargeWhenTalking,++o.version},setObjectNameboxWidth(t,e){const o=t.panels[e.panelId].objects[e.id];o.nameboxWidth=e.nameboxWidth,++o.version},setObjectScale(t,e){const o=t.panels[e.panelId].objects[e.id];o.scaleX=e.scaleX,o.scaleY=e.scaleY,++o.version},setObjectSkew(t,e){const o=t.panels[e.panelId].objects[e.id];o.skewX=e.skewX<0?180-Math.abs(e.skewX)%180:e.skewX%180,o.skewY=e.skewY<0?180-Math.abs(e.skewY)%180:e.skewY%180,++o.version},setOverflow(t,e){const o=t.panels[e.panelId].objects[e.id];"overflow"in o&&(o.overflow=e.overflow,++o.version)},...Q1,...c0,...lk,...G1,...Y1,...J1},ck={removeObject({state:t,commit:e,rootState:n},o){var l;const s=t.panels[o.panelId],r=s.objects[o.id],i=hs();for(const a of Object.values(i.viewports))a.selection===o.id&&(a.selection=null);for(const a of[...s.onTopOrder,...s.order]){if(r.id===a)continue;const u=s.objects[a];if(u.linkedTo===r.id){let c=null;for(const d of Object.values(i.viewports))if(c=((l=wo(null,d))==null?void 0:l.getLastRenderObject(u.id))??null,c)break;c?e("setLink",{panelId:o.panelId,id:u.id,link:null,...dr(c.preparedTransform)}):e("setLink",{panelId:o.panelId,id:u.id,link:null,rotation:u.rotation,scaleX:u.scaleX,scaleY:u.scaleY,skewX:u.skewX,skewY:u.skewY,x:u.x,y:u.y})}u.type==="textBox"&&u.talkingObjId===r.id&&e("setTalkingOther",{id:u.id,talkingOther:r.label??"",panelId:o.panelId})}e("removeFromList",{id:o.id,panelId:o.panelId,onTop:r.onTop}),e("removeObject",{id:o.id,panelId:o.panelId})},setPosition({state:t,commit:e,dispatch:n},o){t.panels[o.panelId].objects[o.id].type==="character"?n("setCharacterPosition",o):e("setPosition",o)},setOnTop({state:t,commit:e},n){const o=t.panels[n.panelId],s=o.objects[n.id];s.onTop!==n.onTop&&(e("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),e("addToList",{id:n.id,panelId:n.panelId,position:(n.onTop?o.onTopOrder:o.order).length,onTop:n.onTop}),e("setOnTop",{panelId:n.panelId,id:n.id,onTop:n.onTop}))},shiftLayer({state:t,commit:e},n){const o=t.panels[n.panelId],s=o.objects[n.id],r=s.onTop?o.onTopOrder:o.order;let l=r.indexOf(s.id)+n.delta;l<0&&(l=0),l>r.length&&(l=r.length),e("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),e("addToList",{panelId:n.panelId,id:n.id,position:l,onTop:s.onTop})},setPreserveRatio({commit:t,state:e},n){const s=e.panels[n.panelId].objects[n.id],r=n.preserveRatio?s.width/s.height:0;t("setRatio",{panelId:n.panelId,id:n.id,preserveRatio:n.preserveRatio,ratio:r})},copyObjects({commit:t,state:e},{sourcePanelId:n,targetPanelId:o}){const s=e.panels[n],r=e.panels[o],i=[...s.onTopOrder,...s.order],l=new Map;let a=r.lastObjId;for(const u of i){const c=++a;l.set(u,c)}for(const u of i){const c=s.objects[u],d=JSON.parse(JSON.stringify(c));if("talkingObjId"in d){const g=d;g.talkingObjId!==null&&g.talkingObjId!=="$other$"&&l.has(g.talkingObjId)&&(g.talkingObjId=l.get(g.talkingObjId))}t("create",{object:{...d,id:l.get(u),panelId:o}})}},copyObjectToClipboard({commit:t,state:e},{id:n,panelId:o}){const s=e.panels[o],r=s.objects[n],i=Object.values(s.objects),l=[r];a(r);function a(u,c=!0){if(!c&&u===r)throw new Error("Recursively linked object");for(const d of i)d.linkedTo===u.id&&(l.push(d),a(d,!1))}t("ui/setClipboard",JSON.stringify(l),{root:!0})},pasteObjectFromClipboard({commit:t,state:e,rootState:n},{panelId:o}){if(n.ui.clipboard==null)return;const s=JSON.parse(n.ui.clipboard),r=e.panels[o],i=new Map;let l=r.lastObjId;for(const a of s){const u=++l;i.set(a.id,u),a.id=u}for(const a of s)a.linkedTo!=null&&(a.linkedTo=i.get(a.linkedTo)??null),t("create",{object:{...a,panelId:o}})},object_addFilter({state:t,commit:e},n){Yl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_removeFilter({state:t,commit:e},n){Kl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_moveFilter({state:t,commit:e},n){Jl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},object_setFilter({state:t,commit:e},n){Zl(n,()=>t.panels[n.panelId].objects[n.id],o=>e("object_setFilters",o))},...ek,...f0,...ak,...X1,...K1,...Z1};function dk(t,e){const n=t.state.panels;for(const o in n){const s=n[o];for(const r in s.objects){const i=s.objects[r];i.type==="character"&&p0(t,i.panelId,i.id,e)}}}function Kt(t){return Math.round(t*100)/100}var Ls=(t=>(t[t.None=0]="None",t[t.Stretch=1]="Stretch",t[t.Cover=2]="Cover",t))(Ls||{});const fk="buildin.transparent",$s={panelToUrl:new Map,urlToPanel:new Map,register(t,e){if(this.panelToUrl.has(t)){if(this.panelToUrl.get(t)===e)return;this.unregister(t,this.panelToUrl.get(t))}this.panelToUrl.set(t,e),this.urlToPanel.has(e)?this.urlToPanel.get(e).push(t):this.urlToPanel.set(e,[t])},unregister(t,e){if(this.urlToPanel.has(e)){const n=this.urlToPanel.get(e);n.splice(n.indexOf(t),1),n.length===0&&(this.urlToPanel.delete(e),URL.revokeObjectURL(e))}this.panelToUrl.delete(t)}},pk={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[]},mutations:{setPanelPreview(t,{panelId:e,url:n}){t.panels[e].lastRender=n,$s.register(e,n)},createPanel(t,{panel:e}){t.lastPanelId=e.id,t.panels[e.id]=e},setPanelOrder(t,{panelOrder:e}){t.panelOrder=[...e]},setCurrentBackground(t,{current:e,panelId:n}){const o=t.panels[n];o.background.current=e,o.background.variant=0},setBackgroundColor(t,{color:e,panelId:n}){const o=t.panels[n];o.background.color=e},setBackgroundFlipped(t,{flipped:e,panelId:n}){const o=t.panels[n];o.background.flipped=e},setBackgroundVariant(t,{variant:e,panelId:n}){const o=t.panels[n];o.background.variant=e},setBackgroundScaling(t,{scaling:e,panelId:n}){const o=t.panels[n];o.background.scaling=e},deletePanel(t,{panelId:e}){$s.unregister(e,$s.panelToUrl.get(e)),delete t.panels[e]},setComposition(t,e){const n=t.panels[e.panelId];n.composite=e.composite},setFilters(t,e){const n=t.panels[e.panelId];n.filters=e.filters},backgroundSetComposition(t,e){const n=t.panels[e.panelId];n.background.composite=e.composite},backgroundSetFilters(t,e){const n=t.panels[e.panelId];n.background.filters=e.filters},...uk},actions:{createPanel({state:t,commit:e}){const n=t.lastPanelId+1;return e("createPanel",{panel:{id:n,background:{color:"#000000",current:fk,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),e("setPanelOrder",{panelOrder:[...t.panelOrder,n]}),hs(),n},duplicatePanel({state:t,commit:e},{panelId:n}){const o=t.panels[n],s=t.lastPanelId+1;$s.register(s,o.lastRender);const r=JSON.parse(JSON.stringify(o));let i=-1;const l=new Map,a={};for(const c in r.objects)l.set(+c,++i);for(const c in r.objects){const d=r.objects[c],g=l.get(+c);if(a[g]=d,d.panelId=s,d.id=g,"talkingObjId"in d){const b=d;b.talkingObjId!==null&&b.talkingObjId!=="$other$"&&l.has(b.talkingObjId)&&(b.talkingObjId=l.get(b.talkingObjId))}d.linkedTo!=null&&(d.linkedTo=l.get(d.linkedTo))}e("createPanel",{panel:{...r,id:s,lastObjId:i,objects:a,order:r.order.map(c=>l.get(c)),onTopOrder:r.onTopOrder.map(c=>l.get(c))}});const u=t.panelOrder.indexOf(n);e("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,u+1),s,...t.panelOrder.slice(u+1)]})},seekBackgroundVariant({state:t,rootGetters:e,commit:n},{delta:o,panelId:s}){const r=t.panels[s],l=e["content/getBackgrounds"].get(r.background.current);l&&n("setBackgroundVariant",{panelId:s,variant:qo(l.variants,r.background.variant,o)})},delete({state:t,commit:e},{panelId:n}){if(t.panelOrder.length<=1)return;const o=t.panelOrder.indexOf(n);let s;o===t.panelOrder.length-1?s=o-1:s=o+1;const r=hs();for(const i of Object.values(r.viewports))i.currentPanel===n&&(i.currentPanel=t.panelOrder[s]);e("setPanelOrder",{panelOrder:[...t.panelOrder.slice(0,o),...t.panelOrder.slice(o+1)]}),e("deletePanel",{panelId:n})},fixContentPackRemoval(t,e){const{state:n,rootGetters:o,commit:s,rootState:r}=t;for(const i of Object.values(n.panels)){const l=e.backgrounds.find(d=>d.id===i.background.current);if(!l)return;const a=o["content/getBackgrounds"].get(i.background.current);if(!a){r.content.current.backgrounds.length>0?s("setCurrentBackground",{current:r.content.current.backgrounds[0].id,panelId:i.id}):s("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const u=JSON.stringify(l.variants[i.background.variant]),c=a.variants.findIndex(d=>JSON.stringify(d)===u);c!==i.background.variant&&s("setBackgroundVariant",{variant:c===-1?0:c,panelId:i.id})}dk(t,e)},move({state:t,commit:e},{panelId:n,delta:o}){const s=[...t.panelOrder],r=s.indexOf(n);s.splice(r,1);const i=Math.max(r+o,0);s.splice(i,0,n),e("setPanelOrder",{panelOrder:s})},addFilter({state:t,commit:e},n){Yl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},removeFilter({state:t,commit:e},n){Kl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},moveFilter({state:t,commit:e},n){Jl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},setFilter({state:t,commit:e},n){Zl(n,()=>t.panels[n.panelId],o=>e("setFilters",o))},backgroundAddFilter({state:t,commit:e},n){Yl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundRemoveFilter({state:t,commit:e},n){Kl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundMoveFilter({state:t,commit:e},n){Jl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},backgroundSetFilter({state:t,commit:e},n){Zl(n,()=>t.panels[n.panelId].background,o=>e("backgroundSetFilters",o))},...ck}};class hk{constructor(e,n,o,s,r,i){this.id=e,this.assets=n,this.flip=o,this.scale=s,this.compositeMode=r,this.filters=i}async render(e){const{screenWidth:n,screenHeight:o}=de().Base,s=await Promise.all(this.assets.map(r=>Ia(r,e.hq)));for(const r of s){let i=0,l=0,a=r.width,u=r.height;const c=this.scale;switch(c){case Ls.None:i=n/2-a/2,l=o/2-u/2;break;case Ls.Stretch:a=n,u=o;break;case Ls.Cover:{const d=a/u,g=n/o;d>g?(u=o,a=u*d):(a=n,u=a/d),i=n/2-a/2,l=o/2-u/2;break}default:throw new Mt.UnreachableCaseError(c)}e.drawImage({image:r,x:i,y:l,w:a,h:u,flip:this.flip,composite:this.compositeMode,filters:this.filters})}}}const Bd={id:"buildin.static-color",name:"Static color",color:"#000000",render(t){const{screenWidth:e,screenHeight:n}=de().Base;return t.drawRect({x:0,y:0,w:e,h:n,fill:{style:this.color}}),Promise.resolve()}};class Ph extends Sh{constructor(){super(...arguments);B(this,"refTextbox",null);B(this,"lastUploadCount",0);B(this,"lastHq",!1);B(this,"missingAsset",!1);B(this,"_canSkipLocal",!1);B(this,"assetList",[])}get canSkipLocal(){return this._canSkipLocal}get transformIsLocal(){return!1}prepareData(n,o){if(super.prepareData(n,o),this.missingAsset){const s=Object.keys(o.state.uploadUrls).length;s!==this.lastUploadCount&&(this.lastHq=null),this.lastUploadCount=s}}prepareRender(n){super.prepareRender(n);let o=!1;if(this.isAssetListOutdated()&&(this.assetList=this.getAssetList(),o||(o=!!this.assetList.find(s=>!("loadedAssets"in s)||s.hasMissing))),!n!==this.lastHq)for(let s=0;s<this.assetList.length;++s){const r=this.assetList[s];"loadedAssets"in r&&!r.assets.every(i=>i.hq===i.lq)&&(this.assetList[s]={assets:r.assets,offset:r.offset,composite:r.composite},o=!0)}if(this.lastHq=!n,!!o)return this.localCanvasInvalid=!0,this._canSkipLocal=this.assetList.length<=1,this.loadAssets(!n)}getAssetsSize(){let n=0,o=0;for(const s of this.assetList)if("loadedAssets"in s)for(const r of s.loadedAssets)n=Math.max(n,s.offset[0]+r.width),o=Math.max(o,s.offset[1]+r.height);return new DOMPointReadOnly(n,o)}loadAssets(n){const o=[];this.missingAsset=!1;for(const s of this.assetList)"loadedAssets"in s&&!s.hasMissing||o.push((async r=>{const i=await Promise.all(r.assets.map(a=>Ia(a,n))),l=r;l.loadedAssets=i,l.hasMissing=i.some(a=>a instanceof fs),this.missingAsset||(this.missingAsset=l.hasMissing)})(s));if(o.length!==0)return Promise.all(o)}isAssetListOutdated(){return this.assetList.length===0}renderLocal(n){console.log("rerendering local");for(const o of this.assetList)if("loadedAssets"in o)for(const s of o.loadedAssets)this.canSkipLocal||(n.globalCompositeOperation=o.composite??"source-over"),s instanceof fs?s.paintOnto(n,{x:o.offset[0],y:o.offset[1],h:this.height,w:this.width}):s.paintOnto(n,{x:o.offset[0],y:o.offset[1]})}}class gk extends Ph{constructor(e,n){super(e),this.data=n}prepareData(e,n){super.prepareData(e,n),this.data=Br(n,this.obj)}prepareRender(e){return super.prepareRender(e)}isAssetListOutdated(){return!0}getAssetList(){const e=yo(this.data,this.obj),n=lr(this.data,this.obj),o=[],s=this.assetList??[];for(const r of e.renderCommands){let i=null;switch(r.type){case"head":{if(!n)continue;const l=n.variants[this.obj.posePositions.head||0];if(l==null)continue;i=l;break}case"image":i=r.images;break;case"pose-part":{const l=e.positions[r.part];if(!l||l.length===0)break;const a=l[this.obj.posePositions[r.part]||0];if(!a)break;i=a;break}}if(i){const l=s.find(a=>a.assets===i);l?o.push({...l,offset:r.offset,composite:r.composite}):o.push({assets:i,offset:r.offset,composite:r.composite})}}return o}}class vk extends Lr{constructor(){super(...arguments);B(this,"_height",0);B(this,"choiceRenderers",[])}get height(){const n=de().Choices;return this._height+n.ChoiceOuterPadding*2}get width(){const n=de().Choices;return this.obj.width+n.ChoiceOuterPadding*2}renderLocal(n){const o=de().Choices,s=this.obj.width,r=o.ChoiceOuterPadding;let i=o.ChoiceOuterPadding;for(const l of this.choiceRenderers){const a=l.getHeight(this.obj.autoWrap?s:0);n.strokeStyle=o.ChoiceButtonBorderColor,n.lineWidth=o.Outline,n.fillStyle=o.ChoiceButtonColor,n.fillRect(r,i,s,a+o.ChoicePadding*2),n.strokeRect(r,i,s,a+o.ChoicePadding*2),l.applyLayout("center",r+o.ChoicePadding,i+o.ChoiceSpacing*1.25,s-o.ChoicePadding*2,this.obj.autoWrap),l.render(n),i+=a+o.ChoicePadding*2+o.ChoiceSpacing}}prepareRender(n){const o=de();this.choiceRenderers=this.obj.choices.map(i=>new jt(i.text||" ",o.Choices.ChoiceTextStyle));const s=()=>(this._height=this.choiceRenderers.reduce((i,l)=>i+l.getHeight(this.obj.autoWrap?this.obj.width:0)+o.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1),super.prepareRender(n)),r=this.choiceRenderers.map(i=>i.loadFonts()).filter(i=>i!==void 0);if(r.length===0)s();else return Promise.all(r).then(s)}}class bk extends Lr{constructor(){super(...arguments);B(this,"_height",0);B(this,"_width",0);B(this,"_textRenderer",null);B(this,"_buttonRenderer",null)}get height(){const n=de().Choices;return this._height+n.ChoiceOuterPadding*2}get width(){const n=de().Choices;return this._width+n.ChoiceOuterPadding*2}prepareRender(n){const o=super.prepareRender(n),s=de().Notification,r=this._textRenderer=new jt(this.obj.text,s.NotificationTextStyle),i=this._buttonRenderer=new jt("OK",s.NotificationOkTextStyle),l=r.loadFonts(),a=i.loadFonts(),u=()=>{const c=this.obj.autoWrap?this.obj.width-s.NotificationPadding*2:0,d=this.obj.autoWrap?c:r.getWidth(),g=r.getHeight(c),b=this.obj.autoWrap?c:i.getWidth(),_=i.getHeight(c);this._width=Math.max(d,b)+s.NotificationPadding*2,this._height=g+s.NotificationPadding*2+s.NotificationSpacing+_};if(o||l||a)return Promise.all([o,l,a]).then(u);u()}render(n,o,s,r,i){return this.obj.backdrop&&yn(n,()=>{const l=de();n.resetTransform(),n.fillStyle=l.Notification.NotificationBackdropColor,n.fillRect(0,0,l.Base.screenWidth,l.Base.screenHeight)}),super.render(n,o,s,r,i)}renderLocal(n){const o=de(),s=this._textRenderer,r=this._buttonRenderer,i=this._width,l=this._height,a=o.Choices.ChoiceOuterPadding;n.fillStyle=o.Choices.ChoiceButtonColor,n.strokeStyle=o.Choices.ChoiceButtonBorderColor,n.lineWidth=o.Choices.Outline,n.fillRect(a,a,i,l),n.strokeRect(a,a,i,l),s.applyLayout("center",a+o.Notification.NotificationPadding,a+o.Notification.NotificationPadding*1.5,i-o.Notification.NotificationPadding*2,!1),s.render(n),r.applyLayout("center",a,a+l-o.Notification.NotificationPadding,i+a,!1),r.render(n)}}const mk=-2,yk=26,wk=10,kk=10;class Ck extends Lr{constructor(){super(...arguments);B(this,"_paperHeight",null);B(this,"_paperWidth",null);B(this,"_paper",null);B(this,"_lastPaperUrl",null)}get height(){return this._paperHeight??this.obj.height}get width(){return this._paperWidth??this.obj.width}prepareRender(n){const o=super.prepareRender(n),s=de().Poem,r=s.poemBackgrounds[this.obj.background],i=s.poemTextStyles[this.obj.font],a=new jt(this.obj.text,i).loadFonts();let u;if(r.file.startsWith("internal:")?(this._lastPaperUrl=null,this._paper=null,this._paperHeight=null,this._paperWidth=null):this._lastPaperUrl!==r.file&&(u=(async()=>{this._paper=await vo(`assets/poemBackgrounds/${r.file}`),this._lastPaperUrl=r.file,this._paperHeight=this._paper.height*s.backgroundScale,this._paperWidth=this._paper.width*s.backgroundScale})()),o||a||u)return Promise.all([o,a,u])}renderLocal(n){const o=de().Poem,s=o.poemBackgrounds[this.obj.background],r=this.width,i=this.height;let l=o.poemPadding,a=o.poemTopPadding,u=l*2;if(s.file==="internal:console")n.fillStyle=this.obj.consoleColor||o.consoleBackgroundColor,n.fillRect(0,0,r,i),l=mk,a=yk,u=wk;else if(this._paper&&(this._paper.paintOnto(n,{x:0,y:0,w:r,h:i}),!this.obj.overflow)){const g=new Path2D;g.rect(0,0,r,i),n.clip(g)}const c=o.poemTextStyles[this.obj.font],d=new jt(this.obj.text,c);d.applyLayout("left",kk+l,l+a,this.width-u,this.obj.autoWrap),d.render(n)}}class xk extends Ph{getAssetList(){return[{assets:this.obj.assets,offset:[0,0]}]}}const gr=class gr{constructor(e,n,o,s,r){B(this,"renderObjectCache",new Map);B(this,"renderer");B(this,"_disposed",!1);this.store=e,this._panelId=n,this.canvasWidth=o,this.canvasHeight=s,this.viewport=r,this.renderer=new vh(o,s)}get panelId(){return this._panelId}setPanelId(e){if(this._disposed)throw new Error("Disposed scene-renderer called");this._panelId!==e&&(this._panelId=e,this.renderObjectCache.forEach(n=>{n.dispose()}),this.renderObjectCache.clear())}render(e,n,o){if(this._disposed)throw new Error("Disposed scene-renderer called");return this.panel?this.renderer.render(this.renderCallback.bind(this,o),e,n):Promise.resolve(!1)}download(){if(this._disposed)throw new Error("Disposed scene-renderer called");const e=new Date,n=`panel-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this,!0),n)}paintOnto(e,n){this.renderer.paintOnto(e,n)}objectsAt(e,n){const o=new DOMPointReadOnly(e,n);return this.getRenderObjects().filter(s=>s.hitTest(o)).map(s=>s.id)}getLastRenderObject(e){return this.renderObjectCache.get(e)??null}async renderCallback(e,n){var g,b,_;if(this._disposed)throw new Error("Disposed scene-renderer called");n.fsCtx.imageSmoothingEnabled=!0,n.fsCtx.imageSmoothingQuality=n.hq?"high":"low",await((g=this.getBackgroundRenderer())==null?void 0:g.render(n));const o=this.getRenderObjects(),s=new Map,r=new Map;for(const w of o){w.prepareData(this.panel,this.store);const P=w.linkedTo;let y=new DOMMatrixReadOnly;if(P!=null){const h=r.get(P);if(h)y=h;else{const v=s.get(P);v?v.push(w):s.set(P,[w]);continue}}d(w,y)}s.size>0&&console.warn("Not all renderables processed. Infinite loop?");const i=o.map(w=>w.prepareRender(!n.hq)).filter(w=>w!==void 0);i.length>0&&await Promise.all(i);const l=((b=this.viewport)==null?void 0:b.selection)??null,a=new Set;l!==null&&c(l,a);const u=(_=document.querySelector(gr.FocusProp))==null?void 0:_.getAttribute("data-obj-id");for(const w of o){const P=l===w.id,y=u===""+w.id;w.render(n.fsCtx,(P?en.Selected:a.has(w.id)?en.Indirectly:en.None)+(y?en.Focused:en.None),n.preview,n.hq,e)}n.applyFilters([...this.panel.filters]),n.preview&&n.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:await ps("backgrounds/transparent")});function c(w,P){P.add(w);for(const y of o.filter(h=>h.linkedTo===w))c(y.id,P)}function d(w,P){const y=w.prepareTransform(P);r.set(w.id,y);const h=s.get(w.id);if(h){for(const v of h)d(v,y);s.delete(w.id)}}}getRenderObjects(){const e=this.store.state.panels.panels[this.panelId],n=[...e.order,...e.onTopOrder],o=e.objects,s=Array.from(this.renderObjectCache.keys()).filter(r=>!n.includes(r));for(const r of s)this.renderObjectCache.get(r).dispose(),this.renderObjectCache.delete(r);return n.map(r=>{let i=this.renderObjectCache.get(r);if(!i){const l=o[r],a=l.type;switch(a){case"sprite":i=new xk(l);break;case"character":{const u=l;i=new gk(u,Br(this.store,u));break}case"textBox":i=new ik(l);break;case"choice":i=new vk(l);break;case"notification":i=new bk(l);break;case"poem":i=new Ck(l);break;default:throw new Mt.UnreachableCaseError(a)}this.renderObjectCache.set(r,i)}return i})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const e=this.panel;switch(e.background.current){case"buildin.static-color":return Bd.color=e.background.color,Bd;default:{const o=this.store.getters["content/getBackgrounds"].get(e.background.current);if(!o)return null;const s=o.variants[e.background.variant];return new hk(e.background.current,s,e.background.flipped,e.background.scaling,e.background.composite,e.background.filters)}}}get disposed(){return this._disposed}dispose(){this._disposed=!0,this.renderer.dispose()}drawDebugZoom(e,n,o,s,r,i=7){const l=e.fsCtx.getImageData(n,o,s,r),a=document.createElement("canvas");a.width=s,a.height=r,a.getContext("2d").putImageData(l,0,0),e.fsCtx.imageSmoothingEnabled=!1,e.fsCtx.drawImage(a,0,0,s*i,r*i)}};B(gr,"FocusProp",typeof CSS<"u"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");let gs=gr;const Ed=new WeakMap;function wo(t,e){let n=Ed.get(e);if(n==null||n.disposed){if(t==null||e.currentPanel===-1)return null;const o=de().Base;n=new gs(t,e.currentPanel,o.screenWidth,o.screenHeight,e),Ed.set(e,n)}return n}const Za={"dddg.buildin.backgrounds.nsfw":`${dt}buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${dt}buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${dt}buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${dt}buildin.base.yuri.nsfw.json`},Sk=new Set(Object.keys(Za)),_k=Object.values(Za);function Pk(t){var n,o,s;const e=Object.values(t.panels.panels);if(!e.find(r=>Object.values(r.objects).find(i=>"scaleX"in i)))for(const r of e)for(const i of Object.values(r.objects)){i.scaleX=i.zoom??1,i.scaleY=i.zoom??1,i.skewX=0,i.skewY=0,i.linkedTo=null;const l=de();if(i.type==="character"){const a=i,u=t.content.current.characters.find(d=>d.id===a.characterType),c=((s=(o=(n=u==null?void 0:u.styleGroups[a.styleGroupId])==null?void 0:n.styles[a.styleId])==null?void 0:o.poses[a.poseId])==null?void 0:s.size)??[960,960];Oh(a,i.zoom??1,c)}if(i.type==="textBox"){const a=i;a.height+=l.TextBox.NameboxHeight,a.y+=a.height/2}i.type==="sprite"&&(i.requireFixing25=!0,t.requireFixing25=!0),delete i.zoom}}function Oh(t,e,n){let o=new DOMMatrixReadOnly().translate(t.x,t.y+t.height/2);o=o.translate(0,-t.height/2).scale(t.width/n[0],t.height/n[1]).translate(0,n[1]/2),o=o.rotate(t.flip?-t.rotation:t.rotation),o=o.translate(0,n[1]/2).scale(e).translate(0,-n[1]/2);const s=t.rotation;Object.assign(t,dr(o)),t.rotation=t.flip?360-s:s,t.skewX=0,t.skewY=0,t.width=n[0],t.height=n[1]}const Ok={fixSprites2_5(t,e){for(const n of Object.values(t.panels.panels))for(const o of Object.values(n.objects)){if(o.type!=="sprite"||!o.requireFixing25||o.scaleX!==o.scaleY)continue;const s=o;s.assets.length===1&&s.assets[0].hq===e.url&&(Oh(s,o.scaleX,e.size),delete o.requireFixing25)}}};async function Ik(t,e,n){if("requireFixing25"in t){const o=await vo(n);e("fixSprites2_5",{url:n,size:[o.width,o.height]},{root:!0})}}function Tk(t){return!t.requireFixing25}function Ih(){return{lqRendering:!0,nsfw:!1,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0}}const jk={namespaced:!0,state:Ih(),mutations:{setNsfw(t,e){t.nsfw=e},setLqRendering(t,e){t.lqRendering=e},setLastDownload(t,e){t.lastDownload=e},setClipboard(t,e){t.clipboard=e},setDarkTheme(t,e){t.useDarkTheme=e},setDefaultCharacterTalkingZoom(t,e){t.defaultCharacterTalkingZoom=e}}},$k={namespaced:!0,state:{},mutations:{add(t,{name:e,url:n}){t[e]=n}},actions:{async add({state:t,commit:e,rootState:n},{name:o,url:s}){if(t[o])throw new Error(`There is already an uploaded file called "${o}"`);const r="uploads:"+o;return e("add",{name:r,url:s}),_p(r,s),await Ik(n,e,r),r}}};function Xe(){return Qb()}const Th=vm({state:{unsafe:!1},mutations:{setUnsafe(t,e){t.unsafe=e},...Ok},actions:{async removePacks({dispatch:t,commit:e},{packs:n}){e("setUnsafe",!0),await t("content/removeContentPacks",n),e("setUnsafe",!1)},async getSave({state:t},e){const n=await kn.getInstance();return JSON.stringify({...t,version:2.5},(o,s)=>{if(o!=="ui"&&o!=="lastRender")return o==="uploadUrls"?Object.keys(s):o==="content"&&e?s.contentPacks.filter(r=>{var i,l;return!((i=r.packId)!=null&&i.startsWith("dddg.buildin."))||((l=r.packId)==null?void 0:l.endsWith(".nsfw"))}).map(r=>{var l;let i=(l=r.packId)!=null&&l.startsWith("dddg.uploads.")?r:r.packId;if(r.packId!=null){const a=n.getPack(r.packId);a&&a.repoUrl!=null&&(i+=`;${a.repoUrl}`)}return i}):s},2)},async loadSave({state:t},e){const n=JSON.parse(e),o=n.content;n.ui={...Ih(),lqRendering:t.ui.lqRendering,nsfw:o.find(a=>typeof a=="string"&&a.startsWith("dddg.buildin.")&&a.endsWith(".nsfw"))!==void 0,clipboard:t.ui.clipboard,useDarkTheme:t.ui.useDarkTheme,defaultCharacterTalkingZoom:t.ui.defaultCharacterTalkingZoom},n.uploadUrls={},n.content=kh();const s=await kn.getInstance(),r=new Set,i=await Promise.allSettled(o.map(async a=>{if(typeof a!="string")return a;let u=null,c;if(a.indexOf(";")>=0?[c,u]=a.split(";"):c=a,r.has(c))return null;r.add(c);const d=t.content.contentPacks.find(_=>_.packId===c);if(d)return d;if(a.startsWith("dddg.buildin.")&&a.endsWith(".nsfw")){const _=await Wl(Za[a]);return await ur(_)}u!=null&&!s.hasPack(c)&&await s.loadTempPack(u);const g=s.getPack(c);if(!g)return console.warn(`Pack Id ${a} not found!`),null;const b=await Wl(g.dddg2Path||g.dddg1Path);return await ur(b)}));for(const a of i)a.status==="rejected"&&($e.fire(new Nn(""+a.reason)),console.error(a.reason));n.content.contentPacks=[...t.content.contentPacks.filter(a=>{var u;return(u=a.packId)==null?void 0:u.startsWith("dddg.buildin.")}),...i.filter(a=>a.status==="fulfilled").map(a=>a.value).filter(a=>a!==null)];let l=n.content.current;for(const a of n.content.contentPacks)l=Ds(l,a);n.content.current=l,(n.version==null||n.version<2.5)&&Pk(n),this.replaceState(n),$e.fire(new Or)}},modules:{ui:jk,panels:pk,content:q1,uploadUrls:$k}});function Rk(t){if(t===null)return!1;if(t instanceof HTMLInputElement)return!0;if("ownerDocument"in t){const e=t.ownerDocument;return t instanceof e.defaultView.HTMLInputElement}return!1}function Ak(t){if(t===null)return!1;if(t instanceof HTMLTextAreaElement)return!0;if("ownerDocument"in t){const e=t.ownerDocument;return e?t instanceof e.defaultView.HTMLTextAreaElement:!1}return!1}function Mk(t){if(t instanceof HTMLElement)return!0;if("ownerDocument"in t){const e=t.ownerDocument;return e?t instanceof e.defaultView.HTMLElement:!1}return!1}function ss(t){if(t instanceof MouseEvent)return!0;const e=t.target.ownerDocument;return e?t instanceof e.defaultView.MouseEvent:!1}function Bk(t){if(t instanceof TouchEvent)return!0;const e=t.target.ownerDocument;return e?t instanceof e.defaultView.TouchEvent:!1}const Ek="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23000'%20stroke='%23000'%3e%3cpath%20d='M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z'/%3e%3c/svg%3e",Dk="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23fff'%20stroke='%23fff'%3e%3cpath%20d='M120-120v-320h80v184l504-504H520v-80h320v320h-80v-184L256-200h184v80H120Z'/%3e%3c/svg%3e",Lk="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23000'%20stroke='%23000'%3e%3cpath%20d='M440-80q-50-5-96-24.5T256-156l56-58q29%2021%2061.5%2034t66.5%2018v82Zm80%200v-82q104-15%20172-93.5T760-438q0-117-81.5-198.5T480-718h-8l64%2064-56%2056-160-160%20160-160%2056%2058-62%2062h6q75%200%20140.5%2028.5t114%2077q48.5%2048.5%2077%20114T840-438q0%20137-91%20238.5T520-80ZM198-214q-32-42-51.5-88T122-398h82q5%2034%2018%2066.5t34%2061.5l-58%2056Zm-76-264q6-51%2025-98t51-86l58%2056q-21%2029-34%2061.5T204-478h-82Z'/%3e%3c/svg%3e",Nk="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24'%20viewBox='0%20-960%20960%20960'%20width='24'%20fill='%23fff'%20stroke='%23fff'%3e%3cpath%20d='M440-80q-50-5-96-24.5T256-156l56-58q29%2021%2061.5%2034t66.5%2018v82Zm80%200v-82q104-15%20172-93.5T760-438q0-117-81.5-198.5T480-718h-8l64%2064-56%2056-160-160%20160-160%2056%2058-62%2062h6q75%200%20140.5%2028.5t114%2077q48.5%2048.5%2077%20114T840-438q0%20137-91%20238.5T520-80ZM198-214q-32-42-51.5-88T122-398h82q5%2034%2018%2066.5t34%2061.5l-58%2056Zm-76-264q6-51%2025-98t51-86l58%2056q-21%2029-34%2061.5T204-478h-82Z'/%3e%3c/svg%3e";async function ko(t,e){try{await e()}catch(n){Fk(t,n)}}function Fk(t,e){console.error("Error in promise",t,e),$e.fire(new Nn("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+t+'", '+Hk(e)))}function Hk(t){if(t instanceof Error){if(t.stack!=null){const e=t.stack.split(`
`);return e[0].includes(t.name)&&e[0].includes(t.message)?e[0]+`
<br />`+e[1]:t.name+": "+t.message+`
<br />`+e[0]}return t.name+": "+t.message}return t instanceof Object?JSON.stringify(t):""+t}const pn=window.devicePixelRatio??1;class Vk{constructor(e){B(this,"dragData",null);B(this,"grabbies",[new Rh,new $h]);this.viewport=e}paint(e,n){const o=Uk(n),s=this.viewport.value;if(e.save(),this.dragData&&this.dragData.viewport===s)r(n,this.dragData.lastPos),this.dragData.grabby.paint(e,this.dragData),e.translate(this.dragData.lastPos.x,this.dragData.lastPos.y),e.scale(pn,pn),this.dragData.grabby.drawGrabby(e,new DOMPointReadOnly);else{const i=de();e.translate(o.x,o.y),e.scale(pn,pn),n.x>i.Base.screenWidth/2&&e.scale(-1,1),n.y>i.Base.screenHeight/2&&e.scale(1,-1);for(let l=0;l<this.grabbies.length;l++){const a=this.grabbies[l];a.pos||(a.pos=qk(Wk*(l+1))),a.drawGrabby(e,a.pos)}}e.restore();function r(i,l){e.save();try{e.beginPath(),e.moveTo(i.x,i.y),e.lineTo(l.x,l.y),e.setLineDash([5*pn,5*pn]),e.strokeStyle="#000",e.stroke(),e.closePath()}finally{e.restore()}}}onDown(e){const n=this.viewport.value,o=de(),s=this.grabbies.find(r=>{const i=r.lastDrawPos;return i?Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2))<=o.Base.wheelWidth/2*pn:!1});return s?(this.dragData={lastPos:e,started:!1,grabby:s,center:null,renderObj:null,viewport:n},!0):!1}onMove(e,n,o){var a;if(!this.dragData)return!1;const s=this.viewport.value,l=e.state.panels.panels[s.currentPanel].objects[s.selection];if(!this.dragData.started){this.dragData.started=!0;const u=wo(e,s),c=u.getLastRenderObject(l.id),d=((a=u==null?void 0:u.getLastRenderObject(l.linkedTo))==null?void 0:a.preparedTransform)??new DOMMatrixReadOnly;this.dragData.renderObj=c,this.dragData.center=d.transformPoint(new DOMPointReadOnly(l.x,l.y)),this.dragData.grabby.onStartMove(l,this.dragData)}return this.dragData.lastPos=n,this.dragData.grabby.onMove(e,l,o,this.dragData),!0}onDrop(){return this.dragData?(this.dragData=null,!0):!1}}const Nr=2*Math.PI;class jh{constructor(){B(this,"pos",null);B(this,"lastDrawPos",null)}drawGrabby(e,n){var i;const o=de();e.save(),e.translate(n.x,n.y),this.lastDrawPos=e.getTransform().transformPoint(new DOMPointReadOnly),e.scale(-1,1),e.beginPath(),e.ellipse(0,0,o.Base.wheelWidth/2,o.Base.wheelWidth/2,0,0,Nr),e.closePath();const s=getComputedStyle(document.body);e.fillStyle=s.getPropertyValue("--accent-background"),e.strokeStyle=s.getPropertyValue("--border"),e.lineWidth=2,e.fill(),e.stroke();const r=document.body.classList.contains("dark-theme")?this.iconDark:this.icon;(i=Ql.get(r))==null||i.paintOnto(e),e.restore()}}class $h extends jh{constructor(){super(...arguments);B(this,"icon",Lk);B(this,"iconDark",Nk);B(this,"pos",null);B(this,"lastDrawPos",null)}paint(n,{lastPos:o,center:s,initialDragAngle:r}){const{angle:i}=Ns(rs(s,o)),l=de().Base,a=ql(r-i,Nr);n.beginPath(),n.moveTo(s.x,s.y);let u=r-Math.PI,c=u+i-r;if(a<=Math.PI){const d=c;c=u,u=d}n.arc(s.x,s.y,l.wheelInnerRadius,u,c),n.lineTo(s.x,s.y),n.globalCompositeOperation="difference",n.fillStyle="rgba(255, 255, 255, 1)",n.fill(),n.globalCompositeOperation="source-over"}onStartMove(n,o){o.initalObjRotation=n.rotation;const{angle:s}=Ns(rs(o.center,o.lastPos));o.initialDragAngle=s}onMove(n,o,s,{center:r,initalObjRotation:i,initialDragAngle:l,lastPos:a}){const{angle:u}=Ns(rs(r,a));let c=ql(i+(u-l)/Math.PI*180,360);s&&(c=Math.round(c/22.5)*22.5),o.rotation!==c&&n.commit("panels/setRotation",{panelId:o.panelId,id:o.id,rotation:c})}}class Rh extends jh{constructor(){super(...arguments);B(this,"icon",Ek);B(this,"iconDark",Dk);B(this,"pos",null);B(this,"lastDrawPos",null)}paint(n,{renderObj:o,originalObjTransform:s}){if(s==null)return;const r=o.preparedTransform;try{o.preparedTransform=s,yn(n,()=>{n.globalAlpha=.5,o.render(n,en.None,!0,!1,!0),n.globalAlpha=1})}finally{o.preparedTransform=r}}onStartMove(n,o){o.originalObjTransform=o.renderObj.preparedTransform,o.initialScaleX=n.scaleX,o.initialScaleY=n.scaleY,o.initialDelta=rs(o.center,o.lastPos)}onMove(n,o,s,{initialScaleX:r,initialScaleY:i,initialDelta:l,center:a,lastPos:u}){const c=de(),d=rs(a,u);let g=d.x/l.x*r,b=d.y/l.y*i;if(s){let _=d;a.x>c.Base.screenWidth/2&&(_=new DOMPointReadOnly(-_.x,_.y)),a.y>c.Base.screenHeight/2&&(_=new DOMPointReadOnly(_.x,-_.y));const{angle:w}=Ns(_),P=Math.round(w/Nr*11),y=(Math.abs(d.x)/Math.abs(l.x)+Math.abs(d.y)/Math.abs(l.y))/2;P===0||P===11?b=i:P===1?(g=-y*r,b=-y*i):P===2||P===3?g=r:P===4?(g=y*r,b=-y*i):P===5||P===6?b=i:P===7?(g=y*r,b=y*i):P===8||P===9?g=r:P===10&&(g=-y*r,b=y*i)}o.scaleX===g&&o.scaleY===b||n.commit("panels/setObjectScale",{panelId:o.panelId,id:o.id,scaleX:g,scaleY:b})}}const Ql=new Map;for(const t of[Rh,$h])ko("Loading grabby icon",async()=>{const e=new t;Ql.set(e.icon,await vo(e.icon)),Ql.set(e.iconDark,await vo(e.iconDark))});function Uk(t){const e=de(),n=e.Base.wheelWidth+e.Base.wheelInnerRadius*pn;return new DOMPointReadOnly(cr(n,t.x,e.Base.screenWidth-n),cr(n,t.y,e.Base.screenHeight-n))}const Wk=Math.PI/6;function qk(t){const e=de().Base;return new DOMPointReadOnly(e.wheelInnerRadius*Math.cos(t),e.wheelInnerRadius*Math.sin(t))}function rs(t,e){return new DOMPointReadOnly(t.x-e.x,t.y-e.y)}function Ns(t){const e=Math.atan2(t.y,t.x);return{angle:ql(e,Nr),distance:Math.sqrt(t.x*t.x+t.y*t.y)}}const zk=["height","width"],Gk=Oe({__name:"preview-render",props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean,default:!1}},setup(t,{expose:e}){const n=t,o=Xe(),s=q(null),r=q(null),i=q(null),l=q(!1),a=q(!1),u=St(),c=new Vk(u),d=cp(),g=D(()=>o.state.panels.panels[u.value.currentPanel]),b=D(()=>o.state.ui.lqRendering);function _(){if(n.preLoading)return null;const K=wo(o,u.value);return K==null||K.setPanelId(u.value.currentPanel),K}const w=D(()=>(n.preLoading,de().Base.screenHeight)),P=D(()=>(n.preLoading,de().Base.screenWidth));function y(){i.value==null&&(i.value=requestAnimationFrame(h))}async function h(){var K;if(i.value!=null&&(cancelAnimationFrame(i.value),i.value=null),!n.preLoading&&!o.state.unsafe){try{await((K=_())==null?void 0:K.render(!b.value,!0,!0))}catch(Ce){console.log(Ce)}f(),$e.fire(new Qs)}}function v(){const K=document.createElement("canvas");K.height=w.value,K.width=P.value;try{mo.make(K,!0,!1).drawText({text:"Starting...",x:K.width/2,y:K.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),r.value.drawImage(K,n.canvasWidth,n.canvasHeight)}finally{bo(K)}}function f(){const K=_();l.value=!1,K==null||K.paintOnto(r.value,{x:0,y:0,w:P.value,h:w.value});const Ce=K==null?void 0:K.getLastRenderObject(d.value);Ce&&c.paint(r.value,Ce.preparedTransform.transformPoint(new DOMPoint(0,0))),$.value=!1}function C(K,Ce,Pe){const Y=s.value,W=K-Y.offsetLeft,k=Ce-Y.offsetTop;let O=W/Y.offsetWidth*Y.width,M=k/Y.offsetWidth*Y.width;if(Pe){const z=Pe.transformPoint(new DOMPointReadOnly(O,M));O=z.x,M=z.y}return[O,M]}function T(K){const[Ce,Pe]=C(K.clientX,K.clientY);if(E(Ce,Pe))return;if(a.value){a.value=!1;return}const Y=_().objectsAt(Ce,Pe),W=d.value,k=Y.findIndex(M=>M===W);let O;k===0?O=null:k!==-1?O=Y[k-1]:O=Y[Y.length-1]??null,oe(()=>{u.value.selection!==O&&(u.value.selection=O)})}Fe(()=>[n.canvasWidth,n.canvasHeight],()=>f()),$e.subscribe(Or,y),$e.subscribe(er,()=>{const K=_();K&&K.setPanelId(-1)}),o.subscribe(K=>{K.type!=="panels/setPanelPreview"&&K.type!=="panels/currentPanel"&&y()}),Fe(()=>[d.value,u.value.currentPanel],()=>{y()}),Dt(()=>{r.value=s.value.getContext("2d"),v(),y()}),Sn(()=>{_().dispose()});const $=q(!1);async function m(K){if($.value)h(),$.value=!1;else{const Ce=await rr(K,!0);r.value.clearRect(0,0,s.value.width,s.value.height),Ce.paintOnto(r.value,{x:0,y:0}),$.value=!0}}const x=D(()=>u.value.pickColor),I=D(()=>x.value?"crosshair":"default");function E(K,Ce){if(x.value){const Pe=r.value.getImageData(K,Ce,1,1).data,Y=`rgba(${Pe[0].toString()},${Pe[1].toString()},${Pe[2].toString()},${(Pe[3]/255).toString()})`;return oe(()=>{o.commit("ui/setColorPicker",!1),$e.fire(new tr(Y))}),!0}return!1}async function L(){const K=await _().download();await oe(()=>{const Ce=o.state.ui.lastDownload;o.commit("ui/setLastDownload",K),Ce!=null&&URL.revokeObjectURL(Ce)})}let H=null,V=null,ae=0,ue=0,A=0,S=0;function R(K){K.preventDefault(),U(K.clientX,K.clientY)}function se(K){U(K.touches[0].clientX,K.touches[0].clientY)}function U(K,Ce){var k,O;const Pe=d.value;if(Pe===null)return;H=g.value.objects[Pe],V=((O=(k=wo(o,u.value).getLastRenderObject(H.linkedTo))==null?void 0:k.preparedTransform)==null?void 0:O.inverse())??new DOMMatrixReadOnly;const[Y,W]=C(K,Ce,V);Pe!=null&&c.onDown(new DOMPointReadOnly(...C(K,Ce)))||(ae=Y-H.x,ue=W-H.y,A=H.x,S=H.y)}function ne(K){K.stopPropagation(),K.preventDefault(),K.dataTransfer.dropEffect="copy"}function we(K){if(!H)return;K.preventDefault();const Ce=ss(K)?K.clientX:K.touches[0].clientX,Pe=ss(K)?K.clientY:K.touches[0].clientY;let[Y,W]=C(Ce,Pe,V);if(c.onMove(o,new DOMPointReadOnly(...C(Ce,Pe)),K.shiftKey)){y();return}Y-=ae,W-=ue;const k=Math.abs(Y-A),O=Math.abs(W-S);k+O>1&&(a.value=!0),K.shiftKey&&(k>O?W=S:Y=A),oe(async()=>{await o.dispatch("panels/setPosition",{panelId:H.panelId,id:H.id,x:Y,y:W})})}async function Se(K){if(K.stopPropagation(),K.preventDefault(),!!K.dataTransfer){for(const Ce of K.dataTransfer.items)if(Ce.kind==="file"&&Ce.type.match(/image.*/)){const Pe=Ce.getAsFile(),Y=URL.createObjectURL(Pe);try{const W=await o.dispatch("uploadUrls/add",{name:Pe.name,url:Y});await oe(async()=>{await o.dispatch("panels/createSprite",{panelId:u.value.currentPanel,assets:[{hq:W,lq:W,sourcePack:"dddg.uploaded.sprites"}]})})}catch{URL.revokeObjectURL(Y)}}}}function _e(K){if(c.onDrop()){y(),K.preventDefault(),H=null,a.value=!0;return}H&&("TouchEvent"in window&&Bk(K)&&(a.value=!1),H=null)}function Ye(K){K.buttons!==1&&(H=null,c.onDrop()&&y())}return e({download:L,blendOver:m}),(K,Ce)=>(j(),N("canvas",{id:"scaled_display",ref_key:"sd",ref:s,height:w.value,width:P.value,style:et({width:K.canvasWidth+"px",height:K.canvasHeight+"px",cursor:I.value}),draggable:"true",onClick:T,onTouchstart:se,onDragstart:R,onTouchmove:we,onMousemove:we,onTouchend:_e,onMouseup:_e,onDragover:ne,onDrop:Se,onMouseenter:Ye,onContextmenu:Ce[0]||(Ce[0]=fe(()=>{},["prevent"]))}," HTML5 is required to use the Doki Doki Dialog Generator. ",44,zk))}}),Xk=["disabled","title","aria-label"],Yk={key:0,class:"material-icons","aria-hidden":"true"},Kk={class:"content"},Jk={key:1,class:"shortcut-popup"},Zk=Oe({__name:"d-button",props:{icon:{},iconPos:{default:"left"},disabled:{type:Boolean,default:!1},shortcut:{},title:{}},setup(t){const e=t,n=q(null),o=D(()=>e.shortcut!=null&&!e.shortcut.startsWith("!")),s=D(()=>{const i=e.shortcut;return i==null?"":i.startsWith("!")?i.substring(1):i});function r(i){e.disabled||i.key===e.shortcut&&i.ctrlKey&&!i.altKey&&!i.metaKey&&!i.shiftKey&&(n.value.focus({focusVisible:!1}),n.value.click(),i.preventDefault(),i.stopPropagation())}return Dt(()=>{e.shortcut!=null&&window.addEventListener("keydown",r)}),Sn(()=>{window.removeEventListener("keydown",r)}),(i,l)=>(j(),N("button",{class:Le([i.iconPos]),disabled:i.disabled,title:i.title,"aria-label":i.title,style:et(i.icon?"height: auto":""),ref_key:"btn",ref:n},[i.icon?(j(),N("div",Yk,Te(i.icon),1)):he("",!0),p("div",Kk,[qt(i.$slots,"default",{},void 0,!0)]),o.value?(j(),N("div",Jk,Te(s.value),1)):he("",!0)],14,Xk))}}),Ae=Be(Zk,[["__scopeId","data-v-bbb09c0d"]]),Qk={methods:{verticalScrollRedirect:Ah}};function Ah(t){if(t.type!=="wheel"||!t.currentTarget)return;const e=t.currentTarget,n=getComputedStyle(e),o=t;if(o.deltaY===0)return;if(n.overflowY==="auto"){if(o.deltaY>0){if(e.scrollHeight>e.scrollTop+e.clientHeight){t.stopPropagation();return}}else if(e.scrollTop>0){t.stopPropagation();return}}const s=e.scrollLeft;e.scrollLeft+=o.deltaY,e.scrollLeft!==s&&t.stopPropagation()}function $t(t){const e=_n();function n(){const s=t.value;return s==null?null:s.$el?s.$el:s}function o(){t.value!=null&&n().classList.toggle("vertical",e.value)}return Fe(()=>e.value,o),Dt(()=>{o(),n().addEventListener("wheel",s=>{e.value||Ah(s)},{passive:!0})}),{vertical:e,getRoot:n}}const eC=["title","onClick","onKeypress"],tC=["src","alt"],nC=Oe({__name:"characters-tab",emits:["show-dialog"],setup(t,{emit:e}){const n=e,o=Xe(),s=St(),r=D(()=>o.state.content.current.characters);function i(a){return a.chibi?ge.supports.lq?a.chibi.lq:a.chibi.hq:""}function l(a){oe(async()=>{await o.dispatch("panels/createCharacters",{characterType:a,panelId:s.value.currentPanel})})}return(a,u)=>(j(),N(ce,null,[(j(!0),N(ce,null,qe(r.value,c=>(j(),N("div",{class:"character",tabindex:"0",key:c.id,title:c.label,onClick:fe(d=>l(c.id),["left"]),onKeypress:[ot(fe(d=>l(c.id),["prevent","stop"]),["enter"]),ot(fe(d=>l(c.id),["prevent","stop"]),["space"])]},[p("img",{src:i(c),alt:c.label},null,8,tC)],40,eC))),128)),F(Ae,{class:"custom-sprite",icon:"extension",onClick:u[0]||(u[0]=c=>n("show-dialog","type: Characters"))},{default:te(()=>u[1]||(u[1]=[Q(" Search in content packs ")])),_:1})],64))}}),oC=Be(nC,[["__scopeId","data-v-5669e016"]]),sC=Oe({__name:"drop-target",emits:["drop"],setup(t,{expose:e,emit:n}){const o=n,s=q(!1),r=_n();function i(){s.value=!0}function l(){s.value=!1}function a(u){if(l(),u.stopPropagation(),u.preventDefault(),!!u.dataTransfer){for(const c of u.dataTransfer.items)if(c.kind==="file"&&c.type.match(/image.*/)){const d=c.getAsFile();d!=null&&o("drop",d)}}}return e({show:i,hide:l}),(u,c)=>s.value?(j(),N("div",{key:0,onDragleave:c[0]||(c[0]=d=>s.value=!1),onDrop:a,class:Le({vertical:ie(r)})},[qt(u.$slots,"default",{},void 0,!0)],34)):he("",!0)}}),Mh=Be(sC,[["__scopeId","data-v-43b59d3a"]]),rC=["title","onClick","onKeypress"],iC=["title","onClick","onKeypress"],lC=Oe({__name:"sprites-tab",emits:["show-dialog"],setup(t,{expose:e,emit:n}){const o=n,s=Xe(),r=St(),i=D(()=>s.state.content.current.sprites.map($=>{let m=null;const x=$.variants[0].map(I=>{const E=mn(I,!1);return E.startsWith("uploads:")?(Object.keys(s.state.uploadUrls),m=E,Sp):E});return{...$,missing:m,urls:x}})),l=D(()=>ge.supports.openableFolders.has("sprites"));function a($){return $.variants[0].map(m=>`url('${mn(m,!1)}')`).join(",")}async function u($){await oe(async()=>{await s.dispatch("panels/createSprite",{panelId:r.value.currentPanel,assets:$.variants[0]})})}function c(){ge.openFolder("sprites")}const d=q(null);async function g(){const $=d.value,m=$.uploadingSprite;if(!$.files)return;if($.files.length!==1){console.error("More than one file uploaded!");return}const x=$.files[0];await oe(async()=>{const I=URL.createObjectURL(x);await s.dispatch("uploadUrls/add",{name:m,url:I})})}function b($){const m=d.value;m.uploadingSprite=mn($.variants[0][0]).substring(8),m.click()}const _={packId:"dddg.uploads.sprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},w=q(null);function P(){const $=w.value;if($.files)for(const m of $.files)h(m)}async function y(){const $=prompt("Enter the URL of the image");if($==null)return;const m=$.split("/").slice(-1)[0];await v(m,$)}async function h($){await oe(async m=>{const x=URL.createObjectURL($),I=await s.dispatch("uploadUrls/add",{name:$.name,url:x});await v($.name,I,m)})}async function v($,m,x=oe){const I=s.state.content.contentPacks.find(L=>L.packId===_.packId)||_,E={...I,sprites:[...I.sprites,{id:m,label:$,variants:[[{lq:m,hq:m}]],defaultScale:[1,1],hd:null}]};await x(async()=>{await s.dispatch("content/replaceContentPack",{contentPack:E,processed:!0})})}const f=q(null);function C($){$.dataTransfer&&($.dataTransfer.effectAllowed="none",Array.from($.dataTransfer.items).find(m=>m.type.match(/^image.*$/))&&($.dataTransfer.effectAllowed="link",f.value.show()))}function T(){f.value.hide()}return e({showDropTarget:C,hideDropTarget:T}),($,m)=>(j(),N(ce,null,[F(Mh,{ref_key:"spriteDt",ref:f,class:"drop-target",onDrop:h},{default:te(()=>m[2]||(m[2]=[Q("Drop here to add as a new sprite ")])),_:1},512),(j(!0),N(ce,null,qe(i.value,x=>(j(),N(ce,null,[x.missing!==null?(j(),N("div",{class:"sprite",tabindex:"0",key:`${x.label}_missing`,title:x.label,style:et({background:a(x)}),onClick:I=>b(x),onKeypress:[ot(fe(I=>b(x),["prevent","stop"]),["enter"]),ot(fe(I=>b(x),["prevent","stop"]),["space"])]},Te(x.label),45,rC)):(j(),N("div",{class:"sprite",tabindex:"0",key:x.label,title:x.label,style:et({background:a(x)}),onClick:I=>u(x),onKeypress:[ot(fe(I=>u(x),["prevent","stop"]),["enter"]),ot(fe(I=>u(x),["prevent","stop"]),["space"])]},Te(x.label),45,iC))],64))),256)),F(Ae,{class:"custom-sprite v-w100",icon:"publish",onClick:m[0]||(m[0]=x=>w.value.click())},{default:te(()=>[m[3]||(m[3]=Q(" Upload new sprite ")),p("input",{type:"file",ref_key:"spriteUpload",ref:w,onChange:P,multiple:""},null,544)]),_:1}),F(Ae,{icon:"insert_link",onClick:y},{default:te(()=>m[4]||(m[4]=[Q(" New sprite from URL ")])),_:1}),F(Ae,{icon:"extension",onClick:m[1]||(m[1]=x=>o("show-dialog","type: Sprites"))},{default:te(()=>m[5]||(m[5]=[Q(" Search in content packs ")])),_:1}),l.value?(j(),pe(Ae,{key:0,icon:"folder",onClick:c},{default:te(()=>m[6]||(m[6]=[Q(" Open sprites folder ")])),_:1})):he("",!0),p("input",{type:"file",ref_key:"missingSpriteUpload",ref:d,onChange:g},null,544)],64))}}),aC=Be(lC,[["__scopeId","data-v-4de5fff1"]]),uC=Oe({__name:"ui-tab",setup(t){const e=Xe(),n=St();async function o(){return await a("createTextBox")}async function s(){return await a("createChoice")}async function r(){return await a("createNotification")}async function i(){return await a("createPoem")}async function l(){return await a("createConsole")}async function a(u){await oe(async()=>{await e.dispatch(`panels/${u}`,{panelId:n.value.currentPanel})})}return(u,c)=>(j(),N(ce,null,[p("button",{class:"v-w100",onClick:o},"Textbox"),p("button",{class:"v-w100 v-bt0",onClick:i},"Poem"),p("button",{class:"v-w100 v-bt0",onClick:r},"Notification"),p("button",{class:"v-w100 v-bt0",onClick:s},"Choice"),p("button",{class:"v-w100 v-bt0",onClick:l},"Console")],64))}}),cC=["innerHTML"],dC=["disabled"],fC=Oe({__name:"add-tool",setup(t){const e=Xe(),n={characters:{icon:"emoji_people",text:"Char&shy;acters",shortcut:"1"},sprites:{icon:"change_history",text:"Sprites",shortcut:"2"},ui:{icon:"view_quilt",text:"UI",shortcut:"3"}},o=q(null),s=q("characters"),r=q(null),{vertical:i}=$t(o),l=St(),a=D(()=>e.state.ui.clipboard!=null);function u(){oe(async()=>{await e.dispatch("panels/pasteObjectFromClipboard",{panelId:l.value.currentPanel})})}return(c,d)=>(j(),N("div",{class:"panel",ref_key:"root",ref:o,onDragenter:d[2]||(d[2]=(...g)=>{var b,_;return((b=r.value)==null?void 0:b.showDropTarget)&&((_=r.value)==null?void 0:_.showDropTarget(...g))}),onMouseleave:d[3]||(d[3]=(...g)=>{var b,_;return((b=r.value)==null?void 0:b.hideDropTarget)&&((_=r.value)==null?void 0:_.hideDropTarget(...g))})},[d[4]||(d[4]=p("h1",null,"Add",-1)),p("div",{class:Le({"group-selector":!0,vertical:ie(i)})},[(j(),N(ce,null,qe(n,(g,b)=>F(Ae,{key:b,class:Le({active:s.value===b,"v-bl0":b!=="characters","h-bt0":b!=="characters"}),"icon-pos":"top",icon:g.icon,shortcut:g.shortcut,onClick:_=>s.value=b},{default:te(()=>[p("span",{innerHTML:g.text},null,8,cC)]),_:2},1032,["class","icon","shortcut","onClick"])),64))],2),p("div",{class:Le({"item-grid":!0,vertical:ie(i)})},[s.value==="characters"?(j(),pe(oC,{key:0,onShowDialog:d[0]||(d[0]=g=>c.$emit("show-dialog",g))})):s.value==="sprites"?(j(),pe(aC,{key:1,ref_key:"sprites",ref:r,onShowDialog:d[1]||(d[1]=g=>c.$emit("show-dialog",g))},null,512)):s.value==="ui"?(j(),pe(uC,{key:2})):he("",!0),p("button",{class:"v-w100",onClick:u,disabled:!a.value}," Paste ",8,dC)],2)],544))}}),pC=Be(fC,[["__scopeId","data-v-11f50ed7"]]),hC=["href"],Ze=Oe({__name:"external-link",props:{to:{}},setup(t){const e=t,n=q(null),o=D(()=>{let s=e.to;return s=s.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),s=s.replace(/^wiki:\/\/(.*)/,(r,i)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+i.replaceAll(" ","-")),s});return(s,r)=>(j(),N("a",{target:"_blank",rel:"noopener noreferrer",ref_key:"root",ref:n,href:o.value},[qt(s.$slots,"default")],8,hC))}}),gC=Oe({__name:"app-credits",setup(t){const e=q(null);return $t(e),(n,o)=>(j(),N("div",{class:"panel",ref_key:"root",ref:e},[o[35]||(o[35]=p("h1",null,"Help and Credits",-1)),F(Ze,{class:"btn",to:"wiki://Dokumentation"},{default:te(()=>o[0]||(o[0]=[Q("Help")])),_:1}),F(Ze,{class:"btn",to:"github://"},{default:te(()=>o[1]||(o[1]=[Q("Fork me on GitHub")])),_:1}),F(Ze,{class:"btn",to:"wiki://Privacy Statement"},{default:te(()=>o[2]||(o[2]=[Q("Privacy Statement")])),_:1}),o[36]||(o[36]=p("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),o[37]||(o[37]=p("p",null,[Q(" Doki Doki Dialog Generator developed by EDave64 "),p("br"),Q("Based on gemdude46's DDLC Shitpost generator ")],-1)),p("p",null,[o[4]||(o[4]=Q(" Unused House Background by ")),F(Ze,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:te(()=>o[3]||(o[3]=[Q(" Fatelogic ")])),_:1})]),p("p",null,[o[6]||(o[6]=Q(" Aller Font by ")),F(Ze,{to:"https://www.daltonmaag.com/library/aller"},{default:te(()=>o[5]||(o[5]=[Q("Dalton Maag Ltd")])),_:1})]),p("p",null,[o[8]||(o[8]=Q(" Riffic Bold Font by ")),F(Ze,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:te(()=>o[7]||(o[7]=[Q("InkyType")])),_:1})]),p("p",null,[o[10]||(o[10]=Q(" Verily Serif Mono Font by ")),F(Ze,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:te(()=>o[9]||(o[9]=[Q("Stephen G. Hartke")])),_:1})]),p("p",null,[o[12]||(o[12]=Q(" F25 Bank Printer Font by ")),F(Ze,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:te(()=>o[11]||(o[11]=[Q("F25 Digital Typeface Design")])),_:1})]),p("p",null,[o[14]||(o[14]=Q(" Journal Font by ")),F(Ze,{to:"https://www.dafont.com/journal.font"},{default:te(()=>o[13]||(o[13]=[Q("Fontourist")])),_:1})]),p("p",null,[o[16]||(o[16]=Q(" Hashtag Font by ")),F(Ze,{to:"https://www.dafont.com/hashtag.font"},{default:te(()=>o[15]||(o[15]=[Q(" TitanVex")])),_:1})]),p("p",null,[o[18]||(o[18]=Q(" JP Hand Slanted Font by ")),F(Ze,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:te(()=>o[17]||(o[17]=[Q("Jonathan Paterson")])),_:1})]),p("p",null,[o[20]||(o[20]=Q(" As I Lay Dying Font by ")),F(Ze,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:te(()=>o[19]||(o[19]=[Q("Moises Esqueda")])),_:1})]),p("p",null,[o[22]||(o[22]=Q(" Damagrafik Script Font by ")),F(Ze,{to:"https://www.dafont.com/damagrafik-script.font"},{default:te(()=>o[21]||(o[21]=[Q("Davide Terenzi")])),_:1})]),p("p",null,[o[24]||(o[24]=Q(" Ammy's Handwriting Font by ")),F(Ze,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:te(()=>o[23]||(o[23]=[Q("Ammy K.")])),_:1})]),p("p",null,[o[26]||(o[26]=Q(" Halogen Font by ")),F(Ze,{to:"https://www.dafont.com/halogen.font"},{default:te(()=>o[25]||(o[25]=[Q("JLH Fonts")])),_:1})]),o[38]||(o[38]=p("p",null,[Q(" MC Sprite by Childish-N "),p("br"),Q("MC Casual Sprite by SlightlySimple "),p("br"),Q("MC Chibi by SlightlySimple ")],-1)),p("p",null,[F(Ze,{to:"https://www.reddit.com/r/DDLCMods/comments/1hhmu77/"},{default:te(()=>o[27]||(o[27]=[Q("Concept MC")])),_:1}),o[29]||(o[29]=Q(" by StormBlazed76, ")),F(Ze,{to:"https://www.reddit.com/ofof3o"},{default:te(()=>o[28]||(o[28]=[Q("chibi")])),_:1}),o[30]||(o[30]=Q(" by Hadrosaur838 "))]),o[39]||(o[39]=p("p",null,[Q(" MC Chad Sprite by Cylent-Nite "),p("br"),Q("MC Chad Poses and expressions by SlightlySimple "),p("br"),Q("MC Chad Poses and chibi by Meddy-sin ")],-1)),o[40]||(o[40]=p("p",null,[Q(" FeMC Sprite by Meddy-sin "),p("br"),Q("FeMC Casual Sprite by SlightlySimple ")],-1)),p("p",null,[F(Ze,{to:"https://www.reddit.com/oizaow"},{default:te(()=>o[31]||(o[31]=[Q("Concept FeMC")])),_:1}),o[33]||(o[33]=Q(" by ShidoDraws, ")),F(Ze,{to:"https://www.reddit.com/oosuxu"},{default:te(()=>o[32]||(o[32]=[Q("additional poses, expressions and chibi")])),_:1}),o[34]||(o[34]=Q(" by SlightlySimple "))]),o[41]||(o[41]=p("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),o[42]||(o[42]=p("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),o[43]||(o[43]=p("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1))],512))}}),vC=Be(gC,[["__scopeId","data-v-deba67a0"]]);let ea=0;typeof BigInt<"u"&&(ea=BigInt(0));function Qa(){const t=ea;return ea++,t+""}const bC={class:"toggle_box"},mC=["id"],yC=["for"],wC=["for"],Ge=Oe({__name:"d-toggle",props:Ln({label:{}},{modelValue:{type:Boolean,default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=ys(t,"modelValue"),n=Qa(),o=q(null);return(s,r)=>(j(),N("div",bC,[Ie(p("input",{id:ie(n),type:"checkbox",ref_key:"checkbox",ref:o,"onUpdate:modelValue":r[0]||(r[0]=i=>e.value=i)},null,8,mC),[[gb,e.value]]),p("label",{for:ie(n),class:"switch"},null,8,yC),p("label",{for:ie(n),class:"toggle_label"},Te(s.label),9,wC)]))}}),kC={class:"modal-scroll-area"},CC={class:"modal-scroll-area"},xC={key:0},SC={key:1},_C={key:2},PC={key:3,disabled:""},OC={class:"v-w100"},IC={key:7,class:"downloadTable"},TC=Oe({__name:"app-settings",setup(t){const e=Xe(),n=q(null),o=ge.updateProgress;$t(n);function s(){ge.saveSettings({lq:e.state.ui.lqRendering,nsfw:e.state.ui.nsfw,darkMode:e.state.ui.useDarkTheme??void 0,looseTextParsing:ge.state.looseTextParsing,defaultCharacterTalkingZoom:e.state.ui.defaultCharacterTalkingZoom})}const r=D(()=>ge.supports.optionalSaving),i=q(!1),l=q(!1),a=q(!1),u=D({get(){return ge.savingEnabled},set(H){a.value=!0,ge.savingEnabled=H,s()}});function c(H){i.value=!1,H==="Allow"&&(u.value=!0)}function d(H){l.value=!1,H==="Deny"&&(u.value=!1)}Fe(()=>u.value,()=>a.value=!1);const g=q(!1),b=D(()=>ge.gameMode==="ddlc_plus");function _(H){ko("changing modes",async()=>{H==="Enter Classic Mode"?await ge.setGameMode("ddlc"):H==="Enter Plus mode"?await ge.setGameMode("ddlc_plus"):g.value=!1})}const w=D(()=>ge.supports.lq),P=D({get(){return e.state.ui.lqRendering},set(H){oe(()=>{e.commit("ui/setLqRendering",H)}),s()}}),y=D({get(){return!!e.state.ui.nsfw},set(H){oe(()=>{e.commit("ui/setNsfw",H),s()})}}),h=D({get(){return!!e.state.ui.defaultCharacterTalkingZoom},set(H){oe(()=>{e.commit("ui/setDefaultCharacterTalkingZoom",H),s()})}}),v=D({get(){return ge.state.looseTextParsing},set(H){ge.state.looseTextParsing=H,s()}}),f=D({get(){return e.state.ui.useDarkTheme},set(H){oe(()=>{e.commit("ui/setDarkTheme",H),s()})}}),C=D(()=>ge.supports.setDownloadFolder),T=D(()=>ge.state.downloadLocation);function $(){ge.updateDownloadFolder()}function m(){ge.openFolder("downloads")}const x=D(()=>ge.state.hasTemplate);function I(){ge.saveDefaultTemplate()}function E(){ge.clearDefaultTemplate()}function L(){const H=ge.openNewWindow();if(!H){$e.fire(new Nn("Failed to open new window. You may need to enable popups."));return}const V=H.document.createElement("div");H.document.body.appendChild(V);for(const ue of document.head.querySelectorAll("style,link[rel=stylesheet]"))H.document.head.appendChild(ue.cloneNode(!0));document.body.classList.contains("dark-theme")&&H.document.body.classList.add("dark-theme");const ae=H.document.createElement("title");H.document.title="DDLC child",H.document.head.appendChild(ae),op(Bh).use(Th).mount(V)}return(H,V)=>(j(),N("div",{class:"panel",ref_key:"root",ref:n},[V[26]||(V[26]=p("h1",null,"Settings",-1)),(j(),pe(xf,{to:"#modal-messages"},[i.value?(j(),pe(ao,{key:0,options:["Allow","Deny"],onLeave:V[0]||(V[0]=ae=>c("Deny")),onOption:c,"no-base-size":""},{default:te(()=>[p("div",kC,[V[14]||(V[14]=p("p",null," Do you want to allow DDDG to save settings on your device? ",-1)),V[15]||(V[15]=p("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),V[16]||(V[16]=p("p",null,"You can revoke this permission at any time.",-1)),p("p",null,[V[12]||(V[12]=Q(" Our usual ")),F(Ze,{to:"wiki://Privacy Statement"},{default:te(()=>V[11]||(V[11]=[Q("privacy policy")])),_:1}),V[13]||(V[13]=Q(" still applies. "))])])]),_:1})):he("",!0),l.value?(j(),pe(ao,{key:1,options:["Deny","Cancle"],onLeave:V[1]||(V[1]=ae=>d("Cancel")),onOption:d,"no-base-size":""},{default:te(()=>[p("div",CC,[V[20]||(V[20]=p("p",null," Do you want to deny DDDG from saving settings on your device? ",-1)),V[21]||(V[21]=p("p",null," This will cause all your settings to reset when leaving the page. ",-1)),p("p",null,[V[18]||(V[18]=Q(" Our usual ")),F(Ze,{to:"wiki://Privacy Statement"},{default:te(()=>V[17]||(V[17]=[Q("privacy policy")])),_:1}),V[19]||(V[19]=Q(" still applies. "))])])]),_:1})):he("",!0),g.value?(j(),pe(ao,{key:2,options:[b.value?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:V[2]||(V[2]=ae=>g.value=!1),onOption:_,"no-base-size":""},{default:te(()=>V[22]||(V[22]=[p("div",{class:"modal-scroll-area"},[p("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)])),_:1},8,["options"])):he("",!0)])),ie(o)==="done"?(j(),N("p",xC," Update is successfully downloaded. It will be installed once the application is closed. ")):he("",!0),ie(o)==="wait"?(j(),N("p",SC,"Checking for updates...")):he("",!0),typeof ie(o)=="number"?(j(),N("p",_C," Downloading update ("+Te(ie(o))+"%) ",1)):he("",!0),a.value?(j(),N("button",PC,"Applying...")):!u.value&&r.value?(j(),N("button",{key:4,onClick:V[3]||(V[3]=ae=>i.value=!0)}," Allow saving options ")):u.value&&r.value?(j(),N("button",{key:5,onClick:V[4]||(V[4]=ae=>l.value=!0)}," Deny saving options ")):he("",!0),p("button",{onClick:V[5]||(V[5]=ae=>g.value=!0),class:Le(r.value?"bt0":"")},[b.value?(j(),N(ce,{key:0},[Q(" Enter Classic Mode ")],64)):(j(),N(ce,{key:1},[Q(" Enter DDLC Plus Mode ")],64))],2),p("button",{class:"bt0",onClick:L,style:{height:"auto"}}," Open additional window "),w.value?(j(),pe(Ge,{key:6,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:P.value,"onUpdate:modelValue":V[6]||(V[6]=ae=>P.value=ae)},null,8,["modelValue"])):he("",!0),F(Ge,{label:"NSFW Mode?",modelValue:y.value,"onUpdate:modelValue":V[7]||(V[7]=ae=>y.value=ae)},null,8,["modelValue"]),F(Ge,{label:"Enlarge talking objects? (Default value)",modelValue:h.value,"onUpdate:modelValue":V[8]||(V[8]=ae=>h.value=ae)},null,8,["modelValue"]),F(Ge,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:v.value,"onUpdate:modelValue":V[9]||(V[9]=ae=>v.value=ae)},null,8,["modelValue"]),p("table",OC,[p("tbody",null,[p("tr",null,[V[24]||(V[24]=p("td",null,[p("label",null,"Theme:")],-1)),p("td",null,[Ie(p("select",{"onUpdate:modelValue":V[10]||(V[10]=ae=>f.value=ae),class:"v-w100"},V[23]||(V[23]=[p("option",{value:null},"System",-1),p("option",{value:!1},"Light",-1),p("option",{value:!0},"Dark",-1)]),512),[[Ct,f.value]])])])])]),C.value?(j(),N("table",IC,[p("tbody",null,[p("tr",null,[V[25]||(V[25]=p("td",null,[p("label",null,"Download folder:")],-1)),p("td",null,Te(T.value),1),p("td",null,[p("button",{onClick:$},"Set"),p("button",{onClick:m},"Open")])])])])):he("",!0),u.value?(j(),N(ce,{key:8},[p("button",{onClick:I},"Save as template"),x.value?(j(),N("button",{key:0,onClick:E}," Clear template ")):he("",!0)],64)):he("",!0)],512))}}),jC=Be(TC,[["__scopeId","data-v-b354944b"]]),$C=Oe({mixins:[Qk],inject:["viewport"],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.viewport.isVertical?"vertical":"horizontal":this.direction==="inverted"?this.viewport.isVertical?"horizontal":"vertical":this.direction}},render(){const t=this.noWraping?"no-wraping":"wraping",e=Su("div",{class:["d-flow",this.finalDirection,t],style:{gap:this.gap}},this.$slots.default());if(this.maxSize!==void 0){const n=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return Su("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:n}},[e])}return e},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}}),It=Be($C,[["__scopeId","data-v-2e09d3cd"]]),RC=["for"],AC=["id","x1","x2"],MC=["offset"],BC=["fill"],EC=["d"],DC=["id","max","value"],Rs=255,kl=8,LC=Oe({__name:"color-slider",props:Ln({label:{},gradientStops:{},maxValue:{},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=ys(t,"modelValue"),o=Qa(),s=_n(),r=q(null),i=D(()=>{const b=n.value/e.maxValue*Rs;return`M${b} 0L${b+14} 0L${b+7} 12Z`}),l=D(()=>!e.shiftGradient||n.value===0?0:n.value/e.maxValue);function a(b){n.value=parseFloat(b.target.value)}const u=q(!1);function c(b){u.value=!0,d(b),ss(b)&&(window.addEventListener("mousemove",d),window.addEventListener("mouseup",g)),b.preventDefault()}function d(b){if(!u.value)return;const _=r.value;if(ss(b)&&b.buttons===0){g();return}b.preventDefault();const w=_.getBoundingClientRect(),P=w.width/(kl+Rs+kl),h=((ss(b)?b.clientX:b.touches[0].clientX)-w.x)/P,v=Math.max(Math.min(h-kl,Rs),0)/Rs*e.maxValue;n.value=v,b.preventDefault()}function g(){u.value=!1,window.removeEventListener("mousemove",d),window.removeEventListener("mouseup",g)}return(b,_)=>(j(),N("div",{class:Le({slider:!0,vertical:ie(s)}),onKeydown:_[1]||(_[1]=fe(()=>{},["stop"]))},[b.noInput?he("",!0):(j(),N("label",{key:0,for:ie(o)},Te(b.label),9,RC)),p("div",null,[(j(),N("svg",{ref_key:"svg",ref:r,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:c,onTouchstart:c,onTouchmove:d,onTouchend:g},[p("defs",null,[p("linearGradient",{id:`gradient${ie(o)}`,x1:l.value*100+"%",y1:"0%",x2:(l.value+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(j(!0),N(ce,null,qe(b.gradientStops,(w,P)=>(j(),N("stop",{key:P,offset:P/(b.gradientStops.length-1)*100+"%",style:et("stop-color:"+w)},null,12,MC))),128))],8,AC)]),p("g",null,[p("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${ie(o)})`},null,8,BC),p("path",{d:i.value,"stroke-width":"2",class:"slider-pointer"},null,8,EC)])],544))]),b.noInput?he("",!0):(j(),N("input",{key:1,id:ie(o),class:"sliderInput",min:"0",max:b.maxValue,value:n.value,type:"number",onInput:a,onKeydown:_[0]||(_[0]=fe(()=>{},["stop"]))},null,40,DC))],34))}}),An=Be(LC,[["__scopeId","data-v-7d9ad553"]]),NC=Oe({__name:"slider-group",props:Ln({mode:{default:"hsla"},relative:{type:Boolean,default:!1}},{modelValue:{required:!0,validator:t=>!!t.match(/^#[0-9a-f]{6,8}$/i)},modelModifiers:{}}),emits:["update:modelValue"],setup(t){const e=t,n=ys(t,"modelValue"),o=q(null),s=q(0),r=q(0),i=q(0),l=q(0),a=P({rgba:{label:"Red",stops(){const y=e.relative?r.value:0,h=e.relative?i.value:0;return[new De(0,y,h,1),new De(255,y,h,1)]}},hsla:{label:"Hue",max:360,stops(){const y=e.relative?r.value/100:1,h=e.relative?i.value/100:.5;return w(v=>new He(v,y,h,1))}}}),u=P({rgba:{label:"Green",stops(){const y=e.relative?s.value:0,h=e.relative?i.value:0;return[new De(y,0,h,1),new De(y,255,h,1)]}},hsla:{label:"Saturation",stops(){const y=e.relative?s.value/360:0,h=e.relative?i.value/100:.5;return w(v=>new He(y,v,h,1))}}}),c=P({rgba:{label:"Blue",stops(){const y=e.relative?s.value:0,h=e.relative?r.value:0;return[new De(y,h,0,1),new De(y,h,255,1)]}},hsla:{label:"Luminosity",stops(){const y=e.relative?s.value/360:0,h=e.relative?r.value/100:.5;return w(v=>new He(y,h,v,1))}}}),d=D(()=>{const y=De.fromHex(n.value);return[new De(y.r,y.g,y.b,0).toCss(),new De(y.r,y.g,y.b,1).toCss()]});function g(){n.value!==o.value&&_()}function b(){let y;e.mode==="rgba"?y=new De(s.value,r.value,i.value,l.value/255):y=new He(s.value/360,r.value/100,i.value/100,l.value/255);const h=y.toRgb().toHex();if(o.value!==h){if(h.length!==9)throw new Error(`Invalid color code: ${h}`);o.value=h,n.value=h}}function _(){const y=De.fromHex(n.value);if(o.value=y.toHex(),l.value=y.a*255,e.mode==="hsla"){const h=y.toHSL();s.value=h.h*360,r.value=h.s*100,i.value=h.l*100}else s.value=y.r,r.value=y.g,i.value=y.b}function w(y){const h=[];for(let v=0;v<=8;++v)h.push(y(v/8));return h}Fe(()=>n.value,g),Fe(()=>e.mode,_,{immediate:!0}),Fe(()=>[s.value,r.value,i.value,l.value],b);function P({rgba:y,hsla:h}){const v=D(()=>e.mode==="rgba"?255:h.max??100),f=D(()=>e.mode==="rgba"?y.label:h.label),C=D(()=>(e.mode==="rgba"?y.stops():h.stops()).map($=>$.toRgb().toCss()));return{maxValue:v,label:f,stops:C}}return(y,h)=>(j(),N("div",null,[F(An,{label:ie(a).label.value,modelValue:s.value,"onUpdate:modelValue":h[0]||(h[0]=v=>s.value=v),"max-value":ie(a).maxValue.value,"gradient-stops":ie(a).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),F(An,{label:ie(u).label.value,modelValue:r.value,"onUpdate:modelValue":h[1]||(h[1]=v=>r.value=v),"max-value":ie(u).maxValue.value,"gradient-stops":ie(u).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),F(An,{label:ie(c).label.value,modelValue:i.value,"onUpdate:modelValue":h[2]||(h[2]=v=>i.value=v),"max-value":ie(c).maxValue.value,"gradient-stops":ie(c).stops.value},null,8,["label","modelValue","max-value","gradient-stops"]),F(An,{label:"Alpha",modelValue:l.value,"onUpdate:modelValue":h[3]||(h[3]=v=>l.value=v),"max-value":255,"gradient-stops":d.value},null,8,["modelValue","gradient-stops"])]))}}),FC=Be(NC,[["__scopeId","data-v-0d496402"]]),HC={class:"v-w100 h-h100"},VC={class:"hex-selector"},UC=["for"],WC=["id","value"],qC=["title","onClick"],Dd="dddg.generated.colors",zC=Oe({inheritAttrs:!1,__name:"color-picker",props:Ln({title:{default:""},format:{default:"hex"}},{modelValue:{required:!0},modelModifiers:{}}),emits:Ln(["leave"],["update:modelValue"]),setup(t,{emit:e}){const n=t,o=ys(t,"modelValue"),s=e,r=Xe(),i=Qa(),l=q("hsla"),a=_n(),u=D({get(){return n.format==="rgb"?De.fromCss(o.value).toHex():o.value},set(w){if(n.format==="rgb"){const P=De.fromCss(w);o.value=P.toCss()}else o.value=w}});function c(w){const P=w.target.value;De.validHex(P)&&(P.length===7||P.length===9)&&(u.value=P)}const d=D(()=>r.state.content.current.colors);function g(){if(d.value.find(y=>y.color===u.value))return;const w=r.state.content.contentPacks.find(y=>y.packId===Dd)||{packId:Dd,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},P={...w,colors:[...w.colors,{label:u.value,color:u.value}]};oe(async()=>{await r.dispatch("content/replaceContentPack",{contentPack:P,processed:!0})})}function b(){oe(()=>{r.commit("ui/setColorPicker",!0)})}function _(w){u.value=De.fromCss(w.color).toHex()}return Dt(()=>{$e.subscribe(tr,_)}),Sn(()=>{$e.unsubscribe(tr,_)}),(w,P)=>(j(),N("div",{class:Le([{color:!0,vertical:ie(a)},"v-w100 h-h100"])},[p("h2",null,Te(w.title),1),p("button",{onClick:P[0]||(P[0]=y=>s("leave"))},"OK"),p("table",null,[p("tbody",null,[p("tr",null,[p("td",null,[p("button",{onClick:P[1]||(P[1]=y=>l.value="hsla")},"HSLA")]),p("td",null,[p("button",{onClick:P[2]||(P[2]=y=>l.value="rgba")},"RGBA")])])])]),p("div",HC,[F(FC,{mode:l.value,modelValue:u.value,"onUpdate:modelValue":P[3]||(P[3]=y=>u.value=y),relative:!0},null,8,["mode","modelValue"]),p("div",VC,[p("label",{class:"hex-label",for:`hex_${ie(i)}`},"Hex",8,UC),p("input",{id:`hex_${ie(i)}`,value:u.value,onInput:c,onKeydown:P[4]||(P[4]=fe(()=>{},["stop"]))},null,40,WC)]),F(It,{direction:"global",class:"color-tools"},{default:te(()=>[p("button",{onClick:g},"Add as swatch"),F(Ae,{class:"h-bl0 v-bt0",icon:"colorize",onClick:b},{default:te(()=>P[5]||(P[5]=[Q("Pick color")])),_:1})]),_:1})]),p("div",{id:"color-swatches",class:Le({vertical:ie(a)})},[(j(!0),N(ce,null,qe(d.value,y=>(j(),N("button",{class:"swatch",key:y.color,style:et({backgroundColor:y.color}),title:y.label,onClick:h=>{u.value=y.color,s("leave")}},null,12,qC))),128))],2)],2))}}),Fr=Be(zC,[["__scopeId","data-v-9f67ecba"]]),GC={class:"fieldset_wrapper"},XC={key:0},YC={class:"fieldset_contents"},KC=Oe({__name:"d-fieldset",props:{title:{}},setup(t){const e=t;return(n,o)=>(j(),N("div",GC,[p("fieldset",null,[n.title>""?(j(),N("legend",XC,Te(e.title),1)):he("",!0),p("div",YC,[qt(n.$slots,"default",{},void 0,!0)])])]))}}),xt=Be(KC,[["__scopeId","data-v-bca80d0b"]]),JC={class:"column ok-col"},ZC={key:0,class:"column"},QC=["value"],ex=["disabled"],tx=["disabled"],nx=["disabled"],ox=["disabled"],sx=["onClick","onKeydown"],rx={key:0,class:"value-input-table"},ix=["value","max","min"],lx={key:0},ax={colspan:"2"},ux=["value","max","min"],cx={key:0},dx={colspan:"2"},fx=Oe({__name:"image-options",props:{type:{},id:{},panelId:{},noComposition:{type:Boolean}},emits:["leave"],setup(t,{emit:e}){const n=t,o=e,s=Xe(),r=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),i=(()=>{try{const A=Un();A.width=0,A.height=0;const R="filter"in A.getContext("2d");if(bo(A),R)return Array.from(r.keys()).sort()}catch{}return["opacity"]})(),l=q(""),a=q(0),u=D(()=>{switch(n.type){case"object":return s.state.panels.panels[n.panelId].objects[n.id];case"background":return s.state.panels.panels[n.panelId].background;case"panel":return s.state.panels.panels[n.panelId];default:throw new Mt.UnreachableCaseError(n.type)}}),c=D({get(){return u.value.composite},set(A){oe(()=>{switch(n.type){case"object":s.commit("panels/setComposition",{id:n.id,panelId:n.panelId,composite:A});break;case"background":break;case"panel":break;default:throw new Mt.UnreachableCaseError(n.type)}})}}),d=D(()=>u.value.filters),g=D(()=>d.value[a.value]??null),b=D(()=>{const A=g.value;return A==null?!1:Md.has(A.type)}),_=D(()=>{const A=g.value;if(A!=null){if(A.type==="hue-rotate")return 360;if(A.type==="grayscale"||A.type==="sepia"||A.type==="opacity"||A.type==="invert")return 100}}),w=D(()=>{const A=g.value;if(A!=null)switch(A.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}});function P(A){return r.get(A)}function y(A){return Md.has(A.type)?`${r.get(A.type)} ${(A.value*100).toFixed()}%`:A.type==="hue-rotate"?`${r.get(A.type)} ${A.value.toFixed()}`:A.type==="blur"?`${r.get(A.type)} ${A.value.toFixed()}px`:r.get(A.type)}function h(A){switch(n.type){case"object":return"panels/object_"+A;case"background":return"panels/background"+A[0].toUpperCase()+A.slice(1);case"panel":return"panels/"+A}}function v(){oe(async()=>{await s.dispatch(h("addFilter"),{id:n.id,panelId:n.panelId,type:l.value,idx:a.value+1})})}function f(A){a.value=A}function C(){oe(async()=>{await s.dispatch(h("removeFilter"),{id:n.id,panelId:n.panelId,idx:a.value}),a.value>=u.value.filters.length&&(a.value=u.value.filters.length-1)})}function T(A){oe(async()=>{await s.dispatch(h("moveFilter"),{id:n.id,panelId:n.panelId,idx:a.value,moveBy:A}),a.value+=A})}function $(A){let S=Number(A.target.value);b.value&&(S=S/100),m({value:S})}function m(A){oe(async()=>{await s.dispatch(h("setFilter"),{id:n.id,panelId:n.panelId,idx:a.value,...A})})}const x=D(()=>I(S=>new He(S,1,.5,1)).map(S=>S.toRgb().toCss()));function I(A){const S=[];for(let R=0;R<=8;++R)S.push(A(R/8));return S}const E=q(!1),L=ue("color"),H=ue("offsetX"),V=ue("offsetY"),ae=ue("blurRadius");function ue(A){return D({get(){const S=g.value;if(S==null||!(A in S))throw new Error("Tried reading shadow prop on a non shadow object");return S[A]},set(S){m({[A]:S})}})}return(A,S)=>E.value?(j(),pe(Fr,{key:0,modelValue:ie(L),"onUpdate:modelValue":S[0]||(S[0]=R=>ye(L)?L.value=R:null),format:"rgb",onLeave:S[1]||(S[1]=R=>E.value=!1)},null,8,["modelValue"])):(j(),pe(It,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:te(()=>[S[35]||(S[35]=p("h2",null,"Image options",-1)),p("div",JC,[p("button",{onClick:S[2]||(S[2]=R=>o("leave"))},"Back")]),A.noComposition?he("",!0):(j(),N("div",ZC,[S[26]||(S[26]=p("label",{for:"compositionSelect"},"Compositing Mode:",-1)),F(Ze,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:te(()=>S[24]||(S[24]=[Q("[?] ")])),_:1}),Ie(p("select",{id:"compositionSelect","onUpdate:modelValue":S[3]||(S[3]=R=>c.value=R),onKeydown:S[4]||(S[4]=fe(()=>{},["stop"]))},S[25]||(S[25]=[p("option",{value:"source-over"},"Normal",-1),p("option",{value:"source-atop"},"source-atop",-1),p("option",{value:"destination-over"},"destination-over",-1),p("option",{value:"destination-in"},"destination-in",-1),p("option",{value:"destination-in"},"destination-out",-1),p("option",{value:"destination-in"},"destination-atop",-1),p("option",{value:"lighter"},"lighter",-1),p("option",{value:"xor"},"xor",-1),p("option",{value:"multiply"},"multiply",-1),p("option",{value:"screen"},"screen",-1),p("option",{value:"overlay"},"overlay",-1),p("option",{value:"darken"},"darken",-1),p("option",{value:"lighten"},"lighten",-1),p("option",{value:"color-dodge"},"color-dodge",-1),p("option",{value:"color-burn"},"color-burn",-1),p("option",{value:"hard-light"},"hard-light",-1),p("option",{value:"soft-light"},"soft-light",-1),p("option",{value:"difference"},"difference",-1),p("option",{value:"exclusion"},"exclusion",-1),p("option",{value:"hue"},"hue",-1),p("option",{value:"saturation"},"saturation",-1),p("option",{value:"color"},"color",-1),p("option",{value:"luminosity"},"luminosity",-1)]),544),[[Ct,c.value]])])),F(xt,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:te(()=>[F(It,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:te(()=>[F(It,{direction:"vertical","no-wraping":""},{default:te(()=>[S[27]||(S[27]=p("label",{for:"addEffect"},"Add new effect",-1)),Ie(p("select",{id:"addEffect","onUpdate:modelValue":S[5]||(S[5]=R=>l.value=R),onKeydown:S[6]||(S[6]=fe(()=>{},["stop"]))},[(j(!0),N(ce,null,qe(ie(i),R=>(j(),N("option",{key:R,value:R},Te(P(R)),9,QC))),128))],544),[[Ct,l.value]]),p("button",{disabled:l.value==="",onClick:v,onKeydown:S[7]||(S[7]=fe(()=>{},["stop"]))}," Add ",40,ex),p("button",{disabled:!g.value,onClick:C,onKeydown:S[8]||(S[8]=fe(()=>{},["stop"]))}," Remove ",40,tx),p("button",{disabled:a.value===0,onClick:S[9]||(S[9]=R=>T(-1)),onKeydown:S[10]||(S[10]=fe(()=>{},["stop"]))}," Move up ",40,nx),p("button",{disabled:a.value===d.value.length-1||d.value.length===0,onClick:S[11]||(S[11]=R=>T(1)),onKeydown:S[12]||(S[12]=fe(()=>{},["stop"]))}," Move down ",40,ox)]),_:1}),F(It,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:te(()=>[(j(!0),N(ce,null,qe(d.value,(R,se)=>(j(),N("div",{key:se,class:Le({choiceBtn:!0,active:se===a.value}),tabindex:"0",onClick:U=>f(se),onKeydown:[ot(U=>f(se),["enter"]),ot(fe(U=>f(se),["prevent"]),["space"])]},Te(y(R)),43,sx))),128))]),_:1}),g.value?(j(),N("table",rx,[p("tbody",null,[g.value.type==="drop-shadow"?(j(),N(ce,{key:0},[p("tr",null,[S[28]||(S[28]=p("td",null,[p("label",{for:"shadow_color"},"Color:")],-1)),p("td",null,[p("button",{id:"shadow_color",class:"color-button",style:et({background:ie(L)}),onClick:S[13]||(S[13]=R=>E.value=!0)},"  ",4)])]),p("tr",null,[S[29]||(S[29]=p("td",null,[p("label",{for:"filter_x"},"X:")],-1)),p("td",null,[Ie(p("input",{id:"filter_x",type:"number","onUpdate:modelValue":S[14]||(S[14]=R=>ye(H)?H.value=R:null),onKeydown:S[15]||(S[15]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(H),void 0,{number:!0}]])])]),p("tr",null,[S[30]||(S[30]=p("td",null,[p("label",{for:"filter_y"},"Y:")],-1)),p("td",null,[Ie(p("input",{id:"filter_y",type:"number","onUpdate:modelValue":S[16]||(S[16]=R=>ye(V)?V.value=R:null),onKeydown:S[17]||(S[17]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(V),void 0,{number:!0}]])])]),p("tr",null,[S[31]||(S[31]=p("td",null,[p("label",{for:"filter_blur"},"Blur:")],-1)),p("td",null,[Ie(p("input",{id:"filter_blur",type:"number","onUpdate:modelValue":S[18]||(S[18]=R=>ye(ae)?ae.value=R:null),onKeydown:S[19]||(S[19]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(ae),void 0,{number:!0}]])])])],64)):b.value?(j(),N(ce,{key:1},[p("tr",null,[S[33]||(S[33]=p("td",null,[p("label",{for:"filter_value"},"Value:")],-1)),p("td",null,[p("input",{id:"filter_value",value:(g.value.value*100).toFixed(),type:"number",max:_.value,min:w.value,onInput:$,onKeydown:S[20]||(S[20]=fe(()=>{},["stop"]))},null,40,ix),S[32]||(S[32]=Q("% "))])]),w.value===0&&_.value!==void 0?(j(),N("tr",lx,[p("td",ax,[F(An,{gradientStops:["#000000","#ffffff"],label:"",maxValue:_.value,modelValue:g.value.value*100,"no-input":"","onUpdate:modelValue":S[21]||(S[21]=R=>m({value:Math.round(R)/100}))},null,8,["maxValue","modelValue"])])])):he("",!0)],64)):(j(),N(ce,{key:2},[p("tr",null,[S[34]||(S[34]=p("td",null,[p("label",{for:"filter_value"},"Value:")],-1)),p("td",null,[p("input",{id:"filter_value",value:g.value.value,type:"number",max:_.value,min:w.value,onInput:$,onKeydown:S[22]||(S[22]=fe(()=>{},["stop"]))},null,40,ux)])]),w.value===0&&_.value!==void 0?(j(),N("tr",cx,[p("td",dx,[F(An,{gradientStops:x.value,label:"",maxValue:_.value,modelValue:g.value.value,"no-input":"","onUpdate:modelValue":S[23]||(S[23]=R=>m({value:Math.round(R)}))},null,8,["gradientStops","maxValue","modelValue"]),F(An,{gradientStops:x.value,label:"",maxValue:_.value,modelValue:g.value.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):he("",!0)],64))])])):he("",!0)]),_:1})]),_:1})]),_:1}))}}),eu=Be(fx,[["__scopeId","data-v-09730914"]]),px=["title"],hx=["title"],gx=Oe({__name:"bg-button",props:{backgroundId:{}},setup(t){const e=t,n=Xe(),o=St(),s=D(()=>{const b=o.value.currentPanel;return n.state.panels.panels[b].background}),r=q(null),i=D(()=>{Object.keys(n.state.uploadUrls);const b=l.value;if(!b)return null;for(const _ of b.variants)for(const w of _){const P=mn(w,!1);if(P.startsWith("uploads:"))return Object.keys(n.state.uploadUrls),P.substring(8)}return null}),l=D(()=>n.getters["content/getBackgrounds"].get(e.backgroundId)||null),a=D(()=>e.backgroundId===s.value.current),u=D(()=>{switch(e.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return l.value.label??""}),c=D(()=>{var w;switch(e.backgroundId){case"buildin.static-color":return{"background-color":s.value.color};case"buildin.transparent":return{}}let b=!1;const _=(w=l.value)==null?void 0:w.variants[0].map(P=>{const y=mn(P,!1);return y.startsWith("uploads:")&&(b=!0),`url('${y}')`}).join(",");return b&&Object.keys(n.state.uploadUrls),{backgroundImage:_??""}});function d(){r.value.click()}async function g(){const b=r.value,_=i.value;if(!b.files)return;if(b.files.length!==1){console.error("More than one file uploaded!");return}const w=b.files[0];await oe(async()=>{const P=URL.createObjectURL(w);await n.dispatch("uploadUrls/add",{name:_,url:P})})}return(b,_)=>i.value!==null?(j(),N("div",{key:0,class:Le({background:!0,active:a.value}),title:u.value,style:et(c.value),tabindex:"0",onClick:_[0]||(_[0]=w=>d()),onKeypress:[_[1]||(_[1]=ot(fe(w=>d(),["prevent","stop"]),["enter"])),_[2]||(_[2]=ot(fe(w=>d(),["prevent","stop"]),["space"]))]},[Q(Te(u.value)+" ",1),p("input",{type:"file",style:{display:"none"},ref_key:"missingBackgroundUpload",ref:r,onChange:g},null,544)],46,px)):(j(),N("div",{key:1,class:Le({background:!0,active:a.value}),title:u.value,style:et(c.value),tabindex:"0",onClick:_[3]||(_[3]=w=>b.$emit("input",b.backgroundId)),onKeydown:[_[4]||(_[4]=ot(w=>b.$emit("input",b.backgroundId),["enter"])),_[5]||(_[5]=ot(fe(w=>b.$emit("input",b.backgroundId),["prevent"]),["space"]))]},Te(u.value),47,hx))}}),vx=Be(gx,[["__scopeId","data-v-a2d503da"]]),bx={key:1},mx={colspan:"3"},yx={key:0},wx={class:"arrow-col"},kx={class:"arrow-col"},Cx={colspan:"3"},xx={colspan:"3"},Sx=Oe({__name:"bg-settings",emits:["open-image-options","change-color"],setup(t,{emit:e}){const n=e,o=Xe(),s=St(),r=_n(),i=D(()=>{const P=s.value.currentPanel;return o.state.panels.panels[P].background}),l=D({get(){return i.value.flipped},set(P){oe(()=>{o.commit("panels/setBackgroundFlipped",{flipped:P,panelId:s.value.currentPanel})})}}),a=D({get(){return i.value.scaling.toString()},set(P){oe(()=>{o.commit("panels/setBackgroundScaling",{scaling:parseInt(P,10),panelId:s.value.currentPanel})})}}),u=D(()=>i.value.current),c=D(()=>o.state.content.current.backgrounds.find(P=>P.id===u.value)||null),d=D(()=>u.value==="buildin.static-color"),g=D({get(){return i.value.color},set(P){oe(()=>{o.commit("panels/setBackgroundColor",{color:P,panelId:s.value.currentPanel})})}}),b=D(()=>!!c.value),_=D(()=>c.value?c.value.variants.length>1:!1);function w(P){oe(async()=>{await o.dispatch("panels/seekBackgroundVariant",{delta:P,panelId:s.value.currentPanel})})}return(P,y)=>(j(),pe(xt,{class:Le({"bg-settings":!0,vertical:ie(r)}),title:"Settings:"},{default:te(()=>[d.value?(j(),N(ce,{key:0},[y[7]||(y[7]=p("label",{for:"bg_color"},"Color:",-1)),p("button",{id:"bg_color",class:"color-button",style:et({background:g.value}),onClick:y[0]||(y[0]=h=>n("change-color"))},null,4)],64)):he("",!0),b.value?(j(),N("table",bx,[p("tbody",null,[p("tr",null,[p("td",mx,[F(Ge,{modelValue:l.value,"onUpdate:modelValue":y[1]||(y[1]=h=>l.value=h),label:"Flipped?"},null,8,["modelValue"])])]),_.value?(j(),N("tr",yx,[p("td",wx,[p("button",{class:"small-button",onClick:y[2]||(y[2]=h=>w(-1))}," < ")]),y[8]||(y[8]=p("td",{style:{"text-align":"center"}},"Variant",-1)),p("td",kx,[p("button",{class:"small-button",onClick:y[3]||(y[3]=h=>w(1))}," > ")])])):he("",!0),p("tr",null,[p("td",Cx,[Ie(p("select",{"onUpdate:modelValue":y[4]||(y[4]=h=>a.value=h),onKeydown:y[5]||(y[5]=fe(()=>{},["stop"]))},y[9]||(y[9]=[p("option",{value:"0"},"None",-1),p("option",{value:"1"},"Stretch",-1),p("option",{value:"2"},"Cover",-1)]),544),[[Ct,a.value]])])]),p("tr",null,[p("td",xx,[p("button",{id:"image_options_button",class:"v-w100",onClick:y[6]||(y[6]=h=>n("open-image-options"))}," Image options ")])])])])):he("",!0)]),_:1},8,["class"]))}}),_x=Be(Sx,[["__scopeId","data-v-adecbe80"]]),Px=Oe({__name:"backgrounds-tool",setup(t){const e=Xe(),n={packId:"dddg.uploads.backgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},o=q(null);$t(o);const s=St(),r=q(!1),i=q(!1),l=D({get(){return e.state.panels.panels[s.value.currentPanel].background.color},set(v){oe(()=>{e.commit("panels/setBackgroundColor",{color:v,panelId:s.value.currentPanel})})}}),a=D(()=>[...e.state.content.current.backgrounds.map(v=>v.id),"buildin.static-color","buildin.transparent"]),u=D(()=>ge.supports.openableFolders.has("backgrounds"));function c(v){e.commit("panels/setCurrentBackground",{current:v,panelId:s.value.currentPanel})}function d(){ge.openFolder("backgrounds")}const g=q(null);function b(){const v=g.value;if(v.files)for(const f of v.files)_(f)}async function _(v){await oe(async()=>{const f=URL.createObjectURL(v),C=await e.dispatch("uploadUrls/add",{name:v.name,url:f});await P(v.name,v.name,C)})}function w(){const v=prompt("Enter the URL of the image");if(v==null)return;const f=v.split("/").slice(-1)[0];P(f,f,v)}async function P(v,f,C){const T=e.state.content.contentPacks.find(m=>m.packId===n.packId)||n,$={...T,backgrounds:[...T.backgrounds,{id:v,label:f,variants:[[{hq:C,lq:C,sourcePack:n.packId}]],scaling:"none"}]};await oe(async()=>{await e.dispatch("content/replaceContentPack",{contentPack:$,processed:!0}),c(v)})}const y=q(null);function h(v){v.dataTransfer&&(v.dataTransfer.effectAllowed="none",Array.from(v.dataTransfer.items).find(f=>f.type.match(/^image.*$/))&&(v.dataTransfer.effectAllowed="link",y.value.show()))}return(v,f)=>(j(),N("div",{class:"panel",ref_key:"root",ref:o,onDragenter:h,onMouseleave:f[7]||(f[7]=C=>y.value.hide())},[F(Mh,{ref_key:"dt",ref:y,class:"drop-target",onDrop:_},{default:te(()=>f[8]||(f[8]=[Q("Drop here to add as a new background ")])),_:1},512),f[13]||(f[13]=p("h1",null,"Background",-1)),r.value?(j(),pe(Fr,{key:0,modelValue:l.value,"onUpdate:modelValue":f[0]||(f[0]=C=>l.value=C),onLeave:f[1]||(f[1]=C=>r.value=!1)},null,8,["modelValue"])):i.value?(j(),pe(eu,{key:1,type:"background",title:"","panel-id":ie(s).currentPanel,"no-composition":"",onLeave:f[2]||(f[2]=C=>i.value=!1)},null,8,["panel-id"])):(j(),N(ce,{key:2},[F(_x,{onChangeColor:f[3]||(f[3]=C=>r.value=!0),onOpenImageOptions:f[4]||(f[4]=C=>i.value=!0)}),F(Ae,{icon:"upload",class:"upload-background",onClick:f[5]||(f[5]=C=>g.value.click())},{default:te(()=>[f[9]||(f[9]=Q(" Upload ")),p("input",{type:"file",ref_key:"upload",ref:g,onChange:b,multiple:""},null,544)]),_:1}),F(Ae,{icon:"link",class:"upload-background",onClick:w},{default:te(()=>f[10]||(f[10]=[Q(" Add by URL ")])),_:1}),F(Ae,{icon:"extension",class:"upload-background",onClick:f[6]||(f[6]=C=>v.$emit("show-dialog","type: Backgrounds"))},{default:te(()=>f[11]||(f[11]=[Q(" Search in content packs ")])),_:1}),u.value?(j(),pe(Ae,{key:0,icon:"folder",class:"upload-background",onClick:d},{default:te(()=>f[12]||(f[12]=[Q(" Open backgrounds folder ")])),_:1})):he("",!0),(j(!0),N(ce,null,qe(a.value,C=>(j(),pe(vx,{key:C,backgroundId:C,onInput:T=>c(C)},null,8,["backgroundId","onInput"]))),128))],64))],544))}}),Ox=Be(Px,[["__scopeId","data-v-0cd7183b"]]);function tu(t,e,n,o,s){return D({get(){return e.value[s]},set(r){oe(()=>{t.commit(n,{panelId:e.value.panelId,id:e.value.id,key:s,value:r})})}})}function Co(t,e,n,o,s){return D({get(){return e.value[s]},set(r){oe(()=>{t[o?"dispatch":"commit"](n,{panelId:e.value.panelId,id:e.value.id,[s]:r})})}})}const Ix=["onKeydown"],Ld=960,Tx=Oe({__name:"part-button",props:{part:{},size:{default:150}},emits:["click","quick-click"],setup(t,{emit:e}){const n=t,o=e,s=q([]),r=D(()=>n.size/n.part.size[0]),i=D(()=>n.size/n.part.size[1]),l=D(()=>`${Math.floor(Ld*r.value)}px ${Math.floor(Ld*i.value)}px`),a=D(()=>{let g="";const b=l.value,_=n.part.offset??[0,0],w=n.part.images.length-1;for(let P=0;P<=w;++P){const y=n.part.images[w-P],h=s.value[w-P];if(!h)continue;P>0&&(g+=", ");const v=y.offset??[0,0],f=`${Math.floor((_[0]-v[0])*-r.value)}px ${Math.floor((_[1]-v[1])*-i.value)}px`;g+=`url('${h.replace("'","\\'")}') ${f} / ${b}`}return g}),u=D(()=>({height:n.size+"px",width:n.size+"px",background:a.value}));function c(g){g.preventDefault(),o("quick-click")}async function d(){s.value=await Promise.all(n.part.images.map(g=>typeof g.asset=="string"?Pm(g.asset,!1):mn(g.asset,!1)))}return ko("Initialization of parts button",d),(g,b)=>{var _;return j(),N("div",{class:Le({part:!0,active:(_=g.part)==null?void 0:_.active}),style:et(u.value),tabindex:"0",onClick:b[0]||(b[0]=w=>o("click")),onContextmenu:c,onKeydown:[b[1]||(b[1]=ot(fe(w=>o("click"),["prevent"]),["enter"])),ot(fe(c,["prevent"]),["space"])]},null,46,Ix)}}}),Nd=Be(Tx,[["__scopeId","data-v-a09133e4"]]),jx=Oe({__name:"part-selection",props:{character:{},part:{}},emits:["leave","show-dialog","show-expression-dialog"],setup(t,{emit:e}){const n=t,o=e,s=Xe(),r=q(null),i=q([]),l=D(()=>{switch(n.part){case"head":return"Expressions";case"style":return"Styles";default:return"Poses"}}),a=D(()=>Br(s,n.character)),u=D(()=>{if(n.part!=="style")return[];const h=a.value.styleGroups[n.character.styleGroupId];return h.styleComponents.map(v=>{const f={};for(const C in v.variants){if(!v.variants.hasOwnProperty(C))continue;const T=v.variants[C];f[C]={size:h.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:T}],active:!1}}return{label:v.label,name:v.id,buttons:f}})}),c=D(()=>{const h={};let v,f,C;const T=a.value,$=yo(T,n.character);switch(n.part){case"head":{const x=n.character.posePositions.headType||0,I=n.character.posePositions.head||0;for(let E=0;E<$.compatibleHeads.length;++E){const L=$.compatibleHeads[E],H=T.heads[L];for(let V=0;V<H.variants.length;++V){const ae=H.variants[V];h[`${E}_${V}`]={size:H.previewSize,offset:H.previewOffset,images:ae.map(ue=>({asset:ue,offset:[0,0]})),active:I===V&&x===E}}}return h}case"pose":const m=T.styleGroups[n.character.styleGroupId].styles[n.character.styleId];for(let x=0;x<m.poses.length;++x){const I=m.poses[x],E=g(I);h[x]=E,E.active=x===n.character.poseId}return h;case"style":for(let x=0;x<T.styleGroups.length;++x){const I=T.styleGroups[x],E=g(I.styles[0].poses[0]);h[I.id]=E,E.active=x===n.character.styleGroupId}return h;default:v=$.positions[n.part],C=$.previewSize,f=$.previewOffset;break}for(let m=0;m<v.length;++m){const x=v[m];h[m]={images:x.map(I=>({offset:[0,0],asset:I})),size:C,offset:f,active:m===(n.character.posePositions[n.part]||0)}}return h});function d(){const h=a.value.styleGroups[n.character.styleGroupId].styles[n.character.styleId];i.value=Object.keys(h.components).map(v=>[v,h.components[v]])}function g(h){const v=a.value;let f=[];for(const C of h.renderCommands)switch(C.type){case"pose-part":const T=h.positions[C.part];if(T==null||T.length===0)break;f=f.concat(T[0].map($=>({asset:$,offset:C.offset})));break;case"head":{const $=v.heads[h.compatibleHeads[0]];if(h.compatibleHeads.length===0)break;const m=$.variants[0];f=f.concat(m.map(x=>({asset:x,offset:C.offset})));break}case"image":f=f.concat(C.images.map($=>({asset:$,offset:C.offset})));break}return{images:f,size:h.previewSize,offset:h.previewOffset,active:!1}}function b(h){h==null&&(h=n.character.styleGroupId);const f=a.value.styleGroups[h];let C=f.styles;for(const T of i.value){const $=C.filter(m=>m.components[T[0]]===T[1]);$.length>0&&(C=$)}oe(async()=>{await s.dispatch("panels/setCharStyle",{id:n.character.id,panelId:n.character.panelId,styleGroupId:h,styleId:f.styles.indexOf(C[0])})})}function _(h){if(n.part==="style")b(a.value.styleGroups.findIndex(v=>v.id===h));else if(n.part==="head"){const[v,f]=(""+h).split("_",2).map(C=>parseInt(C,10));s.commit("panels/setPosePosition",{id:n.character.id,panelId:n.character.panelId,posePositions:{headType:v,head:f}})}else y(n.part,parseInt(""+h,10))}function w(h,v){const f=i.value.findIndex(C=>C[0]===h);i.value.splice(f,1),i.value.unshift([h,""+v]),b()}function P(h){(h.key==="Backspace"||h.key==="Escape")&&(o("leave"),h.preventDefault(),h.stopPropagation())}function y(h,v){oe(async()=>{await s.dispatch("panels/setPart",{id:n.character.id,panelId:n.character.panelId,part:h,val:v})})}return ko("Initializing parts data",async()=>{r.value=await go()}),Fe(()=>n.character,d,{immediate:!0}),(h,v)=>(j(),pe(It,{"no-wraping":"",onKeydown:P},{default:te(()=>[p("button",{onClick:v[0]||(v[0]=f=>o("leave")),class:"h-h100"},"Back"),F(It,{direction:"vertical",class:"parts-fnc-btns"},{default:te(()=>[F(Ae,{icon:"extension",class:"h-bl0 v-w100 v-bt0",onClick:v[1]||(v[1]=f=>o("show-dialog",`type: ${l.value} character: ${a.value.label}`))},{default:te(()=>v[3]||(v[3]=[Q(" Search in content packs ")])),_:1}),h.part==="head"?(j(),pe(Ae,{key:0,icon:"extension",class:"h-bl0 h-bt0 v-w100 v-bt0",onClick:v[2]||(v[2]=f=>o("show-expression-dialog",{character:h.character.characterType}))},{default:te(()=>v[4]||(v[4]=[Q(" Create new expressions ")])),_:1})):he("",!0)]),_:1}),(j(!0),N(ce,null,qe(c.value,(f,C)=>(j(),pe(Nd,{key:C,value:C,part:f,onClick:T=>{_(C),o("leave")},onQuickClick:T=>_(C)},null,8,["value","part","onClick","onQuickClick"]))),128)),(j(!0),N(ce,null,qe(u.value,f=>(j(),pe(xt,{key:f.name,title:f.label,class:"h-h100"},{default:te(()=>[F(It,{noWraping:""},{default:te(()=>[(j(!0),N(ce,null,qe(f.buttons,(C,T)=>(j(),pe(Nd,{size:130,key:T,value:T,part:C,onClick:$=>w(f.name,T)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1}))}}),$x=Be(jx,[["__scopeId","data-v-74360b18"]]),Rx=Oe({__name:"delete-btn",props:{obj:{}},setup(t){const e=t,n=Xe();function o(){oe(async()=>{await n.dispatch("panels/removeObject",{panelId:e.obj.panelId,id:e.obj.id})})}return(s,r)=>(j(),N("button",{onClick:o},"Delete"))}}),Ax=Oe({__name:"layer-btns",props:{object:{}},setup(t){const e=t,n=Xe(),o=Co(n,D(()=>e.object),"panels/setOnTop",!0,"onTop");function s(r){oe(async()=>{await n.dispatch("panels/shiftLayer",{id:e.object.id,panelId:e.object.panelId,delta:r})})}return(r,i)=>(j(),pe(xt,{id:"layerfs",title:"Layer:"},{default:te(()=>[F(It,{class:"layer_flow",direction:"horizontal"},{default:te(()=>[F(Ae,{icon:"vertical_align_bottom","icon-pos":"top",onClick:i[0]||(i[0]=l=>s(-1/0)),title:"Move to back"}),F(Ae,{icon:"arrow_downward","icon-pos":"top",onClick:i[1]||(i[1]=l=>s(-1)),title:"Move backwards"}),F(Ae,{icon:"arrow_upward","icon-pos":"top",onClick:i[2]||(i[2]=l=>s(1)),title:"Move forwards"}),F(Ae,{icon:"vertical_align_top","icon-pos":"top",onClick:i[3]||(i[3]=l=>s(1/0)),title:"Move to front"})]),_:1}),F(Ge,{modelValue:ie(o),"onUpdate:modelValue":i[4]||(i[4]=l=>ye(o)?o.value=l:null),label:"In front?"},null,8,["modelValue"])]),_:1}))}}),Mx=Be(Ax,[["__scopeId","data-v-3566ce89"]]),Bx={class:"v-w100"},Ex={colspan:"2"},Dx={key:0},Lx={colspan:"2"},Nx={class:"v-w100 button-tbl"},Fx={class:"arrow-col"},Hx=["disabled"],Vx=["value"],Ux={class:"arrow-col"},Wx=["disabled"],qx={class:"v-w50"},zx={class:"v-w50"},Gx={class:"v-w50"},Xx={class:"v-w50"},Yx=Oe({__name:"position-and-size",props:{obj:{}},setup(t){const e=t,n=Xe(),o=D({get(){const w=de().TextBox;return e.obj.height-(i.value?w.NameboxHeight:0)},set(w){const P=de().TextBox;oe(()=>{n.commit("panels/setSize",{id:e.obj.id,panelId:e.obj.panelId,height:w+(i.value?P.NameboxHeight:0),width:e.obj.width})})}}),s=D({get(){return e.obj.width},set(w){oe(()=>{n.commit("panels/setSize",{id:e.obj.id,panelId:e.obj.panelId,height:e.obj.height,width:w})})}}),r=D(()=>{const w=e.obj;if(w.type==="textBox")return os[w.style].resizable;const P=de().Poem;return w.type==="poem"?P.poemBackgrounds[w.background].file.startsWith("internal:"):!1}),i=D(()=>e.obj.type==="textBox"&&location.search.includes("alex")),l=D(()=>"freeMove"in e.obj),a=D(()=>de().Base.positions),u=D(()=>d.value===0),c=D(()=>d.value===de().Base.positions.length-1),d=D({get(){return ar(e.obj.x)},set(w){oe(async()=>{await n.dispatch("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:de().Base.characterPositions[w],y:e.obj.y})})}}),g=D({get(){return!!e.obj.freeMove},set(w){oe(()=>{n.commit("panels/setFreeMove",{id:e.obj.id,panelId:e.obj.panelId,freeMove:w})})}}),b=D({get(){return e.obj.x},set(w){oe(()=>{n.commit("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:w,y:_.value})})}}),_=D({get(){return e.obj.y},set(w){oe(()=>{n.commit("panels/setPosition",{id:e.obj.id,panelId:e.obj.panelId,x:b.value,y:w})})}});return(w,P)=>(j(),pe(xt,{title:"Position"+(r.value?"/Size":"")},{default:te(()=>[p("table",Bx,[p("tbody",null,[p("tr",null,[p("td",Ex,[l.value?(j(),pe(Ge,{key:0,modelValue:g.value,"onUpdate:modelValue":P[0]||(P[0]=y=>g.value=y),label:"Move freely?"},null,8,["modelValue"])):he("",!0)])]),l.value&&!g.value?(j(),N("tr",Dx,[p("td",Lx,[p("table",Nx,[p("tbody",null,[p("tr",null,[p("td",Fx,[p("button",{onClick:P[1]||(P[1]=y=>--d.value),disabled:u.value}," < ",8,Hx)]),p("td",null,[Ie(p("select",{id:"current_talking",class:"v-w100",style:{"text-align":"center"},"onUpdate:modelValue":P[2]||(P[2]=y=>d.value=y)},[(j(!0),N(ce,null,qe(a.value,(y,h)=>(j(),N("option",{key:h,value:h},Te(y),9,Vx))),128))],512),[[Ct,d.value,void 0,{number:!0}]])]),p("td",Ux,[p("button",{onClick:P[3]||(P[3]=y=>++d.value),disabled:c.value}," > ",8,Wx)])])])])])])):(j(),N(ce,{key:1},[p("tr",null,[P[12]||(P[12]=p("td",{class:"v-w50"},[p("label",{for:"sprite_x"},"X:")],-1)),p("td",qx,[Ie(p("input",{id:"sprite_x",class:"w100",type:"number","onUpdate:modelValue":P[4]||(P[4]=y=>b.value=y),onKeydown:P[5]||(P[5]=fe(()=>{},["stop"]))},null,544),[[Ke,b.value,void 0,{number:!0}]])])]),p("tr",null,[P[13]||(P[13]=p("td",{class:"v-w50"},[p("label",{for:"sprite_y"},"Y:")],-1)),p("td",zx,[Ie(p("input",{class:"w100",id:"sprite_y",type:"number","onUpdate:modelValue":P[6]||(P[6]=y=>_.value=y),onKeydown:P[7]||(P[7]=fe(()=>{},["stop"]))},null,544),[[Ke,_.value,void 0,{number:!0}]])])])],64)),r.value?(j(),N(ce,{key:2},[p("tr",null,[P[14]||(P[14]=p("td",{class:"v-w50"},[p("label",{for:"sprite_w"},"Width:")],-1)),p("td",Gx,[Ie(p("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":P[8]||(P[8]=y=>s.value=y),onKeydown:P[9]||(P[9]=fe(()=>{},["stop"]))},null,544),[[Ke,s.value,void 0,{number:!0}]])])]),p("tr",null,[P[15]||(P[15]=p("td",{class:"v-w50"},[p("label",{for:"sprite_h"},"Height:")],-1)),p("td",Xx,[Ie(p("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":P[10]||(P[10]=y=>o.value=y),onKeydown:P[11]||(P[11]=fe(()=>{},["stop"]))},null,544),[[Ke,o.value,void 0,{number:!0}]])])])],64)):he("",!0)])])]),_:1},8,["title"]))}}),Kx=Be(Yx,[["__scopeId","data-v-9caf201c"]]),Jx={class:"column ok-col"},Zx={class:"column"},Qx=["value"],eS={key:0,class:"column error-col"},tS={class:"column"},nS={class:"column"},oS={class:"column"},sS={class:"column"},rS=Oe({inheritAttrs:!1,__name:"text-formatting",props:Ln({title:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:Ln(["leave"],["update:modelValue"]),setup(t,{emit:e}){const n=ys(t,"modelValue"),o=e,s=q(null),r=q(""),i=q(""),l=q("#000000"),a=q(""),u=q(0),c=q(0),d=q(""),g=_n();Fe(()=>g.value,()=>{const h=s.value;h!=null&&(h.style.height="",h.style.width="")}),Fe(()=>i.value,()=>{i.value!==""&&(y("font",i.value),i.value="")}),Fe(()=>a.value,()=>{if(a.value==="")return;const h=s.value,v=h==null?void 0:h.selectionStart,f=h==null?void 0:h.selectionEnd;h&&(h.selectionEnd=h.selectionStart);const C=`{align=${a.value}}`;P(C),h&&(h.selectionStart=v+C.length,h.selectionEnd=f+C.length),a.value=""});function b(){const h=de(),v=s.value.value;try{new jt(v,h.TextBox.NameboxTextStyle),d.value=""}catch(f){d.value=f.message}n.value=v}function _(h){const v=s.value;r.value=h,u.value=v.selectionStart,c.value=v.selectionEnd}function w(){const h=l.value,v=r.value,f=()=>{const C=s.value;if(C==null){tn(f);return}C.selectionStart=u.value,C.selectionEnd=c.value,y(v==="text"?"color":"outlinecolor",h)};tn(f),l.value="#000000",r.value=""}function P(h){const v=s.value,f=v.value,C=v.selectionStart,T=v.selectionEnd;v.value=f.slice(0,C)+h+f.slice(T),v.selectionStart=v.selectionEnd=C+h.length,v.focus(),b()}function y(h,v){const f=s.value,C=f.value,T=f.selectionStart,$=f.selectionEnd,m=C.slice(T,$),x=C.slice(0,T),I=C.slice($);let E=h;v!=null&&(E+="="+v),f.value=`${x}{${E}}${m}{/${h}}${I}`,f.selectionStart=T+E.length+2,f.selectionEnd=f.selectionStart+m.length,f.focus(),b()}return(h,v)=>r.value?(j(),pe(Fr,{key:0,modelValue:l.value,"onUpdate:modelValue":v[0]||(v[0]=f=>l.value=f),onLeave:w},null,8,["modelValue"])):(j(),N("div",{key:1,class:Le({"text-subpanel":!0,vertical:ie(g)})},[p("h2",null,Te(h.title),1),p("div",Jx,[p("button",{onClick:v[1]||(v[1]=f=>o("leave"))},"OK")]),p("div",Zx,[p("textarea",{class:"v-w100",ref_key:"textArea",ref:s,value:n.value,onInput:b,onKeydown:v[2]||(v[2]=fe(()=>{},["stop"])),onKeypress:v[3]||(v[3]=fe(()=>{},["stop"]))},null,40,Qx)]),d.value?(j(),N("div",eS,Te(d.value),1)):he("",!0),p("div",tS,[p("button",{onClick:v[4]||(v[4]=f=>P("\\\\")),class:"style-button"}," Insert \\ "),p("button",{onClick:v[5]||(v[5]=f=>P("\\{")),class:"style-button"}," Insert { "),p("button",{onClick:v[6]||(v[6]=f=>P("\\}")),class:"style-button"}," Insert } ")]),v[20]||(v[20]=p("p",{class:"hint-col"},"Apply style to selected text:",-1)),p("div",nS,[p("button",{onClick:v[7]||(v[7]=f=>y("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),p("button",{onClick:v[8]||(v[8]=f=>y("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),p("button",{onClick:v[9]||(v[9]=f=>y("plain")),class:"style-button"}," Plain "),p("button",{onClick:v[10]||(v[10]=f=>y("edited")),class:"style-button edited-style"}," Edited "),p("button",{onClick:v[11]||(v[11]=f=>y("k",2)),class:"style-button",style:{"letter-spacing":"5px","padding-right":"0"}}," Kerning ")]),p("div",oS,[p("button",{onClick:v[12]||(v[12]=f=>y("alpha",.5)),class:"style-button"}," Alpha ")]),p("div",sS,[p("button",{onClick:v[13]||(v[13]=f=>y("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),Ie(p("select",{"onUpdate:modelValue":v[14]||(v[14]=f=>i.value=f),class:"style-button"},v[18]||(v[18]=[Tv('<option value data-v-e10386b2>Font</option><option value="aller" style="font-family:aller;" data-v-e10386b2> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-e10386b2> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-e10386b2> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-e10386b2> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-e10386b2> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-e10386b2> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-e10386b2> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-e10386b2> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-e10386b2> Halogen (MC) </option>',10)]),512),[[Ct,i.value]]),Ie(p("select",{"onUpdate:modelValue":v[15]||(v[15]=f=>a.value=f),class:"style-button"},v[19]||(v[19]=[p("option",{value:""},"Alignment",-1),p("option",{value:"left",style:{"text-align":"left"}},"Left",-1),p("option",{value:"right",style:{"text-align":"right"}},"Right",-1),p("option",{value:"center",style:{"text-align":"center"}}," Center ",-1)]),512),[[Ct,a.value]]),p("button",{onClick:v[16]||(v[16]=f=>_("text")),class:"style-button"}," Text color "),p("button",{onClick:v[17]||(v[17]=f=>_("outline")),class:"style-button"}," Outline color ")])],2))}}),iS=Be(rS,[["__scopeId","data-v-e10386b2"]]),lS={class:"modal-text"},aS=["value"],uS={class:"input-table v-w100"},cS={for:"zoom",class:"v-w100"},dS={key:0},fS={key:0,colspan:"2"},pS={key:0},hS=["placeholder"],gS=Oe({__name:"object-tool",props:{object:{},title:{},textHandler:{},colorHandler:{},showAltPanel:{type:Boolean,default:!1}},setup(t){const e=t,n=Xe(),o=q(null),s=(A,S)=>Co(n,D(()=>e.object),S,!1,A);$t(o);const r=St(),i=D({get(){return e.object.linkedTo??""},set(A){const S=e.object,R=A===""?null:A,se=wo(n,r.value),U=se==null?void 0:se.getLastRenderObject(S.id),ne=R===null?se==null?void 0:se.getLastRenderObject(S.linkedTo):se==null?void 0:se.getLastRenderObject(R);try{if(!U||!ne)n.commit("panels/setLink",{panelId:w.value.id,id:S.id,link:R,x:S.x,y:S.y,scaleX:S.scaleX,scaleY:S.scaleY,skewX:S.skewX,skewY:S.skewY,rotation:S.rotation});else if(R==null)n.commit("panels/setLink",{panelId:w.value.id,id:S.id,link:R,...dr(U.preparedTransform)});else{const Se=ne.preparedTransform.inverse().multiply(U.preparedTransform);console.log(U.preparedTransform),console.log(ne.preparedTransform.multiply(Se)),console.log(Se),n.commit("panels/setLink",{panelId:w.value.id,id:S.id,link:R,...dr(Se)})}}catch(we){we instanceof Error?$e.fire(new Nn(we.message)):$e.fire(new Nn(""+we))}}}),l=q(!1),a=q(""),u=q(!1),c=q(null),d=s("flip","panels/setFlip"),g=s("rotation","panels/setRotation"),b=s("enlargeWhenTalking","panels/setEnlargeWhenTalking"),_=D(()=>Tk(e.object)),w=D(()=>n.state.panels.panels[e.object.panelId]),P=D(()=>{const A=w.value,S=[];for(const R of[...A.order,...A.onTopOrder]){const se=A.objects[R];se.label===null||se===e.object||S.push([R,se.label])}return S}),y=location.search.includes("alex"),h=D({get(){return e.object.preserveRatio},set(A){oe(async()=>{await n.dispatch("panels/setPreserveRatio",{id:e.object.id,panelId:e.object.panelId,preserveRatio:A})})}}),v=D({get(){const A=e.object.nameboxWidth;return A===null?"":A},set(A){const S=typeof A=="string"&&A.trim()===""?null:parseInt(A+"");oe(()=>{n.commit("panels/setObjectNameboxWidth",{id:e.object.id,panelId:e.object.panelId,nameboxWidth:S})})}}),f=D({get(){return e.object.scaleX*100},set(A){oe(()=>{n.commit("panels/setObjectScale",{id:e.object.id,panelId:e.object.panelId,scaleX:A/100,scaleY:e.object.preserveRatio?A/100*e.object.ratio:e.object.scaleY})})}}),C=D({get(){return e.object.scaleY*100},set(A){oe(()=>{n.commit("panels/setObjectScale",{id:e.object.id,panelId:e.object.panelId,scaleX:e.object.preserveRatio?A/100/e.object.ratio:e.object.scaleX,scaleY:A/100})})}}),T=D({get(){return e.object.skewX},set(A){oe(()=>{n.commit("panels/setObjectSkew",{id:e.object.id,panelId:e.object.panelId,skewX:A,skewY:e.object.skewY})})}}),$=D({get(){return e.object.skewY},set(A){oe(()=>{n.commit("panels/setObjectSkew",{id:e.object.id,panelId:e.object.panelId,skewX:e.object.skewX,skewY:A})})}}),m=D(()=>de().TextBox.NameboxWidth),x=D(()=>c.value||e.colorHandler||null),I=D(()=>e.object.label!==null),E=D(()=>e.object.label??e.title??"Object"),L=D({get(){return e.object.textboxColor!==null},set(A){oe(()=>{n.commit("panels/setTextboxColor",{panelId:e.object.panelId,id:e.object.id,textboxColor:A?de().TextBoxCustom.textboxDefaultColor:null})})}});function H(){oe(async()=>{await n.dispatch("panels/copyObjectToClipboard",{panelId:e.object.panelId,id:e.object.id})})}function V(){a.value=e.object.label??"",u.value=!0}function ae(A){u.value=!1,A==="Apply"&&oe(()=>{n.commit("panels/setLabel",{panelId:e.object.panelId,id:e.object.id,label:a.value})})}function ue(){c.value={title:"Textbox color",get:()=>e.object.textboxColor,set:A=>{oe(()=>{n.commit("panels/setTextboxColor",{panelId:e.object.panelId,id:e.object.id,textboxColor:A})})},leave:()=>{c.value=null}}}return(A,S)=>(j(),N("div",{class:"panel",ref_key:"root",ref:o},[p("h1",{style:et({fontStyle:I.value?"italic":"normal"}),onClick:V},[Q(Te(E.value)+" ",1),S[26]||(S[26]=p("span",{class:"icon material-icons"},"edit",-1))],4),(j(),pe(xf,{to:"#modal-messages"},[u.value?(j(),pe(ao,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:ae,onLeave:S[2]||(S[2]=R=>ae("Cancel"))},{default:te(()=>[S[27]||(S[27]=p("p",{class:"modal-text"},"Enter the new name",-1)),p("p",lS,[Ie(p("input",{"onUpdate:modelValue":S[0]||(S[0]=R=>a.value=R),style:{width:"100%"},onKeydown:S[1]||(S[1]=ot(fe(R=>ae("Apply"),["prevent","stop"]),["enter"]))},null,544),[[Ke,a.value]])])]),_:1})):he("",!0)])),A.textHandler?(j(),pe(iS,{key:0,title:A.textHandler.title,modelValue:A.textHandler.get(),"onUpdate:modelValue":S[3]||(S[3]=R=>A.textHandler.set(R)),onLeave:S[4]||(S[4]=R=>A.textHandler.leave())},null,8,["title","modelValue"])):x.value?(j(),pe(Fr,{key:1,title:x.value.title,modelValue:x.value.get(),"onUpdate:modelValue":S[5]||(S[5]=R=>x.value.set(R)),onLeave:S[6]||(S[6]=R=>x.value.leave())},null,8,["title","modelValue"])):l.value?(j(),pe(eu,{key:2,type:"object","panel-id":A.object.panelId,id:A.object.id,onLeave:S[7]||(S[7]=R=>l.value=!1)},null,8,["panel-id","id"])):A.showAltPanel?qt(A.$slots,"alt-panel",{key:3},void 0,!0):(j(),N(ce,{key:4},[qt(A.$slots,"default",{},void 0,!0),F(Kx,{obj:A.object},null,8,["obj"]),F(Mx,{object:A.object},null,8,["object"]),F(xt,{title:"Transform",class:"transforms"},{default:te(()=>[F(Ge,{modelValue:ie(d),"onUpdate:modelValue":S[8]||(S[8]=R=>ye(d)?d.value=R:null),label:"Flip?"},null,8,["modelValue"]),S[33]||(S[33]=p("label",{for:"linked_to",class:"v-w100"},"Linked with:",-1)),Ie(p("select",{id:"linked_to",class:"v-w100","onUpdate:modelValue":S[9]||(S[9]=R=>i.value=R),onKeydown:S[10]||(S[10]=fe(()=>{},["stop"]))},[S[28]||(S[28]=p("option",{value:""},"None",-1)),(j(!0),N(ce,null,qe(P.value,([R,se])=>(j(),N("option",{key:R,value:R},Te(se),9,aS))),128))],544),[[Ct,i.value]]),p("table",uS,[p("tbody",null,[p("tr",null,[S[29]||(S[29]=p("td",null,[p("label",{for:"rotation",class:"v-w100"},"Rotation:")],-1)),p("td",null,[Ie(p("input",{id:"rotation",class:"smol v-w100",type:"number","onUpdate:modelValue":S[11]||(S[11]=R=>ye(g)?g.value=R:null),onKeydown:S[12]||(S[12]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(g)]])])]),_.value?(j(),N(ce,{key:0},[p("tr",null,[p("td",null,[p("label",cS,Te(ie(y)?"Zoom":"Scale X"),1)]),p("td",null,[Ie(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1",min:"0","onUpdate:modelValue":S[13]||(S[13]=R=>f.value=R),onKeydown:S[14]||(S[14]=fe(()=>{},["stop"]))},null,544),[[Ke,f.value]])])]),ie(y)?he("",!0):(j(),N("tr",dS,[S[30]||(S[30]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Scale Y: ")],-1)),p("td",null,[Ie(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1",min:"0","onUpdate:modelValue":S[15]||(S[15]=R=>C.value=R),onKeydown:S[16]||(S[16]=fe(()=>{},["stop"]))},null,544),[[Ke,C.value]])])]))],64)):he("",!0),p("tr",null,[S[31]||(S[31]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Skew X: ")],-1)),p("td",null,[Ie(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1","onUpdate:modelValue":S[17]||(S[17]=R=>T.value=R),onKeydown:S[18]||(S[18]=fe(()=>{},["stop"]))},null,544),[[Ke,T.value]])])]),p("tr",null,[S[32]||(S[32]=p("td",null,[p("label",{for:"zoom",class:"v-w100"},"Skew Y: ")],-1)),p("td",null,[Ie(p("input",{id:"zoom",type:"number",class:"smol v-w100",step:"1","onUpdate:modelValue":S[19]||(S[19]=R=>$.value=R),onKeydown:S[20]||(S[20]=fe(()=>{},["stop"]))},null,544),[[Ke,$.value]])])]),p("tr",null,[ie(y)?he("",!0):(j(),N("td",fS,[F(Ge,{modelValue:h.value,"onUpdate:modelValue":S[21]||(S[21]=R=>h.value=R),label:"Lock scale ratio?"},null,8,["modelValue"])]))])])]),qt(A.$slots,"transform",{},void 0,!0)]),_:3}),qt(A.$slots,"options",{},void 0,!0),I.value?(j(),pe(xt,{key:0,title:"Textbox settings"},{default:te(()=>[A.object.type==="character"||A.object.type==="sprite"?(j(),pe(Ge,{key:0,label:"Enlarge when talking",modelValue:ie(b),"onUpdate:modelValue":S[22]||(S[22]=R=>ye(b)?b.value=R:null)},null,8,["modelValue"])):he("",!0),F(Ge,{label:"Own textbox color",modelValue:L.value,"onUpdate:modelValue":S[23]||(S[23]=R=>L.value=R)},null,8,["modelValue"]),p("table",null,[p("tbody",null,[L.value?(j(),N("tr",pS,[S[34]||(S[34]=p("td",null,[p("label",{for:"textbox_color"},"Color:")],-1)),p("td",null,[p("button",{id:"textbox_color",class:"color-button",style:et({background:A.object.textboxColor??""}),onClick:ue},null,4)])])):he("",!0),p("tr",null,[S[35]||(S[35]=p("td",null,[p("label",{for:"namebox_width"},"Namebox width:")],-1)),p("td",null,[Ie(p("input",{id:"namebox_width",type:"number",placeholder:m.value+"","onUpdate:modelValue":S[24]||(S[24]=R=>v.value=R)},null,8,hS),[[Ke,v.value,void 0,{lazy:!0}]])])])])])]),_:1})):he("",!0),p("button",{onClick:S[25]||(S[25]=R=>l.value=!0)},"Image options"),p("button",{class:"v-bt0",onClick:H},"Copy"),F(Rx,{class:"v-bt0",obj:A.object},null,8,["obj"])],64))],512))}}),jo=Be(gS,[["__scopeId","data-v-b8af1274"]]),vS={class:"warning"},bS={style:{"word-wrap":"break-word"}},mS={class:"button-tbl"},yS={key:0},wS={class:"arrow-col"},kS={class:"arrow-col"},CS={key:1},xS={class:"arrow-col"},SS={class:"arrow-col"},_S={class:"arrow-col"},PS=["onClick"],OS=["onClick"],IS={class:"arrow-col"},TS=["onClick"],jS=Oe({__name:"character-tool",emits:["show-dialog","show-expression-dialog"],setup(t,{emit:e}){const n=e,o=Xe(),s=q(null),r=q(null);$t(s);const i=q(null),l=kt("viewport"),a=D(()=>o.state.panels.panels[l.value.currentPanel]),u=D(()=>l.value.selection),c=D(()=>{const m=a.value.objects[u.value];if(m.type==="character")return m}),d=Co(o,c,"panels/setClose",!1,"close"),g=D(()=>{const m=c.value,x=lr(b.value,m);if(!x)return null;for(const I of x.variants){const E=mn(I[0],!1);if(E.startsWith("uploads:"))return E.substring(8)}return null}),b=D(()=>Br(o,c.value)),_=D(()=>b.value.label??""),w=D(()=>d0(b.value,c.value)),P=D(()=>b.value.styleGroups[c.value.styleGroupId].styles.length>1||b.value.styleGroups.length>1),y=D(()=>b.value.styleGroups[c.value.styleGroupId].styles[c.value.styleId].poses.length>1);function h(){r.value.click()}async function v(){const m=r.value;if(!m.files)return;if(m.files.length!==1){console.error("More than one file uploaded!");return}const x=m.files[0];await oe(async()=>{const I=URL.createObjectURL(x);await o.dispatch("uploadUrls/add",{name:g.value,url:I})})}function f(m){oe(async()=>{await o.dispatch("panels/seekPose",{id:c.value.id,panelId:c.value.panelId,delta:m})})}function C(m){oe(async()=>{await o.dispatch("panels/seekStyle",{id:c.value.id,panelId:c.value.panelId,delta:m})})}function T(m,x){oe(async()=>{await o.dispatch("panels/seekPart",{id:c.value.id,panelId:c.value.panelId,delta:x,part:m})})}function $(m){return m.charAt(0).toUpperCase()+m.substring(1)}return Fe(()=>u.value,()=>{i.value=null}),(m,x)=>(j(),pe(jo,{ref_key:"root",ref:s,object:c.value,title:_.value,showAltPanel:!!i.value},{"alt-panel":te(()=>[i.value?(j(),pe($x,{key:0,character:c.value,part:i.value,onLeave:x[0]||(x[0]=I=>i.value=null),onShowDialog:x[1]||(x[1]=I=>n("show-dialog",I)),onShowExpressionDialog:x[2]||(x[2]=I=>n("show-expression-dialog",I))},null,8,["character","part"])):he("",!0)]),default:te(()=>[g.value?(j(),N(ce,{key:0},[p("p",vS,[x[11]||(x[11]=Q(" MISSING Head sprite! Click below to re-upload ")),p("span",bS,'"'+Te(g.value)+'"',1),x[12]||(x[12]=Q(". "))]),p("button",{onClick:x[3]||(x[3]=I=>h())},"Re-Upload"),p("input",{type:"file",ref_key:"missingHeadUpload",ref:r,onChange:v},null,544)],64)):he("",!0),y.value||w.value.length>0||P.value?(j(),pe(xt,{key:1,class:"pose-list",title:"Pose:"},{default:te(()=>[p("table",mS,[p("tbody",null,[P.value?(j(),N("tr",yS,[p("td",wS,[p("button",{onClick:x[4]||(x[4]=I=>C(-1))},"<")]),p("td",null,[p("button",{class:"middle-button",onClick:x[5]||(x[5]=I=>i.value="style")}," Style ")]),p("td",kS,[p("button",{onClick:x[6]||(x[6]=I=>C(1))},">")])])):he("",!0),y.value?(j(),N("tr",CS,[p("td",xS,[p("button",{onClick:x[7]||(x[7]=I=>f(-1))},"<")]),p("td",null,[p("button",{class:"middle-button",onClick:x[8]||(x[8]=I=>i.value="pose")}," Pose ")]),p("td",SS,[p("button",{onClick:x[9]||(x[9]=I=>f(1))},">")])])):he("",!0),(j(!0),N(ce,null,qe(w.value,I=>(j(),N("tr",{key:I},[p("td",_S,[p("button",{onClick:E=>T(I,-1)}," < ",8,PS)]),p("td",null,[p("button",{class:"middle-button",onClick:E=>i.value=I},Te($(I)),9,OS)]),p("td",IS,[p("button",{onClick:E=>T(I,1)},">",8,TS)])]))),128))])])]),_:1})):he("",!0)]),transform:te(()=>[F(Ge,{modelValue:ie(d),"onUpdate:modelValue":x[10]||(x[10]=I=>ye(d)?d.value=I:null),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"]))}}),$S=Be(jS,[["__scopeId","data-v-cad6aa22"]]),RS=["onClick"],AS=Oe({__name:"choice-tool",setup(t){const e=Xe(),n=q(null),o=kt("viewport");$t(n);const s=D(()=>e.state.panels.panels[o.value.currentPanel]),r=D(()=>{const y=s.value.objects[o.value.selection];if(y.type==="choice")return y}),i=(y,h)=>Co(e,r,h,!1,y),l=q(0),a=q(!1),u=i("autoWrap","panels/setAutoWrapping"),c=P("text"),d=D(()=>r.value.choices),g=D(()=>{if(a.value)return{title:"Text",get:()=>c.value,set:y=>{c.value=y},leave:()=>{a.value=!1}}});function b(y){l.value=y}function _(){oe(async()=>{await e.dispatch("panels/addChoice",{id:r.value.id,panelId:r.value.panelId,text:""})})}function w(){oe(async()=>{l.value===r.value.choices.length-1&&l.value>0&&b(l.value-1),await e.dispatch("panels/removeChoice",{id:r.value.id,panelId:r.value.panelId,choiceIdx:l.value})})}function P(y){return D({get(){return r.value.choices[l.value][y]},set(h){oe(()=>{e.commit("panels/setChoiceProperty",{id:r.value.id,panelId:r.value.panelId,choiceIdx:l.value,key:y,value:h})})}})}return(y,h)=>(j(),pe(jo,{ref_key:"root",ref:n,object:r.value,title:"Choice",textHandler:g.value},{default:te(()=>[F(xt,{class:"buttons",title:"Buttons:"},{default:te(()=>[F(It,{maxSize:"100%",direction:"vertical",noWraping:""},{default:te(()=>[(j(!0),N(ce,null,qe(d.value,(v,f)=>(j(),N("div",{class:Le({choiceBtn:!0,active:f===l.value}),key:f,onClick:C=>b(f)},Te(v.text.trim()===""?"[Empty]":v.text),11,RS))),128))]),_:1})]),_:1}),F(xt,{class:"current_button",title:"Current button:"},{default:te(()=>[p("table",null,[p("tbody",null,[h[4]||(h[4]=p("tr",null,[p("td",{colspan:"2"},[p("label",{for:"choice-button-input"},"Text")])],-1)),p("tr",null,[p("td",null,[Ie(p("input",{id:"choice-button-input","onUpdate:modelValue":h[0]||(h[0]=v=>ye(c)?c.value=v:null),onKeydown:h[1]||(h[1]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(c)]])]),p("td",null,[p("button",{onClick:h[2]||(h[2]=v=>a.value=!0)},"...")])])])])]),_:1}),p("button",{onClick:_},"Add"),p("button",{onClick:w},"Remove"),F(Ge,{label:"Auto line wrap?",modelValue:ie(u),"onUpdate:modelValue":h[3]||(h[3]=v=>ye(u)?u.value=v:null)},null,8,["modelValue"])]),_:1},8,["object","textHandler"]))}}),MS=Be(AS,[["__scopeId","data-v-0d027da8"]]),BS={id:"notification_text_wrapper"},ES=Oe({__name:"notification-tool",setup(t){const e=Xe(),n=q(null);$t(n);const o=kt("viewport"),s=D(()=>e.state.panels.panels[o.value.currentPanel]),r=D(()=>{const d=s.value.objects[o.value.selection];if(d.type==="notification")return d}),i=d=>tu(e,r,"panels/setNotificationProperty",!1,d),l=i("text"),a=i("backdrop"),u=q(!1),c=D(()=>{if(u.value)return{title:"Text",get:()=>l.value,set:d=>{l.value=d},leave:()=>{u.value=!1}}});return(d,g)=>(j(),pe(jo,{ref_key:"root",ref:n,object:r.value,title:"Notification",textHandler:c.value},{default:te(()=>[p("div",BS,[g[4]||(g[4]=p("label",{for:"notification_text"},"Text:",-1)),Ie(p("textarea",{"onUpdate:modelValue":g[0]||(g[0]=b=>ye(l)?l.value=b:null),id:"notification_text",onKeydown:g[1]||(g[1]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(l)]]),p("button",{onClick:g[2]||(g[2]=b=>u.value=!0)},"Formatting")])]),options:te(()=>[F(Ge,{modelValue:ie(a),"onUpdate:modelValue":g[3]||(g[3]=b=>ye(a)?a.value=b:null),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"]))}}),DS=Be(ES,[["__scopeId","data-v-8cdbb737"]]),LS=["onClick","onKeydown"],NS={class:"panel_text"},FS={class:"panel_nr"},HS={class:"column"},VS={class:"v-w100"},US={colspan:"2"},WS={key:0,value:"image/webp"},qS={key:1,value:"image/heif"},zS={key:0},GS={for:"export_ppi"},XS={key:0},YS={for:"export_pages"},KS={key:0},JS={colspan:"2"},ZS={class:"column"},QS=100,e_=90,Fd=70,Hd=1/4,t_=.5,n_=Oe({__name:"panels-tool",setup(t){const e=Xe(),n=q(null),{vertical:o,getRoot:s}=$t(n),r=q(ge.supports.limitedCanvasSpace?10:0),i=q(""),l=q("image/png"),a=q(e_),u=q(!1),c=q(!1),d=q(null),g=de().Base,b=D(()=>e.state.panels.panels[ne.value.currentPanel]),_=D(()=>l.value!=="image/png"),w=D(()=>C.value.length>1);function P(Y){return Y===""}const y=q(!1),h=q(!1);Promise.allSettled([go(),xm()]).then(([Y,W])=>{Y.status==="fulfilled"&&(y.value=Y.value),W.status==="fulfilled"&&(h.value=W.value)});const v=D(()=>e.state.panels.panelOrder.indexOf(b.value.id)>0),f=D(()=>{const Y=e.state.panels.panelOrder;return Y.indexOf(b.value.id)<Y.length-1}),C=D(()=>e.state.panels.panelOrder.map(W=>{const k=e.state.panels.panels[W],O=e.state.panels.panels[W],M=[...O.order,...O.onTopOrder].map(z=>e.state.panels.panels[W].objects[z]).map(T);return{id:W,image:k.lastRender,text:M.reduce((z,G)=>z.length>G.length?z:G,"")}}));function T(Y){switch(Y.type){case"textBox":return Y.text;case"notification":return Y.text;case"poem":return Y.text;case"choice":return Y.choices.map(W=>`[${W.text}]`).join(`
`)}return""}function $(){const Y=s().querySelector(".panel_button.active");Y!=null&&m(Y)}function m(Y){const W=Y.parentElement.parentElement;o.value?(W.scrollTop=Y.offsetTop-W.clientHeight/2,W.scrollLeft=0):(W.scrollLeft=Y.offsetLeft-W.clientWidth/2,W.scrollTop=0)}Dt(()=>{$()});function x(){const Y=new Date;return`cd-${[Y.getFullYear(),`${Y.getMonth()+1}`.padStart(2,"0"),`${Y.getDate()}`.padStart(2,"0"),`${Y.getHours()}`.padStart(2,"0"),`${Y.getMinutes()}`.padStart(2,"0"),`${Y.getSeconds()}`.padStart(2,"0")].join("-")}`}async function I(){await ko("export image",async()=>{const Y=H(),W=l.value.split("/")[1],k=l.value,O=a.value,M=u.value,z=x();await E(Y,!0,M,async(G,X)=>{await ge.saveToFile(X,`${z}_${G}.${W}`,k,O/QS)})})}async function E(Y,W,k,O){const M=de().Base,z=[],G=k?M.screenWidth:0,X=k?0:M.screenHeight;for(let re=0;re<Y.length;++re){const ee=Y[re],Z=document.createElement("canvas");Z.width=k?M.screenWidth*ee.length:M.screenWidth,Z.height=k?M.screenHeight:M.screenHeight*ee.length;try{const J=Z.getContext("2d");for(let me=0;me<ee.length;++me){const le=ee[me],be=new gs(e,le,M.screenWidth,M.screenHeight);try{await be.render(W,!1,!0),be.paintOnto(J,{x:G*me,y:X*me,w:M.screenWidth,h:M.screenHeight})}finally{be.dispose()}}z.push(await O(re,Z))}finally{bo(Z)}}return z}function L(){const Y=e.state.panels.panelOrder.length-1,W=0,k=i.value.split(","),O=[];let M=!1;for(const z of k){const G=z.trim(),X=G.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!X){G!==""&&$e.fire(new Ot(`Could not read '${z}' in the page list.`));continue}if(M=!0,X[2])O.push(parseInt(X[2],10)-1);else{const re=Math.max(parseInt(X[3],10)-1,W),ee=Math.min(parseInt(X[4],10)-1,Y);if(re==null||ee==null||re>ee)continue;for(let Z=re;Z<=ee;++Z)O.push(Z)}}return M?O.sort((z,G)=>z-G).filter((z,G,X)=>X[G-1]!==z).map(z=>e.state.panels.panelOrder[z]):e.state.panels.panelOrder}function H(){const Y=L();if(isNaN(r.value)&&(r.value=0),r.value===0)return[Y];const W=[];for(let k=0;k<Y.length/r.value;++k){const O=k*r.value,M=O+r.value;W.push(Y.slice(O,M))}return W}async function V(){await oe(async()=>{await e.dispatch("panels/duplicatePanel",{panelId:ne.value.currentPanel}),ne.value.currentPanel=e.state.panels.lastPanelId}),await tn(),$()}function ae(Y){oe(()=>{ne.value.currentPanel=Y}),tn(()=>{$()})}function ue(){oe(async()=>{await e.dispatch("panels/delete",{panelId:ne.value.currentPanel})}),tn(()=>{$()})}function A(){oe(async()=>{await e.dispatch("panels/move",{panelId:b.value.id,delta:-1})})}function S(){oe(async()=>{await e.dispatch("panels/move",{panelId:b.value.id,delta:1})})}const R=Un();R.width=g.screenWidth*Hd,R.height=g.screenHeight*Hd;const se=R.getContext("2d"),U=q(!1),ne=St(),we=D(()=>e.state.panels.panelOrder.filter(W=>e.state.panels.panels[W].lastRender==null));async function Se(){const Y=wo(e,ne.value);Y&&await _e(Y)}async function _e(Y){await ko("render thumbnail",async()=>{const W=Y.panelId;Y.paintOnto(se,{x:0,y:0,w:se.canvas.width,h:se.canvas.height}),se.canvas.toBlob(k=>{if(!k)return;const O=URL.createObjectURL(k);oe(()=>{e.commit("panels/setPanelPreview",{panelId:W,url:O})})},await go()?"image/webp":"image/jpeg",t_)})}async function Ye(){const Y=de().Base;if(!U.value||ge.supports.limitedCanvasSpace)return;const W=we.value;if(W.length===0)return;const k=W[0],O=new gs(e,k,Y.screenWidth,Y.screenHeight);await O.render(!1,!1,!0),await _e(O),setTimeout(()=>{Ye()},500)}Dt(()=>{U.value=!0,requestAnimationFrame(()=>Se().catch(()=>{}))}),Sn(()=>{U.value=!1,bo(se.canvas)}),$e.subscribe(Qs,()=>requestAnimationFrame(Se));async function K(){const Y=await e.dispatch("getSave",!0),W=new Blob([Y],{type:"text/plain"}),k=new Date,O=`save-${[k.getFullYear(),`${k.getMonth()+1}`.padStart(2,"0"),`${k.getDate()}`.padStart(2,"0"),`${k.getHours()}`.padStart(2,"0"),`${k.getMinutes()}`.padStart(2,"0"),`${k.getSeconds()}`.padStart(2,"0")].join("-")}`;ge.storeSaveFile(W,`${O}.dddg`)}async function Ce(){await oe(async()=>{const Y=d.value;if(!Y.files)return;$e.fire(new er);const W=await Pe(Y.files[0]);await e.dispatch("loadSave",W),ge.supports.limitedCanvasSpace&&$e.fire(new Ot("To prevent running out of memory, thumbnails will not be automatically restored in the background."))}),await Se(),setTimeout(()=>{Ye()},1e3)}function Pe(Y){return new Promise((W,k)=>{const O=new FileReader;O.onload=function(){W(O.result)},O.onerror=function(M){k(M)},O.readAsText(Y)})}return Fe(()=>a.value,(Y,W)=>{if(Y===100){$e.fire(new Ot("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(W>Fd&&Y<=Fd){$e.fire(new Ot("Note: A quality level below 70% might be very noticeable and impair legibility of text."));return}}),Fe(()=>r.value,(Y,W)=>{if(ge.supports.limitedCanvasSpace&&(W<=10&&Y>10||Y===0&&C.value.length>10)){$e.fire(new Ot("Note: Safari has strict limitations on available memory. More images per panel can easily cause crashes."));return}}),(Y,W)=>(j(),N("div",{class:"panel",ref_key:"root",ref:n},[W[28]||(W[28]=p("h1",null,"Panels",-1)),c.value?(j(),pe(eu,{key:0,type:"panel",title:"","panel-id":b.value.id,"no-composition":"",onLeave:W[0]||(W[0]=k=>{c.value=!1,Se()})},null,8,["panel-id"])):(j(),N(ce,{key:1},[F(xt,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:te(()=>[F(It,{"no-wraping":"",maxSize:"350px"},{default:te(()=>[(j(!0),N(ce,null,qe(C.value,(k,O)=>(j(),N("div",{key:k.id,class:Le({panel_button:!0,active:k.id===b.value.id}),style:et(`background-image: url('${k.image}')`),tabindex:"0",onClick:M=>ae(k.id),onKeydown:[ot(M=>ae(k.id),["enter"]),ot(fe(M=>ae(k.id),["prevent"]),["space"])]},[p("div",NS,[p("p",null,Te(k.text),1)]),p("div",FS,Te(O+1),1)],46,LS))),128))]),_:1})]),_:1}),p("div",HS,[F(Ae,{icon:"add_to_queue",onClick:V},{default:te(()=>W[11]||(W[11]=[Q(" Add new")])),_:1}),F(Ae,{icon:"remove_from_queue",class:"bt0",onClick:ue,disabled:!w.value},{default:te(()=>W[12]||(W[12]=[Q(" Delete panel ")])),_:1},8,["disabled"]),F(Ae,{icon:"arrow_upward",class:"bt0",onClick:A,disabled:!v.value},{default:te(()=>W[13]||(W[13]=[Q(" Move ahead ")])),_:1},8,["disabled"]),F(Ae,{icon:"arrow_downward",class:"bt0",onClick:S,disabled:!f.value},{default:te(()=>W[14]||(W[14]=[Q(" Move behind ")])),_:1},8,["disabled"]),F(Ae,{class:"bt0",icon:"color_lens",onClick:W[1]||(W[1]=k=>c.value=!0)},{default:te(()=>W[15]||(W[15]=[Q(" Image options ")])),_:1})]),F(xt,{title:"Export",class:"h-h100 export_settings"},{default:te(()=>[p("table",VS,[p("tbody",null,[p("tr",null,[p("td",US,[F(Ae,{icon:"photo_camera",class:"w100",onClick:I},{default:te(()=>W[16]||(W[16]=[Q(" Download ")])),_:1})])]),p("tr",null,[W[20]||(W[20]=p("td",null,[p("label",{for:"export_format"},"Format")],-1)),p("td",null,[Ie(p("select",{id:"export_format","onUpdate:modelValue":W[2]||(W[2]=k=>l.value=k)},[W[17]||(W[17]=p("option",{value:"image/png"}," PNG (lossless) ",-1)),y.value?(j(),N("option",WS," WebP (lossy) ")):he("",!0),h.value?(j(),N("option",qS," HEIF (lossy) ")):he("",!0),W[18]||(W[18]=p("option",{value:"image/jpeg"}," JPEG (lossy) ",-1)),W[19]||(W[19]=p("option",{value:"image/jpeg"}," WebM (lossy, video) ",-1))],512),[[Ct,l.value]])])]),_.value?(j(),N("tr",zS,[W[21]||(W[21]=p("td",null,[p("label",{for:"export_quality"},"Quality:")],-1)),p("td",null,[Ie(p("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":W[3]||(W[3]=k=>a.value=k),onKeydown:W[4]||(W[4]=fe(()=>{},["stop"]))},null,544),[[Ke,a.value,void 0,{number:!0}]])])])):he("",!0),p("tr",null,[p("td",null,[p("label",GS,[W[23]||(W[23]=Q(" Panels per image: ")),!_.value||ie(o)?(j(),N("small",XS,W[22]||(W[22]=[p("br",null,null,-1),Q("(0 for one single image)")]))):he("",!0)])]),p("td",null,[Ie(p("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":W[5]||(W[5]=k=>r.value=k),onKeydown:W[6]||(W[6]=fe(()=>{},["stop"])),onBlur:W[7]||(W[7]=k=>{P(r.value)&&(r.value=0)})},null,544),[[Ke,r.value,void 0,{number:!0}]])])]),p("tr",null,[p("td",null,[p("label",YS,[W[25]||(W[25]=Q(" Panels to export: ")),!_.value||ie(o)?(j(),N("small",KS,W[24]||(W[24]=[p("br",null,null,-1),Q("(Leave empty for all)")]))):he("",!0)])]),p("td",null,[Ie(p("input",{id:"export_pages","onUpdate:modelValue":W[8]||(W[8]=k=>i.value=k),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[Ke,i.value]])])]),p("tr",null,[p("td",JS,[F(Ge,{modelValue:u.value,"onUpdate:modelValue":W[9]||(W[9]=k=>u.value=k),label:"Horizontal arrangement?",title:"Order panels side by side instead of top to bottom"},null,8,["modelValue"])])])])])]),_:1}),p("div",ZS,[F(Ae,{icon:"save",onClick:K},{default:te(()=>W[26]||(W[26]=[Q("Save")])),_:1}),F(Ae,{class:"bt0",icon:"folder_open",onClick:W[10]||(W[10]=k=>d.value.click())},{default:te(()=>[W[27]||(W[27]=Q(" Load ")),p("input",{type:"file",ref_key:"loadUpload",ref:d,onChange:Ce},null,544)]),_:1})])],64))],512))}}),o_=Be(n_,[["__scopeId","data-v-efe27cbc"]]),s_={id:"poem_text",class:"v-w100"},r_=["value"],i_=["value"],l_={key:1},a_={class:"v-w100"},u_=Oe({__name:"poem-tool",setup(t){const e=Xe(),n=q(null),o=q(null),{vertical:s}=$t(n),r=q(!1),i=q("");Fe(()=>s.value,()=>{o.value.style.height="",o.value.style.width=""});const l=kt("viewport"),a=D(()=>e.state.panels.panels[l.value.currentPanel]),u=D(()=>{const h=a.value.objects[l.value.selection];if(h.type==="poem")return h}),c=h=>tu(e,u,"panels/setPoemProperty",!1,h),d=D(()=>{if(r.value)return{title:"Text",get:()=>b.value,set:h=>{b.value=h},leave:()=>{r.value=!1}}}),g=D(()=>{if(i.value)return{title:"Color",get:()=>{switch(i.value){case"":return"#000000";case"base":return u.value.consoleColor;default:throw new Mt.UnreachableCaseError(i.value)}},set:h=>{oe(()=>{const v=a.value.id,f=u.value.id;h!==void 0&&e.commit("panels/setPoemProperty",{key:"consoleColor",panelId:v,id:f,value:h})})},leave:()=>{i.value=""}}}),b=c("text"),_=c("autoWrap"),w=c("font"),P=c("overflow"),y=c("background");return(h,v)=>(j(),pe(jo,{ref_key:"root",ref:n,object:u.value,title:u.value.subType==="poem"?"Poem":"Console",textHandler:d.value,colorHandler:g.value},{default:te(()=>[p("div",s_,[v[10]||(v[10]=p("label",{for:"poem_text"},"Text:",-1)),Ie(p("textarea",{class:"v-w100",ref_key:"textarea",ref:o,"onUpdate:modelValue":v[0]||(v[0]=f=>ye(b)?b.value=f:null),onKeydown:v[1]||(v[1]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(b)]]),p("button",{class:"w100 bt0",onClick:v[2]||(v[2]=f=>r.value=!0)}," Formatting ")]),F(Ge,{label:"Auto line wrap?",modelValue:ie(_),"onUpdate:modelValue":v[3]||(v[3]=f=>ye(_)?_.value=f:null)},null,8,["modelValue"]),F(Ge,{label:"Allow overflow?",modelValue:ie(P),"onUpdate:modelValue":v[4]||(v[4]=f=>ye(P)?P.value=f:null),title:"When text is too long, it is shown outside the container. Uses more memory"},null,8,["modelValue"]),u.value.subType==="poem"?(j(),N(ce,{key:0},[Ie(p("select",{"onUpdate:modelValue":v[5]||(v[5]=f=>ye(y)?y.value=f:null),onKeydown:v[6]||(v[6]=fe(()=>{},["stop"]))},[(j(!0),N(ce,null,qe(ie(Hp),(f,C)=>(j(),N("option",{value:C,key:C},Te(f.name),9,r_))),128))],544),[[Ct,ie(y)]]),Ie(p("select",{"onUpdate:modelValue":v[7]||(v[7]=f=>ye(w)?w.value=f:null),onKeydown:v[8]||(v[8]=fe(()=>{},["stop"]))},[(j(!0),N(ce,null,qe(ie(Vp),(f,C)=>(j(),N("option",{value:C,key:C},Te(f.name),9,i_))),128))],544),[[Ct,ie(w)]])],64)):(j(),N("table",l_,[p("tbody",null,[p("tr",null,[v[11]||(v[11]=p("td",{style:{width:"0"}},"Color:",-1)),p("td",a_,[p("button",{id:"console_color",class:"w100",style:et([{background:u.value.consoleColor},{"min-width":"64px"}]),onClick:v[9]||(v[9]=f=>i.value="base")},null,4)])])])]))]),_:1},8,["object","title","textHandler","colorHandler"]))}}),c_=Be(u_,[["__scopeId","data-v-a4329b65"]]),d_={class:"warning"},f_={style:{"word-wrap":"break-word"}},p_=Oe({__name:"sprite-tool",setup(t){const e=Xe(),n=q(null),o=q(null);$t(n);const s=kt("viewport"),r=D(()=>{for(const c of l.value.assets){const d=mn(c,!1);if(console.log(d),d.startsWith("uploads:"))return d.substring(8)}return null}),i=D(()=>e.state.panels.panels[s.value.currentPanel]),l=D(()=>{const c=i.value.objects[s.value.selection];if(c.type==="sprite")return c});function a(){o.value.click()}async function u(){const c=o.value;if(!c.files)return;if(c.files.length!==1){console.error("More than one file uploaded!");return}const d=c.files[0];await oe(async()=>{const g=URL.createObjectURL(d);await e.dispatch("uploadUrls/add",{name:r.value,url:g})})}return(c,d)=>(j(),pe(jo,{ref_key:"root",ref:n,object:l.value,title:"Custom Sprite"},{default:te(()=>[r.value?(j(),N(ce,{key:0},[p("p",d_,[d[1]||(d[1]=Q(" MISSING SPRITE! Click below to re-upload ")),p("span",f_,'"'+Te(r.value)+'"',1),d[2]||(d[2]=Q(". "))]),p("button",{onClick:d[0]||(d[0]=g=>a())},"Re-Upload"),p("input",{type:"file",ref_key:"missingSpriteUpload",ref:o,onChange:u},null,544)],64)):he("",!0)]),_:1},8,["object"]))}}),h_=Be(p_,[["__scopeId","data-v-9d2c96b7"]]),g_={class:"upper-combos"},v_={colspan:"2"},b_=["value"],m_=["disabled"],y_={id:"dialog_text_wrapper",class:"v-w100"},w_={key:0},k_=["placeholder"],C_={colspan:"2"},x_={key:0},S_={key:1},__={colspan:"2"},P_=Oe({__name:"textbox-tool",setup(t){const e=Xe(),n=q(null),o=q(null),{vertical:s}=$t(n),r=q(""),i=q("");Fe(()=>s.value,()=>{const S=o.value;S!=null&&(S.style.height="",S.style.width="")});const l=kt("viewport"),a=D(()=>e.state.panels.panels[l.value.currentPanel]),u=D(()=>{const S=a.value.objects[l.value.selection];if(S.type==="textBox")return S}),c=S=>tu(e,u,"panels/setTextBoxProperty",!1,S),d=D(()=>{if(r.value)return{title:P.value,get(){return r.value==="name"?u.value.talkingOther:r.value==="body"?C.value:""},set(S){r.value==="name"?_.value=S:r.value==="body"&&(C.value=S)},leave(){r.value=""}}}),g=D(()=>{if(i.value)return{title:y.value,get:()=>{switch(i.value){case"":return"#000000";case"base":return u.value.customColor;case"controls":return u.value.customControlsColor;case"namebox":return u.value.customNameboxColor;case"nameboxStroke":return u.value.customNameboxStroke;default:throw new Mt.UnreachableCaseError(i.value)}},set:S=>{oe(()=>{const R=a.value.id,se=u.value.id,U={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[i.value];S!==void 0&&e.commit("panels/setTextBoxProperty",_h(R,se,U,S))})},leave:()=>{i.value=""}}}),b=D({get(){return u.value.talkingObjId??"$null$"},set(S){oe(()=>{e.commit("panels/setTalkingObject",{id:u.value.id,panelId:u.value.panelId,talkingObjId:S==="$null$"?null:S})})}}),_=Co(e,u,"panels/setTalkingOther",!1,"talkingOther"),w=D(()=>{const S=a.value,R=[];for(const se of[...S.order,...S.onTopOrder]){const U=S.objects[se];U.label!==null&&R.push([se,U.label])}return R}),P=D(()=>r.value==="name"?"Name":r.value==="body"?"Dialog":""),y=D(()=>{switch(i.value){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new Mt.UnreachableCaseError(i.value)}}),h=c("autoQuoting"),v=c("autoWrap"),f=c("overflow"),C=c("text"),T=D(()=>$.value.startsWith("custom")),$=Co(e,u,"panels/setStyle",!0,"style"),m=c("controls"),x=c("skip"),I=c("continue"),E=c("overrideColor"),L=c("deriveCustomColors"),H=c("customNameboxWidth"),V=D(()=>de().TextBox.NameboxWidth);function ae(){oe(async()=>{await e.dispatch("panels/splitTextbox",{id:u.value.id,panelId:u.value.panelId})})}function ue(){oe(async()=>{await e.dispatch("panels/resetTextboxBounds",{id:u.value.id,panelId:u.value.panelId})})}function A(){oe(()=>{const S=b.value;l.value.selection=S==="$other$"||S==="$null$"?null:S})}return(S,R)=>(j(),pe(jo,{ref_key:"root",ref:n,object:u.value,title:"Textbox",textHandler:d.value,colorHandler:g.value},{default:te(()=>[p("table",g_,[p("tbody",null,[p("tr",null,[R[25]||(R[25]=p("td",null,[p("label",{for:"text_style"},"Style:")],-1)),p("td",v_,[Ie(p("select",{id:"text_style","onUpdate:modelValue":R[0]||(R[0]=se=>ye($)?$.value=se:null),onKeydown:R[1]||(R[1]=fe(()=>{},["stop"]))},R[24]||(R[24]=[p("option",{value:"normal"},"Normal",-1),p("option",{value:"corrupt"},"Corrupt",-1),p("option",{value:"custom"},"Custom",-1),p("option",{value:"custom_plus"}," Custom (Plus) ",-1),p("option",{value:"none"},"None",-1)]),544),[[Ct,ie($)]])])]),p("tr",null,[R[28]||(R[28]=p("td",null,[p("label",{for:"current_talking"},"Person talking:")],-1)),p("td",null,[Ie(p("select",{id:"current_talking","onUpdate:modelValue":R[2]||(R[2]=se=>b.value=se),onKeydown:R[3]||(R[3]=fe(()=>{},["stop"]))},[R[26]||(R[26]=p("option",{value:"$null$"},"No-one",-1)),(j(!0),N(ce,null,qe(w.value,([se,U])=>(j(),N("option",{key:se,value:se},Te(U),9,b_))),128)),R[27]||(R[27]=p("option",{value:"$other$"},"Other",-1))],544),[[Ct,b.value]])]),p("td",null,[p("button",{title:"Jump to talking character",onClick:A,disabled:b.value==="$null$"||b.value==="$other$"}," > ",8,m_)])]),p("tr",null,[R[29]||(R[29]=p("td",null,[p("label",{for:"custom_name"},"Other name:")],-1)),p("td",null,[Ie(p("input",{id:"custom_name","onUpdate:modelValue":R[4]||(R[4]=se=>ye(_)?_.value=se:null),onKeydown:R[5]||(R[5]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(_)]])]),p("td",null,[p("button",{onClick:R[6]||(R[6]=se=>r.value="name")},"...")])])])]),F(Ge,{label:"Auto quoting?",modelValue:ie(h),"onUpdate:modelValue":R[7]||(R[7]=se=>ye(h)?h.value=se:null),title:"Try to automatically fix missing/unclosed quotation marks when a character is speaking"},null,8,["modelValue"]),F(Ge,{label:"Auto line wrap?",modelValue:ie(v),"onUpdate:modelValue":R[8]||(R[8]=se=>ye(v)?v.value=se:null),title:"Automatically insert line breaks when a line of text is larger than the textbox"},null,8,["modelValue"]),F(Ge,{label:"Allow overflow?",modelValue:ie(f),"onUpdate:modelValue":R[9]||(R[9]=se=>ye(f)?f.value=se:null),title:"When text is too long, it is shown outside the textbox. Uses more memory"},null,8,["modelValue"]),p("div",y_,[R[30]||(R[30]=p("label",{for:"dialog_text"},"Dialog:",-1)),Ie(p("textarea",{class:"v-w100",ref_key:"textarea",ref:o,"onUpdate:modelValue":R[10]||(R[10]=se=>ye(C)?C.value=se:null),id:"dialog_text",onKeydown:R[11]||(R[11]=fe(()=>{},["stop"]))},null,544),[[Ke,ie(C)]]),p("button",{class:"w100 bt0",onClick:R[12]||(R[12]=se=>r.value="body")}," Formatting ")])]),options:te(()=>[F(xt,{title:"Customization:",class:Le(T.value?"customization-set":"")},{default:te(()=>[F(It,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:te(()=>[F(Ge,{label:"Controls visible?",modelValue:ie(m),"onUpdate:modelValue":R[13]||(R[13]=se=>ye(m)?m.value=se:null)},null,8,["modelValue"]),F(Ge,{label:"Able to skip?",modelValue:ie(x),"onUpdate:modelValue":R[14]||(R[14]=se=>ye(x)?x.value=se:null)},null,8,["modelValue"]),F(Ge,{label:"Continue arrow?",modelValue:ie(I),"onUpdate:modelValue":R[15]||(R[15]=se=>ye(I)?I.value=se:null)},null,8,["modelValue"]),T.value?(j(),N("table",w_,[p("tbody",null,[p("tr",null,[R[31]||(R[31]=p("td",null,[p("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),p("td",null,[Ie(p("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:V.value+"","onUpdate:modelValue":R[16]||(R[16]=se=>ye(H)?H.value=se:null),onKeydown:R[17]||(R[17]=fe(()=>{},["stop"]))},null,40,k_),[[Ke,ie(H),void 0,{number:!0}]])])]),p("tr",null,[p("td",C_,[F(Ge,{modelValue:ie(E),"onUpdate:modelValue":R[18]||(R[18]=se=>ye(E)?E.value=se:null),label:"Override color"},null,8,["modelValue"])])]),ie(E)?(j(),N("tr",x_,[R[32]||(R[32]=p("td",null,[p("label",{for:"textbox_color"},"Color:")],-1)),p("td",null,[p("button",{id:"textbox_color",class:"color-button",style:et({background:u.value.customColor}),onClick:R[19]||(R[19]=se=>i.value="base")},null,4)])])):he("",!0),ie(E)?(j(),N("tr",S_,[p("td",__,[F(Ge,{id:"derive_custom_colors",modelValue:ie(L),"onUpdate:modelValue":R[20]||(R[20]=se=>ye(L)?L.value=se:null),label:"Derive other colors"},null,8,["modelValue"])])])):he("",!0),ie(E)&&!ie(L)?(j(),N(ce,{key:2},[p("tr",null,[R[33]||(R[33]=p("td",null,[p("label",{for:"custom_controls_color"},"Controls color:")],-1)),p("td",null,[p("button",{id:"custom_controls_color",class:"color-button",style:et({background:u.value.customControlsColor}),onClick:R[21]||(R[21]=se=>i.value="controls")},null,4)])]),p("tr",null,[R[34]||(R[34]=p("td",null,[p("label",{for:"custom_namebox_color"},"Namebox color:")],-1)),p("td",null,[p("button",{id:"custom_namebox_color",class:"color-button",style:et({background:u.value.customNameboxColor}),onClick:R[22]||(R[22]=se=>i.value="namebox")},null,4)])]),p("tr",null,[R[35]||(R[35]=p("td",null,[p("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1)),p("td",null,[p("button",{id:"custom_namebox_stroke",class:"color-button",style:et({background:u.value.customNameboxStroke}),onClick:R[23]||(R[23]=se=>i.value="nameboxStroke")},null,4)])])],64)):he("",!0)])])):he("",!0)]),_:1})]),_:1},8,["class"]),p("button",{onClick:ue},"Reset position"),p("button",{class:"bt0",onClick:ae},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"]))}}),O_=Be(P_,[["__scopeId","data-v-4efd5315"]]),I_={id:"toolbar"},T_={id:"toolbar-end"},j_=Oe({__name:"tool-box",emits:["show-dialog","show-prev-render","download","show-expression-dialog"],setup(t,{emit:e}){const n=e,o=Xe(),s=q(null),r=q("add"),i=D(()=>o.state.panels.panels[l.value.currentPanel]),l=St(),a=_n(),u=cp(),c=D(()=>{if(r.value==="selection")if(u.value===null)r.value="add";else return i.value.objects[u.value].type;return r.value}),d=D(()=>o.state.ui.lastDownload!==null);function g(_){_===r.value&&(_="add"),r.value=_,u.value!==null&&(l.value.selection=null)}function b(){Mk(s.value)&&(s.value.scrollTop=0,s.value.scrollLeft=0)}return Fe(()=>u.value,_=>{if(console.log("selection changed",_),_!=null){r.value="selection";return}r.value==="selection"&&(r.value="add")}),ge.onPanelChange(_=>{r.value=_}),(_,w)=>(j(),N("div",{id:"panels",class:Le({vertical:ie(a)}),onScroll:b,ref_key:"panels",ref:s},[p("div",I_,[F(Ae,{icon:"add_box","icon-pos":"top",class:Le({active:c.value==="add"}),title:"Add new objects to the scene",shortcut:"a",onClick:w[0]||(w[0]=P=>g("add"))},null,8,["class"]),F(Ae,{icon:"panorama","icon-pos":"top",class:Le({active:c.value==="backgrounds"}),title:"Change the current background",shortcut:"s",onClick:w[1]||(w[1]=P=>g("backgrounds"))},null,8,["class"]),F(Ae,{icon:"view_module","icon-pos":"top",class:Le({active:c.value==="panels"}),title:"Panels",shortcut:"d",onClick:w[2]||(w[2]=P=>g("panels"))},null,8,["class"]),F(Ae,{icon:"settings_applications","icon-pos":"top",class:Le({active:c.value==="settings"}),title:"Settings",shortcut:"f",onClick:w[3]||(w[3]=P=>g("settings"))},null,8,["class"])]),c.value==="settings"?(j(),pe(jC,{key:0})):c.value==="backgrounds"?(j(),pe(Ox,{key:1,onShowDialog:w[4]||(w[4]=P=>n("show-dialog",P))})):c.value==="help_credits"?(j(),pe(vC,{key:2})):c.value==="character"?(j(),pe($S,{key:3,onShowDialog:w[5]||(w[5]=P=>n("show-dialog",P)),onShowExpressionDialog:w[6]||(w[6]=P=>n("show-expression-dialog",P))})):c.value==="sprite"?(j(),pe(h_,{key:4})):c.value==="textBox"?(j(),pe(O_,{key:5})):c.value==="choice"?(j(),pe(MS,{key:6})):c.value==="panels"?(j(),pe(o_,{key:7})):c.value==="notification"?(j(),pe(DS,{key:8})):c.value==="poem"?(j(),pe(c_,{key:9})):(j(),pe(pC,{key:10,onShowDialog:w[7]||(w[7]=P=>n("show-dialog",P))})),p("div",T_,[F(Ae,{icon:"help","icon-pos":"top",class:Le({active:c.value==="help_credits"}),title:"Help & Credits",shortcut:"h",onClick:w[8]||(w[8]=P=>g("help_credits"))},null,8,["class"]),F(Ae,{icon:"extension","icon-pos":"top",title:"Content Packs",shortcut:"p",onClick:w[9]||(w[9]=P=>n("show-dialog"))}),F(Ae,{icon:"flip_to_back","icon-pos":"top",title:"Show last downloaded panel",shortcut:"l",onClick:w[10]||(w[10]=P=>n("show-prev-render")),disabled:!d.value},null,8,["disabled"]),F(Ae,{icon:"photo_camera","icon-pos":"top",title:"Take a screenshot of the current scene",shortcut:"i",onClick:w[11]||(w[11]=P=>n("download"))})])],34))}}),$_={class:"hidden-selectors"},R_=["data-obj-id","onKeydown"],A_=20,M_=50,Bh=Oe({__name:"app",setup(t){const e=Xe(),n=Ng("app"),o=pu(()=>Yu(()=>import("./single-box-pt0tHbtb.js"),__vite__mapDeps([0,1]),import.meta.url)),s=pu(()=>Yu(()=>import("./expression-builder-Eo7CZxHL.js"),__vite__mapDeps([2,3]),import.meta.url)),r=q(!0),i=q(null);function l(){const U=e.state.ui.lastDownload;U!=null&&i.value.blendOver(U)}const a=q(oc(document));Af("viewport",a),Fe(()=>{var U;return(U=n.value)==null?void 0:U.ownerDocument},(U,ne)=>{U!=null&&(U!==document&&(a.value=oc(U)),ne!=null&&w(ne),_(U))},{immediate:!0});const u=Symbol("capturing"),c=new Map;function d(U,ne,we=!1){if(we){const Ye=ne;ne=K=>Ye(K),ne[u]=!0}const Se=c.get(U);Se==null?c.set(U,[ne]):Se.push(ne);const _e=n.value;_e!=null&&_e.ownerDocument.addEventListener(U,ne,we)}const g=new Map;function b(U,ne,we=!1){if(we){const Ye=ne;ne=K=>Ye(K),ne[u]=!0}const Se=g.get(U);Se==null?g.set(U,[ne]):Se.push(ne);const _e=n.value;_e!=null&&_e.ownerDocument.defaultView.addEventListener(U,ne)}function _(U){var ne;for(const[we,Se]of c)for(const _e of Se)U.addEventListener(we,_e);for(const[we,Se]of g)for(const _e of Se)(ne=U.defaultView)==null||ne.addEventListener(we,_e)}function w(U){var ne;for(const[we,Se]of c)for(const _e of Se)U.removeEventListener(we,_e);for(const[we,Se]of g)for(const _e of Se)(ne=U.defaultView)==null||ne.removeEventListener(we,_e)}Sn(()=>{const U=a.value.doc;w(U)});const P=D(()=>{const ne=e.state.panels.panels[a.value.currentPanel];return ne==null?[]:[...ne.order,...ne.onTopOrder]});function y(U){U.preventDefault()}d("drop",y,!0),d("dragover",y,!0);const h=q(!1),v=D(()=>e.state.ui.useDarkTheme);if(Fe(()=>v.value??h.value,U=>{a.value.doc.body.classList.toggle("dark-theme",U)},{immediate:!0}),window.matchMedia!=null){const U=window.matchMedia("(prefers-color-scheme: dark)");h.value=U.matches;const ne=we=>h.value=we.matches;U.addEventListener?U.addEventListener("change",ne):U.addListener(ne)}const f=q(!1),C=q(""),T=q(void 0);function $(U){f.value=!0,C.value=U.character,T.value=U.headGroup}const m=q(null),x=q(!1);function I(U){if(x.value=!0,U==null)return;const ne=()=>{m.value?m.value.setSearch(U):setTimeout(ne,M_)};tn(ne)}const E=D(()=>e.state.ui.nsfw);Fe(()=>E.value,async U=>{U?await e.dispatch("content/loadContentPacks",_k):await e.dispatch("removePacks",{packs:Sk})});let L=null;function H(){L==null&&(L=requestAnimationFrame(()=>{L=null,$e.fire(new Or)}))}function V(U){if(Rk(U.target)||Ak(U.target)){console.log("skip keydown on potential target");return}oe(async()=>{const ne=U.ctrlKey&&!U.altKey&&!U.metaKey&&!U.shiftKey,we=!U.ctrlKey&&!U.altKey&&!U.metaKey&&!U.shiftKey;if(ne&&U.key==="v"){await e.dispatch("panels/pasteObjectFromClipboard",{panelId:a.value.currentPanel}),U.preventDefault();return}if(we&&U.key==="Escape"){if(a.value.selection===null)return;a.value.selection=null;return}const _e=e.state.panels.panels[a.value.currentPanel].objects[a.value.selection];if(_e!=null){if(ne){if(U.key==="c"||U.key==="x"){await e.dispatch("panels/copyObjectToClipboard",{id:_e.id,panelId:_e.panelId}),U.key==="x"&&await e.dispatch("panels/removeObject",{id:_e.id,panelId:_e.panelId}),U.preventDefault();return}}else if(we){if(U.key==="Delete"){await e.dispatch("panels/removeObject",{id:_e.id,panelId:_e.panelId});return}if(U.key==="/"||U.key==="*"){let Pe=U.key==="/"?-10:10;U.shiftKey&&(Pe/=Math.abs(Pe)),e.commit("panels/setRotation",{id:_e.id,panelId:_e.panelId,rotation:_e.rotation+Pe}),U.stopPropagation(),U.preventDefault();return}if(_e.type==="character"){const Pe=_e;if(!Pe.freeMove){if(U.key==="ArrowLeft"){await e.dispatch("panels/shiftCharacterSlot",{id:Pe.id,panelId:Pe.panelId,delta:-1});return}if(U.key==="ArrowRight"){await e.dispatch("panels/shiftCharacterSlot",{id:Pe.id,panelId:Pe.panelId,delta:1});return}}}let{x:Ye,y:K}=_e;const Ce=U.shiftKey?1:A_;switch(U.key){case"ArrowLeft":Ye-=Ce;break;case"ArrowRight":Ye+=Ce;break;case"ArrowUp":K-=Ce;break;case"ArrowDown":K+=Ce;break;default:return}await e.dispatch("panels/setPosition",{id:_e.id,panelId:_e.panelId,x:Ye,y:K})}}})}b("keydown",V);let ae=null,ue=!1;function A(U){U.ctrlKey?!ue&&ae===null&&(ae=setTimeout(S)):R()}function S(){document.body.classList.add("ctrl-key"),ue=!0}function R(){ae!==null&&(clearTimeout(ae),ae=null),document.body.classList.remove("ctrl-key"),ue=!1}b("keydown",A,!0),b("keyup",A,!0),b("mousemove",A,!0),b("blur",R);function se(U){oe(()=>{a.value.selection!==U&&(a.value.selection=U)})}return Fe(()=>a.value.selection,U=>{var ne,we;((ne=document.activeElement)==null?void 0:ne.getAttribute("data-obj-id"))!==""+U&&((we=document.querySelector(`*[data-obj-id='${U}']`))==null||we.focus({focusVisible:!1,preventScroll:!0}))},{immediate:!0}),kn.setStore(e),window.store=e,window.env=ge,Dt(async()=>{await ge.loadGameMode(),ge.connectToStore(e),r.value=!1;const U=await ge.loadSettings();e.state.panels.lastPanelId===-1&&await oe(async()=>{if(ge.state.looseTextParsing=U.looseTextParsing||!0,e.commit("ui/setLqRendering",U.lq??!1),e.commit("ui/setDarkTheme",U.darkMode??null),e.commit("ui/setDefaultCharacterTalkingZoom",U.defaultCharacterTalkingZoom??!0),await e.dispatch("content/loadContentPacks",[`${dt}buildin.base.backgrounds.json`,`${dt}buildin.base.monika.json`,`${dt}buildin.base.sayori.json`,`${dt}buildin.base.natsuki.json`,`${dt}buildin.base.yuri.json`,`${dt}buildin.extra.mc.json`,`${dt}buildin.extra.concept_mc_v2.json`,`${dt}buildin.extra.mc_chad.json`,`${dt}buildin.extra.femc.json`,`${dt}buildin.extra.concept_femc.json`,`${dt}buildin.extra.amy.json`]),!await ge.loadDefaultTemplate()){await ge.loadContentPacks();const ne=await e.dispatch("panels/createPanel");a.value.currentPanel=ne,Object.keys(e.state.panels.panels[ne].objects).length===0&&await e.dispatch("panels/createTextBox",{panelId:ne,text:`Hi! Click here to edit this textbox! ${a.value.isVertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more! Use the camera icon to download the image.`}),e.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:a.value.currentPanel}),e.commit("ui/setNsfw",U.nsfw??!1)}})}),(U,ne)=>(j(),N(ce,null,[p("div",{id:"app",ref_key:"app",ref:n},[p("div",$_,[(j(!0),N(ce,null,qe(P.value,we=>(j(),N("div",{key:we,tabindex:"0","data-obj-id":we,onFocus:ne[0]||(ne[0]=Se=>H()),onBlur:ne[1]||(ne[1]=Se=>H()),onKeydown:[ot(fe(Se=>se(we),["prevent"]),["enter"]),ot(fe(Se=>se(we),["prevent"]),["space"])]},null,40,R_))),128))]),F(Gk,{ref_key:"renderer",ref:i,canvasWidth:a.value.canvasWidth,canvasHeight:a.value.canvasHeight,preLoading:r.value},null,8,["canvasWidth","canvasHeight","preLoading"]),F(Lb),F(j_,{onShowPrevRender:l,onDownload:ne[2]||(ne[2]=we=>i.value.download()),onShowDialog:I,onShowExpressionDialog:$}),(j(),pe(Vg,null,[x.value?(j(),pe(ao,{key:0,ref:"dialog",onLeave:ne[4]||(ne[4]=we=>x.value=!1)},{default:te(()=>[F(ie(o),{ref_key:"packDialog",ref:m,onLeave:ne[3]||(ne[3]=we=>x.value=!1)},null,512)]),_:1},512)):he("",!0)],1024)),f.value?(j(),pe(ao,{key:0,ref:"dialog",onLeave:ne[6]||(ne[6]=we=>f.value=!1)},{default:te(()=>[F(ie(s),{character:C.value,initHeadGroup:T.value,onLeave:ne[5]||(ne[5]=we=>f.value=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):he("",!0)],512),ne[7]||(ne[7]=p("div",{id:"modal-messages"},null,-1))],64))}}),B_=xb();op(Bh).use(Th).use(B_).mount("#main_wrapper");export{Dt as A,Sn as B,Ie as C,Ke as D,Tv as E,ce as F,Pf as G,ko as H,$e as I,sn as J,qt as K,mn as L,vo as M,vh as N,Mh as O,Ah as P,Ct as Q,kn as R,xt as S,D_ as T,gk as U,up as V,Ls as W,Ph as X,en as Y,oe as Z,Ze as _,N as a,p as b,D as c,Oe as d,ge as e,he as f,Q as g,ie as h,F as i,te as j,pe as k,Ge as l,qe as m,et as n,j as o,Fk as p,Be as q,q as r,Fe as s,Te as t,Xe as u,Le as v,fe as w,tn as x,Ln as y,ys as z};
