import{d as j,c as T,e as M,r as k,a as b,o as h,w as V,n as ie,b as c,f as x,g as I,t as L,u as Q,h as q,_ as Y,i as K,j as W,F as N,k as ce,l as z,m as ue,s as Z,p as R,q as ne,v as X,T as de,x as $,y as ee,z as pe,A as re,B as fe,C as ve,D as he,E as me,G as be,H as ge,R as te,I as ye,V as ke}from"./index-B9koAcxQ.js";const we=["h3","h4","h5","h6","blockquote","p","a","ul","ol","nl","li","b","i","strong","em","strike","code","hr","br","div","table","thead","caption","tbody","tr","th","td","pre"],Ce={a:["href"],img:["src"]},De=["href","src"],Pe=["http","https"],xe={a:{target:"_blank",rel:"noopener noreferrer"}};function ae(p){const e=document.createElement("div"),o=document.createElement("div");o.innerHTML=p;for(const t of Array.from(o.childNodes))for(const n of F(t))e.appendChild(n);return e.innerHTML}const Te=/^(\w+):/;function F(p){if(p.nodeType!==Node.ELEMENT_NODE)return[p];const e=p,o=e.tagName.toLowerCase();if(we.includes(o)){const t=document.createElement(o),n=Array.prototype.slice.call(e.attributes),d=Ce[o]||[];for(const u of n)if(d.includes(u.name)){if(De.includes(u.name)){const m=u.value.match(Te);if(m&&!Pe.includes(m[1]))continue}t.setAttribute(u.name,e.getAttribute(u.name))}const i=xe[o];if(i)for(const u in i)Object.prototype.hasOwnProperty.call(i,u)&&t.setAttribute(u,i[u]);const l=Array.prototype.slice.call(e.childNodes);for(const u of l){const m=F(u);for(const C of m)t.appendChild(C)}return[t]}else{let t=[];t.push(document.createTextNode(`<${o}>`));for(const n of e.childNodes)t=t.concat(F(n));return t.push(document.createTextNode(`</${o}>`)),t}}const Le=["innerHTML"],Ae={key:1},Me={key:2,disabled:""},_e=["title","src"],Se={key:2},Ee=["innerHTML"],Ie=j({__name:"pack-display",props:{selected:{},repo:{},showBack:{type:Boolean}},setup(p){const e=p,o=[["reddit","https://reddit.com/u/%1","reddit.png"],["deviantart","https://www.deviantart.com/%1","deviantart.png"],["twitter","https://twitter.com/%1","twitter.svg"],["pixiv","https://www.pixiv.net/users/%1","pixiv.ico"],["patreon","https://www.patreon.com/%1","patreon.png"],["facebook","https://www.facebook.com/%1","facebook.png"],["github","https://github.com/%1","github.png"],["website","%1","website.svg"]],t=T(()=>e.repo.getPack(e.selected)),n=T(()=>t.value.preview.map(f=>`url('${f}')`).join(",")),d=T(()=>t.value.loaded),i=T(()=>!t.value.loaded),l=T(()=>M.supports.autoLoading),u=T(()=>M.supports.localRepo?!t.value.installed:!1),m=T(()=>M.supports.localRepo?t.value.installed:!1),C=T({get(){return M.state.autoAdd.includes(e.selected)},set(f){let a=e.selected;const s=t.value;s.repoUrl!=null&&(a+=`;${s.repoUrl}`),f?M.autoLoadAdd(a):M.autoLoadRemove(a)}}),v=k(!1);function S(f){const a=e.repo.getAuthor(f);return a&&a.currentName!=null?a.currentName:f}function E(f){const a=e.repo.getAuthor(f);return a?o.filter(s=>a[s[0]]).map(s=>{const r=a[s[0]];return{target:s[1].replace("%1",r),platform:s[0][0].toUpperCase()+s[0].slice(1),icon:"icons/"+s[2]}}):[]}async function P(){if(t.value.installed)return;const f={};for(const s of t.value.authors)f[s]={...e.repo.getAuthor(s)};const a=JSON.parse(JSON.stringify(t.value));delete a.autoloading,delete a.online,delete a.loaded,delete a.installed;try{v.value=!0,await M.localRepoInstall(t.value.dddg2Path||t.value.dddg1Path,a,f)}catch(s){ue("Installing pack",s)}finally{v.value=!1}}async function A(){var a;const f=t.value;if(f.installed){f.repoUrl!=null&&!((a=e.repo)!=null&&a.hasPack(f.id,!0))&&await e.repo.loadTempPack(f.repoUrl);try{v.value=!0,await M.localRepoUninstall(f.id)}finally{v.value=!1}}}async function y(){Z.content.removeContentPacks(new Set([t.value.id]))}async function g(){await Z.content.loadContentPacks(t.value.dddg2Path||t.value.dddg1Path)}return(f,a)=>(h(),b("div",{class:"pack-display",style:ie({backgroundImage:n.value}),onClick:a[2]||(a[2]=V(()=>{},["stop"]))},[c("header",null,[c("h1",null,[f.showBack?(h(),b("button",{key:0,class:"exit-button",onClick:a[0]||(a[0]=s=>f.$emit("leave",!0))},a[3]||(a[3]=[c("i",{class:"material-icons"},"arrow_back",-1)]))):x("",!0),I(" "+L(t.value.name),1)]),c("h2",null,L(t.value.id),1)]),t.value.disclaimer?(h(),b("section",{key:0,class:"disclaimer",innerHTML:Q(ae)(t.value.disclaimer)},null,8,Le)):x("",!0),t.value.source?(h(),b("section",Ae,[q(Y,{to:t.value.source},{default:K(()=>a[4]||(a[4]=[I("Source")])),_:1},8,["to"])])):x("",!0),c("section",null,[i.value?(h(),b("button",{key:0,onClick:g},a[5]||(a[5]=[c("i",{class:"material-icons"},"add",-1),I(" Activate ")]))):x("",!0),d.value?(h(),b("button",{key:1,onClick:y},a[6]||(a[6]=[c("i",{class:"material-icons"},"remove",-1),I(" Deactivate ")]))):x("",!0),v.value?(h(),b("button",Me,"Processing...")):(h(),b(N,{key:3},[u.value?(h(),b("button",{key:0,onClick:P},a[7]||(a[7]=[c("i",{class:"material-icons"},"add",-1),I(" Store locally ")]))):x("",!0),m.value?(h(),b("button",{key:1,onClick:A},a[8]||(a[8]=[c("i",{class:"material-icons"},"remove",-1),I(" Remove locally ")]))):x("",!0)],64)),l.value?(h(),W(ce,{key:4,label:"Load on startup",modelValue:C.value,"onUpdate:modelValue":a[1]||(a[1]=s=>C.value=s)},null,8,["modelValue"])):x("",!0)]),c("section",null,[a[9]||(a[9]=c("h3",null,"Authors",-1)),c("table",null,[c("tbody",null,[(h(!0),b(N,null,z(t.value.authors,s=>(h(),b("tr",{key:s},[c("td",null,L(S(s)),1),c("td",null,[(h(!0),b(N,null,z(E(s),r=>(h(),W(Y,{key:r.target,to:r.target,class:"platform_button"},{default:K(()=>[c("img",{title:r.platform,src:r.icon,height:"32",width:"32",alt:""},null,8,_e)]),_:2},1032,["to"]))),128))])]))),128))])])]),t.value.description?(h(),b("section",Se,[a[10]||(a[10]=c("h3",null,"Credits",-1)),c("p",{innerHTML:Q(ae)(t.value.description)},null,8,Ee)])):x("",!0)],4))}}),$e=R(Ie,[["__scopeId","data-v-9022e869"]]),Ne=["author","character","type","pack","engine"],J=new Map;for(const p of Ne)for(let e=1;e<=p.length;++e){const o=p.slice(0,e);J.set(o,p)}const Be=/\s/;function He(p){const e=[];let o="",t="",n=!1,d=!1;function i(){e.push({type:t||"all",payload:o.toLowerCase()}),o="",t="",d=!1,n=!1}for(const l of p){if(d){o+=l,d=!1;continue}switch(l){case"\\":d=!0;continue;case":":const u=o.toLowerCase();if(!n&&t===""&&J.has(u)){t=J.get(u),o="";continue}break;case'"':n?i():n=!0;continue}!n&&Be.test(l)?o&&i():o+=l}return o&&i(),e}const oe=new Map([["engine",0],["pack",1],["type",2],["character",2],["author",2],["all",3]]);function Oe(p){return Ue(Ve(p))}function Ue(p){return p.sort((e,o)=>oe.get(e.type)-oe.get(o.type)||o.payload.length-e.payload.length)}function Ve(p){const e=new Map;for(const t of p){let n=e.get(t.type);n||(n=[],e.set(t.type,n)),n.push(t)}for(const t of e.keys()){const d=e.get(t).sort((i,l)=>i.payload.localeCompare(l.payload)).filter((i,l,u)=>u[l+1]?!u[l+1].payload.startsWith(i.payload):!0);e.set(t,d.filter((i,l,u)=>!u.find((m,C)=>C!==l&&m.payload.indexOf(i.payload)!==-1)))}const o=Array.from(e.keys()).filter(t=>t!=="all");return e.set("all",(e.get("all")||[]).filter(t=>!o.find(n=>e.get(n).find(d=>d.payload.indexOf(t.payload)!==-1)))),[...e.values()].flatMap(t=>t)}class B{constructor(e){e=e.replace(/[\s-]/g,"").toLowerCase();const o=new Set;for(const[t,n]of B.engines)t.toLowerCase().indexOf(e)>=0&&o.add(n);this.matchingProps=Array.from(o)}get isImpossible(){return this.matchingProps.length===0}match(e){for(const o of this.matchingProps)if(e[o])return!0;return!1}}B.engines=[["Doki Doki Dialog Generator 1","dddg1Path"],["Doki Doki Dialouge Generator 1","dddg1Path"],["DDDG1","dddg1Path"],["Doki Doki Dialog Generator 2","dddg2Path"],["Doki Doki Dialouge Generator 2","dddg2Path"],["DDDG2","dddg2Path"],["Doki Doki Comic Club 2","ddcc2Path"],["DDCC2","ddcc2Path"]].map(([p,e])=>[p.replace(/\s/g,"").toLowerCase(),e]);class le{constructor(e,o){e=e.toLowerCase();const t=new Set;for(const n in o){if(!Object.prototype.hasOwnProperty.call(o,n))continue;const d=o[n],i=Object.keys(d);(n.toLowerCase().indexOf(e)>=0||i.find(l=>d[l].toLowerCase().indexOf(e)>=0))&&t.add(n)}this.matchingAuthors=t}get isImpossible(){return this.matchingAuthors.size===0}match(e){return!!e.authors.find(o=>this.matchingAuthors.has(o))}}class H{constructor(e,o,t){e=e.toLowerCase(),this.matchingCharacters=new Set(H.getUniqueCharacters(t).filter(n=>n.toLowerCase().indexOf(e)>=0))}get isImpossible(){return this.matchingCharacters.size===0}match(e){return!!e.characters.find(o=>this.matchingCharacters.has(o))}static getUniqueCharacters(e){let o=this.uniqueCharacters.get(e);return o||(o=Array.from(new Set(e.flatMap(t=>t.characters))),this.uniqueCharacters.set(e,o)),o}}H.uniqueCharacters=new Map;class O{constructor(e){e=e.toLowerCase(),this.matchingTypes=new Set(O.types.filter(o=>o.toLowerCase().indexOf(e)>=0))}get isImpossible(){return this.matchingTypes.size===0}match(e){return!!e.kind.find(o=>this.matchingTypes.has(o))}}O.types=["Styles","Characters","Expressions","Poses","Backgrounds","Sprites","Misc"];class _{constructor(e,o,t){e=e.toLowerCase(),this.payload=e;const n=_.getTriplets(t);for(let d=0,i=e.length-2;d<i;++d)if(!n.has(e.substr(d,3))){this.isImpossible=!0;return}this.isImpossible=!1}match(e){if(this.isImpossible)return!1;const o=this.payload;return!!(e.id.toLowerCase().indexOf(o)>=0||e.name.toLowerCase().indexOf(o)>=0||e.searchWords.find(t=>t.toLowerCase().indexOf(o)>=0))}static getTriplets(e){let o=this.tripletCache.get(e);if(!o){o=new Set;for(const t of e){_.splitTriplets(t.id,o),_.splitTriplets(t.name,o);for(const n of t.searchWords)_.splitTriplets(n,o)}this.tripletCache.set(e,o)}return o}static splitTriplets(e,o){e=e.toLowerCase();for(let t=0,n=e.length-2;t<n;++t)o.add(e.substr(t,3))}}_.tripletCache=new Map;class G{constructor(e,o,t){this.matchers=G.allMatchers.map(n=>new n(e,o,t)).filter(n=>!n.isImpossible)}get isImpossible(){return this.matchers.length===0}match(e){return!!this.matchers.find(o=>o.match(e))}}G.allMatchers=[B,le,H,O,_];const qe=new Map([["all",G],["author",le],["character",H],["engine",B],["pack",_],["type",O]]);function ze(p,e,o){return p.map(t=>new(qe.get(t.type))(t.payload,e,o))}function je(p,e,o){const t=He(p),n=Oe(t),d=ze(n,e,o);return d.find(i=>i.isImpossible)?[]:o.filter(i=>d.every(l=>l.match(i)))}const Re=["tabindex","onClick","onKeydown"],Ge={key:0},Ke=["onMousedown","onClick"],se=10,We=j({__name:"pack-list",props:{search:{},repo:{},disabled:{type:Boolean,default:!1}},emits:["selected","select-search-bar"],setup(p,{emit:e}){const o=p,t=e,n=k(null),d=k(null),i=k(null),l=k(""),u=k(!1),m=k(""),C=T(()=>o.repo?o.repo.getPacks():[]),v=T(()=>{const a=g(C.value,o.search);if(l.value&&a.length>0){const s=l.value;let r;if(typeof a[0][s]=="string"?r=(w,D)=>w.name.localeCompare(D.name):a[0][s]instanceof Array&&(r=(w,D)=>w[s].join(", ").localeCompare(D[s].join(", "))),r){if(u.value){const w=r;r=(D,U)=>w(U,D)}a.sort(r)}}return a});function S(){d.value.$el.focus()}function E(a){const s=v.value.findIndex(r=>r.id===m.value);switch(a.key){case"Enter":t("selected",{id:m.value,source:"keyboard"}),a.stopPropagation(),a.preventDefault();break;case"ArrowUp":a.preventDefault(),a.stopPropagation(),s===0?t("select-search-bar"):m.value=v.value[s-1].id;break;case"ArrowDown":a.preventDefault(),a.stopPropagation(),s<v.value.length-1&&(m.value=v.value[s+1].id);break;case"PageUp":{a.preventDefault(),a.stopPropagation();let r=s-se;r<0&&(r=0),m.value=v.value[r].id;break}case"PageDown":{a.preventDefault(),a.stopPropagation();let r=s+se;const w=v.value.length-1;r>w&&(r=w),m.value=v.value[r].id;break}}}function P(a,s){switch(a.key){case"Enter":case" ":y(s),a.preventDefault(),a.stopPropagation();break;case"ArrowDown":S(),a.stopPropagation(),a.preventDefault();break;case"ArrowUp":t("select-search-bar"),a.stopPropagation(),a.preventDefault();break}}function A(){if(v.value.length===0){m.value="";return}m.value===""&&(m.value=v.value[0].id),$(()=>{const a=document.querySelector(".list tbody .focused"),s=n.value.offsetHeight-i.value.offsetHeight,r=n.value.scrollTop,w=r+s;if(a){const D=a.offsetTop-i.value.offsetHeight,U=D+a.offsetHeight;U>w?n.value.scrollTop=U-s:D<r&&(n.value.scrollTop=D)}})}function y(a){l.value===a?u.value?(l.value="",u.value=!1):u.value=!0:(l.value=a,u.value=!1)}function g(a,s){return s?je(s,o.repo?o.repo.getAuthors():{},a):[...a]}function f(a){return a.loaded?"Active":a.installed?"Installed":""}return ne(()=>m.value,A),(a,s)=>(h(),b("div",{ref_key:"root",ref:n,class:"list"},[c("table",null,[c("thead",null,[c("tr",{ref_key:"header",ref:i},[(h(),b(N,null,z([["name","Pack"],["characters","Character"],["kind","Type"],["authors","Authors"],["state","Status"]],(r,w)=>c("th",{key:w,tabindex:a.disabled?-1:0,onClick:D=>y(r[0]),onKeydown:D=>P(D,r[0])},[c("div",null,[c("div",null,L(r[1]),1),l.value===r[0]?(h(),b("div",Ge,L(u.value?"▼":"▲"),1)):x("",!0)])],40,Re)),64))],512)]),q(de,{name:"tbody-group",key:"list-transition",tag:"tbody",ref_key:"tbody",ref:d,tabindex:a.disabled?-1:0,onKeydown:E,onFocus:A},{default:K(()=>[(h(!0),b(N,null,z(v.value,r=>(h(),b("tr",{key:r.id,class:X({"tbody-group-item":!0,focused:m.value===r.id}),onMousedown:w=>m.value=r.id,onClick:w=>t("selected",{id:r.id,source:"pointer"})},[c("td",null,L(r.name),1),c("td",null,L(r.characters.join(", ")),1),c("td",null,L(r.kind.join(", ")),1),c("td",null,L(r.authors.join(", ")),1),c("td",null,L(f(r)),1)],42,Ke))),128))]),_:1},8,["tabindex"])])],512))}}),Fe=R(We,[["__scopeId","data-v-6da6efa1"]]),Je={class:"search-area"},Xe={class:"search-bar"},Qe=["disabled"],Ye=["disabled"],Ze=250,et=j({__name:"search-bar",props:ee({disabled:{type:Boolean}},{modelValue:{default:""},modelModifiers:{}}),emits:ee(["leave","focus-list"],["update:modelValue"]),setup(p,{expose:e,emit:o}){const t=pe(p,"modelValue"),n=o,d=k(null),i=k(""),l=k(null),u=k("");function m(){const y=d.value;y!=null&&y.focus()}function C(y){y.key==="ArrowDown"&&(n("focus-list"),y.preventDefault(),y.stopPropagation())}function v(){if(u.value===t.value){u.value="";return}i.value=t.value}function S(){l.value!=null&&clearTimeout(l.value),l.value=setTimeout(E,Ze)}function E(){l.value!=null&&clearTimeout(l.value),l.value=null;const y=document.createElement("div");y.innerHTML=i.value,u.value=y.innerText,t.value=y.innerText}ne(()=>t.value,v,{immediate:!0});const P=k(!1);function A(){P.value=!1}return re(()=>{document.body.addEventListener("click",A)}),fe(()=>{document.body.removeEventListener("click",A)}),e({focus:m}),(y,g)=>(h(),b("div",Je,[c("div",Xe,[ve(c("input",{class:"input",ref_key:"input",ref:d,"onUpdate:modelValue":g[0]||(g[0]=f=>i.value=f),disabled:y.disabled,onInput:S,onClick:g[1]||(g[1]=V(()=>{},["stop"])),onKeydown:C},null,40,Qe),[[he,i.value]]),c("button",{class:X({help:!0,toggled:P.value}),disabled:y.disabled,onClick:g[2]||(g[2]=V(f=>P.value=!P.value,["stop"]))},g[5]||(g[5]=[c("i",{class:"material-icons"},"info",-1)]),10,Ye),c("button",{class:"exit-button",onClick:g[3]||(g[3]=f=>n("leave"))},g[6]||(g[6]=[c("i",{class:"material-icons"},"clear",-1)]))]),P.value?(h(),b("div",{key:0,class:"info-area",onClick:g[4]||(g[4]=V(()=>{},["stop"]))},g[7]||(g[7]=[me("<p data-v-5237331b> Enter the text you want to search for. E.g. <code data-v-5237331b>Monika</code></p><p data-v-5237331b> If multiple words are given, each word must be found. E.g. <code data-v-5237331b>Monika Pose</code></p><p data-v-5237331b> To search phrases with spaces, surround them with double quotes. E.g. <code data-v-5237331b>&quot;Monika R63&quot; Pose</code></p><p data-v-5237331b> To limit your search to specific attributes of a pack, you can use the following prefixes: </p><table data-v-5237331b><tbody data-v-5237331b><tr data-v-5237331b><th data-v-5237331b>Prefix</th><th data-v-5237331b>Description</th><th data-v-5237331b>Example</th></tr><tr data-v-5237331b><td data-v-5237331b>Character:</td><td data-v-5237331b></td><td data-v-5237331b><code data-v-5237331b>Character: Monika</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Artist:</td><td data-v-5237331b></td><td data-v-5237331b><code data-v-5237331b>Artist: edave64</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Type:</td><td data-v-5237331b><code data-v-5237331b>Backgrounds</code>, <code data-v-5237331b>Sprites</code>, <code data-v-5237331b>Expressions</code>, <code data-v-5237331b>Styles</code>, <code data-v-5237331b>Poses</code> or <code data-v-5237331b>Characters</code></td><td data-v-5237331b><code data-v-5237331b>Type: Poses</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Engine:</td><td data-v-5237331b><code data-v-5237331b>Doki Doki Dialog Generator</code>, <code data-v-5237331b>DDDG</code> or <code data-v-5237331b>Doki Doki Comic Club</code>, <code data-v-5237331b>DDCC</code></td><td data-v-5237331b><code data-v-5237331b>Engine: DDCC</code></td></tr><tr data-v-5237331b><td data-v-5237331b>Pack:</td><td data-v-5237331b>The pack itself must contain the text</td><td data-v-5237331b><code data-v-5237331b>Pack: Angry</code></td></tr></tbody></table><p data-v-5237331b> Prefixes can be shorted, so <code data-v-5237331b>Character: Monika</code> can be shortend to <code data-v-5237331b>C: Monika</code></p>",6)]))):x("",!0)]))}}),tt=R(et,[["__scopeId","data-v-5237331b"]]),at={key:1,class:"ask-download"},ot={key:1,class:"page fly-right"},st=j({__name:"single-box",emits:["leave"],setup(p,{expose:e,emit:o}){const t=o,n=k(null),d=k(null),i=k(null),l=k(""),u=k([]),m=k({}),C=k(null),v=k(null),S=T(()=>l.value.endsWith(".json")&&(l.value.startsWith("http://")||l.value.startsWith("https://")));function E(s){v.value=null,l.value=s}function P(s){v.value=null,s&&f()}function A(s){s.key==="Escape"&&(v.value="",$(()=>{n.value.focus()}))}function y({id:s,source:r}){v.value=s,r==="keyboard"&&$(()=>{i.value.focus()})}function g(){$(()=>{d.value&&d.value.focus()})}function f(){$(()=>{n.value&&n.value.focus()})}async function a(){try{const r=await(await te.getInstance()).loadTempPack(l.value);l.value="",r!=null&&(v.value=r)}catch(s){ye.fire(new ke(s,"Error while loading external pack")),console.error(s)}}return be(f),re(f),ge("Initializing repo list",async()=>{const s=await te.getInstance();C.value=s,u.value=s.getPacks(),m.value=s.getAuthors()}),e({setSearch:E}),(s,r)=>(h(),b("div",{class:"pages",onKeydown:A},[v.value?(h(),b("div",ot,[q($e,{ref_key:"dialog",ref:i,class:"pack-display",repo:C.value,selected:v.value,"show-back":"",onLeave:P},null,8,["repo","selected"])])):(h(),b("div",{key:0,class:X(["page fly-left",{blured:v.value}])},[q(tt,{class:"search-bar",ref_key:"searchBar",ref:n,modelValue:l.value,"onUpdate:modelValue":r[0]||(r[0]=w=>l.value=w),disabled:!!v.value,onFocusList:g,onLeave:r[1]||(r[1]=w=>t("leave"))},null,8,["modelValue","disabled"]),S.value?(h(),b("div",at,[I(" Do you want to download the pack from '"+L(l.value)+"'? ",1),c("button",{onClick:a},"Add package")])):(h(),W(Fe,{key:0,class:"list",ref_key:"list",ref:d,search:l.value,repo:C.value,disabled:!!v.value,onSelected:y,onSelectSearchBar:r[2]||(r[2]=w=>n.value.focus())},null,8,["search","repo","disabled"]))],2))],32))}}),rt=R(st,[["__scopeId","data-v-239086b9"]]);export{rt as default};
