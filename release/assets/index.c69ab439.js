var en=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(s){if(s.ep)return;s.ep=!0;const r=n(s);fetch(s.href,r)}})();function $l(e,t){const n=Object.create(null),o=e.split(",");for(let s=0;s<o.length;s++)n[o[s]]=!0;return t?s=>!!n[s.toLowerCase()]:s=>!!n[s]}function Re(e){if(z(e)){const t={};for(let n=0;n<e.length;n++){const o=e[n],s=xe(o)?ph(o):Re(o);if(s)for(const r in s)t[r]=s[r]}return t}else{if(xe(e))return e;if(be(e))return e}}const dh=/;(?![^(]*\))/g,ch=/:([^]+)/,uh=new RegExp("\\/\\*.*?\\*\\/","gs");function ph(e){const t={};return e.replace(uh,"").split(dh).forEach(n=>{if(n){const o=n.split(ch);o.length>1&&(t[o[0].trim()]=o[1].trim())}}),t}function pe(e){let t="";if(xe(e))t=e;else if(z(e))for(let n=0;n<e.length;n++){const o=pe(e[n]);o&&(t+=o+" ")}else if(be(e))for(const n in e)e[n]&&(t+=n+" ");return t.trim()}const fh="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",hh=$l(fh);function bu(e){return!!e||e===""}function gh(e,t){if(e.length!==t.length)return!1;let n=!0;for(let o=0;n&&o<e.length;o++)n=ps(e[o],t[o]);return n}function ps(e,t){if(e===t)return!0;let n=Aa(e),o=Aa(t);if(n||o)return n&&o?e.getTime()===t.getTime():!1;if(n=es(e),o=es(t),n||o)return e===t;if(n=z(e),o=z(t),n||o)return n&&o?gh(e,t):!1;if(n=be(e),o=be(t),n||o){if(!n||!o)return!1;const s=Object.keys(e).length,r=Object.keys(t).length;if(s!==r)return!1;for(const i in e){const a=e.hasOwnProperty(i),l=t.hasOwnProperty(i);if(a&&!l||!a&&l||!ps(e[i],t[i]))return!1}}return String(e)===String(t)}function Cl(e,t){return e.findIndex(n=>ps(n,t))}const fe=e=>xe(e)?e:e==null?"":z(e)||be(e)&&(e.toString===_u||!Z(e.toString))?JSON.stringify(e,vu,2):String(e),vu=(e,t)=>t&&t.__v_isRef?vu(e,t.value):oo(t)?{[`Map(${t.size})`]:[...t.entries()].reduce((n,[o,s])=>(n[`${o} =>`]=s,n),{})}:Co(t)?{[`Set(${t.size})`]:[...t.values()]}:be(t)&&!z(t)&&!wu(t)?String(t):t,$e={},no=[],yt=()=>{},mh=()=>!1,bh=/^on[^a-z]/,yr=e=>bh.test(e),Pl=e=>e.startsWith("onUpdate:"),He=Object.assign,Sl=(e,t)=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)},vh=Object.prototype.hasOwnProperty,re=(e,t)=>vh.call(e,t),z=Array.isArray,oo=e=>Po(e)==="[object Map]",Co=e=>Po(e)==="[object Set]",Aa=e=>Po(e)==="[object Date]",yh=e=>Po(e)==="[object RegExp]",Z=e=>typeof e=="function",xe=e=>typeof e=="string",es=e=>typeof e=="symbol",be=e=>e!==null&&typeof e=="object",yu=e=>be(e)&&Z(e.then)&&Z(e.catch),_u=Object.prototype.toString,Po=e=>_u.call(e),_h=e=>Po(e).slice(8,-1),wu=e=>Po(e)==="[object Object]",kl=e=>xe(e)&&e!=="NaN"&&e[0]!=="-"&&""+parseInt(e,10)===e,Us=$l(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),_r=e=>{const t=Object.create(null);return n=>t[n]||(t[n]=e(n))},wh=/-(\w)/g,Dt=_r(e=>e.replace(wh,(t,n)=>n?n.toUpperCase():"")),$h=/\B([A-Z])/g,Nn=_r(e=>e.replace($h,"-$1").toLowerCase()),wr=_r(e=>e.charAt(0).toUpperCase()+e.slice(1)),Zr=_r(e=>e?`on${wr(e)}`:""),ts=(e,t)=>!Object.is(e,t),so=(e,t)=>{for(let n=0;n<e.length;n++)e[n](t)},Js=(e,t,n)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:n})},Zs=e=>{const t=parseFloat(e);return isNaN(t)?e:t},Ch=e=>{const t=xe(e)?Number(e):NaN;return isNaN(t)?e:t};let Da;const Ph=()=>Da||(Da=typeof globalThis!="undefined"?globalThis:typeof self!="undefined"?self:typeof window!="undefined"?window:typeof global!="undefined"?global:{});let mt;class $u{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=mt,!t&&mt&&(this.index=(mt.scopes||(mt.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const n=mt;try{return mt=this,t()}finally{mt=n}}}on(){mt=this}off(){mt=this.parent}stop(t){if(this._active){let n,o;for(n=0,o=this.effects.length;n<o;n++)this.effects[n].stop();for(n=0,o=this.cleanups.length;n<o;n++)this.cleanups[n]();if(this.scopes)for(n=0,o=this.scopes.length;n<o;n++)this.scopes[n].stop(!0);if(!this.detached&&this.parent&&!t){const s=this.parent.scopes.pop();s&&s!==this&&(this.parent.scopes[this.index]=s,s.index=this.index)}this.parent=void 0,this._active=!1}}}function Sh(e){return new $u(e)}function kh(e,t=mt){t&&t.active&&t.effects.push(e)}function Oh(){return mt}const Ol=e=>{const t=new Set(e);return t.w=0,t.n=0,t},Cu=e=>(e.w&yn)>0,Pu=e=>(e.n&yn)>0,xh=({deps:e})=>{if(e.length)for(let t=0;t<e.length;t++)e[t].w|=yn},jh=e=>{const{deps:t}=e;if(t.length){let n=0;for(let o=0;o<t.length;o++){const s=t[o];Cu(s)&&!Pu(s)?s.delete(e):t[n++]=s,s.w&=~yn,s.n&=~yn}t.length=n}},Bi=new WeakMap;let Wo=0,yn=1;const Ai=30;let bt;const Dn=Symbol(""),Di=Symbol("");class xl{constructor(t,n=null,o){this.fn=t,this.scheduler=n,this.active=!0,this.deps=[],this.parent=void 0,kh(this,o)}run(){if(!this.active)return this.fn();let t=bt,n=gn;for(;t;){if(t===this)return;t=t.parent}try{return this.parent=bt,bt=this,gn=!0,yn=1<<++Wo,Wo<=Ai?xh(this):Ra(this),this.fn()}finally{Wo<=Ai&&jh(this),yn=1<<--Wo,bt=this.parent,gn=n,this.parent=void 0,this.deferStop&&this.stop()}}stop(){bt===this?this.deferStop=!0:this.active&&(Ra(this),this.onStop&&this.onStop(),this.active=!1)}}function Ra(e){const{deps:t}=e;if(t.length){for(let n=0;n<t.length;n++)t[n].delete(e);t.length=0}}let gn=!0;const Su=[];function So(){Su.push(gn),gn=!1}function ko(){const e=Su.pop();gn=e===void 0?!0:e}function Je(e,t,n){if(gn&&bt){let o=Bi.get(e);o||Bi.set(e,o=new Map);let s=o.get(n);s||o.set(n,s=Ol()),ku(s)}}function ku(e,t){let n=!1;Wo<=Ai?Pu(e)||(e.n|=yn,n=!Cu(e)):n=!e.has(bt),n&&(e.add(bt),bt.deps.push(e))}function Xt(e,t,n,o,s,r){const i=Bi.get(e);if(!i)return;let a=[];if(t==="clear")a=[...i.values()];else if(n==="length"&&z(e)){const l=Number(o);i.forEach((d,c)=>{(c==="length"||c>=l)&&a.push(d)})}else switch(n!==void 0&&a.push(i.get(n)),t){case"add":z(e)?kl(n)&&a.push(i.get("length")):(a.push(i.get(Dn)),oo(e)&&a.push(i.get(Di)));break;case"delete":z(e)||(a.push(i.get(Dn)),oo(e)&&a.push(i.get(Di)));break;case"set":oo(e)&&a.push(i.get(Dn));break}if(a.length===1)a[0]&&Ri(a[0]);else{const l=[];for(const d of a)d&&l.push(...d);Ri(Ol(l))}}function Ri(e,t){const n=z(e)?e:[...e];for(const o of n)o.computed&&Ha(o);for(const o of n)o.computed||Ha(o)}function Ha(e,t){(e!==bt||e.allowRecurse)&&(e.scheduler?e.scheduler():e.run())}const Ih=$l("__proto__,__v_isRef,__isVue"),Ou=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>e!=="arguments"&&e!=="caller").map(e=>Symbol[e]).filter(es)),Th=jl(),Eh=jl(!1,!0),Bh=jl(!0),Ma=Ah();function Ah(){const e={};return["includes","indexOf","lastIndexOf"].forEach(t=>{e[t]=function(...n){const o=ie(this);for(let r=0,i=this.length;r<i;r++)Je(o,"get",r+"");const s=o[t](...n);return s===-1||s===!1?o[t](...n.map(ie)):s}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...n){So();const o=ie(this)[t].apply(this,n);return ko(),o}}),e}function Dh(e){const t=ie(this);return Je(t,"has",e),t.hasOwnProperty(e)}function jl(e=!1,t=!1){return function(o,s,r){if(s==="__v_isReactive")return!e;if(s==="__v_isReadonly")return e;if(s==="__v_isShallow")return t;if(s==="__v_raw"&&r===(e?t?Jh:Eu:t?Tu:Iu).get(o))return o;const i=z(o);if(!e){if(i&&re(Ma,s))return Reflect.get(Ma,s,r);if(s==="hasOwnProperty")return Dh}const a=Reflect.get(o,s,r);return(es(s)?Ou.has(s):Ih(s))||(e||Je(o,"get",s),t)?a:We(a)?i&&kl(s)?a:a.value:be(a)?e?Bu(a):Kt(a):a}}const Rh=xu(),Hh=xu(!0);function xu(e=!1){return function(n,o,s,r){let i=n[o];if(uo(i)&&We(i)&&!We(s))return!1;if(!e&&(!Qs(s)&&!uo(s)&&(i=ie(i),s=ie(s)),!z(n)&&We(i)&&!We(s)))return i.value=s,!0;const a=z(n)&&kl(o)?Number(o)<n.length:re(n,o),l=Reflect.set(n,o,s,r);return n===ie(r)&&(a?ts(s,i)&&Xt(n,"set",o,s):Xt(n,"add",o,s)),l}}function Mh(e,t){const n=re(e,t);e[t];const o=Reflect.deleteProperty(e,t);return o&&n&&Xt(e,"delete",t,void 0),o}function Fh(e,t){const n=Reflect.has(e,t);return(!es(t)||!Ou.has(t))&&Je(e,"has",t),n}function Nh(e){return Je(e,"iterate",z(e)?"length":Dn),Reflect.ownKeys(e)}const ju={get:Th,set:Rh,deleteProperty:Mh,has:Fh,ownKeys:Nh},Lh={get:Bh,set(e,t){return!0},deleteProperty(e,t){return!0}},Uh=He({},ju,{get:Eh,set:Hh}),Il=e=>e,$r=e=>Reflect.getPrototypeOf(e);function xs(e,t,n=!1,o=!1){e=e.__v_raw;const s=ie(e),r=ie(t);n||(t!==r&&Je(s,"get",t),Je(s,"get",r));const{has:i}=$r(s),a=o?Il:n?Bl:ns;if(i.call(s,t))return a(e.get(t));if(i.call(s,r))return a(e.get(r));e!==s&&e.get(t)}function js(e,t=!1){const n=this.__v_raw,o=ie(n),s=ie(e);return t||(e!==s&&Je(o,"has",e),Je(o,"has",s)),e===s?n.has(e):n.has(e)||n.has(s)}function Is(e,t=!1){return e=e.__v_raw,!t&&Je(ie(e),"iterate",Dn),Reflect.get(e,"size",e)}function Fa(e){e=ie(e);const t=ie(this);return $r(t).has.call(t,e)||(t.add(e),Xt(t,"add",e,e)),this}function Na(e,t){t=ie(t);const n=ie(this),{has:o,get:s}=$r(n);let r=o.call(n,e);r||(e=ie(e),r=o.call(n,e));const i=s.call(n,e);return n.set(e,t),r?ts(t,i)&&Xt(n,"set",e,t):Xt(n,"add",e,t),this}function La(e){const t=ie(this),{has:n,get:o}=$r(t);let s=n.call(t,e);s||(e=ie(e),s=n.call(t,e)),o&&o.call(t,e);const r=t.delete(e);return s&&Xt(t,"delete",e,void 0),r}function Ua(){const e=ie(this),t=e.size!==0,n=e.clear();return t&&Xt(e,"clear",void 0,void 0),n}function Ts(e,t){return function(o,s){const r=this,i=r.__v_raw,a=ie(i),l=t?Il:e?Bl:ns;return!e&&Je(a,"iterate",Dn),i.forEach((d,c)=>o.call(s,l(d),l(c),r))}}function Es(e,t,n){return function(...o){const s=this.__v_raw,r=ie(s),i=oo(r),a=e==="entries"||e===Symbol.iterator&&i,l=e==="keys"&&i,d=s[e](...o),c=n?Il:t?Bl:ns;return!t&&Je(r,"iterate",l?Di:Dn),{next(){const{value:p,done:f}=d.next();return f?{value:p,done:f}:{value:a?[c(p[0]),c(p[1])]:c(p),done:f}},[Symbol.iterator](){return this}}}}function tn(e){return function(...t){return e==="delete"?!1:this}}function Vh(){const e={get(r){return xs(this,r)},get size(){return Is(this)},has:js,add:Fa,set:Na,delete:La,clear:Ua,forEach:Ts(!1,!1)},t={get(r){return xs(this,r,!1,!0)},get size(){return Is(this)},has:js,add:Fa,set:Na,delete:La,clear:Ua,forEach:Ts(!1,!0)},n={get(r){return xs(this,r,!0)},get size(){return Is(this,!0)},has(r){return js.call(this,r,!0)},add:tn("add"),set:tn("set"),delete:tn("delete"),clear:tn("clear"),forEach:Ts(!0,!1)},o={get(r){return xs(this,r,!0,!0)},get size(){return Is(this,!0)},has(r){return js.call(this,r,!0)},add:tn("add"),set:tn("set"),delete:tn("delete"),clear:tn("clear"),forEach:Ts(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(r=>{e[r]=Es(r,!1,!1),n[r]=Es(r,!0,!1),t[r]=Es(r,!1,!0),o[r]=Es(r,!0,!0)}),[e,n,t,o]}const[Wh,zh,Gh,qh]=Vh();function Tl(e,t){const n=t?e?qh:Gh:e?zh:Wh;return(o,s,r)=>s==="__v_isReactive"?!e:s==="__v_isReadonly"?e:s==="__v_raw"?o:Reflect.get(re(n,s)&&s in o?n:o,s,r)}const Xh={get:Tl(!1,!1)},Kh={get:Tl(!1,!0)},Yh={get:Tl(!0,!1)},Iu=new WeakMap,Tu=new WeakMap,Eu=new WeakMap,Jh=new WeakMap;function Zh(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function Qh(e){return e.__v_skip||!Object.isExtensible(e)?0:Zh(_h(e))}function Kt(e){return uo(e)?e:El(e,!1,ju,Xh,Iu)}function eg(e){return El(e,!1,Uh,Kh,Tu)}function Bu(e){return El(e,!0,Lh,Yh,Eu)}function El(e,t,n,o,s){if(!be(e)||e.__v_raw&&!(t&&e.__v_isReactive))return e;const r=s.get(e);if(r)return r;const i=Qh(e);if(i===0)return e;const a=new Proxy(e,i===2?o:n);return s.set(e,a),a}function ro(e){return uo(e)?ro(e.__v_raw):!!(e&&e.__v_isReactive)}function uo(e){return!!(e&&e.__v_isReadonly)}function Qs(e){return!!(e&&e.__v_isShallow)}function Au(e){return ro(e)||uo(e)}function ie(e){const t=e&&e.__v_raw;return t?ie(t):e}function Cr(e){return Js(e,"__v_skip",!0),e}const ns=e=>be(e)?Kt(e):e,Bl=e=>be(e)?Bu(e):e;function Du(e){gn&&bt&&(e=ie(e),ku(e.dep||(e.dep=Ol())))}function Ru(e,t){e=ie(e);const n=e.dep;n&&Ri(n)}function We(e){return!!(e&&e.__v_isRef===!0)}function io(e){return tg(e,!1)}function tg(e,t){return We(e)?e:new ng(e,t)}class ng{constructor(t,n){this.__v_isShallow=n,this.dep=void 0,this.__v_isRef=!0,this._rawValue=n?t:ie(t),this._value=n?t:ns(t)}get value(){return Du(this),this._value}set value(t){const n=this.__v_isShallow||Qs(t)||uo(t);t=n?t:ie(t),ts(t,this._rawValue)&&(this._rawValue=t,this._value=n?t:ns(t),Ru(this))}}function og(e){return We(e)?e.value:e}const sg={get:(e,t,n)=>og(Reflect.get(e,t,n)),set:(e,t,n,o)=>{const s=e[t];return We(s)&&!We(n)?(s.value=n,!0):Reflect.set(e,t,n,o)}};function Hu(e){return ro(e)?e:new Proxy(e,sg)}var Mu;class rg{constructor(t,n,o,s){this._setter=n,this.dep=void 0,this.__v_isRef=!0,this[Mu]=!1,this._dirty=!0,this.effect=new xl(t,()=>{this._dirty||(this._dirty=!0,Ru(this))}),this.effect.computed=this,this.effect.active=this._cacheable=!s,this.__v_isReadonly=o}get value(){const t=ie(this);return Du(t),(t._dirty||!t._cacheable)&&(t._dirty=!1,t._value=t.effect.run()),t._value}set value(t){this._setter(t)}}Mu="__v_isReadonly";function ig(e,t,n=!1){let o,s;const r=Z(e);return r?(o=e,s=yt):(o=e.get,s=e.set),new rg(o,s,r||!s,n)}function mn(e,t,n,o){let s;try{s=o?e(...o):e()}catch(r){fs(r,t,n)}return s}function ut(e,t,n,o){if(Z(e)){const r=mn(e,t,n,o);return r&&yu(r)&&r.catch(i=>{fs(i,t,n)}),r}const s=[];for(let r=0;r<e.length;r++)s.push(ut(e[r],t,n,o));return s}function fs(e,t,n,o=!0){const s=t?t.vnode:null;if(t){let r=t.parent;const i=t.proxy,a=n;for(;r;){const d=r.ec;if(d){for(let c=0;c<d.length;c++)if(d[c](e,i,a)===!1)return}r=r.parent}const l=t.appContext.config.errorHandler;if(l){mn(l,null,10,[e,i,a]);return}}lg(e,n,s,o)}function lg(e,t,n,o=!0){console.error(e)}let os=!1,Hi=!1;const Ve=[];let Tt=0;const lo=[];let Gt=null,En=0;const Fu=Promise.resolve();let Al=null;function ag(e){const t=Al||Fu;return e?t.then(this?e.bind(this):e):t}function dg(e){let t=Tt+1,n=Ve.length;for(;t<n;){const o=t+n>>>1;ss(Ve[o])<e?t=o+1:n=o}return t}function Pr(e){(!Ve.length||!Ve.includes(e,os&&e.allowRecurse?Tt+1:Tt))&&(e.id==null?Ve.push(e):Ve.splice(dg(e.id),0,e),Nu())}function Nu(){!os&&!Hi&&(Hi=!0,Al=Fu.then(Uu))}function cg(e){const t=Ve.indexOf(e);t>Tt&&Ve.splice(t,1)}function ug(e){z(e)?lo.push(...e):(!Gt||!Gt.includes(e,e.allowRecurse?En+1:En))&&lo.push(e),Nu()}function Va(e,t=os?Tt+1:0){for(;t<Ve.length;t++){const n=Ve[t];n&&n.pre&&(Ve.splice(t,1),t--,n())}}function Lu(e){if(lo.length){const t=[...new Set(lo)];if(lo.length=0,Gt){Gt.push(...t);return}for(Gt=t,Gt.sort((n,o)=>ss(n)-ss(o)),En=0;En<Gt.length;En++)Gt[En]();Gt=null,En=0}}const ss=e=>e.id==null?1/0:e.id,pg=(e,t)=>{const n=ss(e)-ss(t);if(n===0){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return n};function Uu(e){Hi=!1,os=!0,Ve.sort(pg);const t=yt;try{for(Tt=0;Tt<Ve.length;Tt++){const n=Ve[Tt];n&&n.active!==!1&&mn(n,null,14)}}finally{Tt=0,Ve.length=0,Lu(),os=!1,Al=null,(Ve.length||lo.length)&&Uu()}}function fg(e,t,...n){if(e.isUnmounted)return;const o=e.vnode.props||$e;let s=n;const r=t.startsWith("update:"),i=r&&t.slice(7);if(i&&i in o){const c=`${i==="modelValue"?"model":i}Modifiers`,{number:p,trim:f}=o[c]||$e;f&&(s=n.map(b=>xe(b)?b.trim():b)),p&&(s=n.map(Zs))}let a,l=o[a=Zr(t)]||o[a=Zr(Dt(t))];!l&&r&&(l=o[a=Zr(Nn(t))]),l&&ut(l,e,6,s);const d=o[a+"Once"];if(d){if(!e.emitted)e.emitted={};else if(e.emitted[a])return;e.emitted[a]=!0,ut(d,e,6,s)}}function Vu(e,t,n=!1){const o=t.emitsCache,s=o.get(e);if(s!==void 0)return s;const r=e.emits;let i={},a=!1;if(!Z(e)){const l=d=>{const c=Vu(d,t,!0);c&&(a=!0,He(i,c))};!n&&t.mixins.length&&t.mixins.forEach(l),e.extends&&l(e.extends),e.mixins&&e.mixins.forEach(l)}return!r&&!a?(be(e)&&o.set(e,null),null):(z(r)?r.forEach(l=>i[l]=null):He(i,r),be(e)&&o.set(e,i),i)}function Sr(e,t){return!e||!yr(t)?!1:(t=t.slice(2).replace(/Once$/,""),re(e,t[0].toLowerCase()+t.slice(1))||re(e,Nn(t))||re(e,t))}let Ne=null,kr=null;function er(e){const t=Ne;return Ne=e,kr=e&&e.type.__scopeId||null,t}function ze(e){kr=e}function Ge(){kr=null}function B(e,t=Ne,n){if(!t||e._n)return e;const o=(...s)=>{o._d&&td(-1);const r=er(t);let i;try{i=e(...s)}finally{er(r),o._d&&td(1)}return i};return o._n=!0,o._c=!0,o._d=!0,o}function Qr(e){const{type:t,vnode:n,proxy:o,withProxy:s,props:r,propsOptions:[i],slots:a,attrs:l,emit:d,render:c,renderCache:p,data:f,setupState:b,ctx:v,inheritAttrs:w}=e;let H,D;const $=er(e);try{if(n.shapeFlag&4){const j=s||o;H=It(c.call(j,j,p,r,b,f,v)),D=l}else{const j=t;H=It(j.length>1?j(r,{attrs:l,slots:a,emit:d}):j(r,null)),D=t.props?l:hg(l)}}catch(j){Yo.length=0,fs(j,e,1),H=C(pt)}let x=H;if(D&&w!==!1){const j=Object.keys(D),{shapeFlag:K}=x;j.length&&K&7&&(i&&j.some(Pl)&&(D=gg(D,i)),x=Yt(x,D))}return n.dirs&&(x=Yt(x),x.dirs=x.dirs?x.dirs.concat(n.dirs):n.dirs),n.transition&&(x.transition=n.transition),H=x,er($),H}const hg=e=>{let t;for(const n in e)(n==="class"||n==="style"||yr(n))&&((t||(t={}))[n]=e[n]);return t},gg=(e,t)=>{const n={};for(const o in e)(!Pl(o)||!(o.slice(9)in t))&&(n[o]=e[o]);return n};function mg(e,t,n){const{props:o,children:s,component:r}=e,{props:i,children:a,patchFlag:l}=t,d=r.emitsOptions;if(t.dirs||t.transition)return!0;if(n&&l>=0){if(l&1024)return!0;if(l&16)return o?Wa(o,i,d):!!i;if(l&8){const c=t.dynamicProps;for(let p=0;p<c.length;p++){const f=c[p];if(i[f]!==o[f]&&!Sr(d,f))return!0}}}else return(s||a)&&(!a||!a.$stable)?!0:o===i?!1:o?i?Wa(o,i,d):!0:!!i;return!1}function Wa(e,t,n){const o=Object.keys(t);if(o.length!==Object.keys(e).length)return!0;for(let s=0;s<o.length;s++){const r=o[s];if(t[r]!==e[r]&&!Sr(n,r))return!0}return!1}function bg({vnode:e,parent:t},n){for(;t&&t.subTree===e;)(e=t.vnode).el=n,t=t.parent}const Wu=e=>e.__isSuspense;function vg(e,t){t&&t.pendingBranch?z(e)?t.effects.push(...e):t.effects.push(e):ug(e)}function yg(e,t){if(Oe){let n=Oe.provides;const o=Oe.parent&&Oe.parent.provides;o===n&&(n=Oe.provides=Object.create(o)),n[e]=t}}function Vs(e,t,n=!1){const o=Oe||Ne;if(o){const s=o.parent==null?o.vnode.appContext&&o.vnode.appContext.provides:o.parent.provides;if(s&&e in s)return s[e];if(arguments.length>1)return n&&Z(t)?t.call(o.proxy):t}}const Bs={};function Rn(e,t,n){return zu(e,t,n)}function zu(e,t,{immediate:n,deep:o,flush:s,onTrack:r,onTrigger:i}=$e){const a=Oh()===(Oe==null?void 0:Oe.scope)?Oe:null;let l,d=!1,c=!1;if(We(e)?(l=()=>e.value,d=Qs(e)):ro(e)?(l=()=>e,o=!0):z(e)?(c=!0,d=e.some(x=>ro(x)||Qs(x)),l=()=>e.map(x=>{if(We(x))return x.value;if(ro(x))return An(x);if(Z(x))return mn(x,a,2)})):Z(e)?t?l=()=>mn(e,a,2):l=()=>{if(!(a&&a.isUnmounted))return p&&p(),ut(e,a,3,[f])}:l=yt,t&&o){const x=l;l=()=>An(x())}let p,f=x=>{p=D.onStop=()=>{mn(x,a,4)}},b;if(ho)if(f=yt,t?n&&ut(t,a,3,[l(),c?[]:void 0,f]):l(),s==="sync"){const x=gm();b=x.__watcherHandles||(x.__watcherHandles=[])}else return yt;let v=c?new Array(e.length).fill(Bs):Bs;const w=()=>{if(!!D.active)if(t){const x=D.run();(o||d||(c?x.some((j,K)=>ts(j,v[K])):ts(x,v)))&&(p&&p(),ut(t,a,3,[x,v===Bs?void 0:c&&v[0]===Bs?[]:v,f]),v=x)}else D.run()};w.allowRecurse=!!t;let H;s==="sync"?H=w:s==="post"?H=()=>Me(w,a&&a.suspense):(w.pre=!0,a&&(w.id=a.uid),H=()=>Pr(w));const D=new xl(l,H);t?n?w():v=D.run():s==="post"?Me(D.run.bind(D),a&&a.suspense):D.run();const $=()=>{D.stop(),a&&a.scope&&Sl(a.scope.effects,D)};return b&&b.push($),$}function _g(e,t,n){const o=this.proxy,s=xe(e)?e.includes(".")?Gu(o,e):()=>o[e]:e.bind(o,o);let r;Z(t)?r=t:(r=t.handler,n=t);const i=Oe;fo(this);const a=zu(s,r.bind(o),n);return i?fo(i):Hn(),a}function Gu(e,t){const n=t.split(".");return()=>{let o=e;for(let s=0;s<n.length&&o;s++)o=o[n[s]];return o}}function An(e,t){if(!be(e)||e.__v_skip||(t=t||new Set,t.has(e)))return e;if(t.add(e),We(e))An(e.value,t);else if(z(e))for(let n=0;n<e.length;n++)An(e[n],t);else if(Co(e)||oo(e))e.forEach(n=>{An(n,t)});else if(wu(e))for(const n in e)An(e[n],t);return e}function qu(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return Rl(()=>{e.isMounted=!0}),Ml(()=>{e.isUnmounting=!0}),e}const rt=[Function,Array],wg={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:rt,onEnter:rt,onAfterEnter:rt,onEnterCancelled:rt,onBeforeLeave:rt,onLeave:rt,onAfterLeave:rt,onLeaveCancelled:rt,onBeforeAppear:rt,onAppear:rt,onAfterAppear:rt,onAppearCancelled:rt},setup(e,{slots:t}){const n=Vl(),o=qu();let s;return()=>{const r=t.default&&Dl(t.default(),!0);if(!r||!r.length)return;let i=r[0];if(r.length>1){for(const w of r)if(w.type!==pt){i=w;break}}const a=ie(e),{mode:l}=a;if(o.isLeaving)return ei(i);const d=za(i);if(!d)return ei(i);const c=rs(d,a,o,n);po(d,c);const p=n.subTree,f=p&&za(p);let b=!1;const{getTransitionKey:v}=d.type;if(v){const w=v();s===void 0?s=w:w!==s&&(s=w,b=!0)}if(f&&f.type!==pt&&(!pn(d,f)||b)){const w=rs(f,a,o,n);if(po(f,w),l==="out-in")return o.isLeaving=!0,w.afterLeave=()=>{o.isLeaving=!1,n.update.active!==!1&&n.update()},ei(i);l==="in-out"&&d.type!==pt&&(w.delayLeave=(H,D,$)=>{const x=Xu(o,f);x[String(f.key)]=f,H._leaveCb=()=>{D(),H._leaveCb=void 0,delete c.delayedLeave},c.delayedLeave=$})}return i}}},$g=wg;function Xu(e,t){const{leavingVNodes:n}=e;let o=n.get(t.type);return o||(o=Object.create(null),n.set(t.type,o)),o}function rs(e,t,n,o){const{appear:s,mode:r,persisted:i=!1,onBeforeEnter:a,onEnter:l,onAfterEnter:d,onEnterCancelled:c,onBeforeLeave:p,onLeave:f,onAfterLeave:b,onLeaveCancelled:v,onBeforeAppear:w,onAppear:H,onAfterAppear:D,onAppearCancelled:$}=t,x=String(e.key),j=Xu(n,e),K=(N,oe)=>{N&&ut(N,o,9,oe)},Q=(N,oe)=>{const te=oe[1];K(N,oe),z(N)?N.every(he=>he.length<=1)&&te():N.length<=1&&te()},le={mode:r,persisted:i,beforeEnter(N){let oe=a;if(!n.isMounted)if(s)oe=w||a;else return;N._leaveCb&&N._leaveCb(!0);const te=j[x];te&&pn(e,te)&&te.el._leaveCb&&te.el._leaveCb(),K(oe,[N])},enter(N){let oe=l,te=d,he=c;if(!n.isMounted)if(s)oe=H||l,te=D||d,he=$||c;else return;let M=!1;const ve=N._enterCb=Ue=>{M||(M=!0,Ue?K(he,[N]):K(te,[N]),le.delayedLeave&&le.delayedLeave(),N._enterCb=void 0)};oe?Q(oe,[N,ve]):ve()},leave(N,oe){const te=String(e.key);if(N._enterCb&&N._enterCb(!0),n.isUnmounting)return oe();K(p,[N]);let he=!1;const M=N._leaveCb=ve=>{he||(he=!0,oe(),ve?K(v,[N]):K(b,[N]),N._leaveCb=void 0,j[te]===e&&delete j[te])};j[te]=e,f?Q(f,[N,M]):M()},clone(N){return rs(N,t,n,o)}};return le}function ei(e){if(hs(e))return e=Yt(e),e.children=null,e}function za(e){return hs(e)?e.children?e.children[0]:void 0:e}function po(e,t){e.shapeFlag&6&&e.component?po(e.component.subTree,t):e.shapeFlag&128?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function Dl(e,t=!1,n){let o=[],s=0;for(let r=0;r<e.length;r++){let i=e[r];const a=n==null?i.key:String(n)+String(i.key!=null?i.key:r);i.type===U?(i.patchFlag&128&&s++,o=o.concat(Dl(i.children,t,a))):(t||i.type!==pt)&&o.push(a!=null?Yt(i,{key:a}):i)}if(s>1)for(let r=0;r<o.length;r++)o[r].patchFlag=-2;return o}function ee(e){return Z(e)?{setup:e,name:e.name}:e}const ao=e=>!!e.type.__asyncLoader;function Ga(e){Z(e)&&(e={loader:e});const{loader:t,loadingComponent:n,errorComponent:o,delay:s=200,timeout:r,suspensible:i=!0,onError:a}=e;let l=null,d,c=0;const p=()=>(c++,l=null,f()),f=()=>{let b;return l||(b=l=t().catch(v=>{if(v=v instanceof Error?v:new Error(String(v)),a)return new Promise((w,H)=>{a(v,()=>w(p()),()=>H(v),c+1)});throw v}).then(v=>b!==l&&l?l:(v&&(v.__esModule||v[Symbol.toStringTag]==="Module")&&(v=v.default),d=v,v)))};return ee({name:"AsyncComponentWrapper",__asyncLoader:f,get __asyncResolved(){return d},setup(){const b=Oe;if(d)return()=>ti(d,b);const v=$=>{l=null,fs($,b,13,!o)};if(i&&b.suspense||ho)return f().then($=>()=>ti($,b)).catch($=>(v($),()=>o?C(o,{error:$}):null));const w=io(!1),H=io(),D=io(!!s);return s&&setTimeout(()=>{D.value=!1},s),r!=null&&setTimeout(()=>{if(!w.value&&!H.value){const $=new Error(`Async component timed out after ${r}ms.`);v($),H.value=$}},r),f().then(()=>{w.value=!0,b.parent&&hs(b.parent.vnode)&&Pr(b.parent.update)}).catch($=>{v($),H.value=$}),()=>{if(w.value&&d)return ti(d,b);if(H.value&&o)return C(o,{error:H.value});if(n&&!D.value)return C(n)}}})}function ti(e,t){const{ref:n,props:o,children:s,ce:r}=t.vnode,i=C(e,o,s);return i.ref=n,i.ce=r,delete t.vnode.ce,i}const hs=e=>e.type.__isKeepAlive,Cg={name:"KeepAlive",__isKeepAlive:!0,props:{include:[String,RegExp,Array],exclude:[String,RegExp,Array],max:[String,Number]},setup(e,{slots:t}){const n=Vl(),o=n.ctx;if(!o.renderer)return()=>{const $=t.default&&t.default();return $&&$.length===1?$[0]:$};const s=new Map,r=new Set;let i=null;const a=n.suspense,{renderer:{p:l,m:d,um:c,o:{createElement:p}}}=o,f=p("div");o.activate=($,x,j,K,Q)=>{const le=$.component;d($,x,j,0,a),l(le.vnode,$,x,j,le,a,K,$.slotScopeIds,Q),Me(()=>{le.isDeactivated=!1,le.a&&so(le.a);const N=$.props&&$.props.onVnodeMounted;N&&lt(N,le.parent,$)},a)},o.deactivate=$=>{const x=$.component;d($,f,null,1,a),Me(()=>{x.da&&so(x.da);const j=$.props&&$.props.onVnodeUnmounted;j&&lt(j,x.parent,$),x.isDeactivated=!0},a)};function b($){ni($),c($,n,a,!0)}function v($){s.forEach((x,j)=>{const K=Wi(x.type);K&&(!$||!$(K))&&w(j)})}function w($){const x=s.get($);!i||!pn(x,i)?b(x):i&&ni(i),s.delete($),r.delete($)}Rn(()=>[e.include,e.exclude],([$,x])=>{$&&v(j=>zo($,j)),x&&v(j=>!zo(x,j))},{flush:"post",deep:!0});let H=null;const D=()=>{H!=null&&s.set(H,oi(n.subTree))};return Rl(D),Hl(D),Ml(()=>{s.forEach($=>{const{subTree:x,suspense:j}=n,K=oi(x);if($.type===K.type&&$.key===K.key){ni(K);const Q=K.component.da;Q&&Me(Q,j);return}b($)})}),()=>{if(H=null,!t.default)return null;const $=t.default(),x=$[0];if($.length>1)return i=null,$;if(!ls(x)||!(x.shapeFlag&4)&&!(x.shapeFlag&128))return i=null,x;let j=oi(x);const K=j.type,Q=Wi(ao(j)?j.type.__asyncResolved||{}:K),{include:le,exclude:N,max:oe}=e;if(le&&(!Q||!zo(le,Q))||N&&Q&&zo(N,Q))return i=j,x;const te=j.key==null?K:j.key,he=s.get(te);return j.el&&(j=Yt(j),x.shapeFlag&128&&(x.ssContent=j)),H=te,he?(j.el=he.el,j.component=he.component,j.transition&&po(j,j.transition),j.shapeFlag|=512,r.delete(te),r.add(te)):(r.add(te),oe&&r.size>parseInt(oe,10)&&w(r.values().next().value)),j.shapeFlag|=256,i=j,Wu(x.type)?x:j}}},Pg=Cg;function zo(e,t){return z(e)?e.some(n=>zo(n,t)):xe(e)?e.split(",").includes(t):yh(e)?e.test(t):!1}function Sg(e,t){Ku(e,"a",t)}function kg(e,t){Ku(e,"da",t)}function Ku(e,t,n=Oe){const o=e.__wdc||(e.__wdc=()=>{let s=n;for(;s;){if(s.isDeactivated)return;s=s.parent}return e()});if(Or(t,o,n),n){let s=n.parent;for(;s&&s.parent;)hs(s.parent.vnode)&&Og(o,t,n,s),s=s.parent}}function Og(e,t,n,o){const s=Or(t,e,o,!0);Yu(()=>{Sl(o[t],s)},n)}function ni(e){e.shapeFlag&=-257,e.shapeFlag&=-513}function oi(e){return e.shapeFlag&128?e.ssContent:e}function Or(e,t,n=Oe,o=!1){if(n){const s=n[e]||(n[e]=[]),r=t.__weh||(t.__weh=(...i)=>{if(n.isUnmounted)return;So(),fo(n);const a=ut(t,n,e,i);return Hn(),ko(),a});return o?s.unshift(r):s.push(r),r}}const Zt=e=>(t,n=Oe)=>(!ho||e==="sp")&&Or(e,(...o)=>t(...o),n),xg=Zt("bm"),Rl=Zt("m"),jg=Zt("bu"),Hl=Zt("u"),Ml=Zt("bum"),Yu=Zt("um"),Ig=Zt("sp"),Tg=Zt("rtg"),Eg=Zt("rtc");function Bg(e,t=Oe){Or("ec",e,t)}function de(e,t){const n=Ne;if(n===null)return e;const o=Ir(n)||n.proxy,s=e.dirs||(e.dirs=[]);for(let r=0;r<t.length;r++){let[i,a,l,d=$e]=t[r];i&&(Z(i)&&(i={mounted:i,updated:i}),i.deep&&An(a),s.push({dir:i,instance:o,value:a,oldValue:void 0,arg:l,modifiers:d}))}return e}function Sn(e,t,n,o){const s=e.dirs,r=t&&t.dirs;for(let i=0;i<s.length;i++){const a=s[i];r&&(a.oldValue=r[i].value);let l=a.dir[o];l&&(So(),ut(l,n,8,[e.el,a,e,t]),ko())}}const Ju="components";function E(e,t){return Dg(Ju,e,!0,t)||e}const Ag=Symbol();function Dg(e,t,n=!0,o=!1){const s=Ne||Oe;if(s){const r=s.type;if(e===Ju){const a=Wi(r,!1);if(a&&(a===t||a===Dt(t)||a===wr(Dt(t))))return r}const i=qa(s[e]||r[e],t)||qa(s.appContext[e],t);return!i&&o?r:i}}function qa(e,t){return e&&(e[t]||e[Dt(t)]||e[wr(Dt(t))])}function Ce(e,t,n,o){let s;const r=n&&n[o];if(z(e)||xe(e)){s=new Array(e.length);for(let i=0,a=e.length;i<a;i++)s[i]=t(e[i],i,void 0,r&&r[i])}else if(typeof e=="number"){s=new Array(e);for(let i=0;i<e;i++)s[i]=t(i+1,i,void 0,r&&r[i])}else if(be(e))if(e[Symbol.iterator])s=Array.from(e,(i,a)=>t(i,a,void 0,r&&r[a]));else{const i=Object.keys(e);s=new Array(i.length);for(let a=0,l=i.length;a<l;a++){const d=i[a];s[a]=t(e[d],d,a,r&&r[a])}}else s=[];return n&&(n[o]=s),s}function qt(e,t,n={},o,s){if(Ne.isCE||Ne.parent&&ao(Ne.parent)&&Ne.parent.isCE)return t!=="default"&&(n.name=t),C("slot",n,o&&o());let r=e[t];r&&r._c&&(r._d=!1),g();const i=r&&Zu(r(n)),a=L(U,{key:n.key||i&&i.key||`_${t}`},i||(o?o():[]),i&&e._===1?64:-2);return!s&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function Zu(e){return e.some(t=>ls(t)?!(t.type===pt||t.type===U&&!Zu(t.children)):!0)?e:null}const Mi=e=>e?cp(e)?Ir(e)||e.proxy:Mi(e.parent):null,Xo=He(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>e.props,$attrs:e=>e.attrs,$slots:e=>e.slots,$refs:e=>e.refs,$parent:e=>Mi(e.parent),$root:e=>Mi(e.root),$emit:e=>e.emit,$options:e=>Fl(e),$forceUpdate:e=>e.f||(e.f=()=>Pr(e.update)),$nextTick:e=>e.n||(e.n=ag.bind(e.proxy)),$watch:e=>_g.bind(e)}),si=(e,t)=>e!==$e&&!e.__isScriptSetup&&re(e,t),Rg={get({_:e},t){const{ctx:n,setupState:o,data:s,props:r,accessCache:i,type:a,appContext:l}=e;let d;if(t[0]!=="$"){const b=i[t];if(b!==void 0)switch(b){case 1:return o[t];case 2:return s[t];case 4:return n[t];case 3:return r[t]}else{if(si(o,t))return i[t]=1,o[t];if(s!==$e&&re(s,t))return i[t]=2,s[t];if((d=e.propsOptions[0])&&re(d,t))return i[t]=3,r[t];if(n!==$e&&re(n,t))return i[t]=4,n[t];Fi&&(i[t]=0)}}const c=Xo[t];let p,f;if(c)return t==="$attrs"&&Je(e,"get",t),c(e);if((p=a.__cssModules)&&(p=p[t]))return p;if(n!==$e&&re(n,t))return i[t]=4,n[t];if(f=l.config.globalProperties,re(f,t))return f[t]},set({_:e},t,n){const{data:o,setupState:s,ctx:r}=e;return si(s,t)?(s[t]=n,!0):o!==$e&&re(o,t)?(o[t]=n,!0):re(e.props,t)||t[0]==="$"&&t.slice(1)in e?!1:(r[t]=n,!0)},has({_:{data:e,setupState:t,accessCache:n,ctx:o,appContext:s,propsOptions:r}},i){let a;return!!n[i]||e!==$e&&re(e,i)||si(t,i)||(a=r[0])&&re(a,i)||re(o,i)||re(Xo,i)||re(s.config.globalProperties,i)},defineProperty(e,t,n){return n.get!=null?e._.accessCache[t]=0:re(n,"value")&&this.set(e,t,n.value,null),Reflect.defineProperty(e,t,n)}};let Fi=!0;function Hg(e){const t=Fl(e),n=e.proxy,o=e.ctx;Fi=!1,t.beforeCreate&&Xa(t.beforeCreate,e,"bc");const{data:s,computed:r,methods:i,watch:a,provide:l,inject:d,created:c,beforeMount:p,mounted:f,beforeUpdate:b,updated:v,activated:w,deactivated:H,beforeDestroy:D,beforeUnmount:$,destroyed:x,unmounted:j,render:K,renderTracked:Q,renderTriggered:le,errorCaptured:N,serverPrefetch:oe,expose:te,inheritAttrs:he,components:M,directives:ve,filters:Ue}=t;if(d&&Mg(d,o,null,e.appContext.config.unwrapInjectedRef),i)for(const Se in i){const ye=i[Se];Z(ye)&&(o[Se]=ye.bind(n))}if(s){const Se=s.call(n,n);be(Se)&&(e.data=Kt(Se))}if(Fi=!0,r)for(const Se in r){const ye=r[Se],Cn=Z(ye)?ye.bind(n,n):Z(ye.get)?ye.get.bind(n,n):yt,ks=!Z(ye)&&Z(ye.set)?ye.set.bind(n):yt,Pn=nr({get:Cn,set:ks});Object.defineProperty(o,Se,{enumerable:!0,configurable:!0,get:()=>Pn.value,set:Pt=>Pn.value=Pt})}if(a)for(const Se in a)Qu(a[Se],o,n,Se);if(l){const Se=Z(l)?l.call(n):l;Reflect.ownKeys(Se).forEach(ye=>{yg(ye,Se[ye])})}c&&Xa(c,e,"c");function Pe(Se,ye){z(ye)?ye.forEach(Cn=>Se(Cn.bind(n))):ye&&Se(ye.bind(n))}if(Pe(xg,p),Pe(Rl,f),Pe(jg,b),Pe(Hl,v),Pe(Sg,w),Pe(kg,H),Pe(Bg,N),Pe(Eg,Q),Pe(Tg,le),Pe(Ml,$),Pe(Yu,j),Pe(Ig,oe),z(te))if(te.length){const Se=e.exposed||(e.exposed={});te.forEach(ye=>{Object.defineProperty(Se,ye,{get:()=>n[ye],set:Cn=>n[ye]=Cn})})}else e.exposed||(e.exposed={});K&&e.render===yt&&(e.render=K),he!=null&&(e.inheritAttrs=he),M&&(e.components=M),ve&&(e.directives=ve)}function Mg(e,t,n=yt,o=!1){z(e)&&(e=Ni(e));for(const s in e){const r=e[s];let i;be(r)?"default"in r?i=Vs(r.from||s,r.default,!0):i=Vs(r.from||s):i=Vs(r),We(i)&&o?Object.defineProperty(t,s,{enumerable:!0,configurable:!0,get:()=>i.value,set:a=>i.value=a}):t[s]=i}}function Xa(e,t,n){ut(z(e)?e.map(o=>o.bind(t.proxy)):e.bind(t.proxy),t,n)}function Qu(e,t,n,o){const s=o.includes(".")?Gu(n,o):()=>n[o];if(xe(e)){const r=t[e];Z(r)&&Rn(s,r)}else if(Z(e))Rn(s,e.bind(n));else if(be(e))if(z(e))e.forEach(r=>Qu(r,t,n,o));else{const r=Z(e.handler)?e.handler.bind(n):t[e.handler];Z(r)&&Rn(s,r,e)}}function Fl(e){const t=e.type,{mixins:n,extends:o}=t,{mixins:s,optionsCache:r,config:{optionMergeStrategies:i}}=e.appContext,a=r.get(t);let l;return a?l=a:!s.length&&!n&&!o?l=t:(l={},s.length&&s.forEach(d=>tr(l,d,i,!0)),tr(l,t,i)),be(t)&&r.set(t,l),l}function tr(e,t,n,o=!1){const{mixins:s,extends:r}=t;r&&tr(e,r,n,!0),s&&s.forEach(i=>tr(e,i,n,!0));for(const i in t)if(!(o&&i==="expose")){const a=Fg[i]||n&&n[i];e[i]=a?a(e[i],t[i]):t[i]}return e}const Fg={data:Ka,props:Tn,emits:Tn,methods:Tn,computed:Tn,beforeCreate:Xe,created:Xe,beforeMount:Xe,mounted:Xe,beforeUpdate:Xe,updated:Xe,beforeDestroy:Xe,beforeUnmount:Xe,destroyed:Xe,unmounted:Xe,activated:Xe,deactivated:Xe,errorCaptured:Xe,serverPrefetch:Xe,components:Tn,directives:Tn,watch:Lg,provide:Ka,inject:Ng};function Ka(e,t){return t?e?function(){return He(Z(e)?e.call(this,this):e,Z(t)?t.call(this,this):t)}:t:e}function Ng(e,t){return Tn(Ni(e),Ni(t))}function Ni(e){if(z(e)){const t={};for(let n=0;n<e.length;n++)t[e[n]]=e[n];return t}return e}function Xe(e,t){return e?[...new Set([].concat(e,t))]:t}function Tn(e,t){return e?He(He(Object.create(null),e),t):t}function Lg(e,t){if(!e)return t;if(!t)return e;const n=He(Object.create(null),e);for(const o in t)n[o]=Xe(e[o],t[o]);return n}function Ug(e,t,n,o=!1){const s={},r={};Js(r,jr,1),e.propsDefaults=Object.create(null),ep(e,t,s,r);for(const i in e.propsOptions[0])i in s||(s[i]=void 0);n?e.props=o?s:eg(s):e.type.props?e.props=s:e.props=r,e.attrs=r}function Vg(e,t,n,o){const{props:s,attrs:r,vnode:{patchFlag:i}}=e,a=ie(s),[l]=e.propsOptions;let d=!1;if((o||i>0)&&!(i&16)){if(i&8){const c=e.vnode.dynamicProps;for(let p=0;p<c.length;p++){let f=c[p];if(Sr(e.emitsOptions,f))continue;const b=t[f];if(l)if(re(r,f))b!==r[f]&&(r[f]=b,d=!0);else{const v=Dt(f);s[v]=Li(l,a,v,b,e,!1)}else b!==r[f]&&(r[f]=b,d=!0)}}}else{ep(e,t,s,r)&&(d=!0);let c;for(const p in a)(!t||!re(t,p)&&((c=Nn(p))===p||!re(t,c)))&&(l?n&&(n[p]!==void 0||n[c]!==void 0)&&(s[p]=Li(l,a,p,void 0,e,!0)):delete s[p]);if(r!==a)for(const p in r)(!t||!re(t,p)&&!0)&&(delete r[p],d=!0)}d&&Xt(e,"set","$attrs")}function ep(e,t,n,o){const[s,r]=e.propsOptions;let i=!1,a;if(t)for(let l in t){if(Us(l))continue;const d=t[l];let c;s&&re(s,c=Dt(l))?!r||!r.includes(c)?n[c]=d:(a||(a={}))[c]=d:Sr(e.emitsOptions,l)||(!(l in o)||d!==o[l])&&(o[l]=d,i=!0)}if(r){const l=ie(n),d=a||$e;for(let c=0;c<r.length;c++){const p=r[c];n[p]=Li(s,l,p,d[p],e,!re(d,p))}}return i}function Li(e,t,n,o,s,r){const i=e[n];if(i!=null){const a=re(i,"default");if(a&&o===void 0){const l=i.default;if(i.type!==Function&&Z(l)){const{propsDefaults:d}=s;n in d?o=d[n]:(fo(s),o=d[n]=l.call(null,t),Hn())}else o=l}i[0]&&(r&&!a?o=!1:i[1]&&(o===""||o===Nn(n))&&(o=!0))}return o}function tp(e,t,n=!1){const o=t.propsCache,s=o.get(e);if(s)return s;const r=e.props,i={},a=[];let l=!1;if(!Z(e)){const c=p=>{l=!0;const[f,b]=tp(p,t,!0);He(i,f),b&&a.push(...b)};!n&&t.mixins.length&&t.mixins.forEach(c),e.extends&&c(e.extends),e.mixins&&e.mixins.forEach(c)}if(!r&&!l)return be(e)&&o.set(e,no),no;if(z(r))for(let c=0;c<r.length;c++){const p=Dt(r[c]);Ya(p)&&(i[p]=$e)}else if(r)for(const c in r){const p=Dt(c);if(Ya(p)){const f=r[c],b=i[p]=z(f)||Z(f)?{type:f}:Object.assign({},f);if(b){const v=Qa(Boolean,b.type),w=Qa(String,b.type);b[0]=v>-1,b[1]=w<0||v<w,(v>-1||re(b,"default"))&&a.push(p)}}}const d=[i,a];return be(e)&&o.set(e,d),d}function Ya(e){return e[0]!=="$"}function Ja(e){const t=e&&e.toString().match(/^\s*(function|class) (\w+)/);return t?t[2]:e===null?"null":""}function Za(e,t){return Ja(e)===Ja(t)}function Qa(e,t){return z(t)?t.findIndex(n=>Za(n,e)):Z(t)&&Za(t,e)?0:-1}const np=e=>e[0]==="_"||e==="$stable",Nl=e=>z(e)?e.map(It):[It(e)],Wg=(e,t,n)=>{if(t._n)return t;const o=B((...s)=>Nl(t(...s)),n);return o._c=!1,o},op=(e,t,n)=>{const o=e._ctx;for(const s in e){if(np(s))continue;const r=e[s];if(Z(r))t[s]=Wg(s,r,o);else if(r!=null){const i=Nl(r);t[s]=()=>i}}},sp=(e,t)=>{const n=Nl(t);e.slots.default=()=>n},zg=(e,t)=>{if(e.vnode.shapeFlag&32){const n=t._;n?(e.slots=ie(t),Js(t,"_",n)):op(t,e.slots={})}else e.slots={},t&&sp(e,t);Js(e.slots,jr,1)},Gg=(e,t,n)=>{const{vnode:o,slots:s}=e;let r=!0,i=$e;if(o.shapeFlag&32){const a=t._;a?n&&a===1?r=!1:(He(s,t),!n&&a===1&&delete s._):(r=!t.$stable,op(t,s)),i=t}else t&&(sp(e,t),i={default:1});if(r)for(const a in s)!np(a)&&!(a in i)&&delete s[a]};function rp(){return{app:null,config:{isNativeTag:mh,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let qg=0;function Xg(e,t){return function(o,s=null){Z(o)||(o=Object.assign({},o)),s!=null&&!be(s)&&(s=null);const r=rp(),i=new Set;let a=!1;const l=r.app={_uid:qg++,_component:o,_props:s,_container:null,_context:r,_instance:null,version:mm,get config(){return r.config},set config(d){},use(d,...c){return i.has(d)||(d&&Z(d.install)?(i.add(d),d.install(l,...c)):Z(d)&&(i.add(d),d(l,...c))),l},mixin(d){return r.mixins.includes(d)||r.mixins.push(d),l},component(d,c){return c?(r.components[d]=c,l):r.components[d]},directive(d,c){return c?(r.directives[d]=c,l):r.directives[d]},mount(d,c,p){if(!a){const f=C(o,s);return f.appContext=r,c&&t?t(f,d):e(f,d,p),a=!0,l._container=d,d.__vue_app__=l,Ir(f.component)||f.component.proxy}},unmount(){a&&(e(null,l._container),delete l._container.__vue_app__)},provide(d,c){return r.provides[d]=c,l}};return l}}function Ui(e,t,n,o,s=!1){if(z(e)){e.forEach((f,b)=>Ui(f,t&&(z(t)?t[b]:t),n,o,s));return}if(ao(o)&&!s)return;const r=o.shapeFlag&4?Ir(o.component)||o.component.proxy:o.el,i=s?null:r,{i:a,r:l}=e,d=t&&t.r,c=a.refs===$e?a.refs={}:a.refs,p=a.setupState;if(d!=null&&d!==l&&(xe(d)?(c[d]=null,re(p,d)&&(p[d]=null)):We(d)&&(d.value=null)),Z(l))mn(l,a,12,[i,c]);else{const f=xe(l),b=We(l);if(f||b){const v=()=>{if(e.f){const w=f?re(p,l)?p[l]:c[l]:l.value;s?z(w)&&Sl(w,r):z(w)?w.includes(r)||w.push(r):f?(c[l]=[r],re(p,l)&&(p[l]=c[l])):(l.value=[r],e.k&&(c[e.k]=l.value))}else f?(c[l]=i,re(p,l)&&(p[l]=i)):b&&(l.value=i,e.k&&(c[e.k]=i))};i?(v.id=-1,Me(v,n)):v()}}}const Me=vg;function Kg(e){return Yg(e)}function Yg(e,t){const n=Ph();n.__VUE__=!0;const{insert:o,remove:s,patchProp:r,createElement:i,createText:a,createComment:l,setText:d,setElementText:c,parentNode:p,nextSibling:f,setScopeId:b=yt,insertStaticContent:v}=e,w=(h,m,_,S=null,P=null,T=null,R=!1,I=null,A=!!m.dynamicChildren)=>{if(h===m)return;h&&!pn(h,m)&&(S=Os(h),Pt(h,P,T,!0),h=null),m.patchFlag===-2&&(A=!1,m.dynamicChildren=null);const{type:k,ref:V,shapeFlag:F}=m;switch(k){case xr:H(h,m,_,S);break;case pt:D(h,m,_,S);break;case Ws:h==null&&$(m,_,S,R);break;case U:M(h,m,_,S,P,T,R,I,A);break;default:F&1?K(h,m,_,S,P,T,R,I,A):F&6?ve(h,m,_,S,P,T,R,I,A):(F&64||F&128)&&k.process(h,m,_,S,P,T,R,I,A,Wn)}V!=null&&P&&Ui(V,h&&h.ref,T,m||h,!m)},H=(h,m,_,S)=>{if(h==null)o(m.el=a(m.children),_,S);else{const P=m.el=h.el;m.children!==h.children&&d(P,m.children)}},D=(h,m,_,S)=>{h==null?o(m.el=l(m.children||""),_,S):m.el=h.el},$=(h,m,_,S)=>{[h.el,h.anchor]=v(h.children,m,_,S,h.el,h.anchor)},x=({el:h,anchor:m},_,S)=>{let P;for(;h&&h!==m;)P=f(h),o(h,_,S),h=P;o(m,_,S)},j=({el:h,anchor:m})=>{let _;for(;h&&h!==m;)_=f(h),s(h),h=_;s(m)},K=(h,m,_,S,P,T,R,I,A)=>{R=R||m.type==="svg",h==null?Q(m,_,S,P,T,R,I,A):oe(h,m,P,T,R,I,A)},Q=(h,m,_,S,P,T,R,I)=>{let A,k;const{type:V,props:F,shapeFlag:W,transition:J,dirs:se}=h;if(A=h.el=i(h.type,T,F&&F.is,F),W&8?c(A,h.children):W&16&&N(h.children,A,null,S,P,T&&V!=="foreignObject",R,I),se&&Sn(h,null,S,"created"),le(A,h,h.scopeId,R,S),F){for(const ge in F)ge!=="value"&&!Us(ge)&&r(A,ge,null,F[ge],T,h.children,S,P,Mt);"value"in F&&r(A,"value",null,F.value),(k=F.onVnodeBeforeMount)&&lt(k,S,h)}se&&Sn(h,null,S,"beforeMount");const _e=(!P||P&&!P.pendingBranch)&&J&&!J.persisted;_e&&J.beforeEnter(A),o(A,m,_),((k=F&&F.onVnodeMounted)||_e||se)&&Me(()=>{k&&lt(k,S,h),_e&&J.enter(A),se&&Sn(h,null,S,"mounted")},P)},le=(h,m,_,S,P)=>{if(_&&b(h,_),S)for(let T=0;T<S.length;T++)b(h,S[T]);if(P){let T=P.subTree;if(m===T){const R=P.vnode;le(h,R,R.scopeId,R.slotScopeIds,P.parent)}}},N=(h,m,_,S,P,T,R,I,A=0)=>{for(let k=A;k<h.length;k++){const V=h[k]=I?un(h[k]):It(h[k]);w(null,V,m,_,S,P,T,R,I)}},oe=(h,m,_,S,P,T,R)=>{const I=m.el=h.el;let{patchFlag:A,dynamicChildren:k,dirs:V}=m;A|=h.patchFlag&16;const F=h.props||$e,W=m.props||$e;let J;_&&kn(_,!1),(J=W.onVnodeBeforeUpdate)&&lt(J,_,m,h),V&&Sn(m,h,_,"beforeUpdate"),_&&kn(_,!0);const se=P&&m.type!=="foreignObject";if(k?te(h.dynamicChildren,k,I,_,S,se,T):R||ye(h,m,I,null,_,S,se,T,!1),A>0){if(A&16)he(I,m,F,W,_,S,P);else if(A&2&&F.class!==W.class&&r(I,"class",null,W.class,P),A&4&&r(I,"style",F.style,W.style,P),A&8){const _e=m.dynamicProps;for(let ge=0;ge<_e.length;ge++){const je=_e[ge],ht=F[je],zn=W[je];(zn!==ht||je==="value")&&r(I,je,ht,zn,P,h.children,_,S,Mt)}}A&1&&h.children!==m.children&&c(I,m.children)}else!R&&k==null&&he(I,m,F,W,_,S,P);((J=W.onVnodeUpdated)||V)&&Me(()=>{J&&lt(J,_,m,h),V&&Sn(m,h,_,"updated")},S)},te=(h,m,_,S,P,T,R)=>{for(let I=0;I<m.length;I++){const A=h[I],k=m[I],V=A.el&&(A.type===U||!pn(A,k)||A.shapeFlag&70)?p(A.el):_;w(A,k,V,null,S,P,T,R,!0)}},he=(h,m,_,S,P,T,R)=>{if(_!==S){if(_!==$e)for(const I in _)!Us(I)&&!(I in S)&&r(h,I,_[I],null,R,m.children,P,T,Mt);for(const I in S){if(Us(I))continue;const A=S[I],k=_[I];A!==k&&I!=="value"&&r(h,I,k,A,R,m.children,P,T,Mt)}"value"in S&&r(h,"value",_.value,S.value)}},M=(h,m,_,S,P,T,R,I,A)=>{const k=m.el=h?h.el:a(""),V=m.anchor=h?h.anchor:a("");let{patchFlag:F,dynamicChildren:W,slotScopeIds:J}=m;J&&(I=I?I.concat(J):J),h==null?(o(k,_,S),o(V,_,S),N(m.children,_,V,P,T,R,I,A)):F>0&&F&64&&W&&h.dynamicChildren?(te(h.dynamicChildren,W,_,P,T,R,I),(m.key!=null||P&&m===P.subTree)&&Ll(h,m,!0)):ye(h,m,_,V,P,T,R,I,A)},ve=(h,m,_,S,P,T,R,I,A)=>{m.slotScopeIds=I,h==null?m.shapeFlag&512?P.ctx.activate(m,_,S,R,A):Ue(m,_,S,P,T,R,A):Ct(h,m,A)},Ue=(h,m,_,S,P,T,R)=>{const I=h.component=am(h,S,P);if(hs(h)&&(I.ctx.renderer=Wn),dm(I),I.asyncDep){if(P&&P.registerDep(I,Pe),!h.el){const A=I.subTree=C(pt);D(null,A,m,_)}return}Pe(I,h,m,_,P,T,R)},Ct=(h,m,_)=>{const S=m.component=h.component;if(mg(h,m,_))if(S.asyncDep&&!S.asyncResolved){Se(S,m,_);return}else S.next=m,cg(S.update),S.update();else m.el=h.el,S.vnode=m},Pe=(h,m,_,S,P,T,R)=>{const I=()=>{if(h.isMounted){let{next:V,bu:F,u:W,parent:J,vnode:se}=h,_e=V,ge;kn(h,!1),V?(V.el=se.el,Se(h,V,R)):V=se,F&&so(F),(ge=V.props&&V.props.onVnodeBeforeUpdate)&&lt(ge,J,V,se),kn(h,!0);const je=Qr(h),ht=h.subTree;h.subTree=je,w(ht,je,p(ht.el),Os(ht),h,P,T),V.el=je.el,_e===null&&bg(h,je.el),W&&Me(W,P),(ge=V.props&&V.props.onVnodeUpdated)&&Me(()=>lt(ge,J,V,se),P)}else{let V;const{el:F,props:W}=m,{bm:J,m:se,parent:_e}=h,ge=ao(m);if(kn(h,!1),J&&so(J),!ge&&(V=W&&W.onVnodeBeforeMount)&&lt(V,_e,m),kn(h,!0),F&&Jr){const je=()=>{h.subTree=Qr(h),Jr(F,h.subTree,h,P,null)};ge?m.type.__asyncLoader().then(()=>!h.isUnmounted&&je()):je()}else{const je=h.subTree=Qr(h);w(null,je,_,S,h,P,T),m.el=je.el}if(se&&Me(se,P),!ge&&(V=W&&W.onVnodeMounted)){const je=m;Me(()=>lt(V,_e,je),P)}(m.shapeFlag&256||_e&&ao(_e.vnode)&&_e.vnode.shapeFlag&256)&&h.a&&Me(h.a,P),h.isMounted=!0,m=_=S=null}},A=h.effect=new xl(I,()=>Pr(k),h.scope),k=h.update=()=>A.run();k.id=h.uid,kn(h,!0),k()},Se=(h,m,_)=>{m.component=h;const S=h.vnode.props;h.vnode=m,h.next=null,Vg(h,m.props,S,_),Gg(h,m.children,_),So(),Va(),ko()},ye=(h,m,_,S,P,T,R,I,A=!1)=>{const k=h&&h.children,V=h?h.shapeFlag:0,F=m.children,{patchFlag:W,shapeFlag:J}=m;if(W>0){if(W&128){ks(k,F,_,S,P,T,R,I,A);return}else if(W&256){Cn(k,F,_,S,P,T,R,I,A);return}}J&8?(V&16&&Mt(k,P,T),F!==k&&c(_,F)):V&16?J&16?ks(k,F,_,S,P,T,R,I,A):Mt(k,P,T,!0):(V&8&&c(_,""),J&16&&N(F,_,S,P,T,R,I,A))},Cn=(h,m,_,S,P,T,R,I,A)=>{h=h||no,m=m||no;const k=h.length,V=m.length,F=Math.min(k,V);let W;for(W=0;W<F;W++){const J=m[W]=A?un(m[W]):It(m[W]);w(h[W],J,_,null,P,T,R,I,A)}k>V?Mt(h,P,T,!0,!1,F):N(m,_,S,P,T,R,I,A,F)},ks=(h,m,_,S,P,T,R,I,A)=>{let k=0;const V=m.length;let F=h.length-1,W=V-1;for(;k<=F&&k<=W;){const J=h[k],se=m[k]=A?un(m[k]):It(m[k]);if(pn(J,se))w(J,se,_,null,P,T,R,I,A);else break;k++}for(;k<=F&&k<=W;){const J=h[F],se=m[W]=A?un(m[W]):It(m[W]);if(pn(J,se))w(J,se,_,null,P,T,R,I,A);else break;F--,W--}if(k>F){if(k<=W){const J=W+1,se=J<V?m[J].el:S;for(;k<=W;)w(null,m[k]=A?un(m[k]):It(m[k]),_,se,P,T,R,I,A),k++}}else if(k>W)for(;k<=F;)Pt(h[k],P,T,!0),k++;else{const J=k,se=k,_e=new Map;for(k=se;k<=W;k++){const Qe=m[k]=A?un(m[k]):It(m[k]);Qe.key!=null&&_e.set(Qe.key,k)}let ge,je=0;const ht=W-se+1;let zn=!1,Ta=0;const Ro=new Array(ht);for(k=0;k<ht;k++)Ro[k]=0;for(k=J;k<=F;k++){const Qe=h[k];if(je>=ht){Pt(Qe,P,T,!0);continue}let St;if(Qe.key!=null)St=_e.get(Qe.key);else for(ge=se;ge<=W;ge++)if(Ro[ge-se]===0&&pn(Qe,m[ge])){St=ge;break}St===void 0?Pt(Qe,P,T,!0):(Ro[St-se]=k+1,St>=Ta?Ta=St:zn=!0,w(Qe,m[St],_,null,P,T,R,I,A),je++)}const Ea=zn?Jg(Ro):no;for(ge=Ea.length-1,k=ht-1;k>=0;k--){const Qe=se+k,St=m[Qe],Ba=Qe+1<V?m[Qe+1].el:S;Ro[k]===0?w(null,St,_,Ba,P,T,R,I,A):zn&&(ge<0||k!==Ea[ge]?Pn(St,_,Ba,2):ge--)}}},Pn=(h,m,_,S,P=null)=>{const{el:T,type:R,transition:I,children:A,shapeFlag:k}=h;if(k&6){Pn(h.component.subTree,m,_,S);return}if(k&128){h.suspense.move(m,_,S);return}if(k&64){R.move(h,m,_,Wn);return}if(R===U){o(T,m,_);for(let F=0;F<A.length;F++)Pn(A[F],m,_,S);o(h.anchor,m,_);return}if(R===Ws){x(h,m,_);return}if(S!==2&&k&1&&I)if(S===0)I.beforeEnter(T),o(T,m,_),Me(()=>I.enter(T),P);else{const{leave:F,delayLeave:W,afterLeave:J}=I,se=()=>o(T,m,_),_e=()=>{F(T,()=>{se(),J&&J()})};W?W(T,se,_e):_e()}else o(T,m,_)},Pt=(h,m,_,S=!1,P=!1)=>{const{type:T,props:R,ref:I,children:A,dynamicChildren:k,shapeFlag:V,patchFlag:F,dirs:W}=h;if(I!=null&&Ui(I,null,_,h,!0),V&256){m.ctx.deactivate(h);return}const J=V&1&&W,se=!ao(h);let _e;if(se&&(_e=R&&R.onVnodeBeforeUnmount)&&lt(_e,m,h),V&6)ah(h.component,_,S);else{if(V&128){h.suspense.unmount(_,S);return}J&&Sn(h,null,m,"beforeUnmount"),V&64?h.type.remove(h,m,_,P,Wn,S):k&&(T!==U||F>0&&F&64)?Mt(k,m,_,!1,!0):(T===U&&F&384||!P&&V&16)&&Mt(A,m,_),S&&ja(h)}(se&&(_e=R&&R.onVnodeUnmounted)||J)&&Me(()=>{_e&&lt(_e,m,h),J&&Sn(h,null,m,"unmounted")},_)},ja=h=>{const{type:m,el:_,anchor:S,transition:P}=h;if(m===U){lh(_,S);return}if(m===Ws){j(h);return}const T=()=>{s(_),P&&!P.persisted&&P.afterLeave&&P.afterLeave()};if(h.shapeFlag&1&&P&&!P.persisted){const{leave:R,delayLeave:I}=P,A=()=>R(_,T);I?I(h.el,T,A):A()}else T()},lh=(h,m)=>{let _;for(;h!==m;)_=f(h),s(h),h=_;s(m)},ah=(h,m,_)=>{const{bum:S,scope:P,update:T,subTree:R,um:I}=h;S&&so(S),P.stop(),T&&(T.active=!1,Pt(R,h,m,_)),I&&Me(I,m),Me(()=>{h.isUnmounted=!0},m),m&&m.pendingBranch&&!m.isUnmounted&&h.asyncDep&&!h.asyncResolved&&h.suspenseId===m.pendingId&&(m.deps--,m.deps===0&&m.resolve())},Mt=(h,m,_,S=!1,P=!1,T=0)=>{for(let R=T;R<h.length;R++)Pt(h[R],m,_,S,P)},Os=h=>h.shapeFlag&6?Os(h.component.subTree):h.shapeFlag&128?h.suspense.next():f(h.anchor||h.el),Ia=(h,m,_)=>{h==null?m._vnode&&Pt(m._vnode,null,null,!0):w(m._vnode||null,h,m,null,null,null,_),Va(),Lu(),m._vnode=h},Wn={p:w,um:Pt,m:Pn,r:ja,mt:Ue,mc:N,pc:ye,pbc:te,n:Os,o:e};let Yr,Jr;return t&&([Yr,Jr]=t(Wn)),{render:Ia,hydrate:Yr,createApp:Xg(Ia,Yr)}}function kn({effect:e,update:t},n){e.allowRecurse=t.allowRecurse=n}function Ll(e,t,n=!1){const o=e.children,s=t.children;if(z(o)&&z(s))for(let r=0;r<o.length;r++){const i=o[r];let a=s[r];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=s[r]=un(s[r]),a.el=i.el),n||Ll(i,a)),a.type===xr&&(a.el=i.el)}}function Jg(e){const t=e.slice(),n=[0];let o,s,r,i,a;const l=e.length;for(o=0;o<l;o++){const d=e[o];if(d!==0){if(s=n[n.length-1],e[s]<d){t[o]=s,n.push(o);continue}for(r=0,i=n.length-1;r<i;)a=r+i>>1,e[n[a]]<d?r=a+1:i=a;d<e[n[r]]&&(r>0&&(t[o]=n[r-1]),n[r]=o)}}for(r=n.length,i=n[r-1];r-- >0;)n[r]=i,i=t[i];return n}const Zg=e=>e.__isTeleport,Ko=e=>e&&(e.disabled||e.disabled===""),ed=e=>typeof SVGElement!="undefined"&&e instanceof SVGElement,Vi=(e,t)=>{const n=e&&e.to;return xe(n)?t?t(n):null:n},Qg={__isTeleport:!0,process(e,t,n,o,s,r,i,a,l,d){const{mc:c,pc:p,pbc:f,o:{insert:b,querySelector:v,createText:w,createComment:H}}=d,D=Ko(t.props);let{shapeFlag:$,children:x,dynamicChildren:j}=t;if(e==null){const K=t.el=w(""),Q=t.anchor=w("");b(K,n,o),b(Q,n,o);const le=t.target=Vi(t.props,v),N=t.targetAnchor=w("");le&&(b(N,le),i=i||ed(le));const oe=(te,he)=>{$&16&&c(x,te,he,s,r,i,a,l)};D?oe(n,Q):le&&oe(le,N)}else{t.el=e.el;const K=t.anchor=e.anchor,Q=t.target=e.target,le=t.targetAnchor=e.targetAnchor,N=Ko(e.props),oe=N?n:Q,te=N?K:le;if(i=i||ed(Q),j?(f(e.dynamicChildren,j,oe,s,r,i,a),Ll(e,t,!0)):l||p(e,t,oe,te,s,r,i,a,!1),D)N||As(t,n,K,d,1);else if((t.props&&t.props.to)!==(e.props&&e.props.to)){const he=t.target=Vi(t.props,v);he&&As(t,he,null,d,0)}else N&&As(t,Q,le,d,1)}lp(t)},remove(e,t,n,o,{um:s,o:{remove:r}},i){const{shapeFlag:a,children:l,anchor:d,targetAnchor:c,target:p,props:f}=e;if(p&&r(c),(i||!Ko(f))&&(r(d),a&16))for(let b=0;b<l.length;b++){const v=l[b];s(v,t,n,!0,!!v.dynamicChildren)}},move:As,hydrate:em};function As(e,t,n,{o:{insert:o},m:s},r=2){r===0&&o(e.targetAnchor,t,n);const{el:i,anchor:a,shapeFlag:l,children:d,props:c}=e,p=r===2;if(p&&o(i,t,n),(!p||Ko(c))&&l&16)for(let f=0;f<d.length;f++)s(d[f],t,n,2);p&&o(a,t,n)}function em(e,t,n,o,s,r,{o:{nextSibling:i,parentNode:a,querySelector:l}},d){const c=t.target=Vi(t.props,l);if(c){const p=c._lpa||c.firstChild;if(t.shapeFlag&16)if(Ko(t.props))t.anchor=d(i(e),t,a(e),n,o,s,r),t.targetAnchor=p;else{t.anchor=i(e);let f=p;for(;f;)if(f=i(f),f&&f.nodeType===8&&f.data==="teleport anchor"){t.targetAnchor=f,c._lpa=t.targetAnchor&&i(t.targetAnchor);break}d(p,t,c,n,o,s,r)}lp(t)}return t.anchor&&i(t.anchor)}const ip=Qg;function lp(e){const t=e.ctx;if(t&&t.ut){let n=e.children[0].el;for(;n!==e.targetAnchor;)n.nodeType===1&&n.setAttribute("data-v-owner",t.uid),n=n.nextSibling;t.ut()}}const U=Symbol(void 0),xr=Symbol(void 0),pt=Symbol(void 0),Ws=Symbol(void 0),Yo=[];let vt=null;function g(e=!1){Yo.push(vt=e?null:[])}function tm(){Yo.pop(),vt=Yo[Yo.length-1]||null}let is=1;function td(e){is+=e}function ap(e){return e.dynamicChildren=is>0?vt||no:null,tm(),is>0&&vt&&vt.push(e),e}function y(e,t,n,o,s,r){return ap(u(e,t,n,o,s,r,!0))}function L(e,t,n,o,s){return ap(C(e,t,n,o,s,!0))}function ls(e){return e?e.__v_isVNode===!0:!1}function pn(e,t){return e.type===t.type&&e.key===t.key}const jr="__vInternal",dp=({key:e})=>e!=null?e:null,zs=({ref:e,ref_key:t,ref_for:n})=>e!=null?xe(e)||We(e)||Z(e)?{i:Ne,r:e,k:t,f:!!n}:e:null;function u(e,t=null,n=null,o=0,s=null,r=e===U?0:1,i=!1,a=!1){const l={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&dp(t),ref:t&&zs(t),scopeId:kr,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:r,patchFlag:o,dynamicProps:s,dynamicChildren:null,appContext:null,ctx:Ne};return a?(Ul(l,n),r&128&&e.normalize(l)):n&&(l.shapeFlag|=xe(n)?8:16),is>0&&!i&&vt&&(l.patchFlag>0||r&6)&&l.patchFlag!==32&&vt.push(l),l}const C=nm;function nm(e,t=null,n=null,o=0,s=null,r=!1){if((!e||e===Ag)&&(e=pt),ls(e)){const a=Yt(e,t,!0);return n&&Ul(a,n),is>0&&!r&&vt&&(a.shapeFlag&6?vt[vt.indexOf(e)]=a:vt.push(a)),a.patchFlag|=-2,a}if(fm(e)&&(e=e.__vccOpts),t){t=om(t);let{class:a,style:l}=t;a&&!xe(a)&&(t.class=pe(a)),be(l)&&(Au(l)&&!z(l)&&(l=He({},l)),t.style=Re(l))}const i=xe(e)?1:Wu(e)?128:Zg(e)?64:be(e)?4:Z(e)?2:0;return u(e,t,n,o,s,i,r,!0)}function om(e){return e?Au(e)||jr in e?He({},e):e:null}function Yt(e,t,n=!1){const{props:o,ref:s,patchFlag:r,children:i}=e,a=t?rm(o||{},t):o;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&dp(a),ref:t&&t.ref?n&&s?z(s)?s.concat(zs(t)):[s,zs(t)]:zs(t):s,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:i,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==U?r===-1?16:r|16:r,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&Yt(e.ssContent),ssFallback:e.ssFallback&&Yt(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx,ce:e.ce}}function O(e=" ",t=0){return C(xr,null,e,t)}function sm(e,t){const n=C(Ws,null,e);return n.staticCount=t,n}function X(e="",t=!1){return t?(g(),L(pt,null,e)):C(pt,null,e)}function It(e){return e==null||typeof e=="boolean"?C(pt):z(e)?C(U,null,e.slice()):typeof e=="object"?un(e):C(xr,null,String(e))}function un(e){return e.el===null&&e.patchFlag!==-1||e.memo?e:Yt(e)}function Ul(e,t){let n=0;const{shapeFlag:o}=e;if(t==null)t=null;else if(z(t))n=16;else if(typeof t=="object")if(o&65){const s=t.default;s&&(s._c&&(s._d=!1),Ul(e,s()),s._c&&(s._d=!0));return}else{n=32;const s=t._;!s&&!(jr in t)?t._ctx=Ne:s===3&&Ne&&(Ne.slots._===1?t._=1:(t._=2,e.patchFlag|=1024))}else Z(t)?(t={default:t,_ctx:Ne},n=32):(t=String(t),o&64?(n=16,t=[O(t)]):n=8);e.children=t,e.shapeFlag|=n}function rm(...e){const t={};for(let n=0;n<e.length;n++){const o=e[n];for(const s in o)if(s==="class")t.class!==o.class&&(t.class=pe([t.class,o.class]));else if(s==="style")t.style=Re([t.style,o.style]);else if(yr(s)){const r=t[s],i=o[s];i&&r!==i&&!(z(r)&&r.includes(i))&&(t[s]=r?[].concat(r,i):i)}else s!==""&&(t[s]=o[s])}return t}function lt(e,t,n,o=null){ut(e,t,7,[n,o])}const im=rp();let lm=0;function am(e,t,n){const o=e.type,s=(t?t.appContext:e.appContext)||im,r={uid:lm++,vnode:e,type:o,parent:t,appContext:s,root:null,next:null,subTree:null,effect:null,update:null,scope:new $u(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:t?t.provides:Object.create(s.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:tp(o,s),emitsOptions:Vu(o,s),emit:null,emitted:null,propsDefaults:$e,inheritAttrs:o.inheritAttrs,ctx:$e,data:$e,props:$e,attrs:$e,slots:$e,refs:$e,setupState:$e,setupContext:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return r.ctx={_:r},r.root=t?t.root:r,r.emit=fg.bind(null,r),e.ce&&e.ce(r),r}let Oe=null;const Vl=()=>Oe||Ne,fo=e=>{Oe=e,e.scope.on()},Hn=()=>{Oe&&Oe.scope.off(),Oe=null};function cp(e){return e.vnode.shapeFlag&4}let ho=!1;function dm(e,t=!1){ho=t;const{props:n,children:o}=e.vnode,s=cp(e);Ug(e,n,s,t),zg(e,o);const r=s?cm(e,t):void 0;return ho=!1,r}function cm(e,t){const n=e.type;e.accessCache=Object.create(null),e.proxy=Cr(new Proxy(e.ctx,Rg));const{setup:o}=n;if(o){const s=e.setupContext=o.length>1?pm(e):null;fo(e),So();const r=mn(o,e,0,[e.props,s]);if(ko(),Hn(),yu(r)){if(r.then(Hn,Hn),t)return r.then(i=>{nd(e,i,t)}).catch(i=>{fs(i,e,0)});e.asyncDep=r}else nd(e,r,t)}else up(e,t)}function nd(e,t,n){Z(t)?e.type.__ssrInlineRender?e.ssrRender=t:e.render=t:be(t)&&(e.setupState=Hu(t)),up(e,n)}let od;function up(e,t,n){const o=e.type;if(!e.render){if(!t&&od&&!o.render){const s=o.template||Fl(e).template;if(s){const{isCustomElement:r,compilerOptions:i}=e.appContext.config,{delimiters:a,compilerOptions:l}=o,d=He(He({isCustomElement:r,delimiters:a},i),l);o.render=od(s,d)}}e.render=o.render||yt}fo(e),So(),Hg(e),ko(),Hn()}function um(e){return new Proxy(e.attrs,{get(t,n){return Je(e,"get","$attrs"),t[n]}})}function pm(e){const t=o=>{e.exposed=o||{}};let n;return{get attrs(){return n||(n=um(e))},slots:e.slots,emit:e.emit,expose:t}}function Ir(e){if(e.exposed)return e.exposeProxy||(e.exposeProxy=new Proxy(Hu(Cr(e.exposed)),{get(t,n){if(n in t)return t[n];if(n in Xo)return Xo[n](e)},has(t,n){return n in t||n in Xo}}))}function Wi(e,t=!0){return Z(e)?e.displayName||e.name:e.name||t&&e.__name}function fm(e){return Z(e)&&"__vccOpts"in e}const nr=(e,t)=>ig(e,t,ho);function sd(e,t,n){const o=arguments.length;return o===2?be(t)&&!z(t)?ls(t)?C(e,null,[t]):C(e,t):C(e,null,t):(o>3?n=Array.prototype.slice.call(arguments,2):o===3&&ls(n)&&(n=[n]),C(e,t,n))}const hm=Symbol(""),gm=()=>Vs(hm),mm="3.2.47",bm="http://www.w3.org/2000/svg",Bn=typeof document!="undefined"?document:null,rd=Bn&&Bn.createElement("template"),vm={insert:(e,t,n)=>{t.insertBefore(e,n||null)},remove:e=>{const t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,n,o)=>{const s=t?Bn.createElementNS(bm,e):Bn.createElement(e,n?{is:n}:void 0);return e==="select"&&o&&o.multiple!=null&&s.setAttribute("multiple",o.multiple),s},createText:e=>Bn.createTextNode(e),createComment:e=>Bn.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>Bn.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,n,o,s,r){const i=n?n.previousSibling:t.lastChild;if(s&&(s===r||s.nextSibling))for(;t.insertBefore(s.cloneNode(!0),n),!(s===r||!(s=s.nextSibling)););else{rd.innerHTML=o?`<svg>${e}</svg>`:e;const a=rd.content;if(o){const l=a.firstChild;for(;l.firstChild;)a.appendChild(l.firstChild);a.removeChild(l)}t.insertBefore(a,n)}return[i?i.nextSibling:t.firstChild,n?n.previousSibling:t.lastChild]}};function ym(e,t,n){const o=e._vtc;o&&(t=(t?[t,...o]:[...o]).join(" ")),t==null?e.removeAttribute("class"):n?e.setAttribute("class",t):e.className=t}function _m(e,t,n){const o=e.style,s=xe(n);if(n&&!s){if(t&&!xe(t))for(const r in t)n[r]==null&&zi(o,r,"");for(const r in n)zi(o,r,n[r])}else{const r=o.display;s?t!==n&&(o.cssText=n):t&&e.removeAttribute("style"),"_vod"in e&&(o.display=r)}}const id=/\s*!important$/;function zi(e,t,n){if(z(n))n.forEach(o=>zi(e,t,o));else if(n==null&&(n=""),t.startsWith("--"))e.setProperty(t,n);else{const o=wm(e,t);id.test(n)?e.setProperty(Nn(o),n.replace(id,""),"important"):e[o]=n}}const ld=["Webkit","Moz","ms"],ri={};function wm(e,t){const n=ri[t];if(n)return n;let o=Dt(t);if(o!=="filter"&&o in e)return ri[t]=o;o=wr(o);for(let s=0;s<ld.length;s++){const r=ld[s]+o;if(r in e)return ri[t]=r}return t}const ad="http://www.w3.org/1999/xlink";function $m(e,t,n,o,s){if(o&&t.startsWith("xlink:"))n==null?e.removeAttributeNS(ad,t.slice(6,t.length)):e.setAttributeNS(ad,t,n);else{const r=hh(t);n==null||r&&!bu(n)?e.removeAttribute(t):e.setAttribute(t,r?"":n)}}function Cm(e,t,n,o,s,r,i){if(t==="innerHTML"||t==="textContent"){o&&i(o,s,r),e[t]=n==null?"":n;return}if(t==="value"&&e.tagName!=="PROGRESS"&&!e.tagName.includes("-")){e._value=n;const l=n==null?"":n;(e.value!==l||e.tagName==="OPTION")&&(e.value=l),n==null&&e.removeAttribute(t);return}let a=!1;if(n===""||n==null){const l=typeof e[t];l==="boolean"?n=bu(n):n==null&&l==="string"?(n="",a=!0):l==="number"&&(n=0,a=!0)}try{e[t]=n}catch(l){}a&&e.removeAttribute(t)}function fn(e,t,n,o){e.addEventListener(t,n,o)}function Pm(e,t,n,o){e.removeEventListener(t,n,o)}function Sm(e,t,n,o,s=null){const r=e._vei||(e._vei={}),i=r[t];if(o&&i)i.value=o;else{const[a,l]=km(t);if(o){const d=r[t]=jm(o,s);fn(e,a,d,l)}else i&&(Pm(e,a,i,l),r[t]=void 0)}}const dd=/(?:Once|Passive|Capture)$/;function km(e){let t;if(dd.test(e)){t={};let o;for(;o=e.match(dd);)e=e.slice(0,e.length-o[0].length),t[o[0].toLowerCase()]=!0}return[e[2]===":"?e.slice(3):Nn(e.slice(2)),t]}let ii=0;const Om=Promise.resolve(),xm=()=>ii||(Om.then(()=>ii=0),ii=Date.now());function jm(e,t){const n=o=>{if(!o._vts)o._vts=Date.now();else if(o._vts<=n.attached)return;ut(Im(o,n.value),t,5,[o])};return n.value=e,n.attached=xm(),n}function Im(e,t){if(z(t)){const n=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{n.call(e),e._stopped=!0},t.map(o=>s=>!s._stopped&&o&&o(s))}else return t}const cd=/^on[a-z]/,Tm=(e,t,n,o,s=!1,r,i,a,l)=>{t==="class"?ym(e,o,s):t==="style"?_m(e,n,o):yr(t)?Pl(t)||Sm(e,t,n,o,i):(t[0]==="."?(t=t.slice(1),!0):t[0]==="^"?(t=t.slice(1),!1):Em(e,t,o,s))?Cm(e,t,o,r,i,a,l):(t==="true-value"?e._trueValue=o:t==="false-value"&&(e._falseValue=o),$m(e,t,o,s))};function Em(e,t,n,o){return o?!!(t==="innerHTML"||t==="textContent"||t in e&&cd.test(t)&&Z(n)):t==="spellcheck"||t==="draggable"||t==="translate"||t==="form"||t==="list"&&e.tagName==="INPUT"||t==="type"&&e.tagName==="TEXTAREA"||cd.test(t)&&xe(n)?!1:t in e}const nn="transition",Ho="animation",pp={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},Bm=He({},$g.props,pp),On=(e,t=[])=>{z(e)?e.forEach(n=>n(...t)):e&&e(...t)},ud=e=>e?z(e)?e.some(t=>t.length>1):e.length>1:!1;function Am(e){const t={};for(const M in e)M in pp||(t[M]=e[M]);if(e.css===!1)return t;const{name:n="v",type:o,duration:s,enterFromClass:r=`${n}-enter-from`,enterActiveClass:i=`${n}-enter-active`,enterToClass:a=`${n}-enter-to`,appearFromClass:l=r,appearActiveClass:d=i,appearToClass:c=a,leaveFromClass:p=`${n}-leave-from`,leaveActiveClass:f=`${n}-leave-active`,leaveToClass:b=`${n}-leave-to`}=e,v=Dm(s),w=v&&v[0],H=v&&v[1],{onBeforeEnter:D,onEnter:$,onEnterCancelled:x,onLeave:j,onLeaveCancelled:K,onBeforeAppear:Q=D,onAppear:le=$,onAppearCancelled:N=x}=t,oe=(M,ve,Ue)=>{cn(M,ve?c:a),cn(M,ve?d:i),Ue&&Ue()},te=(M,ve)=>{M._isLeaving=!1,cn(M,p),cn(M,b),cn(M,f),ve&&ve()},he=M=>(ve,Ue)=>{const Ct=M?le:$,Pe=()=>oe(ve,M,Ue);On(Ct,[ve,Pe]),pd(()=>{cn(ve,M?l:r),Lt(ve,M?c:a),ud(Ct)||fd(ve,o,w,Pe)})};return He(t,{onBeforeEnter(M){On(D,[M]),Lt(M,r),Lt(M,i)},onBeforeAppear(M){On(Q,[M]),Lt(M,l),Lt(M,d)},onEnter:he(!1),onAppear:he(!0),onLeave(M,ve){M._isLeaving=!0;const Ue=()=>te(M,ve);Lt(M,p),hp(),Lt(M,f),pd(()=>{!M._isLeaving||(cn(M,p),Lt(M,b),ud(j)||fd(M,o,H,Ue))}),On(j,[M,Ue])},onEnterCancelled(M){oe(M,!1),On(x,[M])},onAppearCancelled(M){oe(M,!0),On(N,[M])},onLeaveCancelled(M){te(M),On(K,[M])}})}function Dm(e){if(e==null)return null;if(be(e))return[li(e.enter),li(e.leave)];{const t=li(e);return[t,t]}}function li(e){return Ch(e)}function Lt(e,t){t.split(/\s+/).forEach(n=>n&&e.classList.add(n)),(e._vtc||(e._vtc=new Set)).add(t)}function cn(e,t){t.split(/\s+/).forEach(o=>o&&e.classList.remove(o));const{_vtc:n}=e;n&&(n.delete(t),n.size||(e._vtc=void 0))}function pd(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let Rm=0;function fd(e,t,n,o){const s=e._endId=++Rm,r=()=>{s===e._endId&&o()};if(n)return setTimeout(r,n);const{type:i,timeout:a,propCount:l}=fp(e,t);if(!i)return o();const d=i+"end";let c=0;const p=()=>{e.removeEventListener(d,f),r()},f=b=>{b.target===e&&++c>=l&&p()};setTimeout(()=>{c<l&&p()},a+1),e.addEventListener(d,f)}function fp(e,t){const n=window.getComputedStyle(e),o=v=>(n[v]||"").split(", "),s=o(`${nn}Delay`),r=o(`${nn}Duration`),i=hd(s,r),a=o(`${Ho}Delay`),l=o(`${Ho}Duration`),d=hd(a,l);let c=null,p=0,f=0;t===nn?i>0&&(c=nn,p=i,f=r.length):t===Ho?d>0&&(c=Ho,p=d,f=l.length):(p=Math.max(i,d),c=p>0?i>d?nn:Ho:null,f=c?c===nn?r.length:l.length:0);const b=c===nn&&/\b(transform|all)(,|$)/.test(o(`${nn}Property`).toString());return{type:c,timeout:p,propCount:f,hasTransform:b}}function hd(e,t){for(;e.length<t.length;)e=e.concat(e);return Math.max(...t.map((n,o)=>gd(n)+gd(e[o])))}function gd(e){return Number(e.slice(0,-1).replace(",","."))*1e3}function hp(){return document.body.offsetHeight}const gp=new WeakMap,mp=new WeakMap,bp={name:"TransitionGroup",props:He({},Bm,{tag:String,moveClass:String}),setup(e,{slots:t}){const n=Vl(),o=qu();let s,r;return Hl(()=>{if(!s.length)return;const i=e.moveClass||`${e.name||"v"}-move`;if(!Lm(s[0].el,n.vnode.el,i))return;s.forEach(Mm),s.forEach(Fm);const a=s.filter(Nm);hp(),a.forEach(l=>{const d=l.el,c=d.style;Lt(d,i),c.transform=c.webkitTransform=c.transitionDuration="";const p=d._moveCb=f=>{f&&f.target!==d||(!f||/transform$/.test(f.propertyName))&&(d.removeEventListener("transitionend",p),d._moveCb=null,cn(d,i))};d.addEventListener("transitionend",p)})}),()=>{const i=ie(e),a=Am(i);let l=i.tag||U;s=r,r=t.default?Dl(t.default()):[];for(let d=0;d<r.length;d++){const c=r[d];c.key!=null&&po(c,rs(c,a,o,n))}if(s)for(let d=0;d<s.length;d++){const c=s[d];po(c,rs(c,a,o,n)),gp.set(c,c.el.getBoundingClientRect())}return C(l,null,r)}}},Hm=e=>delete e.mode;bp.props;const VT=bp;function Mm(e){const t=e.el;t._moveCb&&t._moveCb(),t._enterCb&&t._enterCb()}function Fm(e){mp.set(e,e.el.getBoundingClientRect())}function Nm(e){const t=gp.get(e),n=mp.get(e),o=t.left-n.left,s=t.top-n.top;if(o||s){const r=e.el.style;return r.transform=r.webkitTransform=`translate(${o}px,${s}px)`,r.transitionDuration="0s",e}}function Lm(e,t,n){const o=e.cloneNode();e._vtc&&e._vtc.forEach(i=>{i.split(/\s+/).forEach(a=>a&&o.classList.remove(a))}),n.split(/\s+/).forEach(i=>i&&o.classList.add(i)),o.style.display="none";const s=t.nodeType===1?t:t.parentNode;s.appendChild(o);const{hasTransform:r}=fp(o);return s.removeChild(o),r}const go=e=>{const t=e.props["onUpdate:modelValue"]||!1;return z(t)?n=>so(t,n):t};function Um(e){e.target.composing=!0}function md(e){const t=e.target;t.composing&&(t.composing=!1,t.dispatchEvent(new Event("input")))}const Ee={created(e,{modifiers:{lazy:t,trim:n,number:o}},s){e._assign=go(s);const r=o||s.props&&s.props.type==="number";fn(e,t?"change":"input",i=>{if(i.target.composing)return;let a=e.value;n&&(a=a.trim()),r&&(a=Zs(a)),e._assign(a)}),n&&fn(e,"change",()=>{e.value=e.value.trim()}),t||(fn(e,"compositionstart",Um),fn(e,"compositionend",md),fn(e,"change",md))},mounted(e,{value:t}){e.value=t==null?"":t},beforeUpdate(e,{value:t,modifiers:{lazy:n,trim:o,number:s}},r){if(e._assign=go(r),e.composing||document.activeElement===e&&e.type!=="range"&&(n||o&&e.value.trim()===t||(s||e.type==="number")&&Zs(e.value)===t))return;const i=t==null?"":t;e.value!==i&&(e.value=i)}},Vm={deep:!0,created(e,t,n){e._assign=go(n),fn(e,"change",()=>{const o=e._modelValue,s=as(e),r=e.checked,i=e._assign;if(z(o)){const a=Cl(o,s),l=a!==-1;if(r&&!l)i(o.concat(s));else if(!r&&l){const d=[...o];d.splice(a,1),i(d)}}else if(Co(o)){const a=new Set(o);r?a.add(s):a.delete(s),i(a)}else i(vp(e,r))})},mounted:bd,beforeUpdate(e,t,n){e._assign=go(n),bd(e,t,n)}};function bd(e,{value:t,oldValue:n},o){e._modelValue=t,z(t)?e.checked=Cl(t,o.props.value)>-1:Co(t)?e.checked=t.has(o.props.value):t!==n&&(e.checked=ps(t,vp(e,!0)))}const _t={deep:!0,created(e,{value:t,modifiers:{number:n}},o){const s=Co(t);fn(e,"change",()=>{const r=Array.prototype.filter.call(e.options,i=>i.selected).map(i=>n?Zs(as(i)):as(i));e._assign(e.multiple?s?new Set(r):r:r[0])}),e._assign=go(o)},mounted(e,{value:t}){vd(e,t)},beforeUpdate(e,t,n){e._assign=go(n)},updated(e,{value:t}){vd(e,t)}};function vd(e,t){const n=e.multiple;if(!(n&&!z(t)&&!Co(t))){for(let o=0,s=e.options.length;o<s;o++){const r=e.options[o],i=as(r);if(n)z(t)?r.selected=Cl(t,i)>-1:r.selected=t.has(i);else if(ps(as(r),t)){e.selectedIndex!==o&&(e.selectedIndex=o);return}}!n&&e.selectedIndex!==-1&&(e.selectedIndex=-1)}}function as(e){return"_value"in e?e._value:e.value}function vp(e,t){const n=t?"_trueValue":"_falseValue";return n in e?e[n]:t}const Wm=["ctrl","shift","alt","meta"],zm={stop:e=>e.stopPropagation(),prevent:e=>e.preventDefault(),self:e=>e.target!==e.currentTarget,ctrl:e=>!e.ctrlKey,shift:e=>!e.shiftKey,alt:e=>!e.altKey,meta:e=>!e.metaKey,left:e=>"button"in e&&e.button!==0,middle:e=>"button"in e&&e.button!==1,right:e=>"button"in e&&e.button!==2,exact:(e,t)=>Wm.some(n=>e[`${n}Key`]&&!t.includes(n))},G=(e,t)=>(n,...o)=>{for(let s=0;s<t.length;s++){const r=zm[t[s]];if(r&&r(n,t))return}return e(n,...o)},Gm={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},Le=(e,t)=>n=>{if(!("key"in n))return;const o=Nn(n.key);if(t.some(s=>s===o||Gm[s]===o))return e(n)},qm=He({patchProp:Tm},vm);let yd;function Xm(){return yd||(yd=Kg(qm))}const Km=(...e)=>{const t=Xm().createApp(...e),{mount:n}=t;return t.mount=o=>{const s=Ym(o);if(!s)return;const r=t._component;!Z(r)&&!r.render&&!r.template&&(r.template=s.innerHTML),s.innerHTML="";const i=n(s,!1,s instanceof SVGElement);return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),i},t};function Ym(e){return xe(e)?document.querySelector(e):e}const Jm="modulepreload",Zm=function(e,t){return new URL(e,t).href},_d={},wd=function(t,n,o){if(!n||n.length===0)return t();const s=document.getElementsByTagName("link");return Promise.all(n.map(r=>{if(r=Zm(r,o),r in _d)return;_d[r]=!0;const i=r.endsWith(".css"),a=i?'[rel="stylesheet"]':"";if(!!o)for(let c=s.length-1;c>=0;c--){const p=s[c];if(p.href===r&&(!i||p.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${r}"]${a}`))return;const d=document.createElement("link");if(d.rel=i?"stylesheet":Jm,i||(d.as="script",d.crossOrigin=""),d.href=r,document.head.appendChild(d),i)return new Promise((c,p)=>{d.addEventListener("load",c),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${r}`)))})})).then(()=>t())};function Qm(e){return{all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map(function(s){s(n)}),(o=e.get("*"))&&o.slice().map(function(s){s(t,n)})}}}var eb=Object.defineProperty,tb=(e,t,n)=>t in e?eb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ae=(e,t,n)=>(tb(e,typeof t!="symbol"?t+"":t,n),n);const ai=Qm(),ue={fire(e){ai.emit(e.kind,e)},subscribe(e,t){ai.on(e.kind,t)},unsubscribe(e,t){ai.off(e.kind,t)}};class or{constructor(t){this.path=t,Ae(this,"kind","AssetFailureEvent")}}Ae(or,"kind","AssetFailureEvent");class Wl{constructor(t){this.message=t,Ae(this,"kind","FailureEvent")}}Ae(Wl,"kind","FailureEvent");class yp{constructor(t){this.error=t,Ae(this,"kind","CustomAssetFailureEvent")}}Ae(yp,"kind","CustomAssetFailureEvent");class Tr{constructor(){Ae(this,"kind","InvalidateRenderEvent")}}Ae(Tr,"kind","InvalidateRenderEvent");const _p=class{constructor(){Ae(this,"kind",_p.kind)}};let zl=_p;Ae(zl,"kind","RenderUpdatedEvent");const wp=class{constructor(){Ae(this,"kind",wp.kind)}};let Gl=wp;Ae(Gl,"kind","StateLoadingEvent");class ot{constructor(t){this.message=t,Ae(this,"kind","ShowMessageEvent")}}Ae(ot,"kind","ShowMessageEvent");class ql{constructor(t,n){this.message=t,this.actions=n,Ae(this,"kind","ResolvableErrorEvent")}}Ae(ql,"kind","ResolvableErrorEvent");class sr{constructor(t){this.color=t,Ae(this,"kind","ColorPickedEvent")}}Ae(sr,"kind","ColorPickedEvent");class $p{constructor(t,n){this.error=t,this.info=n,Ae(this,"kind","VueErrorEvent")}}Ae($p,"kind","VueErrorEvent");const Cp=""+new URL("missing_image.480f7f62.svg",import.meta.url).href;var nb=Object.defineProperty,$d=Object.getOwnPropertySymbols,ob=Object.prototype.hasOwnProperty,sb=Object.prototype.propertyIsEnumerable,Gi=(e,t,n)=>t in e?nb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Cd=(e,t)=>{for(var n in t||(t={}))ob.call(t,n)&&Gi(e,n,t[n]);if($d)for(var n of $d(t))sb.call(t,n)&&Gi(e,n,t[n]);return e},Pd=(e,t,n)=>(Gi(e,typeof t!="symbol"?t+"":t,n),n);class Xl{constructor(t){this.html=t,Pd(this,"width"),Pd(this,"height"),this.width=t.width,this.height=t.height}paintOnto(t,n={}){const{w:o,h:s}=Cd({w:this.width,h:this.height},n),{x:r,y:i}=Cd({x:-o/2,y:-s/2},n);t.drawImage(this.html,r,i,o,s)}}var rb=Object.defineProperty,ib=(e,t,n)=>t in e?rb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sd=(e,t,n)=>(ib(e,typeof t!="symbol"?t+"":t,n),n);let qi=null;setTimeout(()=>Kl(Cp).then(e=>{e instanceof Xl&&(qi=e)}),0);class rr{constructor(){Sd(this,"width",300),Sd(this,"height",300)}paintOnto(t,n={}){qi&&qi.paintOnto(t,n)}}var lb=Object.defineProperty,ab=Object.defineProperties,db=Object.getOwnPropertyDescriptors,kd=Object.getOwnPropertySymbols,cb=Object.prototype.hasOwnProperty,ub=Object.prototype.propertyIsEnumerable,Xi=(e,t,n)=>t in e?lb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Mo=(e,t)=>{for(var n in t||(t={}))cb.call(t,n)&&Xi(e,n,t[n]);if(kd)for(var n of kd(t))ub.call(t,n)&&Xi(e,n,t[n]);return e},pb=(e,t)=>ab(e,db(t)),hn=(e,t,n)=>(Xi(e,typeof t!="symbol"?t+"":t,n),n),Fo=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const fb="https://edave64.github.io/Doki-Doki-Dialog-Generator-Packs/",at=class{constructor(e,t,n){this.$store=n,hn(this,"onlineRepo"),hn(this,"localRepo"),hn(this,"tempRepo",Kt({authors:{},packs:[]})),hn(this,"combinedList"),hn(this,"authors"),window.repo=this,e||(e={authors:{},packs:[]},ue.fire(new ot("Couldn't load remote repository."))),t||(t={authors:{},packs:[]},q.supports.localRepo&&ue.fire(new ot("Couldn't load local repository."))),this.onlineRepo=io(e),this.localRepo=io(t),this.combinedList=nr(()=>{var o,s;const r=this.onlineRepo.value,i=(o=r==null?void 0:r.packs)!=null?o:[],a=new Map(i.map($=>[$.id,$])),l=this.localRepo.value,d=(s=l==null?void 0:l.packs)!=null?s:[],c=new Map(d.map($=>[$.id,$])),f=this.tempRepo.packs,b=new Map(f.map($=>[$.id,$])),v=new Set(q.state.autoAdd),w=this.$store.state.content.contentPacks.map($=>$.packId).filter($=>$!=null),H=new Set(w),D=new Set;return[...w,...d.map($=>$.id),...i.map($=>$.id),...f.map($=>$.id)].filter($=>$.startsWith("dddg.buildin.")||$.startsWith("dddg.uploads.")||$.startsWith("dddg.desktop.")||$==="concept_femc.shido_draws.edave64"||$==="mc.storm_blaze.edave64"||D.has($)?!1:(D.add($),!0)).map($=>{var x,j,K;return pb(Mo(Mo(Mo({},(x=a.get($))!=null?x:{characters:[],kind:[],authors:[]}),(j=c.get($))!=null?j:{}),(K=b.get($))!=null?K:{}),{autoloading:v.has($),installed:c.has($),online:a.has($)||b.has($),loaded:H.has($)})})}),this.authors=nr(()=>{var o,s;const r=this.onlineRepo.value,i=(o=r==null?void 0:r.authors)!=null?o:{},a=this.localRepo.value,l=(s=a==null?void 0:a.authors)!=null?s:{};return Mo(Mo({},i),l)}),Object.freeze(this)}static getInstance(){return at.instance||(at.instance=this.createInstance()),at.instance}static createInstance(){return Fo(this,null,function*(){const e=at.loadRepo(fb),t=q.supports.localRepo?yield at.loadRepo(q.localRepositoryUrl):null,[n,o,s]=yield Promise.all([e,t,at.$store]);return new at(n,o,s)})}static loadRepo(e){return Fo(this,null,function*(){try{const[t,n]=yield Promise.all([at.fetchJSON(e+"repo.json"),at.fetchJSON(e+"people.json")]);return{packs:t,authors:n}}catch(t){return null}})}static fetchJSON(e){return Fo(this,null,function*(){const t=yield fetch(e);if(!t.ok)throw new Error("Could not load json");return yield t.json()})}reloadLocalRepo(){return Fo(this,null,function*(){this.localRepo.value=q.supports.localRepo?yield at.loadRepo(q.localRepositoryUrl):null})}getPacks(){return this.combinedList.value}hasPack(e,t=!1){var n;return t?!!((n=this.onlineRepo.value)!=null&&n.packs.find(o=>o.id===e)):!!this.getPacks().find(o=>o.id===e)}getPack(e){var t;return(t=this.getPacks().find(n=>n.id===e))!=null?t:null}getAuthor(e){return this.authors.value[e]||null}getAuthors(){return this.authors.value}loadTempPack(e){return Fo(this,null,function*(){const t=fetch(e);let n;try{n=yield t}catch(r){throw new Error(`Failed to load '${e}'`)}let o;try{o=yield n.json()}catch(r){throw new Error(`The contents of '${e}' is not a valid JSON: ${r.message}`)}if(!o.pack)throw new Error(`The json file '${e}' does not contain any packages`);if(o.authors)for(const r in o.authors)this.tempRepo.authors[r]&&(this.tempRepo.authors[r]=o.authors[r]);const s=o.pack;return s.repoUrl=e,this.tempRepo.packs.find(r=>r.id===s.id)||this.tempRepo.packs.push(s),s.id})}};let Jt=at;hn(Jt,"instance");hn(Jt,"setStore");hn(Jt,"$store",new Promise((e,t)=>{at.setStore=e}));var hb=Object.defineProperty,Od=Object.getOwnPropertySymbols,gb=Object.prototype.hasOwnProperty,mb=Object.prototype.propertyIsEnumerable,Ki=(e,t,n)=>t in e?hb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Yi=(e,t)=>{for(var n in t||(t={}))gb.call(t,n)&&Ki(e,n,t[n]);if(Od)for(var n of Od(t))mb.call(t,n)&&Ki(e,n,t[n]);return e},gt=(e,t,n)=>(Ki(e,typeof t!="symbol"?t+"":t,n),n),Te=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const ir=navigator.userAgent,bb=!!ir.match(/iPad/i)||!!ir.match(/iPhone/i),vb=!!ir.match(/WebKit/i),xd=bb&&vb&&!ir.match(/CriOS/i);class Pp{constructor(){gt(this,"state",Kt({looseTextParsing:!0,autoAdd:[],downloadLocation:"Default download folder"})),gt(this,"supports"),gt(this,"_gameMode",null),gt(this,"vuexHistory",null),gt(this,"$store",null),gt(this,"isSavingEnabled",io(!1)),gt(this,"localRepositoryUrl",""),gt(this,"loading"),gt(this,"creatingDB"),gt(this,"loadingContentPacksAllowed"),gt(this,"loadContentPacks");const t=this,n=De.canSave();window.addEventListener("beforeunload",function(o){o.preventDefault(),o.returnValue="Are you sure you want to leave? All your progress will be lost!"}),this.loadingContentPacksAllowed=new Promise((o,s)=>{this.loadContentPacks=()=>o()}),this.supports=Kt({optionalSaving:n,get autoLoading(){return n&&t.isSavingEnabled.value},backgroundInstall:!1,localRepo:!1,lq:!0,setDownloadFolder:!1,openableFolders:new Set([]),assetCaching:!xd,allowWebP:!0,limitedCanvasSpace:xd}),n?this.loading=(()=>Te(this,null,function*(){this.savingEnabled=yield De.doesDbExists()}))():this.loading=Promise.resolve(),this.loading.then(()=>Te(this,null,function*(){var o;if(yield this.loadingContentPacksAllowed,this.creatingDB&&(yield this.creatingDB),this.savingEnabled){const s=(o=yield De.loadAutoload())!=null?o:[];this.state.autoAdd=s;const r=yield Jt.getInstance(),i=yield Promise.all(s.map(a=>Te(this,null,function*(){var l;const[d,c]=a.split(";",2);c!=null&&!r.hasPack(d)&&(yield r.loadTempPack(c));const p=r.getPack(d);return(l=p.dddg2Path)!=null?l:p.dddg1Path})));yield this.vuexHistory.transaction(()=>Te(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",i)}))}}))}get gameMode(){return this._gameMode}get savingEnabled(){return this.isSavingEnabled.value}set savingEnabled(t){t?(localStorage.setItem("saving","true"),this.creatingDB=De.createDB(),this.creatingDB.then(()=>{this.creatingDB=void 0,this.isSavingEnabled.value=!0}).catch(()=>{})):(localStorage.clear(),this.isSavingEnabled.value=!1,this.creatingDB=De.clearDB().then(()=>{this.creatingDB=void 0}).catch(()=>{}))}storeSaveFile(t,n){return Te(this,null,function*(){const o=document.createElement("a"),s=URL.createObjectURL(t);o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)})}loadGameMode(){return Te(this,null,function*(){const n=new URLSearchParams(location.search).get("mode");if(n==="ddlc"||n==="ddlc_plus"){this._gameMode=n;return}yield this.loading,yield this.creatingDB;let o="";this.isSavingEnabled.value&&(o=yield De.loadGameMode());let s="ddlc";(o==="ddlc"||o==="ddlc_plus")&&(s=o),this._gameMode=s})}setGameMode(t){return Te(this,null,function*(){this.isSavingEnabled.value&&(yield De.saveGameMode(t));const n=`${location.protocol}//${location.host}${location.pathname}`;location.href=`${n}?mode=${t}`})}updateDownloadFolder(){throw new Error("Method not implemented.")}openFolder(t){throw new Error("Method not implemented.")}connectToStore(t,n){this.vuexHistory=t,this.$store=n}saveToFile(t,n,o="image/png",s=1){return Te(this,null,function*(){const r=document.createElement("a");r.setAttribute("download",n);const i=yield this.createObjectURL(t,o,s);return r.setAttribute("href",i),document.body.appendChild(r),r.click(),document.body.removeChild(r),i})}localRepoInstall(t,n,o){throw new Error("This environment does not support a local repository")}localRepoUninstall(t){throw new Error("This environment does not support a local repository")}autoLoadAdd(t){return Te(this,null,function*(){yield this.loading,yield this.creatingDB,yield De.saveAutoload([...this.state.autoAdd,t]),this.state.autoAdd.push(t)})}autoLoadRemove(t){return Te(this,null,function*(){yield this.loading,yield this.creatingDB;const n=this.normalizePackId(t);yield De.saveAutoload(this.state.autoAdd.filter(s=>this.normalizePackId(s)!=n));const o=this.state.autoAdd.indexOf(t);this.state.autoAdd.splice(o,1)})}normalizePackId(t){const n=t.split(";");return n.length===1?n[0]:n[n.length-1]}loadSettings(){return Te(this,null,function*(){yield this.loading,yield this.creatingDB;const t={darkMode:void 0,lq:!0,nsfw:!1,defaultCharacterTalkingZoom:!0,looseTextParsing:!0};return this.isSavingEnabled.value?Yi(Yi({},t),yield De.loadSettings()):t})}saveSettings(t){return Te(this,null,function*(){yield this.loading,yield this.creatingDB,this.isSavingEnabled.value&&(yield De.saveSettings(t))})}isInitialized(){return Te(this,null,function*(){yield this.loading,yield this.creatingDB})}prompt(t,n){return new Promise((o,s)=>{o(prompt(t,n))})}onPanelChange(t){}createObjectURL(t,n,o){return new Promise((s,r)=>{if(!(window.URL!=null&&window.URL.createObjectURL!=null))return s(t.toDataURL(n,o));if(t.toBlob!=null)t.toBlob(a=>{if(!a){r();return}s(URL.createObjectURL(a))},n,o);else{const a=t.toDataURL(n,o),l=this.dataURItoBlob(a,n);s(URL.createObjectURL(l))}})}dataURItoBlob(t,n){const o=atob(t.split(",")[1]),s=o.length,r=new Uint8Array(s);for(let i=0;i<s;i++)r[i]=o.charCodeAt(i);return new Blob([r],{type:n})}}const De={indexedDB:(()=>{var e,t,n;try{return(n=(t=(e=window.indexedDB)!=null?e:window.mozIndexedDB)!=null?t:window.webkitIndexedDB)!=null?n:window.msIndexedDB}catch(o){return null}})(),transaction:(()=>{try{return window.IDBTransaction||window.webkitIDBTransaction||window.msIDBTransaction}catch(e){return null}})(),db:null,canSave(){return!!(De.indexedDB&&window.localStorage!=null)},doesDbExists(){return localStorage.getItem("saving")==="true"?Promise.resolve(!0):Promise.resolve(!1)},createDB(){return De.db?De.db:De.db=new Promise((e,t)=>{const n=De.indexedDB.open("dddg",3);n.onerror=o=>{t(o)},n.onupgradeneeded=o=>{var s;const r=o.target.result,i=(s=o.oldVersion)!=null?s:o.version;i<1&&r.createObjectStore("settings"),i===1&&(r.deleteObjectStore("settings"),r.createObjectStore("settings"))},n.onsuccess=o=>{e(n.result)}})},clearDB(){return new Promise((e,t)=>{if(!De.db){e();return}const n=De.indexedDB.deleteDatabase("dddg");De.db=null,n.onerror=o=>{t(o)},n.onsuccess=o=>{e()}})},loadAutoload(){return this.objectStorePromise("readonly",e=>Te(this,null,function*(){return yield this.reqPromise(e.get("autoload"))}))},saveAutoload(e){return this.objectStorePromise("readwrite",t=>Te(this,null,function*(){yield this.reqPromise(t.put([...e],"autoload"))}))},loadGameMode(){return this.objectStorePromise("readonly",e=>Te(this,null,function*(){return yield this.reqPromise(e.get("gameMode"))}))},saveGameMode(e){return this.objectStorePromise("readwrite",t=>Te(this,null,function*(){yield this.reqPromise(t.put(e,"gameMode"))}))},saveSettings(e){return this.objectStorePromise("readwrite",t=>Te(this,null,function*(){yield this.reqPromise(t.put(Yi({},e),"settings"))}))},loadSettings(){return this.objectStorePromise("readonly",e=>Te(this,null,function*(){return yield this.reqPromise(e.get("settings"))}))},objectStorePromise(e,t){return this.db?new Promise((n,o)=>Te(this,null,function*(){const r=(yield this.db).transaction(["settings"],e).objectStore("settings");try{n(yield t(r))}catch(i){o(i)}})):Promise.reject(new Error("No database"))},reqPromise(e){return new Promise((t,n)=>{e.onerror=o=>{n(o)},e.onsuccess=o=>{t(e.result)}})}};var yb=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class _b extends Pp{saveToFile(t,n,o="image/png",s=1){return yb(this,null,function*(){let r=t.toDataURL(o,s);const i=this.dataURItoBlob(r,o);return window.URL!=null&&window.URL.createObjectURL!=null&&(r=URL.createObjectURL(i)),window.navigator.msSaveBlob(i,n),r})}}var wb=Object.defineProperty,$b=(e,t,n)=>t in e?wb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,et=(e,t,n)=>($b(e,typeof t!="symbol"?t+"":t,n),n),we=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const jd={packId:"dddg.buildin.installedBackgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]};class Cb{constructor(){et(this,"state",Kt({looseTextParsing:!0,autoAdd:[],downloadLocation:""})),et(this,"localRepositoryUrl","/repo/"),et(this,"_gameMode",null),et(this,"electron",window),et(this,"vuexHistory",null),et(this,"$store",null),et(this,"bgInvalidation",null),et(this,"pendingContentPacks",[]),et(this,"pendingContentPacksReplace",[]),et(this,"loadingContentPacksAllowed"),et(this,"loadContentPacks"),et(this,"supports",{autoLoading:!0,backgroundInstall:!0,localRepo:!0,lq:!1,optionalSaving:!1,setDownloadFolder:!0,openableFolders:new Set(["downloads","backgrounds","sprites"]),assetCaching:!0,allowWebP:!0,limitedCanvasSpace:!1}),et(this,"savingEnabled",!0),this.loadingContentPacksAllowed=new Promise((n,o)=>{this.loadContentPacks=()=>n()}),this.electron.ipcRenderer.on("add-persistent-content-pack",n=>we(this,null,function*(){if(yield this.loadingContentPacksAllowed,!this.$store||!this.vuexHistory){this.pendingContentPacks.push(n);return}yield this.vuexHistory.transaction(()=>we(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",n)}))})),this.electron.ipcRenderer.on("add-persistent-background",n=>we(this,null,function*(){const o="persistentBg-"+n,s=n.split("/");yield kp(o,n),jd.backgrounds.push({id:o,variants:[[o]],label:s[s.length-1],scaling:"none"}),this.invalidateInstalledBGs()})),this.electron.ipcRenderer.on("push-message",n=>we(this,null,function*(){ue.fire(new ot(n))})),this.electron.ipcRenderer.on("config.downloadFolderUpdate",n=>we(this,null,function*(){this.state.downloadLocation=n})),this.electron.ipcRenderer.onConversation("load-packs",n=>we(this,null,function*(){const o=yield Jt.getInstance(),s=yield Promise.all(n.map(r=>we(this,null,function*(){const[i,a]=r.split(";",2);a!=null&&!o.hasPack(i)&&(yield o.loadTempPack(a));const l=o.getPack(i);return l.dddg2Path||l.dddg1Path})));if(!this.$store||!this.vuexHistory){s.forEach(r=>this.pendingContentPacks.push(r));return}yield this.vuexHistory.transaction(()=>we(this,null,function*(){yield this.$store.dispatch("content/loadContentPacks",s)}))})),this.electron.ipcRenderer.onConversation("auto-load.changed",n=>we(this,null,function*(){this.state.autoAdd=n})),this.electron.ipcRenderer.onConversation("reload-repo",()=>we(this,null,function*(){yield(yield Jt.getInstance()).reloadLocalRepo()})),this.electron.ipcRenderer.onConversation("replace-pack",n=>we(this,null,function*(){const o={processed:!1,contentPack:n};!this.$store||!this.vuexHistory?this.pendingContentPacksReplace.push(o):yield this.vuexHistory.transaction(()=>we(this,null,function*(){yield this.$store.dispatch("content/replaceContentPack",o)}))})),this.electron.ipcRenderer.onConversation("resolvable-error",(n,o)=>new Promise((s,r)=>{ue.fire(new ql(n,o.map(i=>({exec:()=>s(i),name:i}))))}));let t=!1;this.electron.ipcRenderer.on("update.progress",n=>{n==="done"?(t=!1,ue.fire(new ot("An update is ready and will be installed once DDDG closes."))):t||(t=!0,ue.fire(new ot("An update is ready and will be installed once DDDG closes.")))}),this.electron.ipcRenderer.send("init-dddg")}get gameMode(){return this._gameMode}storeSaveFile(t,n){return we(this,null,function*(){const o=document.createElement("a"),s=URL.createObjectURL(saveBlob);o.setAttribute("download",n),o.setAttribute("href",s),document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)})}updateDownloadFolder(){this.electron.ipcRenderer.send("config.newDownloadFolder")}openFolder(t){this.electron.ipcRenderer.send("open-folder",t)}onPanelChange(t){}saveSettings(t){return we(this,null,function*(){var n;yield this.electron.ipcRenderer.sendConvo("config.set","nsfw",t.nsfw),yield this.electron.ipcRenderer.sendConvo("config.set","darkMode",(n=t.darkMode)!=null?n:void 0),yield this.electron.ipcRenderer.sendConvo("config.set","defaultCharacterTalkingZoom",t.defaultCharacterTalkingZoom)})}loadGameMode(){return we(this,null,function*(){this._gameMode=(yield this.electron.ipcRenderer.sendConvo("config.get","gameMode"))||"ddlc"})}setGameMode(t){return we(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("config.set","gameMode",t),this.electron.ipcRenderer.send("reload")})}loadSettings(){return we(this,null,function*(){var t,n,o;return{lq:!1,nsfw:(t=yield this.electron.ipcRenderer.sendConvo("config.get","nsfw"))!=null?t:!1,darkMode:(n=yield this.electron.ipcRenderer.sendConvo("config.get","darkMode"))!=null?n:void 0,defaultCharacterTalkingZoom:(o=yield this.electron.ipcRenderer.sendConvo("config.get","defaultCharacterTalkingZoom"))!=null?o:void 0}})}localRepoInstall(t,n,o){return we(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("repo.install",t,n,o)})}localRepoUninstall(t){return we(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("repo.uninstall",t)})}autoLoadAdd(t){return we(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("auto-load.add",t)})}autoLoadRemove(t){return we(this,null,function*(){yield this.electron.ipcRenderer.sendConvo("auto-load.remove",t)})}saveToFile(t,n,o="image/png",s=1){return new Promise((r,i)=>{t.toBlob(a=>we(this,null,function*(){if(!a){i();return}const l=yield a.arrayBuffer();yield this.electron.ipcRenderer.sendConvo("save-file",n,new Uint8Array(l)),r(URL.createObjectURL(a))}),o,s)})}prompt(t,n){return we(this,null,function*(){return yield this.electron.ipcRenderer.sendConvo("show-prompt",t,n)})}connectToStore(t,n){this.vuexHistory=t,this.$store=n,this.invalidateInstalledBGs(),this.vuexHistory.transaction(()=>we(this,null,function*(){if(this.pendingContentPacks.length>0&&(yield this.$store.dispatch("content/loadContentPacks",this.pendingContentPacks)),this.pendingContentPacksReplace.length>0)for(const o of this.pendingContentPacksReplace)yield this.$store.dispatch("content/replaceContentPack",o)}))}invalidateInstalledBGs(){!this.vuexHistory||!this.$store||this.bgInvalidation===null&&(this.bgInvalidation=requestAnimationFrame(()=>{this.updateInstalledBGs()}))}updateInstalledBGs(){this.bgInvalidation!=null&&(cancelAnimationFrame(this.bgInvalidation),this.bgInvalidation=null),!(!this.vuexHistory||!this.$store)&&this.vuexHistory.transaction(()=>we(this,null,function*(){yield this.$store.dispatch("content/replaceContentPack",{contentPack:jd})}))}}function Pb(){return window.isElectron?new Cb:"msSaveOrOpenBlob"in window.navigator?new _b:new Pp}const q=Pb();window.toast=q;var Sb=Object.defineProperty,kb=(e,t,n)=>t in e?Sb(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sp=(e,t,n)=>(kb(e,typeof t!="symbol"?t+"":t,n),n),ds=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});let di;function mo(){if(di)return di;if(!q.supports.allowWebP)return Promise.resolve(!1);const e="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=",t="data:image/webp;base64,UklGRogAAABXRUJQVlA4THwAAAAv/8SzAA/wGbPPmH3GbP7jAQSSNu9f+rzDwYj+G23bpt3Gx3xD8353j73f5b87+e9OALmT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9OAriT/+7kvzv5704CuJP/7uS/O/nvTgK4k//u5L87+e9O/rsTwe7kvzsL";return di=(()=>ds(this,null,function*(){const n=yield Promise.all([Id(e,1,2),Id(t,720,1280)]);return n[0]&&n[1]}))()}function Id(e,t,n){return new Promise((o,s)=>{const r=document.createElement("img");r.addEventListener("load",()=>{o(r.width===n&&r.height===t)}),r.addEventListener("error",()=>{o(!1)}),r.src=e})}let ci;function Ob(){return ci||(ci=new Promise((e,t)=>{const n="data:image/heic;base64,AAAAGGZ0eXBoZWljAAAAAG1pZjFoZWljAAAAsW1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAHBpY3QAXABjAGMAcwBsAGEAAAAADnBpdG0AAAAAAAEAAAAQaWxvYwAAAABEQAAAAAAAI2lpbmYAAAAAAAEAAAAVaW5mZQIAAAAAAQAAaHZjMQAAAABDaXBycAAAACdpcGNvAAAAH2h2Y0NmzGx1ci0AAAAAAABv9HP+//v9bjr3AAAAABRpcG1hAAAAAAAAAAEAAQGBAAAACG1kYXQ=",o=document.createElement("img");o.addEventListener("load",()=>{console.log("Heif no error. "+(o.width===2&&o.height===1)),e(o.width===2&&o.height===1)}),o.addEventListener("error",()=>{console.log("Heif not supported"),e(!1)}),o.src=n}))}class xb{constructor(){Sp(this,"cache",new Map)}get(t){const n=this.cache.get(t);if(n)return n;const o=Ji(t);return this.cache.set(t,o),o}remove(t){this.cache.delete(t)}}class jb{constructor(){Sp(this,"cache",new Map)}get(t){var n;const o=(n=this.cache.get(t))==null?void 0:n.deref();if(o)return o;const s=Tb(t);return this.cache.set(t,new WeakRef(s)),s}remove(t){this.cache.delete(t)}}let ui=null;function lr(){return ui||(window.assetCache=ui=q.supports.assetCaching||typeof WeakRef=="undefined"?new xb:new jb)}const Fn={};function Er(e,t=!0){return Kl(q.supports.lq&&!t?e.lq:e.hq)}function Mn(e,t=!0){const n=q.supports.lq&&!t?e.lq:e.hq;return Fn[n]?Fn[n]:n}function Kl(e){return Fn[e]&&(e=Fn[e]),lr().get(e)}const Fe="./";function co(e,t=!0){return ds(this,null,function*(){const n=`${Fe}assets/${e}${t?"":".lq"}${(yield mo())?".webp":".png"}`.replace(/\/+/,"/");return yield lr().get(n)})}function Ib(e,t=!0){return ds(this,null,function*(){return`${Fe}assets/${e}${q.supports.lq&&!t?".lq":""}${(yield mo())?".webp":".png"}`.replace(/\/+/,"/")})}function kp(e,t){Fn[e]=t}function Tb(e){return ds(this,null,function*(){const t=!!Fn[e];return t&&(e=Fn[e]),(()=>ds(this,null,function*(){try{return yield Ji(e)}catch(n){if(e.endsWith(".webp")&&!t)try{return yield Ji(e.replace(/\.webp$/,".png"))}catch(o){return ue.fire(new or(e)),lr().remove(e),new rr}else return ue.fire(new or(e)),lr().remove(e),new rr}}))()})}function Ji(e){return new Promise((t,n)=>{const o=new Image;o.addEventListener("load",()=>{t(new Xl(o)),q.supports.assetCaching||document.body.removeChild(o)}),o.addEventListener("error",s=>{t(new rr),q.supports.assetCaching||document.body.removeChild(o)}),o.crossOrigin="Anonymous",o.src=e,o.style.display="none",document.body.appendChild(o)})}const Eb=ee({props:{label:String,modelValue:{type:Boolean,default:!1}},computed:{value:{get(){return this.modelValue},set(e){this.$emit("update:modelValue",e)}},checkbox(){return this.$refs.checkbox}}});const ne=(e,t)=>{const n=e.__vccOpts||e;for(const[o,s]of t)n[o]=s;return n},Bb={class:"toggle_box"},Ab=["id"],Db=["for"],Rb=["for"];function Hb(e,t,n,o,s,r){return g(),y("div",Bb,[de(u("input",{id:e._.uid,type:"checkbox",ref:"checkbox","onUpdate:modelValue":t[0]||(t[0]=i=>e.value=i)},null,8,Ab),[[Vm,e.value]]),u("label",{for:e._.uid,class:"switch"},null,8,Db),u("label",{for:e._.uid,class:"toggle_label"},fe(e.label),9,Rb)])}const Rt=ne(Eb,[["render",Hb]]),Yl={methods:{verticalScrollRedirect(e){if(e.type!=="wheel"||!e.currentTarget)return;const t=e.currentTarget,n=getComputedStyle(t),o=e;if(o.deltaY===0)return;if(n.overflowY==="auto"){if(o.deltaY>0){if(t.scrollHeight>t.scrollTop+t.clientHeight){e.stopPropagation();return}}else if(t.scrollTop>0){e.stopPropagation();return}}const s=t.scrollLeft;t.scrollLeft+=o.deltaY,t.scrollLeft!==s&&e.stopPropagation()}}},st={mixins:[Yl],computed:{vertical(){return this.$store.state.ui.vertical}},mounted(){this.updateVertical(),this.$el.addEventListener("wheel",e=>{this.vertical||this.verticalScrollRedirect(e)},{passive:!0})},methods:{updateVertical(){!this.$el||(this.vertical?this.$el.classList.add("vertical"):this.$el.classList.remove("vertical"))}},watch:{vertical(){this.updateVertical()}}},Mb=window.HTMLDialogElement!=null,Fb=ee({props:{noBaseSize:Boolean,options:{type:Array,default:[]}},computed:{nativeDialogs(){return Mb}},methods:{open(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&!e.open&&e.showModal()}window.addEventListener("click",this.clickSomewhere)},close(){if(this.nativeDialogs){const e=this.$refs.dialog;e&&e.open&&e.close(),this.$emit("leave")}window.removeEventListener("click",this.clickSomewhere)},clickSomewhere(e){const t=this.$refs.dialog;t&&t.open?e.target===t&&(this.close(),e.preventDefault(),e.stopPropagation()):window.removeEventListener("click",this.clickSomewhere)}},mounted(){this.open()},activated(){this.open()},deactivated(){this.close()},unmounted(){this.close()}});const Nb={key:0,id:"submit-options"},Lb=["onClick"],Ub={key:0,id:"submit-options"},Vb=["onClick"];function Wb(e,t,n,o,s,r){return e.nativeDialogs?(g(),y("dialog",{key:0,ref:"dialog",class:pe(["native",{"base-size":!e.noBaseSize}]),onCancel:t[0]||(t[0]=(...i)=>e.close&&e.close(...i))},[qt(e.$slots,"default",{},void 0,!0),e.options.length>0?(g(),y("div",Nb,[(g(!0),y(U,null,Ce(e.options,i=>(g(),y("button",{key:i,class:"option",onClick:a=>e.$emit("option",i)},fe(i),9,Lb))),128))])):X("",!0)],34)):(g(),y("div",{key:1,class:"dialog-wrapper",onClick:t[2]||(t[2]=i=>e.$emit("leave"))},[u("dialog",{ref:"dialog",open:"",class:pe({"base-size":!e.noBaseSize}),onClick:t[1]||(t[1]=G(()=>{},["stop"]))},[qt(e.$slots,"default",{},void 0,!0),e.options.length>0?(g(),y("div",Ub,[(g(!0),y(U,null,Ce(e.options,i=>(g(),y("button",{key:i,class:"option",onClick:a=>e.$emit("option",i)},fe(i),9,Vb))),128))])):X("",!0)],2)]))}const Jl=ne(Fb,[["render",Wb],["__scopeId","data-v-08c9e0d0"]]),zb=ee({mixins:[Yl],props:{to:{type:String,required:!0}},computed:{href(){let e=this.to;return e=e.replace(/^github:\/\//,"https://github.com/edave64/Doki-Doki-Dialog-Generator/"),e=e.replace(/^wiki:\/\/(.*)/,(t,n)=>"https://github.com/edave64/Doki-Doki-Dialog-Generator/wiki/Version-2:-"+n.replaceAll(" ","-")),e}}}),Gb=["href"];function qb(e,t,n,o,s,r){return g(),y("a",{target:"_blank",rel:"noopener noreferrer",href:e.href},[qt(e.$slots,"default")],8,Gb)}const Zl=ne(zb,[["render",qb]]);var Xb=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});function Zi(e,t){return Xb(this,null,function*(){try{yield t()}catch(n){console.error("Error in promise",e,n),ue.fire(new Wl("Unexpected error! Please copy the following message and send it to /u/edave64: Error in '"+e+'", '+Kb(n)))}})}function Kb(e){if(e instanceof Error){if(e.stack!=null){const t=e.stack.split(`
`);return t[0].includes(e.name)&&t[0].includes(e.message)?t[0]+`
<br />`+t[1]:e.name+": "+e.message+`
<br />`+t[0]}return e.name+": "+e.message}return e instanceof Object?JSON.stringify(e):""+e}var No=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Yb=ee({mixins:[st],components:{Toggle:Rt,ModalDialog:Jl,L:Zl},data:()=>({allowSavesModal:!1,denySavesModal:!1,waitOnSaveChange:!1,showModeDialog:!1}),computed:{savesAllowed:{get(){return q.savingEnabled},set(e){this.waitOnSaveChange=!0,q.savingEnabled=e,this.saveSettings()}},inPlusMode(){return q.gameMode==="ddlc_plus"},savesEnabledInEnv(){return q.supports.optionalSaving},lqAllowed(){return q.supports.lq},looseTextParsing:{get(){return q.state.looseTextParsing},set(e){q.state.looseTextParsing=e,this.saveSettings()}},lqRendering:{get(){return this.$store.state.ui.lqRendering},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setLqRendering",e)})),this.saveSettings()}},nsfw:{get(){return!!this.$store.state.ui.nsfw},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setNsfw",e),this.saveSettings()}))}},defaultCharacterTalkingZoom:{get(){return!!this.$store.state.ui.defaultCharacterTalkingZoom},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setDefaultCharacterTalkingZoom",e),this.saveSettings()}))}},theme:{get(){return this.$store.state.ui.useDarkTheme},set(e){this.vuexHistory.transaction(()=>No(this,null,function*(){yield this.$store.commit("ui/setDarkTheme",e),this.saveSettings()}))}},showDownloadFolder(){return q.supports.setDownloadFolder},downloadFolder(){return q.state.downloadLocation}},watch:{savesAllowed(){this.waitOnSaveChange=!1}},methods:{allowSaves(e){this.allowSavesModal=!1,e==="Allow"&&(this.savesAllowed=!0)},denySaves(e){this.denySavesModal=!1,e==="Deny"&&(this.savesAllowed=!1)},modeChange(e){Zi("changing modes",()=>No(this,null,function*(){e==="Enter Classic Mode"?yield q.setGameMode("ddlc"):e==="Enter Plus mode"?yield q.setGameMode("ddlc_plus"):this.showModeDialog=!1}))},saveSettings(){var e;q.saveSettings({lq:this.$store.state.ui.lqRendering,nsfw:this.$store.state.ui.nsfw,darkMode:(e=this.$store.state.ui.useDarkTheme)!=null?e:void 0,looseTextParsing:q.state.looseTextParsing,defaultCharacterTalkingZoom:this.$store.state.ui.defaultCharacterTalkingZoom})},setDownloadFolder(){q.updateDownloadFolder()},openDownloadFolder(){q.openFolder("downloads")}}});const ft=e=>(ze("data-v-b2e4e2eb"),e=e(),Ge(),e),Jb={class:"panel"},Zb=ft(()=>u("h1",null,"Settings",-1)),Qb={class:"modal-scroll-area"},ev=ft(()=>u("p",null,"Do you want to allow DDDG to save settings on your device?",-1)),tv=ft(()=>u("p",null," By choosing to enable saving settings, DDDG can save data to your device, and nowhere else. However, your browser and any installed browser extensions might possibly read and send this data to other servers, e.g. to sync between devices. This is outside of our control. But in general, we recommend only using browsers and browser extensions that you trust with your personal data. ",-1)),nv=ft(()=>u("p",null,"You can revoke this permission at any time.",-1)),ov={class:"modal-scroll-area"},sv=ft(()=>u("p",null,"Do you want to deny DDDG from saving settings on your device?",-1)),rv=ft(()=>u("p",null," This will cause all your settings to reset when leaving the page. ",-1)),iv=ft(()=>u("div",{class:"modal-scroll-area"},[u("p",null," WARNING: Swiching modes will discard everything you have done in this session. All dialouge will be lost! ")],-1)),lv={key:0,disabled:""},av=ft(()=>u("td",null,[u("label",null,"Theme:")],-1)),dv=ft(()=>u("option",{value:null},"System",-1)),cv=ft(()=>u("option",{value:!1},"Light",-1)),uv=ft(()=>u("option",{value:!0},"Dark",-1)),pv=[dv,cv,uv],fv={key:4,class:"downloadTable"},hv=ft(()=>u("td",null,[u("label",null,"Download folder:")],-1));function gv(e,t,n,o,s,r){const i=E("l"),a=E("modal-dialog"),l=E("toggle");return g(),y("div",Jb,[Zb,(g(),L(ip,{to:"#modal-messages"},[e.allowSavesModal?(g(),L(a,{key:0,options:["Allow","Deny"],onLeave:t[0]||(t[0]=d=>e.allowSaves("Deny")),onOption:e.allowSaves,"no-base-size":""},{default:B(()=>[u("div",Qb,[ev,tv,nv,u("p",null,[O(" Our usual "),C(i,{to:"wiki://Privacy Statement"},{default:B(()=>[O("privacy policy")]),_:1}),O(" still applies. ")])])]),_:1},8,["onOption"])):X("",!0),e.denySavesModal?(g(),L(a,{key:1,options:["Deny","Cancle"],onLeave:t[1]||(t[1]=d=>e.denySaves("Cancle")),onOption:e.denySaves,"no-base-size":""},{default:B(()=>[u("div",ov,[sv,rv,u("p",null,[O(" Our usual "),C(i,{to:"wiki://Privacy Statement"},{default:B(()=>[O("privacy policy")]),_:1}),O(" still applies. ")])])]),_:1},8,["onOption"])):X("",!0),e.showModeDialog?(g(),L(a,{key:2,options:[e.inPlusMode?"Enter Classic Mode":"Enter Plus mode","Stay"],onLeave:t[2]||(t[2]=d=>e.showModeDialog=!1),onOption:e.modeChange,"no-base-size":""},{default:B(()=>[iv]),_:1},8,["options","onOption"])):X("",!0)])),e.waitOnSaveChange?(g(),y("button",lv,"Applying...")):!e.savesAllowed&&e.savesEnabledInEnv?(g(),y("button",{key:1,onClick:t[3]||(t[3]=d=>e.allowSavesModal=!0)}," Allow saving options ")):e.savesAllowed&&e.savesEnabledInEnv?(g(),y("button",{key:2,onClick:t[4]||(t[4]=d=>e.denySavesModal=!0)}," Deny saving options ")):X("",!0),u("button",{onClick:t[5]||(t[5]=d=>e.showModeDialog=!0)},[e.inPlusMode?(g(),y(U,{key:0},[O(" Enter Classic Mode ")],64)):(g(),y(U,{key:1},[O(" Enter DDLC Plus Mode ")],64))]),e.lqAllowed?(g(),L(l,{key:3,label:"Low quality preview?",title:"Reduces the quality of the preview images to speed up the user experience and consume less data. Does not effect final render.",modelValue:e.lqRendering,"onUpdate:modelValue":t[6]||(t[6]=d=>e.lqRendering=d)},null,8,["modelValue"])):X("",!0),C(l,{label:"NSFW Mode?",modelValue:e.nsfw,"onUpdate:modelValue":t[7]||(t[7]=d=>e.nsfw=d)},null,8,["modelValue"]),C(l,{label:"Enlarge talking objects? (Default value)",modelValue:e.defaultCharacterTalkingZoom,"onUpdate:modelValue":t[8]||(t[8]=d=>e.defaultCharacterTalkingZoom=d)},null,8,["modelValue"]),C(l,{label:"Fault tolerant text parsing",title:"Silently ignore parse errors in texts. (Like unexpected '{' characters) Prevents beginners from getting stuck working with textboxes, but also makes it harder to understand what you are doing wrong.",modelValue:e.looseTextParsing,"onUpdate:modelValue":t[9]||(t[9]=d=>e.looseTextParsing=d)},null,8,["modelValue"]),u("table",null,[u("tr",null,[av,u("td",null,[de(u("select",{"onUpdate:modelValue":t[10]||(t[10]=d=>e.theme=d)},pv,512),[[_t,e.theme]])])])]),e.showDownloadFolder?(g(),y("table",fv,[u("tr",null,[hv,u("td",null,fe(e.downloadFolder),1),u("td",null,[u("button",{onClick:t[11]||(t[11]=(...d)=>e.setDownloadFolder&&e.setDownloadFolder(...d))},"Set"),u("button",{onClick:t[12]||(t[12]=(...d)=>e.openDownloadFolder&&e.openDownloadFolder(...d))},"Open")])])])):X("",!0)])}const mv=ne(Yb,[["render",gv],["__scopeId","data-v-b2e4e2eb"]]),bv=ee({props:{icon:{type:String,required:!0},iconPos:{type:String,default:"left"},disabled:{type:Boolean,default:!1},shortcut:{type:String,default:null}},computed:{showPopup(){return this.shortcut!=null&&!this.shortcut.startsWith("!")},popupText(){const e=this.shortcut;return e==null?"":e.startsWith("!")?e.substring(1):e}}});const vv=["disabled"],yv={class:"material-icons","aria-hidden":"true"},_v={class:"content"},wv={key:0,class:"shortcut-popup"};function $v(e,t,n,o,s,r){return g(),y("button",{class:pe([e.iconPos]),disabled:e.disabled},[u("div",yv,fe(e.icon),1),u("div",_v,[qt(e.$slots,"default",{},void 0,!0)]),e.showPopup?(g(),y("div",wv,fe(e.popupText),1)):X("",!0)],10,vv)}const Ln=ne(bv,[["render",$v],["__scopeId","data-v-69c1c73b"]]);var Cv=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Pv=ee({components:{DButton:Ln},computed:{characters(){return this.$store.state.content.current.characters}},methods:{assetPath(e){return e.chibi?q.supports.lq?e.chibi.lq:e.chibi.hq:""},onChosen(e){this.vuexHistory.transaction(()=>Cv(this,null,function*(){yield this.$store.dispatch("panels/createCharacters",{characterType:e,panelId:this.$store.state.panels.currentPanel})}))}}});const Sv=["title","onClick","onKeypress"],kv=["src","alt"];function Ov(e,t,n,o,s,r){const i=E("d-button");return g(),y(U,null,[(g(!0),y(U,null,Ce(e.characters,a=>(g(),y("div",{class:"character",tabindex:"0",key:a.id,title:a.label,onClick:G(l=>e.onChosen(a.id.toLowerCase()),["left"]),onKeypress:[Le(G(l=>e.onChosen(a.id.toLowerCase()),["prevent","stop"]),["enter"]),Le(G(l=>e.onChosen(a.id.toLowerCase()),["prevent","stop"]),["space"])]},[u("img",{src:e.assetPath(a),alt:a.label},null,8,kv)],40,Sv))),128)),C(i,{class:"custom-sprite",icon:"extension",onClick:t[0]||(t[0]=a=>e.$emit("show-dialog","type: Characters"))},{default:B(()=>[O(" Search in content packs ")]),_:1})],64)}const xv=ne(Pv,[["render",Ov],["__scopeId","data-v-7bd4f0f4"]]),jv=ee({computed:{vertical(){return this.$store.state.ui.vertical}},data:()=>({visible:!1}),methods:{show(){this.visible=!0},hide(){this.visible=!1},drop(e){if(this.hide(),e.stopPropagation(),e.preventDefault(),!!e.dataTransfer)for(const t of e.dataTransfer.items)t.kind==="file"&&t.type.match(/image.*/)&&this.$emit("drop",t.getAsFile())}}});function Iv(e,t,n,o,s,r){return e.visible?(g(),y("div",{key:0,onDragleave:t[0]||(t[0]=i=>e.visible=!1),onDrop:t[1]||(t[1]=(...i)=>e.drop&&e.drop(...i)),class:pe({vertical:e.vertical})},[qt(e.$slots,"default",{},void 0,!0)],34)):X("",!0)}const Op=ne(jv,[["render",Iv],["__scopeId","data-v-88669357"]]);var Tv=Object.defineProperty,Ev=Object.defineProperties,Bv=Object.getOwnPropertyDescriptors,Td=Object.getOwnPropertySymbols,Av=Object.prototype.hasOwnProperty,Dv=Object.prototype.propertyIsEnumerable,Ed=(e,t,n)=>t in e?Tv(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Bd=(e,t)=>{for(var n in t||(t={}))Av.call(t,n)&&Ed(e,n,t[n]);if(Td)for(var n of Td(t))Dv.call(t,n)&&Ed(e,n,t[n]);return e},Ad=(e,t)=>Ev(e,Bv(t)),Ft=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Dd={packId:"dddg.uploads.sprites",packCredits:[""],dependencies:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Rv=ee({mixins:[st],components:{DropTarget:Op,DButton:Ln},computed:{sprites(){return this.$store.state.content.current.sprites.map(e=>{let t=null;const n=e.variants[0].map(o=>{const s=Mn(o,!1);return s.startsWith("uploads:")?(Object.keys(this.$store.state.uploadUrls),t=s,Cp):s});return Ad(Bd({},e),{missing:t,urls:n})})},showSpritesFolder(){return q.supports.openableFolders.has("sprites")}},methods:{assetSpriteBackground(e){return e.variants[0].map(t=>`url('${Mn(t,!1)}')`).join(",")},showDropTarget(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.spriteDt.show()))},hideDropTarget(){this.$refs.spriteDt.hide()},onSpriteFileUpload(){const e=this.$refs.spriteUpload;if(!!e.files)for(const t of e.files)this.addCustomSpriteFile(t)},onMissingSpriteFileUpload(e){return Ft(this,null,function*(){const t=this.$refs.missingSpriteUpload,n=t.uploadingSprite;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const o=t.files[0];yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){const s=URL.createObjectURL(o);yield this.$store.dispatch("uploadUrls/add",{name:n,url:s})}))})},uploadFromURL(){return Ft(this,null,function*(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){yield this.addNewCustomSprite(t,e)}))})},addSpriteToScene(e){return Ft(this,null,function*(){yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){yield this.$store.dispatch("panels/createSprite",{panelId:this.$store.state.panels.currentPanel,assets:e.variants[0]})}))})},reuploadingSprite(e){const t=this.$refs.missingSpriteUpload;t.uploadingSprite=Mn(e.variants[0][0]).substring(8),t.click()},addCustomSpriteFile(e){return Ft(this,null,function*(){yield this.vuexHistory.transaction(()=>Ft(this,null,function*(){const t=URL.createObjectURL(e),n=yield this.$store.dispatch("uploadUrls/add",{name:e.name,url:t});yield this.addNewCustomSprite(e.name,n)}))})},addNewCustomSprite(e,t){return Ft(this,null,function*(){const n=this.$store.state.content.contentPacks.find(s=>s.packId===Dd.packId)||Dd,o=Ad(Bd({},n),{sprites:[...n.sprites,{id:t,label:e,variants:[[{lq:t,hq:t}]],defaultScale:[1,1],hd:null}]});yield this.$store.dispatch("content/replaceContentPack",{contentPack:o,processed:!0})})},openSpritesFolder(){q.openFolder("sprites")}}});const Hv=["title","onClick","onKeypress"],Mv=["title","onClick","onKeypress"];function Fv(e,t,n,o,s,r){const i=E("drop-target"),a=E("d-button");return g(),y("div",{class:pe(["sub-item-grid",{vertical:e.vertical}]),onDragenter:t[4]||(t[4]=(...l)=>e.showDropTarget&&e.showDropTarget(...l)),onMouseleave:t[5]||(t[5]=(...l)=>e.hideDropTarget&&e.hideDropTarget(...l))},[C(i,{ref:"spriteDt",class:"drop-target",onDrop:e.addCustomSpriteFile},{default:B(()=>[O("Drop here to add as a new sprite ")]),_:1},8,["onDrop"]),(g(!0),y(U,null,Ce(e.sprites,l=>(g(),y(U,null,[l.missing!==null?(g(),y("div",{class:"sprite",tabindex:"0",key:l.label,title:l.label,style:Re({background:e.assetSpriteBackground(l)}),onClick:d=>e.reuploadingSprite(l),onKeypress:[Le(G(d=>e.reuploadingSprite(l),["prevent","stop"]),["enter"]),Le(G(d=>e.reuploadingSprite(l),["prevent","stop"]),["space"])]},fe(l.label),45,Hv)):(g(),y("div",{class:"sprite",tabindex:"0",key:l.label,title:l.label,style:Re({background:e.assetSpriteBackground(l)}),onClick:d=>e.addSpriteToScene(l),onKeypress:[Le(G(d=>e.addSpriteToScene(l),["prevent","stop"]),["enter"]),Le(G(d=>e.addSpriteToScene(l),["prevent","stop"]),["space"])]},fe(l.label),45,Mv))],64))),256)),C(a,{class:"custom-sprite",icon:"publish",onClick:t[1]||(t[1]=l=>e.$refs.spriteUpload.click())},{default:B(()=>[O(" Upload new sprite "),u("input",{type:"file",ref:"spriteUpload",onChange:t[0]||(t[0]=(...l)=>e.onSpriteFileUpload&&e.onSpriteFileUpload(...l))},null,544)]),_:1}),C(a,{icon:"insert_link",onClick:e.uploadFromURL},{default:B(()=>[O(" New sprite from URL ")]),_:1},8,["onClick"]),C(a,{icon:"extension",onClick:t[2]||(t[2]=l=>e.$emit("show-dialog","type: Sprites"))},{default:B(()=>[O(" Search in content packs ")]),_:1}),e.showSpritesFolder?(g(),L(a,{key:0,icon:"folder",onClick:e.openSpritesFolder},{default:B(()=>[O(" Open sprites folder ")]),_:1},8,["onClick"])):X("",!0),u("input",{type:"file",ref:"missingSpriteUpload",onChange:t[3]||(t[3]=(...l)=>e.onMissingSpriteFileUpload&&e.onMissingSpriteFileUpload(...l))},null,544)],34)}const Nv=ne(Rv,[["render",Fv],["__scopeId","data-v-e5df7220"]]);var xn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Lv=ee({components:{DButton:Ln},methods:{addTextBox(){return xn(this,null,function*(){return yield this.createUiElement("createTextBox")})},addChoice(){return xn(this,null,function*(){return yield this.createUiElement("createChoice")})},addDialog(){return xn(this,null,function*(){return yield this.createUiElement("createNotification")})},addPoem(){return xn(this,null,function*(){return yield this.createUiElement("createPoem")})},addConsole(){return xn(this,null,function*(){return yield this.createUiElement("createConsole")})},createUiElement(e){return xn(this,null,function*(){this.vuexHistory.transaction(()=>xn(this,null,function*(){yield this.$store.dispatch(`panels/${e}`,{panelId:this.$store.state.panels.currentPanel})}))})}}});function Uv(e,t,n,o,s,r){return g(),y(U,null,[u("button",{onClick:t[0]||(t[0]=(...i)=>e.addTextBox&&e.addTextBox(...i))},"Textbox"),u("button",{onClick:t[1]||(t[1]=(...i)=>e.addPoem&&e.addPoem(...i))},"Poem"),u("button",{onClick:t[2]||(t[2]=(...i)=>e.addDialog&&e.addDialog(...i))},"Notification"),u("button",{onClick:t[3]||(t[3]=(...i)=>e.addChoice&&e.addChoice(...i))},"Choice"),u("button",{onClick:t[4]||(t[4]=(...i)=>e.addConsole&&e.addConsole(...i))},"Console")],64)}const Vv=ne(Lv,[["render",Uv]]);var Wv=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const zv=ee({mixins:[st],components:{DButton:Ln,Characters:xv,Sprites:Nv,UI:Vv},data:()=>({group:"characters",groups:{characters:{icon:"emoji_people",text:"Char&shy;acters"},sprites:{icon:"change_history",text:"Sprites"},ui:{icon:"view_quilt",text:"UI"}}}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},hasClipboardContent(){return this.$store.state.ui.clipboard!=null},showSpritesFolder(){return q.supports.openableFolders.has("sprites")}},methods:{paste(){this.vuexHistory.transaction(()=>Wv(this,null,function*(){yield this.$store.dispatch("panels/pasteObjectFromClipboard",{panelId:this.currentPanel.id})}))}}});const Gv=e=>(ze("data-v-f14fe160"),e=e(),Ge(),e),qv={class:"panel"},Xv=Gv(()=>u("h1",null,"Add",-1)),Kv=["innerHTML"],Yv=["disabled"];function Jv(e,t,n,o,s,r){const i=E("d-button"),a=E("Characters"),l=E("Sprites"),d=E("UI");return g(),y("div",qv,[Xv,u("div",{class:pe({"group-selector":!0,vertical:e.vertical})},[(g(!0),y(U,null,Ce(e.groups,(c,p)=>(g(),L(i,{key:p,class:pe({active:e.group===p}),"icon-pos":"top",icon:c.icon,onClick:f=>e.group=p},{default:B(()=>[u("span",{innerHTML:c.text},null,8,Kv)]),_:2},1032,["class","icon","onClick"]))),128))],2),u("div",{class:pe({"item-grid":!0,vertical:e.vertical})},[e.group==="characters"?(g(),L(a,{key:0,onShowDialog:t[0]||(t[0]=c=>e.$emit("show-dialog",c))})):e.group==="sprites"?(g(),L(l,{key:1,onShowDialog:t[1]||(t[1]=c=>e.$emit("show-dialog",c))})):e.group==="ui"?(g(),L(d,{key:2})):X("",!0),u("button",{onClick:t[2]||(t[2]=(...c)=>e.paste&&e.paste(...c)),disabled:!e.hasClipboardContent},"Paste",8,Yv)],2)])}const Zv=ne(zv,[["render",Jv],["__scopeId","data-v-f14fe160"]]);function Go(e,t,n){let o=t+n;const s=e.length;return o<0&&(o+=s),o>=s&&(o-=s),o}const Br=1280,Ql=720,Qv=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],xp=1,ey=1/1.5,ty=-74,ny=-26,oy=[200,240,400,493,640,786,880,1040,1080],sy=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Br,screenHeight:Ql,positions:Qv,sdCharacterScaleFactor:xp,hdCharacterScaleFactor:ey,CloseUpYOffset:ty,BaseCharacterYPos:ny,characterPositions:oy},Symbol.toStringTag,{value:"Module"}));var ry=Object.defineProperty,iy=(e,t,n)=>t in e?ry(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ar=(e,t,n)=>(iy(e,typeof t!="symbol"?t+"":t,n),n);const Zn=class{constructor(e,t,n,o){this.r=e,this.g=t,this.b=n,this.a=o}static validCss(e){return this.validCssRgb(e)||this.validHex(e)}static fromCss(e){if(this.validCssRgb(e))return this.fromCssRgb(e);if(this.validHex(e))return this.fromHex(e);throw new Error("Invalid RGB color format")}static validCssRgb(e){return this.rgbEx.test(e)||this.rgbaEx.test(e)}static fromCssRgb(e){if(!this.validCssRgb(e))throw new Error("Invalid RGB color format");const t=e.slice(0,-1),n=t.indexOf("("),s=t.slice(n+1).split(",").map(r=>parseFloat(r.trim()));return new Zn(s[0],s[1],s[2],s.length===4?s[3]:1)}static validHex(e){return this.hexShortEx.test(e)||this.hexLongEx.test(e)}static fromHex(e){if(!this.validHex(e))throw new Error("Invalid Hex color format");const t=e.slice(1);if(t.length===3)return new Zn(parseInt(t[0]+t[0],16),parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),1);if(t.length===4)return new Zn(parseInt(t[0]+t[0],16),parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)/255);if(t.length===6)return new Zn(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16),1);if(t.length===8)return new Zn(parseInt(t[0]+t[1],16),parseInt(t[2]+t[3],16),parseInt(t[4]+t[5],16),parseInt(t[6]+t[7],16)/255);throw new Error("Invalid Hex color format length")}toCss(){return this.a>1?`rgb(${this.r},${this.g},${this.b})`:`rgba(${this.r},${this.g},${this.b},${this.a})`}toHex(){return`#${Math.round(this.r).toString(16).padStart(2,"0")}${Math.round(this.g).toString(16).padStart(2,"0")}${Math.round(this.b).toString(16).padStart(2,"0")}${Math.round(this.a*255).toString(16).padStart(2,"0")}`}toRgb(){return this}toHSL(){let{r:e,g:t,b:n}=this;const{a:o}=this;e/=255,t/=255,n/=255;const s=Math.max(e,t,n),r=Math.min(e,t,n);let i,a;const l=(s+r)/2;if(s===r)i=a=0;else{const d=s-r;switch(a=l>.5?d/(2-s-r):d/(s+r),s){case e:i=(t-n)/d+(t<n?6:0);break;case t:i=(n-e)/d+2;break;case n:i=(e-t)/d+4;break}i/=6}return new me(i,a,l,o)}get luminance(){return Math.sqrt(Math.pow(.299*(this.r/255),2)+Math.pow(.587*(this.g/255),2)+Math.pow(.114*(this.b/255),2))}};let ae=Zn;Ar(ae,"rgbEx",/^rgb\((\d*?),(\d*?),(\d*?)\)$/i);Ar(ae,"rgbaEx",/^rgba\((\d{1,3}),(\d{1,3}),(\d{1,3}),([\d.]+)\)$/i);Ar(ae,"hexShortEx",/^#[0-9A-Z]{3,4}$/i);Ar(ae,"hexLongEx",/^#[0-9A-Z]{6,8}$/i);class me{constructor(t,n,o,s){this.h=t,this.s=n,this.l=o,this.a=s,Object.freeze(this)}toCss(){return this.a>=1?`hsl(${this.h}, ${this.s}, ${this.l})`:`hsla(${this.h}, ${this.s}, ${this.l}, ${this.a})`}shift(t){let{h:n,s:o,l:s,a:r}=this;return n+=t.h,n>=1?n-=1:n<0&&(n+=1),o+t.s>1?o-=t.s:(o+=t.s,o<0&&(o=0)),s+t.l>1||s+t.l<0?s-=t.l:s+=t.l,r+t.a>1||r+t.a<0?r-=t.a:r+=t.a,new me(n,o,s,r)}toRgb(){const{h:t,s:n,l:o,a:s}=this;let r,i,a;if(n===0)r=i=a=o;else{const l=o<.5?o*(1+n):o+n-o*n,d=2*o-l;r=me.hue2rgb(d,l,t+1/3),i=me.hue2rgb(d,l,t),a=me.hue2rgb(d,l,t-1/3)}return new ae(Math.round(r*255),Math.round(i*255),Math.round(a*255),s)}toHSL(){return this}static hue2rgb(t,n,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?t+(n-t)*6*o:o<1/2?n:o<2/3?t+(n-t)*(2/3-o)*6:t}}const ly=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),ay="#ffe6f4",dy="#ffbde1",cy=420,uy=22,py=640,jp=270,fy=7,hy=3,gy=(Ql-jp)/2,my={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},by=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:ly,ChoiceButtonColor:ay,ChoiceButtonBorderColor:dy,ChoiceButtonWidth:cy,ChoiceSpacing:uy,ChoiceX:py,ChoiceYOffset:jp,ChoicePadding:fy,Outline:hy,ChoiceY:gy,ChoiceTextStyle:my},Symbol.toStringTag,{value:"Module"})),Ip="#ffa8d2",vy="#552222",yy="#ffeef6",ea="#bb5599",Tp=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Ep=new me(.002028397565922768,0,.13725490196078438,0),Bp=.82,Ap=new me(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Dp=12,_y=1.5,Qi=12,Ut=1.5,wy=.6,$y=new me(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Cy=new me(0,-.14285714285714296,.3,0),Rp=new me(.004269293924466178,-.01869158878504662,-.039215686274509665,0),el=9.5,Vt=47,Hp=new me(.0023347701149424305,0,.10784313725490202,0),Mp=3,Py=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:Ip,controlsDefaultColor:vy,nameboxDefaultColor:yy,nameboxStrokeDefaultColor:ea,nameboxTextOutlineDelta:Tp,nameboxBackgroundDelta:Ep,nameboxGradientMiddleStopPosition:Bp,nameboxGradientEndDelta:Ap,nameboxRounding:Dp,nameboxRoundingBuffer:_y,textboxRounding:Qi,textboxRoundingBuffer:Ut,nameColorThreshold:wy,controlColorDelta:$y,controlDisableColorDelta:Cy,dotColorDelta:Rp,dotRadius:el,dotPatternSize:Vt,textboxOutlineColorDelta:Hp,textboxOutlineWidth:Mp},Symbol.toStringTag,{value:"Module"}));var Sy=Object.defineProperty,ky=Object.defineProperties,Oy=Object.getOwnPropertyDescriptors,Rd=Object.getOwnPropertySymbols,xy=Object.prototype.hasOwnProperty,jy=Object.prototype.propertyIsEnumerable,Hd=(e,t,n)=>t in e?Sy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Fp=(e,t)=>{for(var n in t||(t={}))xy.call(t,n)&&Hd(e,n,t[n]);if(Rd)for(var n of Rd(t))jy.call(t,n)&&Hd(e,n,t[n]);return e},Np=(e,t)=>ky(e,Oy(t));const Oo=816,ta=900,Dr=146,Iy=0,Ty=29,Ey=8,gs=38,Rr=44,By=6,Ay=93,Dy=404,Ry=9,Hy=9,Et=39,ms=168,bs=34,Hr=29,na=12,oa=-126,sa=-72,ra=-38,ia=30.75,la=26,Lp=426,tl=58,aa={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},Mr=Np(Fp({},aa),{fontName:"riffic",fontSize:24,strokeColor:ea,strokeWidth:6,color:"white",letterSpacing:1}),da={align:"left",font:"13px aller",fill:{style:"#522"}},Up=Np(Fp({},da),{fill:{style:"#a66"}}),My={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},ca={alpha:1,color:"#ffffff",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:4,lineSpacing:1.2},xo=Br/2-Oo/2,Fy=Br/2-ta/2,Ny=xo+gs,Vp=xo+bs,Ly=Vp+ms/2,Uy=xo+oa,Vy=xo+sa,Wy=xo+ra,zy="normal",Gy=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:Oo,TextBoxCorruptedWidth:ta,TextBoxHeight:Dr,TextBoxKerning:Iy,TextBoxLineHeight:Ty,TextBoxCorruptedKerning:Ey,TextBoxTextXOffset:gs,TextBoxTextYOffset:Rr,TextBoxBottomSpacing:By,HdSpacing:Ay,HdSideMargin:Dy,TextBoxTextCorruptedXOffset:Ry,TextBoxTextCorruptedYOffset:Hy,NameboxHeight:Et,NameboxWidth:ms,NameboxXOffset:bs,NameboxTextYOffset:Hr,ControlsYBottomOffset:na,ControlsXHistoryOffset:oa,ControlsXSkipOffset:sa,ControlsXStuffOffset:ra,ArrowXRightOffset:ia,ArrowYBottomOffset:la,GlowRX:Lp,GlowRY:tl,BaseTextStyle:aa,NameboxTextStyle:Mr,ControlsTextStyle:da,ControlsTextDisabledStyle:Up,TextBoxCorruptedStyle:My,TextBoxStyle:ca,TextBoxX:xo,TextBoxCorruptedX:Fy,TextBoxTextX:Ny,NameboxX:Vp,NameboxTextX:Ly,ControlsXHistory:Uy,ControlsXSkip:Vy,ControlsXStuff:Wy,DefaultTextboxStyle:zy},Symbol.toStringTag,{value:"Module"}));var qy=Object.defineProperty,Xy=Object.defineProperties,Ky=Object.getOwnPropertyDescriptors,Md=Object.getOwnPropertySymbols,Yy=Object.prototype.hasOwnProperty,Jy=Object.prototype.propertyIsEnumerable,Fd=(e,t,n)=>t in e?qy(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Zy=(e,t)=>{for(var n in t||(t={}))Yy.call(t,n)&&Fd(e,n,t[n]);if(Md)for(var n of Md(t))Jy.call(t,n)&&Fd(e,n,t[n]);return e},Qy=(e,t)=>Xy(e,Ky(t));const e_="#ffe6f4",t_="#ffbde1",n_="rgba(255,255,255,0.6)",o_=40,s_=30,r_=Qy(Zy({},aa),{fontName:"riffic",fontSize:24,strokeColor:ea,strokeWidth:8,letterSpacing:1,color:"white"}),i_={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},l_=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:e_,NotificationBorderColor:t_,NotificationBackdropColor:n_,NotificationPadding:o_,NotificationSpacing:s_,NotificationOkTextStyle:r_,NotificationTextStyle:i_},Symbol.toStringTag,{value:"Module"}));var a_=Object.defineProperty,d_=Object.defineProperties,c_=Object.getOwnPropertyDescriptors,Nd=Object.getOwnPropertySymbols,u_=Object.prototype.hasOwnProperty,p_=Object.prototype.propertyIsEnumerable,Ld=(e,t,n)=>t in e?a_(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,on=(e,t)=>{for(var n in t||(t={}))u_.call(t,n)&&Ld(e,n,t[n]);if(Nd)for(var n of Nd(t))p_.call(t,n)&&Ld(e,n,t[n]);return e},sn=(e,t)=>d_(e,c_(t));const Wp=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],f_=0,h_=0,g_=Br/2,m_=Ql/2,b_=33,v_=100,y_=30,__=800,w_=720,$_=xp,C_="rgba(51,51,51,0.75)",P_=480,S_=180,k_=3,O_=7,rn={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:12},zp=[sn(on({},rn),{name:"Sayori",fontName:"hashtag",fontSize:34,lineSpacing:1.05,letterSpacing:0}),sn(on({},rn),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:28}),sn(on({},rn),{name:"Monika",fontName:"journal",fontSize:34}),sn(on({},rn),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.5,fontSize:32}),sn(on({},rn),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:18,letterSpacing:-8}),sn(on({},rn),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:40}),sn(on({},rn),{name:"MC",fontName:"halogen",fontSize:30,lineSpacing:1.53}),sn(on({},rn),{name:"Console",fontName:"f25_bank_printer",fontSize:18,color:"white",lineSpacing:1.1})],x_=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:Wp,defaultPoemBackground:f_,defaultPoemStyle:h_,defaultX:g_,defaultY:m_,poemTopPadding:b_,poemBottomPadding:v_,poemPadding:y_,defaultPoemWidth:__,defaultPoemHeight:w_,backgroundScale:$_,consoleBackgroundColor:C_,consoleWidth:P_,consoleHeight:S_,defaultConsoleBackground:k_,defaultConsoleStyle:O_,poemTextStyles:zp},Symbol.toStringTag,{value:"Module"})),j_={Base:sy,Choices:by,Notification:l_,Poem:x_,TextBox:Gy,TextBoxCustom:Py},Fr=1920,ua=1080,I_=["4-1","3-1","2-1","4-2","center","4-3","2-2","3-3","4-4"],Gp=1.5,T_=1,E_=-111,B_=-39,A_=[300,360,600,740,960,1180,1320,1560,1620],D_=Object.freeze(Object.defineProperty({__proto__:null,screenWidth:Fr,screenHeight:ua,positions:I_,sdCharacterScaleFactor:Gp,hdCharacterScaleFactor:T_,CloseUpYOffset:E_,BaseCharacterYPos:B_,characterPositions:A_},Symbol.toStringTag,{value:"Module"})),R_=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),H_="#ffe6f4",M_="#ffbde1",F_=630,N_=33,L_=960,qp=405,U_=10.5,V_=4.5,W_=(ua-qp)/2,z_={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1,strokeColor:"",strokeWidth:0},G_=Object.freeze(Object.defineProperty({__proto__:null,nameboxTextOutlineDelta:R_,ChoiceButtonColor:H_,ChoiceButtonBorderColor:M_,ChoiceButtonWidth:F_,ChoiceSpacing:N_,ChoiceX:L_,ChoiceYOffset:qp,ChoicePadding:U_,Outline:V_,ChoiceY:W_,ChoiceTextStyle:z_},Symbol.toStringTag,{value:"Module"})),Xp="#ffa8d2",q_="#552222",X_="#ffeef6",pa="#bb5599",Kp=new me(-.03065134099616873,-.5714285714285714,-.29607843137254897,0),Yp=new me(.002028397565922768,0,.13725490196078438,0),Jp=.82,Zp=new me(-.004901960784313708,-.8599999999999999,-.16274509803921566,0),Qp=15,K_=1.5,nl=19,Wt=1.5,Y_=.6,J_=new me(.08045977011494243,-.5714285714285714,-.5960784313725489,0),Z_=new me(0,-.14285714285714296,.3,0),ef=new me(.004269293924466178,-.01869158878504662,-.039215686274509665,0),ol=9.5*1.5,zt=47*1.5,tf=new me(.0023347701149424305,0,.10784313725490202,0),nf=5,Q_=Object.freeze(Object.defineProperty({__proto__:null,textboxDefaultColor:Xp,controlsDefaultColor:q_,nameboxDefaultColor:X_,nameboxStrokeDefaultColor:pa,nameboxTextOutlineDelta:Kp,nameboxBackgroundDelta:Yp,nameboxGradientMiddleStopPosition:Jp,nameboxGradientEndDelta:Zp,nameboxRounding:Qp,nameboxRoundingBuffer:K_,textboxRounding:nl,textboxRoundingBuffer:Wt,nameColorThreshold:Y_,controlColorDelta:J_,controlDisableColorDelta:Z_,dotColorDelta:ef,dotRadius:ol,dotPatternSize:zt,textboxOutlineColorDelta:tf,textboxOutlineWidth:nf},Symbol.toStringTag,{value:"Module"}));var ew=Object.defineProperty,tw=Object.defineProperties,nw=Object.getOwnPropertyDescriptors,Ud=Object.getOwnPropertySymbols,ow=Object.prototype.hasOwnProperty,sw=Object.prototype.propertyIsEnumerable,Vd=(e,t,n)=>t in e?ew(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,of=(e,t)=>{for(var n in t||(t={}))ow.call(t,n)&&Vd(e,n,t[n]);if(Ud)for(var n of Ud(t))sw.call(t,n)&&Vd(e,n,t[n]);return e},sf=(e,t)=>tw(e,nw(t));const fa=1220,rf=900,lf=219,rw=0,iw=29,lw=8,ha=57,af=68,aw=54,dw=9,cw=9,to=59,ga=252,ma=49,df=43,cf=12*1.5,uf=-126*1.5,pf=-72*1.5,ff=-38*1.5,hf=30.75*1.5,gf=26*1.5,mf=426*1.5,sl=58*1.5,ba={alpha:1,color:"black",fontName:"aller",fontSize:24,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:1,lineSpacing:1.2,strokeColor:"",strokeWidth:0},bf=sf(of({},ba),{fontName:"riffic",fontSize:36,strokeColor:pa,strokeWidth:9,color:"white",letterSpacing:2}),ar={align:"left",font:"24px aller",fill:{style:"#522"}},vf=sf(of({},ar),{fill:{style:"#a66"}}),yf={alpha:1,color:"#ffffff",fontName:"aller",fontSize:30,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,strokeColor:"#523140",strokeWidth:5,lineSpacing:1.2},uw={align:"left",font:"24px verily",outline:{style:"#000",width:20},fill:{style:"#fff"}},jo=Fr/2-fa/2,pw=Fr/2-rf/2,fw=jo+ha,_f=jo+ma,hw=_f+ga/2,gw=jo+uf,mw=jo+pf,bw=jo+ff,vw="custom_plus",yw=Object.freeze(Object.defineProperty({__proto__:null,TextBoxWidth:fa,TextBoxCorruptedWidth:rf,TextBoxHeight:lf,TextBoxKerning:rw,TextBoxLineHeight:iw,TextBoxCorruptedKerning:lw,TextBoxTextXOffset:ha,TextBoxTextYOffset:af,TextBoxBottomSpacing:aw,TextBoxTextCorruptedXOffset:dw,TextBoxTextCorruptedYOffset:cw,NameboxHeight:to,NameboxWidth:ga,NameboxXOffset:ma,NameboxTextYOffset:df,ControlsYBottomOffset:cf,ControlsXHistoryOffset:uf,ControlsXSkipOffset:pf,ControlsXStuffOffset:ff,ArrowXRightOffset:hf,ArrowYBottomOffset:gf,GlowRX:mf,GlowRY:sl,BaseTextStyle:ba,NameboxTextStyle:bf,ControlsTextStyle:ar,ControlsTextDisabledStyle:vf,TextBoxStyle:yf,TextBoxCorruptedStyle:uw,TextBoxX:jo,TextBoxCorruptedX:pw,TextBoxTextX:fw,NameboxX:_f,NameboxTextX:hw,ControlsXHistory:gw,ControlsXSkip:mw,ControlsXStuff:bw,DefaultTextboxStyle:vw},Symbol.toStringTag,{value:"Module"}));var _w=Object.defineProperty,ww=Object.defineProperties,$w=Object.getOwnPropertyDescriptors,Wd=Object.getOwnPropertySymbols,Cw=Object.prototype.hasOwnProperty,Pw=Object.prototype.propertyIsEnumerable,zd=(e,t,n)=>t in e?_w(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Sw=(e,t)=>{for(var n in t||(t={}))Cw.call(t,n)&&zd(e,n,t[n]);if(Wd)for(var n of Wd(t))Pw.call(t,n)&&zd(e,n,t[n]);return e},kw=(e,t)=>ww(e,$w(t));const Ow="#ffe6f4",xw="#ffbde1",jw="rgba(255,255,255,0.6)",Iw=60,Tw=45,Ew=kw(Sw({},ba),{fontName:"riffic",fontSize:36,strokeColor:pa,strokeWidth:12,letterSpacing:1,color:"white"}),Bw={alpha:1,color:"black",fontName:"aller",fontSize:36,isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0},Aw=Object.freeze(Object.defineProperty({__proto__:null,NotificationBackgroundColor:Ow,NotificationBorderColor:xw,NotificationBackdropColor:jw,NotificationPadding:Iw,NotificationSpacing:Tw,NotificationOkTextStyle:Ew,NotificationTextStyle:Bw},Symbol.toStringTag,{value:"Module"}));var Dw=Object.defineProperty,Rw=Object.defineProperties,Hw=Object.getOwnPropertyDescriptors,Gd=Object.getOwnPropertySymbols,Mw=Object.prototype.hasOwnProperty,Fw=Object.prototype.propertyIsEnumerable,qd=(e,t,n)=>t in e?Dw(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ln=(e,t)=>{for(var n in t||(t={}))Mw.call(t,n)&&qd(e,n,t[n]);if(Gd)for(var n of Gd(t))Fw.call(t,n)&&qd(e,n,t[n]);return e},an=(e,t)=>Rw(e,Hw(t));const Nw=[{name:"Normal paper",file:"poem.jpg"},{name:"Lightly soiled paper",file:"poem_y1.jpg"},{name:"Heavily soiled paper",file:"poem_y2.jpg"},{name:"Console",file:"internal:console"},{name:"Transparent",file:"internal:transparent"}],Lw=0,Uw=0,Vw=Fr/2,Ww=ua/2,zw=26,Gw=150,qw=61,Xw=1200,Kw=1080,Yw=Gp,Jw="rgba(51,51,51,0.75)",Zw=720,Qw=270,e$=3,t$=7,dn={alpha:1,color:"black",isBold:!1,isItalic:!1,isStrikethrough:!1,isUnderlined:!1,letterSpacing:0,lineSpacing:1.2,strokeColor:"",strokeWidth:0,fontName:"aller",fontSize:18},n$=[an(ln({},dn),{name:"Sayori",fontName:"hashtag",fontSize:45,lineSpacing:.95,letterSpacing:1}),an(ln({},dn),{name:"Natsuki",fontName:"ammy_handwriting",fontSize:41,letterSpacing:-.5}),an(ln({},dn),{name:"Monika",fontName:"journal",fontSize:36,lineSpacing:1.4,letterSpacing:.5}),an(ln({},dn),{name:"Yuri",fontName:"jp_hand_slanted",lineSpacing:1.55,fontSize:48}),an(ln({},dn),{name:"Yuri Act 2",fontName:"damagrafik_script",fontSize:27,letterSpacing:-12}),an(ln({},dn),{name:"Yuri Unused",fontName:"as_i_lay_dying",fontSize:60}),an(ln({},dn),{name:"MC",fontName:"halogen",fontSize:45,lineSpacing:1.53}),an(ln({},dn),{name:"Console",fontName:"f25_bank_printer",fontSize:27,color:"white",lineSpacing:1.1})],o$=Object.freeze(Object.defineProperty({__proto__:null,poemBackgrounds:Nw,defaultPoemBackground:Lw,defaultPoemStyle:Uw,defaultX:Vw,defaultY:Ww,poemTopPadding:zw,poemBottomPadding:Gw,poemPadding:qw,defaultPoemWidth:Xw,defaultPoemHeight:Kw,backgroundScale:Yw,consoleBackgroundColor:Jw,consoleWidth:Zw,consoleHeight:Qw,defaultConsoleBackground:e$,defaultConsoleStyle:t$,poemTextStyles:n$},Symbol.toStringTag,{value:"Module"})),s$={Base:D_,Choices:G_,Notification:Aw,Poem:o$,TextBox:yw,TextBoxCustom:Q_};function Y(){return q.gameMode==="ddlc_plus"?s$:j_}function Io(){return{flip:!1,rotation:0,version:0,opacity:100,x:Y().Base.screenWidth/2,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!1,nameboxWidth:null,zoom:1}}var r$=Object.defineProperty,i$=Object.defineProperties,l$=Object.getOwnPropertyDescriptors,Xd=Object.getOwnPropertySymbols,a$=Object.prototype.hasOwnProperty,d$=Object.prototype.propertyIsEnumerable,Kd=(e,t,n)=>t in e?r$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,dr=(e,t)=>{for(var n in t||(t={}))a$.call(t,n)&&Kd(e,n,t[n]);if(Xd)for(var n of Xd(t))d$.call(t,n)&&Kd(e,n,t[n]);return e},c$=(e,t)=>i$(e,l$(t)),u$=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const p$={setPose(e,t){const n=e.panels[t.panelId].objects[t.id];n.poseId=t.poseId,++n.version},setCharStyleGroup(e,{id:t,panelId:n,styleGroupId:o}){const s=e.panels[n].objects[t];s.styleGroupId=o,++s.version},setCharStyle(e,{id:t,panelId:n,styleId:o}){const s=e.panels[n].objects[t];s.styleId=o,++s.version},setClose(e,t){const n=e.panels[t.panelId].objects[t.id];n.close=t.close,++n.version},setPosePosition(e,t){const n=e.panels[t.panelId].objects[t.id];n.posePositions=dr(dr({},n.posePositions),t.posePositions),++n.version},setFreeMove(e,t){const n=e.panels[t.panelId].objects[t.id];if(n.freeMove=t.freeMove,!n.freeMove){const o=Y();n.x=o.Base.characterPositions[ur(n.x)],n.y=o.Base.BaseCharacterYPos}}};function Nr(e,t){return e.getters["content/getCharacters"].get(t.characterType)}function jn(e,t){return e["content/getCharacters"].get(t)}function bn(e,t){return e.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId]}function f$(e,t){const n=bn(e,t),o=[...Object.keys(n.positions).filter(s=>n.positions[s].length>1)];return n.compatibleHeads.length>0&&o.unshift("head"),o}function cr(e,t,n=t.posePositions.headType||0){const o=bn(e,t).compatibleHeads;return o.length===0?null:e.heads[o[n]]}function ur(e){return Y().Base.characterPositions.map((o,s)=>({pos:Math.abs(e-o),idx:s})).sort((o,s)=>o.pos-s.pos)[0].idx}const h$={createCharacters({rootState:e,rootGetters:t,commit:n,state:o},s){var r;const i=o.panels[s.panelId].lastObjId+1,a=Y(),l=jn(t,s.characterType),d=l.hd?a.Base.hdCharacterScaleFactor:a.Base.sdCharacterScaleFactor;return n("create",{object:c$(dr({},Io()),{id:i,panelId:e.panels.currentPanel,onTop:!1,type:"character",y:a.Base.BaseCharacterYPos,preserveRatio:!0,ratio:1,width:l.size[0]*l.defaultScale[0]*d,height:l.size[1]*l.defaultScale[1]*d,characterType:s.characterType,close:!1,freeMove:!1,poseId:0,styleId:0,styleGroupId:0,posePositions:{},label:(r=l.label)!=null?r:l.id,enlargeWhenTalking:e.ui.defaultCharacterTalkingZoom})}),i},seekPart({state:e,commit:t,dispatch:n,rootGetters:o},{delta:s,id:r,panelId:i,part:a}){if(a==="head"){n("seekHead",{id:r,panelId:i,delta:s});return}const l=e.panels[i].objects[r],d=bn(jn(o,l.characterType),l);!d.positions[a]||t("setPosePosition",{id:r,panelId:i,posePositions:{[a]:Go(d.positions[a],l.posePositions[a]||0,s)}})},seekPose({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=a.styleGroups[i.styleGroupId].styles[i.styleId].poses;Gn(t,i,a,d=>{d.poseId=Go(l,d.poseId,r)})},seekStyle({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=a.styleGroups.flatMap((c,p)=>c.styles.map((f,b)=>({styleGroupIdx:p,styleIdx:b,styleGroupJson:JSON.stringify(f.components)}))).sort((c,p)=>c.styleGroupJson.localeCompare(p.styleGroupJson)),d=l.findIndex(c=>c.styleGroupIdx===i.styleGroupId&&c.styleIdx===i.styleId);Gn(t,i,a,c=>{const p=Go(l,d,r),f=l[p];c.styleGroupId=f.styleGroupIdx,c.styleId=f.styleIdx})},seekHead({state:e,commit:t,rootGetters:n},{id:o,panelId:s,delta:r}){const i=e.panels[s].objects[o],a=jn(n,i.characterType),l=bn(a,i);let d=cr(a,i);if(!d)return;let c=(i.posePositions.head||0)+r,p=i.posePositions.headType||0;(c<0||c>=d.variants.length)&&(p=Go(l.compatibleHeads.map(f=>a.heads[f]),p,r),d=cr(a,i,p),c=r===1?0:d.variants.length-1),t("setPosePosition",{id:o,panelId:s,posePositions:{head:c,headType:p}})},setPart({state:e,commit:t,rootGetters:n},{panelId:o,id:s,part:r,val:i}){const a=e.panels[o].objects[s],l=jn(n,a.characterType);r==="pose"?Gn(t,a,l,d=>{d.poseId=i}):r==="style"?Gn(t,a,l,d=>{d.styleId=i}):Gn(t,a,l,d=>{d.posePositions[r]=i})},setCharStyle({state:e,commit:t,rootGetters:n},{panelId:o,id:s,styleGroupId:r,styleId:i}){const a=e.panels[o].objects[s],l=jn(n,a.characterType);Gn(t,a,l,d=>{d.styleGroupId=r,d.styleId=i})},setCharacterPosition({state:e,commit:t},{panelId:n,id:o,x:s,y:r}){const i=e.panels[n].objects[o];if(!i.freeMove){const a=Y();s=a.Base.characterPositions[ur(s)],r=a.Base.BaseCharacterYPos+(i.close?a.Base.CloseUpYOffset:0)}i.x===s&&i.y===r||t("setPosition",{panelId:n,id:o,x:s,y:r})},shiftCharacterSlot({state:e,commit:t},{panelId:n,id:o,delta:s}){const r=e.panels[n].objects[o],i=Y();let l=ur(r.x)+s;l<0&&(l=0),l>=i.Base.characterPositions.length&&(l=i.Base.characterPositions.length-1),t("setPosition",{panelId:n,id:o,x:i.Base.characterPositions[l],y:r.y})}};function g$(e,t,n,o){return u$(this,null,function*(){const s=e.state.panels[t].objects[n],r=o.characters.find(j=>j.id===s.characterType);if(!r){console.error("Character data is missing. Dropping the character."),yield e.dispatch("removeObject",{id:n,panelId:t});return}const i=wf(s),a=r.styleGroups[s.styleGroupId],l=a.styles[i.styleId],d=l.poses[i.poseId],c=e.rootState.content.current.characters.find(j=>j.id===r.id);if(!c){console.error("Character data is missing. Dropping the character."),yield e.dispatch("removeObject",{id:n,panelId:t});return}const p=c.styleGroups.findIndex(j=>j.id===a.id);i.styleGroupId=p===-1?0:p;const f=c.styleGroups[i.styleGroupId],b=JSON.stringify(l.components),v=f.styles.findIndex(j=>JSON.stringify(j.components)===b);i.styleId=v===-1?0:v;const w=f.styles[i.styleId],H=w.poses.findIndex(j=>j.id===d.id);i.poseId=H===-1?0:H;const D=w.poses[i.poseId];for(const j in D.positions){if(!D.positions.hasOwnProperty(j))continue;const K=D.positions[j];if(d.positions[j]){const Q=i.posePositions[j];Q>=0&&Q<K.length}}const $=d.compatibleHeads[s.posePositions.headType],x=D.compatibleHeads.indexOf($);if(x===-1)i.posePositions.headType=0,i.posePositions.head=0;else{x!==s.posePositions.headType&&(i.posePositions.headType=x);const j=JSON.stringify(r.heads[$].variants[s.posePositions.head]),K=c.heads[$].variants.findIndex(Q=>JSON.stringify(Q)===j);K===-1?i.posePositions.head=0:i.posePositions.head=K}$f(e.commit,s,i)})}function wf(e){return{styleGroupId:e.styleGroupId,styleId:e.styleId,poseId:e.poseId,posePositions:dr({},e.posePositions)}}function $f(e,t,n){n.styleGroupId!==t.styleGroupId&&e("setCharStyleGroup",{id:t.id,panelId:t.panelId,styleGroupId:n.styleGroupId}),n.styleId!==t.styleId&&(console.log(`Setting style of ${t.id} to ${n.styleId}`),e("setCharStyle",{id:t.id,panelId:t.panelId,styleId:n.styleId})),n.poseId!==t.poseId&&e("setPose",{id:t.id,panelId:t.panelId,poseId:n.poseId}),JSON.stringify(n.posePositions)!==JSON.stringify(t.posePositions)&&e("setPosePosition",{id:t.id,panelId:t.panelId,posePositions:n.posePositions})}function Gn(e,t,n,o){const s=wf(t);o(s),n.styleGroups[s.styleGroupId]||(s.styleGroupId=0);const r=n.styleGroups[s.styleGroupId];r.styles[s.styleId]||(s.styleId=0);const i=r.styles[s.styleId];i.poses[s.poseId]||(s.poseId=0);const a=i.poses[s.poseId];for(const p in a.positions)!a.positions[p]||a.positions[p][s.posePositions[p]]||(s.posePositions[p]=0);const d=n.styleGroups[t.styleGroupId].styles[t.styleId].poses[t.poseId].compatibleHeads[t.posePositions.headType||0],c=a.compatibleHeads.indexOf(d);c>=0?s.posePositions.headType=c:(s.posePositions.headType=0,s.posePositions.head=0),$f(e,t,s)}const m$=ee({props:{title:{required:!0,type:String}}});const b$={class:"fieldset_wrapper"},v$={key:0},y$={class:"fieldset_contents"};function _$(e,t,n,o,s,r){return g(),y("div",b$,[u("fieldset",null,[e.title>""?(g(),y("legend",v$,fe(e.title),1)):X("",!0),u("div",y$,[qt(e.$slots,"default",{},void 0,!0)])])])}const Ht=ne(m$,[["render",_$],["__scopeId","data-v-d714a009"]]);var w$=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Yd=960,$$=ee({props:{part:{required:!0},value:{required:!0},size:{type:Number,default:150}},data:()=>({lookups:[],loaded:!1}),computed:{scaleX(){return this.size/this.part.size[0]},scaleY(){return this.size/this.part.size[1]},backgroundSize(){return`${Math.floor(Yd*this.scaleX)}px ${Math.floor(Yd*this.scaleY)}px`},backgroundPosition(){return`${Math.floor(this.part.offset[0]*-this.scaleX)}px ${Math.floor(this.part.offset[1]*-this.scaleY)}px`},background(){var e,t;let n="";const o=this.backgroundSize,s=(e=this.part.offset)!=null?e:[0,0];for(let r=0;r<this.part.images.length;++r){const i=this.part.images[r],a=this.lookups[r];if(!a)continue;r>0&&(n+=", ");const l=(t=i.offset)!=null?t:[0,0],d=`${Math.floor((s[0]-l[0])*-this.scaleX)}px ${Math.floor((s[1]-l[1])*-this.scaleY)}px`;n+=`url('${a.replace("'","\\'")}') ${d} / ${o}`}return n},style(){return{height:this.size+"px",width:this.size+"px",background:this.background}}},created(){return w$(this,null,function*(){this.lookups=yield Promise.all(this.part.images.map(e=>typeof e.asset=="string"?Ib(e.asset,!1):Mn(e.asset,!1)))})},methods:{quickClick(e){e.preventDefault(),this.$emit("quick-click")}}});function C$(e,t,n,o,s,r){var i;return g(),y("div",{class:pe({part:!0,active:(i=e.part)==null?void 0:i.active}),style:Re(e.style),tabindex:"0",onClick:t[0]||(t[0]=a=>e.$emit("click")),onContextmenu:t[1]||(t[1]=(...a)=>e.quickClick&&e.quickClick(...a)),onKeydown:[t[2]||(t[2]=Le(G(a=>e.$emit("click"),["prevent"]),["enter"])),t[3]||(t[3]=Le(G((...a)=>e.quickClick&&e.quickClick(...a),["prevent"]),["space"]))]},null,38)}const P$=ne($$,[["render",C$],["__scopeId","data-v-aa6e96cb"]]);var S$=Object.defineProperty,k$=Object.defineProperties,O$=Object.getOwnPropertyDescriptors,Jd=Object.getOwnPropertySymbols,x$=Object.prototype.hasOwnProperty,j$=Object.prototype.propertyIsEnumerable,Zd=(e,t,n)=>t in e?S$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,I$=(e,t)=>{for(var n in t||(t={}))x$.call(t,n)&&Zd(e,n,t[n]);if(Jd)for(var n of Jd(t))j$.call(t,n)&&Zd(e,n,t[n]);return e},T$=(e,t)=>k$(e,O$(t));const E$=ee({mixins:[Yl],props:{noWraping:{type:Boolean,default:!1},direction:{type:String,default:"global"},maxSize:{},gap:{type:String,default:"0px"}},computed:{finalDirection(){return this.direction==="global"?this.$store.state.ui.vertical?"vertical":"horizontal":this.direction==="inverted"?this.$store.state.ui.vertical?"horizontal":"vertical":this.direction}},render(){const e=this.noWraping?"no-wraping":"wraping",n=sd("div",T$(I$({},{}),{class:["d-flow",this.finalDirection,e],style:{gap:this.gap}}),this.$slots.default());if(this.maxSize!==void 0){const o=this.maxSize instanceof Array?this.maxSize[this.finalDirection==="horizontal"?0:1]:this.maxSize;return sd("div",{ref:"scrollContainer",class:["d-flow-scroll-container",this.finalDirection],style:{[this.finalDirection==="horizontal"?"maxWidth":"maxHeight"]:o}},[n])}return n},mounted(){this.$refs.scrollContainer&&this.$refs.scrollContainer.addEventListener("wheel",this.verticalScrollRedirect)}});const vs=ne(E$,[["__scopeId","data-v-fdd024db"]]);var Qd=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const B$=ee({components:{PartButton:P$,DFieldset:Ht,DFlow:vs},props:{character:{type:Object,required:!0},part:{required:!0,type:String}},data:()=>({isWebPSupported:null,stylePriorities:[]}),computed:{vertical(){return this.$store.state.ui.vertical},styleComponents(){if(this.part!=="style")return[];const e=this.charData.styleGroups[this.character.styleGroupId];return e.styleComponents.map(t=>{const n={};for(const o in t.variants){if(!t.variants.hasOwnProperty(o))continue;const s=t.variants[o];n[o]={size:e.styles[0].poses[0].size,offset:[0,0],images:[{offset:[0,0],asset:s}],active:!1}}return{label:t.label,name:t.id,buttons:n}})},parts(){const e={};let t,n,o;const s=this.charData,r=bn(s,this.character);switch(this.part){case"head":const i=this.character.posePositions.headType||0,a=this.character.posePositions.head||0;for(let d=0;d<r.compatibleHeads.length;++d){const c=r.compatibleHeads[d],p=s.heads[c];for(let f=0;f<p.variants.length;++f){const b=p.variants[f];e[`${d}_${f}`]={size:p.previewSize,offset:p.previewOffset,images:b.map(v=>({asset:v,offset:[0,0]})),active:a===f&&i===d}}}return e;case"pose":const l=s.styleGroups[this.character.styleGroupId].styles[this.character.styleId];for(let d=0;d<l.poses.length;++d){const c=l.poses[d];e[d]=this.generatePosePreview(c),e[d].active=d===this.character.poseId}return e;case"style":for(let d=0;d<s.styleGroups.length;++d){const c=s.styleGroups[d];e[c.id]=this.generatePosePreview(c.styles[0].poses[0]),e[c.id].active=d===this.character.styleGroupId}return e;default:t=r.positions[this.part],o=r.previewSize,n=r.previewOffset;break}for(let i=0;i<t.length;++i){const a=t[i];e[i]={images:a.map(l=>({offset:[0,0],asset:l})),size:o,offset:n,active:i===(this.character.posePositions[this.part]||0)}}return e},charData(){return Nr(this.$store,this.character)}},methods:{updateStyleData(){const e=this.charData.styleGroups[this.character.styleGroupId].styles[this.character.styleId];this.stylePriorities=Object.keys(e.components).map(t=>[t,e.components[t]])},generatePosePreview(e){const t=this.charData;let n=[];for(const o of e.renderCommands)switch(o.type){case"pose-part":const s=e.positions[o.part];if(s==null||s.length===0)break;n=n.concat(s[0].map(a=>({asset:a,offset:o.offset})));break;case"head":const r=t.heads[e.compatibleHeads[0]];if(e.compatibleHeads.length===0)break;const i=r.variants[0];n=n.concat(i.map(a=>({asset:a,offset:o.offset})));break;case"image":n=n.concat(o.images.map(a=>({asset:a,offset:o.offset})));break}return{images:n,size:e.previewSize,offset:e.previewOffset,active:!1}},updatePose(e){e==null&&(e=this.character.styleGroupId);const n=this.charData.styleGroups[e];let o=n.styles;for(const s of this.stylePriorities){const r=o.filter(i=>i.components[s[0]]===s[1]);r.length>0&&(o=r)}this.vuexHistory.transaction(()=>Qd(this,null,function*(){yield this.$store.dispatch("panels/setCharStyle",{id:this.character.id,panelId:this.character.panelId,styleGroupId:e,styleId:n.styles.indexOf(o[0])})}))},choose(e){if(this.part==="style")this.updatePose(this.charData.styleGroups.findIndex(t=>t.id===e));else if(this.part==="head"){const[t,n]=e.split("_",2).map(o=>parseInt(o,10));this.$store.commit("panels/setPosePosition",{id:this.character.id,panelId:this.character.panelId,posePositions:{headType:t,head:n}})}else this.setPart(this.part,parseInt(e,10))},choose_component(e,t){const n=this.stylePriorities.findIndex(o=>o[0]===e);this.stylePriorities.splice(n,1),this.stylePriorities.unshift([e,t]),this.updatePose()},onKeydown(e){(e.key==="Backspace"||e.key==="Escape")&&(this.$emit("leave"),e.preventDefault(),e.stopPropagation())},setPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPart",{id:this.character.id,panelId:this.character.panelId,part:e,val:t})})}},created(){return Qd(this,null,function*(){this.updateStyleData(),this.isWebPSupported=yield mo()})},watch:{character(){this.updateStyleData()}}});const $n=e=>(ze("data-v-fce4aeac"),e=e(),Ge(),e),A$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),D$=$n(()=>u("span",{class:"text-block"},"Create new expressions",-1)),R$=[A$,D$],H$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),M$=$n(()=>u("span",{class:"text-block"},"Search in content packs",-1)),F$=[H$,M$],N$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),L$=$n(()=>u("span",null,"Search in content packs",-1)),U$=[N$,L$],V$=$n(()=>u("i",{class:"material-icons"},"extension",-1)),W$=$n(()=>u("span",null,"Search in content packs",-1)),z$=[V$,W$];function G$(e,t,n,o,s,r){const i=E("part-button"),a=E("d-flow"),l=E("d-fieldset");return g(),L(a,{"no-wraping":"",onKeydown:e.onKeydown},{default:B(()=>[u("button",{onClick:t[0]||(t[0]=d=>e.$emit("leave"))},"Back"),e.part==="head"?(g(),y("button",{key:0,onClick:t[1]||(t[1]=d=>e.$emit("show-expression-dialog",{character:e.character.characterType})),class:"icon-button"},R$)):X("",!0),e.part==="head"?(g(),y("button",{key:1,onClick:t[2]||(t[2]=d=>e.$emit("show-dialog","type: Expressions character: "+e.charData.label)),class:"icon-button"},F$)):e.part==="style"?(g(),y("button",{key:2,onClick:t[3]||(t[3]=d=>e.$emit("show-dialog","type: Styles character: "+e.charData.label)),class:"icon-button"},U$)):(g(),y("button",{key:3,onClick:t[4]||(t[4]=d=>e.$emit("show-dialog","type: Poses character: "+e.charData.label)),class:"icon-button"},z$)),(g(!0),y(U,null,Ce(e.parts,(d,c)=>(g(),L(i,{key:c,value:c,part:d,onClick:p=>{e.choose(c),e.$emit("leave")},onQuickClick:p=>e.choose(c)},null,8,["value","part","onClick","onQuickClick"]))),128)),(g(!0),y(U,null,Ce(e.styleComponents,d=>(g(),L(l,{key:d.name,title:d.label},{default:B(()=>[C(a,{noWraping:""},{default:B(()=>[(g(!0),y(U,null,Ce(d.buttons,(c,p)=>(g(),L(i,{size:130,key:p,value:p,part:c,onClick:f=>e.choose_component(d.name,p)},null,8,["value","part","onClick"]))),128))]),_:2},1024)]),_:2},1032,["title"]))),128))]),_:1},8,["onKeydown"])}const q$=ne(B$,[["render",G$],["__scopeId","data-v-fce4aeac"]]);function ys(){return function(t,n,o=!1){return{get(){return this.object[t]},set(s){this.vuexHistory.transaction(()=>{this.$store[o?"dispatch":"commit"](n,{panelId:this.object.panelId,id:this.object.id,[t]:s})})}}}}function va(e){return function(n){return{get(){return this.object[n]},set(o){this.vuexHistory.transaction(()=>{this.$store.commit(e,{panelId:this.object.panelId,id:this.object.id,key:n,value:o})})}}}}var X$=Object.defineProperty,K$=(e,t,n)=>t in e?X$(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Y$=(e,t,n)=>(K$(e,typeof t!="symbol"?t+"":t,n),n);const ec=5;class J${constructor(t){this.str=t,Y$(this,"pos",0)}current(){return this.str[this.pos]}get around(){return this.str.slice(Math.max(0,this.pos-ec),this.pos+ec)}get ahead(){return this.str[this.pos+1]}get behind(){return this.str[this.pos+1]}next(){return++this.pos,this.current()}}function tc(e,t=!0){const n=[],o=new J$(e);let s=Lr;for(;s!==Ur;){const r=o.pos;try{s=s(n,o)}catch(i){if(t&&s!==rl)o.pos=r,s=(a,l)=>rl(a,l,!0);else throw i}}return n}function Lr(e,t){return t.current()===void 0?Ur:t.current()==="{"?Z$:t.current()===`
`?Q$:rl}function Ur(){return Ur}function rl(e,t,n=!1){const{pos:o}=t;let s="",r=n,i;for(;;){if(t.current()===void 0){i=Ur;break}else if(r)s+=t.current(),r=!1;else if(t.current()==="\\")r=!0;else if(t.current()==="{"||t.current()===`
`){i=Lr;break}else s+=t.current();t.next()}return e.push({type:"text",pos:o,content:s}),i}function pi(e,t){throw new Error(`Error when parsing text at position ${e.pos}: (around: "${e.around}") ${t}`)}function Z$(e,t){const{pos:n}=t;if(t.current()!=="{")throw new Error("Parser error: Command does not start with {");const o=t.next()==="/";o&&t.next();let s="",r="",i=!1;for(;t.current()===void 0&&pi(t,"Unexpected end of text inside a command"),t.current()!=="}";)i?r+=t.current():t.current().match(/[a-z]/i)?s+=t.current():t.current()==="="?(o&&pi(t,"Closing commands may not contain arguments"),i=!0):pi(t,`Unexpected character '${t.current()}' in command name.`),t.next();return t.next(),o?e.push({type:"commandClose",commandName:s,pos:n}):e.push({type:"command",pos:n,argument:r,commandName:s}),Lr}function Q$(e,t){return e.push({type:"newline",pos:t.pos}),t.next(),Lr}var e0=Object.defineProperty,t0=Object.defineProperties,n0=Object.getOwnPropertyDescriptors,nc=Object.getOwnPropertySymbols,o0=Object.prototype.hasOwnProperty,s0=Object.prototype.propertyIsEnumerable,oc=(e,t,n)=>t in e?e0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tt=(e,t)=>{for(var n in t||(t={}))o0.call(t,n)&&oc(e,n,t[n]);if(nc)for(var n of nc(t))s0.call(t,n)&&oc(e,n,t[n]);return e},nt=(e,t)=>t0(e,n0(t));const sc=new Map([qn("i",e=>nt(tt({},e),{isItalic:!0})),qn("b",e=>nt(tt({},e),{isBold:!0})),qn("u",e=>nt(tt({},e),{isUnderlined:!0})),qn("s",e=>nt(tt({},e),{isStrikethrough:!0})),qn("plain",e=>nt(tt({},e),{isStrikethrough:!1,isUnderlined:!1,isBold:!1,isItalic:!1})),qn("edited",e=>nt(tt({},e),{fontName:"verily",strokeColor:"#000000",strokeWidth:20,letterSpacing:8})),Ds("k",(e,t,n)=>nt(tt({},e),{letterSpacing:t?e.letterSpacing+n:n})),Ds("size",(e,t,n)=>nt(tt({},e),{fontSize:t?e.fontSize+n:n})),Ds("alpha",(e,t,n)=>nt(tt({},e),{alpha:t?e.alpha+n:n})),Ds("stroke",(e,t,n)=>nt(tt({},e),{strokeWidth:t?e.strokeWidth+n:n})),["font",(e,t)=>nt(tt({},e),{fontName:t})],["color",(e,t)=>nt(tt({},e),{color:t})],["outlinecolor",(e,t)=>nt(tt({},e),{strokeColor:t})]]);function qn(e,t){return[e,(n,o)=>{if(o!=="")throw new Error(`Operator '${e}' does not take any arguments.`);return t(n)}]}function Ds(e,t){return[e,(n,o)=>{if(o=="")throw new Error(`Operator '${e}' needs an argument.`);const s=o[0]==="+"||o[0]==="-",r=Number(o);if(isNaN(r))throw new Error(`Operator '${e}' needs a numeric argument.`);return t(n,s,r)}]}var Be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},At={},Cf={};Object.defineProperty(Cf,"__esModule",{value:!0});var dt={};Object.defineProperty(dt,"__esModule",{value:!0});dt.createFactoryWithConstraint=dt.isExact=dt.noop=dt.assert=dt.UnreachableCaseError=void 0;class r0 extends Error{constructor(t){super(`Unreachable case: ${t}`)}}dt.UnreachableCaseError=r0;function i0(e,t="no additional info provided"){if(!e)throw new Error("Assertion Error: "+t)}dt.assert=i0;function l0(...e){}dt.noop=l0;const a0=()=>e=>e;dt.isExact=a0;const d0=()=>e=>e;dt.createFactoryWithConstraint=d0;var Pf={};Object.defineProperty(Pf,"__esModule",{value:!0});(function(e){var t=Be&&Be.__createBinding||(Object.create?function(o,s,r,i){i===void 0&&(i=r);var a=Object.getOwnPropertyDescriptor(s,r);(!a||("get"in a?!s.__esModule:a.writable||a.configurable))&&(a={enumerable:!0,get:function(){return s[r]}}),Object.defineProperty(o,i,a)}:function(o,s,r,i){i===void 0&&(i=r),o[i]=s[r]}),n=Be&&Be.__exportStar||function(o,s){for(var r in o)r!=="default"&&!Object.prototype.hasOwnProperty.call(s,r)&&t(s,o,r)};Object.defineProperty(e,"__esModule",{value:!0}),n(Cf,e),n(dt,e),n(Pf,e)})(At);function bo(e){e.width=0,e.height=0,ya.delete(e.disposalId||0)}function cs(){const e=document.createElement("canvas");return u0(e),e}const ya=new Map;let c0=0;function u0(e){e.disposalId=c0++,typeof WeakRef!="undefined"&&ya.set(e.disposalId,new WeakRef(e))}window.addEventListener("unload",()=>{ya.forEach(e=>{const t=e.deref();!t||bo(t)})});var p0=Object.defineProperty,f0=(e,t,n)=>t in e?p0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fi=(e,t,n)=>(f0(e,typeof t!="symbol"?t+"":t,n),n),h0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class ct{constructor(t,n){this.str=t,this.baseStyle=n,fi(this,"renderParts"),fi(this,"tokens"),fi(this,"loose"),this.loose=q.state.looseTextParsing;try{this.tokens=tc(t,this.loose)}catch(o){if(o instanceof Error)this.tokens=[{type:"text",pos:0,content:o.message}];else throw o}this.rebuildParts()}rebuildParts(){this.renderParts=ct.getRenderParts(this.tokens,this.baseStyle,this.loose)}loadFonts(){return h0(this,null,function*(){if(!("fonts"in document))return;const t=new Set;let n=null;for(const s of this.renderParts)"style"in s&&s.style!==n&&(n=s.style,n.fontName&&t.add(n.fontName));let o=!1;for(const s of t){const r=document,i=`8px ${s}`;r.fonts.check(i)||(o=!0,yield r.fonts.load(i))}if(o){const s=tc(this.str);this.renderParts=ct.getRenderParts(s,this.baseStyle,this.loose)}})}render(t){t.save();let n=null;for(const o of this.renderParts)o.type!=="newline"&&(o.style!==n&&(n=o.style,il(n,t)),n.strokeWidth>0&&n.strokeColor>""&&t.strokeText(o.character,o.x,o.y));for(const o of this.renderParts)o.type!=="newline"&&(o.style!==n&&(n=o.style,il(n,t)),t.fillText(o.character,o.x,o.y));t.restore()}quote(){let t;(r=>{r[r.None=0]="None",r[r.ExplictQuote=1]="ExplictQuote",r[r.ImplictQuote=2]="ImplictQuote",r[r.Star=3]="Star"})(t||(t={}));let n=-1,o=0;for(let r=0;r<this.renderParts.length;++r){const i=this.renderParts[r];if(i.type==="character")switch(o){case 0:if(i.character.match(/\s/))continue;i.character==='"'?(o=1,n=r):i.character==="*"?(o=3,n=r):(this.renderParts.splice(r,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Lo(i.style,'"')}),r++,n=r,o=2);break;case 1:n=r,i.character==='"'&&(o=0);break;case 2:if(i.character.match(/\s/))continue;i.character==="*"&&(this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:i.style,character:'"',height:i.height,width:Lo(i.style,'"')}),o=3,r++),n=r;break;case 3:i.character==="*"&&(o=0),n=r;break;default:throw new At.UnreachableCaseError(o)}}const s=this.renderParts[n];s&&o===3&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:"*",height:s.height,width:Lo(s.style,'"')}),s&&(o===1||o===2)&&this.renderParts.splice(n+1,0,{type:"character",x:0,y:0,style:s.style,character:'"',height:s.height,width:Lo(s.style,'"')})}fixAlignment(t,n,o,s,r){let i=0,a=[];function l(){let v=n;t==="center"?v=n+(o-n)/2-i/2:t==="right"&&(v=o-i);for(const w of a)w.x=v,v+=w.width}let d=this.renderParts;r>0&&(d=ct.applyLineWrapping(this.renderParts.slice(0),r));let c=s;const p=[];let f=0;for(const v of d)f=Math.max(f,v.height),v.type==="newline"&&(p.push(f),f=0);p.push(f);let b=0;for(const v of d)if(f=Math.max(f,v.height),v.y=c,a.push(v),i+=v.width,v.type==="newline")l(),c+=p[++b]||0,i=0,f=0,a=[];else if(v.type==="character"){const w=a[a.length-1];w.type==="character"&&(i+=w.style.letterSpacing,w.width+=w.style.letterSpacing)}l()}getHeight(t){let n=0,o=0;const s=t===0?this.renderParts:ct.applyLineWrapping(this.renderParts.slice(0),t);for(const r of s)n=Math.max(n,r.height),r.type==="newline"&&(o+=n,n=0);return o+=n,o}getWidth(){let t=0,n=0,o=null;for(const s of this.renderParts)t+=s.width,s.type==="newline"?(n=Math.max(n,t),t=0,o=null):s.type==="character"&&(o&&o.type==="character"&&(t+=o.style.letterSpacing),o=s);return n=Math.max(n,t),n}static getRenderParts(t,n,o){const s=[],r=[],i=[];let a=lc(n),l=n,d=null;function c(p){for(const f of p)s.push({type:"character",character:f,height:a,width:Lo(l,f),style:l,x:0,y:0})}for(const p of t){const f=p.type;switch(f){case"command":if(sc.has(p.commandName))r.push(l),i.push(d),l=sc.get(p.commandName)(l,p.argument),a=lc(l),d=p;else if(o)c("{"+p.commandName+"}");else throw new Error(`There is no text command called '${p.commandName}' at position ${p.pos}.`);break;case"commandClose":if(!d)if(o){c("{/"+p.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${p.pos}. Closed '${p.commandName}', but no commands are currently open.`);if(p.commandName!==d.commandName)if(o){c("{/"+p.commandName+"}");break}else throw new Error(`Unmatched closing command at position ${p.pos}. Closed '${p.commandName}', expected to close '${d}' first. (Opened at position ${d.pos})`);d=i.pop(),l=r.pop();break;case"newline":s.push({height:a,width:0,x:0,y:0,type:"newline"});break;case"text":c(p.content);break;default:throw new At.UnreachableCaseError(f)}}return s}static applyLineWrapping(t,n){let o=-1,s=0,r=0;const i=[];for(const a of t)if(a.type==="newline")o=-1,s=0,r=0,i.push(a);else if(a.type==="character")a.character===" "?s>n?(o=-1,s=0,r=0,i.push({type:"newline",height:a.height,width:0,x:0,y:0})):(s+=a.width,r=s,o=i.length,i.push(a)):(s+=a.width,s>n&&o!==-1&&(s-=r,i.splice(o,1,{type:"newline",height:a.height,width:0,x:0,y:0}),o=-1,r=0),i.push(a));else throw new At.UnreachableCaseError(a);return i}}const _a=cs();_a.width=0;_a.height=0;const rc=_a.getContext("2d");let ic=null;function Lo(e,t){return e!==ic&&(il(e,rc),ic=e),rc.measureText(t).width}const hi=new Map;function lc(e){const t=e.fontSize+" "+e.fontName;if(hi.has(t))return hi.get(t)*e.lineSpacing;const n=document.createElement("span");n.innerHTML="Hg",n.style.fontFamily=e.fontName,n.style.fontSize=`${e.fontSize}px`,n.style.lineHeight="1";const o=document.createElement("div");o.style.opacity="0",o.style.fontFamily=e.fontName,o.style.fontSize=`${e.fontSize}px`,o.style.lineHeight="1",o.style.position="absolute",o.style.top="0",o.style.left="0",o.appendChild(n),document.body.appendChild(o);try{const s=o.offsetHeight;return hi.set(t,s),s*e.lineSpacing}finally{o.remove()}}function il(e,t){t.textAlign="left",t.font=(e.isItalic?"italic ":"")+(e.isBold?"bold ":"")+e.fontSize+"px "+e.fontName,t.lineJoin="round",e.strokeWidth>0&&e.strokeColor>""?(t.strokeStyle=e.strokeColor,t.lineWidth=e.strokeWidth):(t.strokeStyle="",t.lineWidth=0),t.globalAlpha=e.alpha||0,t.fillStyle=e.color}class Qn{}var g0=Object.defineProperty,ac=Object.getOwnPropertySymbols,m0=Object.prototype.hasOwnProperty,b0=Object.prototype.propertyIsEnumerable,ll=(e,t,n)=>t in e?g0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uo=(e,t)=>{for(var n in t||(t={}))m0.call(t,n)&&ll(e,n,t[n]);if(ac)for(var n of ac(t))b0.call(t,n)&&ll(e,n,t[n]);return e},v0=(e,t,n)=>(ll(e,typeof t!="symbol"?t+"":t,n),n),y0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class vo{constructor(t,n,o,s){this.canvas=t,this.fsCtx=n,this.hq=o,this.preview=s,v0(this,"aborted",!1)}static make(t,n,o){return new vo(t,t.getContext("2d"),n,o)}static makeWithContext(t,n,o,s){return new vo(t,n,o,s)}drawText(t){if(this.aborted)throw new Qn;this.fsCtx.save();const{font:n,align:o,x:s=0,y:r=0,text:i=""}=Uo(Uo({},{font:"20px aller",align:"left"}),t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width,this.fsCtx.strokeText(i,s,r)),t.fill&&(this.fsCtx.fillStyle=t.fill.style,this.fsCtx.fillText(i,s,r)),this.fsCtx.restore()}measureText(t){if(this.aborted)throw new Qn;this.fsCtx.save();const{font:n,align:o,text:s=""}=Uo(Uo({},{font:"20px aller",align:"left"}),t);this.fsCtx.lineJoin="round",this.fsCtx.textAlign=o,this.fsCtx.font=n,t.outline&&(this.fsCtx.strokeStyle=t.outline.style,this.fsCtx.lineWidth=t.outline.width),t.fill&&(this.fsCtx.fillStyle=t.fill.style);const r=this.fsCtx.measureText(s);return this.fsCtx.restore(),r}drawImage(t){if(this.aborted)throw new Qn;const{image:n,flip:o,x:s,y:r,w:i,h:a,filters:l,composite:d}=Uo({flip:!1,w:t.image.width,h:t.image.height,composite:"source-over"},t);if(this.fsCtx.save(),this.fsCtx.globalCompositeOperation=d,l)if("filter"in this.fsCtx){const c=[];for(const p of l)p.type==="drop-shadow"?c.push(`drop-shadow(${p.offsetX}px ${p.offsetY}px ${p.blurRadius}px ${p.color})`):p.type==="hue-rotate"?c.push(`hue-rotate(${p.value}deg)`):p.type==="blur"?c.push(`blur(${p.value}px)`):c.push(`${p.type}(${p.value*100}%)`);this.fsCtx.filter=c.join(" ")}else{let c=1;for(const p of l)p.type==="opacity"&&(c*=p.value);this.fsCtx.globalAlpha=c}if(t.shadow){const c=t.shadow;c.color!=null&&(this.fsCtx.shadowColor=c.color),c.blur!=null&&(this.fsCtx.shadowBlur=c.blur),c.offsetX!=null&&(this.fsCtx.shadowOffsetX=c.offsetX),c.offsetY!=null&&(this.fsCtx.shadowOffsetY=c.offsetY)}if(t.rotation!=null&&t.rotation!==0){const c=t.rotationAnchor?t.rotationAnchor.x:0,p=t.rotationAnchor?t.rotationAnchor.y:0;t.rotationAnchor&&this.fsCtx.translate(c,p),this.fsCtx.rotate(t.rotation),t.rotationAnchor&&this.fsCtx.translate(-c,-p)}this.fsCtx.translate(s+i/2,r+a/2),this.fsCtx.scale(o?-1:1,1),n.paintOnto(this.fsCtx,{x:-i/2,y:-a/2,w:i,h:a}),this.fsCtx.restore(),this.fsCtx.globalCompositeOperation="source-over"}drawRect({x:t,y:n,w:o,h:s,outline:r,fill:i,composition:a}){if(this.aborted)throw new Qn;this.fsCtx.save(),this.fsCtx.beginPath(),this.fsCtx.rect(t,n,o,s),a&&(this.fsCtx.globalCompositeOperation=a),i&&(this.fsCtx.fillStyle=i.style,this.fsCtx.fill()),r&&(this.fsCtx.strokeStyle=r.style,this.fsCtx.lineWidth=r.width,this.fsCtx.stroke()),this.fsCtx.restore()}drawPath({outline:t,fill:n,path:o}){if(this.aborted)throw new Qn;this.fsCtx.save(),this.fsCtx.beginPath(),o(this.fsCtx),n&&(this.fsCtx.fillStyle=n.style,this.fsCtx.fill()),t&&(this.fsCtx.strokeStyle=t.style,this.fsCtx.lineWidth=t.width,this.fsCtx.stroke()),this.fsCtx.restore()}patternFrom(t,n="repeat"){return t instanceof _s&&(t=t.previewCanvas),this.fsCtx.createPattern(t,n)}customTransform(t,n){return y0(this,null,function*(){this.fsCtx.save(),yield t(this.fsCtx),yield n(this),this.fsCtx.restore()})}linearGradient(t,n,o,s){return this.fsCtx.createLinearGradient(t,n,o,s)}applyFilters(t){if(t.length===0)return;this.fsCtx.save();let n=1;for(const o of t)o.type==="opacity"&&(n*=o.value);if("filter"in this.fsCtx){const o=[];for(const s of t)s.type!=="opacity"&&(s.type==="drop-shadow"?o.push(`drop-shadow(${s.offsetX}px ${s.offsetY}px ${s.blurRadius}px ${s.color})`):s.type==="hue-rotate"?o.push(`hue-rotate(${s.value}deg)`):s.type==="blur"?o.push(`blur(${s.value}px)`):o.push(`${s.type}(${s.value*100}%)`));this.fsCtx.filter=o.join(" ")}this.fsCtx.drawImage(this.canvas,0,0),n!==1&&(this.fsCtx.globalCompositeOperation="destination-atop",this.fsCtx.fillStyle=`rgba(0,0,0,${n})`,this.fsCtx.fillRect(0,0,this.canvas.width,this.canvas.height),this.fsCtx.globalCompositeOperation="source-over"),"filter"in this.fsCtx&&(this.fsCtx.filter="none"),this.fsCtx.restore()}abort(){this.aborted=!0}}var _0=Object.defineProperty,w0=(e,t,n)=>t in e?_0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gi=(e,t,n)=>(w0(e,typeof t!="symbol"?t+"":t,n),n),Rs=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class _s{constructor(t,n){gi(this,"previewCanvas"),gi(this,"runningContext",null),gi(this,"_disposed",!1);const o=Y();this.previewCanvas=cs(),this.previewCanvas.width=t!=null?t:o.Base.screenWidth,this.previewCanvas.height=n!=null?n:o.Base.screenHeight}get disposed(){return this._disposed}render(t,n=!0,o=!0){return Rs(this,null,function*(){this.runningContext&&this.runningContext.abort();const s=this.previewCanvas.getContext("2d");s.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height);const r=this.runningContext=vo.makeWithContext(this.previewCanvas,s,n,o);try{yield t(this.runningContext)}catch(i){if(i instanceof Qn)return!1;throw i}finally{r===this.runningContext&&(this.runningContext=null)}return!0})}get width(){return this.previewCanvas.width}get height(){return this.previewCanvas.height}paintOnto(t,n){n.w!=null&&n.h!=null?t.drawImage(this.previewCanvas,n.x,n.y,n.w,n.h):t.drawImage(this.previewCanvas,n.x,n.y)}download(t,n){return Rs(this,null,function*(){const o=yield this.drawToCanvas(t);return yield q.saveToFile(o,n)})}renderToBlob(t){return Rs(this,null,function*(){const n=yield this.drawToCanvas(t);return yield new Promise((o,s)=>{n.toBlob(r=>{r?o(r):s()})})})}drawToCanvas(t){return Rs(this,null,function*(){const n=cs();n.width=this.previewCanvas.width,n.height=this.previewCanvas.height;const o=n.getContext("2d");return o.clearRect(0,0,this.previewCanvas.width,this.previewCanvas.height),yield t(vo.makeWithContext(n,o,!0,!1)),n})}dispose(){this.runningContext&&this.runningContext.abort(),bo(this.previewCanvas),this._disposed=!0}getDataAt(t,n){return this.previewCanvas.getContext("2d").getImageData(t,n,1,1).data}}function pr(e,t,n,o,s){const r=Math.cos(s),i=Math.sin(s),a=e-n,l=t-o,d=r*a-i*l+n,c=i*a+r*l+o;return[d,c]}var $0=Object.defineProperty,C0=(e,t,n)=>t in e?$0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,In=(e,t,n)=>(C0(e,typeof t!="symbol"?t+"":t,n),n),mi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())}),qo=(e=>(e[e.None=0]="None",e[e.Selected=1]="Selected",e[e.Focused=2]="Focused",e[e.Both=3]="Both",e))(qo||{});class Sf{constructor(t){this.obj=t,In(this,"localRenderer",null),In(this,"lastVersion",null),In(this,"hitDetectionFallback",!1),In(this,"renderable",!1),In(this,"_disposed",!1),In(this,"lastHq",!1),In(this,"ready",Promise.resolve())}get id(){return this.obj.id}get x(){return this.obj.x}get y(){return this.obj.y}get version(){return this.obj.version}get flip(){return this.obj.flip}get rotation(){return this.obj.rotation/180*Math.PI}get composite(){return this.obj.composite}get filters(){return this.obj.filters}get width(){return this.obj.width}get height(){return this.obj.height}get allowSkippingLocalCanvas(){return!0}updateLocalCanvas(t,n){return mi(this,null,function*(){if(this._disposed)throw new Error("Disposed renderable called");yield this.ready;const o=this.canvasWidth,s=this.canvasHeight;if(s===0&&o===0){this.renderable=!1;return}if(this.renderable=!0,this.lastHq=t,!n){this.localRenderer&&!this.localRenderer.disposed&&this.localRenderer.height===s&&this.localRenderer.width===o||(this.localRenderer&&this.localRenderer.dispose(),this.localRenderer=new _s(o,s));try{yield this.localRenderer.render(this.renderLocal.bind(this),t)}catch(r){throw this.localRenderer.dispose(),this.localRenderer=null,r}}})}needsRedraw(){return this.localRenderer===null||this.lastVersion!==this.version}getRenderRotation(){return[this.flip?-this.rotation:this.rotation,{x:this.x,y:this.y+this.height/2}]}render(t,n,o){return mi(this,null,function*(){if(this._disposed)throw new Error("Disposed renderable called");if(this.canSkipLocal()||(o=!1),(t!==0||this.localRenderer)&&(o=!1),(this.lastHq!==n.hq||this.needsRedraw())&&(yield this.updateLocalCanvas(n.hq,o)),this.lastVersion=this.version,!this.renderable)return;const[r,i]=this.getRenderRotation();let a;switch(t){case 0:a=void 0;break;case 1:a={blur:20,color:"red"};break;case 2:a={blur:20,color:"blue"};break;case 3:a={blur:20,color:"purple"};break}o?yield n.customTransform(l=>mi(this,null,function*(){l.translate(this.canvasDrawPosX,this.canvasDrawPosY)}),this.renderLocal.bind(this)):n.drawImage({image:this.localRenderer,x:this.canvasDrawPosX,y:this.canvasDrawPosY,w:this.canvasDrawWidth,h:this.canvasDrawHeight,rotation:r,rotationAnchor:i,flip:this.flip,shadow:t&&n.preview?a:void 0,composite:this.composite,filters:this.filters})})}canSkipLocal(){return this.allowSkippingLocalCanvas&&this.obj.filters.length===0&&!this.obj.flip}hitTest(t,n){if(!this.localRenderer)return!1;const o=this.getHitbox(),s=o.x0+(o.x1-o.x0)/2,r=o.y0+(o.y1-o.y0)/2,[i,a]=pr(t,n,s,r,this.flip?this.rotation:-this.rotation);if(!(i>=o.x0&&i<=o.x1&&a>=o.y0&&a<=o.y1))return!1;if(this.hitDetectionFallback)return!0;try{return this.pixelPerfectHitTest(t,n)}catch(d){this.hitDetectionFallback=!0}return!0}pixelPerfectHitTest(t,n){if(!this.localRenderer)return!1;const[o,s]=this.getRenderRotation(),[r,i]=s?pr(t,n,s.x,s.y,-o):[t,n],a=Math.round(r-this.canvasDrawPosX),l=Math.round(i-this.canvasDrawPosY),d=this.canvasDrawWidth,c=this.canvasDrawHeight;if(a>=0&&a<=d&&l>=0&&l<=c){const p=this.flip?this.canvasDrawWidth-a:a,f=this.canvasWidth/this.canvasDrawWidth,b=this.canvasHeight/this.canvasDrawHeight;return this.localRenderer.getDataAt(Math.round(p*f),Math.round(l*b))[3]!==0}return!1}getHitbox(){return{x0:this.x-this.width/2,x1:this.x+this.width/2,y0:this.y,y1:this.y+this.height}}updatedContent(t,n){}get disposed(){return this._disposed}dispose(){var t;this._disposed=!0,(t=this.localRenderer)==null||t.dispose(),this.localRenderer=null}}var P0=Object.defineProperty,S0=Object.getPrototypeOf,k0=Reflect.get,O0=(e,t,n)=>t in e?P0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,it=(e,t,n)=>(O0(e,typeof t!="symbol"?t+"":t,n),n),x0=(e,t,n)=>k0(S0(e),n,t),bi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class To extends Sf{constructor(t){super(t),it(this,"lastWidth",-1),it(this,"lastHeight",-1),it(this,"lastX",-1),it(this,"lastY",-1),it(this,"lastFlip",null),it(this,"lastRotation",null),it(this,"canvasHeight"),it(this,"canvasWidth"),it(this,"canvasDrawHeight"),it(this,"canvasDrawWidth"),it(this,"canvasDrawPosX",0),it(this,"canvasDrawPosY",0);const n=Y().Base;this.canvasHeight=n.screenHeight,this.canvasWidth=n.screenWidth,this.canvasDrawHeight=n.screenHeight,this.canvasDrawWidth=n.screenWidth}getRenderRotation(){return[0,void 0]}needsRedraw(){return super.needsRedraw()?!0:this.width!==this.lastWidth||this.height!==this.lastHeight||this.rotation!==this.lastRotation||this.x!==this.lastX||this.y!==this.lastY||this.flip!==this.lastFlip}updateLocalCanvas(t,n){return bi(this,null,function*(){this.lastWidth=this.width,this.lastHeight=this.height,this.lastX=this.x,this.lastY=this.y,this.lastFlip=this.flip,this.lastRotation=this.rotation,yield x0(To.prototype,this,"updateLocalCanvas").call(this,t,n)})}renderLocal(t){return bi(this,null,function*(){const n=Y().Base;if(this.rotation===0)return yield this.draw(t);yield t.customTransform(o=>bi(this,null,function*(){const s=this.getHitbox(),r=s.x0+(s.x1-s.x0)/2,i=s.y0+(s.y1-s.y0)/2,a=this.flip?n.screenWidth-r:r;o.translate(a,i),o.rotate(this.rotation),o.translate(-a,-i)}),this.draw.bind(this))})}getHitbox(){const t=this.centeredVertically,n=this.width/2,o=this.height/2;return{x0:this.x-n,x1:this.x+n,y0:t?this.y-o:this.y,y1:t?this.y+o:this.y+this.height}}get centeredVertically(){return!1}}var j0=Object.defineProperty,dc=Object.getOwnPropertySymbols,I0=Object.prototype.hasOwnProperty,T0=Object.prototype.propertyIsEnumerable,cc=(e,t,n)=>t in e?j0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vi=(e,t)=>{for(var n in t||(t={}))I0.call(t,n)&&cc(e,n,t[n]);if(dc)for(var n of dc(t))T0.call(t,n)&&cc(e,n,t[n]);return e};class wa{constructor(t){this.base=t}static get resizable(){return!1}static get defaultWidth(){return Oo}static get defaultHeight(){return Dr}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-Et-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return da}getControlsDisabledStyle(){return Up}get textboxStyle(){return ca}renderControls(t,n){const o=Y(),s=this.width,r=s/2,l=(this.base.obj.flip?o.Base.screenWidth-this.base.obj.x:this.base.obj.x)-r+s/2,d=this.getControlsStyle();t.drawText(vi({text:"History",x:l+oa,y:n},d)),t.drawText(vi({text:"Skip",x:l+sa,y:n},this.base.obj.skip?d:this.getControlsDisabledStyle())),t.drawText(vi({text:"Auto   Save   Load   Settings",x:l+ra,y:n},d))}}var E0=Object.defineProperty,B0=(e,t,n)=>t in e?E0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yo=(e,t,n)=>(B0(e,typeof t!="symbol"?t+"":t,n),n),yi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Eo extends wa{constructor(){super(...arguments),yo(this,"backgroundImage","textbox"),yo(this,"xOffset",0)}get height(){return Dr+Et}get width(){return Oo}get nameboxWidth(){return ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return Mr}get textOffsetX(){return gs}get textOffsetY(){return Rr}renderNamebox(t,n,o){return yi(this,null,function*(){t.drawImage({image:yield co("namebox"),x:n,y:o})})}renderBackdrop(t,n,o){return yi(this,null,function*(){n+=this.xOffset;const s=yield co(this.backgroundImage);t.drawImage({image:s,x:n,y:o})})}render(t){return yi(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;yield this.renderBackdrop(t,a,l+this.nameboxHeight),this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l));const d=l+s,c=d-na;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next"),x:a+o-ia,y:d-la})})}}yo(Eo,"id","normal");yo(Eo,"label","Normal");yo(Eo,"priority",0);yo(Eo,"gameMode","ddlc");var A0=Object.defineProperty,D0=(e,t,n)=>t in e?A0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,_o=(e,t,n)=>(D0(e,typeof t!="symbol"?t+"":t,n),n);class ws extends Eo{constructor(){super(...arguments),_o(this,"backgroundImage","textbox_monika"),_o(this,"xOffset",(Oo-ta)/2)}}_o(ws,"id","corrupt");_o(ws,"label","Corrupted");_o(ws,"priority",1);_o(ws,"gameMode","ddlc");function fr(e,t,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+s,r),e.arcTo(t+o,n+s,t,n+s,r),e.arcTo(t,n+s,t,n,r),e.arcTo(t,n,t+o,n,r),e.closePath()}function kf(e,t,n,o,s,r){o<0&&(o=0),s<0&&(s=0),o<2*r&&(r=o/2),s<2*r&&(r=s/2),e.moveTo(t+r,n),e.arcTo(t+o,n,t+o,n+s,r),e.lineTo(t+o,n+s),e.lineTo(t,n+s),e.arcTo(t,n,t+o,n,r),e.closePath()}var R0=Object.defineProperty,H0=Object.defineProperties,M0=Object.getOwnPropertyDescriptors,uc=Object.getOwnPropertySymbols,F0=Object.prototype.hasOwnProperty,N0=Object.prototype.propertyIsEnumerable,al=(e,t,n)=>t in e?R0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,L0=(e,t)=>{for(var n in t||(t={}))F0.call(t,n)&&al(e,n,t[n]);if(uc)for(var n of uc(t))N0.call(t,n)&&al(e,n,t[n]);return e},U0=(e,t)=>H0(e,M0(t)),wo=(e,t,n)=>(al(e,typeof t!="symbol"?t+"":t,n),n),kt=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class $s extends wa{constructor(){super(...arguments),wo(this,"backgroundImage","textbox"),wo(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+Et}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return U0(L0({},Mr),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return gs}get textOffsetY(){return Rr}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const t=this.refObject;return t!=null&&t.textboxColor!=null?t.textboxColor:Ip}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Tp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Ep).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(t,n,o){return kt(this,null,function*(){const s=this.nameboxWidth,r=this.nameboxHeight;yield t.customTransform(i=>kt(this,null,function*(){i.beginPath(),kf(i,n,o,s,r,Dp),i.clip()}),i=>kt(this,null,function*(){const a=i.linearGradient(n,o,n,o+r),l=ae.fromCss(this.nameboxBackgroundColor),d=new ae(l.r,l.g,l.b,.95),c=d.toHSL().shift(Ap).toRgb();a.addColorStop(0,d.toCss()),a.addColorStop(Bp,d.toCss()),a.addColorStop(1,c.toCss()),i.drawRect({x:n,y:o,w:this.obj.width,h:r,fill:{style:a}})}))})}renderBackdrop(t,n,o){return kt(this,null,function*(){const s=ae.fromCss(this.customColor).toHSL(),r=new _s(Vt,Vt);yield r.render(a=>kt(this,null,function*(){const l={style:s.shift(Rp).toRgb().toCss()};function d(c,p){a.drawPath({path:f=>{f.ellipse(c,p,el,el,0,0,2*Math.PI)},fill:l})}d(0,0),d(Vt,0),d(0,Vt),d(Vt,Vt),d(Vt/2,Vt/2)}),!0),yield t.customTransform(a=>kt(this,null,function*(){a.beginPath(),fr(a,n+Ut,o+Ut,this.width-Ut*2,this.height-Et-Ut*2,Qi),a.clip()}),a=>kt(this,null,function*(){const l=this.obj.height,d=this.obj.width,c=a.linearGradient(n,o,n,o+l),p=ae.fromHex(this.customColor);c.addColorStop(0,p.toCss()),c.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),a.drawRect({x:n,y:o,w:d,h:l,fill:{style:c},outline:{style:"#ffdfee",width:6}}),yield a.customTransform(b=>kt(this,null,function*(){b.translate(n,o)}),b=>kt(this,null,function*(){const v=a.patternFrom(r);a.drawRect({x:0,y:0,w:d,h:l,fill:{style:v},composition:"source-atop"})}));const f=a.linearGradient(n,o+l-tl,n,o+l);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),a.drawPath({path:b=>{b.ellipse(n+d/2,o+l,Lp,tl,0,0,2*Math.PI)},fill:{style:f}})}));const i=s.shift(Hp).toRgb().toCss();t.drawPath({path:a=>{fr(a,n+Ut,o+Ut,this.width-Ut*2,this.height-Et-Ut*2,Qi)},outline:{style:i,width:Mp}}),r.dispose()})}render(t){return kt(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l)),yield this.renderBackdrop(t,a,l+this.nameboxHeight);const d=l+s,c=d-na;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next"),x:a+o-ia,y:d-la})})}}wo($s,"id","custom");wo($s,"label","Custom");wo($s,"priority",0);wo($s,"gameMode","ddlc");var V0=Object.defineProperty,W0=(e,t,n)=>t in e?V0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vr=(e,t,n)=>(W0(e,typeof t!="symbol"?t+"":t,n),n),z0=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Cs extends wa{get height(){return Dr+Et}get width(){return Oo}get nameboxWidth(){return ms}get nameboxHeight(){return Et}get nameboxOffsetX(){return bs}get nameboxOffsetY(){return Hr}get nameboxStyle(){return Mr}get textOffsetX(){return gs}get textOffsetY(){return Rr}get textboxStyle(){return ca}render(t){return z0(this,null,function*(){})}}Vr(Cs,"id","none");Vr(Cs,"label","None");Vr(Cs,"priority",0);Vr(Cs,"gameMode","ddlc");var G0=Object.defineProperty,pc=Object.getOwnPropertySymbols,q0=Object.prototype.hasOwnProperty,X0=Object.prototype.propertyIsEnumerable,dl=(e,t,n)=>t in e?G0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,fc=(e,t)=>{for(var n in t||(t={}))q0.call(t,n)&&dl(e,n,t[n]);if(pc)for(var n of pc(t))X0.call(t,n)&&dl(e,n,t[n]);return e},K0=(e,t,n)=>(dl(e,typeof t!="symbol"?t+"":t,n),n);const Of=class{constructor(e){this.base=e}static get resizable(){return!1}static get defaultWidth(){return fa}static get defaultHeight(){return lf}static get defaultX(){return Y().Base.screenWidth/2}static get defaultY(){return Y().Base.screenHeight-this.defaultHeight-to-Y().TextBox.TextBoxBottomSpacing}get obj(){return this.base.obj}get refObject(){return this.base.refObject}getControlsStyle(){return ar}getControlsDisabledStyle(){return vf}renderControls(e,t){const n=Y(),o=this.width,s=o/2,i=(this.base.obj.flip?n.Base.screenWidth-this.base.obj.x:this.base.obj.x)-s,a=this.getControlsStyle(),l=["History","Skip","Auto","Save","Load","Settings"],d=[];let c=0;for(const b of l){const v=Of.controlWidth(e,b);d.push(v),c+=v}const p=Math.min((o-c)/(l.length+2),78);let f=i+(o-c-p*(l.length-1))/2;for(let b=0;b<l.length;++b){const v=l[b],w=d[b],H=v==="Skip"&&!this.base.obj.skip?this.getControlsDisabledStyle():a;e.drawText(fc({text:v,x:f,y:t},H)),f+=w+p}}static controlWidth(e,t){if(this.widthCache[t])return this.widthCache[t];const n=e.measureText(fc({text:t},ar)).width;return this.widthCache[t]=n,n}};let xf=Of;K0(xf,"widthCache",{});var Y0=Object.defineProperty,J0=Object.defineProperties,Z0=Object.getOwnPropertyDescriptors,hc=Object.getOwnPropertySymbols,Q0=Object.prototype.hasOwnProperty,eC=Object.prototype.propertyIsEnumerable,cl=(e,t,n)=>t in e?Y0(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tC=(e,t)=>{for(var n in t||(t={}))Q0.call(t,n)&&cl(e,n,t[n]);if(hc)for(var n of hc(t))eC.call(t,n)&&cl(e,n,t[n]);return e},nC=(e,t)=>J0(e,Z0(t)),$o=(e,t,n)=>(cl(e,typeof t!="symbol"?t+"":t,n),n),Ot=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Ps extends xf{constructor(){super(...arguments),$o(this,"backgroundImage","textbox"),$o(this,"xOffset",0)}static get resizable(){return!0}get height(){return this.obj.height+to}get width(){return this.obj.width}get nameboxWidth(){return this.refObject&&this.refObject.nameboxWidth!==null?this.refObject.nameboxWidth:this.obj.customNameboxWidth!==null?this.obj.customNameboxWidth:ga}get nameboxHeight(){return to}get nameboxOffsetX(){return ma}get nameboxOffsetY(){return df}get nameboxStyle(){return nC(tC({},bf),{strokeColor:this.nameboxOutlineColor,color:"#FFFFFF"})}get textOffsetX(){return ha}get textOffsetY(){return af}get textboxStyle(){return yf}get customColor(){if(this.obj.overrideColor)return this.obj.customColor;const t=this.refObject;return t!=null&&t.textboxColor!=null?t.textboxColor:Xp}get nameboxOutlineColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Kp).toRgb().toCss():this.obj.customNameboxStroke}get nameboxBackgroundColor(){return this.obj.deriveCustomColors?ae.fromCss(this.customColor).toHSL().shift(Yp).toRgb().toCss():this.obj.customNameboxColor}renderNamebox(t,n,o){return Ot(this,null,function*(){const s=this.nameboxWidth,r=this.nameboxHeight;yield t.customTransform(i=>Ot(this,null,function*(){i.beginPath(),kf(i,n,o,s,r,Qp),i.clip()}),i=>Ot(this,null,function*(){const a=i.linearGradient(n,o,n,o+r),l=ae.fromCss(this.nameboxBackgroundColor),d=new ae(l.r,l.g,l.b,.95),c=d.toHSL().shift(Zp).toRgb();a.addColorStop(0,d.toCss()),a.addColorStop(Jp,d.toCss()),a.addColorStop(1,c.toCss()),i.drawRect({x:n,y:o,w:this.obj.width,h:r,fill:{style:a}})}))})}renderBackdrop(t,n,o){return Ot(this,null,function*(){const s=ae.fromCss(this.customColor).toHSL(),r=new _s(zt,zt);yield r.render(a=>Ot(this,null,function*(){const l={style:s.shift(ef).toRgb().toCss()};function d(c,p){a.drawPath({path:f=>{f.ellipse(c,p,ol,ol,0,0,2*Math.PI)},fill:l})}d(0,0),d(zt,0),d(0,zt),d(zt,zt),d(zt/2,zt/2)}),!0),yield t.customTransform(a=>Ot(this,null,function*(){a.beginPath(),fr(a,n+Wt,o+Wt,this.width-Wt*2,this.height-to-Wt*2,nl),a.clip()}),a=>Ot(this,null,function*(){const l=this.obj.height,d=this.obj.width,c=a.linearGradient(n,o,n,o+l),p=ae.fromHex(this.customColor);c.addColorStop(0,p.toCss()),c.addColorStop(1,`rgba(${p.r},${p.g},${p.b},0.6667)`),a.drawRect({x:n,y:o,w:d,h:l,fill:{style:c},outline:{style:"#ffdfee",width:6}}),yield a.customTransform(b=>Ot(this,null,function*(){b.translate(n,o)}),b=>Ot(this,null,function*(){const v=a.patternFrom(r);a.drawRect({x:0,y:0,w:d,h:l,fill:{style:v},composition:"source-atop"})}));const f=a.linearGradient(n,o+l-sl,n,o+l);f.addColorStop(0,"rgba(255,255,255,0.3137)"),f.addColorStop(.5,"rgba(255,255,255,0.0627)"),f.addColorStop(1,"rgba(255,255,255,0)"),a.drawPath({path:b=>{b.ellipse(n+d/2,o+l,mf,sl,0,0,2*Math.PI)},fill:{style:f}})}));const i=s.shift(tf).toRgb().toCss();t.drawPath({path:a=>{fr(a,n+Wt,o+Wt,this.width-Wt*2,this.height-to-Wt*2,nl)},outline:{style:i,width:nf}}),r.dispose()})}render(t){return Ot(this,null,function*(){const n=Y(),o=this.width,s=this.height,r=o/2,a=(this.obj.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r,l=this.obj.y;this.obj.talkingObjId!==null&&(yield this.renderNamebox(t,a+this.nameboxOffsetX,l)),yield this.renderBackdrop(t,a,l+this.nameboxHeight);const d=l+s,c=d-cf;this.obj.controls&&this.renderControls(t,c),this.obj.continue&&t.drawImage({image:yield co("next_plus"),x:a+o-hf,y:d-gf})})}}$o(Ps,"id","custom_plus");$o(Ps,"label","Custom (Plus)");$o(Ps,"priority",0);$o(Ps,"gameMode","ddlc_plus");var oC=Object.defineProperty,sC=(e,t,n)=>t in e?oC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,gc=(e,t,n)=>(sC(e,typeof t!="symbol"?t+"":t,n),n),_i=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const rC=[Eo,ws,$s,Cs,Ps],Jo=(()=>{const e={};for(const t of rC)e[t.id]=t;return e})();class iC extends To{constructor(){super(...arguments),gc(this,"refObject",null),gc(this,"_lastRenderer",null)}get y(){return this.obj.y}get width(){return this.textboxRenderer.width}get height(){return this.textboxRenderer.height}get textboxRenderer(){const t=this.forcedStyle,n=Jo[t];if(this._lastRenderer&&this._lastRenderer.constructor===n)return this._lastRenderer;const o=new n(this);return this._lastRenderer=o,o}get forcedStyle(){const t=this.refObject;return(this.obj.style==="normal"||this.obj.style==="normal_plus")&&t&&(t.textboxColor!=null||t.nameboxWidth!=null)?"custom":this.obj.style}updatedContent(t,n){super.updatedContent(t,n);const o=this.obj.talkingObjId;if(o!==null&&o!=="$other$"){const s=t.state.panels.panels[n].objects[o];this.refObject=s!=null?s:null;return}this.refObject=null}draw(t){return _i(this,null,function*(){var n,o;const s=Y(),r=this.textboxRenderer,i=r.width,a=i/2,d=(this.flip?s.Base.screenWidth-this.obj.x:this.obj.x)-a,c=this.obj.y;if(yield r.render(t),this.obj.talkingObjId!==null){const p=this.obj.talkingObjId==="$other$"?this.obj.talkingOther:(o=(n=this.refObject)==null?void 0:n.label)!=null?o:"Missing name";yield this.renderName(t,d+r.nameboxOffsetX,c,p)}yield this.renderText(t,d,c,this.obj.autoWrap?i:0)})}renderName(t,n,o,s){return _i(this,null,function*(){const r=this.textboxRenderer,i=r.nameboxWidth,a=r.nameboxStyle,l=new ct(s,a);yield l.loadFonts(),l.fixAlignment("center",n,n+i,o+r.nameboxOffsetY,0),l.render(t.fsCtx)})}renderText(t,n,o,s){return _i(this,null,function*(){const r=this.textboxRenderer,i=new ct(this.obj.text,r.textboxStyle);this.obj.autoQuoting&&this.obj.talkingObjId!==null&&i.quote(),yield i.loadFonts(),i.fixAlignment("left",n+r.textOffsetX,0,o+r.nameboxHeight+r.textOffsetY,s-r.textOffsetX*2),i.render(t.fsCtx)})}}const lC=ee({components:{Toggle:Rt,DFieldset:Ht},props:{obj:{required:!0}},computed:{freeMove:{get(){return this.obj.freeMove},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setFreeMove",{id:this.obj.id,panelId:this.obj.panelId,freeMove:e})})}},preserveRatio:{get(){return this.obj.preserveRatio},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPreserveRatio",{id:this.obj.id,panelId:this.obj.panelId,preserveRatio:e})})}},pos:{get(){return ur(this.obj.x)},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:Y().Base.characterPositions[e],y:this.obj.y})})}},x:{get(){return this.obj.x},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:e,y:this.y})})}},y:{get(){return this.obj.y},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPosition",{id:this.obj.id,panelId:this.obj.panelId,x:this.x,y:e})})}},height:{get(){return this.obj.height},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setHeight",{id:this.obj.id,panelId:this.obj.panelId,height:e})})}},width:{get(){return this.obj.width},set(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setWidth",{id:this.obj.id,panelId:this.obj.panelId,width:e})})}},allowSize(){const e=this.obj;return e.type==="textBox"?Jo[e.style].resizable:!(e.type==="character"&&!e.freeMove)},allowStepMove(){return"freeMove"in this.obj},positionNames(){return Y().Base.positions},isFirstPos(){return this.pos===0},isLastPos(){return this.pos===Y().Base.positions.length-1}}});const Wr=e=>(ze("data-v-ffa7a993"),e=e(),Ge(),e),aC={colspan:"2"},dC={key:0},cC={colspan:"2"},uC={class:"arrow-col"},pC=["disabled"],fC=["value"],hC={class:"arrow-col"},gC=["disabled"],mC=Wr(()=>u("td",null,[u("label",{for:"sprite_x"},"X:")],-1)),bC=Wr(()=>u("td",null,[u("label",{for:"sprite_y"},"Y:")],-1)),vC=Wr(()=>u("td",null,[u("label",{for:"sprite_w"},"Width:")],-1)),yC=Wr(()=>u("td",null,[u("label",{for:"sprite_h"},"Height:")],-1)),_C={colspan:"2"};function wC(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{title:"Position"+(e.allowSize?"/Size":"")},{default:B(()=>[u("table",null,[u("tr",null,[u("td",aC,[e.allowStepMove?(g(),L(i,{key:0,modelValue:e.freeMove,"onUpdate:modelValue":t[0]||(t[0]=l=>e.freeMove=l),label:"Move freely?"},null,8,["modelValue"])):X("",!0)])]),e.allowStepMove&&!e.freeMove?(g(),y("tr",dC,[u("td",cC,[u("table",null,[u("tr",null,[u("td",uC,[u("button",{onClick:t[1]||(t[1]=l=>--e.pos),disabled:e.isFirstPos},"<",8,pC)]),u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=l=>e.pos=l)},[(g(!0),y(U,null,Ce(e.positionNames,(l,d)=>(g(),y("option",{key:d,value:d},fe(l),9,fC))),128))],512),[[_t,e.pos,void 0,{number:!0}]])]),u("td",hC,[u("button",{onClick:t[3]||(t[3]=l=>++e.pos),disabled:e.isLastPos},">",8,gC)])])])])])):(g(),y(U,{key:1},[u("tr",null,[mC,u("td",null,[de(u("input",{id:"sprite_x",type:"number","onUpdate:modelValue":t[4]||(t[4]=l=>e.x=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},null,544),[[Ee,e.x,void 0,{number:!0}]])])]),u("tr",null,[bC,u("td",null,[de(u("input",{id:"sprite_y",type:"number","onUpdate:modelValue":t[6]||(t[6]=l=>e.y=l),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},null,544),[[Ee,e.y,void 0,{number:!0}]])])])],64)),e.allowSize?(g(),y(U,{key:2},[u("tr",null,[vC,u("td",null,[de(u("input",{id:"sprite_w",min:"0",type:"number","onUpdate:modelValue":t[8]||(t[8]=l=>e.width=l),onKeydown:t[9]||(t[9]=G(()=>{},["stop"]))},null,544),[[Ee,e.width,void 0,{number:!0}]])])]),u("tr",null,[yC,u("td",null,[de(u("input",{id:"sprite_h",min:"0",type:"number","onUpdate:modelValue":t[10]||(t[10]=l=>e.height=l),onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Ee,e.height,void 0,{number:!0}]])])]),u("tr",null,[u("td",_C,[C(i,{modelValue:e.preserveRatio,"onUpdate:modelValue":t[12]||(t[12]=l=>e.preserveRatio=l),label:"Lock ratio?"},null,8,["modelValue"])])])],64)):X("",!0)])]),_:1},8,["title"])}const $C=ne(lC,[["render",wC],["__scopeId","data-v-ffa7a993"]]),CC=ee({components:{Toggle:Rt,DFieldset:Ht},props:{object:{required:!0}},computed:{onTop:ys()("onTop","panels/setOnTop",!0)},methods:{shiftLayer(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/shiftLayer",{id:this.object.id,panelId:this.object.panelId,delta:e})})}}});const zr=e=>(ze("data-v-585e22f7"),e=e(),Ge(),e),PC=zr(()=>u("i",{class:"material-icons"},"vertical_align_bottom",-1)),SC=[PC],kC=zr(()=>u("i",{class:"material-icons"},"arrow_downward",-1)),OC=[kC],xC=zr(()=>u("i",{class:"material-icons"},"arrow_upward",-1)),jC=[xC],IC=zr(()=>u("i",{class:"material-icons"},"vertical_align_top",-1)),TC=[IC];function EC(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{id:"layerfs",title:"Layer:"},{default:B(()=>[u("table",null,[u("tbody",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[0]||(t[0]=l=>e.shiftLayer(-1/0)),title:"Move to back"},SC)]),u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.shiftLayer(-1)),title:"Move backwards"},OC)]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.shiftLayer(1)),title:"Move forwards"},jC)]),u("td",null,[u("button",{onClick:t[3]||(t[3]=l=>e.shiftLayer(1/0)),title:"Move to front"},TC)])])])]),C(i,{modelValue:e.onTop,"onUpdate:modelValue":t[4]||(t[4]=l=>e.onTop=l),label:"In front?"},null,8,["modelValue"])]),_:1})}const BC=ne(CC,[["render",EC],["__scopeId","data-v-585e22f7"]]),AC=ee({props:{obj:{required:!0}},methods:{onClick(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/removeObject",{panelId:this.obj.panelId,id:this.obj.id})})}}});function DC(e,t,n,o,s,r){return g(),y("button",{onClick:t[0]||(t[0]=(...i)=>e.onClick&&e.onClick(...i))},"Delete")}const RC=ne(AC,[["render",DC]]),Hs=255,wi=8,HC=ee({props:{label:{type:String,required:!0},gradientStops:{required:!0},modelValue:{type:Number,required:!0},maxValue:{type:Number,required:!0},shiftGradient:{type:Boolean,default:!1},noInput:{type:Boolean,default:!1}},data:()=>({slideActive:!1}),computed:{vertical(){return this.$store.state.ui.vertical},pointerPath(){const e=this.modelValue/this.maxValue*Hs;return`M${e} 0L${e+14} 0L${e+7} 12Z`},gradientOffset(){return!this.shiftGradient||this.modelValue===0?0:this.modelValue/this.maxValue}},methods:{enterSlide(e){this.slideActive=!0,this.moveSlide(e)},moveSlide(e){if(!this.slideActive)return;const t=this.$refs.svg;if(!t.contains(e.target)&&e.target!==t)return;if(e instanceof MouseEvent&&e.which!==1){this.slideActive=!1;return}const n=t.getBoundingClientRect(),o=n.width/(wi+Hs+wi),r=((e instanceof MouseEvent?e.clientX:e.touches[0].clientX)-n.x)/o;e.preventDefault();const i=Math.max(Math.min(r-wi,Hs),0)/Hs*this.maxValue;this.$emit("update:modelValue",i)},exitSlide(){this.slideActive=!1}}});const MC=["for"],FC=["id","x1","x2"],NC=["offset"],LC=["fill"],UC=["d"],VC=["id","max","value"];function WC(e,t,n,o,s,r){return g(),y("div",{class:pe({slider:!0,vertical:e.vertical}),onKeydown:t[8]||(t[8]=G(()=>{},["stop"]))},[e.noInput?X("",!0):(g(),y("label",{key:0,for:e._.uid},fe(e.label),9,MC)),u("div",null,[(g(),y("svg",{ref:"svg",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 271 24",onMousedown:t[0]||(t[0]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.enterSlide&&e.enterSlide(...i)),onMousemove:t[2]||(t[2]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.moveSlide&&e.moveSlide(...i)),onMouseup:t[4]||(t[4]=(...i)=>e.exitSlide&&e.exitSlide(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.exitSlide&&e.exitSlide(...i))},[u("defs",null,[u("linearGradient",{id:`gradient${e._.uid}`,x1:e.gradientOffset*100+"%",y1:"0%",x2:(e.gradientOffset+1)*100+"%",y2:"0%",spreadMethod:"repeat"},[(g(!0),y(U,null,Ce(e.gradientStops,(i,a)=>(g(),y("stop",{key:a,offset:a/(e.gradientStops.length-1)*100+"%",style:Re("stop-color:"+i)},null,12,NC))),128))],8,FC)]),u("g",null,[u("path",{d:"M7 0H262V24H7z","stroke-width":"2","paint-order":"fill stroke markers",fill:`url(#gradient${e._.uid})`},null,8,LC),u("path",{d:e.pointerPath,"stroke-width":"2",class:"slider-pointer"},null,8,UC)])],544))]),e.noInput?X("",!0):(g(),y("input",{key:1,id:e._.uid,class:"sliderInput",min:"0",max:e.maxValue,value:e.modelValue,type:"number",onInput:t[6]||(t[6]=i=>e.$emit("update:modelValue",parseFloat(i.target.value))),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},null,40,VC))],34)}const jf=ne(HC,[["render",WC],["__scopeId","data-v-256246ea"]]),zC=ee({components:{Slider:jf},props:{modelValue:{type:String,validator:e=>!!e.match(/^#[0-9a-f]{6,8}$/i)},mode:{type:String},relative:Boolean},data:()=>({lastRGBEmit:null,v1:0,v2:0,v3:0,a:0}),computed:{vertical(){return this.$store.state.ui.vertical},maxValue1(){return this.mode==="rgba"?255:360},label1(){return this.mode==="rgba"?"Red":"Hue"},stops1(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v2:0,n=this.relative?this.v3:0;e=[new ae(0,t,n,1),new ae(255,t,n,1)]}else{const t=this.relative?this.v2/100:1,n=this.relative?this.v3/100:.5;e=this.eightsStops(o=>new me(o,t,n,1))}return e.map(t=>t.toRgb().toCss())},maxValue2(){return this.mode==="rgba"?255:100},label2(){return this.mode==="rgba"?"Green":"Saturation"},stops2(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,n=this.relative?this.v3:0;e=[new ae(t,0,n,1),new ae(t,255,n,1)]}else{const t=this.relative?this.v1/360:0,n=this.relative?this.v3/100:.5;e=this.eightsStops(o=>new me(t,o,n,1))}return e.map(t=>t.toRgb().toCss())},maxValue3(){return this.mode==="rgba"?255:100},label3(){return this.mode==="rgba"?"Blue":"Luminosity"},stops3(){let e=[];if(this.mode==="rgba"){const t=this.relative?this.v1:0,n=this.relative?this.v2:0;e=[new ae(t,n,0,1),new ae(t,n,255,1)]}else{const t=this.relative?this.v1/360:0,n=this.relative?this.v2/100:.5;e=this.eightsStops(o=>new me(t,n,o,1))}return e.map(t=>t.toRgb().toCss())},stopsAlpha(){const e=ae.fromHex(this.modelValue);return[new ae(e.r,e.g,e.b,0).toCss(),new ae(e.r,e.g,e.b,1).toCss()]}},created(){this.initValues()},methods:{valueChanged(){this.modelValue!==this.lastRGBEmit&&this.initValues()},updateValue(){let e;this.mode==="rgba"?e=new ae(this.v1,this.v2,this.v3,this.a/255):e=new me(this.v1/360,this.v2/100,this.v3/100,this.a/255);const t=e.toRgb().toHex();if(this.lastRGBEmit!==t){if(t.length!==9)throw new Error(`Invalid color code: ${t}`);this.lastRGBEmit=t,this.$emit("update:modelValue",t)}},initValues(){const e=ae.fromHex(this.modelValue);if(this.lastRGBEmit=e.toHex(),this.a=e.a*255,this.mode==="hsla"){const t=e.toHSL();this.v1=t.h*360,this.v2=t.s*100,this.v3=t.l*100}else this.v1=e.r,this.v2=e.g,this.v3=e.b},eightsStops(e){const t=[];for(let n=0;n<=8;++n)t.push(e(n/8));return t}},watch:{value(){this.valueChanged()},v1(){this.updateValue()},v2(){this.updateValue()},v3(){this.updateValue()},a(){this.updateValue()},mode(){this.initValues()}}});function GC(e,t,n,o,s,r){const i=E("slider");return g(),y("div",null,[C(i,{label:e.label1,modelValue:e.v1,"onUpdate:modelValue":t[0]||(t[0]=a=>e.v1=a),"max-value":e.maxValue1,"gradient-stops":e.stops1},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:e.label2,modelValue:e.v2,"onUpdate:modelValue":t[1]||(t[1]=a=>e.v2=a),"max-value":e.maxValue2,"gradient-stops":e.stops2},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:e.label3,modelValue:e.v3,"onUpdate:modelValue":t[2]||(t[2]=a=>e.v3=a),"max-value":e.maxValue3,"gradient-stops":e.stops3},null,8,["label","modelValue","max-value","gradient-stops"]),C(i,{label:"Alpha",modelValue:e.a,"onUpdate:modelValue":t[3]||(t[3]=a=>e.a=a),"max-value":255,"gradient-stops":e.stopsAlpha},null,8,["modelValue","gradient-stops"])])}const qC=ne(zC,[["render",GC],["__scopeId","data-v-3f181f4f"]]);var XC=Object.defineProperty,KC=Object.defineProperties,YC=Object.getOwnPropertyDescriptors,mc=Object.getOwnPropertySymbols,JC=Object.prototype.hasOwnProperty,ZC=Object.prototype.propertyIsEnumerable,bc=(e,t,n)=>t in e?XC(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,QC=(e,t)=>{for(var n in t||(t={}))JC.call(t,n)&&bc(e,n,t[n]);if(mc)for(var n of mc(t))ZC.call(t,n)&&bc(e,n,t[n]);return e},e1=(e,t)=>KC(e,YC(t));const vc="dddg.generated.colors",t1=ee({components:{SliderGroup:qC,DButton:Ln},inheritAttrs:!1,emits:["leave","update:modelValue"],props:{modelValue:{required:!0,type:String},title:{default:""},format:{type:String,default:"hex"}},data:()=>({mode:"hsla",relative:!0}),computed:{vertical(){return this.$store.state.ui.vertical},swatches(){return this.$store.state.content.current.colors},color:{get(){return this.format==="rgb"?ae.fromCss(this.modelValue).toHex():this.modelValue},set(e){if(this.format==="rgb"){const t=ae.fromCss(e);this.$emit("update:modelValue",t.toCss())}else this.$emit("update:modelValue",e)}}},mounted(){ue.subscribe(sr,this.settingColor)},unmounted(){ue.unsubscribe(sr,this.settingColor)},methods:{settingColor(e){this.color=ae.fromCss(e.color).toHex()},updateHex(e){const t=e.target.value;ae.validHex(t)&&(t.length===7||t.length===9)&&(this.color=t)},addSwatch(){if(this.swatches.find(n=>n.color===this.color))return;const e=this.$store.state.content.contentPacks.find(n=>n.packId===vc)||{packId:vc,packCredits:[""],dependencies:[],characters:[],fonts:[],backgrounds:[],sprites:[],poemStyles:[],poemBackgrounds:[],colors:[]},t=e1(QC({},e),{colors:[...e.colors,{label:this.color,color:this.color}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:t,processed:!0})})},pickColor(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!0)})}}});const n1={class:"column"},o1={class:"hex-selector"},s1=["for"],r1=["id","value"],i1=["title","onClick"];function l1(e,t,n,o,s,r){const i=E("slider-group"),a=E("d-button");return g(),y("div",{class:pe({color:!0,vertical:e.vertical})},[u("h2",null,fe(e.title),1),u("button",{onClick:t[0]||(t[0]=l=>e.$emit("leave"))},"OK"),u("table",null,[u("tr",null,[u("td",null,[u("button",{onClick:t[1]||(t[1]=l=>e.mode="hsla")},"HSLA")]),u("td",null,[u("button",{onClick:t[2]||(t[2]=l=>e.mode="rgba")},"RGBA")])])]),u("div",n1,[C(i,{mode:e.mode,modelValue:e.color,"onUpdate:modelValue":t[3]||(t[3]=l=>e.color=l),relative:!0},null,8,["mode","modelValue"]),u("div",o1,[u("label",{class:"hex-label",for:`hex_${e._.uid}`},"Hex",8,s1),u("input",{id:`hex_${e._.uid}`,value:e.color,onInput:t[4]||(t[4]=(...l)=>e.updateHex&&e.updateHex(...l)),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},null,40,r1)]),u("button",{onClick:t[6]||(t[6]=(...l)=>e.addSwatch&&e.addSwatch(...l))},"Add as swatch"),C(a,{icon:"colorize",onClick:e.pickColor},{default:B(()=>[O("Pick color")]),_:1},8,["onClick"])]),u("div",{id:"color-swatches",class:pe({vertical:e.vertical})},[(g(!0),y(U,null,Ce(e.swatches,l=>(g(),y("button",{class:"swatch",key:l.color,style:Re({backgroundColor:l.color}),title:l.label,onClick:d=>{e.color=l.color,e.$emit("leave")}},null,12,i1))),128))],2)],2)}const Gr=ne(t1,[["render",l1],["__scopeId","data-v-f8f3d802"]]);var a1=Object.defineProperty,yc=Object.getOwnPropertySymbols,d1=Object.prototype.hasOwnProperty,c1=Object.prototype.propertyIsEnumerable,_c=(e,t,n)=>t in e?a1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,u1=(e,t)=>{for(var n in t||(t={}))d1.call(t,n)&&_c(e,n,t[n]);if(yc)for(var n of yc(t))c1.call(t,n)&&_c(e,n,t[n]);return e};const wc=new Set(["brightness","contrast","grayscale","invert","opacity","saturate","sepia"]);function ul(e,t,n){const s=[...t().filters];let r;switch(e.type){case"hue-rotate":r={type:e.type,value:0};break;case"sepia":case"invert":case"blur":case"grayscale":case"brightness":case"contrast":case"opacity":case"saturate":r={type:e.type,value:1};break;case"drop-shadow":r={type:e.type,blurRadius:0,offsetX:10,offsetY:10,color:"#555555"};break;default:throw new At.UnreachableCaseError(e.type)}s.splice(e.idx,0,r),n({panelId:e.panelId,id:e.id,filters:s})}function pl(e,t,n){const s=[...t().filters];s.splice(e.idx,1),n({id:e.id,panelId:e.panelId,filters:s})}function fl(e,t,n){const s=[...t().filters],r=s[e.idx];s.splice(e.idx,1),s.splice(e.idx+e.moveBy,0,r),n({id:e.id,panelId:e.panelId,filters:s})}function hl(e,t,n){const s=[...t().filters],r=u1({},s[e.idx]);s[e.idx]=r,r.type==="drop-shadow"?(e.blurRadius!==void 0&&(r.blurRadius=e.blurRadius),e.color!==void 0&&(r.color=e.color),e.offsetX!==void 0&&(r.offsetX=e.offsetX),e.offsetY!==void 0&&(r.offsetY=e.offsetY)):r.value=e.value,n({id:e.id,panelId:e.panelId,filters:s})}var p1=Object.defineProperty,$c=Object.getOwnPropertySymbols,f1=Object.prototype.hasOwnProperty,h1=Object.prototype.propertyIsEnumerable,Cc=(e,t,n)=>t in e?p1(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,g1=(e,t)=>{for(var n in t||(t={}))f1.call(t,n)&&Cc(e,n,t[n]);if($c)for(var n of $c(t))h1.call(t,n)&&Cc(e,n,t[n]);return e},m1=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const eo=new Map([["blur","Blur"],["brightness","Brightness"],["contrast","Contrast"],["grayscale","Grayscale"],["hue-rotate","Rotate hue"],["invert","Invert colors"],["opacity","Opacity"],["saturate","Saturate"],["sepia","Sepia"],["drop-shadow","Drop shadow"]]),b1=(()=>{try{const e=cs();e.width=0,e.height=0;const n="filter"in e.getContext("2d");if(bo(e),n)return Array.from(eo.keys()).sort()}catch(e){}return["opacity"]})(),v1=ee({components:{DFlow:vs,DFieldset:Ht,Color:Gr,Slider:jf,L:Zl},props:{type:{type:String,required:!0},title:{type:String},id:{},panelId:{required:!0},noComposition:{type:Boolean,default:!1}},emits:["leave"],data:()=>({addEffectSelection:"",currentFilterIdx:0,showShadowColor:!1}),computed:{object(){switch(this.type){case"object":return this.$store.state.panels.panels[this.panelId].objects[this.id];case"background":return this.$store.state.panels.panels[this.panelId].background;case"panel":return this.$store.state.panels.panels[this.panelId];default:throw new At.UnreachableCaseError(this.type)}},compositionMode:{get(){return this.object.composite},set(e){this.vuexHistory.transaction(()=>{switch(this.type){case"object":this.$store.commit("panels/setComposition",{id:this.id,panelId:this.panelId,composite:e});break;case"background":break;case"panel":break;default:throw new At.UnreachableCaseError(this.type)}})}},filters(){return this.object.filters},filterTypes(){return b1},currentFilter(){var e;return(e=this.filters[this.currentFilterIdx])!=null?e:null},isPercentFilter(){const e=this.currentFilter;return e?wc.has(e.type):!1},maxValue(){const e=this.currentFilter;if(!!e){if(e.type==="hue-rotate")return 360;if(e.type==="grayscale"||e.type==="sepia"||e.type==="opacity"||e.type==="invert")return 100}},minValue(){const e=this.currentFilter;if(!!e)switch(e.type){case"blur":case"brightness":case"contrast":case"grayscale":case"hue-rotate":case"invert":case"opacity":case"saturate":case"sepia":return 0}},shadowColor:{get(){const e=this.currentFilter;if(!!e&&"color"in e)return e.color},set(e){this.setValue({color:e})}},shadowX:{get(){const e=this.currentFilter;if(!!e&&"offsetX"in e)return e.offsetX},set(e){this.setValue({offsetX:e})}},shadowY:{get(){const e=this.currentFilter;if(!!e&&"offsetY"in e)return e.offsetY},set(e){this.setValue({offsetY:e})}},shadowBlur:{get(){const e=this.currentFilter;if(!!e&&"blurRadius"in e)return e.blurRadius},set(e){this.setValue({blurRadius:e})}},hueStops(){return this.eightsStops(t=>new me(t,1,.5,1)).map(t=>t.toRgb().toCss())}},methods:{getFilterLabel(e){return eo.get(e)},getFilterText(e){return wc.has(e.type)?`${eo.get(e.type)} ${(e.value*100).toFixed()}%`:e.type==="hue-rotate"?`${eo.get(e.type)} ${e.value.toFixed()}\xB0`:e.type==="blur"?`${eo.get(e.type)} ${e.value.toFixed()}px`:eo.get(e.type)},objectTypeScope(e){switch(this.type){case"object":return"panels/object_"+e;case"background":return"panels/background"+e[0].toUpperCase()+e.slice(1);case"panel":return"panels/"+e}},addFilter(){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("addFilter"),{id:this.id,panelId:this.panelId,type:this.addEffectSelection,idx:this.currentFilterIdx+1})})},selectFilter(e){this.currentFilterIdx=e},removeFilter(){this.vuexHistory.transaction(()=>m1(this,null,function*(){yield this.$store.dispatch(this.objectTypeScope("removeFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx}),this.currentFilterIdx>=this.object.filters.length&&(this.currentFilterIdx=this.object.filters.length-1)}))},moveFilter(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("moveFilter"),{id:this.id,panelId:this.panelId,idx:this.currentFilterIdx,moveBy:e}),this.currentFilterIdx+=e})},setValue(e){this.vuexHistory.transaction(()=>{this.$store.dispatch(this.objectTypeScope("setFilter"),g1({id:this.id,panelId:this.panelId,idx:this.currentFilterIdx},e))})},eightsStops(e){const t=[];for(let n=0;n<=8;++n)t.push(e(n/8));return t}}});const ce=e=>(ze("data-v-e3b0e8df"),e=e(),Ge(),e),y1=ce(()=>u("h2",null,"Image options",-1)),_1={class:"column ok-col"},w1={key:0,class:"column"},$1=ce(()=>u("label",{for:"compositionSelect"},"Compositing Mode:",-1)),C1=ce(()=>u("option",{value:"source-over"},"source-over",-1)),P1=ce(()=>u("option",{value:"source-atop"},"source-atop",-1)),S1=ce(()=>u("option",{value:"destination-over"},"destination-over",-1)),k1=ce(()=>u("option",{value:"destination-in"},"destination-in",-1)),O1=ce(()=>u("option",{value:"destination-in"},"destination-out",-1)),x1=ce(()=>u("option",{value:"destination-in"},"destination-atop",-1)),j1=ce(()=>u("option",{value:"lighter"},"lighter",-1)),I1=ce(()=>u("option",{value:"xor"},"xor",-1)),T1=ce(()=>u("option",{value:"multiply"},"multiply",-1)),E1=ce(()=>u("option",{value:"screen"},"screen",-1)),B1=ce(()=>u("option",{value:"overlay"},"overlay",-1)),A1=ce(()=>u("option",{value:"darken"},"darken",-1)),D1=ce(()=>u("option",{value:"lighten"},"lighten",-1)),R1=ce(()=>u("option",{value:"color-dodge"},"color-dodge",-1)),H1=ce(()=>u("option",{value:"color-burn"},"color-burn",-1)),M1=ce(()=>u("option",{value:"hard-light"},"hard-light",-1)),F1=ce(()=>u("option",{value:"soft-light"},"soft-light",-1)),N1=ce(()=>u("option",{value:"difference"},"difference",-1)),L1=ce(()=>u("option",{value:"exclusion"},"exclusion",-1)),U1=ce(()=>u("option",{value:"hue"},"hue",-1)),V1=ce(()=>u("option",{value:"saturation"},"saturation",-1)),W1=ce(()=>u("option",{value:"color"},"color",-1)),z1=ce(()=>u("option",{value:"luminosity"},"luminosity",-1)),G1=[C1,P1,S1,k1,O1,x1,j1,I1,T1,E1,B1,A1,D1,R1,H1,M1,F1,N1,L1,U1,V1,W1,z1],q1=ce(()=>u("label",{for:"addEffect"},"Add new effect",-1)),X1=["value"],K1=["disabled"],Y1=["disabled"],J1=["disabled"],Z1=["disabled"],Q1=["onClick","onKeydown"],eP={key:0,class:"value-input-table"},tP=ce(()=>u("td",null,[u("label",{for:"shadow_color"},"Color:")],-1)),nP=ce(()=>u("td",null,[u("label",{for:"filter_x"},"X:")],-1)),oP=ce(()=>u("td",null,[u("label",{for:"filter_y"},"Y:")],-1)),sP=ce(()=>u("td",null,[u("label",{for:"filter_blur"},"Blur:")],-1)),rP=ce(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),iP=["value","max","min"],lP={key:0},aP={colspan:"2"},dP=ce(()=>u("td",null,[u("label",{for:"filter_value"},"Value:")],-1)),cP=["value","max","min"],uP={key:0},pP={colspan:"2"};function fP(e,t,n,o,s,r){const i=E("color"),a=E("l"),l=E("d-flow"),d=E("slider"),c=E("d-fieldset");return e.showShadowColor?(g(),L(i,{key:0,modelValue:e.shadowColor,"onUpdate:modelValue":t[0]||(t[0]=p=>e.shadowColor=p),format:"rgb",onLeave:t[1]||(t[1]=p=>e.showShadowColor=!1)},null,8,["modelValue"])):(g(),L(l,{key:1,"no-wraping":"",class:"image-options-subpanel"},{default:B(()=>[y1,u("div",_1,[u("button",{onClick:t[2]||(t[2]=p=>e.$emit("leave"))},"Back")]),e.noComposition?X("",!0):(g(),y("div",w1,[$1,C(a,{to:"https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation#Types"},{default:B(()=>[O("[?] ")]),_:1}),de(u("select",{id:"compositionSelect","onUpdate:modelValue":t[3]||(t[3]=p=>e.compositionMode=p),onKeydown:t[4]||(t[4]=G(()=>{},["stop"]))},G1,544),[[_t,e.compositionMode]])])),C(c,{class:"column",title:"Effects",style:{overflow:"hidden"}},{default:B(()=>[C(l,{class:"filter-flow","no-wraping":"",gap:"8px"},{default:B(()=>[C(l,{direction:"vertical","no-wraping":""},{default:B(()=>[q1,de(u("select",{id:"addEffect","onUpdate:modelValue":t[5]||(t[5]=p=>e.addEffectSelection=p),onKeydown:t[6]||(t[6]=G(()=>{},["stop"]))},[(g(!0),y(U,null,Ce(e.filterTypes,p=>(g(),y("option",{key:p,value:p},fe(e.getFilterLabel(p)),9,X1))),128))],544),[[_t,e.addEffectSelection]]),u("button",{disabled:e.addEffectSelection==="",onClick:t[7]||(t[7]=(...p)=>e.addFilter&&e.addFilter(...p)),onKeydown:t[8]||(t[8]=G(()=>{},["stop"]))}," Add ",40,K1),u("button",{disabled:!e.currentFilter,onClick:t[9]||(t[9]=(...p)=>e.removeFilter&&e.removeFilter(...p)),onKeydown:t[10]||(t[10]=G(()=>{},["stop"]))}," Remove ",40,Y1),u("button",{disabled:e.currentFilterIdx===0,onClick:t[11]||(t[11]=p=>e.moveFilter(-1)),onKeydown:t[12]||(t[12]=G(()=>{},["stop"]))}," Move up ",40,J1),u("button",{disabled:e.currentFilterIdx===e.filters.length-1||e.filters.length===0,onClick:t[13]||(t[13]=p=>e.moveFilter(1)),onKeydown:t[14]||(t[14]=G(()=>{},["stop"]))}," Move down ",40,Z1)]),_:1}),C(l,{maxSize:"100%",direction:"vertical","no-wraping":""},{default:B(()=>[(g(!0),y(U,null,Ce(e.filters,(p,f)=>(g(),y("div",{key:f,class:pe({choiceBtn:!0,active:f===e.currentFilterIdx}),tabindex:"0",onClick:b=>e.selectFilter(f),onKeydown:[Le(b=>e.selectFilter(f),["enter"]),Le(G(b=>e.selectFilter(f),["prevent"]),["space"])]},fe(e.getFilterText(p)),43,Q1))),128))]),_:1}),e.currentFilter?(g(),y("table",eP,[e.currentFilter.type==="drop-shadow"?(g(),y(U,{key:0},[u("tr",null,[tP,u("td",null,[u("button",{id:"shadow_color",class:"color-button",style:Re({background:e.shadowColor}),onClick:t[15]||(t[15]=p=>e.showShadowColor=!0)}," \xA0 ",4)])]),u("tr",null,[nP,u("td",null,[de(u("input",{id:"filter_x",type:"number","onUpdate:modelValue":t[16]||(t[16]=p=>e.shadowX=p),onKeydown:t[17]||(t[17]=G(()=>{},["stop"]))},null,544),[[Ee,e.shadowX,void 0,{number:!0}]])])]),u("tr",null,[oP,u("td",null,[de(u("input",{id:"filter_y",type:"number","onUpdate:modelValue":t[18]||(t[18]=p=>e.shadowY=p),onKeydown:t[19]||(t[19]=G(()=>{},["stop"]))},null,544),[[Ee,e.shadowY,void 0,{number:!0}]])])]),u("tr",null,[sP,u("td",null,[de(u("input",{id:"filter_blur",type:"number","onUpdate:modelValue":t[20]||(t[20]=p=>e.shadowBlur=p),onKeydown:t[21]||(t[21]=G(()=>{},["stop"]))},null,544),[[Ee,e.shadowBlur,void 0,{number:!0}]])])])],64)):e.isPercentFilter?(g(),y(U,{key:1},[u("tr",null,[rP,u("td",null,[u("input",{id:"filter_value",value:(e.currentFilter.value*100).toFixed(),type:"number",max:e.maxValue,min:e.minValue,onInput:t[22]||(t[22]=p=>e.setValue({value:Number(p.target.value/100)})),onKeydown:t[23]||(t[23]=G(()=>{},["stop"]))},null,40,iP),O("% ")])]),e.minValue===0&&e.maxValue!==void 0?(g(),y("tr",lP,[u("td",aP,[C(d,{gradientStops:["#000000","#ffffff"],label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value*100,"no-input":"","onUpdate:modelValue":t[24]||(t[24]=p=>e.setValue({value:Math.round(p)/100}))},null,8,["maxValue","modelValue"])])])):X("",!0)],64)):(g(),y(U,{key:2},[u("tr",null,[dP,u("td",null,[u("input",{id:"filter_value",value:e.currentFilter.value,type:"number",max:e.maxValue,min:e.minValue,onInput:t[25]||(t[25]=p=>e.setValue({value:Number(p.target.value)})),onKeydown:t[26]||(t[26]=G(()=>{},["stop"]))},null,40,cP)])]),e.minValue===0&&e.maxValue!==void 0?(g(),y("tr",uP,[u("td",pP,[C(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"no-input":"","onUpdate:modelValue":t[27]||(t[27]=p=>e.setValue({value:Math.round(p)}))},null,8,["gradientStops","maxValue","modelValue"]),C(d,{gradientStops:e.hueStops,label:"",maxValue:e.maxValue,modelValue:e.currentFilter.value,"shift-gradient":"","no-input":"",disabled:""},null,8,["gradientStops","maxValue","modelValue"])])])):X("",!0)],64))])):X("",!0)]),_:1})]),_:1})]),_:1}))}const $a=ne(v1,[["render",fP],["__scopeId","data-v-e3b0e8df"]]),hP=ee({inheritAttrs:!1,components:{Color:Gr},props:{modelValue:{type:String,required:!0},title:{type:String,default:""}},data:()=>({colorSelector:"",selectedFont:"",selectedColor:"#000000",rememberedStart:0,rememberedEnd:0,error:""}),computed:{vertical(){return this.$store.state.ui.vertical}},watch:{selectedFont(){this.selectedFont!==""&&(this.insertCommand("font",this.selectedFont),this.selectedFont="")}},methods:{onValueChanged(){const e=Y(),t=this.$refs.textArea.value;try{new ct(t,e.TextBox.NameboxTextStyle),this.error=""}catch(n){this.error=n.message}this.$emit("update:modelValue",t)},selectColor(e){const t=this.$refs.textArea;this.colorSelector=e,this.rememberedStart=t.selectionStart,this.rememberedEnd=t.selectionEnd},applyColor(){const e=this.selectedColor,t=this.colorSelector,n=()=>{const o=this.$refs.textArea;if(!o){this.$nextTick(n);return}o.selectionStart=this.rememberedStart,o.selectionEnd=this.rememberedEnd,this.insertCommand(t==="text"?"color":"outlinecolor",e)};this.$nextTick(n),this.selectedColor="#000000",this.colorSelector=""},insertText(e){const t=this.$refs.textArea,n=t.value,o=t.selectionStart,s=t.selectionEnd;t.value=n.slice(0,o)+e+n.slice(s),t.selectionStart=t.selectionEnd=o+e.length,t.focus(),this.onValueChanged()},insertCommand(e,t){const n=this.$refs.textArea,o=n.value,s=n.selectionStart,r=n.selectionEnd,i=o.slice(s,r),a=o.slice(0,s),l=o.slice(r);let d=e;t&&(d+="="+t),n.value=`${a}{${d}}${i}{/${e}}${l}`,n.selectionStart=s+d.length+2,n.selectionEnd=n.selectionStart+i.length,n.focus(),this.onValueChanged()}}});const gP=e=>(ze("data-v-d3fa7848"),e=e(),Ge(),e),mP={class:"column ok-col"},bP={class:"column"},vP=["value"],yP={key:0,class:"column error-col"},_P={class:"column"},wP=gP(()=>u("p",{class:"hint-col"},"Apply style to selected text:",-1)),$P={class:"column"},CP={class:"column"},PP={class:"column"},SP=sm('<option value data-v-d3fa7848>Font</option><option value="aller" style="font-family:aller;" data-v-d3fa7848> Aller (Textbox) </option><option value="riffic" style="font-family:riffic;" data-v-d3fa7848> Riffic (Bold text) </option><option value="hashtag" style="font-family:hashtag;" data-v-d3fa7848> Hashtag (Sayori) </option><option value="ammy_handwriting" style="font-family:ammy_handwriting;" data-v-d3fa7848> Ammy&#39;s Handwriting (Natsuki) </option><option value="journal" style="font-family:journal;" data-v-d3fa7848> Journal (Monika) </option><option value="jp_hand_slanted" style="font-family:jp_hand_slanted;" data-v-d3fa7848> JP Hand Slanted (Yuri) </option><option value="damagrafik_script" style="font-family:damagrafik_script;" data-v-d3fa7848> Damagrafik (Yuri, Act 2) </option><option value="as_i_lay_dying" style="font-family:as_i_lay_dying;" data-v-d3fa7848> As I Lay Dying (Yuri, Act Unused) </option><option value="halogen" style="font-family:halogen;" data-v-d3fa7848> Halogen (MC) </option>',10),kP=[SP];function OP(e,t,n,o,s,r){const i=E("color");return e.colorSelector?(g(),L(i,{key:0,modelValue:e.selectedColor,"onUpdate:modelValue":t[0]||(t[0]=a=>e.selectedColor=a),onLeave:e.applyColor},null,8,["modelValue","onLeave"])):(g(),y("div",{key:1,class:pe({"text-subpanel":!0,vertical:e.vertical})},[u("h2",null,fe(e.title),1),u("div",mP,[u("button",{onClick:t[1]||(t[1]=a=>e.$emit("leave"))},"OK")]),u("div",bP,[u("textarea",{ref:"textArea",value:e.modelValue,onInput:t[2]||(t[2]=(...a)=>e.onValueChanged&&e.onValueChanged(...a)),onKeydown:t[3]||(t[3]=G(()=>{},["stop"])),onKeypress:t[4]||(t[4]=G(()=>{},["stop"]))},null,40,vP)]),e.error?(g(),y("div",yP,fe(e.error),1)):X("",!0),u("div",_P,[u("button",{onClick:t[5]||(t[5]=a=>e.insertText("\\\\")),class:"style-button"},"Insert \\"),u("button",{onClick:t[6]||(t[6]=a=>e.insertText("\\{")),class:"style-button"},"Insert {"),u("button",{onClick:t[7]||(t[7]=a=>e.insertText("\\}")),class:"style-button"},"Insert }")]),wP,u("div",$P,[u("button",{onClick:t[8]||(t[8]=a=>e.insertCommand("b")),class:"style-button",style:{"font-weight":"bold"}}," Bold "),u("button",{onClick:t[9]||(t[9]=a=>e.insertCommand("i")),class:"style-button",style:{"font-style":"italic"}}," Italics "),u("button",{onClick:t[10]||(t[10]=a=>e.insertCommand("plain")),class:"style-button"}," Plain "),u("button",{onClick:t[11]||(t[11]=a=>e.insertCommand("edited")),class:"style-button edited-style"}," Edited "),u("button",{onClick:t[12]||(t[12]=a=>e.insertCommand("k",2)),class:"style-button",style:{"letter-spacing":"5px"}}," Kerning ")]),u("div",CP,[u("button",{onClick:t[13]||(t[13]=a=>e.insertCommand("alpha",.5)),class:"style-button"}," Alpha ")]),u("div",PP,[u("button",{onClick:t[14]||(t[14]=a=>e.insertCommand("size",12)),class:"style-button",style:{"font-size":"20px"}}," Font size "),de(u("select",{"onUpdate:modelValue":t[15]||(t[15]=a=>e.selectedFont=a),class:"style-button"},kP,512),[[_t,e.selectedFont]]),u("button",{onClick:t[16]||(t[16]=a=>e.selectColor("text")),class:"style-button"}," Text color "),u("button",{onClick:t[17]||(t[17]=a=>e.selectColor("outline")),class:"style-button"}," Outline color ")])],2))}const xP=ne(hP,[["render",OP],["__scopeId","data-v-d3fa7848"]]);var Xn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const $i=ys(),jP=ee({mixins:[st],components:{Toggle:Rt,PositionAndSize:$C,Layers:BC,Delete:RC,TextEditor:xP,ImageOptions:$a,Color:Gr,ModalDialog:Jl,DFieldset:Ht},props:{object:{type:Object,required:!0},title:String,textHandler:{type:Object},colorHandler:{type:Object},showAltPanel:Boolean},data:()=>({imageOptionsOpen:!1,canEdit:!0,modalNameInput:"",showRename:!1,localColorHandler:null}),computed:{flip:$i("flip","panels/setFlip"),rotation:$i("rotation","panels/setRotation"),enlargeWhenTalking:$i("enlargeWhenTalking","panels/setEnlargeWhenTalking"),currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},nameboxWidth:{get(){const e=this.object.nameboxWidth;return e===null?"":e+""},set(e){const t=e.trim()===""?null:parseInt(e);this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setObjectNameboxWidth",{id:this.object.id,panelId:this.object.panelId,nameboxWidth:t})}))}},zoom:{get(){return this.object.zoom*100},set(e){this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setObjectZoom",{id:this.object.id,panelId:this.object.panelId,zoom:e/100})}))}},defaultNameboxWidth(){return Y().TextBox.NameboxWidth},finalColorHandler(){return this.localColorHandler||this.colorHandler||null},hasLabel(){return this.object.label!==null},heading(){var e,t;return(t=(e=this.object.label)!=null?e:this.title)!=null?t:"Object"},useCustomTextboxColor:{get(){return this.object.textboxColor!==null},set(e){this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e?Y().TextBoxCustom.textboxDefaultColor:null})}))}}},methods:{copy(){this.vuexHistory.transaction(()=>Xn(this,null,function*(){yield this.$store.dispatch("panels/copyObjectToClipboard",{panelId:this.object.panelId,id:this.object.id})}))},enableNameEdit(){var e;this.modalNameInput=(e=this.object.label)!=null?e:"",this.showRename=!0},renameOption(e){this.showRename=!1,e==="Apply"&&this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setLabel",{panelId:this.object.panelId,id:this.object.id,label:this.modalNameInput})}))},selectTextboxColor(){this.localColorHandler={title:"Textbox color",get:()=>this.object.textboxColor,set:e=>{this.vuexHistory.transaction(()=>Xn(this,null,function*(){this.$store.commit("panels/setTextboxColor",{panelId:this.object.panelId,id:this.object.id,textboxColor:e})}))},leave:()=>{this.localColorHandler=null}}}}});const Bo=e=>(ze("data-v-f18d06fb"),e=e(),Ge(),e),IP={class:"panel"},TP=Bo(()=>u("span",{class:"icon material-icons"},"edit",-1)),EP=Bo(()=>u("p",{class:"modal-text"},"Enter the new name",-1)),BP={class:"modal-text"},AP={class:"input-table"},DP=Bo(()=>u("td",null,[u("label",{for:"rotation"},"Rotation: \xB0")],-1)),RP={key:0},HP=Bo(()=>u("td",null,[u("label",{for:"zoom"},"Zoom: ")],-1)),MP={key:0},FP=Bo(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),NP=Bo(()=>u("td",null,[u("label",{for:"namebox_width"},"Namebox width:")],-1)),LP=["placeholder"];function UP(e,t,n,o,s,r){const i=E("modal-dialog"),a=E("text-editor"),l=E("color"),d=E("image-options"),c=E("position-and-size"),p=E("layers"),f=E("toggle"),b=E("d-fieldset"),v=E("delete");return g(),y("div",IP,[u("h1",{style:Re({fontStyle:e.hasLabel?"italic":"normal"}),onClick:t[0]||(t[0]=(...w)=>e.enableNameEdit&&e.enableNameEdit(...w))},[O(fe(e.heading)+" ",1),TP],4),(g(),L(ip,{to:"#modal-messages"},[e.showRename?(g(),L(i,{key:0,options:["Apply","Cancel"],"no-base-size":"",class:"modal-rename",onOption:e.renameOption,onLeave:t[3]||(t[3]=w=>e.renameOption("Cancel"))},{default:B(()=>[EP,u("p",BP,[de(u("input",{"onUpdate:modelValue":t[1]||(t[1]=w=>e.modalNameInput=w),style:{width:"100%"},onKeydown:t[2]||(t[2]=Le(G(w=>e.renameOption("Apply"),["prevent","stop"]),["enter"]))},null,544),[[Ee,e.modalNameInput]])])]),_:1},8,["onOption"])):X("",!0)])),e.textHandler?(g(),L(a,{key:0,title:e.textHandler.title,modelValue:e.textHandler.get(),"onUpdate:modelValue":t[4]||(t[4]=w=>e.textHandler.set(w)),onLeave:t[5]||(t[5]=w=>e.textHandler.leave())},null,8,["title","modelValue"])):e.finalColorHandler?(g(),L(l,{key:1,title:e.finalColorHandler.title,modelValue:e.finalColorHandler.get(),"onUpdate:modelValue":t[6]||(t[6]=w=>e.finalColorHandler.set(w)),onLeave:t[7]||(t[7]=w=>e.finalColorHandler.leave())},null,8,["title","modelValue"])):e.imageOptionsOpen?(g(),L(d,{key:2,type:"object","panel-id":e.object.panelId,id:e.object.id,onLeave:t[8]||(t[8]=w=>e.imageOptionsOpen=!1)},null,8,["panel-id","id"])):e.showAltPanel?qt(e.$slots,"alt-panel",{key:3},void 0,!0):(g(),y(U,{key:4},[qt(e.$slots,"default",{},void 0,!0),C(c,{obj:e.object},null,8,["obj"]),C(p,{object:e.object},null,8,["object"]),C(f,{modelValue:e.flip,"onUpdate:modelValue":t[9]||(t[9]=w=>e.flip=w),label:"Flip?"},null,8,["modelValue"]),u("table",AP,[u("tr",null,[DP,u("td",null,[de(u("input",{id:"rotation",class:"smol",type:"number","onUpdate:modelValue":t[10]||(t[10]=w=>e.rotation=w),onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Ee,e.rotation]])])]),e.object.type==="character"||e.object.type==="sprite"?(g(),y("tr",RP,[HP,u("td",null,[de(u("input",{id:"zoom",type:"number",class:"smol",step:"1",min:"0","onUpdate:modelValue":t[12]||(t[12]=w=>e.zoom=w),onKeydown:t[13]||(t[13]=G(()=>{},["stop"]))},null,544),[[Ee,e.zoom]])])])):X("",!0)]),qt(e.$slots,"options",{},void 0,!0),e.hasLabel?(g(),L(b,{key:0,title:"Textbox settings"},{default:B(()=>[e.object.type==="character"||e.object.type==="sprite"?(g(),L(f,{key:0,label:"Enlarge when talking",modelValue:e.enlargeWhenTalking,"onUpdate:modelValue":t[14]||(t[14]=w=>e.enlargeWhenTalking=w)},null,8,["modelValue"])):X("",!0),C(f,{label:"Use custom textbox color",modelValue:e.useCustomTextboxColor,"onUpdate:modelValue":t[15]||(t[15]=w=>e.useCustomTextboxColor=w)},null,8,["modelValue"]),u("table",null,[e.useCustomTextboxColor?(g(),y("tr",MP,[FP,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Re({background:e.object.textboxColor}),onClick:t[16]||(t[16]=(...w)=>e.selectTextboxColor&&e.selectTextboxColor(...w))},null,4)])])):X("",!0),u("tr",null,[NP,u("td",null,[de(u("input",{id:"namebox_width",type:"number",placeholder:e.defaultNameboxWidth,"onUpdate:modelValue":t[17]||(t[17]=w=>e.nameboxWidth=w)},null,8,LP),[[Ee,e.nameboxWidth,void 0,{lazy:!0}]])])])])]),_:1})):X("",!0),u("button",{onClick:t[18]||(t[18]=w=>e.imageOptionsOpen=!0)},"Image options"),u("button",{onClick:t[19]||(t[19]=(...w)=>e.copy&&e.copy(...w))},"Copy"),C(v,{obj:e.object},null,8,["obj"])],64))])}const Ao=ne(jP,[["render",UP],["__scopeId","data-v-f18d06fb"]]);var Pc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Sc=ys(),VP=ee({mixins:[st],components:{Toggle:Rt,Parts:q$,DFieldset:Ht,ObjectTool:Ao},data:()=>({panelForParts:null}),computed:{flip:Sc("flip","panels/setFlip"),closeUp:Sc("close","panels/setClose"),missingHead(){const e=this.charData,t=this.object,n=cr(e,t);if(!n)return null;for(const o of n.variants){const s=Mn(o[0],!1);if(console.log(s),s.startsWith("uploads:"))return s.substring(8)}return null},selection(){return this.$store.state.ui.selection},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.selection];if(e.type==="character")return e},charData(){return Nr(this.$store,this.object)},label(){var e;return(e=this.charData.label)!=null?e:""},parts(){return f$(this.charData,this.object)},hasMultipleStyles(){return this.charData.styleGroups[this.object.styleGroupId].styles.length>1||this.charData.styleGroups.length>1},hasMultiplePoses(){return this.charData.styleGroups[this.object.styleGroupId].styles[this.object.styleId].poses.length>1}},methods:{reuploadHead(){this.$refs.missingHeadUpload.click()},onMissingHeadFileUpload(e){return Pc(this,null,function*(){const t=this.$refs.missingHeadUpload;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const n=t.files[0];yield this.vuexHistory.transaction(()=>Pc(this,null,function*(){const o=URL.createObjectURL(n);yield this.$store.dispatch("uploadUrls/add",{name:this.missingHead,url:o})}))})},seekPose(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPose",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekStyle(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekStyle",{id:this.object.id,panelId:this.object.panelId,delta:e})})},seekPart(e,t){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekPart",{id:this.object.id,panelId:this.object.panelId,delta:t,part:e})})},captialize(e){return e.charAt(0).toUpperCase()+e.substring(1)}},watch:{selection(){this.panelForParts=null}}});const WP={class:"warning"},zP={style:{"word-wrap":"break-word"}},GP={key:0},qP={class:"arrow-col"},XP={class:"arrow-col"},KP={key:1},YP={class:"arrow-col"},JP={class:"arrow-col"},ZP={class:"arrow-col"},QP=["onClick"],eS=["onClick"],tS={class:"arrow-col"},nS=["onClick"];function oS(e,t,n,o,s,r){const i=E("parts"),a=E("d-fieldset"),l=E("toggle"),d=E("object-tool");return g(),L(d,{object:e.object,title:e.label,showAltPanel:!!e.panelForParts},{"alt-panel":B(()=>[e.panelForParts?(g(),L(i,{key:0,character:e.object,part:e.panelForParts,onLeave:t[0]||(t[0]=c=>e.panelForParts=null),onShowDialog:t[1]||(t[1]=c=>e.$emit("show-dialog",c)),onShowExpressionDialog:t[2]||(t[2]=c=>e.$emit("show-expression-dialog",c))},null,8,["character","part"])):X("",!0)]),default:B(()=>[e.missingHead?(g(),y(U,{key:0},[u("p",WP,[O(" MISSING Head sprite! Click below to re-upload "),u("span",zP,'"'+fe(e.missingHead)+'"',1),O(". ")]),u("button",{onClick:t[3]||(t[3]=c=>e.reuploadHead())},"Re-Upload"),u("input",{type:"file",ref:"missingHeadUpload",onChange:t[4]||(t[4]=(...c)=>e.onMissingHeadFileUpload&&e.onMissingHeadFileUpload(...c))},null,544)],64)):X("",!0),e.hasMultiplePoses||e.parts.length>0||e.hasMultipleStyles?(g(),L(a,{key:1,class:"pose-list",title:"Pose:"},{default:B(()=>[u("table",null,[u("tbody",null,[e.hasMultipleStyles?(g(),y("tr",GP,[u("td",qP,[u("button",{onClick:t[5]||(t[5]=c=>e.seekStyle(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[6]||(t[6]=c=>e.panelForParts="style")}," Style ")]),u("td",XP,[u("button",{onClick:t[7]||(t[7]=c=>e.seekStyle(1))},">")])])):X("",!0),e.hasMultiplePoses?(g(),y("tr",KP,[u("td",YP,[u("button",{onClick:t[8]||(t[8]=c=>e.seekPose(-1))},"<")]),u("td",null,[u("button",{class:"middle-button",onClick:t[9]||(t[9]=c=>e.panelForParts="pose")}," Pose ")]),u("td",JP,[u("button",{onClick:t[10]||(t[10]=c=>e.seekPose(1))},">")])])):X("",!0),(g(!0),y(U,null,Ce(e.parts,c=>(g(),y("tr",{key:c},[u("td",ZP,[u("button",{onClick:p=>e.seekPart(c,-1)},"<",8,QP)]),u("td",null,[u("button",{class:"middle-button",onClick:p=>e.panelForParts=c},fe(e.captialize(c)),9,eS)]),u("td",tS,[u("button",{onClick:p=>e.seekPart(c,1)},">",8,nS)])]))),128))])])]),_:1})):X("",!0)]),options:B(()=>[C(l,{modelValue:e.closeUp,"onUpdate:modelValue":t[11]||(t[11]=c=>e.closeUp=c),label:"Close up?"},null,8,["modelValue"])]),_:1},8,["object","title","showAltPanel"])}const sS=ne(VP,[["render",oS],["__scopeId","data-v-1b773909"]]);var kc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const rS=ee({mixins:[st],components:{ObjectTool:Ao},computed:{missing(){for(const e of this.object.assets){const t=Mn(e,!1);if(console.log(t),t.startsWith("uploads:"))return t.substring(8)}return null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="sprite")return e}},methods:{reupload(){this.$refs.missingSpriteUpload.click()},onMissingSpriteFileUpload(e){return kc(this,null,function*(){const t=this.$refs.missingSpriteUpload;if(!t.files)return;if(t.files.length!==1){console.error("More than one file uploaded!");return}const n=t.files[0];yield this.vuexHistory.transaction(()=>kc(this,null,function*(){const o=URL.createObjectURL(n);yield this.$store.dispatch("uploadUrls/add",{name:this.missing,url:o})}))})}}});const iS={class:"warning"},lS={style:{"word-wrap":"break-word"}};function aS(e,t,n,o,s,r){const i=E("object-tool");return g(),L(i,{object:e.object,title:"Custom Sprite"},{default:B(()=>[e.missing?(g(),y(U,{key:0},[u("p",iS,[O(" MISSING SPRITE! Click below to re-upload "),u("span",lS,'"'+fe(e.missing)+'"',1),O(". ")]),u("button",{onClick:t[0]||(t[0]=a=>e.reupload())},"Re-Upload"),u("input",{type:"file",ref:"missingSpriteUpload",onChange:t[1]||(t[1]=(...a)=>e.onMissingSpriteFileUpload&&e.onMissingSpriteFileUpload(...a))},null,544)],64)):X("",!0)]),_:1},8,["object"])}const dS=ne(rS,[["render",aS],["__scopeId","data-v-000b5127"]]);function Oc(e,t,n){return e>t?e:t>n?n:t}var cS=Object.defineProperty,uS=Object.defineProperties,pS=Object.getOwnPropertyDescriptors,xc=Object.getOwnPropertySymbols,fS=Object.prototype.hasOwnProperty,hS=Object.prototype.propertyIsEnumerable,jc=(e,t,n)=>t in e?cS(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ic=(e,t)=>{for(var n in t||(t={}))fS.call(t,n)&&jc(e,n,t[n]);if(xc)for(var n of xc(t))hS.call(t,n)&&jc(e,n,t[n]);return e},gS=(e,t)=>uS(e,pS(t)),mS=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Tc=4,bS={setTalkingObject(e,t){const n=e.panels[t.panelId].objects[t.id];n.talkingObjId=t.talkingObjId,++n.version},setTalkingOther(e,t){const n=e.panels[t.panelId].objects[t.id];n.talkingOther=t.talkingOther,n.talkingObjId="$other$",++n.version},setResetBounds(e,t){const n=e.panels[t.panelId].objects[t.id];n.resetBounds=t.resetBounds,n.x=t.resetBounds.x,n.y=t.resetBounds.y,n.height=t.resetBounds.height,n.width=t.resetBounds.width,n.rotation=t.resetBounds.rotation,++n.version},setTextBoxProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},vS={createTextBox({commit:e,state:t,rootState:n},o){var s;const r=Y(),i=t.panels[o.panelId].lastObjId+1,a=r.TextBox.DefaultTextboxStyle,l=Jo[a],d=o.resetBounds||{x:l.defaultX,y:l.defaultY,width:l.defaultWidth,height:l.defaultHeight,rotation:0};return e("create",{object:gS(Ic(Ic({},Io()),d),{panelId:n.panels.currentPanel,id:i,onTop:!0,type:"textBox",preserveRatio:!1,ratio:r.TextBox.TextBoxWidth/r.TextBox.TextBoxHeight,continue:!0,controls:!0,skip:!0,autoQuoting:!0,autoWrap:!0,style:a,overrideColor:!1,customColor:r.TextBoxCustom.textboxDefaultColor,deriveCustomColors:!0,customControlsColor:r.TextBoxCustom.controlsDefaultColor,customNameboxColor:r.TextBoxCustom.nameboxDefaultColor,customNameboxWidth:null,customNameboxStroke:r.TextBoxCustom.nameboxStrokeDefaultColor,talkingObjId:null,talkingOther:"",text:(s=o.text)!=null?s:"Click here to edit the textbox",resetBounds:d})}),i},setStyle({state:e,commit:t},n){const o=Y(),s=e.panels[n.panelId].objects[n.id],r=Jo[s.style],i=Jo[n.style],a=10;let l=!1;const d={panelId:n.panelId,id:n.id,x:s.x,y:s.y};let c=!1;const p={panelId:n.panelId,id:n.id,width:s.width,height:s.height};i.resizable?(r.defaultWidth!==i.defaultWidth&&(c=!0,p.width=Math.max(p.width+i.defaultWidth-r.defaultWidth,a)),r.defaultHeight!==i.defaultHeight&&(c=!0,p.height=Math.max(p.height+i.defaultHeight-r.defaultHeight,a))):(c=!0,p.width=i.defaultWidth,p.height=i.defaultHeight),r.defaultX!==i.defaultX&&(l=!0,d.x=Oc(-p.width+a,d.x+i.defaultX-r.defaultX,o.Base.screenWidth-a)),r.defaultY!==i.defaultY&&(l=!0,d.y=Oc(-p.height+a,d.y+i.defaultY-r.defaultY,o.Base.screenHeight-a)),l&&t("setPosition",d),c&&t("setSize",p),t("setTextBoxProperty",Gs(n.panelId,n.id,"style",n.style))},resetTextboxBounds({commit:e,state:t},n){const o=t.panels[n.panelId].objects[n.id];e("setPosition",{panelId:n.panelId,id:n.id,x:o.resetBounds.x,y:o.resetBounds.y}),e("setSize",{panelId:n.panelId,id:n.id,height:o.resetBounds.height,width:o.resetBounds.width}),e("setRotation",{panelId:n.panelId,id:n.id,rotation:o.resetBounds.rotation})},splitTextbox(e,t){return mS(this,arguments,function*({commit:n,state:o,dispatch:s},r){const i=o.panels[r.panelId].objects[r.id];if(i.type!=="textBox")return;const a=(i.width-Tc)/2,l=a/2+Tc/2,d=[i.x,i.y];let c=[i.x-l,i.y],p=[i.x+l,i.y];i.rotation!==0&&(c=pr(c[0],c[1],d[0],d[1],i.rotation/180*Math.PI),p=pr(p[0],p[1],d[0],d[1],i.rotation/180*Math.PI)),n("setResetBounds",{id:r.id,panelId:r.panelId,resetBounds:{x:c[0],y:c[1],width:a,height:i.height,rotation:i.rotation}});const f=i.style==="custom_plus"?"custom_plus":"custom";i.style!==f&&(yield s("setStyle",Gs(r.panelId,r.id,"style",f)));const b=yield s("createTextBox",{panelId:r.panelId,resetBounds:{x:p[0],y:p[1],width:a,height:i.height,rotation:i.rotation}});yield s("setStyle",Gs(r.panelId,b,"style",f)),i.flip&&n("setFlip",{id:b,panelId:r.panelId,flip:i.flip})})}};function Gs(e,t,n,o){return{id:t,panelId:e,key:n,value:o}}const Ec=ys(),Nt=va("panels/setTextBoxProperty"),yS=ee({components:{Toggle:Rt,DFieldset:Ht,ObjectTool:Ao,DFlow:vs},mixins:[st],data:()=>({textEditor:"",colorSelect:""}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},customizable(){return this.textBoxStyle.startsWith("custom")},nameboxWidthDefault(){return Y().TextBox.NameboxWidth},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="textBox")return e},textHandler(){if(!!this.textEditor)return{title:this.textEditorName,get:()=>this.textEditor==="name"?this.object.talkingOther:this.textEditor==="body"?this.dialog:"",set:e=>{this.textEditor==="name"?this.talkingOther=e:this.textEditor==="body"&&(this.dialog=e)},leave:()=>{this.textEditor=""}}},colorHandler(){if(!!this.colorSelect)return{title:this.colorName,get:()=>{switch(this.colorSelect){case"":return"#000000";case"base":return this.object.customColor;case"controls":return this.object.customControlsColor;case"namebox":return this.object.customNameboxColor;case"nameboxStroke":return this.object.customNameboxStroke;default:throw new At.UnreachableCaseError(this.colorSelect)}},set:e=>{this.vuexHistory.transaction(()=>{const t=this.currentPanel.id,n=this.object.id;let o={base:"customColor",controls:"customControlsColor",namebox:"customNameboxColor",nameboxStroke:"customNameboxStroke","":void 0}[this.colorSelect];e!==void 0&&this.$store.commit("panels/setTextBoxProperty",Gs(t,n,o,e))})},leave:()=>{this.colorSelect=""}}},talkingObjId:{get(){var e;return(e=this.object.talkingObjId)!=null?e:"$null$"},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setTalkingObject",{id:this.object.id,panelId:this.object.panelId,talkingObjId:e==="$null$"?null:e})})}},talkingOther:Ec("talkingOther","panels/setTalkingOther"),textBoxStyle:Ec("style","panels/setStyle",!0),showControls:Nt("controls"),allowSkipping:Nt("skip"),autoQuoting:Nt("autoQuoting"),autoWrap:Nt("autoWrap"),showContinueArrow:Nt("continue"),dialog:Nt("text"),overrideColor:Nt("overrideColor"),deriveCustomColors:Nt("deriveCustomColors"),customNameboxWidth:Nt("customNameboxWidth"),nameList(){const e=this.currentPanel,t=[];for(const n of[...e.order,...e.onTopOrder]){const o=e.objects[n];o.label!==null&&t.push([n,o.label])}return t},textEditorName(){return this.textEditor==="name"?"Name":this.textEditor==="body"?"Dialog":""},customControlsColor(){return this.object.customControlsColor},colorName(){switch(this.colorSelect){case"":return"";case"base":return"Base color";case"controls":return"Controls color";case"namebox":return"Namebox color";case"nameboxStroke":return"Namebox text stroke";default:throw new At.UnreachableCaseError(this.colorSelect)}}},methods:{splitTextbox(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/splitTextbox",{id:this.object.id,panelId:this.object.panelId})})},resetPosition(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/resetTextboxBounds",{id:this.object.id,panelId:this.object.panelId})})},jumpToCharacter(){this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",this.talkingObjId)})}}});const qe=e=>(ze("data-v-bee2c661"),e=e(),Ge(),e),_S={class:"upper-combos"},wS=qe(()=>u("td",null,[u("label",{for:"text_style"},"Style:")],-1)),$S={colspan:"2"},CS=qe(()=>u("option",{value:"normal"},"Normal",-1)),PS=qe(()=>u("option",{value:"corrupt"},"Corrupt",-1)),SS=qe(()=>u("option",{value:"custom"},"Custom",-1)),kS=qe(()=>u("option",{value:"custom_plus"},"Custom (Plus)",-1)),OS=qe(()=>u("option",{value:"none"},"None",-1)),xS=[CS,PS,SS,kS,OS],jS=qe(()=>u("td",null,[u("label",{for:"current_talking"},"Person talking:")],-1)),IS=qe(()=>u("option",{value:"$null$"},"No-one",-1)),TS=["value"],ES=qe(()=>u("option",{value:"$other$"},"Other",-1)),BS=["disabled"],AS=qe(()=>u("td",null,[u("label",{for:"custom_name"},"Other name:")],-1)),DS={id:"dialog_text_wrapper"},RS=qe(()=>u("label",{for:"dialog_text"},"Dialog:",-1)),HS={key:0},MS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_width"},"Namebox width:")],-1)),FS=["placeholder","disabled"],NS={colspan:"2"},LS={key:0},US=qe(()=>u("td",null,[u("label",{for:"textbox_color"},"Color:")],-1)),VS={key:1},WS={colspan:"2"},zS=qe(()=>u("td",null,[u("label",{for:"custom_controls_color"},"Controls Color:")],-1)),GS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_color"},"Namebox Color:")],-1)),qS=qe(()=>u("td",null,[u("label",{for:"custom_namebox_stroke"},"Namebox text stroke:")],-1));function XS(e,t,n,o,s,r){const i=E("toggle"),a=E("d-flow"),l=E("d-fieldset"),d=E("object-tool");return g(),L(d,{object:e.object,title:"Textbox",textHandler:e.textHandler,colorHandler:e.colorHandler},{default:B(()=>[u("table",_S,[u("tr",null,[wS,u("td",$S,[de(u("select",{id:"text_style","onUpdate:modelValue":t[0]||(t[0]=c=>e.textBoxStyle=c),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},xS,544),[[_t,e.textBoxStyle]])])]),u("tr",null,[jS,u("td",null,[de(u("select",{id:"current_talking","onUpdate:modelValue":t[2]||(t[2]=c=>e.talkingObjId=c),onKeydown:t[3]||(t[3]=G(()=>{},["stop"]))},[IS,(g(!0),y(U,null,Ce(e.nameList,([c,p])=>(g(),y("option",{key:c,value:c},fe(p),9,TS))),128)),ES],544),[[_t,e.talkingObjId]])]),u("td",null,[u("button",{title:"Jump to talking character",onClick:t[4]||(t[4]=(...c)=>e.jumpToCharacter&&e.jumpToCharacter(...c)),disabled:e.talkingObjId==="$null$"||e.talkingObjId==="$other$"}," > ",8,BS)])]),u("tr",null,[AS,u("td",null,[de(u("input",{id:"custom_name","onUpdate:modelValue":t[5]||(t[5]=c=>e.talkingOther=c),onKeydown:t[6]||(t[6]=G(()=>{},["stop"]))},null,544),[[Ee,e.talkingOther]])]),u("td",null,[u("button",{onClick:t[7]||(t[7]=c=>e.textEditor="name")},"...")])])]),C(i,{label:"Auto quoting?",modelValue:e.autoQuoting,"onUpdate:modelValue":t[8]||(t[8]=c=>e.autoQuoting=c)},null,8,["modelValue"]),C(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[9]||(t[9]=c=>e.autoWrap=c)},null,8,["modelValue"]),u("div",DS,[RS,de(u("textarea",{"onUpdate:modelValue":t[10]||(t[10]=c=>e.dialog=c),id:"dialog_text",onKeydown:t[11]||(t[11]=G(()=>{},["stop"]))},null,544),[[Ee,e.dialog]]),u("button",{onClick:t[12]||(t[12]=c=>e.textEditor="body")},"Formatting")])]),options:B(()=>[C(l,{title:"Customization:",class:pe(e.customizable?"customization-set":"")},{default:B(()=>[C(a,{direction:"vertical",maxSize:"100%","no-wraping":""},{default:B(()=>[C(i,{label:"Controls visible?",modelValue:e.showControls,"onUpdate:modelValue":t[13]||(t[13]=c=>e.showControls=c)},null,8,["modelValue"]),C(i,{label:"Able to skip?",modelValue:e.allowSkipping,"onUpdate:modelValue":t[14]||(t[14]=c=>e.allowSkipping=c)},null,8,["modelValue"]),C(i,{label:"Continue arrow?",modelValue:e.showContinueArrow,"onUpdate:modelValue":t[15]||(t[15]=c=>e.showContinueArrow=c)},null,8,["modelValue"]),e.customizable?(g(),y("table",HS,[u("tr",null,[MS,u("td",null,[de(u("input",{id:"custom_namebox_width",type:"number",style:{width:"48px"},placeholder:e.nameboxWidthDefault,"onUpdate:modelValue":t[16]||(t[16]=c=>e.customNameboxWidth=c),disabled:e.overrideColor,onKeydown:t[17]||(t[17]=G(()=>{},["stop"]))},null,40,FS),[[Ee,e.customNameboxWidth,void 0,{number:!0}]])])]),u("tr",null,[u("td",NS,[C(i,{modelValue:e.overrideColor,"onUpdate:modelValue":t[18]||(t[18]=c=>e.overrideColor=c),label:"Override color"},null,8,["modelValue"])])]),e.overrideColor?(g(),y("tr",LS,[US,u("td",null,[u("button",{id:"textbox_color",class:"color-button",style:Re({background:e.object.customColor}),onClick:t[19]||(t[19]=c=>e.colorSelect="base")},null,4)])])):X("",!0),e.overrideColor?(g(),y("tr",VS,[u("td",WS,[C(i,{id:"derive_custom_colors",modelValue:e.deriveCustomColors,"onUpdate:modelValue":t[20]||(t[20]=c=>e.deriveCustomColors=c),label:"Derive other colors"},null,8,["modelValue"])])])):X("",!0),e.overrideColor&&!e.deriveCustomColors?(g(),y(U,{key:2},[u("tr",null,[zS,u("td",null,[u("button",{id:"custom_controls_color",class:"color-button",style:Re({background:e.object.customControlsColor}),onClick:t[21]||(t[21]=c=>e.colorSelect="controls")},null,4)])]),u("tr",null,[GS,u("td",null,[u("button",{id:"custom_namebox_color",class:"color-button",style:Re({background:e.object.customNameboxColor}),onClick:t[22]||(t[22]=c=>e.colorSelect="namebox")},null,4)])]),u("tr",null,[qS,u("td",null,[u("button",{id:"custom_namebox_stroke",class:"color-button",style:Re({background:e.object.customNameboxStroke}),onClick:t[23]||(t[23]=c=>e.colorSelect="nameboxStroke")},null,4)])])],64)):X("",!0)])):X("",!0)]),_:1})]),_:1},8,["class"]),u("button",{onClick:t[24]||(t[24]=(...c)=>e.resetPosition&&e.resetPosition(...c))},"Reset position"),u("button",{onClick:t[25]||(t[25]=(...c)=>e.splitTextbox&&e.splitTextbox(...c))},"Split textbox")]),_:1},8,["object","textHandler","colorHandler"])}const KS=ne(yS,[["render",XS],["__scopeId","data-v-bee2c661"]]),YS=ys(),JS=ee({mixins:[st],components:{Toggle:Rt,DFieldset:Ht,DFlow:vs,ObjectTool:Ao},data:()=>({currentIdx:0,textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="choice")return e},autoWrap:YS("autoWrap","panels/setAutoWrapping"),buttonText:ZS("text"),buttons(){return this.object.choices},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.buttonText,set:e=>{this.buttonText=e},leave:()=>{this.textEditor=!1}}}},methods:{select(e){this.currentIdx=e},addChoice(){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/addChoice",{id:this.object.id,panelId:this.object.panelId,text:""})})},removeChoice(){this.vuexHistory.transaction(()=>{this.currentIdx===this.object.choices.length-1&&this.currentIdx>0&&this.select(this.currentIdx-1),this.$store.dispatch("panels/removeChoice",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx})})}}});function ZS(e){return{get(){return this.object.choices[this.currentIdx][e]},set(t){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setChoiceProperty",{id:this.object.id,panelId:this.object.panelId,choiceIdx:this.currentIdx,key:e,value:t})})}}}const QS=e=>(ze("data-v-bdedda57"),e=e(),Ge(),e),ek=["onClick"],tk=QS(()=>u("tr",null,[u("td",{colspan:"2"},[u("label",{for:"choice-button-input"},"Text")])],-1));function nk(e,t,n,o,s,r){const i=E("d-flow"),a=E("d-fieldset"),l=E("toggle"),d=E("object-tool");return g(),L(d,{object:e.object,title:"Choice",textHandler:e.textHandler},{default:B(()=>[C(a,{class:"buttons",title:"Buttons:"},{default:B(()=>[C(i,{maxSize:"100%",direction:"vertical",noWraping:""},{default:B(()=>[(g(!0),y(U,null,Ce(e.buttons,(c,p)=>(g(),y("div",{class:pe({choiceBtn:!0,active:p===e.currentIdx}),key:p,onClick:f=>e.select(p)},fe(c.text.trim()===""?"[Empty]":c.text),11,ek))),128))]),_:1})]),_:1}),C(a,{class:"current_button",title:"Current button:"},{default:B(()=>[u("table",null,[tk,u("tr",null,[u("td",null,[de(u("input",{id:"choice-button-input","onUpdate:modelValue":t[0]||(t[0]=c=>e.buttonText=c),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Ee,e.buttonText]])]),u("td",null,[u("button",{onClick:t[2]||(t[2]=c=>e.textEditor=!0)},"...")])])])]),_:1}),u("button",{onClick:t[3]||(t[3]=(...c)=>e.addChoice&&e.addChoice(...c))},"Add"),u("button",{onClick:t[4]||(t[4]=(...c)=>e.removeChoice&&e.removeChoice(...c))},"Remove"),C(l,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[5]||(t[5]=c=>e.autoWrap=c)},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const ok=ne(JS,[["render",nk],["__scopeId","data-v-bdedda57"]]),sk=ee({mixins:[st],components:{L:Zl}});const Qt=e=>(ze("data-v-8073b468"),e=e(),Ge(),e),rk={class:"panel"},ik=Qt(()=>u("h1",null,"Help and Credits",-1)),lk=Qt(()=>u("p",null," All assets used are IP of Team Salvato and created by them, unless noted otherwise. ",-1)),ak=Qt(()=>u("p",null,[O(" Doki Doki Dialog Generator developed by EDave64 "),u("br"),O("Based on gemdude46's DDLC Shitpost generator ")],-1)),dk=Qt(()=>u("p",null,[O(" MC Sprite by Childish-N "),u("br"),O("MC Casual Sprite by SlightlySimple "),u("br"),O("MC Chibi by SlightlySimple ")],-1)),ck=Qt(()=>u("p",null,[O(" MC Chad Sprite by Cylent-Nite "),u("br"),O("MC Chad Poses and expressions by SlightlySimple "),u("br"),O("MC Chad Poses and chibi by Meddy-sin ")],-1)),uk=Qt(()=>u("p",null,[O(" FeMC Sprite by Meddy-sin "),u("br"),O("FeMC Casual Sprite by SlightlySimple ")],-1)),pk=Qt(()=>u("p",null,"Amy Sprite by Meddy-sin and SlightlySimple",-1)),fk=Qt(()=>u("p",null,"Special thanks to SlightlySimple for testing and technical help",-1)),hk=Qt(()=>u("p",null," Atlas421, T-Rex Harris, smearglexd and Tactical Cupcakes for suggestions and testing ",-1));function gk(e,t,n,o,s,r){const i=E("l");return g(),y("div",rk,[ik,C(i,{class:"btn",to:"wiki://Dokumentation"},{default:B(()=>[O("Help")]),_:1}),C(i,{class:"btn",to:"github://"},{default:B(()=>[O("Fork me on GitHub")]),_:1}),C(i,{class:"btn",to:"wiki://Privacy Statement"},{default:B(()=>[O("Privacy Statement")]),_:1}),lk,ak,u("p",null,[O(" Unused House Background by "),C(i,{to:"https://www.deviantart.com/fatelogic/art/VN-Background-Practice-295671161"},{default:B(()=>[O(" Fatelogic ")]),_:1})]),u("p",null,[O(" Aller Font by "),C(i,{to:"https://www.daltonmaag.com/library/aller"},{default:B(()=>[O("Dalton Maag Ltd")]),_:1})]),u("p",null,[O(" Riffic Bold Font by "),C(i,{to:"https://www.fontspring.com/fonts/inky-type/riffic"},{default:B(()=>[O("InkyType")]),_:1})]),u("p",null,[O(" Verily Serif Mono Font by "),C(i,{to:"https://www.dafont.com/verily-serif-mono.font"},{default:B(()=>[O("Stephen G. Hartke")]),_:1})]),u("p",null,[O(" F25 Bank Printer Font by "),C(i,{to:"https://www.dafont.com/f25-bank-printer.font"},{default:B(()=>[O("F25 Digital Typeface Design")]),_:1})]),u("p",null,[O(" Journal Font by "),C(i,{to:"https://www.dafont.com/journal.font"},{default:B(()=>[O("Fontourist")]),_:1})]),u("p",null,[O(" Hashtag Font by "),C(i,{to:"https://www.dafont.com/hashtag.font"},{default:B(()=>[O(" TitanVex")]),_:1})]),u("p",null,[O(" JP Hand Slanted Font by "),C(i,{to:"https://www.dafont.com/jp-hand-slanted.font"},{default:B(()=>[O("Jonathan Paterson")]),_:1})]),u("p",null,[O(" As I Lay Dying Font by "),C(i,{to:"https://www.dafont.com/as-i-lay-dying.font"},{default:B(()=>[O("Moises Esqueda")]),_:1})]),u("p",null,[O(" Damagrafik Script Font by "),C(i,{to:"https://www.dafont.com/damagrafik-script.font"},{default:B(()=>[O("Davide Terenzi")]),_:1})]),u("p",null,[O(" Ammy's Handwriting Font by "),C(i,{to:"https://www.dafont.com/ammys-handwriting.font"},{default:B(()=>[O("Ammy K.")]),_:1})]),u("p",null,[O(" Halogen Font by "),C(i,{to:"https://www.dafont.com/halogen.font"},{default:B(()=>[O("JLH Fonts")]),_:1})]),dk,u("p",null,[C(i,{to:"https://www.reddit.com/ofkg59"},{default:B(()=>[O("Concept MC")]),_:1}),O(" by StormBlazed76, "),C(i,{to:"https://www.reddit.com/og6shh"},{default:B(()=>[O("red")]),_:1}),O(" and "),C(i,{to:"https://www.reddit.com/oft3vb"},{default:B(()=>[O("yellow")]),_:1}),O(" eyes by YinuS_WinneR, "),C(i,{to:"https://www.reddit.com/ofof3o"},{default:B(()=>[O("chibi")]),_:1}),O(" by Hadrosaur838 ")]),ck,uk,u("p",null,[C(i,{to:"https://www.reddit.com/oizaow"},{default:B(()=>[O("Concept FeMC")]),_:1}),O(" by ShidoDraws, "),C(i,{to:"https://www.reddit.com/oosuxu"},{default:B(()=>[O("additional poses, expressions and chibi")]),_:1}),O(" by SlightlySimple ")]),pk,fk,hk])}const mk=ne(sk,[["render",gk],["__scopeId","data-v-8073b468"]]),bk=ee({props:{backgroundId:{type:String,required:!0}},data:()=>({isWebPSupported:null,assets:[]}),computed:{background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.getters["content/getBackgrounds"].get(this.backgroundId)||null},isActive(){return this.backgroundId===this.background.current},title(){var e;switch(this.backgroundId){case"buildin.static-color":return"Static color";case"buildin.transparent":return"Transparent"}return(e=this.bgData.label)!=null?e:""},style(){var e;switch(this.backgroundId){case"buildin.static-color":return{"background-color":this.background.color};case"buildin.transparent":return{}}const t=(e=this.bgData)==null?void 0:e.variants[0].map(n=>`url('${Mn(n,!1)}')`).join(",");return{backgroundImage:t!=null?t:""}}}});const vk=["title"];function yk(e,t,n,o,s,r){return g(),y("div",{class:pe({background:!0,active:e.isActive}),title:e.title,style:Re(e.style),tabindex:"0",onClick:t[0]||(t[0]=i=>e.$emit("input",e.backgroundId)),onKeydown:[t[1]||(t[1]=Le(i=>e.$emit("input",e.backgroundId),["enter"])),t[2]||(t[2]=Le(G(i=>e.$emit("input",e.backgroundId),["prevent"]),["space"]))]},fe(e.title),47,vk)}const _k=ne(bk,[["render",yk],["__scopeId","data-v-e727d6d8"]]),wk=ee({components:{Toggle:Rt,DFieldset:Ht},computed:{vertical(){return this.$store.state.ui.vertical},color:{get(){return this.background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},flipped:{get(){return this.background.flipped},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundFlipped",{flipped:e,panelId:this.$store.state.panels.currentPanel})})}},scaling:{get(){return this.background.scaling.toString()},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundScaling",{scaling:parseInt(e,10),panelId:this.$store.state.panels.currentPanel})})}},currentBackgroundId(){return this.background.current},background(){const e=this.$store.state.panels.currentPanel;return this.$store.state.panels.panels[e].background},bgData(){return this.$store.state.content.current.backgrounds.find(e=>e.id===this.currentBackgroundId)||null},isColor(){return this.currentBackgroundId==="buildin.static-color"},isVariant(){return!!this.bgData},hasVariants(){return this.bgData?this.bgData.variants.length>1:!1}},methods:{seekVariant(e){this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/seekBackgroundVariant",{delta:e,panelId:this.$store.state.panels.currentPanel})})}}});const Ss=e=>(ze("data-v-41fa88c5"),e=e(),Ge(),e),$k=Ss(()=>u("label",{for:"bg_color"},"Color:",-1)),Ck={key:1},Pk={colspan:"3"},Sk={key:0},kk={class:"arrow-col"},Ok=Ss(()=>u("td",{style:{"text-align":"center"}},"Variant",-1)),xk={class:"arrow-col"},jk={colspan:"3"},Ik=Ss(()=>u("option",{value:"0"},"None",-1)),Tk=Ss(()=>u("option",{value:"1"},"Stretch",-1)),Ek=Ss(()=>u("option",{value:"2"},"Cover",-1)),Bk=[Ik,Tk,Ek],Ak={colspan:"3"};function Dk(e,t,n,o,s,r){const i=E("toggle"),a=E("d-fieldset");return g(),L(a,{class:pe({"bg-settings":!0,vertical:e.vertical}),title:"Settings:"},{default:B(()=>[e.isColor?(g(),y(U,{key:0},[$k,u("button",{id:"bg_color",class:"color-button",style:Re({background:e.color}),onClick:t[0]||(t[0]=l=>e.$emit("change-color"))},null,4)],64)):X("",!0),e.isVariant?(g(),y("table",Ck,[u("tr",null,[u("td",Pk,[C(i,{modelValue:e.flipped,"onUpdate:modelValue":t[1]||(t[1]=l=>e.flipped=l),label:"Flipped?"},null,8,["modelValue"])])]),e.hasVariants?(g(),y("tr",Sk,[u("td",kk,[u("button",{class:"small-button",onClick:t[2]||(t[2]=l=>e.seekVariant(-1))},"<")]),Ok,u("td",xk,[u("button",{class:"small-button",onClick:t[3]||(t[3]=l=>e.seekVariant(1))},">")])])):X("",!0),u("tr",null,[u("td",jk,[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.scaling=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},Bk,544),[[_t,e.scaling]])])]),u("tr",null,[u("td",Ak,[u("button",{id:"image_options_button",onClick:t[6]||(t[6]=l=>e.$emit("open-image-options"))}," Image options ")])])])):X("",!0)]),_:1},8,["class"])}const Rk=ne(wk,[["render",Dk],["__scopeId","data-v-41fa88c5"]]);var Hk=Object.defineProperty,Mk=Object.defineProperties,Fk=Object.getOwnPropertyDescriptors,Bc=Object.getOwnPropertySymbols,Nk=Object.prototype.hasOwnProperty,Lk=Object.prototype.propertyIsEnumerable,Ac=(e,t,n)=>t in e?Hk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Uk=(e,t)=>{for(var n in t||(t={}))Nk.call(t,n)&&Ac(e,n,t[n]);if(Bc)for(var n of Bc(t))Lk.call(t,n)&&Ac(e,n,t[n]);return e},Vk=(e,t)=>Mk(e,Fk(t)),Dc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Ci={packId:"dddg.uploads.backgrounds",dependencies:[],packCredits:[],characters:[],fonts:[],sprites:[],poemStyles:[],poemBackgrounds:[],backgrounds:[],colors:[]},Wk=ee({mixins:[st],components:{BackgroundButton:_k,BackgroundSettings:Rk,DropTarget:Op,Color:Gr,ImageOptions:$a,DButton:Ln},data:()=>({colorSelect:!1,imageOptions:!1}),computed:{bgColor:{get(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel].background.color},set(e){this.vuexHistory.transaction(()=>{this.$store.commit("panels/setBackgroundColor",{color:e,panelId:this.$store.state.panels.currentPanel})})}},backgrounds(){return[...this.$store.state.content.current.backgrounds.map(e=>e.id),"buildin.static-color","buildin.transparent"]},showBackgroundsFolder(){return q.supports.openableFolders.has("backgrounds")}},methods:{setBackground(e){this.$store.commit("panels/setCurrentBackground",{current:e,panelId:this.$store.state.panels.currentPanel})},onFileUpload(e){const t=this.$refs.upload;if(!!t.files)for(const n of t.files)this.addImageFile(n)},addImageFile(e){return Dc(this,null,function*(){yield this.vuexHistory.transaction(()=>Dc(this,null,function*(){const t=URL.createObjectURL(e),n=yield this.$store.dispatch("uploadUrls/add",{name:e.name,url:t});this.addNewCustomBackground(e.name,e.name,n)}))})},addByUrl(){const e=prompt("Enter the URL of the image");if(e==null)return;const t=e.split("/").slice(-1)[0];this.addNewCustomBackground(t,t,e)},addNewCustomBackground(e,t,n){const o=this.$store.state.content.contentPacks.find(r=>r.packId===Ci.packId)||Ci,s=Vk(Uk({},o),{backgrounds:[...o.backgrounds,{id:e,label:t,variants:[[{hq:n,lq:n,sourcePack:Ci.packId}]],scaling:"none"}]});this.vuexHistory.transaction(()=>{this.$store.dispatch("content/replaceContentPack",{contentPack:s,processed:!0}),this.setBackground(e)})},dragEnter(e){!e.dataTransfer||(e.dataTransfer.effectAllowed="none",Array.from(e.dataTransfer.items).find(t=>t.type.match(/^image.*$/))&&(e.dataTransfer.effectAllowed="link",this.$refs.dt.show()))},openBackgroundFolder(){q.openFolder("backgrounds")}}});const If=e=>(ze("data-v-abffc988"),e=e(),Ge(),e),zk=If(()=>u("h1",null,"Background",-1)),Gk=If(()=>u("i",{class:"material-icons"},"extension",-1));function qk(e,t,n,o,s,r){const i=E("drop-target"),a=E("color"),l=E("image-options"),d=E("background-settings"),c=E("d-button"),p=E("background-button");return g(),y("div",{class:"panel",onDragenter:t[9]||(t[9]=(...f)=>e.dragEnter&&e.dragEnter(...f)),onMouseleave:t[10]||(t[10]=f=>e.$refs.dt.hide())},[C(i,{ref:"dt",class:"drop-target",onDrop:e.addImageFile},{default:B(()=>[O("Drop here to add as a new background ")]),_:1},8,["onDrop"]),zk,e.colorSelect?(g(),L(a,{key:0,modelValue:e.bgColor,"onUpdate:modelValue":t[0]||(t[0]=f=>e.bgColor=f),onLeave:t[1]||(t[1]=f=>e.colorSelect=!1)},null,8,["modelValue"])):e.imageOptions?(g(),L(l,{key:1,type:"background",title:"","panel-id":e.$store.state.panels.currentPanel,"no-composition":"",onLeave:t[2]||(t[2]=f=>e.imageOptions=!1)},null,8,["panel-id"])):(g(),y(U,{key:2},[C(d,{onChangeColor:t[3]||(t[3]=f=>e.colorSelect=!0),onOpenImageOptions:t[4]||(t[4]=f=>e.imageOptions=!0)}),u("button",{class:"btn upload-background",onClick:t[6]||(t[6]=f=>e.$refs.upload.click())},[O(" Upload "),u("input",{type:"file",ref:"upload",onChange:t[5]||(t[5]=(...f)=>e.onFileUpload&&e.onFileUpload(...f))},null,544)]),u("button",{class:"upload-background",onClick:t[7]||(t[7]=(...f)=>e.addByUrl&&e.addByUrl(...f))},"Add by URL"),u("button",{class:"upload-background",onClick:t[8]||(t[8]=f=>e.$emit("show-dialog","type: Backgrounds"))},[Gk,O(" Search in content packs ")]),e.showBackgroundsFolder?(g(),L(c,{key:0,icon:"folder",class:"upload-background",onClick:e.openBackgroundFolder},{default:B(()=>[O(" Open backgrounds folder ")]),_:1},8,["onClick"])):X("",!0),(g(!0),y(U,null,Ce(e.backgrounds,f=>(g(),L(p,{key:f,backgroundId:f,onInput:b=>e.setBackground(f)},null,8,["backgroundId","onInput"]))),128))],64))],32)}const Xk=ne(Wk,[["render",qk],["__scopeId","data-v-abffc988"]]);var Kk=Object.defineProperty,Yk=Object.defineProperties,Jk=Object.getOwnPropertyDescriptors,Rc=Object.getOwnPropertySymbols,Zk=Object.prototype.hasOwnProperty,Qk=Object.prototype.propertyIsEnumerable,Hc=(e,t,n)=>t in e?Kk(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,eO=(e,t)=>{for(var n in t||(t={}))Zk.call(t,n)&&Hc(e,n,t[n]);if(Rc)for(var n of Rc(t))Qk.call(t,n)&&Hc(e,n,t[n]);return e},tO=(e,t)=>Yk(e,Jk(t)),nO=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const oO={},sO={createSprite(e,t){return nO(this,arguments,function*({commit:n,rootState:o,state:s},r){const i=yield Er(r.assets[0],!1);if(!(i instanceof Xl))return;const a=s.panels[r.panelId].lastObjId+1;return n("create",{object:tO(eO({},Io()),{assets:r.assets,height:i.height,width:i.width,id:a,panelId:o.panels.currentPanel,onTop:!1,preserveRatio:!0,ratio:i.width/i.height,type:"sprite",y:0,enlargeWhenTalking:o.ui.defaultCharacterTalkingZoom})}),a})}};var rO=Object.defineProperty,iO=Object.defineProperties,lO=Object.getOwnPropertyDescriptors,Mc=Object.getOwnPropertySymbols,aO=Object.prototype.hasOwnProperty,dO=Object.prototype.propertyIsEnumerable,Fc=(e,t,n)=>t in e?rO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,cO=(e,t)=>{for(var n in t||(t={}))aO.call(t,n)&&Fc(e,n,t[n]);if(Mc)for(var n of Mc(t))dO.call(t,n)&&Fc(e,n,t[n]);return e},uO=(e,t)=>iO(e,lO(t));const pO={setChoicesProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version},setChoiceProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n.choices[t.choiceIdx][t.key]=t.value,++n.version},setChoices(e,t){const n=e.panels[t.panelId].objects[t.id];n.choices=t.choices,++n.version}},fO={createChoice({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:uO(cO({},Io()),{y:s.Choices.ChoiceY,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,id:r,onTop:!0,autoWrap:!0,type:"choice",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,choiceDistance:s.Choices.ChoiceSpacing,choices:[{selected:!1,text:"Click here to edit choice"}],customColor:s.Choices.ChoiceButtonColor})}),r},addChoice({state:e,commit:t},n){const o=e.panels[n.panelId].objects[n.id];t("setChoices",{id:n.id,panelId:n.panelId,choices:[...o.choices,{selected:!1,text:n.text}]})},removeChoice({state:e,commit:t},n){const s=[...e.panels[n.panelId].objects[n.id].choices];s.splice(n.choiceIdx,1),s.length===0&&s.push({selected:!1,text:""}),t("setChoices",{id:n.id,panelId:n.panelId,choices:s})}};var hO=Object.defineProperty,gO=Object.defineProperties,mO=Object.getOwnPropertyDescriptors,Nc=Object.getOwnPropertySymbols,bO=Object.prototype.hasOwnProperty,vO=Object.prototype.propertyIsEnumerable,Lc=(e,t,n)=>t in e?hO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yO=(e,t)=>{for(var n in t||(t={}))bO.call(t,n)&&Lc(e,n,t[n]);if(Nc)for(var n of Nc(t))vO.call(t,n)&&Lc(e,n,t[n]);return e},_O=(e,t)=>gO(e,mO(t));const wO={setNotificationProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},$O={createNotification({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:_O(yO({},Io()),{y:s.Base.screenHeight/2,width:s.Choices.ChoiceButtonWidth,height:0,panelId:t.panels.currentPanel,autoWrap:!1,id:r,onTop:!0,type:"notification",preserveRatio:!1,ratio:s.TextBox.TextBoxWidth/s.TextBox.TextBoxHeight,customColor:s.Choices.ChoiceButtonColor,text:"Click here to edit notification",backdrop:!0})}),r}};var CO=Object.defineProperty,PO=Object.defineProperties,SO=Object.getOwnPropertyDescriptors,Uc=Object.getOwnPropertySymbols,kO=Object.prototype.hasOwnProperty,OO=Object.prototype.propertyIsEnumerable,Vc=(e,t,n)=>t in e?CO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,xO=(e,t)=>{for(var n in t||(t={}))kO.call(t,n)&&Vc(e,n,t[n]);if(Uc)for(var n of Uc(t))OO.call(t,n)&&Vc(e,n,t[n]);return e},jO=(e,t)=>PO(e,SO(t));const IO={setPoemProperty(e,t){const n=e.panels[t.panelId].objects[t.id];n[t.key]=t.value,++n.version}},TO={createPoem({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:{subType:"poem",x:s.Poem.defaultX,y:s.Poem.defaultY,width:s.Poem.defaultPoemWidth,height:s.Poem.defaultPoemHeight,panelId:t.panels.currentPanel,flip:!1,rotation:0,id:r,onTop:!0,opacity:100,type:"poem",version:0,preserveRatio:!1,autoWrap:!0,ratio:s.Poem.defaultPoemWidth/s.Poem.defaultPoemHeight,background:s.Poem.defaultPoemBackground,font:s.Poem.defaultPoemStyle,text:`New poem

Click here to edit poem`,composite:"source-over",filters:[],label:null,textboxColor:null,enlargeWhenTalking:!0,nameboxWidth:null,zoom:1}}),r},createConsole({commit:e,rootState:t,state:n},o){const s=Y(),r=n.panels[o.panelId].lastObjId+1;return e("create",{object:jO(xO({},Io()),{subType:"console",x:s.Poem.consoleWidth/2,y:s.Poem.consoleHeight/2,width:s.Poem.consoleWidth,height:s.Poem.consoleHeight,panelId:t.panels.currentPanel,id:r,onTop:!0,type:"poem",preserveRatio:!1,ratio:s.Poem.consoleWidth/s.Poem.consoleHeight,background:s.Poem.defaultConsoleBackground,font:s.Poem.defaultConsoleStyle,text:`> _
  
  Console command
  Click here to edit`,autoWrap:!0})}),r}};var EO=Object.defineProperty,BO=Object.defineProperties,AO=Object.getOwnPropertyDescriptors,Wc=Object.getOwnPropertySymbols,DO=Object.prototype.hasOwnProperty,RO=Object.prototype.propertyIsEnumerable,zc=(e,t,n)=>t in e?EO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Ye=(e,t)=>{for(var n in t||(t={}))DO.call(t,n)&&zc(e,n,t[n]);if(Wc)for(var n of Wc(t))RO.call(t,n)&&zc(e,n,t[n]);return e},Gc=(e,t)=>BO(e,AO(t));const HO=Ye(Ye(Ye(Ye(Ye(Ye({create(e,{object:t}){const n=e.panels[t.panelId];t.id>n.lastObjId&&(n.lastObjId=t.id),n.objects[t.id]=t,(t.onTop?n.onTopOrder:n.order).push(t.id)},removeFromList(e,t){const n=e.panels[t.panelId],o=t.onTop?n.onTopOrder:n.order,s=o.indexOf(t.id);o.splice(s,1)},addToList(e,t){const n=e.panels[t.panelId];(t.onTop?n.onTopOrder:n.order).splice(t.position,0,t.id)},setOnTop(e,t){const o=e.panels[t.panelId].objects[t.id];o.onTop=t.onTop},setPosition(e,t){const o=e.panels[t.panelId].objects[t.id];o.x=t.x,o.y=t.y},setFlip(e,t){const o=e.panels[t.panelId].objects[t.id];o.flip=t.flip},setSize(e,t){const o=e.panels[t.panelId].objects[t.id];o.width=t.width,o.height=t.height},setRatio(e,t){const o=e.panels[t.panelId].objects[t.id];o.preserveRatio=t.preserveRatio,o.ratio=t.ratio},setRotation(e,t){const o=e.panels[t.panelId].objects[t.id];o.rotation=t.rotation<0?360-Math.abs(t.rotation)%360:t.rotation%360},removeObject(e,t){const n=e.panels[t.panelId];delete n.objects[t.id]},setComposition(e,t){const o=e.panels[t.panelId].objects[t.id];o.composite=t.composite},object_setFilters(e,t){const o=e.panels[t.panelId].objects[t.id];o.filters=t.filters},setLabel(e,t){const o=e.panels[t.panelId].objects[t.id];o.label=t.label},setTextboxColor(e,t){const o=e.panels[t.panelId].objects[t.id];o.textboxColor=t.textboxColor},setEnlargeWhenTalking(e,t){const o=e.panels[t.panelId].objects[t.id];o.enlargeWhenTalking=t.enlargeWhenTalking,++o.version},setObjectNameboxWidth(e,t){const o=e.panels[t.panelId].objects[t.id];o.nameboxWidth=t.nameboxWidth,++o.version},setObjectZoom(e,t){const o=e.panels[t.panelId].objects[t.id];o.zoom=t.zoom,++o.version}},oO),p$),bS),pO),wO),IO),MO=Ye(Ye(Ye(Ye(Ye(Ye({removeObject({state:e,commit:t,rootState:n},o){var s;const r=e.panels[o.panelId],i=r.objects[o.id];n.ui.selection===o.id&&t("ui/setSelection",null,{root:!0});for(const a of[...r.onTopOrder,...r.order]){const l=r.objects[a];i.id===a||l.type!=="textBox"||l.talkingObjId===i.id&&t("setTalkingOther",{id:l.id,talkingOther:(s=i.label)!=null?s:"",panelId:o.panelId})}t("removeFromList",{id:o.id,panelId:o.panelId,onTop:i.onTop}),t("removeObject",{id:o.id,panelId:o.panelId})},setPosition({state:e,commit:t,dispatch:n},o){e.panels[o.panelId].objects[o.id].type==="character"?n("setCharacterPosition",o):t("setPosition",o)},setOnTop({state:e,commit:t},n){const o=e.panels[n.panelId],s=o.objects[n.id];s.onTop!==n.onTop&&(t("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),t("addToList",{id:n.id,panelId:n.panelId,position:(n.onTop?o.onTopOrder:o.order).length,onTop:n.onTop}),t("setOnTop",{panelId:n.panelId,id:n.id,onTop:n.onTop}))},shiftLayer({state:e,commit:t},n){const o=e.panels[n.panelId],s=o.objects[n.id],r=s.onTop?o.onTopOrder:o.order;let a=r.indexOf(s.id)+n.delta;a<0&&(a=0),a>r.length&&(a=r.length),t("removeFromList",{panelId:n.panelId,id:n.id,onTop:s.onTop}),t("addToList",{panelId:n.panelId,id:n.id,position:a,onTop:s.onTop})},setPreserveRatio({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=n.preserveRatio?s.width/s.height:0;e("setRatio",{panelId:n.panelId,id:n.id,preserveRatio:n.preserveRatio,ratio:r})},setWidth({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=s.preserveRatio?n.width/s.ratio:s.height;e("setSize",{panelId:n.panelId,id:n.id,height:r,width:n.width})},setHeight({commit:e,state:t},n){const s=t.panels[n.panelId].objects[n.id],r=s.preserveRatio?n.height*s.ratio:s.width;e("setSize",{panelId:n.panelId,id:n.id,height:n.height,width:r})},copyObjects({commit:e,state:t},{sourcePanelId:n,targetPanelId:o}){const s=t.panels[n],r=t.panels[o],i=[...s.onTopOrder,...s.order],a=new Map;let l=r.lastObjId;for(const d of i){const c=++l;a.set(d,c)}for(const d of i){const c=s.objects[d],p=JSON.parse(JSON.stringify(c));if("talkingObjId"in p){const f=p;f.talkingObjId!==null&&f.talkingObjId!=="$other$"&&a.has(f.talkingObjId)&&(f.talkingObjId=a.get(f.talkingObjId))}e("create",{object:Gc(Ye({},p),{id:a.get(d),panelId:o})})}},copyObjectToClipboard({commit:e,state:t},{id:n,panelId:o}){const s=t.panels[o].objects[n];e("ui/setClipboard",JSON.stringify(s),{root:!0})},pasteObjectFromClipboard({commit:e,state:t,rootState:n}){if(n.ui.clipboard==null)return;const o=JSON.parse(n.ui.clipboard);e("create",{object:Gc(Ye({},o),{id:t.panels[t.currentPanel].lastObjId+1,panelId:t.currentPanel})})},object_addFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_removeFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_moveFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))},object_setFilter({state:e,commit:t},n){hl(n,()=>e.panels[n.panelId].objects[n.id],o=>t("object_setFilters",o))}},sO),h$),vS),fO),$O),TO);function FO(e,t){const n=e.state.panels;for(const o in n){const s=n[o];for(const r in s.objects){const i=s.objects[r];if(i.type==="character"){g$(e,i.panelId,i.id,t);return}}}}var NO=Object.defineProperty,LO=Object.defineProperties,UO=Object.getOwnPropertyDescriptors,qc=Object.getOwnPropertySymbols,VO=Object.prototype.hasOwnProperty,WO=Object.prototype.propertyIsEnumerable,Xc=(e,t,n)=>t in e?NO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Pi=(e,t)=>{for(var n in t||(t={}))VO.call(t,n)&&Xc(e,n,t[n]);if(qc)for(var n of qc(t))WO.call(t,n)&&Xc(e,n,t[n]);return e},zO=(e,t)=>LO(e,UO(t)),qs=(e=>(e[e.None=0]="None",e[e.Stretch=1]="Stretch",e[e.Cover=2]="Cover",e))(qs||{});const GO="buildin.transparent",Ms={panelToUrl:new Map,urlToPanel:new Map,register(e,t){if(this.panelToUrl.has(e)){if(this.panelToUrl.get(e)===t)return;this.unregister(e,this.panelToUrl.get(e))}this.panelToUrl.set(e,t),this.urlToPanel.has(t)?this.urlToPanel.get(t).push(e):this.urlToPanel.set(t,[e])},unregister(e,t){if(this.urlToPanel.has(t)){const n=this.urlToPanel.get(t);n.splice(n.indexOf(e),1),n.length===0&&(this.urlToPanel.delete(t),URL.revokeObjectURL(t))}this.panelToUrl.delete(e)}},qO={namespaced:!0,state:{lastPanelId:-1,panels:{},panelOrder:[],currentPanel:null},mutations:Pi({setCurrentPanel(e,{panelId:t}){e.currentPanel=t},setPanelPreview(e,{panelId:t,url:n}){e.panels[t].lastRender=n,Ms.register(t,n)},createPanel(e,{panel:t}){e.lastPanelId=t.id,e.panels[t.id]=t},setPanelOrder(e,{panelOrder:t}){e.panelOrder=[...t]},setCurrentBackground(e,{current:t,panelId:n}){const o=e.panels[n];o.background.current=t,o.background.variant=0},setBackgroundColor(e,{color:t,panelId:n}){const o=e.panels[n];o.background.color=t},setBackgroundFlipped(e,{flipped:t,panelId:n}){const o=e.panels[n];o.background.flipped=t},setBackgroundVariant(e,{variant:t,panelId:n}){const o=e.panels[n];o.background.variant=t},setBackgroundScaling(e,{scaling:t,panelId:n}){const o=e.panels[n];o.background.scaling=t},deletePanel(e,{panelId:t}){Ms.unregister(t,Ms.panelToUrl.get(t)),delete e.panels[t]},setComposition(e,t){const n=e.panels[t.panelId];n.composite=t.composite},setFilters(e,t){const n=e.panels[t.panelId];n.filters=t.filters},backgroundSetComposition(e,t){const n=e.panels[t.panelId];n.background.composite=t.composite},backgroundSetFilters(e,t){const n=e.panels[t.panelId];n.background.filters=t.filters}},HO),actions:Pi({createPanel({state:e,commit:t}){const n=e.lastPanelId+1;return t("createPanel",{panel:{id:n,background:{color:"#000000",current:GO,flipped:!1,scaling:2,variant:0,composite:"source-over",filters:[]},lastRender:"",composite:"source-over",filters:[],objects:{},onTopOrder:[],order:[],lastObjId:-1}}),t("setPanelOrder",{panelOrder:[...e.panelOrder,n]}),t("setCurrentPanel",{panelId:n}),n},duplicatePanel({state:e,commit:t},{panelId:n}){const o=e.panels[n],s=e.lastPanelId+1;Ms.register(s,o.lastRender);const r=JSON.parse(JSON.stringify(o));let i=-1;const a=new Map,l={};for(const c in r.objects)a.set(+c,++i);for(const c in r.objects){const p=r.objects[c],f=a.get(+c);if(l[f]=p,p.panelId=s,p.id=f,"talkingObjId"in p){const b=p;b.talkingObjId!==null&&b.talkingObjId!=="$other$"&&a.has(b.talkingObjId)&&(b.talkingObjId=a.get(b.talkingObjId))}}t("createPanel",{panel:zO(Pi({},r),{id:s,lastObjId:i,objects:l,order:r.order.map(c=>a.get(c)),onTopOrder:r.onTopOrder.map(c=>a.get(c))})});const d=e.panelOrder.indexOf(n);t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,d+1),s,...e.panelOrder.slice(d+1)]}),t("setCurrentPanel",{panelId:s})},seekBackgroundVariant({state:e,rootGetters:t,commit:n},{delta:o}){const s=e.panels[e.currentPanel],i=t["content/getBackgrounds"].get(s.background.current);!i||n("setBackgroundVariant",{panelId:e.currentPanel,variant:Go(i.variants,s.background.variant,o)})},delete({state:e,commit:t},{panelId:n}){if(e.panelOrder.length<=1)return;const o=e.panelOrder.indexOf(n);let s;o===e.panelOrder.length-1?s=o-1:s=o+1,t("setCurrentPanel",{panelId:e.panelOrder[s]}),t("setPanelOrder",{panelOrder:[...e.panelOrder.slice(0,o),...e.panelOrder.slice(o+1)]}),t("deletePanel",{panelId:n})},fixContentPackRemoval(e,t){const{state:n,rootGetters:o,commit:s,rootState:r}=e;for(const i of Object.values(n.panels)){const a=t.backgrounds.find(p=>p.id===i.background.current);if(!a)return;const l=o["content/getBackgrounds"].get(i.background.current);if(!l){r.content.current.backgrounds.length>0?s("setCurrentBackground",{current:r.content.current.backgrounds[0].id,panelId:i.id}):s("setCurrentBackground",{current:"buildin.transparent",panelId:i.id});return}const d=JSON.stringify(a.variants[i.background.variant]),c=l.variants.findIndex(p=>JSON.stringify(p)===d);c!==i.background.variant&&s("setBackgroundVariant",{variant:c===-1?0:c,panelId:i.id})}FO(e,t)},move({state:e,commit:t},{panelId:n,delta:o}){const s=[...e.panelOrder],r=s.indexOf(n);s.splice(r,1);const i=Math.max(r+o,0);s.splice(i,0,n),t("setPanelOrder",{panelOrder:s})},addFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},removeFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},moveFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},setFilter({state:e,commit:t},n){hl(n,()=>e.panels[n.panelId],o=>t("setFilters",o))},backgroundAddFilter({state:e,commit:t},n){ul(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundRemoveFilter({state:e,commit:t},n){pl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundMoveFilter({state:e,commit:t},n){fl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))},backgroundSetFilter({state:e,commit:t},n){hl(n,()=>e.panels[n.panelId].background,o=>t("backgroundSetFilters",o))}},MO)};var Tf=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class XO{constructor(t,n,o,s,r,i){this.id=t,this.assets=n,this.flip=o,this.scale=s,this.compositeMode=r,this.filters=i}render(t){return Tf(this,null,function*(){const{screenWidth:n,screenHeight:o}=Y().Base,s=yield Promise.all(this.assets.map(r=>Er(r,t.hq)));for(const r of s){let i=0,a=0,l=r.width,d=r.height;switch(this.scale){case qs.None:i=n/2-l/2,a=o/2-d/2;break;case qs.Stretch:l=n,d=o;break;case qs.Cover:const c=l/d,p=n/o;c>p?(d=o,l=d*c):(l=n,d=l/c),i=n/2-l/2,a=o/2-d/2}t.drawImage({image:r,x:i,y:a,w:l,h:d,flip:this.flip,composite:this.compositeMode,filters:this.filters})}})}}const Kc={id:"buildin.static-color",name:"Static color",color:"#000000",render(e){return Tf(this,null,function*(){const{screenWidth:t,screenHeight:n}=Y().Base;e.drawRect({x:0,y:0,w:t,h:n,fill:{style:this.color}})})}};var KO=Object.defineProperty,YO=(e,t,n)=>t in e?KO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Si=(e,t,n)=>(YO(e,typeof t!="symbol"?t+"":t,n),n),Ef=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Bf extends Sf{constructor(){super(...arguments),Si(this,"refTextbox",null),Si(this,"lastUploadCount",0),Si(this,"missingAsset",!1)}get canvasDrawWidth(){return this.width*this.objZoom}get canvasDrawHeight(){return this.height*this.objZoom}get canvasDrawPosX(){return this.x-this.width/2+(this.height-this.canvasDrawHeight)/2}get canvasDrawPosY(){return this.y+(this.height-this.canvasDrawHeight)}get allowSkippingLocalCanvas(){return!1}get objZoom(){return(this.obj.enlargeWhenTalking&&this.refTextbox?1.05:1)*this.obj.zoom}getHitbox(){const t=super.getHitbox(),n=this.width*(this.objZoom-1),o=this.height*(this.objZoom-1);return{x0:t.x0-n/2,x1:t.x1+n/2,y0:t.y0-o,y1:t.y1}}updatedContent(t,n){const o=t.state.panels.panels[n],s=[...o.order,...o.onTopOrder];this.refTextbox=null;for(const i of s){const a=t.state.panels.panels[n].objects[i];if(a.type==="textBox"&&a.talkingObjId===this.obj.id){this.refTextbox=a;return}}const r=Object.keys(t.state.uploadUrls).length;this.missingAsset&&r!==this.lastUploadCount&&(this.localRenderer&&this.localRenderer.dispose(),this.localRenderer=null,this.lastUploadCount=r,this.reloadAssets(),console.log("forceing sprite rerender "+this.id))}renderLocal(t){return Ef(this,null,function*(){const n=yield this.getAssetList();console.log("rerendering local");const o=yield Promise.all(n.filter(s=>s.assets).map(s=>JO(s,t.hq)));this.missingAsset=!1;for(const s of o)for(const r of s.assets)r instanceof rr&&(this.missingAsset=!0),t.drawImage({image:r,composite:s.composite,x:s.offset[0],y:s.offset[1]})})}}function JO(e,t){return Ef(this,null,function*(){return"loaded"in e?e:{loaded:!0,offset:e.offset,assets:yield Promise.all(e.assets.map(n=>Er(n,t))),composite:e.composite}})}var ZO=Object.defineProperty,QO=(e,t,n)=>t in e?ZO(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Vo=(e,t,n)=>(QO(e,typeof t!="symbol"?t+"":t,n),n),Yc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class ex extends Bf{constructor(t){super(t),Vo(this,"assets"),Vo(this,"ready",null),Vo(this,"canvasHeight",0),Vo(this,"canvasWidth",0),Vo(this,"needAssetUpdate",!0),this.init()}get version(){return this.assets===null?-1:this.obj.version}init(){return Yc(this,null,function*(){yield this.reloadAssets()})}reloadAssets(){return Yc(this,null,function*(){let t;this.ready=new Promise((r,i)=>{t=r});const n=yield Promise.all(this.obj.assets.map(r=>Er(r)));let o=0,s=0;for(const r of n)r.height>s&&(s=r.height),r.width>o&&(o=r.width);this.canvasWidth=o,this.canvasHeight=s,this.assets=[{loaded:!0,assets:n,offset:[0,0]}],t()})}getAssetList(){var t;return(t=this.assets)!=null?t:[]}}var tx=Object.defineProperty,nx=(e,t,n)=>t in e?tx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,ox=(e,t,n)=>(nx(e,typeof t!="symbol"?t+"":t,n),n);class sx extends Bf{constructor(t,n){super(t),this.data=n,ox(this,"scaleable",!0)}reloadAssets(){}updatedContent(t,n){super.updatedContent(t,n),this.data=Nr(t,this.obj)}getAssetList(){const t=bn(this.data,this.obj),n=cr(this.data,this.obj),o=[];for(const s of t.renderCommands)switch(s.type){case"head":o.push({offset:s.offset,composite:s.composite,assets:n?n.variants[this.obj.posePositions.head||0]:[]});break;case"image":o.push({offset:s.offset,composite:s.composite,assets:s.images});break;case"pose-part":const r=t.positions[s.part];if(!r||r.length===0)break;const i=r[this.obj.posePositions[s.part]||0];if(!i)break;o.push({offset:s.offset,composite:s.composite,assets:i});break}return o}get canvasHeight(){return bn(this.data,this.obj).size[1]}get canvasWidth(){return bn(this.data,this.obj).size[0]}get closeZoom(){let t=1;return this.obj.close&&(t*=2),t}get width(){return this.obj.width*this.closeZoom}get height(){return this.obj.height*this.closeZoom}}var rx=Object.defineProperty,ix=(e,t,n)=>t in e?rx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Jc=(e,t,n)=>(ix(e,typeof t!="symbol"?t+"":t,n),n),Zc=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class lx extends To{constructor(){super(...arguments),Jc(this,"_height",0),Jc(this,"choiceRenderers",[])}get height(){return this._height}get centeredVertically(){return!0}draw(t){return Zc(this,null,function*(){yield this.updateChoiceBounds();const n=Y(),o=this.obj.width,s=this.height,r=o/2,a=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-r;let l=this.obj.y-s/2;for(const d of this.choiceRenderers){yield d.loadFonts();const c=d.getHeight(this.obj.autoWrap?this.obj.width:0);t.drawRect({x:a,y:l,w:o,h:c+n.Choices.ChoicePadding*2,outline:{style:n.Choices.ChoiceButtonBorderColor,width:n.Choices.Outline},fill:{style:n.Choices.ChoiceButtonColor}}),d.fixAlignment("center",a,a+o,l+n.Choices.ChoiceSpacing*1.25,this.obj.autoWrap?o:0),d.render(t.fsCtx),l+=c+n.Choices.ChoicePadding*2+n.Choices.ChoiceSpacing}})}updateChoiceBounds(){return Zc(this,null,function*(){const t=Y();this.choiceRenderers=this.obj.choices.map(n=>new ct(n.text||" ",t.Choices.ChoiceTextStyle)),this._height=this.choiceRenderers.reduce((n,o)=>n+o.getHeight(this.obj.autoWrap?this.obj.width:0)+t.Choices.ChoicePadding*2,0)+this.obj.choiceDistance*(this.obj.choices.length-1)})}}var ax=Object.defineProperty,dx=Object.getPrototypeOf,cx=Reflect.get,ux=(e,t,n)=>t in e?ax(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Qc=(e,t,n)=>(ux(e,typeof t!="symbol"?t+"":t,n),n),px=(e,t,n)=>cx(dx(e),n,t),eu=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});class Ca extends To{constructor(){super(...arguments),Qc(this,"_height",0),Qc(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}get id(){return this.obj.id}render(t,n,o){return eu(this,null,function*(){const s=Y();this.obj.backdrop&&n.drawRect({x:0,y:0,w:s.Base.screenWidth,h:s.Base.screenHeight,fill:{style:Y().Notification.NotificationBackdropColor}}),yield px(Ca.prototype,this,"render").call(this,t,n,o)})}draw(t){return eu(this,null,function*(){const n=Y(),o=new ct(this.obj.text,n.Notification.NotificationTextStyle),s=new ct("OK",n.Notification.NotificationOkTextStyle);yield o.loadFonts(),yield s.loadFonts();const r=this.obj.autoWrap?this.obj.width-n.Notification.NotificationPadding*2:0,i=this.obj.autoWrap?r:o.getWidth(),a=o.getHeight(r),l=this.obj.autoWrap?r:s.getWidth(),d=s.getHeight(r),c=this._width=Math.max(i,l)+n.Notification.NotificationPadding*2,p=this._height=a+n.Notification.NotificationPadding*2+n.Notification.NotificationSpacing+d,f=c/2,v=(this.flip?n.Base.screenWidth-this.obj.x:this.obj.x)-f,w=this.obj.y-p/2;t.drawRect({x:v,y:w,w:c,h:p,outline:{style:n.Choices.ChoiceButtonBorderColor,width:3},fill:{style:n.Choices.ChoiceButtonColor}}),o.fixAlignment("center",v,v+c,w+n.Notification.NotificationPadding*1.5,r),o.render(t.fsCtx),s.fixAlignment("center",v,v+c,w+p-n.Notification.NotificationPadding,r),s.render(t.fsCtx)})}}var fx=Object.defineProperty,hx=(e,t,n)=>t in e?fx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,tu=(e,t,n)=>(hx(e,typeof t!="symbol"?t+"":t,n),n),gx=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const mx=-2,bx=26,vx=10,yx=10;class _x extends To{constructor(){super(...arguments),tu(this,"_height",0),tu(this,"_width",0)}get height(){return this._height}get width(){return this._width}get centeredVertically(){return!0}draw(t){return gx(this,null,function*(){const n=Y(),o=n.Poem.poemBackgrounds[this.obj.background],s=this.flip?n.Base.screenWidth-this.obj.x:this.obj.x;let r=this.obj.y,i=s+yx,a=n.Poem.poemPadding,l=n.Poem.poemTopPadding,d=a*2;if(o.file==="internal:console"){const f=this._height=this.obj.height,b=this._width=this.obj.width;t.drawRect({x:s-b/2,y:this.obj.y-f/2,h:f,w:b,fill:{style:n.Poem.consoleBackgroundColor}}),a=mx,l=bx,d=vx}else if(o.file==="internal:transparent")this._height=this.obj.height,this._width=this.obj.width;else{const f=yield Kl(`assets/poemBackgrounds/${o.file}`),b=f.height*n.Poem.backgroundScale,v=f.width*n.Poem.backgroundScale;t.drawImage({image:f,x:s-v/2,y:this.obj.y-b/2,h:b,w:v}),this._height=b,this._width=v}r-=this.height/2,i-=this.width/2;const c=n.Poem.poemTextStyles[this.obj.font],p=new ct(this.obj.text,c);yield p.loadFonts(),p.fixAlignment("left",i+a,i+a,r+l+a,this.obj.autoWrap?this.width-d:0),p.render(t.fsCtx)})}}var wx=Object.defineProperty,$x=(e,t,n)=>t in e?wx(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,Xs=(e,t,n)=>($x(e,typeof t!="symbol"?t+"":t,n),n),Cx=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Af=class{constructor(e,t,n,o){this.store=e,this._panelId=t,this.canvasWidth=n,this.canvasHeight=o,Xs(this,"renderObjectCache",new Map),Xs(this,"renderer"),Xs(this,"_disposed",!1),this.renderer=new _s(n,o)}get panelId(){return this._panelId}setPanelId(e){if(this._disposed)throw new Error("Disposed scene-renderer called");this._panelId!==e&&(this._panelId=e,this.renderObjectCache.forEach(t=>{t.dispose()}),this.renderObjectCache.clear())}render(e,t,n){if(this._disposed)throw new Error("Disposed scene-renderer called");return this.panel?this.renderer.render(this.renderCallback.bind(this,n),e,t):Promise.resolve(!1)}download(){if(this._disposed)throw new Error("Disposed scene-renderer called");const e=new Date,t=`panel-${[e.getFullYear(),`${e.getMonth()+1}`.padStart(2,"0"),`${e.getDate()}`.padStart(2,"0"),`${e.getHours()}`.padStart(2,"0"),`${e.getMinutes()}`.padStart(2,"0"),`${e.getSeconds()}`.padStart(2,"0")].join("-")}.png`;return this.renderer.download(this.renderCallback.bind(this,!0),t)}paintOnto(e,t){this.renderer.paintOnto(e,t)}objectsAt(e,t){return this.getRenderObjects().filter(n=>n.hitTest(e,t)).map(n=>n.id)}renderCallback(e,t){return Cx(this,null,function*(){var n;if(this._disposed)throw new Error("Disposed scene-renderer called");t.fsCtx.imageSmoothingEnabled=!0,t.fsCtx.imageSmoothingQuality=t.hq?"high":"low",yield(n=this.getBackgroundRenderer())==null?void 0:n.render(t);const o=this.store.state.ui.selection;for(const s of this.getRenderObjects()){s.updatedContent(this.store,this.panelId);const r=o===s.id,i=document.querySelector(Af.FocusProp),a=(i==null?void 0:i.getAttribute("data-obj-id"))===""+s.id;yield s.render((r?qo.Selected:qo.None)+(a?qo.Focused:qo.None),t,e)}t.applyFilters([...this.panel.filters]),t.preview&&t.drawImage({x:0,y:0,h:this.canvasHeight,w:this.canvasWidth,composite:"destination-over",image:yield co("backgrounds/transparent")})})}getRenderObjects(){const e=this.store.state.panels.panels[this.panelId],t=[...e.order,...e.onTopOrder],n=e.objects,o=Array.from(this.renderObjectCache.keys()).filter(s=>!t.includes(s));for(const s of o)this.renderObjectCache.get(s).dispose(),this.renderObjectCache.delete(s);return t.map(s=>{let r=this.renderObjectCache.get(s);if(!r){const i=n[s],a=i.type;switch(a){case"sprite":r=new ex(i);break;case"character":const l=i;r=new sx(l,Nr(this.store,l));break;case"textBox":r=new iC(i);break;case"choice":r=new lx(i);break;case"notification":r=new Ca(i);break;case"poem":r=new _x(i);break;default:throw new At.UnreachableCaseError(a)}this.renderObjectCache.set(s,r)}return r})}get panel(){return this.store.state.panels.panels[this.panelId]}getBackgroundRenderer(){const e=this.panel;switch(e.background.current){case"buildin.static-color":return Kc.color=e.background.color,Kc;default:const n=this.store.getters["content/getBackgrounds"].get(e.background.current);if(!n)return null;const o=n.variants[e.background.variant];return new XO(e.background.current,o,e.background.flipped,e.background.scaling,e.background.composite,e.background.filters)}}get disposed(){return this._disposed}dispose(){this._disposed=!0,this.renderer.dispose()}};let hr=Af;Xs(hr,"FocusProp",typeof CSS!="undefined"&&CSS.supports("selector(:focus-visible)")?":focus-visible":":focus");var Ie=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Px=1.5,nu=1/4,Sx=.5,ou=100,su=90,ru=70,kx=ee({mixins:[st],components:{DFieldset:Ht,DFlow:vs,DButton:Ln,ImageOptions:$a},data:()=>({webpSupport:!1,heifSupport:!1,ppi:q.supports.limitedCanvasSpace?10:0,pages:"",format:"image/png",quality:su,imageOptions:!1,isMounted:!1,thumbnailCtx:null}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},isLossy(){return this.format!=="image/png"},canDeletePanel(){return this.panelButtons.length>1},panelButtons(){return this.$store.state.panels.panelOrder.map(t=>{const n=this.$store.state.panels.panels[t],o=this.$store.state.panels.panels[t],s=[...o.order,...o.onTopOrder].map(r=>this.$store.state.panels.panels[t].objects[r]).map(this.extractObjectText);return{id:t,image:n.lastRender,text:s.reduce((r,i)=>r.length>i.length?r:i,"")}})},canMoveAhead(){return this.$store.state.panels.panelOrder.indexOf(this.currentPanel.id)>0},canMoveBehind(){const e=this.$store.state.panels.panelOrder;return e.indexOf(this.currentPanel.id)<e.length-1},missingThumbnails(){const e=this.$store;return e.state.panels.panelOrder.filter(n=>e.state.panels.panels[n].lastRender==null)}},created(){return Ie(this,null,function*(){ue.subscribe(zl,()=>requestAnimationFrame(()=>this.renderCurrentThumbnail()));const e=Y().Base,t=cs();t.width=e.screenWidth*nu,t.height=e.screenHeight*nu,this.thumbnailCtx=Cr(t.getContext("2d")),[this.webpSupport,this.heifSupport]=yield Promise.all([mo(),Ob()])})},mounted(){this.isMounted=!0,this.moveFocusToActivePanel(),requestAnimationFrame(()=>this.renderCurrentThumbnail().catch(()=>{}))},unmounted(){this.isMounted=!1,bo(this.thumbnailCtx.canvas)},methods:{restoreThumbnails(){return Ie(this,null,function*(){const e=Y().Base;if(!this.isMounted||q.supports.limitedCanvasSpace)return;const t=this.missingThumbnails;if(t.length===0)return;const n=t[0],o=new hr(this.$store,n,e.screenWidth,e.screenHeight);yield o.render(!1,!1,!0),yield this.renderPanelThumbnail(o),setTimeout(()=>{this.restoreThumbnails()},500)})},download(){return Ie(this,null,function*(){yield Zi("export image",()=>Ie(this,null,function*(){const e=this.getPanelDistibution(),t=new Date,n=`cd-${[t.getFullYear(),`${t.getMonth()+1}`.padStart(2,"0"),`${t.getDate()}`.padStart(2,"0"),`${t.getHours()}`.padStart(2,"0"),`${t.getMinutes()}`.padStart(2,"0"),`${t.getSeconds()}`.padStart(2,"0")].join("-")}`,o=this.format.split("/")[1],s=this.format,r=this.quality;yield this.renderObjects(e,!0,(i,a)=>Ie(this,null,function*(){yield q.saveToFile(a,`${n}_${i}.${o}`,s,r/ou)}))}))})},estimateExportSize(){return Ie(this,null,function*(){const e=this.getPanelDistibution(),t=this.format||"image/png",n=this.quality||su,s=(yield this.renderObjects(e,!1,(l,d)=>Ie(this,null,function*(){return new Promise((c,p)=>{d.toBlob(f=>{if(!f){p(`Image ${l+1} could not be rendered.`);return}c(f.size)},t,n/ou)})}))).map(l=>(l*Px/1024/1024).toFixed(2)+"MiB"),r=s.length>1?"files":"file",i=s.length>1?"These":"It",a=s.length>1?"sizes":"size";ue.fire(new ot(`This would export ${s.length} ${r}. ${i} would have the following (aproximate) ${a}: ${s.join(",")}`))})},renderObjects(e,t,n){return Ie(this,null,function*(){const o=Y().Base,s=[];for(let r=0;r<e.length;++r){const i=e[r],a=document.createElement("canvas");a.width=o.screenWidth,a.height=o.screenHeight*i.length;try{const l=a.getContext("2d");for(let d=0;d<i.length;++d){const c=i[d],p=new hr(this.$store,c,o.screenWidth,o.screenHeight);try{yield p.render(t,!1,!0),p.paintOnto(l,{x:0,y:o.screenHeight*d,w:o.screenWidth,h:o.screenHeight})}finally{p.dispose()}}s.push(yield n(r,a))}finally{bo(a)}}return s})},getLimitedPanelList(){const e=this.$store.state.panels.panelOrder.length-1,t=0,n=this.pages.split(","),o=[];let s=!1;for(const r of n){const i=r.trim(),a=i.match(/^\s*((\d+)|(\d+)\s*-\s*(\d+))\s*$/);if(!a){i!==""&&ue.fire(new ot(`Could not read '${r}' in the page list.`));continue}if(s=!0,a[2])o.push(parseInt(a[2],10)-1);else{const l=Math.max(parseInt(a[3],10)-1,t),d=Math.min(parseInt(a[4],10)-1,e);if(l==null||d==null||l>d)continue;for(let c=l;c<=d;++c)o.push(c)}}return s?o.sort((r,i)=>r-i).filter((r,i,a)=>a[i-1]!==r).map(r=>this.$store.state.panels.panelOrder[r]):this.$store.state.panels.panelOrder},getPanelDistibution(){const e=this.getLimitedPanelList();if(isNaN(this.ppi)&&(this.ppi=0),this.ppi===0)return[e];const t=[];for(let n=0;n<e.length/this.ppi;++n){const o=n*this.ppi,s=o+this.ppi;t.push([...e.slice(o,s)])}return t},moveFocusToActivePanel(){const e=this.$el.querySelector(".panel_button.active");e&&this.scrollIntoView(e)},scrollIntoView(e){const t=e.parentElement.parentElement;this.$store.state.ui.vertical?(t.scrollTop=e.offsetTop-t.clientHeight/2,t.scrollLeft=0):(t.scrollLeft=e.offsetLeft-t.clientWidth/2,t.scrollTop=0)},extractObjectText(e){switch(e.type){case"textBox":return e.text;case"notification":return e.text;case"poem":return e.text;case"choice":return e.choices.map(t=>`[${t.text}]`).join(`
`)}return""},addNewPanel(){return Ie(this,null,function*(){yield this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/duplicatePanel",{panelId:this.$store.state.panels.currentPanel})})),yield this.$nextTick(),this.moveFocusToActivePanel()})},updateCurrentPanel(e){this.vuexHistory.transaction(()=>Ie(this,null,function*(){this.$store.commit("panels/setCurrentPanel",{panelId:e})})),this.$nextTick(()=>{this.moveFocusToActivePanel()})},deletePanel(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/delete",{panelId:this.$store.state.panels.currentPanel})})),this.$nextTick(()=>{this.moveFocusToActivePanel()})},moveAhead(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:-1})}))},moveBehind(){this.vuexHistory.transaction(()=>Ie(this,null,function*(){yield this.$store.dispatch("panels/move",{panelId:this.currentPanel.id,delta:1})}))},renderCurrentThumbnail(){return Ie(this,null,function*(){const e=window.getMainSceneRenderer,t=e&&e();!t||(yield this.renderPanelThumbnail(t))})},renderPanelThumbnail(e){return Ie(this,null,function*(){yield Zi("render thumbnail",()=>Ie(this,null,function*(){const t=e.panelId;e.paintOnto(this.thumbnailCtx,{x:0,y:0,w:this.thumbnailCtx.canvas.width,h:this.thumbnailCtx.canvas.height}),this.thumbnailCtx.canvas.toBlob(n=>{if(!n)return;const o=URL.createObjectURL(n);this.vuexHistory.transaction(()=>{this.$store.commit("panels/setPanelPreview",{panelId:t,url:o})})},(yield mo())?"image/webp":"image/jpeg",Sx)}))})},save(){return Ie(this,null,function*(){const e=yield this.$store.dispatch("getSave",!0),t=new Blob([e],{type:"text/plain"}),n=new Date,o=`save-${[n.getFullYear(),`${n.getMonth()+1}`.padStart(2,"0"),`${n.getDate()}`.padStart(2,"0"),`${n.getHours()}`.padStart(2,"0"),`${n.getMinutes()}`.padStart(2,"0"),`${n.getSeconds()}`.padStart(2,"0")].join("-")}`;q.storeSaveFile(t,`${o}.dddg`)})},load(){return Ie(this,null,function*(){yield this.vuexHistory.transaction(()=>Ie(this,null,function*(){const e=this.$refs.loadUpload;if(!e.files)return;ue.fire(new Gl);const t=yield Ox(e.files[0]);yield this.$store.dispatch("loadSave",t),q.supports.limitedCanvasSpace&&ue.fire(new ot("To prevent running out of memory, thumbnails will not be automatically restored in the background."))})),yield this.renderCurrentThumbnail(),setTimeout(()=>{this.restoreThumbnails()},1e3)})}},watch:{quality(e,t){if(e===100){ue.fire(new ot("Note: 100% quality on a lossy format is still not lossless! Select PNG if you want lossless compression."));return}if(t>ru&&e<=ru){ue.fire(new ot("Note: A quality level below 70% might be very noticeable and impair legibility of text."));return}},ppi(e,t){if(!!q.supports.limitedCanvasSpace&&(t<=10&&e>10||e===0&&this.panelButtons.length>10)){ue.fire(new ot("Note: Safari has strict limitations on available memory. More images per panel can easily cause crashes."));return}}}});function Ox(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=function(){t(o.result)},o.onerror=function(s){n(s)},o.readAsText(e)})}const Un=e=>(ze("data-v-ddb706c4"),e=e(),Ge(),e),xx={class:"panel"},jx=Un(()=>u("h1",null,"Panels",-1)),Ix=["onClick","onKeydown"],Tx={class:"panel_text"},Ex={class:"panel_nr"},Bx={class:"column"},Ax=Un(()=>u("td",null,[u("label",{for:"export_format"},"Format")],-1)),Dx=Un(()=>u("option",{value:"image/png"},"PNG (lossless)",-1)),Rx={key:0,value:"image/webp"},Hx={key:1,value:"image/heif"},Mx=Un(()=>u("option",{value:"image/jpeg"},"JPEG (lossy)",-1)),Fx={key:0},Nx=Un(()=>u("td",null,[u("label",{for:"export_quality"},"Quality:")],-1)),Lx=Un(()=>u("td",null,[u("label",{for:"export_ppi"},[O(" Panels per image: "),u("br"),u("small",null,"(0 for one single image)")])],-1)),Ux=Un(()=>u("td",null,[u("label",{for:"export_pages"},[O(" Panels to export: "),u("br"),u("small",null,"(Leave empty for all)")])],-1)),Vx={class:"column"};function Wx(e,t,n,o,s,r){const i=E("image-options"),a=E("d-flow"),l=E("d-fieldset"),d=E("d-button");return g(),y("div",xx,[jx,e.imageOptions?(g(),L(i,{key:0,type:"panel",title:"","panel-id":e.currentPanel.id,"no-composition":"",onLeave:t[0]||(t[0]=c=>{e.imageOptions=!1,e.renderCurrentThumbnail()})},null,8,["panel-id"])):(g(),y(U,{key:1},[C(l,{class:"existing_panels_fieldset",title:"Existing Panels"},{default:B(()=>[C(a,{"no-wraping":"",maxSize:"350px"},{default:B(()=>[(g(!0),y(U,null,Ce(e.panelButtons,(c,p)=>(g(),y("div",{key:c.id,class:pe({panel_button:!0,active:c.id===e.currentPanel.id}),style:Re(`background-image: url('${c.image}')`),tabindex:"0",onClick:f=>e.updateCurrentPanel(c.id),onKeydown:[Le(f=>e.updateCurrentPanel(c.id),["enter"]),Le(G(f=>e.updateCurrentPanel(c.id),["prevent"]),["space"])]},[u("div",Tx,[u("p",null,fe(c.text),1)]),u("div",Ex,fe(p+1),1)],46,Ix))),128))]),_:1})]),_:1}),u("div",Bx,[C(d,{icon:"add_to_queue",onClick:e.addNewPanel},{default:B(()=>[O(" Add new")]),_:1},8,["onClick"]),C(d,{icon:"remove_from_queue",onClick:e.deletePanel,disabled:!e.canDeletePanel},{default:B(()=>[O(" Delete panel ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"arrow_upward",onClick:e.moveAhead,disabled:!e.canMoveAhead},{default:B(()=>[O(" Move ahead ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"arrow_downward",onClick:e.moveBehind,disabled:!e.canMoveBehind},{default:B(()=>[O(" Move behind ")]),_:1},8,["onClick","disabled"]),C(d,{icon:"color_lens",onClick:t[1]||(t[1]=c=>e.imageOptions=!0)},{default:B(()=>[O(" Image options ")]),_:1})]),C(l,{title:"Export"},{default:B(()=>[u("table",null,[u("tr",null,[Ax,u("td",null,[de(u("select",{id:"export_format","onUpdate:modelValue":t[2]||(t[2]=c=>e.format=c)},[Dx,e.webpSupport?(g(),y("option",Rx," WebP (lossy) ")):X("",!0),e.heifSupport?(g(),y("option",Hx," HEIF (lossy) ")):X("",!0),Mx],512),[[_t,e.format]])])]),e.isLossy?(g(),y("tr",Fx,[Nx,u("td",null,[de(u("input",{id:"export_quality",type:"number",min:"0",max:"100","onUpdate:modelValue":t[3]||(t[3]=c=>e.quality=c),onKeydown:t[4]||(t[4]=G(()=>{},["stop"]))},null,544),[[Ee,e.quality,void 0,{number:!0}]])])])):X("",!0),u("tr",null,[Lx,u("td",null,[de(u("input",{id:"export_ppi",type:"number",min:"0","onUpdate:modelValue":t[5]||(t[5]=c=>e.ppi=c),onKeydown:t[6]||(t[6]=G(()=>{},["stop"])),onBlur:t[7]||(t[7]=c=>{e.ppi===""&&(e.ppi=0)})},null,544),[[Ee,e.ppi,void 0,{number:!0}]])])]),u("tr",null,[Ux,u("td",null,[de(u("input",{id:"export_pages","onUpdate:modelValue":t[8]||(t[8]=c=>e.pages=c),placeholder:"E.g. 1-5, 8, 11-13"},null,512),[[Ee,e.pages]])])]),u("tr",null,[u("td",null,[C(d,{icon:"photo_camera",onClick:e.download},{default:B(()=>[O(" Download ")]),_:1},8,["onClick"])]),u("td",null,[u("button",{onClick:t[9]||(t[9]=(...c)=>e.estimateExportSize&&e.estimateExportSize(...c))},"Estimate filesizes")])])])]),_:1}),u("div",Vx,[C(d,{icon:"save",onClick:e.save},{default:B(()=>[O("Save")]),_:1},8,["onClick"]),C(d,{icon:"folder_open",onClick:t[11]||(t[11]=c=>e.$refs.loadUpload.click())},{default:B(()=>[O(" Load "),u("input",{type:"file",ref:"loadUpload",onChange:t[10]||(t[10]=(...c)=>e.load&&e.load(...c))},null,544)]),_:1})])],64))])}const zx=ne(kx,[["render",Wx],["__scopeId","data-v-ddb706c4"]]),ki=va("panels/setNotificationProperty"),Gx=ee({mixins:[st],components:{Toggle:Rt,ObjectTool:Ao},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="notification")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:ki("text"),autoWrap:ki("autoWrap"),renderBackdrop:ki("backdrop")}});const qx=e=>(ze("data-v-61859d19"),e=e(),Ge(),e),Xx={id:"notification_text_wrapper"},Kx=qx(()=>u("label",{for:"notification_text"},"Text:",-1));function Yx(e,t,n,o,s,r){const i=E("toggle"),a=E("object-tool");return g(),L(a,{object:e.object,title:"Notification",textHandler:e.textHandler},{default:B(()=>[u("div",Xx,[Kx,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),id:"notification_text",onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Ee,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")])]),options:B(()=>[C(i,{modelValue:e.renderBackdrop,"onUpdate:modelValue":t[3]||(t[3]=l=>e.renderBackdrop=l),label:"Show backdrop?"},null,8,["modelValue"])]),_:1},8,["object","textHandler"])}const Jx=ne(Gx,[["render",Yx],["__scopeId","data-v-61859d19"]]),Fs=va("panels/setPoemProperty"),Zx=ee({mixins:[st],components:{Toggle:Rt,ObjectTool:Ao},data:()=>({textEditor:!1}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},backgrounds(){return Wp},poemTextStyles(){return zp},object(){const e=this.currentPanel.objects[this.$store.state.ui.selection];if(e.type==="poem")return e},textHandler(){if(!!this.textEditor)return{title:"Text",get:()=>this.text,set:e=>{this.text=e},leave:()=>{this.textEditor=!1}}},text:Fs("text"),autoWrap:Fs("autoWrap"),poemStyle:Fs("font"),poemBackground:Fs("background")}});const Qx=e=>(ze("data-v-0171fde1"),e=e(),Ge(),e),ej={id:"poem_text"},tj=Qx(()=>u("label",{for:"poem_text"},"Text:",-1)),nj=["value"],oj=["value"];function sj(e,t,n,o,s,r){const i=E("toggle"),a=E("object-tool");return g(),L(a,{object:e.object,title:e.object.subType==="poem"?"Poem":"Console",textHandler:e.textHandler},{default:B(()=>[u("div",ej,[tj,de(u("textarea",{"onUpdate:modelValue":t[0]||(t[0]=l=>e.text=l),onKeydown:t[1]||(t[1]=G(()=>{},["stop"]))},null,544),[[Ee,e.text]]),u("button",{onClick:t[2]||(t[2]=l=>e.textEditor=!0)},"Formatting")]),C(i,{label:"Auto line wrap?",modelValue:e.autoWrap,"onUpdate:modelValue":t[3]||(t[3]=l=>e.autoWrap=l)},null,8,["modelValue"]),e.object.subType==="poem"?(g(),y(U,{key:0},[de(u("select",{"onUpdate:modelValue":t[4]||(t[4]=l=>e.poemBackground=l),onKeydown:t[5]||(t[5]=G(()=>{},["stop"]))},[(g(!0),y(U,null,Ce(e.backgrounds,(l,d)=>(g(),y("option",{value:d,key:d},fe(l.name),9,nj))),128))],544),[[_t,e.poemBackground]]),de(u("select",{"onUpdate:modelValue":t[6]||(t[6]=l=>e.poemStyle=l),onKeydown:t[7]||(t[7]=G(()=>{},["stop"]))},[(g(!0),y(U,null,Ce(e.poemTextStyles,(l,d)=>(g(),y("option",{value:d,key:d},fe(l.name),9,oj))),128))],544),[[_t,e.poemStyle]])],64)):X("",!0)]),_:1},8,["object","title","textHandler"])}const rj=ne(Zx,[["render",sj],["__scopeId","data-v-0171fde1"]]),ij={a:"add",s:"backgrounds",d:"panels",f:"settings"},lj=ee({components:{SettingsPanel:mv,AddPanel:Zv,BackgroundsPanel:Xk,CreditsPanel:mk,CharacterPanel:sS,TextBoxPanel:KS,ChoicePanel:ok,SpritePanel:dS,PanelsPanel:zx,NotificationPanel:Jx,PoemPanel:rj},data:()=>({panelSelection:"add"}),computed:{currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},vertical(){return this.$store.state.ui.vertical},selection(){return this.$store.state.ui.selection},panel(){if(this.panelSelection==="selection")if(this.selection===null)this.panelSelection="add";else return this.currentPanel.objects[this.selection].type;return this.panelSelection},hasPrevRender(){return this.$store.state.ui.lastDownload!==null}},methods:{setPanel(e){e===this.panelSelection&&(e="add"),this.panelSelection=e,this.selection!==null&&this.$store.commit("ui/setSelection",null)},resetScroll(){console.log("resetting scrolls"),this.$refs.panels instanceof HTMLElement&&(this.$refs.panels.scrollTop=0,this.$refs.panels.scrollLeft=0)},onKeydown(e){if(e.ctrlKey){const t=ij[e.key];t&&(this.setPanel(t),e.preventDefault(),e.stopPropagation())}}},watch:{selection(e){if(e!=null){this.panelSelection="selection";return}this.panelSelection==="selection"&&(this.panelSelection="add")}},created(){q.onPanelChange(e=>{this.panelSelection=e}),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown)}});const aj={id:"toolbar"},dj=u("i",{class:"material-icons","aria-hidden":"true"},"add_box",-1),cj=u("div",{class:"shortcut-popup"},"A",-1),uj=[dj,cj],pj=u("i",{class:"material-icons","aria-hidden":"true"},"panorama",-1),fj=u("div",{class:"shortcut-popup"},"S",-1),hj=[pj,fj],gj=u("i",{class:"material-icons","aria-hidden":"true"},"view_module",-1),mj=u("div",{class:"shortcut-popup"},"D",-1),bj=[gj,mj],vj=u("i",{class:"material-icons","aria-hidden":"true"},"settings_applications",-1),yj=u("div",{class:"shortcut-popup"},"F",-1),_j=[vj,yj],wj={id:"toolbar-end"},$j=u("i",{class:"material-icons","aria-hidden":"true"},"help",-1),Cj=[$j],Pj=u("i",{class:"material-icons","aria-hidden":"true"},"extension",-1),Sj=[Pj],kj=["disabled"],Oj=u("i",{class:"material-icons","aria-hidden":"true"},"flip_to_back",-1),xj=[Oj],jj=u("i",{class:"material-icons","aria-hidden":"true"},"photo_camera",-1),Ij=[jj];function Tj(e,t,n,o,s,r){const i=E("settings-panel"),a=E("backgrounds-panel"),l=E("credits-panel"),d=E("character-panel"),c=E("sprite-panel"),p=E("text-box-panel"),f=E("choice-panel"),b=E("panels-panel"),v=E("notification-panel"),w=E("poem-panel"),H=E("add-panel");return g(),y("div",{id:"panels",class:pe({vertical:e.vertical}),onScroll:t[12]||(t[12]=(...D)=>e.resetScroll&&e.resetScroll(...D)),ref:"panels"},[u("div",aj,[u("button",{class:pe({active:e.panel==="add"}),onClick:t[0]||(t[0]=D=>e.setPanel("add")),title:"Add new objects to the scene","aria-label":"Add new objects to the scene"},uj,2),u("button",{class:pe({active:e.panel==="backgrounds"}),onClick:t[1]||(t[1]=D=>e.setPanel("backgrounds")),"aria-label":"Change the current background",title:"Change the current background"},hj,2),u("button",{class:pe({active:e.panel==="panels"}),title:"Panels","aria-label":"Panels",onClick:t[2]||(t[2]=D=>e.setPanel("panels"))},bj,2),u("button",{class:pe({active:e.panel==="settings"}),title:"Settings","aria-label":"Settings",onClick:t[3]||(t[3]=D=>e.setPanel("settings"))},_j,2)]),e.panel==="settings"?(g(),L(i,{key:0})):e.panel==="backgrounds"?(g(),L(a,{key:1,onShowDialog:t[4]||(t[4]=D=>e.$emit("show-dialog",D))})):e.panel==="help_credits"?(g(),L(l,{key:2})):e.panel==="character"?(g(),L(d,{key:3,onShowDialog:t[5]||(t[5]=D=>e.$emit("show-dialog",D)),onShowExpressionDialog:t[6]||(t[6]=D=>e.$emit("show-expression-dialog",D))})):e.panel==="sprite"?(g(),L(c,{key:4})):e.panel==="textBox"?(g(),L(p,{key:5})):e.panel==="choice"?(g(),L(f,{key:6})):e.panel==="panels"?(g(),L(b,{key:7})):e.panel==="notification"?(g(),L(v,{key:8})):e.panel==="poem"?(g(),L(w,{key:9})):(g(),L(H,{key:10,onShowDialog:t[7]||(t[7]=D=>e.$emit("show-dialog",D))})),u("div",wj,[u("button",{class:pe({active:e.panel==="help_credits"}),onClick:t[8]||(t[8]=D=>e.setPanel("help_credits")),title:"Help & Credits","aria-label":"Help & Credits"},Cj,2),u("button",{class:pe({active:e.panel==="packs"}),onClick:t[9]||(t[9]=D=>e.$emit("show-dialog")),title:"Content packs","aria-label":"Content packs"},Sj,2),u("button",{onClick:t[10]||(t[10]=D=>e.$emit("show-prev-render")),title:"Show last downloaded panel","aria-label":"Show last downloaded panel",disabled:!e.hasPrevRender},xj,8,kj),u("button",{title:"Take a screenshot of the current scene","aria-label":"Take a screenshot of the current scene",onClick:t[11]||(t[11]=D=>e.$emit("download"))},Ij)])],34)}const Ej=ne(lj,[["render",Tj]]);var Bj=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Aj=5e3,Oi=2e4,iu=100,Dj=ee({props:{loading:{default:!1,type:Boolean}},data:()=>({messages:[],errors:[],resolvableErrors:[],showLoading:!1,showLoadingTimeout:0,hideLoadingTimeout:0}),computed:{vertical(){return this.$store.state.ui.vertical}},created(){this.onLoadingChange(this.loading),ue.subscribe(or,e=>{this.messages.push(`Failed to load asset '${e.path}'`),setTimeout(()=>{this.messages.shift()},Aj)}),ue.subscribe(yp,e=>{this.messages.push("Failed to load custom asset. Try to download it manually and then upload it."),setTimeout(()=>{this.messages.shift()},Oi)}),ue.subscribe(Wl,e=>{this.errors.push(e.message)}),ue.subscribe(ql,e=>{this.resolvableErrors.push(e)}),ue.subscribe(ot,e=>{this.messages.push(e.message),setTimeout(()=>{this.messages.shift()},Oi)}),ue.subscribe($p,e=>{this.messages.push(e.error.name),this.messages.push(JSON.stringify(e.error.stack)),this.messages.push(e.info),setTimeout(()=>{this.messages.shift(),this.messages.shift(),this.messages.shift()},Oi)})},methods:{onLoadingChange(e){e?(this.hideLoadingTimeout&&(clearTimeout(this.hideLoadingTimeout),this.hideLoadingTimeout=0),!this.showLoading&&!this.showLoadingTimeout&&(this.showLoadingTimeout=setTimeout(()=>{this.showLoading=!0,this.showLoadingTimeout=0},iu))):(this.showLoadingTimeout&&(clearTimeout(this.showLoadingTimeout),this.showLoadingTimeout=0),this.showLoading&&!this.hideLoadingTimeout&&(this.hideLoadingTimeout=setTimeout(()=>{this.showLoading=!1,this.hideLoadingTimeout=0},iu)))},dismissError(e){this.errors.splice(e,1)},resolvableAction(e,t){return Bj(this,null,function*(){const n=this.resolvableErrors[e];this.resolvableErrors.splice(e,1),yield n.actions.find(s=>s.name===t).exec()})}},watch:{loading(e){this.onLoadingChange(e)}}});const Rj={key:0},Hj=["onClick"],Mj=["onClick"];function Fj(e,t,n,o,s,r){return g(),y("div",{id:"messageConsole",class:pe({vertical:e.vertical})},[e.showLoading?(g(),y("p",Rj,"Loading...")):X("",!0),(g(!0),y(U,null,Ce(e.messages,(i,a)=>(g(),y("p",{key:i+"_"+a},fe(i),1))),128)),(g(!0),y(U,null,Ce(e.resolvableErrors,(i,a)=>(g(),y("p",{class:"error",key:"resolvableError_"+a},[O(fe(i.message)+" ",1),(g(!0),y(U,null,Ce(i.actions,l=>(g(),y("a",{href:"#",key:"resolvableError_"+a+l.name,onClick:d=>e.resolvableAction(a,l.name)},"["+fe(l.name)+"]",9,Hj))),128))]))),128)),(g(!0),y(U,null,Ce(e.errors,(i,a)=>(g(),y("p",{class:"error",key:"error_"+a},[O(fe(i)+" ",1),u("a",{href:"#",onClick:l=>e.dismissError(a)},"[Dismiss]",8,Mj)]))),128))],2)}const Nj=ne(Dj,[["render",Fj],["__scopeId","data-v-aa1cfe72"]]);var Kn=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const Lj=ee({props:{canvasWidth:{default:0},canvasHeight:{default:0},preLoading:{type:Boolean}},data:()=>({sdCtx:null,currentlyRendering:!1,queuedRender:null,showingLast:!1,dropSpriteCount:0,dropPreventClick:!1,draggedObject:null,dragXOffset:0,dragYOffset:0,dragXOriginal:0,dragYOriginal:0,sceneRendererCache:null}),computed:{selection(){var e;return(e=this.$store.state.ui.selection)!=null?e:null},currentPanel(){return this.$store.state.panels.panels[this.$store.state.panels.currentPanel]},lqRendering(){return this.$store.state.ui.lqRendering},sceneRender(){if(this.preLoading)return null;const e=this.$store.state.panels.currentPanel;return this.sceneRendererCache?this.sceneRendererCache.setPanelId(e):(console.log("New scene renderer!"),this.sceneRendererCache=Cr(new hr(this.$store,e,this.bitmapWidth,this.bitmapHeight))),this.sceneRendererCache},bitmapHeight(){return this.preLoading,Y().Base.screenHeight},bitmapWidth(){return this.preLoading,Y().Base.screenWidth},pickerMode(){return this.$store.state.ui.pickColor},cursor(){return this.pickerMode?"crosshair":"default"}},methods:{download(){return Kn(this,null,function*(){const e=yield this.sceneRender.download();yield this.vuexHistory.transaction(()=>Kn(this,null,function*(){const t=this.$store.state.ui.lastDownload;this.$store.commit("ui/setLastDownload",e),t!=null&&URL.revokeObjectURL(t)}))})},invalidateRender(){this.queuedRender==null&&(this.queuedRender=requestAnimationFrame(this.render_))},render_(){return Kn(this,null,function*(){if(this.queuedRender!=null&&(cancelAnimationFrame(this.queuedRender),this.queuedRender=null),!this.preLoading&&!this.$store.state.unsafe){try{yield this.sceneRender.render(!this.lqRendering,!0,!1)}catch(e){console.log(e)}this.display(),ue.fire(new zl)}})},renderLoadingScreen(){const e=document.createElement("canvas");e.height=this.bitmapHeight,e.width=this.bitmapWidth;try{vo.make(e,!0,!1).drawText({text:"Starting...",x:e.width/2,y:e.height/2,align:"center",outline:{width:5,style:"#b59"},font:"32px riffic",fill:{style:"white"}}),this.sdCtx.drawImage(e,this.canvasWidth,this.canvasHeight)}finally{bo(e)}},display(){this.showingLast=!1,this.sceneRender.paintOnto(this.sdCtx,{x:0,y:0,w:this.bitmapWidth,h:this.bitmapHeight})},toRendererCoordinate(e,t){const n=this.$refs.sd,o=e-n.offsetLeft,s=t-n.offsetTop,r=o/n.offsetWidth*n.width,i=s/n.offsetWidth*n.width;return[r,i]},onUiClick(e){var t;const[n,o]=this.toRendererCoordinate(e.clientX,e.clientY);if(this.pickerMode){const a=this.sdCtx.getImageData(n,o,1,1).data,l=`rgba(${a[0].toString()},${a[1].toString()},${a[2].toString()},${(a[3]/255).toString()})`;this.vuexHistory.transaction(()=>{this.$store.commit("ui/setColorPicker",!1),ue.fire(new sr(l))});return}if(this.dropPreventClick){this.dropPreventClick=!1;return}const s=this.sceneRender.objectsAt(n,o),r=s.findIndex(a=>a===this.selection);let i;r===0?i=null:r!==-1?i=s[r-1]:i=(t=s[s.length-1])!=null?t:null,this.$store.state.ui.selection!==i&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",i)})},onDragStart(e){if(e.preventDefault(),this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,n]=this.toRendererCoordinate(e.clientX,e.clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=n-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onTouchStart(e){if(this.selection===null)return;this.draggedObject=this.currentPanel.objects[this.selection];const[t,n]=this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);this.dragXOffset=t-this.draggedObject.x,this.dragYOffset=n-this.draggedObject.y,this.dragXOriginal=this.draggedObject.x,this.dragYOriginal=this.draggedObject.y},onDragOver(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"},onSpriteDragMove(e){if(!this.draggedObject)return;e.preventDefault();let[t,n]=e instanceof MouseEvent?this.toRendererCoordinate(e.clientX,e.clientY):this.toRendererCoordinate(e.touches[0].clientX,e.touches[0].clientY);t-=this.dragXOffset,n-=this.dragYOffset;const o=Math.abs(t-this.dragXOriginal),s=Math.abs(n-this.dragYOriginal);o+s>1&&(this.dropPreventClick=!0),e.shiftKey&&(o>s?n=this.dragYOriginal:t=this.dragXOriginal),this.vuexHistory.transaction(()=>{this.$store.dispatch("panels/setPosition",{panelId:this.draggedObject.panelId,id:this.draggedObject.id,x:t,y:n})})},onDrop(e){return Kn(this,null,function*(){if(e.stopPropagation(),e.preventDefault(),!!e.dataTransfer){for(const t of e.dataTransfer.items)if(t.kind==="file"&&t.type.match(/image.*/)){const n=t.getAsFile(),o=URL.createObjectURL(n);try{const s=yield this.$store.dispatch("uploadUrls/add",{name:n.name,url:o});yield this.vuexHistory.transaction(()=>Kn(this,null,function*(){yield this.$store.dispatch("panels/createSprite",{panelId:this.$store.state.panels.currentPanel,assets:[{hq:s,lq:s,sourcePack:"dddg.uploaded.sprites"}]})}))}catch(s){URL.revokeObjectURL(o)}}}})},onSpriteDrop(e){this.draggedObject&&("TouchEvent"in window&&e instanceof TouchEvent&&(this.dropPreventClick=!1),this.draggedObject=null)},onMouseEnter(e){e.buttons!==1&&(this.draggedObject=null)}},watch:{canvasWidth(){this.display()},canvasHeight(){this.display()}},created(){return Kn(this,null,function*(){if(typeof WeakRef!="undefined"){const e=new WeakRef(this);window.getMainSceneRenderer=function(){var t;return(t=e.deref())==null?void 0:t.sceneRender}}else window.getMainSceneRenderer=()=>this.sceneRender;ue.subscribe(Tr,()=>this.invalidateRender()),ue.subscribe(Gl,()=>{const e=this.sceneRendererCache;e&&e.setPanelId(-1)}),this.$store.subscribe(e=>{e.type!=="panels/setPanelPreview"&&e.type!=="panels/currentPanel"&&this.invalidateRender()})})},mounted(){const e=this.$refs.sd;this.sdCtx=e.getContext("2d"),this.renderLoadingScreen(),this.invalidateRender()},unmounted(){var e;(e=this.sceneRendererCache)==null||e.dispose()}});const Uj=["height","width"];function Vj(e,t,n,o,s,r){return g(),y("canvas",{id:"scaled_display",ref:"sd",height:e.bitmapHeight,width:e.bitmapWidth,style:Re({width:e.canvasWidth+"px",height:e.canvasHeight+"px",cursor:e.cursor}),draggable:"true",onClick:t[0]||(t[0]=(...i)=>e.onUiClick&&e.onUiClick(...i)),onTouchstart:t[1]||(t[1]=(...i)=>e.onTouchStart&&e.onTouchStart(...i)),onDragstart:t[2]||(t[2]=(...i)=>e.onDragStart&&e.onDragStart(...i)),onTouchmove:t[3]||(t[3]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onMousemove:t[4]||(t[4]=(...i)=>e.onSpriteDragMove&&e.onSpriteDragMove(...i)),onTouchend:t[5]||(t[5]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onMouseup:t[6]||(t[6]=(...i)=>e.onSpriteDrop&&e.onSpriteDrop(...i)),onDragover:t[7]||(t[7]=(...i)=>e.onDragOver&&e.onDragOver(...i)),onDrop:t[8]||(t[8]=(...i)=>e.onDrop&&e.onDrop(...i)),onMouseenter:t[9]||(t[9]=(...i)=>e.onMouseEnter&&e.onMouseEnter(...i)),onContextmenu:t[10]||(t[10]=G(()=>{},["prevent"]))},"HTML5 is required to use the Doki Doki Dialog Generator. ",44,Uj)}const Wj=ne(Lj,[["render",Vj]]),Pa={"dddg.buildin.backgrounds.nsfw":`${Fe}packs/buildin.base.backgrounds.nsfw.json`,"dddg.buildin.sayori.nsfw":`${Fe}packs/buildin.base.sayori.nsfw.json`,"dddg.buildin.base.natsuki.nsfw":`${Fe}packs/buildin.base.natsuki.nsfw.json`,"dddg.buildin.yuri.nsfw":`${Fe}packs/buildin.base.yuri.nsfw.json`},zj=new Set(Object.keys(Pa)),Gj=Object.values(Pa);var xi=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const lu=16/9,Ns=20,qj=50,Xj=200,Kj=ee({components:{ToolBox:Ej,MessageConsole:Nj,Render:Wj,ModalDialog:Jl,SingleBox:Ga(()=>wd(()=>import("./SingleBox.34d3e772.js"),["./SingleBox.34d3e772.js","./SingleBox.8b99b1b9.css"],import.meta.url)),ExpressionBuilder:Ga(()=>wd(()=>import("./index.8c18accb.js"),["./index.8c18accb.js","./index.8ebb7f0d.css"],import.meta.url))},data:()=>({canvasWidth:0,canvasHeight:0,blendOver:null,uiSize:192,currentlyRendering:!1,panel:"",dialogVisable:!1,canvasTooSmall:!1,expressionBuilderVisible:!1,expressionBuilderCharacter:"",expressionBuilderHeadGroup:void 0,systemPrefersDarkMode:!1,preLoading:!0,classes:new Set,classTimeout:null,queuedRerender:null}),computed:{isSafari(){return!1},useDarkTheme(){var e;return(e=this.userPrefersDarkMode)!=null?e:this.systemPrefersDarkMode},userPrefersDarkMode(){return this.$store.state.ui.useDarkTheme},nsfw(){return this.$store.state.ui.nsfw},objects(){const e=this.$store.state.panels,t=e.panels[e.currentPanel];return t==null?[]:[...t.order,...t.onTopOrder]}},methods:{drawLastDownload(){const e=this.$store.state.ui.lastDownload;e!=null&&this.$refs.render.blendOver(e)},setBlendOver(){this.blendOver=this.$store.state.ui.lastDownload},optimum(e,t){let n=e/lu,o=t*lu;return n>t?n=t:o=e,[o,n]},optimizeWithMenu(e,t){const n=this.optimum(e,t-this.uiSize),o=this.optimum(e-this.uiSize,t);return!this.isSafari&&n[0]*n[1]>o[0]*o[1]?[n[0],n[1],!1]:[o[0],o[1],!0]},updateArea(){const[e,t,n]=this.optimizeWithMenu(document.documentElement.clientWidth,document.documentElement.clientHeight);this.canvasWidth=e,this.canvasHeight=t,this.canvasTooSmall=Math.max(e,t)<Xj,this.$store.state.ui.vertical!==n&&this.$store.commit("ui/setVertical",n)},showDialog(e){if(this.dialogVisable=!0,e==null)return;const t=()=>{this.$refs.packDialog?this.$refs.packDialog.setSearch(e):setTimeout(t,qj)};this.$nextTick(t)},showExpressionDialog(e){this.expressionBuilderVisible=!0,this.expressionBuilderCharacter=e.character,this.expressionBuilderHeadGroup=e.headGroup},rerender(){this.queuedRerender==null&&(this.queuedRerender=requestAnimationFrame(()=>{this.queuedRerender=null,ue.fire(new Tr)}))},onKeydown(e){if(e.key==="Control"){this.classTimeout===null&&(this.classTimeout=setTimeout(()=>{this.classTimeout=null,this.classes.add("ctrl-key")},500));return}if(e.target instanceof HTMLInputElement||e.target instanceof HTMLTextAreaElement){console.log("skip keydown on potential target");return}this.vuexHistory.transaction(()=>{if(e.ctrlKey){if(e.key==="z"){e.preventDefault();return}else if(e.key==="y"){e.preventDefault();return}else if(e.key==="v"){this.$store.dispatch("panels/pasteObjectFromClipboard",{}),e.preventDefault();return}}const n=this.$store.state.panels.panels[this.$store.state.panels.currentPanel].objects[this.$store.state.ui.selection];if(n==null)return;if(e.key==="Delete"){this.$store.dispatch("panels/removeObject",{id:n.id,panelId:n.panelId});return}if(e.key==="c"||e.key==="x"){this.$store.dispatch("panels/copyObjectToClipboard",{id:n.id,panelId:n.panelId}),e.key==="x"&&this.$store.dispatch("panels/removeObject",{id:n.id,panelId:n.panelId}),e.preventDefault();return}if(e.key==="/"||e.key==="*"){let r=e.key==="/"?-10:10;e.shiftKey&&(r/=Math.abs(r)),this.$store.commit("panels/setRotation",{id:n.id,panelId:n.panelId,rotation:n.rotation+r}),e.stopPropagation(),e.preventDefault();return}if(n.type==="character"){const r=n;if(!r.freeMove){if(e.key==="ArrowLeft"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:-1});return}if(e.key==="ArrowRight"){this.$store.dispatch("panels/shiftCharacterSlot",{id:r.id,panelId:r.panelId,delta:1});return}}}let{x:o,y:s}=n;if(e.key==="ArrowLeft")o-=e.shiftKey?1:Ns;else if(e.key==="ArrowRight")o+=e.shiftKey?1:Ns;else if(e.key==="ArrowUp")s-=e.shiftKey?1:Ns;else if(e.key==="ArrowDown")s+=e.shiftKey?1:Ns;else return;this.$store.dispatch("panels/setPosition",{id:n.id,panelId:n.panelId,x:o,y:s})})},onKeyup(e){if(e.key==="Control"){this.classTimeout!=null&&clearTimeout(this.classTimeout),this.classTimeout=null,this.classes.delete("ctrl-key");return}},applyTheme(){document.body.classList.toggle("dark-theme",this.useDarkTheme)},select(e){this.$store.state.ui.selection!==e&&this.vuexHistory.transaction(()=>{this.$store.commit("ui/setSelection",e)})}},watch:{systemPrefersDarkMode(){this.applyTheme()},userPrefersDarkMode(){this.applyTheme()},nsfw(e){return xi(this,null,function*(){e?yield this.$store.dispatch("content/loadContentPacks",Gj):yield this.$store.dispatch("removePacks",{packs:zj})})}},mounted(){if(window.addEventListener("keypress",e=>{e.key==="Escape"&&this.vuexHistory.transaction(()=>{this.$store.state.ui.selection!==null&&this.$store.commit("ui/setSelection",null)})}),window.addEventListener("resize",this.updateArea),window.removeEventListener("keydown",this.onKeydown),window.addEventListener("keydown",this.onKeydown),window.addEventListener("keyup",this.onKeyup),window.matchMedia!=null){const e=window.matchMedia("(prefers-color-scheme: dark)");this.systemPrefersDarkMode=e.matches,e.addListener(t=>{this.systemPrefersDarkMode=t.matches})}},created(){return xi(this,null,function*(){this.updateArea(),Jt.setStore(this.$store),window.app=this,window.store=this.$store,window.env=q,Rn(()=>this.$store.state.ui.selection,t=>{var n,o;((n=document.activeElement)==null?void 0:n.getAttribute("data-obj-id"))!==""+t&&((o=document.querySelector(`*[data-obj-id='${t}']`))==null||o.focus({focusVisible:!1,preventScroll:!0}))}),document.body.addEventListener("drop",t=>{t.preventDefault()},!0),document.body.addEventListener("dragover",t=>{t.preventDefault()},!0),yield q.loadGameMode(),this.preLoading=!1,q.connectToStore(this.vuexHistory,this.$store);const e=yield q.loadSettings();yield this.vuexHistory.transaction(()=>xi(this,null,function*(){var t,n,o,s;q.state.looseTextParsing=e.looseTextParsing||!0,this.$store.commit("ui/setLqRendering",(t=e.lq)!=null?t:!1),this.$store.commit("ui/setDarkTheme",(n=e.darkMode)!=null?n:null),this.$store.commit("ui/setDefaultCharacterTalkingZoom",(o=e.defaultCharacterTalkingZoom)!=null?o:!0),yield this.$store.dispatch("content/loadContentPacks",[`${Fe}packs/buildin.base.backgrounds.json`,`${Fe}packs/buildin.base.monika.json`,`${Fe}packs/buildin.base.sayori.json`,`${Fe}packs/buildin.base.natsuki.json`,`${Fe}packs/buildin.base.yuri.json`,`${Fe}packs/buildin.extra.mc.json`,`${Fe}packs/buildin.extra.concept_mc.json`,`${Fe}packs/buildin.extra.mc_chad.json`,`${Fe}packs/buildin.extra.femc.json`,`${Fe}packs/buildin.extra.concept_femc.json`,`${Fe}packs/buildin.extra.amy.json`]),yield q.loadContentPacks();const r=yield this.$store.dispatch("panels/createPanel");Object.keys(this.$store.state.panels.panels[r].objects).length===0&&(yield this.$store.dispatch("panels/createTextBox",{panelId:r,text:`Hi! Click here to edit this textbox! ${this.$store.state.ui.vertical?"To the right":"At the bottom"} you find the toolbox. There you can add things (try clicking the chibis), change backgrounds and more!`})),yield this.$store.commit("panels/setCurrentBackground",{current:"dddg.buildin.backgrounds:ddlc.clubroom",panelId:this.$store.state.panels.currentPanel}),yield this.$store.commit("ui/setNsfw",(s=e.nsfw)!=null?s:!1)}))})},unmounted(){window.removeEventListener("keydown",this.onKeydown),window.removeEventListener("keyup",this.onKeyup)}});const Yj={key:0},Jj={class:"hidden-selectors"},Zj=["data-obj-id","onKeydown"],Qj=u("div",{id:"modal-messages"},null,-1);function eI(e,t,n,o,s,r){const i=E("render"),a=E("message-console"),l=E("tool-box"),d=E("single-box"),c=E("modal-dialog"),p=E("expression-builder");return g(),y(U,null,[e.canvasTooSmall&&e.isSafari?(g(),y("div",Yj," Protrait mode is not supported by safari. Please turn the device sideways. ")):(g(),y("div",{key:1,id:"app",class:pe(Array.from(e.classes))},[u("div",Jj,[(g(!0),y(U,null,Ce(e.objects,f=>(g(),y("div",{key:f,tabindex:"0","data-obj-id":f,onFocus:t[0]||(t[0]=b=>e.rerender()),onBlur:t[1]||(t[1]=b=>e.rerender()),onKeydown:[Le(G(b=>e.select(f),["prevent"]),["enter"]),Le(G(b=>e.select(f),["prevent"]),["space"])]},null,40,Zj))),128))]),C(i,{ref:"render",canvasWidth:e.canvasWidth,canvasHeight:e.canvasHeight,preLoading:e.preLoading},null,8,["canvasWidth","canvasHeight","preLoading"]),C(a),C(l,{onShowPrevRender:e.drawLastDownload,onDownload:t[2]||(t[2]=f=>e.$refs.render.download()),onShowDialog:e.showDialog,onShowExpressionDialog:e.showExpressionDialog},null,8,["onShowPrevRender","onShowDialog","onShowExpressionDialog"]),(g(),L(Pg,null,[e.dialogVisable?(g(),L(c,{key:0,ref:"dialog",onLeave:t[4]||(t[4]=f=>e.dialogVisable=!1)},{default:B(()=>[C(d,{ref:"packDialog",onLeave:t[3]||(t[3]=f=>e.dialogVisable=!1)},null,512)]),_:1},512)):X("",!0)],1024)),e.expressionBuilderVisible?(g(),L(c,{key:0,ref:"dialog",onLeave:t[6]||(t[6]=f=>e.expressionBuilderVisible=!1)},{default:B(()=>[C(p,{character:e.expressionBuilderCharacter,initHeadGroup:e.expressionBuilderHeadGroup,onLeave:t[5]||(t[5]=f=>e.expressionBuilderVisible=!1)},null,8,["character","initHeadGroup"])]),_:1},512)):X("",!0)],2)),Qj],64)}const tI=ne(Kj,[["render",eI]]);var nI=Object.defineProperty,oI=Object.defineProperties,sI=Object.getOwnPropertyDescriptors,au=Object.getOwnPropertySymbols,rI=Object.prototype.hasOwnProperty,iI=Object.prototype.propertyIsEnumerable,du=(e,t,n)=>t in e?nI(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,qr=(e,t)=>{for(var n in t||(t={}))rI.call(t,n)&&du(e,n,t[n]);if(au)for(var n of au(t))iI.call(t,n)&&du(e,n,t[n]);return e},lI=(e,t)=>oI(e,sI(t));function Ks(e,t){return{backgrounds:aI(e.backgrounds,t.backgrounds),characters:cI(e.characters,t.characters),dependencies:gl(e.dependencies,t.dependencies),fonts:Bt(e.fonts,t.fonts,n=>n.id,(n,o)=>lI(qr({},n),{files:gl(n.files,o.files)})),poemStyles:Bt(e.poemStyles,t.poemStyles,n=>n.label,()=>{throw new Error}),poemBackgrounds:[...e.poemBackgrounds,...t.poemBackgrounds],sprites:Bt(e.sprites,t.sprites,n=>n.id,(n,o)=>{var s;return{id:n.id,label:n.label,variants:[...n.variants,...o.variants],defaultScale:n.defaultScale,hd:n.hd,sdVersion:(s=n.sdVersion)!=null?s:o.sdVersion}}),colors:Bt(e.colors,t.colors,n=>n.color,n=>n)}}function aI(e,t){return Bt(e,t,n=>n.id,dI)}function dI(e,t){var n;return{id:e.id,label:e.label,variants:[...e.variants,...t.variants],scaling:e.scaling,sdVersion:(n=e.sdVersion)!=null?n:t.sdVersion}}function cI(e,t){return Bt(e,t,n=>n.id,uI)}function uI(e,t){return{chibi:e.chibi,id:e.id,label:e.label,heads:hI(e.heads,t.heads),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion,styleGroups:Bt(e.styleGroups,t.styleGroups,n=>n.id,(n,o)=>({id:n.id,styleComponents:Bt(n.styleComponents,o.styleComponents,s=>s.id,(s,r)=>({id:s.id,label:s.label,variants:pI(s.variants,r.variants)})),styles:Bt(n.styles,o.styles,s=>JSON.stringify(s.components),(s,r)=>({components:s.components,poses:Bt(s.poses,r.poses,i=>i.id,fI)}))}))}}function pI(e,t){const n=qr({},e);for(const o in t)!t.hasOwnProperty(o)||n.hasOwnProperty(o)||(n[o]=t[o]);return n}function fI(e,t){const n=qr({},e.positions);for(const o in t.positions)n[o]?n[o]=[...n[o],...t.positions[o]]:n[o]=t.positions[o];return{id:e.id,compatibleHeads:gl(e.compatibleHeads,t.compatibleHeads),previewOffset:e.previewOffset,previewSize:e.previewSize,scale:e.scale,size:e.size,renderCommands:e.renderCommands,positions:n}}function hI(e,t){const n=qr({},e);for(const o in t){if(!t.hasOwnProperty(o))continue;const s=t[o];if(n[o]){const r=n[o];n[o]={previewOffset:r.previewOffset,previewSize:r.previewSize,variants:[...r.variants,...s.variants]}}else n[o]=s}return n}function gl(e,t){const n=[...e];for(const o of t)n.includes(o)||n.push(o);return n}function Bt(e,t,n,o){const s=[...e],r=new Map(e.map((i,a)=>[n(i),a]));for(const i of t){const a=n(i);if(r.has(a)){const l=r.get(a),d=s[l];s.splice(l,1,o(d,i))}else r.set(a,s.length),s.push(i)}return s}function gI(){return Df().__VUE_DEVTOOLS_GLOBAL_HOOK__}function Df(){return typeof navigator!="undefined"&&typeof window!="undefined"?window:typeof global!="undefined"?global:{}}const mI=typeof Proxy=="function",bI="devtools-plugin:setup",vI="plugin:settings:set";let Yn,ml;function yI(){var e;return Yn!==void 0||(typeof window!="undefined"&&window.performance?(Yn=!0,ml=window.performance):typeof global!="undefined"&&((e=global.perf_hooks)===null||e===void 0?void 0:e.performance)?(Yn=!0,ml=global.perf_hooks.performance):Yn=!1),Yn}function _I(){return yI()?ml.now():Date.now()}class wI{constructor(t,n){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=t,this.hook=n;const o={};if(t.settings)for(const i in t.settings){const a=t.settings[i];o[i]=a.defaultValue}const s=`__vue-devtools-plugin-settings__${t.id}`;let r=Object.assign({},o);try{const i=localStorage.getItem(s),a=JSON.parse(i);Object.assign(r,a)}catch(i){}this.fallbacks={getSettings(){return r},setSettings(i){try{localStorage.setItem(s,JSON.stringify(i))}catch(a){}r=i},now(){return _I()}},n&&n.on(vI,(i,a)=>{i===this.plugin.id&&this.fallbacks.setSettings(a)}),this.proxiedOn=new Proxy({},{get:(i,a)=>this.target?this.target.on[a]:(...l)=>{this.onQueue.push({method:a,args:l})}}),this.proxiedTarget=new Proxy({},{get:(i,a)=>this.target?this.target[a]:a==="on"?this.proxiedOn:Object.keys(this.fallbacks).includes(a)?(...l)=>(this.targetQueue.push({method:a,args:l,resolve:()=>{}}),this.fallbacks[a](...l)):(...l)=>new Promise(d=>{this.targetQueue.push({method:a,args:l,resolve:d})})})}setRealTarget(t){return en(this,null,function*(){this.target=t;for(const n of this.onQueue)this.target.on[n.method](...n.args);for(const n of this.targetQueue)n.resolve(yield this.target[n.method](...n.args))})}}function $I(e,t){const n=e,o=Df(),s=gI(),r=mI&&n.enableEarlyProxy;if(s&&(o.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__||!r))s.emit(bI,e,t);else{const i=r?new wI(n,s):null;(o.__VUE_DEVTOOLS_PLUGINS__=o.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:n,setupFn:t,proxy:i}),i&&t(i.proxiedTarget)}}/*!
 * vuex v4.1.0
 * (c) 2022 Evan You
 * @license MIT
 */var CI="store";function Do(e,t){Object.keys(e).forEach(function(n){return t(e[n],n)})}function PI(e){return e!==null&&typeof e=="object"}function SI(e){return e&&typeof e.then=="function"}function kI(e,t){return function(){return e(t)}}function Rf(e,t,n){return t.indexOf(e)<0&&(n&&n.prepend?t.unshift(e):t.push(e)),function(){var o=t.indexOf(e);o>-1&&t.splice(o,1)}}function Hf(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var n=e.state;Xr(e,n,[],e._modules.root,!0),Sa(e,n,t)}function Sa(e,t,n){var o=e._state,s=e._scope;e.getters={},e._makeLocalGettersCache=Object.create(null);var r=e._wrappedGetters,i={},a={},l=Sh(!0);l.run(function(){Do(r,function(d,c){i[c]=kI(d,e),a[c]=nr(function(){return i[c]()}),Object.defineProperty(e.getters,c,{get:function(){return a[c].value},enumerable:!0})})}),e._state=Kt({data:t}),e._scope=l,e.strict&&TI(e),o&&n&&e._withCommit(function(){o.data=null}),s&&s.stop()}function Xr(e,t,n,o,s){var r=!n.length,i=e._modules.getNamespace(n);if(o.namespaced&&(e._modulesNamespaceMap[i],e._modulesNamespaceMap[i]=o),!r&&!s){var a=ka(t,n.slice(0,-1)),l=n[n.length-1];e._withCommit(function(){a[l]=o.state})}var d=o.context=OI(e,i,n);o.forEachMutation(function(c,p){var f=i+p;xI(e,f,c,d)}),o.forEachAction(function(c,p){var f=c.root?p:i+p,b=c.handler||c;jI(e,f,b,d)}),o.forEachGetter(function(c,p){var f=i+p;II(e,f,c,d)}),o.forEachChild(function(c,p){Xr(e,t,n.concat(p),c,s)})}function OI(e,t,n){var o=t==="",s={dispatch:o?e.dispatch:function(r,i,a){var l=gr(r,i,a),d=l.payload,c=l.options,p=l.type;return(!c||!c.root)&&(p=t+p),e.dispatch(p,d)},commit:o?e.commit:function(r,i,a){var l=gr(r,i,a),d=l.payload,c=l.options,p=l.type;(!c||!c.root)&&(p=t+p),e.commit(p,d,c)}};return Object.defineProperties(s,{getters:{get:o?function(){return e.getters}:function(){return Mf(e,t)}},state:{get:function(){return ka(e.state,n)}}}),s}function Mf(e,t){if(!e._makeLocalGettersCache[t]){var n={},o=t.length;Object.keys(e.getters).forEach(function(s){if(s.slice(0,o)===t){var r=s.slice(o);Object.defineProperty(n,r,{get:function(){return e.getters[s]},enumerable:!0})}}),e._makeLocalGettersCache[t]=n}return e._makeLocalGettersCache[t]}function xI(e,t,n,o){var s=e._mutations[t]||(e._mutations[t]=[]);s.push(function(i){n.call(e,o.state,i)})}function jI(e,t,n,o){var s=e._actions[t]||(e._actions[t]=[]);s.push(function(i){var a=n.call(e,{dispatch:o.dispatch,commit:o.commit,getters:o.getters,state:o.state,rootGetters:e.getters,rootState:e.state},i);return SI(a)||(a=Promise.resolve(a)),e._devtoolHook?a.catch(function(l){throw e._devtoolHook.emit("vuex:error",l),l}):a})}function II(e,t,n,o){e._wrappedGetters[t]||(e._wrappedGetters[t]=function(r){return n(o.state,o.getters,r.state,r.getters)})}function TI(e){Rn(function(){return e._state.data},function(){},{deep:!0,flush:"sync"})}function ka(e,t){return t.reduce(function(n,o){return n[o]},e)}function gr(e,t,n){return PI(e)&&e.type&&(n=t,t=e,e=e.type),{type:e,payload:t,options:n}}var EI="vuex bindings",cu="vuex:mutations",ji="vuex:actions",Jn="vuex",BI=0;function AI(e,t){$I({id:"org.vuejs.vuex",app:e,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[EI]},function(n){n.addTimelineLayer({id:cu,label:"Vuex Mutations",color:uu}),n.addTimelineLayer({id:ji,label:"Vuex Actions",color:uu}),n.addInspector({id:Jn,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree(function(o){if(o.app===e&&o.inspectorId===Jn)if(o.filter){var s=[];Uf(s,t._modules.root,o.filter,""),o.rootNodes=s}else o.rootNodes=[Lf(t._modules.root,"")]}),n.on.getInspectorState(function(o){if(o.app===e&&o.inspectorId===Jn){var s=o.nodeId;Mf(t,s),o.state=HI(FI(t._modules,s),s==="root"?t.getters:t._makeLocalGettersCache,s)}}),n.on.editInspectorState(function(o){if(o.app===e&&o.inspectorId===Jn){var s=o.nodeId,r=o.path;s!=="root"&&(r=s.split("/").filter(Boolean).concat(r)),t._withCommit(function(){o.set(t._state.data,r,o.state.value)})}}),t.subscribe(function(o,s){var r={};o.payload&&(r.payload=o.payload),r.state=s,n.notifyComponentUpdate(),n.sendInspectorTree(Jn),n.sendInspectorState(Jn),n.addTimelineEvent({layerId:cu,event:{time:Date.now(),title:o.type,data:r}})}),t.subscribeAction({before:function(o,s){var r={};o.payload&&(r.payload=o.payload),o._id=BI++,o._time=Date.now(),r.state=s,n.addTimelineEvent({layerId:ji,event:{time:o._time,title:o.type,groupId:o._id,subtitle:"start",data:r}})},after:function(o,s){var r={},i=Date.now()-o._time;r.duration={_custom:{type:"duration",display:i+"ms",tooltip:"Action duration",value:i}},o.payload&&(r.payload=o.payload),r.state=s,n.addTimelineEvent({layerId:ji,event:{time:Date.now(),title:o.type,groupId:o._id,subtitle:"end",data:r}})}})})}var uu=8702998,DI=6710886,RI=16777215,Ff={label:"namespaced",textColor:RI,backgroundColor:DI};function Nf(e){return e&&e!=="root"?e.split("/").slice(-2,-1)[0]:"Root"}function Lf(e,t){return{id:t||"root",label:Nf(t),tags:e.namespaced?[Ff]:[],children:Object.keys(e._children).map(function(n){return Lf(e._children[n],t+n+"/")})}}function Uf(e,t,n,o){o.includes(n)&&e.push({id:o||"root",label:o.endsWith("/")?o.slice(0,o.length-1):o||"Root",tags:t.namespaced?[Ff]:[]}),Object.keys(t._children).forEach(function(s){Uf(e,t._children[s],n,o+s+"/")})}function HI(e,t,n){t=n==="root"?t:t[n];var o=Object.keys(t),s={state:Object.keys(e.state).map(function(i){return{key:i,editable:!0,value:e.state[i]}})};if(o.length){var r=MI(t);s.getters=Object.keys(r).map(function(i){return{key:i.endsWith("/")?Nf(i):i,editable:!1,value:bl(function(){return r[i]})}})}return s}function MI(e){var t={};return Object.keys(e).forEach(function(n){var o=n.split("/");if(o.length>1){var s=t,r=o.pop();o.forEach(function(i){s[i]||(s[i]={_custom:{value:{},display:i,tooltip:"Module",abstract:!0}}),s=s[i]._custom.value}),s[r]=bl(function(){return e[n]})}else t[n]=bl(function(){return e[n]})}),t}function FI(e,t){var n=t.split("/").filter(function(o){return o});return n.reduce(function(o,s,r){var i=o[s];if(!i)throw new Error('Missing module "'+s+'" for path "'+t+'".');return r===n.length-1?i:i._children},t==="root"?e:e.root._children)}function bl(e){try{return e()}catch(t){return t}}var $t=function(t,n){this.runtime=n,this._children=Object.create(null),this._rawModule=t;var o=t.state;this.state=(typeof o=="function"?o():o)||{}},Vf={namespaced:{configurable:!0}};Vf.namespaced.get=function(){return!!this._rawModule.namespaced};$t.prototype.addChild=function(t,n){this._children[t]=n};$t.prototype.removeChild=function(t){delete this._children[t]};$t.prototype.getChild=function(t){return this._children[t]};$t.prototype.hasChild=function(t){return t in this._children};$t.prototype.update=function(t){this._rawModule.namespaced=t.namespaced,t.actions&&(this._rawModule.actions=t.actions),t.mutations&&(this._rawModule.mutations=t.mutations),t.getters&&(this._rawModule.getters=t.getters)};$t.prototype.forEachChild=function(t){Do(this._children,t)};$t.prototype.forEachGetter=function(t){this._rawModule.getters&&Do(this._rawModule.getters,t)};$t.prototype.forEachAction=function(t){this._rawModule.actions&&Do(this._rawModule.actions,t)};$t.prototype.forEachMutation=function(t){this._rawModule.mutations&&Do(this._rawModule.mutations,t)};Object.defineProperties($t.prototype,Vf);var Vn=function(t){this.register([],t,!1)};Vn.prototype.get=function(t){return t.reduce(function(n,o){return n.getChild(o)},this.root)};Vn.prototype.getNamespace=function(t){var n=this.root;return t.reduce(function(o,s){return n=n.getChild(s),o+(n.namespaced?s+"/":"")},"")};Vn.prototype.update=function(t){Wf([],this.root,t)};Vn.prototype.register=function(t,n,o){var s=this;o===void 0&&(o=!0);var r=new $t(n,o);if(t.length===0)this.root=r;else{var i=this.get(t.slice(0,-1));i.addChild(t[t.length-1],r)}n.modules&&Do(n.modules,function(a,l){s.register(t.concat(l),a,o)})};Vn.prototype.unregister=function(t){var n=this.get(t.slice(0,-1)),o=t[t.length-1],s=n.getChild(o);!s||!s.runtime||n.removeChild(o)};Vn.prototype.isRegistered=function(t){var n=this.get(t.slice(0,-1)),o=t[t.length-1];return n?n.hasChild(o):!1};function Wf(e,t,n){if(t.update(n),n.modules)for(var o in n.modules){if(!t.getChild(o))return;Wf(e.concat(o),t.getChild(o),n.modules[o])}}function NI(e){return new Ze(e)}var Ze=function(t){var n=this;t===void 0&&(t={});var o=t.plugins;o===void 0&&(o=[]);var s=t.strict;s===void 0&&(s=!1);var r=t.devtools;this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Vn(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=r;var i=this,a=this,l=a.dispatch,d=a.commit;this.dispatch=function(f,b){return l.call(i,f,b)},this.commit=function(f,b,v){return d.call(i,f,b,v)},this.strict=s;var c=this._modules.root.state;Xr(this,c,[],this._modules.root),Sa(this,c),o.forEach(function(p){return p(n)})},Oa={state:{configurable:!0}};Ze.prototype.install=function(t,n){t.provide(n||CI,this),t.config.globalProperties.$store=this;var o=this._devtools!==void 0?this._devtools:!1;o&&AI(t,this)};Oa.state.get=function(){return this._state.data};Oa.state.set=function(e){};Ze.prototype.commit=function(t,n,o){var s=this,r=gr(t,n,o),i=r.type,a=r.payload,l={type:i,payload:a},d=this._mutations[i];!d||(this._withCommit(function(){d.forEach(function(p){p(a)})}),this._subscribers.slice().forEach(function(c){return c(l,s.state)}))};Ze.prototype.dispatch=function(t,n){var o=this,s=gr(t,n),r=s.type,i=s.payload,a={type:r,payload:i},l=this._actions[r];if(!!l){try{this._actionSubscribers.slice().filter(function(c){return c.before}).forEach(function(c){return c.before(a,o.state)})}catch(c){}var d=l.length>1?Promise.all(l.map(function(c){return c(i)})):l[0](i);return new Promise(function(c,p){d.then(function(f){try{o._actionSubscribers.filter(function(b){return b.after}).forEach(function(b){return b.after(a,o.state)})}catch(b){}c(f)},function(f){try{o._actionSubscribers.filter(function(b){return b.error}).forEach(function(b){return b.error(a,o.state,f)})}catch(b){}p(f)})})}};Ze.prototype.subscribe=function(t,n){return Rf(t,this._subscribers,n)};Ze.prototype.subscribeAction=function(t,n){var o=typeof t=="function"?{before:t}:t;return Rf(o,this._actionSubscribers,n)};Ze.prototype.watch=function(t,n,o){var s=this;return Rn(function(){return t(s.state,s.getters)},n,Object.assign({},o))};Ze.prototype.replaceState=function(t){var n=this;this._withCommit(function(){n._state.data=t})};Ze.prototype.registerModule=function(t,n,o){o===void 0&&(o={}),typeof t=="string"&&(t=[t]),this._modules.register(t,n),Xr(this,this.state,t,this._modules.get(t),o.preserveState),Sa(this,this.state)};Ze.prototype.unregisterModule=function(t){var n=this;typeof t=="string"&&(t=[t]),this._modules.unregister(t),this._withCommit(function(){var o=ka(n.state,t.slice(0,-1));delete o[t[t.length-1]]}),Hf(this)};Ze.prototype.hasModule=function(t){return typeof t=="string"&&(t=[t]),this._modules.isRegistered(t)};Ze.prototype.hotUpdate=function(t){this._modules.update(t),Hf(this,!0)};Ze.prototype._withCommit=function(t){var n=this._committing;this._committing=!0,t(),this._committing=n};Object.defineProperties(Ze.prototype,Oa);function zf(){return{vertical:!1,lqRendering:!0,nsfw:!1,selection:null,lastDownload:null,clipboard:null,useDarkTheme:null,defaultCharacterTalkingZoom:!0,pickColor:!1}}const LI={namespaced:!0,state:zf(),mutations:{setVertical(e,t){e.vertical=t},setNsfw(e,t){e.nsfw=t},setLqRendering(e,t){e.lqRendering=t},setSelection(e,t){e.selection=t},setLastDownload(e,t){e.lastDownload=t},setClipboard(e,t){e.clipboard=t},setDarkTheme(e,t){e.useDarkTheme=t},setDefaultCharacterTalkingZoom(e,t){e.defaultCharacterTalkingZoom=t},setColorPicker(e,t){e.pickColor=t}}};var vn={},mr=Be&&Be.__assign||function(){return mr=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},mr.apply(this,arguments)},Gf=Be&&Be.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},UI=Be&&Be.__read||function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,r=[],i;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)r.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r},VI=Be&&Be.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(UI(arguments[t]));return e};Object.defineProperty(vn,"__esModule",{value:!0});vn.mapObject=qf=vn.assetWalker=vl=vn.normalizePath=void 0;var WI=10;function zI(e,t,n,o){for(var s,r,i="",a=0,l=new Map(Array.from(t.entries()).map(function(f){return[new RegExp("{"+f[0]+"}","g"),f[1]]}));i!==e;){if(i=e,++a>WI)throw new Error("Maximum replacement recursion exceeded!");try{for(var d=(s=void 0,Gf(l.entries())),c=d.next();!c.done;c=d.next()){var p=c.value;e=e.replace(p[0],p[1])}}catch(f){s={error:f}}finally{try{c&&!c.done&&(r=d.return)&&r.call(d)}finally{if(s)throw s.error}}e=e.replace(/{format(:.*?:.*?)+}/gi,function(f){f=f.slice(8,-1);for(var b=f.split(":"),v=0;v<b.length;v+=2)if(n.has(b[v]))return b[v+1];return""}),e=e.replace(/{lq:(.*?):(.*?)}/gi,function(f){return f.slice(4,-1).split(":")[o?0:1]})}return e}var vl=vn.normalizePath=zI;function GI(e,t){return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies,characters:e.characters.map(function(n){return qI(n,t)}),backgrounds:e.backgrounds.map(function(n){return tT(n,t)}),fonts:e.fonts.map(function(n){return nT(n,t)}),poemStyles:VI(e.poemStyles),poemBackgrounds:e.poemBackgrounds.map(function(n){return oT(n,t)}),sprites:e.sprites.map(function(n){return sT(n,t)}),colors:e.colors}}var qf=vn.assetWalker=GI;function qI(e,t){return{id:e.id,label:e.label,chibi:e.chibi?t(e.chibi,"image"):void 0,heads:QI(e.heads,t),styleGroups:e.styleGroups.map(function(n){return XI(n,t)}),defaultScale:e.defaultScale,hd:e.hd,size:e.size,sdVersion:e.sdVersion}}function XI(e,t){return{id:e.id,styleComponents:e.styleComponents.map(function(n){return YI(n,t)}),styles:e.styles.map(function(n){return KI(n,t)})}}function KI(e,t){return{components:e.components,poses:e.poses.map(function(n){return ZI(n,t)})}}function YI(e,t){return mr(mr({},e),{variants:JI(e.variants,t)})}function JI(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=t(e[o],"image"));return n}function ZI(e,t){var n,o,s={};try{for(var r=Gf(Object.keys(e.positions)),i=r.next();!i.done;i=r.next()){var a=i.value,l=e.positions[a];s[a]=l.map(function(d){return d.map(function(c){return t(c,"image")})})}}catch(d){n={error:d}}finally{try{i&&!i.done&&(o=r.return)&&o.call(r)}finally{if(n)throw n.error}}return{compatibleHeads:e.compatibleHeads,id:e.id,previewOffset:e.previewOffset,previewSize:e.previewSize,renderCommands:e.renderCommands.map(function(d){return d.type==="image"?{type:"image",offset:d.offset,images:d.images.map(function(c){return t(c,"image")})}:d}),size:e.size,scale:e.scale,positions:s}}function QI(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=eT(e[o],t));return n}function eT(e,t){return{previewOffset:e.previewOffset,previewSize:e.previewSize,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})})}}function tT(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})}),scaling:e.scaling,sdVersion:e.sdVersion}}function nT(e,t){return{id:e.id,label:e.label,files:e.files.map(function(n){return t(n,"font")})}}function oT(e,t){return{id:e.id,fontColor:e.fontColor,label:e.label,images:e.images.map(function(n){return t(n,"image")}),sdVersion:e.sdVersion}}function sT(e,t){return{id:e.id,label:e.label,variants:e.variants.map(function(n){return n.map(function(o){return t(o,"image")})}),defaultScale:e.defaultScale,hd:e.hd,sdVersion:e.sdVersion}}function rT(e,t){var n={};for(var o in e)!e.hasOwnProperty(o)||(n[o]=t(e[o],o));return n}vn.mapObject=rT;var ke={},br=Be&&Be.__assign||function(){return br=Object.assign||function(e){for(var t,n=1,o=arguments.length;n<o;n++){t=arguments[n];for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s])}return e},br.apply(this,arguments)};Object.defineProperty(ke,"__esModule",{value:!0});ke.expandId=ke.normalizeStyleComponent=ke.normalizeColor=ke.normalizeBackground=ke.normalizeFont=ke.normalizePoemBackground=ke.normalizePoemStyles=ke.normalizeSprite=ke.mapNormalize=Xf=ke.normalizeContentPack=void 0;var iT=vn;function lT(e,t){var n={paths:t,packId:e.packId},o=Ke("",e.folder||"/",n);return{packId:e.packId,packCredits:e.packCredits,dependencies:e.dependencies||[],characters:jt(aT,e.characters,o,n),backgrounds:jt(Qf,e.backgrounds,o,n),fonts:jt(Zf,e.fonts,o,n),poemStyles:jt(Yf,e.poemStyles,o,n),poemBackgrounds:jt(Jf,e.poemBackgrounds,o,n),sprites:jt(Kf,e.sprites,o,n),colors:jt(eh,e.colors,o,n)}}var Xf=ke.normalizeContentPack=lT;function jt(e,t,n,o){return t?t.map(function(s){return e(s,n,o)}):[]}ke.mapNormalize=jt;function Kf(e,t,n){var o,s=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label||e.variants[0][0],variants:e.variants.map(function(r){return Kr(r,s,n)}),defaultScale:e.defaultScale||[1,1],sdVersion:e.sdVersion,hd:(o=e.hd)!==null&&o!==void 0?o:null}}ke.normalizeSprite=Kf;function Yf(e){return{label:e.label,defaultFont:e.defaultFont||"Aller",fontSize:e.fontSize!==void 0?e.fontSize:30,letterSpacing:e.letterSpacing!==void 0?e.letterSpacing:1,lineSpacing:e.lineSpacing!==void 0?e.lineSpacing:1.2}}ke.normalizePoemStyles=Yf;function Jf(e,t,n){var o=Ke(t,e.folder,n);return{id:e.id,label:e.label,images:Kr(e.images,o,n),fontColor:e.fontColor||"black",sdVersion:e.sdVersion}}ke.normalizePoemBackground=Jf;function Zf(e,t,n){var o=Ke(t,e.folder,n);return{id:wt(n.packId,e.id?e.id:e.label?e.label:e.files[0]),label:e.label?e.label:e.id?e.id:e.files[0],files:Kr(e.files,o,n)}}ke.normalizeFont=Zf;function Qf(e,t,n){var o,s=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label?e.label:e.variants[0][0],variants:e.variants.map(function(r){return Kr(r,s,n)}),scaling:["none","strech","cover"].includes((o=e.scaling)===null||o===void 0?void 0:o.toLowerCase())?e.scaling.toLowerCase():"cover",sdVersion:e.sdVersion}}ke.normalizeBackground=Qf;function eh(e){return{label:e.label||e.color,color:e.color}}ke.normalizeColor=eh;function Kr(e,t,n){return e.map(function(o){return Ke(t,o,n)})}function aT(e,t,n){var o,s,r,i=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),label:e.label,chibi:e.chibi?Ke(i,e.chibi,n):void 0,heads:pT(e.heads,i,n),defaultScale:(o=e.defaultScale)!==null&&o!==void 0?o:[.8,.8],size:(s=e.size)!==null&&s!==void 0?s:[960,960],hd:(r=e.hd)!==null&&r!==void 0?r:!1,sdVersion:e.sdVersion,styleGroups:jt(dT,e.styleGroups,i,n)}}function dT(e,t,n){var o=Ke(t,e.folder,n);return{id:wt(n.packId,e.id),styleComponents:jt(th,e.styleComponents,o,n),styles:e.styles.map(function(s){return cT(s,o,n)})}}function cT(e,t,n){var o=Ke(t,e.folder,n),s={};if(e.components)for(var r in e.components)!e.components.hasOwnProperty(r)||(s[wt(n.packId,r)]=e.components[r]);return{components:s,poses:e.poses.map(function(i){return fT(i,o,n)})}}function th(e,t,n){return{id:wt(n.packId,e.id),label:e.label,variants:uT(e.variants,t,n)}}ke.normalizeStyleComponent=th;function uT(e,t,n){if(!e)return{};var o={};for(var s in e)!e.hasOwnProperty(s)||(o[s]=Ke(t,e[s],n));return o}function pT(e,t,n){var o={};if(!e)return o;for(var s in e)if(!!e.hasOwnProperty(s)){var r=e[s],i=void 0;if(r instanceof Array)i={variants:yl(r,t,n),previewOffset:[290,70],previewSize:[380,380]};else{var a=Ke(t,r.folder,n);i={variants:yl(r.variants,a,n),previewOffset:r.previewOffset||[290,70],previewSize:r.previewSize||[380,380]}}o[wt(n.packId,s)]=i}return o}function fT(e,t,n){var o,s,r=Ke(t,e.folder,n);return{compatibleHeads:((o=e.compatibleHeads)===null||o===void 0?void 0:o.map(function(i){return wt(n.packId,i)}))||[],id:wt(n.packId,e.id),previewOffset:e.previewOffset||[0,0],previewSize:e.previewSize||[960,960],size:e.size||[960,960],scale:e.scale||.8,positions:iT.mapObject(e.positions||{},function(i){return yl(i,r,n)}),renderCommands:((s=e.renderCommands)===null||s===void 0?void 0:s.map(function(i){return hT(i,t,n)}))||[{type:"head",offset:[0,0]},{type:"pose-part",part:"Left",offset:[0,0]},{type:"pose-part",part:"Right",offset:[0,0]},{type:"pose-part",part:"Variant",offset:[0,0]}]}}function hT(e,t,n){if(e.type==="image"){var o=Ke(t,e.folder,n);return{type:"image",composite:e.composite,offset:e.offset||[0,0],images:nh(e.images,o,n)}}else return br(br({},e),{offset:e.offset||[0,0]})}function yl(e,t,n){return e.map(function(o){return nh(o,t,n)})}function nh(e,t,n){return e.map(function(o){return Ke(t,o,n)})}function gT(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function Ke(e,t,n){if(!t)return e;for(var o in n.paths)if(t.startsWith(o))return n.paths[o]+t.slice(o.length);return gT(t)?t:e+t}function wt(e,t){return t.indexOf(":")!==-1?t:e+":"+t}ke.expandId=wt;var us={},Ys=Be&&Be.__values||function(e){var t=typeof Symbol=="function"&&Symbol.iterator,n=t&&e[t],o=0;if(n)return n.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&o>=e.length&&(e=void 0),{value:e&&e[o++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},mT=Be&&Be.__read||function(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var o=n.call(e),s,r=[],i;try{for(;(t===void 0||t-- >0)&&!(s=o.next()).done;)r.push(s.value)}catch(a){i={error:a}}finally{try{s&&!s.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return r},Ii=Be&&Be.__spread||function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(mT(arguments[t]));return e};Object.defineProperty(us,"__esModule",{value:!0});us.expandOrTranslateId=oh=us.convert=void 0;var _l=ke;function bT(e,t,n){if(!e.packId)throw new Error("");return{packId:e.packId,packCredits:e.packCredits?[e.packCredits]:[],dependencies:vT(e.id),backgrounds:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],characters:[yT(e,t,n)],colors:[]}}var oh=us.convert=bT,sh={"ddlc.monika":xt("dddg.buildin.base.monika","ddlc.monika",{heads:["straight","sideways"],poses:["normal","leaned","old","glitch"],styleGroups:["uniform","old","glitch"]}),"ddlc.natsuki":xt("dddg.buildin.base.natsuki","ddlc.natsuki",{heads:["straight","straight_nsfw","sideways","turnedAway"],poses:["normal","crossed_arms","vomit","glitch"],styleGroups:["uniform","casual","old"],extraPoseAssoc:[["normal_causal","normal"],["crossed_arms_casual","crossed_arms"]],extraHeadAssoc:[["straight_nsfw","straight"]]}),"ddlc.sayori":xt("dddg.buildin.sayori","ddlc.sayori",{heads:["straight","sideways"],poses:["normal","sideways","old","glitch","dead"],styleGroups:["uniform","casual","old","glitch","hanging"],extraPoseAssoc:[["normal_casual","normal"]]}),"ddlc.yuri":xt("dddg.buildin.yuri","ddlc.yuri",{heads:["straight","sideways"],poses:["normal","sideways","stabbing","glitching","dragon"],styleGroups:["uniform","casual","glitch"],extraPoseAssoc:[["normal_causal","normal"],["hairplay_casual","hairplay"]]}),"ddlc.fan.mc1":xt("dddg.buildin.mc_classic","ddlc.fan.mc1",{heads:["straight"],poses:["normal"],styleGroups:[],extraStyleGroupAssoc:[["uniform-yellow","uniform"]]}),"ddlc.fan.mc2":xt("dddg.buildin.mc","ddlc.fan.mc2",{heads:["straight","straight_red"],poses:["normal","crossed_arms","casual","glitching","dragon"],styleGroups:["uniform","casual"],extraPoseAssoc:[["crossed_arms_casual","crossed_arms"],["crossed_arms_red","crossed_arms"],["normal_red","normal"],["casual_red","casual"],["casual_crossed_arms_red","crossed_arms"]],defaultStyleComponents:[{id:"eyes",label:"Eyes",variants:{yellow:"/parts/mc/yellow-eyes{ext}",red:"/parts/mc/red-eyes{ext}"}}]}),"ddlc.fan.mc_chad":xt("dddg.buildin.mc_chad","ddlc.fan.mc_chad",{heads:["straight","straight_closed","straight_red"],poses:["normal","youknowihadto"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal_casual","normal"],["youknowihadto_casual","youknowihadto"],["normal_red","normal"],["youknowihadto_red","youknowihadto"],["normal_casual_red","normal"],["youknowihadto_casual_red","youknowihadto"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/chad/yellow-eyes{ext}",red:"/parts/chad/red-eyes{ext}"}}]}),"ddlc.fan.femc":xt("dddg.buildin.femc","ddlc.fan.femc",{heads:["straight","straight_lh","straight_closed","straight_hetero","straight_hetero_lh"],poses:["normal","crossed_arms"],styleGroups:["uniform","casual","uniform_strict"],extraPoseAssoc:[["casual_normal","normal"],["casual_crossed_arms","crossed_arms"],["uniform_normal","normal"],["uniform_crossed_arms","crossed_arms"],["normal_long_hair","normal"],["crossed_arms_long_hair","crossed_arms"],["casual_normal_long_hair","normal"],["casual_crossed_arms_long_hair","crossed_arms"],["uniform_normal_long_hair","normal"],["uniform_crossed_arms_long_hair","crossed_arms"],["normal_hetero","normal"],["crossed_arms_hetero","crossed_arms"],["casual_normal_hetero","normal"],["casual_crossed_arms_hetero","crossed_arms"],["uniform_normal_hetero","normal"],["uniform_crossed_arms_hetero","crossed_arms"],["normal_long_hair_hetero","normal"],["crossed_arms_long_hair_hetero","crossed_arms"],["casual_normal_long_hair_hetero","normal"],["casual_crossed_arms_long_hair_hetero","crossed_arms"],["uniform_normal_long_hair_hetero","normal"],["uniform_crossed_arms_long_hair_hetero","crossed_arms"]],defaultStyleComponents:[{label:"Eyes",id:"eyes",variants:{yellow:"/parts/femc/yellow-eyes{ext}",hetero:"/parts/femc/hetero-eyes{ext}"}},{label:"Hairs",id:"hairs",variants:{sh:"/parts/femc/short-hair{ext}",lh:"/parts/femc/long-hair{ext}"}}]}),"ddlc.fan.amy1":xt("dddg.buildin.amy1","ddlc.fan.amy1",{heads:["straight"],poses:["normal","crossed_arms"],styleGroups:["uniform"]}),"ddlc.fan.amy2":xt("dddg.buildin.amy2","ddlc.fan.amy2",{heads:["straight","straight_closed","straight_red"],poses:["normal","folded_hands_up","folded_hands_down","hands_on_glasses"],styleGroups:["uniform","casual"],extraPoseAssoc:[["normal-casual","normal"],["folded_hands_up-casual","folded_hands_up"],["folded_hands_down-casual","folded_hands_down"],["hands_on_glasses-casual","hands_on_glasses"]]})};function vT(e){return[]}function yT(e,t,n){var o={characterId:e.id,packId:e.packId,paths:t};return{id:_n("character",e.id,o),chibi:e.chibi,label:e.name,heads:PT(e.heads,o,n),styleGroups:_T(e,o,n),defaultScale:[.8,.8],size:[960,960],hd:!1}}function _T(e,t,n){var o,s,r=sh[t.characterId],i=[],a=new Map,l=ST(e,t),d=l.length===0?r&&r.defaultStyleComponents?wT(r.defaultStyleComponents,t):[]:l,c=e.poses.map(function(H){return H.style}).filter(function(H,D,$){return $.indexOf(H)===D}),p=new Map(e.styles.map(function(H){return[H.name,H]})),f=function(H){var D,$,x,j,K=p.get(H);if(K&&K.nsfw&&!n)return"continue";var Q=H,le={};try{for(var N=(D=void 0,Ys(d)),oe=N.next();!oe.done;oe=N.next()){var te=oe.value;try{for(var he=(x=void 0,Ys(Object.keys(te.variants))),M=he.next();!M.done;M=he.next()){var ve=M.value,Ue=new RegExp("-"+ve+"\\b");if(Q.match(Ue)){le[te.id]=ve,Q=Q.replace(Ue,"");break}}}catch(Pe){x={error:Pe}}finally{try{M&&!M.done&&(j=he.return)&&j.call(he)}finally{if(x)throw x.error}}}}catch(Pe){D={error:Pe}}finally{try{oe&&!oe.done&&($=N.return)&&$.call(N)}finally{if(D)throw D.error}}Q=_n("styleGroups",Q,t);var Ct=a.get(Q);Ct||(Ct={id:Q,styleComponents:d,styles:[]},a.set(Q,Ct),i.push(Q)),Ct.styles.push({components:le,poses:CT(e.poses.filter(function(Pe){return Pe.style===H}),t,n)})};try{for(var b=Ys(c),v=b.next();!v.done;v=b.next()){var w=v.value;f(w)}}catch(H){o={error:H}}finally{try{v&&!v.done&&(s=b.return)&&s.call(b)}finally{if(o)throw o.error}}return i.map(function(H){return a.get(H)})}function wT(e,t){return _l.mapNormalize(_l.normalizeStyleComponent,e,"",{packId:t.packId,paths:t.paths})}function $T(e,t){return e?[{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"},{type:"head",offset:t}]:[{type:"head",offset:t},{type:"pose-part",offset:[0,0],part:"Static"},{type:"pose-part",offset:[0,0],part:"Variant"},{type:"pose-part",offset:[0,0],part:"Left"},{type:"pose-part",offset:[0,0],part:"Right"}]}function CT(e,t,n){return e.map(function(o){return{compatibleHeads:o.compatibleHeads.map(function(s){return _n("heads",s.toString(),t)}),id:_n("poses",o.name,t),renderCommands:$T(o.headInForeground,o.headAnchor),previewOffset:o.offset,previewSize:o.size,size:[960,960],scale:.8,positions:{Static:"static"in o?[[o.static]]:[],Left:"left"in o?Ti(o.left,n):[],Right:"right"in o?Ti(o.right,n):[],Variant:"variant"in o?Ti(o.variant,n):[]}}})}function Ti(e,t){return e.filter(function(n){return!n.nsfw||t}).map(function(n){return[n.img]})}function PT(e,t,n){var o,s,r={};try{for(var i=Ys(Object.keys(e)),a=i.next();!a.done;a=i.next()){var l=a.value,d=e[l];d.nsfw&&!n||(r[_n("heads",l,t)]={previewOffset:d.offset,previewSize:d.size,variants:d.all.filter(function(c){return!c.nsfw||n}).map(function(c){return[c.img]})})}}catch(c){o={error:c}}finally{try{a&&!a.done&&(s=i.return)&&s.call(i)}finally{if(o)throw o.error}}return r}function ST(e,t){var n=[],o=[];return Object.keys(e.eyes).length>0&&(Object.keys(e.eyes).forEach(function(s){return o.push(s)}),n.push({label:"Eyes",id:_n("eyes","eyes",t),variants:e.eyes})),Object.keys(e.hairs).length>0&&(Object.keys(e.hairs).forEach(function(s){return o.push(s)}),n.push({label:"Hairs",id:_n("hairs","hairs",t),variants:e.hairs})),n}function Ei(e,t){return new Map(t.map(function(n){return[n,e+":"+n]}))}function xt(e,t,n){return n.extraHeadAssoc?n.extraHeadAssoc=n.extraHeadAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraHeadAssoc=[],n.extraPoseAssoc?n.extraPoseAssoc=n.extraPoseAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraPoseAssoc=[],n.extraStyleGroupAssoc?n.extraStyleGroupAssoc=n.extraStyleGroupAssoc.map(function(o){return[o[0],e+":"+o[1]]}):n.extraStyleGroupAssoc=[],{character:e+":"+t,eyes:e+":eyes",hairs:e+":hair",defaultStyleComponents:n.defaultStyleComponents||[],heads:new Map(Ii(Ei(e,n.heads),n.extraHeadAssoc)),poses:new Map(Ii(Ei(e,n.poses),n.extraPoseAssoc)),styleGroups:new Map(Ii(Ei(e,n.styleGroups),n.extraStyleGroupAssoc))}}function _n(e,t,n){var o=sh[n.characterId];if(o){if(e==="character"||e==="hairs"||e==="eyes")return o[e];var s=o[e].get(t);if(s)return s}return _l.expandId(n.packId,t)}us.expandOrTranslateId=_n;var xa={};Object.defineProperty(xa,"__esModule",{value:!0});var rh=xa.normalizeCharacter=void 0;function kT(e,t){var n=wn("",e.folder||"/",t),o=void 0;return e.chibi&&(o=wn(n,e.chibi,t)),o===void 0&&e.internalId&&(o=(t["/"]||"")+"chibis/"+e.internalId),{id:e.id,packId:e.packId,packCredits:e.packCredits,name:e.name,nsfw:!!e.nsfw,chibi:o,eyes:pu(e.eyes,n,t),hairs:pu(e.hairs,n,t),styles:jT(e.styles),heads:OT(e.heads,n,t),poses:xT(e.poses,n,t)}}rh=xa.normalizeCharacter=kT;function pu(e,t,n){if(!e)return{};var o={};for(var s in e)!e.hasOwnProperty(s)||(o[s]=wn(t,e[s],n));return o}function OT(e,t,n){var o={};if(!e)return o;for(var s in e)if(!!e.hasOwnProperty(s)){var r=e[s],i=void 0;if(r instanceof Array)i={all:Zo(r,t,n),nsfw:!1,offset:[290,70],size:[380,380]};else{var a=wn(t,r.folder,n);i={all:Zo(r.all,a,n),nsfw:!!r.nsfw,offset:r.offset||[290,70],size:r.size||[380,380]}}o[s]=i}return o}function xT(e,t,n){return e?e.map(function(o){var s=wn(t,o.folder,n),r={compatibleHeads:o.compatibleHeads||[],headAnchor:o.headAnchor||[0,0],headInForeground:!!o.headInForeground,name:o.name,nsfw:!!o.nsfw,style:o.style,offset:[0,0],size:[960,960]};if("static"in o)r.static=wn(s,o.static,n);else if("variant"in o)r.variant=Zo(o.variant,s,n);else if("left"in o)r.left=Zo(o.left,s,n),r.right=Zo(o.right,s,n);else throw new Error("Invalid pose");return r}):[]}function Zo(e,t,n){return e.map(function(o){return typeof o=="string"?{img:wn(t,o,n),nsfw:!1}:{img:wn(t,o.img,n),nsfw:o.nsfw||!1}})}function jT(e){return e?e.map(function(t){return{name:t.name,label:t.label,nsfw:t.nsfw||!1}}):[]}function IT(e){return e.startsWith("blob:")||e.startsWith("http://")||e.startsWith("https://")||e.startsWith("://")}function wn(e,t,n){if(!t)return e;for(var o in n)if(t.startsWith(o))return n[o]+t.slice(o.length);return IT(t)?t:e+t}var Qo=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});function fu(e){return e.split("/").slice(0,-1).join("/")+"/"}const hu=new Set(["png","gif","bmp","svg"]);function ih(){return{contentPacks:[],current:{dependencies:[],backgrounds:[],characters:[],fonts:[],poemStyles:[],poemBackgrounds:[],sprites:[],colors:[]}}}const TT={namespaced:!0,state:ih(),mutations:{setContentPacks(e,t){e.contentPacks=t},setCurrentContent(e,t){e.current=t}},actions:{removeContentPacks({commit:e,state:t,dispatch:n},o){const s=JSON.parse(JSON.stringify(t.current)),r=t.contentPacks.filter(i=>!o.has(i.packId));e("setContentPacks",r),e("setCurrentContent",r.reduce((i,a)=>Ks(i,a))),n("panels/fixContentPackRemoval",s,{root:!0})},replaceContentPack(e,t){return Qo(this,arguments,function*({commit:n,state:o},s){debugger;const r=s.processed?s.contentPack:yield vr(s.contentPack);let i=o.contentPacks;const a=i.findIndex(l=>l.packId===s.contentPack.packId);a===-1?i.push(r):i.splice(a,1,r),i=i,n("setContentPacks",i),n("setCurrentContent",i.reduce((l,d)=>Ks(l,d)))})},loadContentPacks(e,t){return Qo(this,arguments,function*({commit:n,state:o},s){typeof s=="string"&&(s=[s]);const r=yield Promise.all(s.map(d=>Qo(this,null,function*(){return wl(d)}))),i=yield Promise.all(r.map(d=>vr(d))),a=new Set(o.contentPacks.map(d=>d.packId));let l=o.current;for(const d of i){for(const c of d.dependencies)if(!a.has(c))throw new Error(`Missing dependency '${c}'. Refusing to install ${d.packId}`);l=Ks(l,d)}return n("setContentPacks",[...o.contentPacks,...i]),n("setCurrentContent",l),r.map(d=>d.packId)})}},getters:{getCharacters({current:e}){const t=new Map;for(const n of e.characters)t.set(n.id,n);return t},getBackgrounds({current:e}){const t=new Map;for(const n of e.backgrounds)t.set(n.id,n);return t}}};function wl(e){return Qo(this,null,function*(){const t=yield fetch(e);if(!t.ok)throw new Error(`Could not load content pack. Server responded with: ${t.statusText}`);let n;try{n=yield t.json()}catch(o){throw new Error("Content pack is not valid json!")}try{const o={"./":fu(e),"/":fu(location.href)+"assets/"};return n.version==="2.0"?Xf(n,o):oh(rh(n,o),o,!1)}catch(o){throw new Error("Content pack is not in a valid format!")}})}function vr(e){return Qo(this,null,function*(){const t=new Set((yield mo())?["webp",...hu]:hu),n=new Map([["ext","{lq:.lq:}.{format:webp:webp:png:png}"]]);return qf(e,(o,s)=>{var r;const i=vl(o,n,t,!1),a=vl(o,n,t,!0);return{hq:i,lq:a,sourcePack:(r=e.packId)!=null?r:"buildIn"}})})}const ET={namespaced:!0,state:{},mutations:{add(e,{name:t,url:n}){e[t]=n}},actions:{add({state:e,commit:t},{name:n,url:o}){if(e[n])throw new Error(`There is already an uploaded file called "${n}"`);const s="uploads:"+n;return t("add",{name:s,url:o}),kp(s,o),s}}};var BT=Object.defineProperty,AT=Object.defineProperties,DT=Object.getOwnPropertyDescriptors,gu=Object.getOwnPropertySymbols,RT=Object.prototype.hasOwnProperty,HT=Object.prototype.propertyIsEnumerable,mu=(e,t,n)=>t in e?BT(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,MT=(e,t)=>{for(var n in t||(t={}))RT.call(t,n)&&mu(e,n,t[n]);if(gu)for(var n of gu(t))HT.call(t,n)&&mu(e,n,t[n]);return e},FT=(e,t)=>AT(e,DT(t)),Ls=(e,t,n)=>new Promise((o,s)=>{var r=l=>{try{a(n.next(l))}catch(d){s(d)}},i=l=>{try{a(n.throw(l))}catch(d){s(d)}},a=l=>l.done?o(l.value):Promise.resolve(l.value).then(r,i);a((n=n.apply(e,t)).next())});const NT=NI({state:{unsafe:!1},mutations:{setUnsafe(e,t){e.unsafe=t}},actions:{removePacks(e,t){return Ls(this,arguments,function*({dispatch:n,commit:o},{packs:s}){o("setUnsafe",!0),n("content/removeContentPacks",s),o("setUnsafe",!1)})},getSave(e,t){return Ls(this,arguments,function*({state:n},o){const s=yield Jt.getInstance();return JSON.stringify(n,(r,i)=>{if(r!=="ui"&&r!=="lastRender")return r==="uploadUrls"?Object.keys(i):r==="content"&&o?i.contentPacks.filter(a=>{var l,d;return!((l=a.packId)!=null&&l.startsWith("dddg.buildin."))||((d=a.packId)==null?void 0:d.endsWith(".nsfw"))}).map(a=>{var l;let d=(l=a.packId)!=null&&l.startsWith("dddg.uploads.")?a:a.packId;if(a.packId!=null){const c=s.getPack(a.packId);c&&c.repoUrl!=null&&(d+=`;${c.repoUrl}`)}return d}):i},2)})},loadSave(e,t){return Ls(this,arguments,function*({state:n},o){const s=JSON.parse(o),r=s.content;s.ui=FT(MT({},zf()),{vertical:n.ui.vertical,lqRendering:n.ui.lqRendering,nsfw:r.find(l=>typeof l=="string"&&l.startsWith("dddg.buildin.")&&l.endsWith(".nsfw"))!==void 0,clipboard:n.ui.clipboard,useDarkTheme:n.ui.useDarkTheme,defaultCharacterTalkingZoom:n.ui.defaultCharacterTalkingZoom}),s.uploadUrls={},s.content=ih();const i=yield Jt.getInstance();s.content.contentPacks=[...n.content.contentPacks.filter(l=>{var d;return(d=l.packId)==null?void 0:d.startsWith("dddg.buildin.")}),...(yield Promise.all(r.map(l=>Ls(this,null,function*(){if(typeof l!="string")return l;let d=null,c;l.indexOf(";")>=0?[c,d]=l.split(";"):c=l;const p=n.content.contentPacks.find(v=>v.packId===c);if(p)return p;if(l.startsWith("dddg.buildin.")&&l.endsWith(".nsfw")){const v=yield wl(Pa[l]);return yield vr(v)}d!=null&&!i.hasPack(c)&&(yield i.loadTempPack(d));const f=i.getPack(c);if(!f)return console.warn(`Pack Id ${l} not found!`),null;const b=yield wl(f.dddg2Path||f.dddg1Path);return yield vr(b)})))).filter(l=>l!==null)];let a=s.content.current;for(const l of s.content.contentPacks)a=Ks(a,l);s.content.current=a,this.replaceState(s),ue.fire(new Tr)})}},modules:{ui:LI,panels:qO,content:TT,uploadUrls:ET}}),LT={install(e,t={}){if(!e.config.globalProperties.$store)throw new Error("VuexUndoRedo plugin must be installed after the Vuex plugin.");t.resetStateMutation||(t.resetStateMutation="emptyState"),t.mutations||(t.mutations={});const n=e.config.globalProperties.$store;function o(c,p){let f={};switch(typeof p.payload){case"object":p.payload instanceof Array&&(f=[]),n.commit(`${p.type}`,Object.assign(f,p.payload));break;default:n.commit(`${p.type}`,p.payload)}}function s(c,p){return en(this,null,function*(){return yield c.transaction(()=>{p.forEach(f=>{o(c,f)})})})}function r(c){return en(this,null,function*(){const p=c.data.done.slice(0);c.data.done=[],n.commit(t.resetStateMutation);for(let f=0;f<p.length;++f)yield s(c,p[f])})}const i={};function a(c){if(!i[c]){const p=c.split("/"),f={ignore:v=>!1,combinable:(v,w)=>!1,combinator:(v,w)=>w};let b="";for(const v of p)t.mutations[b+"*"]&&Object.assign(f,t.mutations[b+"*"]),b+=v+"/";t.mutations[c]&&Object.assign(f,t.mutations[c]),i[c]=f}return i[c]}const l={data:Kt({done:[],undone:[],snapshots:[],transactionsSinceSnapshot:0,newMutation:!0,ignoreMutations:t.ignoreMutations||[],currentTransaction:null,transactionQueue:[],initialized:!1}),initialize(){l.initialized||(l.initialized=!0,n.subscribe(c=>{const p=()=>{c.type===t.resetStateMutation||a(c.type).ignore(c)||(l.currentTransaction.push(c),l.newMutation&&(l.data.undone=[]))};l.currentTransaction?p():l.transaction(()=>{p()})}))},redo(){return en(this,null,function*(){if(l.data.undone.length<=0)return;const c=l.data.undone.pop();l.newMutation=!1,yield s(l,c),l.newMutation=!0})},undo(){return en(this,null,function*(){l.data.done.length<=0||(l.data.undone.push(l.data.done.pop()),l.newMutation=!1,yield r(l),l.newMutation=!0)})},clearHistory(){return new Promise((c,p)=>{const f=()=>en(this,null,function*(){l.currentTransaction=[],l.transactionsSinceSnapshot=0,l.data.undone=[],l.data.done=[],c(),l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()()});l.currentTransaction?l.data.transactionQueue.push(f):f()})},transaction(c){return new Promise((p,f)=>{const b=()=>en(this,null,function*(){l.currentTransaction=[],l.transactionsSinceSnapshot++;try{yield c()}catch(v){console.log("Error during transaction!: ",v)}l.currentTransaction=null,l.data.transactionQueue.length>0&&l.data.transactionQueue.shift()(),p()});l.currentTransaction?l.data.transactionQueue.push(b):b()})}};window.storeHistory=l,e.config.globalProperties.vuexHistory=l,l.initialize()}};Km(tI).use(NT).use(LT).mount("#main_wrapper");export{Ht as A,Mn as B,Kl as C,Op as D,_s as E,U as F,sx as G,_t as H,Zl as L,Jt as R,qo as S,VT as T,$p as V,ne as _,u as a,G as b,y as c,ee as d,X as e,sm as f,Ge as g,C as h,B as i,Rt as j,q as k,O as l,L as m,pe as n,g as o,ze as p,Re as q,Ce as r,E as s,fe as t,ue as u,Ee as v,de as w,Kt as x,qt as y,Yl as z};
